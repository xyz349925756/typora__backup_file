!function(m){function t(e){Object.defineProperty(this,e,{enumerable:!0,get:function(){return this[n][e]}})}function s(e){if("undefined"!=typeof System&&System.isModule?System.isModule(e):"[object Module]"===Object.prototype.toString.call(e))return e;var t={default:e,__useDefault:e};if(e&&e.__esModule)for(var n in e)Object.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return new g(t)}function g(e){Object.defineProperty(this,n,{value:e}),Object.keys(e).forEach(t,this)}function a(e){return"@node/"===e.substr(0,6)?h(e,s(f(e.substr(6)))):p[e]}function l(e){var t,n=a(e);if(n)return n.module||(function e(t,n){if(!n.depLoads){n.declare&&c(t,n),n.depLoads=[];for(var i=0;i<n.deps.length;i++){var r=a(n.deps[i]),o=(n.depLoads.push(r),r.linkRecord&&e(r,r.linkRecord),n.setters&&n.setters[i]);o&&(o(r.module||r.linkRecord.moduleObj),r.importerSetters.push(o))}return t}}(n,t=n.linkRecord),y(n,t,[])),n.module;throw new Error('Module "'+e+'" expected, but not contained in build.')}function c(e,t){var r=t.moduleObj,o=e.importerSetters,a=!1,e=t.declare.call(m,function(e,t){if(!a){if("object"==typeof e)for(var n in e)"__useDefault"!==n&&(r[n]=e[n]);else r[e]=t;a=!0;for(var i=0;i<o.length;i++)o[i](r);return a=!1,t}},{id:e.key});"function"!=typeof e?(t.setters=e.setters,t.execute=e.execute):(t.setters=[],t.execute=e)}function d(e,t,n){return p[e]={key:e,module:void 0,importerSetters:[],linkRecord:{deps:t,depLoads:void 0,declare:n,setters:void 0,execute:void 0,moduleObj:{}}}}function u(e,t,n,i){var r={};return p[e]={key:e,module:void 0,importerSetters:[],linkRecord:{deps:t,depLoads:void 0,declare:void 0,execute:i,executingRequire:n,moduleObj:{default:r,__useDefault:r},setters:void 0}}}function y(e,t,n){if(n.push(e),e.module)return e.module;var r,o,a;if(t.setters){for(var i=0;i<t.deps.length;i++){var s=t.depLoads[i],l=s.linkRecord;l&&-1===n.indexOf(s)&&y(s,l,l.setters?n:[])}t.execute.call(v)}else{var c={id:e.key},d=t.moduleObj,u=(Object.defineProperty(c,"exports",{configurable:!0,set:function(e){d.default=d.__useDefault=e},get:function(){return d.__useDefault}}),r=t.deps,o=t.depLoads,a=n,function(e){for(var t,n,i=0;i<r.length;i++)if(r[i]===e)return"__useDefault"in(n=(n=(t=o[i]).linkRecord)?-1===a.indexOf(t)?y(t,n,a):n.moduleObj:t.module)?n.__useDefault:n});if(!t.executingRequire)for(i=0;i<t.deps.length;i++)u(t.deps[i]);var h=t.execute.call(m,u,d.__useDefault,c),p=(void 0!==h?d.default=d.__useDefault=h:c.exports!==d.__useDefault&&(d.default=d.__useDefault=c.exports),d.__useDefault);if(p&&p.__esModule)for(var f in p)Object.hasOwnProperty.call(p,f)&&(d[f]=p[f])}c=e.module=new g(t.moduleObj);if(!t.setters)for(i=0;i<e.importerSetters.length;i++)e.importerSetters[i](c);return c}function h(e,t){return p[e]={key:e,module:t,importerSetters:[],linkRecord:void 0}}var p={},n="undefined"!=typeof Symbol?Symbol():"@@baseObject",f=(g.prototype=Object.create(null),"undefined"!=typeof Symbol&&Symbol.toStringTag&&(g.prototype[Symbol.toStringTag]="Module"),"undefined"!=typeof System&&System._nodeRequire||"undefined"!=typeof require&&void 0!==require.resolve&&"undefined"!=typeof process&&process.platform&&require),v={};return Object.freeze&&Object.freeze(v),function(i,r,o,a){return function(e){e(function(e){var t={_nodeRequire:f,register:d,registerDynamic:u,registry:{get:function(e){return p[e].module},set:h},newModule:function(e){return new g(e)}};h("@empty",new g({}));for(var n=0;n<r.length;n++)h(r[n],s(arguments[n]));a(t);t=l(i[0]);if(1<i.length)for(n=1;n<i.length;n++)l(i[n]);return o?t.__useDefault:(t instanceof g&&Object.defineProperty(t,"__esModule",{value:!0}),t)})}}}("undefined"!=typeof self?self:"undefined"!=typeof global?global:this)(["a"],[],!0,function($__System){var require=this.require,exports=this.exports,module=this.module;!function(l){function c(e,t){for(var n=e.split(".");n.length;)t=t[n.shift()];return t}function d(t){if(-1===n.indexOf(t)){try{var e=l[t]}catch(e){n.push(t)}this(t,e)}}var u,e=$__System,n=["_g","sessionStorage","localStorage","clipboardData","frames","frameElement","external","mozAnimationStartTime","webkitStorageInfo","webkitIndexedDB","mozInnerScreenY","mozInnerScreenX"];e.registry.set("@@global-helpers",e.newModule({prepareGlobal:function(e,o,t){var a,s=l.define;if(l.define=void 0,t)for(var n in a={},t)a[n]=l[n],l[n]=t[n];return o||(u={},Object.keys(l).forEach(d,function(e,t){u[e]=t})),function(){var n,i=o?function(e){if("string"==typeof e)return c(e,l);if(!(e instanceof Array))throw new Error("Global exports must be a string or array.");for(var t={},n=0;n<e.length;n++)t[e[n].split(".").pop()]=c(e[n],l);return t}(o):{},r=!!o;if(o||Object.keys(l).forEach(d,function(e,t){u[e]===t||void 0===t||o||(i[e]=t,void 0!==n?r||n===t||(r=!0):n=t)}),i=r?i:n,a)for(var e in a)l[e]=a[e];return l.define=s,i}}}))}("undefined"!=typeof self?self:"undefined"!=typeof global?global:this),!function(e){"use strict";var o=function(){},t=e.requestAnimationFrame||e.webkitRequestAnimationFrame||e.mozRequestAnimationFrame||e.msRequestAnimationFrame||function(e){return setTimeout(e,16)};function n(){this.reads=[],this.writes=[],this.raf=t.bind(e),o("initialized",this)}function r(e){e.scheduled||(e.scheduled=!0,e.raf(function(e){o("flush");var t,n=e.writes,i=e.reads;try{o("flushing reads",i.length),a(i),o("flushing writes",n.length),a(n)}catch(e){t=e}e.scheduled=!1,(i.length||n.length)&&r(e);if(t){if(o("task errored",t.message),!e.catch)throw t;e.catch(t)}}.bind(null,e)),o("flush scheduled"))}function a(e){var t;for(o("run tasks");t=e.shift();)t()}function i(e,t){t=e.indexOf(t);return!!~t&&!!e.splice(t,1)}n.prototype={constructor:n,measure:function(e,t){o("measure");t=t?e.bind(t):e;return this.reads.push(t),r(this),t},mutate:function(e,t){o("mutate");t=t?e.bind(t):e;return this.writes.push(t),r(this),t},clear:function(e){return o("clear",e),i(this.reads,e)||i(this.writes,e)},extend:function(e){if(o("extend",e),"object"!=typeof e)throw new Error("expected object");var t,n=Object.create(this),i=n,r=e;for(t in r)r.hasOwnProperty(t)&&(i[t]=r[t]);return n.fastdom=this,n.initialize&&n.initialize(),n},catch:null};var s=e.fastdom=e.fastdom||new n;"f"=="function"[0]?$__System.registerDynamic("b",[],!1,function(e,t,n){return function(){return s}.call(this)}):"o"==(typeof module)[0]&&(module.exports=s)}(window||this),!function(){var i={initialize:function(){this._tasks=new Map},mutate:function(e,t){return n(this,"mutate",e,t)},measure:function(e,t){return n(this,"measure",e,t)},clear:function(e){var t=this._tasks,e=t.get(e);this.fastdom.clear(e),t.delete(e)}};function n(e,n,i,r){var o,a=e._tasks,s=e.fastdom,l=new Promise(function(e,t){o=s[n](function(){a.delete(l);try{e(r?i.call(r):i())}catch(e){t(e)}},r)});return a.set(l,o),l}"f"=="function"[0]?$__System.registerDynamic("c",[],!1,function(e,t,n){return function(){return i}.call(this)}):"o"==(typeof module)[0]?module.exports=i:window.fastdomPromised=i}(),$__System.registerDynamic("d",["e"],!0,function(e,t,n){this||self;var w,e=e("e");(w=e).defaultLanguage=navigator.languages&&0<navigator.languages.length?navigator.languages[0]:navigator.language||navigator.userLanguage,w.localize=function(e,a){var t=this,s={},i=(a=null==a?{}:a).fileExtension||"json",r=w.Deferred(),l=function(e,t,n){return 1!==(n=null==n?1:n)?r.resolve():(s={},o(t+".lproj/"+e+"."+i,e,t,n))},o=function(e,t,n,i){var r,o;return null!=a.pathPrefix&&(e=a.pathPrefix+"/"+e),o=function(e){return w.extend(s,e),c(s),l(t,n,i+1)},r=function(){return 2===i&&-1<n.indexOf("-")?l(t,n,i+1):a.fallback&&a.fallback!==n?l(t,a.fallback):void 0},w.localize.data[t]?o(w.localize.data[t]):(e={url:e,dataType:"json",async:!0,timeout:null!=a.timeout?a.timeout:500,success:o,error:r},"file:"===window.location.protocol&&(e.error=function(e){return o(e.responseText?w.parseJSON(e.responseText):{})}),w.ajax(e))},c=function(e){return null!=a.callback?a.callback(e,n):n(e)},n=function(i){return w.localize.data[e]=i,t.each(function(){var e=w(this),t=(e.data("localize")||e.data("afterContent")||e.attr("ty-hint")||"").replace(/\\n/g,"\n"),n=m(t,i);if(n)return d(e,t,n)})},d=function(e,t,n){if(e.is("input")||e.is("textarea")?u(e,t,n):e.is("img")?f(e,t,n):e.is("optgroup")&&p(e,t,n),e[0].hasAttribute("data-after-content"))e.attr("data-after-content",n);else if(e[0].hasAttribute("ty-hint"))e.attr("ty-hint",n).attr("aria-label",n);else if(e[0].hasAttribute("data-lt"))e.html(n);else{if(w.isPlainObject(n))return h(e,n);e.text(n)}},u=function(e,t,n){n=w.isPlainObject(n)?n.value:n;if(e.is("[placeholder]"))return e.attr("placeholder",n)},h=function(e,t){return g(e,"title",t),y(e,"text",t)},p=function(e,t,n){return e.attr("label",n)},f=function(e,t,n){return g(e,"alt",n),g(e,"src",n)},m=function(e,t){return e?t[e]||(/((\.\.\.)|(…))$/.exec(e)?(t[e=e.replace(/((\.\.\.)|(…))$/,"")]||e)+"…":e):""},g=function(e,t,n){if(null!=(n=m(t,n)))return e.attr(t,n)},y=function(e,t,n){if(null!=(n=m(t,n)))return e.text(n)},v=function(i){var r;return"string"==typeof i?"^"+i+"$":null!=i.length?function(){for(var e=[],t=0,n=i.length;t<n;t++)r=i[t],e.push(v(r));return e}().join("|"):i},b=a.language||w.defaultLanguage;return a.skipLanguage&&b.match(v(a.skipLanguage))?r.resolve():l(e,b,1),t.localizePromise=r,t},w.fn.localize=w.localize,w.localize.getString=function(e,t){t=w.localize.data[t||"Front"]||{};return e?t[e]||(/((\.\.\.)|(…))$/.exec(e)?(t[e=e.replace(/((\.\.\.)|(…))$/,"")]||e)+"…":e):""},w.localize.isLoaded=function(e){return!!w.localize.data[e||"Front"]},w.localize.data={}}),$__System.registerDynamic("f",["e"],!0,function(e,t,n){"use strict";var o,i,r,a,s,l,c,d,u,h,p,f;this||self;if(window.jQuery||(window.$=e("e"),window.jQuery=window.$),"undefined"==typeof jQuery)throw new Error("Bootstrap's JavaScript requires jQuery");function m(e){o(e).on("click",i,this.close)}function g(e,t){this.$element=a(e),this.options=a.extend({},g.DEFAULTS,t),this.isLoading=!1}function y(n){return this.each(function(){var e=a(this),t=e.data("bs.button");t||e.data("bs.button",t=new g(this,"object"==typeof n&&n)),"toggle"==n?t.toggle():n&&t.setState(n)})}function v(e){l(e).on("click.bs.dropdown",this.toggle)}function b(n){n&&3===n.which||(l(".dropdown-backdrop").remove(),l(c).each(function(){var e=w(l(this)),t={relatedTarget:this};e.hasClass("open")&&(e.trigger(n=l.Event("hide.bs.dropdown",t)),n.isDefaultPrevented()||e.removeClass("open").trigger("hidden.bs.dropdown",t))}))}function w(e){var t=e.attr("data-target"),t=(t=t||(t=e.attr("href"))&&/#[A-Za-z]/.test(t)&&t.replace(/.*(?=#[^\s]*$)/,""))&&l(t);return t&&t.length?t:e.parent()}function x(e,t){this.options=t,this.$body=u(document.body),this.$element=u(e),this.$backdrop=this.isShown=null,this.scrollbarWidth=0,this.options.remote&&this.$element.find(".modal-content").load(this.options.remote,u.proxy(function(){this.$element.trigger("loaded.bs.modal")},this))}function C(i,r){return this.each(function(){var e=u(this),t=e.data("bs.modal"),n=u.extend({},x.DEFAULTS,e.data(),"object"==typeof i&&i);t||e.data("bs.modal",t=new x(this,n)),"string"==typeof i?t[i](r):n.show&&t.show(r)})}function F(e){this.element=p(e)}function S(n){return this.each(function(){var e=p(this),t=e.data("bs.tab");t||e.data("bs.tab",t=new F(this)),"string"==typeof n&&t[n]()})}o=jQuery,i='[data-dismiss="alert"]',m.VERSION="3.2.0",m.prototype.close=function(e){var t=o(this),n=(n=t.attr("data-target"))||(n=t.attr("href"))&&n.replace(/.*(?=#[^\s]*$)/,""),i=o(n);function r(){i.detach().trigger("closed.bs.alert").remove()}e&&e.preventDefault(),(i=i.length?i:t.hasClass("alert")?t:t.parent()).trigger(e=o.Event("close.bs.alert")),e.isDefaultPrevented()||(i.removeClass("in"),o.support.transition&&i.hasClass("fade")?i.one("bsTransitionEnd",r).emulateTransitionEnd(150):r())},r=o.fn.alert,o.fn.alert=function(n){return this.each(function(){var e=o(this),t=e.data("bs.alert");t||e.data("bs.alert",t=new m(this)),"string"==typeof n&&t[n].call(e)})},o.fn.alert.Constructor=m,o.fn.alert.noConflict=function(){return o.fn.alert=r,this},o(document).on("click.bs.alert.data-api",i,m.prototype.close),a=jQuery,g.VERSION="3.2.0",g.DEFAULTS={loadingText:"loading..."},g.prototype.setState=function(e){var t="disabled",n=this.$element,i=n.is("input")?"val":"html",r=n.data();e+="Text",null==r.resetText&&n.data("resetText",n[i]()),n[i]((null==r[e]?this.options:r)[e]),setTimeout(a.proxy(function(){"loadingText"==e?(this.isLoading=!0,n.addClass(t).attr(t,t)):this.isLoading&&(this.isLoading=!1,n.removeClass(t).removeAttr(t))},this),0)},g.prototype.toggle=function(){var e,t=!0,n=this.$element.closest('[data-toggle="buttons"]');n.length&&("radio"==(e=this.$element.find("input")).prop("type")&&(e.prop("checked")&&this.$element.hasClass("active")?t=!1:n.find(".active").removeClass("active")),t)&&e.prop("checked",!this.$element.hasClass("active")).trigger("change"),t&&this.$element.toggleClass("active")},s=a.fn.button,a.fn.button=y,a.fn.button.Constructor=g,a.fn.button.noConflict=function(){return a.fn.button=s,this},a(document).on("click.bs.button.data-api",'[data-toggle^="button"]',function(e){var t=a(e.target);t.hasClass("btn")||(t=t.closest(".btn")),y.call(t,"toggle"),e.preventDefault()}),l=jQuery,c='[data-toggle="dropdown"]',v.VERSION="3.2.0",v.prototype.toggle=function(e){var t=l(this);if(!t.is(".disabled, :disabled")){var n=w(t),i=n.hasClass("open");if(b(),!i){"ontouchstart"in document.documentElement&&!n.closest(".navbar-nav").length&&l('<div class="dropdown-backdrop"/>').insertAfter(l(this)).on("click",b);i={relatedTarget:this};if(n.trigger(e=l.Event("show.bs.dropdown",i)),e.isDefaultPrevented())return;t.trigger("focus"),n.toggleClass("open").trigger("shown.bs.dropdown",i)}return!1}},v.prototype.keydown=function(e){if(/(38|40|27)/.test(e.keyCode)){var t=l(this);if(e.preventDefault(),e.stopPropagation(),!t.is(".disabled, :disabled")){var n=w(t),i=n.hasClass("open");if(!i||27==e.keyCode)return 27==e.which&&n.find(c).trigger("focus"),t.trigger("click");i=" li:not(.divider):visible a",t=n.find('[role="menu"]'+i+', [role="listbox"]'+i);t.length&&(n=t.index(t.filter(":focus")),38==e.keyCode&&0<n&&n--,40==e.keyCode&&n<t.length-1&&n++,t.eq(n=~n?n:0).trigger("focus"))}}},d=l.fn.dropdown,l.fn.dropdown=function(n){return this.each(function(){var e=l(this),t=e.data("bs.dropdown");t||e.data("bs.dropdown",t=new v(this)),"string"==typeof n&&t[n].call(e)})},l.fn.dropdown.Constructor=v,l.fn.dropdown.noConflict=function(){return l.fn.dropdown=d,this},l(document).on("click.bs.dropdown.data-api","modal.fade.in",b).on("click.bs.dropdown.data-api",".dropdown form",function(e){e.stopPropagation()}).on("click.bs.dropdown.data-api",c,v.prototype.toggle).on("keydown.bs.dropdown.data-api",c+', [role="menu"], [role="listbox"]',v.prototype.keydown),u=jQuery,x.VERSION="3.2.0",x.DEFAULTS={backdrop:!0,keyboard:!0,show:!0},x.prototype.toggle=function(e){return this.isShown?this.hide():this.show(e)},x.prototype.show=function(n){var i=this,e=u.Event("show.bs.modal",{relatedTarget:n});this.$element.trigger(e),this.isShown||e.isDefaultPrevented()||(this.isShown=!0,this.checkScrollbar(),this.$body.addClass("modal-open"),this.setScrollbar(),this.escape(),this.$element.on("click.dismiss.bs.modal",'[data-dismiss="modal"]',u.proxy(this.hide,this)),this.backdrop(function(){var e=u.support.transition&&i.$element.hasClass("fade"),t=(i.$element.parent().length||i.$element.appendTo(i.$body),i.$element.show().scrollTop(0),e&&i.$element[0].offsetWidth,i.$element.addClass("in").attr("aria-hidden",!1),i.enforceFocus(),u.Event("shown.bs.modal",{relatedTarget:n}));e?i.$element.find(".modal-dialog").one("bsTransitionEnd",function(){i.$element.trigger("focus").trigger(t)}).emulateTransitionEnd(300):i.$element.trigger("focus").trigger(t)}))},x.prototype.hide=function(e){e&&e.preventDefault(),e=u.Event("hide.bs.modal"),this.$element.trigger(e),this.isShown&&!e.isDefaultPrevented()&&(this.isShown=!1,this.resetScrollbar(),this.escape(),u(document).off("focusin.bs.modal"),this.$element.removeClass("in").attr("aria-hidden",!0).off("click.dismiss.bs.modal"),u.support.transition&&this.$element.hasClass("fade")?this.$element.one("bsTransitionEnd",u.proxy(this.hideModal,this)).emulateTransitionEnd(300):this.hideModal())},x.prototype.enforceFocus=function(){u(document).off("focusin.bs.modal").on("focusin.bs.modal",u.proxy(function(e){this.$element[0]===e.target||this.$element.has(e.target).length||this.$element.trigger("focus")},this))},x.prototype.escape=function(){this.isShown&&this.options.keyboard?this.$element.on("keyup.dismiss.bs.modal",u.proxy(function(e){27==e.which&&this.hide()},this)):this.isShown||this.$element.off("keyup.dismiss.bs.modal")},x.prototype.hideModal=function(){var e=this;this.$element.hide(),this.backdrop(function(){e.$element.trigger("hidden.bs.modal"),u("body").removeClass("modal-open")})},x.prototype.removeBackdrop=function(){this.$backdrop&&this.$backdrop.remove(),this.$backdrop=null},x.prototype.backdrop=function(e){var t,n=this,i=this.$element.hasClass("fade")?"fade":"";this.isShown&&this.options.backdrop?(t=u.support.transition&&i,this.$backdrop=u('<div class="modal-backdrop '+i+'" />').appendTo(this.$body),this.$element.on("click.dismiss.bs.modal",u.proxy(function(e){e.target===e.currentTarget&&("static"==this.options.backdrop?this.$element[0].focus.call(this.$element[0]):this.hide.call(this))},this)),t&&this.$backdrop[0].offsetWidth,this.$backdrop.addClass("in"),e&&(t?this.$backdrop.one("bsTransitionEnd",e).emulateTransitionEnd(150):e())):!this.isShown&&this.$backdrop?(this.$backdrop.removeClass("in"),i=function(){n.removeBackdrop(),e&&e()},u.support.transition&&this.$element.hasClass("fade")?this.$backdrop.one("bsTransitionEnd",i).emulateTransitionEnd(150):i()):e&&e()},x.prototype.checkScrollbar=function(){document.body.clientWidth>=window.innerWidth||(this.scrollbarWidth=this.scrollbarWidth||this.measureScrollbar())},x.prototype.setScrollbar=function(){var e=parseInt(this.$body.css("padding-right")||0,10);this.scrollbarWidth&&this.$body.css("padding-right",e+this.scrollbarWidth)},x.prototype.resetScrollbar=function(){this.$body.css("padding-right","")},x.prototype.measureScrollbar=function(){var e=document.createElement("div"),t=(e.className="modal-scrollbar-measure",this.$body.append(e),e.offsetWidth-e.clientWidth);return this.$body[0].removeChild(e),t},h=u.fn.modal,u.fn.modal=C,u.fn.modal.Constructor=x,u.fn.modal.noConflict=function(){return u.fn.modal=h,this},u(document).on("click.bs.modal.data-api",'[data-toggle="modal"]',function(e){var t=u(this),n=t.attr("href"),i=u(t.attr("data-target")||n&&n.replace(/.*(?=#[^\s]+$)/,"")),n=i.data("bs.modal")?"toggle":u.extend({remote:!/#/.test(n)&&n},i.data(),t.data());t.is("a")&&e.preventDefault(),i.one("show.bs.modal",function(e){e.isDefaultPrevented()||i.one("hidden.bs.modal",function(){t.is(":visible")&&t.trigger("focus")})}),C.call(i,n,this)}),p=jQuery,F.VERSION="3.2.0",F.prototype.show=function(){var e,t,n=this.element,i=n.closest("ul:not(.dropdown-menu)"),r=(r=n.data("target"))||(r=n.attr("href"))&&r.replace(/.*(?=#[^\s]*$)/,"");n.parent("li").hasClass("active")||(e=i.find(".active:last a")[0],t=p.Event("show.bs.tab",{relatedTarget:e}),n.trigger(t),t.isDefaultPrevented())||(t=p(r),this.activate(n.closest("li"),i),this.activate(t,t.parent(),function(){n.trigger({type:"shown.bs.tab",relatedTarget:e})}))},F.prototype.activate=function(e,t,n){var i=t.find("> .active"),r=n&&p.support.transition&&i.hasClass("fade");function o(){i.removeClass("active").find("> .dropdown-menu > .active").removeClass("active"),e.addClass("active"),r?(e[0].offsetWidth,e.addClass("in")):e.removeClass("fade"),e.parent(".dropdown-menu")&&e.closest("li.dropdown").addClass("active"),n&&n()}r?i.one("bsTransitionEnd",o).emulateTransitionEnd(150):o(),i.removeClass("in")},f=p.fn.tab,p.fn.tab=S,p.fn.tab.Constructor=F,p.fn.tab.noConflict=function(){return p.fn.tab=f,this},p(document).on("click.bs.tab.data-api",'[data-toggle="tab"], [data-toggle="pill"]',function(e){e.preventDefault(),S.call(p(this),"show")})}),$__System.registerDynamic("10",["11"],!0,function(e,t,n){"use strict";this||self;var o,a=e("11"),s=window.bridge,r=null;window.reqnode&&(o=reqnode("electron"),r=o.ipcRenderer);var i=null,l={clipboard:{readText:function(){return window.reqnode?o.clipboard.readText()||"":s?s.callSync("clipboard.readText"):void 0},writeForMac:function(e,t){return s.callHandler("clipboard.write",{data:e,shouldClear:!!t})},read:function(e,t){var i=t||{},r=e&&(e.clipboardData||e.dataTransfer);return r&&(i.html=r.getData("text/html"),i.markhtml=r.getData("text/markhtml"),i.text=r.getData("text/plain"),i.files=Array.from(r.files||[]).map(e=>e.path).filter(e=>!!e)),s?new Promise(function(n,e){s.callHandler("clipboard.read",{},function(e){var t;i.markhtml||(i.markhtml=e.markhtml),i.html=(e.html||[])[0]||i.html,i.baseUrlInClipboard=(e.html||[])[1]||"",i.remap=(e.html||[])[2],i.from=(e.html||[])[3],"Apple Notes"==i.from&&((t=$("<div>"+i.html+"</div>")).children("p").each(function(){"17px"==this.style.fontSize&&"B"==(this.children[0]||{}).tagName?($(this).find("b").replaceWith(function(){return this.innerHTML}),$(this).replaceWith("<h1>"+this.innerHTML+"</h1>")):"14px"==this.style.fontSize&&"B"==(this.children[0]||{}).tagName&&($(this).find("b").replaceWith(function(){return this.innerHTML}),$(this).replaceWith("<h2>"+this.innerHTML+"</h2>"))}),i.html=t.html()),!i.markhtml&&/^version:/i.exec((e.html||[])[0]||"")&&(i.html=i.html.replace(/^[^<]+/,""),i.fromFirefox=!0),i.text&&(r||i.html)||(i.text=e.text),i.files=e.files||[],n(i)})}):(File.isWin&&!i.html&&(t=(t=(o.clipboard.readBuffer("FileNameW")||new Uint8Array).toString("ucs2")).replace(new RegExp(String.fromCharCode(0),"g"),""))&&(i.files=[t]),Promise.resolve(i))},readImage:function(){var t=File.editor.imgEdit;return new Promise((n,e)=>{var i,r=t.getTargetImageStorageFolder();s?s.callHandler("clipboard.readImage",{imageStorageFolder:r,silent:r==t.getTargetImageStorageFolderFromSetting()},n):window.reqnode&&(i=o.clipboard.readImage())&&!i.isEmpty()?(r&&"upload"!=r||(r=_options.userDataPath+"/typora-user-images"),t.prepImageMove(r).then(async function(){var t=reqnode("path").join(r,"image-"+a.dateToNumberString(new Date)+".png");reqnode("fs").writeFile(t,i.toPNG(),e=>{n(e?null:[t])})},()=>{})):n(null)})}},menu:{update:function(e,t){var n;e&&(t&&"string"==typeof e&&(n=e,(e={})[n]=t),File.isNode?r.send("menu.updateMenu",JSON.stringify(e)):s&&s.callHandler("menu.updateMenu",e))}},zoom:{zoomIn:function(){window.reqnode?(ClientCommand.execForAll(function(){ClientCommand.zoomIn()}),ClientCommand.refreshViewMenu()):s&&s.callHandler("window.zoomIn")},zoomOut:function(){window.reqnode?(ClientCommand.execForAll(function(){ClientCommand.zoomOut()}),ClientCommand.refreshViewMenu()):s&&s.callHandler("window.zoomOut")},resetZoom:function(){window.reqnode?(ClientCommand.execForAll(function(){ClientCommand.resetZoom()}),ClientCommand.refreshViewMenu()):s&&s.callHandler("window.resetZoom")},setZoom:function(e){window.reqnode&&reqnode("electron").webFrame.setZoomFactor(e||1)}},invoke:function(n,...i){return s?new Promise((e,t)=>{s.callHandler(n,i[0],e)}):r?"function"==typeof(i=i||[])[i.length-1]?r.invoke.apply(null,[n].concat(i.slice(0,-1))).then(i[i.length-1]):r.invoke.apply(null,[n].concat(i)):Promise.resolve()},sendIPC:function(e,t){r&&r.send(e,t)},putSetting:function(e,t){s?s.callHandler("setting.put",{key:e,value:t}):l.invoke("setting.put",e,t)},execForAll:function(e){window.reqnode?ClientCommand.execForAll(e):s&&s.callHandler("window.execForAll",e)},showInFinder:function(e){e&&(File.isMac?s.callHandler("path.showInFinder",e):e&&l.invoke("shell.showItemInFolder",e))},openFolder:function(e){e&&(File.isMac?s.callHandler("path.openFolderInFinder",e):l.invoke("shell.openItem",e))},openFile:function(e){e&&(File.isMac?s.callHandler("path.openFile",e):l.invoke("shell.openItem",e))},showInBrowser:function(e){File.isMac?s.callHandler("path.openURL",e):e&&l.invoke("shell.openExternal",e)},selectFile:function(e,t,n){File.isNode?l.invoke("dialog.showOpenDialog",{defaultPath:e||void 0,filters:t,properties:["openFile","dontAddToRecent"]}).then(({filePaths:e})=>{n((e||[null])[0]||null)}):File.isMac&&s.callHandler("path.selectFolderOrFile",{dir:!1,defaultPath:e,filters:t?t.map(e=>e.extensions):null},e=>{n(e)})},fsCaseInsensitive:function(){return i=null===i&&(File.isNode&&(i=File.isWin||reqnode("fs-plus").isCaseInsensitive),File.isMac)?!0:i}};window.JSBridge=l,t.JSBridge=l}),$__System.registerDynamic("12",["13","11"],!0,function(e,t,n){this||self;var i=e("13"),G=i.Node,r=i.NodeMap,Q=i.TYPE,X=e("11"),Z="",ee=/\uE027/gi,o=["-","+","*"],te=(G.UL_DEFAULT_START=o,G.prototype.toMark=function(){var e=ne.call(this);return e instanceof Array?e.join(File.useCRLF?"\r\n":"\n").replace(ee,""):e},function(e,t){return"right"==e?"-".repeat(t-1)+":":"center"==e?":"+"-".repeat(t-2)+":":"left"==e?":"+"-".repeat(t-1):"-".repeat(t)}),ne=function(){var e,t,n,i,r=[];function o(e){return e.get("children").length?se(e.get("children")):(e.get("text")?e.get("text"):"").replace(/(\u200B*):(\u200B*)/g,":").replace(/\u200B\$/g,"$")}function a(e,t){l(e,t.get("ahead")||0)}function R(e){if(!e.get("after")&&!e.get("parent")&&e.get("type")==Q.paragraph&&File&&File.editor){var t=File.editor.findElemById(e.cid);if(t&&t.hasClass("unholdable")&&!e.get("text").length)return 1}}function s(e,t,n){void 0===n&&(n=!t.get("after")||R(t.get("after"))?0:1),l(e,null==t.get("tail")?n:t.get("tail"))}function l(e,t){for(var n=0;n<t;n++)e.push("")}function c(e){return G.isType(e.get("parent"),Q.list_item)&&!1!==e.get("parent").get("tight")}function O(e,t){var n,i,r=-1,o="",a=this.get("alignText");for(this.set("align",this.get("align")||[]),_=0;_<e.length;_++)L=this.get("align")[_],a?((n=a[_])?(o+=n,r=_):-1<r?(n=a[r],i=this.get("align")[r]," "!=n[0]||" "===n[n.length-1]||i&&"center"!=i||(a[r]=n+" ",o+=" "),o+=G.adjustAlignText(this,r,L)):o+=((E=t.getNthChild(_)).get("marginLeft")||"")+te(L,4)+(E.get("marginRight")||""),o+="|"):o+=" "+te(L,e[_])+" |";return o}try{switch(this.get("type")){case Q.meta_block:return r.push("---"),(r=r.concat((this.get("text")||Z).replace(/^---/gm,"​---").split(/\r*\n/))).push(this.get("patternEnd")||"---"),s(r,this),r;case Q.heading:return a(r,this),n=o(this),this.get("pattern")?(n=X.escapeStringReplace(n),r=r.concat(this.get("pattern").replace("{0}",n).split(/\r*\n/))):!G.isType(this.get("parent"),Q.list_item)&&(1==File.option.headingStyle||3==File.option.headingStyle)&&this.get("depth")<=2?(r.push(n),3==File.option.headingStyle?r.push((1==this.get("depth")?"=":"-").repeat(Math.max(1,X.wcswidth(this.get("text"))))):r.push(1==this.get("depth")?"===":"---")):(t="#".repeat(this.get("depth"))+" "+n,2==File.option.headingStyle&&(t+=" "+"#".repeat(this.get("depth"))),r.push(t)),s(r,this),r;case Q.paragraph:return R(this)||(a(r,this),n=o(this).split(/\r?\n/g).map(function(e){return e||Z}),r=/^( {4}|\t)/.exec(n[0])?r.concat(n.map(function(e){return e.replace(/^( {4}|\t)/,"​$1")})):r.concat(n),void 0===(i=this.get("tail"))&&this.get("after")&&G.isType(this.get("parent"),Q.list_item)&&(i=c(this)?0:void 0),G.isType(this.get("after"),Q.paragraph)&&i<1&&this.unset("tail"),void 0===(i=G.isType(this.get("after"),Q.math_block)&&!this.get("tail")?0:i)?s(r,this,i):l(r,i)),r;case Q.blockquote:return a(r,this),n=o(this),(m=ae(this.get("userIndent"),n))?n.map(function(e,t){n[t]=(m[t]||"")+e}):(this.unset("userIndent"),f=oe(Q.blockquote,0,this,this.get("pattern")),n.map(function(e,t){n[t]=e?f+e:f.replace(/\s+$/,"")})),s(r=r.concat(n),this),""!==r.last()&&G.isType(this.get("after"),Q.blockquote)&&r.push(""),r;case Q.list:a(r,this);var d=this.get("style"),I=this.isLoose(),$=this.get("children").length,u=this;if($)for(var h=this.getFirstChild(),H=Number.isNaN(Number.parseInt(this.get("start")))?0:Number.parseInt(this.get("start"))-1,p=0;h;){h.set("tight",!I),n=ne.call(h),e=this.get("pattern"),I&&e&&h.get("markindent")&&(e=re(d,e.trim(),h.get("markindent")));var f,m,g,U=Math.min(h.get("prespace")||0,3),j=void 0===this.get("isFixed")&&File.option.olStyle||this.get("isFixed"),y=(f=" ".repeat(U)+oe(d,(j?0:p)+H,h,e,($+"").length)).length,q=d==G.ListType.ol?(p+H+"").length-1:0,W=(y=h.get("subindent")?Math.min(f.replace(/\s+$/,"").length+4,h.get("subindent")+q):u.get("subindent")?Math.min(f.replace(/\s+$/,"").length+4,u.get("subindent")+q):File.option.indentByTab?0:Math.max(y,File.option.indentSize))?" ".repeat(y):"\t";(m=ae(h.get("userIndent"),n,!0))?(h.get("style")==G.ListType.task&&(m[0].trim().length&&-1==m[0].indexOf("[")&&(m[0]=m[0]+"[ ] "),h.get("checked")?m[0]=m[0].replace("[ ]","[x]"):m[0]=m[0].replace(/\[x\]/i,"[ ]")),n.map(function(e,t){n[t]=m[t]+e,r.push(n[t].replace(ee,""))})):(h.unset("userIndent"),g=f,h.get("style")==G.ListType.task&&(g=f+(h.get("checked")?"[x] ":"[ ] ")),n.map(function(e,t){n[t]=(t?e?W:"":g)+n[t],r.push(n[t].replace(ee,""))})),p++,h=h.get("after")}return G.isType(this.get("after"),Q.list)&&(!this.get("tail")||this.get("tail"))<1&&this.get("pattern")==this.get("after").get("pattern")&&this.get("style")==this.get("after").get("style")&&(this.unset("tail"),r.push(""),c(this))&&r.push(""),s(r,this,c(this)?0:function(e){var t=u.get("tail"),n=u.get("after");if(0===t){if(G.isType(n,Q.paragraph))return void e.unset("tail");if(G.isType(n,Q.fences)&&/^\s+$/.exec(n.get("pattern")||""))return void e.unset("tail")}return t}(this)),r;case Q.list_item:for("string"==typeof(n=o(this))&&(n=[n]),r=r.concat(n),0<(i=null==(i=this.get("tail"))&&!this.get("tight")&&this.get("after")?1:i)&&r.push("");2<r.length&&""===r.last()&&""===r[r.length-2];)r.pop();return r;case Q.fences:a(r,this);var v,z=this.getText(),b=(n=z.split(/\r*\n/),!0===this.get("empty")&&(n=[]),(e=this.get("lang")?(this.get("pattern")||"").trim()?this.get("pattern"):(this.unset("pattern"),/^\s*```/gm.exec(this.get("text")||"")?"~~~{0}":"```{0}"):this.get("pattern")||"```{0}").replace(/\s*\{0\}/,"")),w=b.trim().length,x=(this.get("pattern")&&(b=this.get("patternEnd")||b),0),C=e.match(/^\s+$/),F=(e.match(/[`~]/)||[])[0];F&&(v=new RegExp(`^(${F}{${w},})s*$`));for(var V,p=0;p<n.length;p++)v&&(V=v.exec(n[p]))&&V[1]&&(x=Math.max(x+w,V[1].length+1)-w),n[p]=(C?e:"")+n[p],n[p]=n[p]||Z,this.get("userIndent")&&(n[p]=this.get("userIndent")+n[p]);return C||(x&&(e=F.repeat(x+w)+"{0}",b=F.repeat(x+w)),r.push(e.replace(/\{0\}/,this.get("lang")||""))),r=r.concat(n),C||this.get("noCloseTag")||r.push(b),s(r,this),r;case Q.math_block:return a(r,this),this.get("tagBefore")?r.push("$$ {"+this.get("tagBefore")+"}"):r.push("$$"),r=r.concat(this.get("text").replace(/(^\n)|(\n$)/g,"").split(/\r?\n/).map(function(e){return e||Z})),this.get("tagAfter")?r.push("$$ {"+this.get("tagAfter")+"}"):r.push("$$"),s(r,this,G.isType(this.get("after"),Q.paragraph)&&G.isType(this.get("before"),Q.paragraph)?0:void 0),r;case Q.hr:return a(r,this),r.push(this.get("pattern")||"------"),s(r,this),r;case Q.def_footnote:return a(r,this),r.push("[^"+this.get("ref")+"]:"+X.orDefault(this.get("pattern")," ")+o(this)),s(r,this,!this.get("after")||G.isType(this.get("after"),G.TYPE.def_footnote)?0:1),r;case Q.def_link:a(r,this);var S,k,J=this.safeGetStrAttr("title").length;return this.get("pattern")?(k=(S=this.get("pattern").split(";"))[0]+this.get("ref")+S[1]+this.safeGetStrAttr("href")+S[2],J&&(k+=(S[3]||"\t")+(S[4]||'"')+this.get("title")+(S[5]||'"'))):k="["+this.get("ref")+"]: "+this.safeGetStrAttr("href")+(J?'\t"'+this.get("title")+'"':""),r.push(k),s(r,this,!this.get("after")||G.isType(this.get("after"),G.TYPE.def_link)?0:1),r;case Q.table:if(a(r,this),this.get("userText"))s(r=r.concat(this.get("userText").clone()),this);else{for(var E,T,_,A,M,L,K,N=[],D=[],P=0,B=this.getFirstChild();B;){for(T=B.getFirstChild(),D[P]=[],_=0;T;)D[P][_]=T.toMark().trim(),T=T.get("after"),0===P&&(N[_]=4),N[_]=Math.max(X.wcswidth(D[P][_]),N[_]),N[_]=Math.min(N[_],60),isNaN(N[_])&&(N[_]=0),_++;B=B.get("after"),P++}var Y="npTable"==this.get("style")&&1<N.length;for(this.set("align",this.get("align")||[]),B=this.getFirstChild(),P=0;P<D.length;P++){for(A="|",E=B.getFirstChild(),_=0;_<N.length&&(A=void 0!==E.get("marginLeft")?A+(E.get("marginLeft")+D[P][_]+E.get("marginRight"))+"|":(A+=" ",M=Math.max(N[_]-X.wcswidth(D[P][_]),0),A+("right"==(L=this.get("align")[_])?" ".repeat(M)+D[P][_]:"center"==L?" ".repeat(K=~~(M/2))+D[P][_]+" ".repeat(M-K):D[P][_]+" ".repeat(M))+" |"),E=E.get("after"));_++);Y?"|"==(A=A.replace(/(^\s*\|)|(\|\s*$)/g,"")).trim()&&(A="|"+A):A=A.replace(/\s$/,""),r.push(A),0===P&&(A="|"+O.call(this,N,B),Y?r.push(A.replace(/(^\s*\|)|(\|\s*$)/g,"")):r.push(A.replace(/\s$/,""))),B=B.get("after")}s(r,this)}return r;case Q.table_row:return console.sendError("cannot call toMark on table_row"),"";case Q.table_cell:return ie(o(this));case Q.toc:return a(r,this),r.push(this.get("pattern")||"[TOC]"),~(this.get("pattern")||"").indexOf("\n")&&this.get("after")?s(r,this,2):s(r,this),r;case Q.html_block:return a(r,this),s(r=r.concat(this.get("text").replace(/(^\n)|(\n$)/g,"").split(/\r?\n/).map(function(e){return e||Z})),this),r;default:return o(this)}}catch(e){return console.error(e.stack),r}},ie=function(e){var t=[],n=0,i=0;return e=e.replace(/(^|[^\\])`[^`]*\|[^`]*`/g,function(e){return t.push(e),["",++n-1,""].join("")}),(e=File.option.enableInlineMath?e.replace(/(^|[^\\])\$[^$]*\|[^$]*\$/g,function(e){return t.push(e),["",++n-1,""].join("")}):e).replace(/\|/g,"\\|").replace(/\\\\\|/g,"\\|").replace(/\uE07A[^\uE07B]+\uE07B/g,function(){return t[++i-1]})},re=function(e,t,n){var i=File.option.prettyIndent;return n=void 0!==n?+n:Math.max(+File.option.indentSize,2),e==Q.blockquote?">"+" ".repeat(Math.min(n-1,i?4:1)):e===G.ListType.ol?"{0}."+" ".repeat(Math.min(n-2,i?4:1)||1):e===G.ListType.ul?(t||o[File.option.ulStyle])+" ".repeat(Math.min(n-1,i?4:1)):o[File.option.ulStyle]+" "},oe=function(e,t,n,i){var r=File.option.indentSize;return t++,i=i||re(e),$.isNumeric(r),e!=Q.blockquote&&e===G.ListType.ol?i.replace("{0}",t):i},ae=(G.getIndentPrefix=oe,G.getDefaultPrefixPattern=re,G.markFromArr=function(e){e=se(e);return e instanceof Array?e.join(File.useCRLF?"\r\n":"\n").replace(ee,""):e},function(e,n,t){var i=n.length;if(!e||!i)return null;if(1==i)return 1==e.length?e:null;var r,o=null;if(e.length<i){if(!(r=e.last()||e[1]||"").length||r.trim().length)return null;o=e.concat(new Array(i-e.length).fill(r))}else o=e.length>i?e.slice(0,i):e;if(o&&t&&((r=o.last()||o[1]||"").length&&!r.trim().length))return o.map((e,t)=>n[t].length?e||r:e);return o}),se=function(e){var t=[],n="";function i(e){e=ne.call(e);e instanceof Array?t=t.concat(e):n+=e}if(e.length)if(e instanceof Array)e.map(function(e){i(e)});else for(var r=e.sortedFirst();i(r),r=r.get("after"););return t.length?t:n};r.prototype.toMark=function(){if(0<this.blocks.length){var e=(e=this.blocks.sortedFirst()).getFirstBrother(),t=[],n="";do{var i=ne.call(e)}while(i instanceof Array?t=t.concat(i):n+=i,e=e.get("after"));return t.length?t.join(File.useCRLF?"\r\n":"\n").replace(ee,""):n}return""},G.getIndentPrefix=oe}),$__System.registerDynamic("14",["13","11","15","16","17","18","19"],!0,function(e,t,n){this||self;var g=e("13"),y=g.Node,v=(g.NodeMap,g.TYPE),b=(g.NodeCollectionUtils,e("11")),w=(e("15"),e("16"),e("17")),x=e("18"),C=e("19"),F=document.querySelector("#md-rawblock-tooltip-templ").innerHTML;y.prototype.toHTML=function(n,i,r){r=r||{};var e=["h1","h2","h3","h4","h5","h6"];function t(e){var t=e.get("children");return null!=n?n:t&&0<t.length?g.NodeCollectionUtils.toHTML(t,r):(t=e.safeGetStrAttr("text"),y.isType(e,v.paragraph)&&/^\u200b( {4}|\t)/g.exec(t)&&(t=t.replace(/^\u200b( {4}|\t)/g,"$1"),e.set("text",t)),e.cursorDiff=[],y.isType(e,v.paragraph)&&r.focus===e.id?C.brushContent(e.safeGetStrAttr("text"),new C.InlineLexer,!1,e,e.cursorDiff,[]):C.parseInline(e.safeGetStrAttr("text"),{attr:!y.isType(e,v.heading),alert:y.isType(e,v.paragraph)&&y.isType(e.get("parent"),v.blockquote)&&e.get("parent").get("alert")&&!e.get("before")},e.cursorDiff))}function o(e){var t=function(e){try{return y.isType(e,v.fences,v.hr,v.def_link,v.def_footnote,v.table,v.math_block)?!1:(!y.isType(e,v.list_item)||e.get("style")!=y.ListType.task)&&(e.canContainBlock()||e.isDeleted()?void 0:File.inBusyMode?0==e.get("children").length||void 0:0==e.get("children").length||y.isType(e.get("parent"),v.list_item)||void 0)}catch(e){}}(e),t=t?" contenteditable='true' ":!1===t?" contenteditable='false' ":"",n=i?"mdlike='"+i+"' ":" ",t=" cid = '"+e.id+"' mdtype = '"+e.get("type")+"' "+t+n;return 1e4<(e.get("text")||"").length&&(t+=" spellcheck='false' "),t}switch(File.option.expandSimpleBlock&&y.isType(this,v.paragraph)&&(-1<e.indexOf(i)?this.set("depth",e.indexOf(i)+1):this.unset("depth")),this.get("type")){case v.meta_block:var a=this.get("text")||"";return a.match(/^\n/g)&&(a=a.replace(/^\n/g,"\n\n")),"<pre "+o(this)+" class='md-meta-block md-end-block' >"+b.escape(a,!1,!0)+"\n</pre>";case v.paragraph:return"<p "+o(this)+" class='md-end-block md-p'>"+t(this)+"</p>";case v.raw_edit:return"<p class='rawedit' contenteditable ='true' spellcheck='false' "+o(this)+">"+this.safeGetStrAttr("text",!0)+"</p>";case v.heading:return"<h"+this.get("depth")+o(this)+"class='md-end-block md-heading' >"+t(this)+"</h"+this.get("depth")+">";case v.blockquote:return y.isType(this.get("alert"),"note","warning","important","tip","caution")?`<div class="md-alert md-alert-${this.get("alert")}" `+o(this)+">"+t(this)+"</div>":"<blockquote "+o(this)+" >"+t(this)+"</blockquote>";case v.list:var a=this.get("style"),s=" data-mark='"+((this.get("pattern")||y.UL_DEFAULT_START[File.option.ulStyle]||"-").match(/[*+-]/)||[])[0]+"' ";return a==y.ListType.ol?(a=""===this.get("start")?void 0:+this.get("start"),"<ol class='ol-list' "+(a=Number.isNaN(a)||1==a?"":"start='"+this.get("start")+"' ")+o(this)+" >"+t(this)+"</ol>"):"<ul class='ul-list' "+o(this)+s+" >"+t(this)+"</ul>";case v.list_item:return this.get("parent")&&this.get("style")===y.ListType.task?"<li class='md-list-item task-list-item  md-task-list-item task-list-"+(this.get("checked")?"done":"not-done")+" ' "+o(this)+"><input type='checkbox' "+(this.get("checked")?"checked":"")+"></input>"+t(this)+"</li>":"<li class='md-list-item' "+o(this)+" >"+t(this)+"</li>";case v.fences:return x.renderFences(this);case v.hr:return"<div tabindex='-1' contenteditable='false' "+o(this)+" class='md-hr md-end-block' ><hr /></div>";case v.def_footnote:return"<div class='footnotes md-def-footnote md-end-block' contenteditable='false'"+o(this)+"><span class='md-def-name' contenteditable='true'>"+b.escape(this.get("ref")?this.get("ref"):"​")+"</span><span class='md-def-split md-def-f' contenteditable='false' >&nbsp;</span><span class='md-def-content' contenteditable='true'>"+t(this)+"</span></div>";case v.def_link:return"<div class='footnotes md-def-link md-end-block' contenteditable='false'"+o(this)+"><span class='md-def-name' contenteditable='true'>"+b.escape(this.get("ref")?this.get("ref"):"​")+"</span><span class='md-def-split md-def-f' contenteditable='false' >&nbsp;</span><span class='md-def-content md-def-url md-auto-disp' href='#' contenteditable='true'>"+b.escape(this.get("href"))+"</span><span class='md-def-split md-auto-hide' contenteditable='false'>&nbsp;</span><span class='md-def-title md-auto-disp md-auto-hide' contenteditable='true'>"+b.escape(this.get("title"))+"</span></div>";case v.table:for(var l="<figure class='md-table-fig table-figure' contenteditable='false' "+o(this)+"><table class='md-table'>",c=this.getFirstChild();c;)c.get("before")?l+=c.toHTML():l+="<thead>"+c.toHTML()+"</thead><tbody>",(c=c.get("after"))||(l+="</tbody>");return l+="</table></figure>";case v.table_row:var d,l="<tr class='md-end-block' "+o(this)+">",c=this.getFirstChild(),u=this.get("parent").get("align")||[],h=0,p=this.get("before")?"td":"th";for(this.get("parent").get("align")||this.get("parent").set("align",[]);c;)l+="<"+p+((d=u[h])?" style='text-align:"+d+";' ":"")+">"+c.toHTML()+"</"+p+">",c=c.get("after"),h++;return l+="</tr>";case v.table_cell:return"<span contenteditable='true' class='td-span' "+o(this)+">"+t(this)+"</span>";case v.math_block:var f,m,a="",s=File.editor&&File.editor.mathBlock;return s&&s.cache[this.get("text")]?(f=s.cache[this.get("text")],s.cache[this.get("text")]=void 0,m=`<div class='md-rawblock-container md-math-container math-jax-postprocess' tabindex='-1'>${f.inner}</div>`,a=f.attr):r.mathCount<8&&s&&!File.option.autoNumberingForMath&&s.isMathJaxReady()?(r.mathCount++,m=`<div class='md-rawblock-container md-math-container math-jax-postprocess' tabindex='-1'>${(f=s.renderTex(this.get("text"),{},!0)).dom.outerHTML}</div>`,a=`data-math-tag-before="${f.mathTagBefore}" data-math-tag-after="${f.mathTagAfter}" data-math-labels="${b.escape(f.mathLabels)}"`):m="<div class='md-rawblock-container md-math-container math-jax-preprocess' tabindex='-1'>$$<br/>"+b.escape(this.get("text"))+"<br/>$$</div>","<div contenteditable='false' spellcheck='false' class='mathjax-block md-end-block md-math-block md-rawblock' id='mathjax-"+this.cid+"' "+o(this)+` ${a}>`+F.replace("{type}",$.localize.getString("Math","Menu"))+m+"</div>";case v.toc:return s=this.get("in"),"<div contenteditable='false' spellcheck='false' tabindex='-1' class='md-toc md-end-block' "+o(this)+"><div class='md-tooltip-hide md-toc-tooltip'><span>"+$.localize.getString("Table of Contents")+"</span> <button type='button' class='btn md-delete-toc'><span class='ty-icon ty-delete'></span></button></div><p class='md-toc-content' role='list'>"+(s.toc?s.toc.getTocInnerHTML():"")+"</p></div>";case v.html_block:return-1<w.HIDDEN_TYPE.indexOf(this.get("displayStyle")||this.get("style"))&&!w.checkIsWhiteList(this)?"<div contenteditable='false' spellcheck='false' class='md-htmlblock md-rawblock md-end-block' "+o(this)+">"+F.replace("{type}","HTML")+"<div class='md-htmlblock-panel md-rawblock-control' style='display:none;' contenteditable='false'></div><div class='md-htmlblock-container md-rawblock-container md-raw-html-src' contenteditable='false'><div class='md-raw-html-src-content'>"+b.escape(this.get("text"))+"</div></div></div>":"<div contenteditable='false' spellcheck='false' class='md-htmlblock md-rawblock md-end-block' "+o(this)+"><span style='position:absolute;'>​</span>"+F.replace("{type}","HTML")+"<div class='md-htmlblock-panel md-rawblock-control' style='display:none;' contenteditable='false;'></div><div class='md-htmlblock-container md-rawblock-container' tabindex='-1' contenteditable='false'>"+w.buildHTML(this)+"</div><span style='position:absolute;'>​</span></div>";default:return"<p "+o(this)+">unknow type: "+this.get("type")+"</p>"}}}),$__System.registerDynamic("1a",["13","11","1b","15","1c","1d","1e"],!0,function(e,t,n){"use strict";this||self;var r=e("13"),w=r.Node,x=r.TYPE,l=(r.NodeCollectionUtils,e("11")),C=e("1b"),u=e("15"),h=e("1c"),m=e("1d"),g=e("1e"),o=(w.normalizeNode=function(e){0==e.get("children").length&&(w.isType(e,x.blockquote)||w.isType(e,x.list_item))&&e.appendChild(new w({type:x.paragraph}))},function(e,t){try{var n,i=!t.isDeleted()&&t.get("parent"),i=w.isType(i,x.list_item)&&i.get("parent"),r=w.isType(i,x.list)&&i.get("style");!r||(n=e.get("text")).match(/^(\s{2, }|\t)/)||(r==w.ListType.ol?n=n.replace(/^\s*\d+(\.|\))\s+/,""):r==w.ListType.ul&&(n=n.replace(/^\s*[+*-]\s+/,"")),e.set("text",n))}catch(e){}}),y=(w.genNormalSplitExitFunc=function(e,i,r){return function(e,t){var n={prev:e,next:t};return e.get("type")==x.paragraph&&(r||e.parseFrom({skips:{enableStartMatch:!0}}),w.isType(e,x.paragraph)||(n.oldCid=e.cid,n.prev=e)),t.get("type")==x.paragraph&&(i||o(t,e),r||t.parseFrom(),w.isType(t,x.paragraph)||(n.next=t)),n}},w.prototype.breakOn=function(r,d,u){var o,a,s,e,t,n,i,l,c;return w.isType(this,x.table,x.table_row,x.table_cell,x.blockquote,x.list,x.list_item)?null:(o=d.selection.buildUndo(),a=w.isType(this,x.def_footnote)?(e=d.getJQueryElem(window.getSelection().baseNode)).closest(".md-def-name").length?d.selection.getOffset(e.closest(".md-def-name")):this.get("ref").length+1+d.selection.getOffset(e.closest(".md-def-content")):((e=d.findElemById(this.id)).find(".md-emoji-control-ch, .md-ruby-container").remove(),e.find(".md-math-after-sym").text(""),d.selection.getOffset(e)),this.get("children").length||(s=this.getText(!1).length,w.isType(this,x.def_link,x.def_footnote)&&(s+=this.get("ref").length+1),this.get("children").length)?void 0:m(this.getClosetBlock())||f(this)||(a=Math.min(s,a),e=this,t=a,n=n||C.makeEmptyCommand(),i={},l=t==s&&0<t,c=e.getClosetBlock(),n.undo.push(o),w.isType(c.get("parent"),x.list_item)&&!r?n.undo.push(C.buildReplaceUndo(c.get("parent"))):n.undo.push(C.buildReplaceUndo(c)),c.unset("ahead"),c.unset("tail"),u&&w.isType(e,x.paragraph)?h(e,t,n,l):(i=w.splitAt(e,t,d,r))?(i.undo&&(n.undo.push(i.undo),n.redo.push(i.redo)),n.redo.push(d.undo.buildReplaceUndo(i.prev)),i.prev&&i.prev.contains(e)||n.redo.push(d.undo.buildReplaceUndo(e)),e=i.insertArray[0]?i.insertArray[0].get("before"):e,i.oldCid=e.cid,C.addUndoForInsertArray(n,i.insertArray),i.newHtml=e.toHTML()+i.insertArray.map(function(e){return e.toHTML()}).join(""),p(i,l),n.redo.push({type:"cursor",id:i.nextFocus,start:0}),i.command=n,i):void 0));function h(e,t,n,i){var r,o,a,s,l,c;if(u&&w.isType(e,x.paragraph))return"\n"==(r=e.get("text")||"")[t]?u=!1:"\n"==r[t-1]&&(u=!1,t--),n.undo.push(C.buildReplaceUndo(e)),e.set("text",r.substring(0,t)),u?(c=w.smartSplit(d.findElemById(e.id),t),e.set("text",c[0]),1==(a=e.parseFrom({skips:{enableStartMatch:!0}},void 0,!0))[1].length&&w.isType(a[1][0],x.paragraph)?(e.set("text",c[0]+"\n"+c[1]),n.redo.push(C.buildReplaceUndo(e)),o={type:"cursor",id:e.id,start:c[0].length+1},n.redo.push(o),{oldCid:e.cid,nextFocus:e.cid,prev:e,newHtml:e.toHTML(),command:n,cursor:o}):(n.redo.push(C.buildReplaceUndo(e)),l=(s=(a=a[1]).last()).getVeryFirst(!0).getClosetBlock(),w.isType(l,x.paragraph)?(o={type:"cursor",id:l.id,start:l.get("text").length+1},l.set("text",l.get("text")+"\n"+c[1])):(o={type:"cursor",id:(l=new w({type:x.paragraph,text:c[1]})).id,start:0},a.last().addAfter(l),a.push(l)),C.addUndoForInsertArray(n,a.subarray(1)),c={oldCid:e.cid,nextFocus:l.cid,prev:s,next:s.get("after"),newHtml:a.map(function(e){return e.toHTML()}).join(""),command:n,cursor:o},0==o.start?(c.cursor=void 0,p(c,i),n.redo.push({type:"cursor",id:c.nextFocus,start:0})):n.redo.push(o),c)):(n.redo.push(C.buildReplaceUndo(e)),l=e,s=n,a=r.substring(t+1),a=new w({type:x.paragraph,text:a,in:l.get("in")}),l.addAfter(a),C.addUndoForInsert(s,a),{oldCid:l.cid,prev:l,next:a,command:s,nextFocus:a.cid,newHtml:l.toHTML()+a.toHTML()})}function p(e,t){var n=t||w.isType(e.next,x.paragraph)&&!(e.next.get("text")||"").trim().length;w.isType(e.prev,x.meta_block)&&n&&e.prev.get("text").match(/\n$/)?e.nextFocus=e.next.getVeryFirst().id:n&&w.isType(e.prev&&e.prev.getLastChild()||e.prev,x.math_block,x.fences,x.meta_block,x.html_block)?(n=e.prev.getVeryFirst(!0),!w.isType(n,x.html_block)||/\n/.exec(n.get("text"))||n.get("depth")?e.nextFocus=n.id:e.nextFocus=e.next.getVeryFirst().cid):t&&w.isType(e.prev,x.table)?e.nextFocus=e.prev.getLastChild().getVeryFirst().cid:e.nextFocus=e.next.getVeryFirst().cid}function f(e){var t;if(a==s&&e==d.nodeMap.getFirst()&&w.isType(e,x.paragraph)&&(t=e.get("text"),File.shouldRemapPunctuation()?"---"==(t||"").replace(/\u2013/g,"--").replace(/\u2014/g,"---"):"---"==t))return(t=d.stylize.insertMetaBlock(!0)).command.undo.push(C.buildReplaceUndo(e)),e.set("text",""),t.command.redo.push(C.buildReplaceUndo(e)),t.newHtml=t.node.toHTML()+e.toHTML(),t.nextFocus=t.node.id,t.oldCid=e.id,t}function m(e){if(e=e.getClosetBlock(),s<=1&&w.isType(e,x.def_footnote,x.def_footnote)&&!r&&!u&&w.isEmptyBlock(e,null,!0))return(i=C.makeEmptyCommand(o)).undo.push(C.buildReplaceUndo(e)),e.unset("ahead"),e.unset("tail"),e.set("type",x.paragraph),i.redo.push(C.buildReplaceUndo(e)),i.redo.push({type:"cursor",id:e.getLastChild().cid,start:0}),{command:i,nextFocus:e.getLastChild().cid,oldCid:e.cid,newHtml:e.toHTML()};var t,n=s;if((s&&(n=e.getText(!1).trim().length),0==a&&0==n&&!r&&!u)&&(e.closest(x.blockquote,x.list)&&e.get("parent")&&e.get("parent").canContainBlock(!0)&&(e.get("parent").get("type")!=x.list_item||!e.get("after"))&&(t=(n=e).get("parent"),!w.isType(t,x.list_item)||n.get("before")||n.get("after")||t.get("before")||t.get("after")||!t.get("parent").get("attachTo")))){(i=C.makeEmptyCommand()).undo.push(o);var i,n={};if(n=w.upStream(e))return i.undo=i.undo.concat(n.command.undo),i.redo=i.redo.concat(n.command.redo),n.nextFocus=n.nextFocus||e.id,i.redo.push({type:"cursor",id:n.nextFocus,start:0}),n.command=i,n}}},w.isEmptyBlock=function(e,t,n){n=n?l.isNullOrBlank:l.isNullOrEmpty;if(!w.isType(e,t||[]))if(e.get("children").length){if(w.isType(e,x.paragraph))return n(e.get("text"))}else{if(w.isType(e,x.def_link))return n(e.get("ref"))&&n(e.get("href"))&&n(e.get("title"));if(w.isType(e,x.def_footnote))return n(e.get("ref"))&&n(e.get("text"));if(!w.isType(e,x.table_cell,x.table_row,x.hr,x.toc))return n(e.get("text"))}return!1},{link:"[",footnote:"[^",reflink:"["}),v={footnote:"]"};w.smartSplit=function(e,t,n){var i,r,o,a,s=m.createRange(),l=0;if(0==t)return["",e.rawText(),l];if(t==(e[0].textContent||e[0].innerText).length)return a=e.rawText(),[a=File.isMac&&File.option.smartQuote&&!File.option.convertSmartOnRender&&/["']$/.exec(a)&&1<a.length?a.replace(/["']$/,function(e){return g.userQuote("'"==e?3:1,!1,!0)}):a,""];n?(o=$.parseHTML("<span />")[0],e[0].appendChild(o),e.prepend("<span />"),s.moveToBookmark({containerNode:e[0],start:t,end:t}),s.setEndAfter(o),r=(o=s.extractContents()).querySelectorAll(".md-pair-s, .md-meta-i-c"),i=e[0].querySelectorAll(".md-pair-s, .md-meta-i-c")):(e[0].childElementCount<3&&(o=$.parseHTML("<span />")[0],e[0].insertBefore(o,e[0].firstChild),e.append("<span />")),s.moveToBookmark({containerNode:e[0],start:0,end:t}),o&&s.setStart(o,0),i=(o=s.extractContents()).querySelectorAll(".md-pair-s, .md-meta-i-c"),r=e[0].querySelectorAll(".md-pair-s, .md-meta-i-c"));for(var c=(e,t)=>{var n=document.createElement("SPAN"),e=e.children(t?".md-after":".md-before").rawText();return t?n.classList.add("md-before"):n.classList.add("md-after"),"<u>"==e?e="</u>":"</u>"==e?e="<u>":"<"==e?e=">":">"==e&&(e="<"),n.textContent=e,t&&(l+=e.length),n},d=[],u=0;u<i.length;u++)(h=$(i[u])).hasClass("md-meta-i-c")?h.find(":not(.md-meta-i)").text().length?h.children(".md-after.md-meta-i").text().length||h.append(v[h.attr("md-inline")]||""):d.push(i[u]):h.find(":not(.md-meta)").text().length?h.children(".md-after").text().length||h.append(c(h,!1)):d.push(i[u]);for(var h,p,u=0;u<r.length;u++)(h=$(r[u])).hasClass("md-meta-i-c")?h.find(":not(.md-meta-i)").text().length?h.children(".md-before.md-meta-i").text().length||(p=y[h.attr("md-inline")]||"",h.prepend(p),l+=p.length):d.push(r[u]):h.find(":not(.md-meta)").text().length?h.children(".md-before").text().length||h.prepend(c(h,!0)):d.push(r[u]);d.forEach(e=>{e&&(e.textContent="")});for(var f=o.querySelectorAll("svg"),u=0;u<f.length;u++)f[u].parentElement&&f[u].parentElement.removeChild(f[u]);return[$(o).rawText(),e.rawText(),l]};w.splitAt=function(e,t,n,i,r,o){var a;if(o=o||!r,w.isType(e,x.def_link,x.def_footnote))return p=t,v=(y=e).clone(),f=y.get("ref"),p<=f.length?(y.set("ref",f.substring(0,p)),v.set("ref",f.substring(p)),v.set("href",y.get("href")),v.set("title",y.get("title")),y.set("href",""),y.set("title",""),m="",g=y.get("text")):w.isType(y,x.def_link)?(d=y.get("href")||"",s=y.get("title")||"",p<=f.length+d.length?(y.set("title",""),v.set("ref",""),y.set("href",d.substring(0,p-f.length-1)),v.set("href",d.substring(p-f.length-1))):(v.set("ref",""),v.set("href",""),y.set("title",s.substring(0,p-f.length-d.length-1)),v.set("title",s.substring(p-f.length-d.length-1)))):(s=y.get("text")||"",v.set("ref",""),m=s.substring(0,p-f.length-1),g=s.substring(p-f.length-1)),y.set("text",m),w.isType(v,x.def_link)||v.set("text",g||""),w.isEmptyBlock(v)&&!w.isType(v,x.paragraph)&&(v.set("type",x.paragraph),v.set("text","")),y.addAfter(v),{oldCid:y.cid,prev:y,next:v,insertArray:[v]};var s,l,c,d=e.clone();if(e.get("children").length)return console.error("cannot do Node.split at this ndoe"),null;w.isType(e,x.paragraph,x.heading)?(b=(s=w.smartSplit(n.findElemById(e.id),t))[0].replace(/\n$/,""),c=!(h=s[1].replace(/^\n/,"")),l=s[2],w.isType(e.get("parent"),x.list_item)&&!o&&(a=C.buildReplaceUndo(e.get("parent").get("parent")),e.get("parent").get("parent").get("children").toArray().forEach(function(e){null==e.get("tail")?a=null:e.unset("tail")}))):(b=e.getText().substring(0,t),h=e.getText().substring(t)),e.set("text",b),d.set("text",h);var u,h,p=e,f=[p],m=[],g=(r||w.isType(e,x.paragraph)&&!r&&(m=(f=(u=e.parseFrom({skips:{enableStartMatch:!0}},void 0,!0))[1]).subarray(1),p=f.last().getVeryFirst().getClosetBlock()),p.addAfter(d),f.last()==p&&m.push(d),w.isEmptyBlock(d)?d.set("type",x.paragraph):!w.isEmptyBlock(p)||w.isType(p,x.math_block,x.fences)&&u||p.set("type",x.paragraph),{prev:p,next:d,insertArray:m,cursorDiff:l});if(!i){if(o&&w.isType(p.get("parent"),x.list_item)&&!p.get("before")){var y=p.get("parent"),v=y.get("parent"),n=!1,b=((n=v.get("style")==w.ListType.ol?v.getFirstChild().get("userIndent")!=v.getLastChild().get("userIndent"):n)&&!a&&(a=C.buildReplaceUndo(v)),y.clone());if(!y.get("after")&&y.get("before")&&y.set("tail",y.get("before").get("tail")),y.get("style")==w.ListType.task&&(0==t?y.set("checked",!1):c&&b.set("checked",!1)),y.addAfter(b),b.appendChildrenTillEnd(d),n){let e=v.getFirstChild();for(;e;)e.unset("userIndent"),e=e.get("after")}m=f.subarray(1),(f=f.last()==p?[y]:f).last()==y&&m.push(b),g={prev:y,next:b,insertArray:m,cursorDiff:l}}a&&g.prev&&(g.undo=a,h=g.prev.get("in").allNodes.get(a.id))&&(g.redo=C.buildReplaceUndo(h))}return g},w.genArrFrom=function(e,t){for(var n=[],i=e;i!=t;)n.push(i),i=i.get("after");return t&&n.push(t),n},w.getTreePosition=function(e,t){function n(e){return e.get("parent")?1+n(e.get("parent")):0}if(e==t)return[e,e,t];var i=n(e)-n(t);if(0<i)for(;0<i;)e=e.get("parent"),i--;else if(i<0)for(;i<0;)t=t.get("parent"),i++;return function e(t,n){return t==n?[t,t,n]:t.get("parent")==n.get("parent")||!t.get("parent")&&!t.get("parent")?[t.get("parent"),t,n]:e(t.get("parent"),n.get("parent"))}(e,t)},w.prototype.copyContentFrom=function(t,e){var e=e||w.property,n=this;e.map(function(e){n.set(e,t.get(e))}),this.get("after")&&this.set("noCloseTag",void 0)},w.prototype.clone=function(){var e=new w;return e.copyContentFrom(this),e.set("in",this.get("in")),e},w.reverseAttrFromElem=function(n,i,e,t){var r,o,a=i.attr("mdtype");switch(n.set("type",a),i.find("mjx-container").remove(),e&&(i.find("[data-emoji]").text(function(){return this.getAttribute("data-emoji")}),i.find(".md-meta, .md-content").remove(),i.find("sup, sub").text(function(){return" ("+this.textContent+")"})),File.option.convertSmartOnRender&&!document.body.contains(i[0])&&i.find("[md-inline='pants']").text(function(){return this.getAttribute("data-text")||this.textContent}),n.set("text",(!t&&w.isType(a,x.paragraph,x.def_footnote,x.heading)?(e=i,o=File.editor.imgEdit.getLocalRootUrlForInsert(),e.find("mjx-container").remove(),e.find("[md-inline='image'], [md-inline='imgtag']").each(function(){var e,t=$(this),n=t.attr("data-src");(o||File.bundle.filePath||"")==(t.attr("data-root")||"")||/^[a-z0-9\-]+:/i.exec(n)||(n=t.find("img").attr("src")||n||"",e=t.text(),t.find("img").length&&(n=File.editor.imgEdit.resolveImagePath(n.replace(/^file:\/\//,"").replace(/[#?]([^.]*)$/,""))),File.option.autoEscapeImageURL||(n=l.decodeFromEscapedPath(n)),e="image"==this.getAttribute("md-inline")?e.replace(/(\(<?)((?:\([^)]*\)|[^()])*?)(>?[ \t]*((['"])(.*?)\5[ \t]*)?\))/,"$1"+n+"$3"):e.replace(/(^<img(\s+.+)*?\s+src\s*=\s*)("([^"]+)"|'([^']+)')(.*?(\/?\s*>.*?(<\/img>)?))/,'$1"'+n+'"$6'),t.text(e))}),e):i).text()),["ahead","tail","prespace","markindent"].forEach(function(e){var t;i[0].hasAttribute(e)&&(t=+i.attr(e),isNaN(t)||n.set(e,t))}),["pattern","patternEnd"].forEach(function(e){i[0].hasAttribute(e)&&n.set(e,i.attr(e))}),["isFixed"].forEach(function(e){i[0].hasAttribute(e)&&n.set(e,"true"==i.attr(e))}),a){case x.heading:n.set("depth",i[0].tagName.replace(/H/gi,""));break;case x.list:n.set("style",i[0].tagName.toLowerCase()),n.set("start",+(i[0].getAttribute("start")||1));break;case x.math_block:t&&(n.refcid=i.attr("cid"));break;case x.fences:var s=l.unescape(i.attr("lang"))||i.find(".ty-input").text();File.editor&&File.editor.fences&&(File.editor.fences.lastCodeLang=s),n.set("lang",s),n.set("text",i.find("textarea[id]").val()||i.text());break;case x.list_item:i.hasClass("md-task-list-item")&&n.set("style",w.ListType.task),n.set("checked",i.hasClass("task-list-done")||"checked"==i.children("input").attr("checked"));break;case x.def_link:n.set("ref",i.find(".md-def-name").text()),n.set("title",i.find(".md-def-title").text()),n.set("href",i.find(".md-def-content").text());break;case x.def_footnote:n.set("text",i.find(".md-def-content").rawText()),n.set("ref",i.find(".md-def-name").text());break;case x.table:r=[],i.find("tbody>tr:first").children().toArray().map(function(e){r[e.cellIndex]=e.style.textAlign,""==e.style.textAlign&&(r[e.cellIndex]=null)}),r.length||i.find("thead>tr:first").children().toArray().map(function(e){r[e.cellIndex]=e.style.textAlign,""==e.style.textAlign&&(r[e.cellIndex]=null)}),n.set("align",r);break;case x.table_row:n.set("header",0<i.closest("thead").length);break;case x.html_block:n.set("text",i.text()),n.set("style",i.attr("data-tag"))}},w.reverse=function(e,t,n,i){var r,o;if(e.length&&e[0].hasAttribute("mdtype"))return r=new w({in:t}),w.reverseAttrFromElem(r,e,n,i),r.get("type")==x.table?(e.find("tr[mdtype]").each(a),w.TableEdit.verify(r)):(r.get("type")==x.table_row?e.children().children("span[mdtype]"):e.children("[mdtype]")).each(a),o&&o.unset("tail"),r;function a(){o=w.reverse($(this),t,n,i),r.appendChild(o),o.get("before")||o.unset("ahead")}},w.prototype.attr=function(i,r,o,e){function t(e,t){var n=o.undo.UndoManager.makeEmptyCommand();return n.undo.push({type:"attr",id:e.id,key:i,value:t||e.safeGetStrAttr(i)}),n.redo.push({type:"attr",key:i,id:e.id,value:r}),n}if(o.undo.endSnap(!0),this.get(i)!=r){e||o.store();var n,a,s,l=t(this);switch(e||"align_idx"==i||o.undo.register(l),i){case"tagBefore":case"tagAfter":(d=o.mathBlock.currentCm)&&d.cid==this.cid||o.mathBlock.startEditing(this.cid),this.set(i,r);var c=$("[cid='"+this.id+"'] .md-rawblock-"+("tagBefore"==i?"before":"after")+" .ty-input").text(r||"").focus();o.selection.selectAllElem(c);break;case"lang":File.editor&&File.editor.fences&&(File.editor.fences.lastCodeLang=r),(d=o.fences.getCm(this.id))?(n=$("[cid='"+this.id+"']"),this.get("lang")!=r&&(u.isDiagramType(this.get("lang"))&&o.diagrams.cancelDiagram(this.id),h.isMathType(this.get("lang"))&&o.mathBlock.beforeDeleteFences(this.id),d.setOption("mode",getCodeMirrorMode(r)),s=o.fences.getOptionsFromFencesAttr(r),File.option.showLineNumbersForFence||(s.lineNumbers?(d.setOption("lineNumbers",!0),n.addClass("md-fences-with-lineno")):n.removeClass("md-fences-with-lineno")),s.firstLineNumber&&d.setOption("firstLineNumber",s.firstLineNumber),d.refresh(),this.set("lang",r),n.attr("lang",r).find(".CodeMirror").attr("lang",(r||"").toLowerCase()),e&&(s=$("[cid='"+this.id+"'] .code-tooltip").show().find(".ty-input").text(r||"").focus(),o.selection.selectAllElem(s)),Fences.renderFencesByUpdate(this,n[0],r),u.isDiagramType(r)&&o.diagrams.updateDiagram(this.id),h.isMathType(r))&&o.mathBlock.renderUnder(n[0],!0)):console.sendError("Failed to get CodeMirror","error",r);break;case"checked":var d=document.querySelector("[cid='"+this.id+"']>input");r?(d.setAttribute("checked","checked"),d.parentElement.classList.remove("task-list-not-done"),d.parentElement.classList.add("task-list-done")):(d.removeAttribute("checked"),d.parentElement.classList.remove("task-list-done"),d.parentElement.classList.add("task-list-not-done")),d.checked=r||!1,this.set("checked",r||!1);break;case"href-title":this.get("type")==x.image&&(s=r.split(/\s/),o.findElemById(this.id).find("img").attr("src",s[0]),this.set("href",s[0]),this.set("title",s[1]),e)&&!(c=$("[cid='"+this.id+"']")).hasClass("onfocus")&&(c.addClass("onfocus").focus(),o.EditHelper.showTooltipForImage(o,c),$("[cid='"+this.id+"'] input.t-bracket-input").val(r||"").focus());break;case"alt":this.get("type")==x.image&&(o.findElemById(this.id).find("img").attr("alt",r),this.set("alt",r),e)&&!(c=$("[cid='"+this.id+"']")).hasClass("onfocus")&&(c.addClass("onfocus").focus(),o.EditHelper.showTooltipForImage(o,c),$("[cid='"+this.id+"'] input.t-alt-input").val(r||"").focus());break;case"align_idx":this.get("type")==x.table&&(n=r[0],d=r[1],s=r[2],c=o.findElemById(this.id),this.set("align",this.get("align")||[]),l=t(this,[n,this.get("align")[n]]),(a=this.get("userText"))&&(l.undo=[C.buildReplaceUndo(this)]),e||(s=w.adjustAlignText(this,n,d)),this.get("alignText")&&(this.get("alignText")[n]=s),this.get("align")[n]=d,a?(w.tryResetTable(this),l.redo=[C.buildReplaceUndo(this)]):s&&(l.undo.last().value.push(this.get("alignText")[n]),l.redo.last().value.push(s)),e||((a=o.selection.buildUndo())&&(l.undo.unshift(a),l.redo.push(a)),o.undo.register(l)),d=d||"",c.find("tbody>tr>td:nth-child("+(n+1)+")").css("text-align",d),c.find("thead>tr>th:nth-child("+(n+1)+")").css("text-align",d),e?o.tableEdit.showTableEdit(c):((s=c.find(".md-align-gp[data-col='"+n+"']")).find("button").removeClass("active").blur(),s.find(".md-align-"+d).addClass("active").focus()));break;default:this.set(i,r)}return l}},w.adjustAlignText=function(e,t,n){if(e.get("alignText")){e=e.get("alignText")[t];if(e)return e="left"==n||"center"==n?(e=e.replace(/(^\s*)-/,"$1:")).replace(/(^\s*):(\s*$)/,"$1:-$2"):e.replace(/(^\s*):/,"$1-"),e="right"==n||"center"==n?(e=e.replace(/-(\s*$)/,":$1")).replace(/(^\s*):(\s*$)/,"$1-:$2"):e.replace(/:(\s*$)/,"-$1"),e=/^\s*::\s*$/.exec(e)?e.replace("::",":-:"):e}},w.tryResetTable=function(e){e&&!e.isDeleted()&&e.get("type")==x.table&&e.get("userText")&&e.set("userText",void 0)},w.prototype.unwrap=function(e){this.cid;var t=[],n=this.getFirstChild();do{var i=n.get("after")}while(n.set("parent",this.get("parent")),n.set("attachTo",this.get("attachTo")),n.get("before")||n.set("before",this.get("before")),n.get("after")||n.set("after",this.get("after")),t.push(n),n.get("pattern")&&n.set("pattern",n.get("pattern").replace(/^\s+/,"")),n=i);return this.remove(!0),e&&e.findElemById(this.cid).replaceWith(r.NodeCollectionUtils.toHTML(t,{mathCount:0})),t},w.wrap=function(e,t,n,i){var r,o=t;for(t.addBefore(e),i.findElemById(e.cid).remove();r=o.get("after"),e.appendChild(o),o!=t&&i.findElemById(o.cid).remove(),o!=n&&(o=r););i.findElemById(t.cid).replaceWith(e.toHTML())}}),$__System.registerDynamic("1f",["20"],!0,function(e,t,n){"use strict";this||self;var i,u,h,p,e=e("20");function r(a){a.state.markedSelection&&a.operation(function(){var e=a;try{if(!e.somethingSelected())return void l(e);if(1<e.listSelections().length)return void c(e);var t=e.getCursor("start"),n=e.getCursor("end"),i=e.state.markedSelection;if(!i.length)return void s(e,t,n);var r=i[0].find(),o=i[i.length-1].find();if(!r||!o||n.line-t.line<u||0<=p(t,o.to)||p(n,r.from)<=0)return void c(e);for(;0<p(t,r.from);)i.shift().clear(),r=i[0].find();for(p(t,r.from)<0&&(r.to.line-t.line<u?(i.shift().clear(),s(e,t,r.to,0)):s(e,t,r.from,0));p(n,o.to)<0;)i.pop().clear(),o=i[i.length-1].find();0<p(n,o.to)&&(n.line-o.from.line<u?(i.pop().clear(),s(e,o.from,n)):s(e,o.to,n))}catch(e){}})}function o(e){e.state.markedSelection&&e.state.markedSelection.length&&e.operation(function(){l(e)})}function s(e,t,n,i){if(0!=p(t,n))for(var r=e.state.markedSelection,o=e.state.markedSelectionStyle,a=t.line;;){var s=a==t.line?t:h(a,0),l=a+u,c=l>=n.line,d=c?n:h(l,0),s=e.markText(s,d,{className:o});if(null==i?r.push(s):r.splice(i++,0,s),c)break;a=l}}function l(e){for(var t=e.state.markedSelection,n=0;n<t.length;++n)t[n].clear();t.length=0}function c(e){l(e);for(var t=e.listSelections(),n=0;n<t.length;n++)s(e,t[n].from(),t[n].to())}(i=e).defineOption("styleSelectedText",!1,function(e,t,n){n=n&&n!=i.Init;t&&!n?(e.state.markedSelection=[],e.state.markedSelectionStyle="string"==typeof t?t:"CodeMirror-selectedtext",c(e),e.on("cursorActivity",r),e.on("change",o)):!t&&n&&(e.off("cursorActivity",r),e.off("change",o),l(e),e.state.markedSelection=e.state.markedSelectionStyle=null)}),u=8,h=i.Pos,p=i.cmpPos}),$__System.registerDynamic("21",["20"],!0,function(e,t,n){this||self;var b,i,w,r,e=e("20");function x(e,t){return"pairs"==t&&"string"==typeof e?e:("object"==typeof e&&null!=e[t]?e:i)[t]}function o(e){for(var t=0;t<e.length;t++){var n=e.charAt(t),i="'"+n+"'";r[i]||(r[i]=function(v){return function(e){var r=e,t=v,e=C(r);if(!e||r.getOption("disableInput"))return b.Pass;var n=x(e,"pairs"),i=n.indexOf(t);if(-1==i)return b.Pass;for(var o,a=x(e,"closeBefore"),s=x(e,"triples"),l=n.charAt(i+1)==t,c=r.listSelections(),d=i%2==0,u=0;u<c.length;u++){var h,p=c[u],f=p.head,m=r.getRange(f,w(f.line,f.ch+1));if(d&&!p.empty())h="surround";else if(!l&&d||m!=t)if(l&&1<f.ch&&0<=s.indexOf(t)&&r.getRange(w(f.line,f.ch-2),f)==t+t){if(2<f.ch&&/\bstring/.test(r.getTokenTypeAt(w(f.line,f.ch-2))))return b.Pass;h="addFour"}else{if(l){p=0==f.ch?" ":r.getRange(w(f.line,f.ch-1),f);if(b.isWordChar(m)||p==t||b.isWordChar(p))return b.Pass}else if(!d||!(0===m.length||/\s/.test(m)||-1<a.indexOf(m)))return b.Pass;h="both"}else h=l&&function(e,t){var n=e.getTokenAt(w(t.line,t.ch+1));return/\bstring/.test(n.type)&&n.start==t.ch&&(0==t.ch||!/\bstring/.test(e.getTokenTypeAt(t)))}(r,f)?"both":0<=s.indexOf(t)&&r.getRange(f,w(f.line,f.ch+3))==t+t+t?"skipThree":"skip";if(o){if(o!=h)return b.Pass}else o=h}var g=i%2?n.charAt(i-1):t,y=i%2?t:n.charAt(i+1);r.operation(function(){if("skip"==o)r.execCommand("goCharRight");else if("skipThree"==o)for(var e=0;e<3;e++)r.execCommand("goCharRight");else if("surround"==o){for(var t=r.getSelections(),e=0;e<t.length;e++)t[e]=g+t[e]+y;r.replaceSelections(t,"around");for(t=r.listSelections().slice(),e=0;e<t.length;e++)t[e]=(n=t[e],i=void 0,i=0<b.cmpPos(n.anchor,n.head),{anchor:new w(n.anchor.line,n.anchor.ch+(i?-1:1)),head:new w(n.head.line,n.head.ch+(i?1:-1))});r.setSelections(t)}else"both"==o?(r.replaceSelection(g+y,null),r.triggerElectric(g+y),r.execCommand("goCharLeft")):"addFour"==o&&(r.replaceSelection(g+g+g+g,"before"),r.execCommand("goCharRight"));var n,i})}}(n))}}function C(e){var t=e.state.closeBrackets;return t&&!t.override&&e.getModeAt(e.getCursor()).closeBrackets||t}function s(e,t){e=e.getRange(w(t.line,t.ch-1),w(t.line,t.ch+1));return 2==e.length?e:null}i={pairs:"()[]{}''\"\"",closeBefore:")]}'\":;>",triples:"",explode:"[]{}"},w=(b=e).Pos,b.defineOption("autoCloseBrackets",!1,function(e,t,n){n&&n!=b.Init&&(e.removeKeyMap(r),e.state.closeBrackets=null),t&&(o(x(t,"pairs")),e.state.closeBrackets=t,e.addKeyMap(r))}),r={Backspace:function(e){var t=C(e);if(!t||e.getOption("disableInput"))return b.Pass;for(var n=x(t,"pairs"),i=e.listSelections(),r=0;r<i.length;r++){if(!i[r].empty())return b.Pass;var o=s(e,i[r].head);if(!o||n.indexOf(o)%2!=0)return b.Pass}for(r=i.length-1;0<=r;r--){var a=i[r].head;e.replaceRange("",w(a.line,a.ch-1),w(a.line,a.ch+1),"+delete")}},Enter:function(i){var e=C(i),t=e&&x(e,"explode");if(!t||i.getOption("disableInput"))return b.Pass;for(var r=i.listSelections(),n=0;n<r.length;n++){if(!r[n].empty())return b.Pass;var o=s(i,r[n].head);if(!o||t.indexOf(o)%2!=0)return b.Pass}i.operation(function(){var e=i.lineSeparator()||"\n";i.replaceSelection(e+e,null),i.execCommand("goCharLeft"),r=i.listSelections();for(var t=0;t<r.length;t++){var n=r[t].head.line;i.indentLine(n,null,!0),i.indentLine(n+1,null,!0)}})}},o(i.pairs+"`")}),$__System.registerDynamic("22",["20"],!0,function(e,t,n){this||self;var f,m,g=e("20");function i(e,t){for(var n=e.listSelections(),i=[],r=t?"/":"</",o=0;o<n.length;o++){if(!n[o].empty())return g.Pass;var a,s=n[o].head,l=e.getTokenAt(s),c=g.innerMode(e.getMode(),l.state),d=c.state;if(t&&("string"==l.type||"<"!=l.string.charAt(0)||l.start!=s.ch-1))return g.Pass;if("xml"!=c.mode.name)if("htmlmixed"==e.getMode().name&&"javascript"==c.mode.name)a=r+"script";else{if("htmlmixed"!=e.getMode().name||"css"!=c.mode.name)return g.Pass;a=r+"style"}else{if(!d.context||!d.context.tagName||v(e,d.context.tagName,s,d))return g.Pass;a=r+d.context.tagName}">"!=e.getLine(s.line).charAt(l.end)&&(a+=">"),i[o]=a}e.replaceSelections(i);for(n=e.listSelections(),o=0;o<n.length;o++)(o==n.length-1||n[o].head.line<n[o+1].head.line)&&e.indentLine(n[o].head.line)}function y(e,t){if(e.indexOf)return e.indexOf(t);for(var n=0,i=e.length;n<i;++n)if(e[n]==t)return n;return-1}function v(e,t,n,i,r){if(g.scanForClosingTag){var o=Math.min(e.lastLine()+1,n.line+500),a=g.scanForClosingTag(e,n,null,o);if(a&&a.tag==t){for(var s=i.context,l=r?1:0;s&&s.tagName==t;s=s.prev)++l;n=a.to;for(var c=1;c<l;c++){var d=g.scanForClosingTag(e,n,null,o);if(!d||d.tag!=t)return;n=d.to}return 1}}}g.defineOption("autoCloseTags",!1,function(e,t,n){n!=g.Init&&n&&e.removeKeyMap("autoCloseTags"),t&&(n={name:"autoCloseTags"},"object"==typeof t&&!t.whenClosing||(n["'/'"]=function(e){return(e=e).getOption("disableInput")?g.Pass:i(e,!0)}),"object"==typeof t&&!t.whenOpening||(n["'>'"]=function(e){var t=e;if(t.getOption("disableInput"))return g.Pass;for(var n=t.listSelections(),i=[],r=0;r<n.length;r++){if(!n[r].empty())return g.Pass;var o=n[r].head,a=t.getTokenAt(o),s=g.innerMode(t.getMode(),a.state),l=s.state;if("xml"!=s.mode.name||!l.tagName)return g.Pass;var c=t.getOption("autoCloseTags"),s="html"==s.mode.configuration,d="object"==typeof c&&c.dontCloseTags||s&&f,c="object"==typeof c&&c.indentTags||s&&m,s=l.tagName,u=(s=a.end>o.ch?s.slice(0,s.length-a.end+o.ch):s).toLowerCase();if(!s||"string"==a.type&&(a.end!=o.ch||!/[\"\']/.test(a.string.charAt(a.string.length-1))||1==a.string.length)||"tag"==a.type&&"closeTag"==l.type||a.string.indexOf("/")==a.string.length-1||d&&-1<y(d,u)||v(t,s,o,l,!0))return g.Pass;a=c&&-1<y(c,u);i[r]={indent:a,text:">"+(a?"\n\n":"")+"</"+s+">",newPos:a?g.Pos(o.line+1,0):g.Pos(o.line,o.ch+1)}}for(r=n.length-1;0<=r;r--){var h=i[r],p=(t.replaceRange(h.text,n[r].head,n[r].anchor,"+insert"),t.listSelections().slice(0));p[r]={head:h.newPos,anchor:h.newPos},t.setSelections(p),h.indent&&(t.indentLine(h.newPos.line,null,!0),t.indentLine(h.newPos.line+1,null,!0))}}),e.addKeyMap(n))}),f=["area","base","br","col","command","embed","hr","img","input","keygen","link","meta","param","source","track","wbr"],m=["applet","blockquote","body","button","div","dl","fieldset","form","frameset","h1","h2","h3","h4","h5","h6","head","html","iframe","layer","legend","object","ol","p","select","table","ul"],g.commands.closeTag=function(e){return i(e)}}),$__System.registerDynamic("23",["20"],!0,function(e,t,n){"use strict";this||self;var a=e("20");a.overlayMode=function(i,r,o){return{startState:function(){return{base:a.startState(i),overlay:a.startState(r),basePos:0,baseCur:null,overlayPos:0,overlayCur:null,streamSeen:null}},copyState:function(e){return{base:a.copyState(i,e.base),overlay:a.copyState(r,e.overlay),basePos:e.basePos,baseCur:null,overlayPos:e.overlayPos,overlayCur:null}},token:function(e,t){return(e!=t.streamSeen||Math.min(t.basePos,t.overlayPos)<e.start)&&(t.streamSeen=e,t.basePos=t.overlayPos=e.start),e.start==t.basePos&&(t.base.lineBefore=t.lineBefore,t.base.lineAfter=t.lineAfter,t.baseCur=i.token(e,t.base),t.basePos=e.pos),e.start==t.overlayPos&&(e.pos=e.start,t.overlayCur=r.token(e,t.overlay),t.overlayPos=e.pos),e.pos=Math.min(t.basePos,t.overlayPos),null==t.overlayCur?t.baseCur:null!=t.baseCur&&t.overlay.combineTokens||o&&null==t.overlay.combineTokens?t.baseCur+" "+t.overlayCur:t.overlayCur},indent:i.indent&&function(e,t){return i.indent(e.base,t)},electricChars:i.electricChars,innerMode:function(e){return{state:e.base,mode:i}},blankLine:function(e){var t,n;return i.blankLine&&(t=i.blankLine(e.base)),null==(n=r.blankLine?r.blankLine(e.overlay):n)?t:o&&null!=t?t+" "+n:n}}}}),$__System.registerDynamic("24",["20"],!0,function(e,t,n){this||self;var f=e("20"),m="CodeMirror-lint-markers";function l(e){e.parentNode&&e.parentNode.removeChild(e)}function g(e,t,n){e=e,t=t,(i=document.createElement("div")).className="CodeMirror-lint-tooltip",i.appendChild(t.cloneNode(!0)),document.body.appendChild(i),f.on(document,"mousemove",o),o(e),null!=i.style.opacity&&(i.style.opacity=1);var i,r=i;function o(e){if(!i.parentNode)return f.off(document,"mousemove",o);i.style.top=Math.max(0,e.clientY-i.offsetHeight-5)+"px",i.style.left=e.clientX+5+"px"}function a(){var e;f.off(n,"mouseout",a),r&&((e=r).parentNode&&(null==e.style.opacity&&l(e),e.style.opacity=0,setTimeout(function(){l(e)},600)),r=null)}var s=setInterval(function(){if(r)for(var e=n;;e=e.parentNode){if((e=e&&11==e.nodeType?e.host:e)==document.body)return;if(!e){a();break}}if(!r)return clearInterval(s)},400);f.on(n,"mouseout",a)}function a(l,e,t){this.marked=[],this.options=e,this.timeout=null,this.hasGutter=t,this.onMouseOver=function(e){var t=l,n=e.target||e.srcElement;if(/\bCodeMirror-lint-mark-/.test(n.className)){for(var n=n.getBoundingClientRect(),i=(n.left+n.right)/2,n=(n.top+n.bottom)/2,r=t.findMarksAt(t.coordsChar({left:i,top:n},"client")),o=[],a=0;a<r.length;++a){var s=r[a].__annotation;s&&o.push(s)}o.length&&!function(e,t){for(var n=t.target||t.srcElement,i=document.createDocumentFragment(),r=0;r<e.length;r++){var o=e[r];i.appendChild(v(o))}g(t,i,n)}(o,e)}},this.waitingFor=0}function y(e){var t=e.state.lint;t.hasGutter&&e.clearGutter(m);for(var n=0;n<t.marked.length;++n)t.marked[n].clear();t.marked.length=0}function v(e){var t=(t=e.severity)||"error",n=document.createElement("div");return n.className="CodeMirror-lint-message-"+t,n.appendChild(document.createTextNode(e.message)),n}function s(t){var n,e,i,r,o=t.state.lint.options,a=o.options||o,s=o.getAnnotations||t.getHelper(f.Pos(0,0),"lint");function l(){r=-1,n.off("change",l)}s&&(o.async||s.async?(o=s,e=a,i=(n=t).state.lint,r=++i.waitingFor,n.on("change",l),o(n.getValue(),function(e,t){n.off("change",l),i.waitingFor==r&&(t&&e instanceof f&&(e=t),c(n,e))},e,n)):(o=s(t.getValue(),a,t))&&(o.then?o.then(function(e){c(t,e)}):c(t,o)))}function c(e,t){y(e);for(var n,i,r=e.state.lint,o=r.options,a=function(e){for(var t=[],n=0;n<e.length;++n){var i=e[n],r=i.from.line;(t[r]||(t[r]=[])).push(i)}return t}(t),s=0;s<a.length;++s){var l=a[s];if(l){for(var c=null,d=r.hasGutter&&document.createDocumentFragment(),u=0;u<l.length;++u){var h=l[u],p=h.severity;i=p=p||"error",c="error"==(n=c)?n:i,o.formatAnnotation&&(h=o.formatAnnotation(h)),r.hasGutter&&d.appendChild(v(h)),h.to&&r.marked.push(e.markText(h.from,h.to,{className:"CodeMirror-lint-mark-"+p,__annotation:h}))}r.hasGutter&&e.setGutterMarker(s,m,function(t,e,n,i){var r=document.createElement("div"),o=r;return r.className="CodeMirror-lint-marker-"+e,n&&((o=r.appendChild(document.createElement("div"))).className="CodeMirror-lint-marker-multiple"),0!=i&&f.on(o,"mouseover",function(e){g(e,t,o)}),r}(d,c,1<l.length,r.options.tooltips))}}o.onUpdateLinting&&o.onUpdateLinting(t,a,e)}function d(e){var t=e.state.lint;t&&(clearTimeout(t.timeout),t.timeout=setTimeout(function(){s(e)},t.options.delay||500))}f.defineOption("lint",!1,function(e,t,n){if(n&&n!=f.Init&&(y(e),!1!==e.state.lint.options.lintOnChange&&e.off("change",d),f.off(e.getWrapperElement(),"mouseover",e.state.lint.onMouseOver),clearTimeout(e.state.lint.timeout),delete e.state.lint),t){for(var i=e.getOption("gutters"),r=!1,o=0;o<i.length;++o)i[o]==m&&(r=!0);t=e.state.lint=new a(e,(n=t)instanceof Function?{getAnnotations:n}:n&&!0!==n?n:{},r);!1!==t.options.lintOnChange&&e.on("change",d),0!=t.options.tooltips&&"gutter"!=t.options.tooltips&&f.on(e.getWrapperElement(),"mouseover",t.onMouseOver),s(e)}}),f.defineExtension("performLint",function(){this.state.lint&&s(this)}),f.clearMarks=y,f.updateLinting=c}),$__System.registerDynamic("18",["20","11","e","25","13","26","1b","15","1c","1f","21","22","23","24"],!0,function(e,t,n){"use strict";this||self;var i,r,o,F=e("20"),a=e("11"),S=e("e"),k=(e("25"),e("13")),s=e("26"),E=(e("1b"),e("15")),T=e("1c"),_=s.map,l=(Node=k.Node,F.prototype.focus),A=(F.prototype.focus=function(){F.signal(this,"focus",this),l.apply(this)},window.webkit&&(delete F.keyMap.emacsy["Alt-F"],delete F.keyMap.emacsy["Alt-D"],delete F.keyMap.emacsy["Alt-B"]),e("1f"),e("21"),e("22"),e("23"),e("24"),["js","javascript","java","json","typescript","ts","clojure","coffeescript","css","less","scss","gfm","markdown","xaml","xml","haskell","html","lua","lisp","commonlisp","pascal","perl","perl6","php","php+HTML","python","cython","ruby","shell","sh","sql","sqlite","mssql","mysql","CQL","mariadb","cassandra","plsql","tiddlywiki","wiki","vb","basic","visual basic","vbscript","velocity","verilog","xquery","yaml","go","groovy","nginx","octave","c","clike","c++","cpp","objc","objective-c","csharp","c#","squirrel","ceylon","kotlin","tex","latex","swift","scala","R","D","diff","erlang","http","jade","rst","rust","jinja2","reStructuredText","asp","jsp","erb","ejs","embeddedjs","powershell","dockerfile","jsx","tsx","react","vue","nsis","mathematica","tiki wiki","properties","ini","livescript","assembly","gas","toml","matlab","ocaml","F#","fsharp","elm","pgp","asciiarmor","spreadsheet","elixir","cmake","cypher","dart","django","dtd","xml-dtd","dylan","handlebars","idl","web-idl","yacas","mbox","vhdl","julia","haxe","hxml","fortran","protobuf","makefile","tcl","scheme","twig","bash","SAS","pseudocode","stylus","cobol","oz","SPARQL","crystal","ASN.1","gherkin","smalltalk","turtle","glsl","apl","ABAP","q","v","forth","nim","solidity","htaccess","postgresql","hive","stata","systemverilog","smarty","yara","pug","svelte","pegjs","cmd","bat","modelica"].sort((e,t)=>e.toLowerCase().localeCompare(t.toLowerCase()))),c={clojure:'<span class="path1"></span><span class="path2"></span><span class="path3"></span><span class="path4"></span><span class="path5"></span>',ceylon:'<span class="path1"></span><span class="path2"></span>',dart:'<span class="path1"></span><span class="path2"></span><span class="path3"></span><span class="path4"></span>',fsharp:'<span class="path1"></span><span class="path2"></span><span class="path3"></span>',cmake:'<span class="path1"></span><span class="path2"></span><span class="path3"></span>',cython:'<span class="path1"></span><span class="path2"></span><span class="path3"></span><span class="path4"></span>',dockerfile:'<span class="path1"></span><span class="path2"></span><span class="path3"></span><span class="path4"></span>',elm:'<span class="path1"></span><span class="path2"></span><span class="path3"></span><span class="path4"></span><span class="path5"></span><span class="path6"></span><span class="path7"></span>',haskell:'<span class="path1"></span><span class="path2"></span><span class="path3"></span>',haxe:'<span class="path1"></span><span class="path2"></span><span class="path3"></span><span class="path4"></span><span class="path5"></span><span class="path6"></span><span class="path7"></span><span class="path8"></span><span class="path9"></span><span class="path10"></span><span class="path11"></span><span class="path12"></span><span class="path13"></span>',julia:'<span class="path1"></span><span class="path2"></span><span class="path3"></span>',jsp:'<span class="path1"></span><span class="path2"></span><span class="path3"></span><span class="path4"></span>',matlab:'<span class="path1"></span><span class="path2"></span><span class="path3"></span>',python:'<span class="path1"></span><span class="path2"></span>',protobuf:'<span class="path1"></span><span class="path2"></span><span class="path3"></span><span class="path4"></span><span class="path5"></span><span class="path6"></span><span class="path7"></span><span class="path8"></span>',vue:'<span class="path1"></span><span class="path2"></span>',sparql:'<span class="path1"></span><span class="path2"></span>',squirrel:'<span class="path1"></span><span class="path2"></span><span class="path3"></span><span class="path4"></span><span class="path5"></span><span class="path6"></span><span class="path7"></span><span class="path8"></span><span class="path9"></span>',xquery:'<span class="path1"></span><span class="path2"></span>',v:'<span class="path1"></span><span class="path2"></span>',toml:'<span class="path1"></span><span class="path2"></span><span class="path3"></span>',vhdl:'<span class="path1"></span><span class="path2"></span>',wiki:'<span class="path1"></span><span class="path2"></span><span class="path3"></span><span class="path4"></span><span class="path5"></span><span class="path6"></span><span class="path7"></span><span class="path8"></span><span class="path9"></span><span class="path10"></span><span class="path11"></span><span class="path12"></span><span class="path13"></span><span class="path14"></span><span class="path15"></span><span class="path16"></span><span class="path17"></span><span class="path18"></span><span class="path19"></span><span class="path20"></span><span class="path21"></span><span class="path22"></span><span class="path23"></span><span class="path24"></span><span class="path25"></span><span class="path26"></span><span class="path27"></span><span class="path28"></span><span class="path29"></span><span class="path30"></span><span class="path31"></span><span class="path32"></span><span class="path33"></span>'},d={js:"javascript","c#":"csharp","c++":"cpp","objective-c":"objectivec","php+HTML":"php",latex:"tex",zsh:"console",bash:"console",cmd:"console",bat:"console",sh:"console",shell:"console",jsx:"react",asciiarmor:"key",pgp:"key",sql:"database",sqlite:"database",mssql:"database",mysql:"database",postgresql:"database",hive:"database",stata:"database",CQL:"database",mariadb:"database",cassandra:"database",plsql:"database",clike:"c",coffeescript:"coffee","F#":"fsharp",commonlisp:"lisp",cypher:"database",dtd:"xml",D:"d",embeddedjs:"ejs",gfm:"markdown",gas:"assembly",flow:"none",flow:"diagram",hxml:"haxe",jinja2:"jinja",mbox:"email",nsis:"makefile",objc:"objectivec",octave:"matlab",Q:"q",perl6:"perl",properties:"ini",SAS:"sas",spreadsheet:"table",SPARQL:"sparql",R:"r",tsx:"typescript",ts:"typescript",basic:"vb",vbscript:"vb","visual basic":"vb","xml-dtd":"xml",tiddlywiki:"wiki","tiki wiki":"wiki",mermaid:"diagram",sequence:"diagram",htaccess:"credits",ABAP:"credits","ASN.1":"credits",dylan:"credits",gherkin:"credits",idl:"credits",jade:"credits",mathematica:"credits",oz:"credits",pascal:"credits",pseudocode:"credits",rst:"credits",reStructuredText:"credits",turtle:"credits","web-idl":"credits",yacas:"credits",systemverilog:"verilog",smalltalk:"credits",yara:"credits",pug:"credits",pegjs:"credits",modelica:"credits"};for(i of A)d[i]=d[i]||i;o=(r=F).commands.delLineLeft,r.commands.delLineLeft=function(e){try{return 0==e.getCursor().ch?r.commands.delCharBefore(e):o(e)}catch(e){}};function u(e,t,n){if(e)switch(e){case"javascript":case"text/javascript":case"js":return e="javascript";case"json":case"json5":return e=t?e:{name:"javascript",json:!0};case"jsonld":case"json-ld":return t?e:"application/ld+json";case"text/typescript":case"typescript":case"ts":return t?"typescript":e={name:"javascript",typescript:!0};case"arkts":return t?"arkts":e={name:"javascript",typescript:!0};case"clojure":return e;case"coffee":case"coffeescript":case"css":return e;case"less":return t?"less":"text/x-less";case"scss":return t?"scss":e="text/x-scss";case"gfm":case"github flavored markdown":return e="gfm";case"markdown":case"md":case"mkd":return e;case"xml":case"xaml":case"mjml":case"xul":case"enml":return t?e:"xml";case"haskell":return e;case"htmlmixed":case"html":case"html4":case"html5":case"xhtml":case"svg":case"epub":return t?/^html/.exec(e)?"html":e:e="htmlmixed";case"lua":return e;case"lisp":case"commonlisp":case"common lisp":return e="commonlisp";case"pascal":return e;case"perl":case"perl5":case"perl4":case"perl3":case"perl2":return"perl";case"perl6":return e;case"php+html":return t?"php":"application/x-httpd-php";case"php":case"php3":case"php4":case"php5":case"php6":return t?e:"text/x-php";case"cython":return e=t?e:"text/x-cython";case"py":case"py2":case"py3":e="python";case"python2":case"python3":case"python":return e=t?e:"text/x-python";case"terraform":return t?e:"ruby";case"ruby":return e;case"shell":case"sh":case"zsh":case"bash":case"terminal":return n?"bash":e="shell";case"sql":return e=t?e:"text/x-mariadb";case"sql lite":case"sqlite":return e=t?e:"text/x-sql";case"mssql":return e=t?e:"text/x-mssql";case"mysql":return e=t?e:"text/x-mysql";case"pgsql":case"postgresql":return t?"postgresql":e="text/x-pgsql";case"hive":return e=t?e:"text/x-hive";case"esper":return e=t?e:"text/x-esper";case"mariadb":return e=t?e:"text/x-mariadb";case"cassandra":case"cql":return e=t?e:"text/x-cassandra";case"plsql":return e=t?e:"text/x-plsql";case"greenplum":case"greenplum-db":case"gpsql":return e=t?e:"text/x-gpsql";case"sparksql":case"spark-sql":case"spark sql":return e=t?e:"text/x-sparksql";case"esper":return e=t?e:"text/x-esper";case"stex":case"tex":case"latex":case"math":return t?e:"text/x-stex";case"tiddlywiki":case"wiki":return e=t?e:"tiddlywiki";case"vb":case"visual basic":case"visualbasic":case"basic":return e=t?e:"vb";case"vbscript":case"velocity":return e;case"verilog":return e=t?e:"text/x-verilog";case"systemverilog":return e=t?e:"text/x-systemverilog";case"xquery":return e;case"yaml":case"yml":return t?e:"yaml";case"go":case"golang":case"go-lang":return"go";case"groovy":case"nginx":return e;case"octave":case"matlab":return t?e:"text/x-octave";case"c":case"clike":case"csrc":return e=t?e:"text/x-csrc";case"c++":case"c++src":case"cpp":case"cc":case"hpp":case"h++":case"h":return e=t?e:"text/x-c++src";case"obj-c":case"objc":case"objective c":case"objective-c":case"objectivec":return e=t?e:"text/x-objectivec";case"text/x-scala":case"scala":return e=t?e:"text/x-scala";case"csharp":case"c#":case"cs":return e=t?e:"text/x-csharp";case"java":return e=t?e:"text/x-java";case"squirrel":return e=t?e:"text/x-squirrel";case"ceylon":return e=t?e:"text/x-ceylon";case"kotlin":return e=t?e:"text/x-kotlin";case"swift":case"swiftui":return e="swift";case"r":case"rlang":case"r-lang":return e=t?e:"text/x-rsrc";case"d":case"dlang":case"d-lang":case"diff":case"erlang":case"http":case"jade":return e;case"rst":case"restructuredtext":return e="rst";case"rust":return e;case"jinja":return t?e:"jinja2";case"jinja2":return e;case"aspx":case"asp":case"asp.net":return e=t?e:"application/x-aspx";case"jsp":return e=t?e:"application/x-jsp";case"erb":return e=t?e:"application/x-erb";case"ejs":case"embeddedjs":case"embedded javaScript":return e=t?e:"application/x-ejs";case"powershell":case"bat":case"batch":case"cmd":return t?e:"application/x-powershell";case"docker":case"dockerfile":return t?e:"text/x-dockerfile";case"jsx":case"react":return t?e:"text/jsx";case"tsx":return t?e:"text/typescript-jsx";case"vue.js":case"vue":case"vue-template":return t?e:"script/x-vue";case"nsis":return t?e:"text/x-nsis";case"mathematica":return t?e:"text/x-mathematica";case"tiki":case"tiki wiki":case"tiki-wiki":case"tikiwiki":return"tiki";case"properties":case"ini":return t?e:"text/x-properties";case"livescript":return t?e:"text/x-livescript";case"asm":case"assembly":case"nasm":case"gas":return t?e:"assembly";case"toml":return t?e:"text/x-toml";case"sequence":return"sequence";case"flow":case"flowchart":return"flow";case"mermaid":return"mermaid";case"ocaml":return t?e:"text/x-ocaml";case"f#":case"fsharp":return t?e:"text/x-fsharp";case"elm":return t?e:"text/x-elm";case"pgp":case"pgp-keys":case"pgp-key":case"pgp-signature":case"asciiarmor":case"ascii-armor":case"ascii armor":return t?e:"application/pgp";case"spreadsheet":case"excel":return t?e:"text/x-spreadsheet";case"elixir":return"elixir";case"cmake":return t?e:"text/x-cmake";case"cypher":case"cypher-query":return t?e:"application/x-cypher-query";case"dart":return"dart";case"django":return t?e:"text/x-django";case"dtd":case"xml-dtd":case"xml dtd":case"xmldtd":return t?e:"application/xml-dtd";case"dylan":return t?e:"text/x-dylan";case"handlebars":case"svelte":return t?e:{name:"handlebars",base:"text/html"};case"idl":return t?e:"text/x-idl";case"webidl":case"web-idl":case"web idl":return t?e:"text/x-webidl";case"yacas":return t?e:"text/x-yacas";case"mbox":return t?e:"application/mbox";case"vhdl":return t?e:"text/x-vhdl";case"julia":return"julia";case"haxe":return t?e:"text/x-haxe";case"hxml":return t?e:"text/x-hxml";case"fortran":return t?e:"text/x-fortran";case"protobuf":return t?e:"text/x-protobuf";case"makefile":return t?e:"text/x-makefile";case"tcl":return t?e:"text/x-tcl";case"scheme":return t?e:"text/x-scheme";case"twig":return t?e:"text/x-twig";case"sas":return t?e:"text/x-sas";case"pseudocode":return t?e:"text/x-pseudocode";case"julia":case"text/x-julia":case"stylus":case"cobol":case"oz":case"sparql":case"crystal":return e;case"asn.1":return t?"ASN.1":e="text/x-ttcn-asn";case"gherkin":case"smalltalk":case"turtle":return e;case"glsl":case"Open GL Shading Language":return e="glsl";case"apl":case"abap":return e;case"q":case"qlang":case"q-lang":return t?e:"text/x-q";case"v":case"vlang":case"v-lang":return"v";case"forth":return e;case"nim":case"nimrod":return t?e:"nimrod";case"solidity":return e;case"htaccess":case".htaccess":if(t)return"htaccess";case"apache":return"apache";case"stata":return e;case"smarty":case"smarty2":return t?e:"smarty";case"smarty3":return t?e:{name:"smarty",verson:3};case"yara":case"pug":return e;case"pegjs":case"peg-js":case"peg.js":return"pegjs";case"modelica":return t?e:"text/x-modelica";default:return""}}function M(e){var t;return e&&"{"==e[0]&&"}"==e[e.length-1]&&(e=e.replace(/(^{)|(}$)/g,"").split(/\s+/))&&e.length?(t={},e.forEach(function(e){/^[.]number((-?l)|L)ines/.exec(e)?t.lineNumbers=!0:(e=/^startFrom=['"](\d+)['"]$/.exec(e))&&(t.firstLineNumber=+e[1])}),t):{}}window.getCodeMirrorMode=function(e,t,n,i){var r=((e=(e=e?e.toLowerCase():"").replace(/^\s*\.*lang(uage)*-/g,"").replace(/[{}]/g,"").trim()).split(/[\s,]+/)||[e])[0],o=u(e,n||i,i);return(o=o||e==r?o:u(r.replace(/(^[.])|(,$)/g,""),n,i))||(n?r:t?null:e)};var h=null,p=[];function L(e,t){var n,i,r;File.isMac&&(null==h?(h={},p=[],bridge.callHandler("word.getTextReplacement",{},e=>{h=e,p=Object.keys(h)})):1==t.length&&"+input"==t[0].origin&&(t=e.getWrapperElement().querySelector("textarea"),n=(n=t.value).substr(0,n.length-1),t=p.find(e=>n.endsWith(e)))&&h[t]&&(i=Object.assign({},e.getCursor("to")),r=Object.assign({},i),--i.ch,r.ch=i.ch-t.length,e.doc.replaceRange(h[t],r,i,"+replaceText")))}class f{constructor(e){this.getOptionsFromFencesAttr=M,this.handleUserReplacement=L;var n=this;this.editor=e,this.queue={},this.cachedCharWidth,this.editor.diagrams=new E(e),File.option.enableDiagram&&(A=A.concat(E.MODES)),this.ALL=A,this.autoCompleteRender=(e,t)=>`<li class="${t?"active":""}" data-content="${e.replace(/[']/g,"&quot;")}"><i class="ty-file-icon ty-fi-${d[e]||e}">${c[d[e]||""]||""}</i><span>${e}</span></li>`,"shift+tab"===File.option.autoIndentKey||File.option.shiftTabAutoIndent||(F.keyMap.default["Shift-Tab"]="indentLess"),S(document).on("losefocus",".md-fences",function(){var e=S(this),t=n.queue[e.attr("cid")];t&&(n.syncToNode(this.getAttribute("cid")),t.doc.setCursor(0,0,{scroll:!1}),e.find(".md-tooltip-remove").hide(),e[0].style.marginBottom="",e.find(".md-fences-adv-panel").length)&&setTimeout(()=>{n.editor.selection.scrollAdjust()},1)}).on("endfocus",".md-fences",function(){var e=S(this);n.queue[e.attr("cid")]&&(e.find(".md-tooltip-remove").hide(),e[0].style.marginBottom="")}).on("focus",".ty-input",function(){var e=S(this).closest("[cid]"),e=n.queue[e.attr("cid")];e&&(n.syncToNode(this.getAttribute("cid")),e.doc.setCursor(0,0,{scroll:!1}))}),File.isWin&&(F.keyMap.default.End="goLineRight",F.keyMap.default.Home="goLineLeft"),File.isMac&&bridge.registerHandler("fences.needUpdateReplaceDict",function(e){h=null,p=[]}),this.bindMouseEvents(),this.lazyload(),this.editor.diagrams.lazyload()}bindMouseEvents(){var n=this,i=this.editor;window.addEventListener("mousedown",e=>{n.isMousePressed=!0},!0),window.addEventListener("mouseup",e=>{var t;n.isMousePressed=!1,n.cmNeedsScroll&&(t=n.cmNeedsScroll,n.cmNeedsScroll=null,i.selection.typeWriterScroll(t.cursorCoords(t.getCursor())))},!0),this.handleCursorActivity=e=>{n.cmNeedsScroll=null,e.curOp&&!e.curOp.scrollToPos||File.isTypeWriterMode&&File.option.scrollWithCursor&&(n.isMousePressed?n.cmNeedsScroll=e:i.selection.typeWriterScroll(e.cursorCoords(e.getCursor())))}}onLeaveDocument(){this.queue={},this.intersectionObserve(null,!0)}clickEventHandled(e,t){var n,i;this.queue[t]||(i=window.scrollY,this.getCm(t),i-=window.scrollY,window.scrollBy(0,i),(i=document.elementFromPoint(e.clientX,e.clientY))&&(e.stopPropagation(),(n=document.createEvent("MouseEvents")).initMouseEvent("mousedown",!0,!0,i.ownerDocument.defaultView,1,e.screenX,e.screenY,e.clientX,e.clientY,e.ctrlKey,e.altKey,e.shiftKey,e.metaKey,e.button),i.dispatchEvent(n)),this.editor.refocus(t))}getCm(e){if(this.queue[e]){if(S("[cid='"+e+"'] textarea").length)return this.queue[e];delete this.queue[e]}if(!this.queue[e])return this.addCodeBlock(e)}getValue(e){return this.queue[e]?this.queue[e].getValue():(e=this.editor.findElemById(e)[0])?e.innerText:""}onKeyDown(e,t,n,i,r){var o,a=t.which||t.keyCode,s=F.keyName(t),l=!t.metaKey&&!t.shiftKey&&!t.ctrlKey;if("Up"==F.keyNames[a]){if((o=e.getCursor())&&0==o.line){if(l)return n.selection.moveUpOrDown(!0,t),t.codemirrorIgnore;if(0==o.ch&&!t.shiftKey&&(File.isNode&&t.ctrlKey||File.isMac&&t.metaKey))return void(t.codemirrorIgnore=!0)}t.stopPropagation()}else if("Down"==F.keyNames[a]){if((o=e.getCursor())&&o.line>=e.lineCount()-1){if(l)return n.selection.moveUpOrDown(!1,t),t.codemirrorIgnore;if(o.ch==e.doc.getLine(o.line).length&&!t.shiftKey&&(File.isNode&&t.ctrlKey||File.isMac&&t.metaKey))return void(t.codemirrorIgnore=!0)}t.stopPropagation()}else n.selection.clearGlobalColumn();if("Left"==F.keyNames[a]){if(0<e.getSelection().length)return;if((o=e.doc.getCursor())&&!o.line&&!o.ch&&l)return n.selection.moveUpOrDown(!0,t,!0),t.codemirrorIgnore;t.stopPropagation()}else if("Right"==F.keyNames[a]){if(0<e.getSelection().length)return;if((o=e.doc.getCursor())&&o.line>=e.lineCount()-1&&o.ch>=e.doc.getLine(o.line).length&&l)return n.selection.moveUpOrDown(!1,t,!0),t.codemirrorIgnore;t.stopPropagation()}else if("Backspace"==F.keyNames[a]){if((o=e.doc.getCursor())&&e.lineCount()<=1&&!o.line&&!o.ch&&!e.getSelection().length)return i(e),t.preventDefault(),t.codemirrorIgnore;t.stopPropagation()}else if("Delete"==F.keyNames[a]){if(""==e.getValue())return i(e),t.preventDefault(),t.codemirrorIgnore;t.stopPropagation()}else if("PageDown"==F.keyNames[a]){if(!(o=e.doc.getCursor(o))||e.doc.indexFromPos(o)>=e.doc.getValue().length)return e.execCommand("goDocEnd"),n.selection.moveUpOrDown(!1),void(t.codemirrorIgnore=!0)}else if("PageUp"==F.keyNames[a]){if(!(o=e.doc.getCursor())||0==o.line&&0==o.ch)return e.execCommand("goDocStart"),n.selection.moveUpOrDown(!0),void(t.codemirrorIgnore=!0)}else if("Enter"==F.keyNames[a]&&r(e,t))return t.codemirrorIgnore;(F.keyMap.macDefault[s]||F.keyMap.pcDefault[s])&&t.stopPropagation()}addCodeBlock(r){var o=this.editor,a=this;function n(e){var t=o.getNode(e.cid),n=o.undo.UndoManager,i=n.makeEmptyCommand();a.beforeDeleteFences(e.cid),i.undo.push({type:"fences-pos",pos:e.getCursor(),id:e.cid}),n.append(i,o.UserOp.backToParagraph(o,t,!1)),o.undo.register(i)}function i(e,t){var n;if((File.isMac?t.metaKey:t.ctrlKey)&&!(0<e.getSelection().length))return n=e.doc.getCursor(),e.lineCount()-1==n.line&&n.ch>=e.doc.getLine(n.line).length?(o.UserOp.insertParagraph(!1),t.stopPropagation(),t.codemirrorIgnore=!0):void 0}function e(e,t){a.onKeyDown(e,t,o,n,i)}function t(e){o.refocus(r.id),e.getWrapperElement().offsetHeight||e.refresh();var t,n,i=S(e.getWrapperElement()).closest(".md-fences");i.find(".md-tooltip-remove").length||(t=i.attr("lang")||"",(n=document.createElement("div")).setAttribute("class","code-tooltip md-tooltip-remove"),n.setAttribute("align","right"),n.setAttribute("contenteditable","false"),n.innerHTML="<span class='ty-input ty-input-after ty-cm-lang-input' contenteditable tabindex='-1' autocorrect='false' placeholder='"+S.localize.getString("code language")+"'></span>",n.childNodes[0].textContent=t||"",t=n,i[0].insertChildAtIndex(t,1),function(e,t){var n=this;e.on("change blur",function(){this.textContent!=t.get("lang")&&n.tryAddLangUndo(t,this)}).keydown(function(e){e=e.which||e.keyCode;"Enter"==_[e]&&S(this).trigger("change")}).focus(function(){File.isMac&&bridge.callHandler("touchBar.setFencesOnSetLang",!0)}).on("keydown",function(e){var t,e=e.keyCode||e.which;return"Delete"==_[e]?!(!(t=n.editor.selection.getRangy())||t.commonAncestorContainer.parentElement!=this)&&(t.commonAncestorContainer==this||t.startOffset==t.endOffset&&t.endOffset==this.textContent.length?(n.editor.selection.moveUpOrDown(!1),!1):void 0):"Backspace"==_[e]?!(!(t=n.editor.selection.getRangy())||t.commonAncestorContainer.parentElement!=this)&&(t.commonAncestorContainer==this||t.startOffset==t.endOffset&&0==t.startOffset?(n.editor.selection.moveUpOrDown(!0),!1):void 0):"Return"==_[e]||"Enter"==_[e]?(n.editor.autoComplete.isShown()||n.editor.selection.moveUpOrDown(!1),!1):void 0}).on("paste",function(e){setTimeout(function(){e.target.textContent=e.target.textContent.replace(/(^\n+)|(\n+$)/g,"").split(/\r?\n/)[0],S(e.target).trigger("change")},0)}).on("input",function(e){this.querySelector(":not(br)")&&(this.textContent=this.textContent.replace(/(^\n+)|(\n+$)/g,""))}),this.editor.autoComplete.show(A,e[0],void 0,{type:"fences",render:this.autoCompleteRender})}.call(a,S(t).find(".ty-input"),r)),d(e),E.isDiagramType(e.options.mode)&&o.diagrams.startPreview(e.cid),T.isMathType(r.get("lang"))&&(i[0].style.marginBottom=i.find(".md-fences-adv-panel").height()+20+"px"),File.isMac&&bridge.callHandler("touchBar.setFencesOnSetLang",!1)}function s(e,t){File.isNodeHtml&&File.editor.contextMenu.show(t,e.getWrapperElement())}function l(e,t){L(e,t),o.wordCount.quickUpdate(e.cid),o.selection.clearGlobalColumn(),E.isDiagramType(e.options.mode)&&o.diagrams.updateDiagram(e.cid),T.isMathType(r.get("lang"))&&o.mathBlock.renderUnder(o.findElemById(e.cid)[0],!0),File.isTypeWriterMode&&!File.option.scrollWithCursor&&o.selection.typeWriterScroll(e.cursorCoords(e.getCursor())),r.set("text",e.getValue()),t.length&&t[0].origin&&o.syncChange([{type:"sync",id:e.cid,cmChanges:t}])}function c(e,t){E.isDiagramType(e.options.mode)&&t.ranges.length&&t.ranges[0].anchor.line!=(e.getCursor()||{}).line&&o.diagrams.attachError(e)}function d(e,t){e.hasFocus()&&(a.handleCursorActivity(e),o.wordCount.updateInSelection())}function u(e,t){File.isTypeWriterMode&&t.preventDefault()}function h(e,t){var n;"TEXTAREA"===document.activeElement.tagName||(n=(o.selection.getRangy()||{}).commonAncestorContainer)&&n==e.display.lineDiv&&e.display.lineDiv.contains(n)||(t.codemirrorIgnore=!0)}if(r="string"==typeof r?this.editor.getNode(r):r){if(!this.queue[r.id]&&r.get("type")==k.TYPE.fences){var p=S("[cid = "+r.id+"]").removeClass("mock-cm");if(!p.length)return;var f=p.find(".md-fences-adv-panel").clone(),m=(p.addClass("ty-contain-cm").html(""),getCodeMirrorMode(r.get("lang"))),m=(r.id,this.modeLoaded,{lineWrapping:!File.option.noLineWrapping,mode:m,styleSelectedText:!0,maxHighlightLength:1/0,viewportMargin:1/0,styleActiveLine:!0,autoCloseBrackets:!File.option.noPairingMatch,autoCloseTags:!File.option.noPairingMatch,theme:" inner null-scroll",lineNumbers:File.option.showLineNumbersForFence,resetSelectionOnContextMenu:!0,cursorScrollMargin:60,dragDrop:!1,indentUnit:File.option.codeIndentSize,tabSize:File.option.codeIndentSize,lineWiseCopyCut:File.option.lineWiseCopyCut,scrollbarStyle:"null",value:r.safeGetStrAttr("text")}),g=(Object.assign(m,M(r.get("lang"))),F(p[0],m,this.editor,r.id)),y=(console.log(m),(this.queue[r.id]=g).off("keydown",e),g.on("keydown",e),g.off("focus",t),g.on("focus",t),g.off("changes",l),g.on("changes",l),g.off("scrollCursorIntoView",u),g.on("scrollCursorIntoView",u),g.off("cursorActivity",d),g.on("cursorActivity",d),g.off("contextmenu",s),g.on("contextmenu",s),g.off("beforeSelectionChange",c),g.on("beforeSelectionChange",c),g.off("copy",h),g.on("copy",h),g.off("cut",h),g.on("cut",h),g);if(o.searchPanel){g=o.searchPanel.searchStatus;if(g){var v=g.hits;if(v.length&&!(v.length>o.searchPanel.MAX_HITS_COUNT)){for(var b=-1,w=-1,x=0;x<v.length;x++){var C=v[x];if(C.cid==y.cid&&C.isFutureCm)b<0&&(b=x),w=x,C.isFutureCm=!1,C.isCm=y;else if(0<w)break}-1!=b&&a.searchOn(y,g.searchText,g)}}}p.children(".CodeMirror").attr("lang",(r.get("lang")||"").toLowerCase()),this.modeLoaded&&p.addClass("modeLoaded"),!File.option.showLineNumbersForFence&&m.lineNumbers&&p.addClass("md-fences-with-lineno"),f.length&&p.append(f);g=p.closest("li");g.length&&(g[0].style.display="block",g[0].style.display="")}return this.editor.tryEnterBusyModeWithDelay(),this.queue[r.id]}}toggleFocusedComponent(){var e,t=document.activeElement,n=S(t).closest(".md-fences");n.length&&(t.classList&&t.classList.contains("ty-cm-lang-input")?(t=n.attr("cid"),e=(t=this.getCm(t)).getCursor(),t.focus(),t.setCursor(e)):n.find(".CodeMirror-focused").removeClass("CodeMirror-focused").end().find(".ty-input").show().focus())}focus(e){e="string"==typeof e?e:e.id;this.getCm(e).focus()}getFocused(){for(var e in this.queue)if(this.queue.hasOwnProperty(e)&&this.queue[e].hasFocus())return this.queue[e]}updateCodeNum(){for(var e in this.queue)this.editor.getNode(e)||delete this.queue[e]}copyContent(){var e=this.editor.getNode(null,!0),t=this.editor.UserOp.setClipboard,n=e.get("text");t(`<pre lang='${e.get("lang")||""}'>${a.escape(n)}</pre>`,void 0,n,!0)}formatContent(e){if(this.editor.sourceView.inSourceMode)t=this.editor.sourceView.cm;else{var t,n=this.editor.getNode(null,!0);if(!(t=(this.editor.findElemById(n.id).find(".CodeMirror")[0]||{}).CodeMirror))return void File.editor.UserOp.lessIndent(File.editor)}n=t.listSelections();e||t.execCommand("selectAll"),t.execCommand("indentAuto"),e||t.setSelections(n)}syncToNode(e){var t,e="string"==typeof e?this.editor.getNode(e):e;e&&(t=this.getCm(e.id),e.get("text")!==t.getValue())&&e.set("text",t.getValue())}decorateAll(){this.refreshEditor(!0,!1)}intersectionObserve(e,t){this.continueRenderTimer&&clearTimeout(this.continueRenderTimer),this.intersectionObserver&&t&&this.intersectionObserver.disconnect();var n=this;e&&(this.intersectionObserver||(this.intersectionObserver=new IntersectionObserver(function(e){e.forEach(function(e){e.intersectionRatio<=0||(n.addCodeBlock(e.target.getAttribute("cid")),n.intersectionObserver&&n.intersectionObserver.unobserve(e.target))})})),this.intersectionObserver.observe(e))}refreshEditor(n,e,i){if(this.modeLoaded){var t,r=this,o=0;for(t in this.queue){var a,s=this.editor.findElemById(t);s.find(".CodeMirror").length&&this.editor.getNode(t)?(a=this.queue[t],s.hasClass("modeLoaded")?e&&a.refresh():(s=this.editor.getNode(t),a.setOption("mode",getCodeMirrorMode(s.get("lang"))),a.refresh()),o++):delete this.queue[t]}var l=(i||document).querySelectorAll("[mdtype='fences']"),c=window.IntersectionObserver?8:30,d=0;l.length!=o&&l.forEach(function(e){var t=e.getAttribute("cid");r.queue[t]?i||d++:n||!File.inBusyMode&&d<c?(r.addCodeBlock(t),d++):window.IntersectionObserver&&r.intersectionObserve(e)})}}lazyload(){var e=this;S.getScript((File.isNode&&!window.debugMode?"./lib.asar":"./lib")+"/codemirror/mode.min.js").then(function(){e.modeLoaded=!0,e.refreshEditor(),e.editor.tryEnterBusyModeWithDelay()})}jumpCmEnd(e){var t,n=e;"string"==typeof e?n=this.getCm(e):n.cid;n&&(e=n.doc.lastLine(),t=n.doc.getLine(e).length,n.focus(),n.setCursor({line:e,ch:t}))}jumpCmBegin(e){(e="string"==typeof e?this.getCm(e):e).focus(),e.setCursor({line:0,ch:0})}beforeDeleteFences(e,t){var n,i;"string"==typeof e?(n=this.queue[e],i=this.editor.getNode(e)):(i=e,n=this.queue[i.id]),n&&(i.get("text")!==n.getValue()&&i.set("text",n.getValue()),n.doc.clearHistory(),delete this.queue[i.id],t)&&t.map(function(e){e&&(e.id==i.id&&e.json&&e.json.content&&e.json.content.type==k.TYPE.fences?e.json.content.text=i.get("text"):Array.isArray(e.json)&&e.json.map(function(e){e.id==i.id&&e.content.type==k.TYPE.fences&&(e.content.text=i.get("text"))}))})}searchOn(e,t,n){this.searchStatus=this.searchStatus||{},this.searchStatus.overlay=this.searchStatus.overlay||{},this.searchStatus.queue=this.searchStatus.queue||[];var i=null;if(n.useRegexp)try{n.wholeWord&&(t=`\\b${t.replace(/^\\b|\\b$/g,"")}\\b`),i=new RegExp(t,n.caseSensitive?"g":"gi")}catch(e){return}else i=n.wholeWord?new RegExp("\\b"+a.escapeRegExp(t)+"\\b",n.caseSensitive?"g":"gi"):new RegExp(a.escapeRegExp(t),n.caseSensitive?"g":"gi");this.searchStatus.overlay[e.cid||"source"]={searchExp:i,token:function(e){var t=this.searchExp,t=(t.lastIndex=e.pos,t.exec(e.string));return t&&t.index==e.pos?(e.pos+=t[0].length||1,"search-hit"):(t?e.pos=t.index:e.skipToEnd(),null)}},e.addOverlay(this.searchStatus.overlay[e.cid||"source"]),this.searchStatus.queue.push(e)}clearSearchOn(e){this.searchStatus&&(e.removeOverlay(this.searchStatus.overlay[e.cid||"source"]),this.searchStatus.queue.remove(e))}clearSearchAll(){this.editor.sourceView.inSourceMode?this.searchStatus&&this.editor.sourceView.cm.removeOverlay(this.searchStatus.overlay.source):this.searchStatus&&this.searchStatus.overlay&&this.searchStatus.queue.forEach(function(e){this.searchStatus.overlay[e.cid]&&e.removeOverlay(this.searchStatus.overlay[e.cid])},this),this.searchStatus=null}renderFences(e){return f.renderFences(e)}tryAddLangUndo(e,t){return!(!(t=t||document.activeElement).classList||!t.classList.contains("ty-cm-lang-input")||!(e=e||this.editor.getNode(S(t).closest("[cid]").attr("cid")))||(e.get("lang")||"")==(t=t.textContent||"")||(e.attr("lang",t,this.editor,!1),0))}getCodeLangSuggest(e){var e=(e?File.option.DefaultCodeLangOptionMenu:File.option.DefaultCodeLangOptionCode)||0,t=this.editor.localSettingBridge.getSetting("defaultCodeLang");return"__LAST"===(t=File.option.defaultCodeLangOption&e?t:"")?this.lastCodeLang||"":t}autoSuggestCodeLang(e){var t,n,e=e.key;return("`"==e||"~"==e)&&((t=this.editor.getMarkElem()).attr("mdtype")==k.TYPE.paragraph&&(n=this.getCodeLangSuggest(!1))?("``"===t.rawText()&&"`"==e||"~~"===t.rawText()&&"~"==e)&&(this.editor.selection.jumpIntoElemEnd(t),this.editor.insertText(e),setTimeout(()=>{this.editor.undo.endSnap(!0),this.editor.selection.jumpIntoElemEnd(t),this.editor.insertText(n),this.editor.brush.brushNode(t.attr("cid")),editor.selection.restoreSelection(t[0],{start:3,end:3+n.length})},0),!0):void 0)}}f.renderFencesByUpdate=function(e,t,n){var i;t.classList.remove("md-diagram"),t.classList.remove("md-fences-math"),t.classList.remove("md-fences-advanced"),E.isDiagramType(n)&&(t.classList.add("md-diagram"),t.classList.add("md-fences-advanced"),(i=File.editor.findElemById(e.cid)).find("textarea").val()==e.get("text"))&&(i=i.find(".md-diagram-panel").clone()[0])&&t.appendChild(i),T.isMathType(n)&&(t.classList.add("md-fences-math"),t.classList.add("md-fences-advanced"),t.setAttribute("id","mathjax-"+e.cid))},f.renderFences=function(e){var t=document.createElement("PRE"),n=(t.classList.add("md-fences"),t.classList.add("mock-cm"),t.classList.add("md-end-block"),File.option.showLineNumbersForFence&&t.classList.add("md-fences-with-lineno"),e.get("lang")),i=e.get("text");return t.setAttribute("spellcheck","false"),t.setAttribute("contenteditable","false"),t.setAttribute("lang",n||""),t.setAttribute("cid",e.cid),t.setAttribute("mdtype",e.get("type")),t.innerText=i,t.innerText||(t.innerHTML="<br/>"),f.renderFencesByUpdate(e,t,n),t.outerHTML},n.exports=f,window.CodeMirror=F,window.Fences=f}),$__System.registerDynamic("27",["e","13","1b","26","28","29","11","1d"],!0,function(e,t,n){"use strict";this||self;async function a(e,t,n,i){if(!t.length)return!1;(i=i&&!!window.IntersectionObserver)||n||e.brush.pause();var r,o=60<t.length;return i?(r=this,u&&u.disconnect(),u=new IntersectionObserver(function(e){e.forEach(async function(e){e.intersectionRatio<=0||(await h.call(r,e.target),u&&u.unobserve(e.target),o&&p())})}),t.forEach(function(e){u.observe(e)})):(await Promise.all(Array.from(t).map(e=>this.isUnderPreview(e)?Promise.resolve():h.call(this,e,n))),o&&p()),i||n||e.brush.resume(),!0}var i,s,l=e("e"),r=(e("13").Node,e("1b"),e("26")),c=e("28"),o=e("29"),d=(r.map,e("11")),u=(e("1d"),window.svgCache={},null),h=async function(e){if(e){var t=e.querySelector("script").textContent.replace(/\u200B+/g,""),n="";try{n=await MathJax.tex2svgPromise(t,{display:!1})}catch(e){return void window.Reporter.error("MathJax Error",{level:"warning",extra:{text:t,stack:e.stack}})}var i=e.querySelector("mjx-container"),i=(i&&i.remove(),e.prepend(n),e.parentElement);i&&!i.classList.contains("math-jax-postprocess")&&(i.classList.add("math-jax-postprocess"),i.classList.remove("math-jax-preprocess"),(((n=e.cloneNode(!0)).querySelector("script")||{}).textContent||"").replace(/\u200B+/g,"")===t)&&(svgCache[t]=o.processExportedSVG(n.innerHTML,!0))}},p=function(){i&&clearTimeout(i),i=setTimeout(function(){File.editor.tryEnterBusyMode(),i=null},100)},f=null,m={},g=async function(r,e){s=e[0];var o=l("#math-inline-preview"),i=document.querySelector("#math-inline-preview-content"),t=e.find("script").text();async function a(t,e){if(MathJax.tex2svg){if(i.dataset.text=t,m[t]||svgCache[t]){if(i.innerHTML=m[t]||svgCache[t],!i.querySelector("rect")&&!m[t])return;m[t]=m[t]||svgCache[t]}try{var n=e?MathJax.tex2svg(t,{display:!1}):await MathJax.tex2svgPromise(t,{display:!1});i.innerHTML="",i.appendChild(n)}catch(e){window.Reporter.error("MathJax Error",{level:"warning",extra:{text:t,stack:e.stack}})}}}var n=!(f=async function(){var e=l(".md-inline-math.md-expand"),t=e.find("script"),n=t.text().replace(/\u200B+/g,""),i=f;if(!t.height())return l(r.sessionStr).off("inline-math-changed",i);svgCache[n]||(await a(n),c.fixPopoverPosition(t,o),e.find("mjx-container").replaceWith(o.find("mjx-container").clone()))});!(n=e.hasClass("math-jax-postprocess")&&(i.dataset.text||"").replace(/[\s\u200b]/g,"")!=t.replace(/[\s\u200b]/g,"")?!0:n)&&"none"!==o[0].style.display||(l(r.sessionStr).off("inline-math-changed"),l(r.sessionStr).on("inline-math-changed",f),await a(t,!0),delete svgCache[t],o.show(),c.fixPopoverPosition(e.find("script"),o))},y=function(e){s=null;var t=l("#math-inline-preview");"none"!==t[0].style.display&&t.hide(),f&&(l(e.sessionStr).off("inline-math-changed",f),f=null)};n.exports=class{constructor(e){this.editor=e,this.queue={},function(){var i=this.editor;l(this.editor.sessionStr).on("cursorChange",function(e,t){if(t){var t=t.cursor||i.selection.getRangy();if(!t)return y(i);(t=l(t.commonAncestorContainer).closest(".md-inline-math.md-expand")).find("script").length?s!=t[0]&&(y(i),g(i,t)):y(i)}}).on("mousedown",".md-inline-math mjx-container",function(e){var t,n;y(i),l(".md-expand").removeClass("md-expand"),File.isLocked||(n=(t=l(this).closest(".md-inline-math")).addClass("md-expand").find("script"),i.selection.selectAllElem(n),g(i,t))})}.call(this)}isUnderPreview(e){return s==e}async brush(e,t,n){var i=e.querySelectorAll(".math-jax-preprocess .md-inline-math-container");return await a.call(this,this.editor,i,n&&t&&e.getAttribute("cid")===t.startId?t:null),i.length}showAutoSuggest(e){File.option.enableInlineMath&&(l(".md-math-prep").removeClass("md-math-prep"),c.markRange(e,"md-math-prep"),(e=l("#math-inline-preview").show().addClass("md-math-inline-prep-preview").css("width","auto")).find("#math-inline-preview-content").text("<Empty Inline Math>"),c.fixPopoverPosition(l(".md-math-prep"),e))}onLeaveDocument(){u&&u.disconnect();try{MathJax.texReset(0)}catch(e){}}async renderAll(e,t,n,i){var r;function o(e){try{e.querySelector("mjx-container").remove()}catch(e){}e.parentElement.classList.add("math-jax-preprocess"),e.parentElement.classList.remove("math-jax-postprocess")}File.option.enableInlineMath&&(r=[],n?r=Array.from(document.querySelectorAll(".md-inline-math-container")).filter(e=>{var t;return!!e.parentElement.classList.contains("math-jax-preprocess")||(t=e.querySelector("script").innerText,/\\(label|(eq)?ref)\{/.exec(t)?(delete window.svgCache[t],o(e),!0):void 0)}):e?(window.svgCache={},(r=document.querySelectorAll(".md-inline-math-container")).forEach(o)):r=(t||document).querySelectorAll(".math-jax-preprocess .md-inline-math-container"),r.length)&&(await a.call(this,this.editor,r,void 0,(File.inBusyMode&&!t||1e3<r.length)&&!e&&!i),this.renderInToc())}renderInToc(){File.option.enableInlineMath&&this.editor.mathBlock.isMathJaxReady()&&document.querySelectorAll(".math-in-toc").forEach(async function(e){try{var t,n,i;e.children[0]&&e.children[0].tagName=="mjx-container".toUpperCase()||(t=e.textContent.replace(/(^\$+)|(\$+$)|\u200B/g,""),(n=svgCache[t])?e.innerHTML=n:(i=await MathJax.tex2svgPromise(t,{display:!1}),e.innerHTML="",e.appendChild(i)))}catch(e){window.Reporter.captureException(e,{level:"warning"})}},this)}tryCloseInlinePreview(){y(this.editor)}copyAsTex(){var e=function(){var e=this.editor.selection.getRangy();return l(e.commonAncestorContainer).closest(".md-inline-math")}.call(this),t=e.attr("pattern"),e=e.text().replace("$$"==t?/(^\$\$)|(\$\$$)/g:/(^\$)|(\$$)/g,"");this.editor.UserOp.setClipboard(null,null,e,!0)}copyAsMathML(e){var t,n=l("#math-inline-preview-content")[0];n&&(n=n.dataset.text,t=this.editor,n=MathJax.tex2mml(n,{display:!1}),e?t.UserOp.nativeCopyText(n):(e="<pre class='md-fences' lang='xml'>"+d.escape(n)+"</pre>",t.UserOp.setClipboard(e,null,n,!0)))}copyAsImage(){var e=document.querySelector("#math-inline-preview-content svg"),t=this.editor,e=o.SVG2HtmlImg(e);t.UserOp.setClipboard(e,null,e,!0)}}}),$__System.registerDynamic("2a",["2b","11","19","13","2c","1b","29","1d"],!0,function(e,t,n){"use strict";this||self,e("2b");function i(e){this.editor=e,this.queue=[],this.interval=200,this.inline=new y.InlineLexer,this.articleArea=document.querySelector(this.editor.sessionStr)}var r=e("11"),y=e("19"),o=e("13"),w=o.Node,x=o.TYPE,v=e("2c"),o=e("1b"),C=e("29"),p=o.SnapFlag,b=(e("1d"),i.prototype={addToQueue:function(e,t){t=t||!1,r.isNullOrEmpty(e)||this.queue.push({cid:e,inlineOnly:t})},run:function(){this.timerID||this.scheduleNext(),this.editor._brushInitCallback&&(this.editor._brushInitCallback(),this.editor._brushInitCallback=null)},scheduleNext:function(){var e=this;this.timerID=window.setTimeout(async function(){await e.brushQueue(),e.scheduleNext()},this.interval)},clearAndPause:function(){this.willExpandSoon&&clearTimeout(this.willExpandSoon),this.queue=[],this.pause()},pause:function(){clearTimeout(this.timerID),this.timerID=null,this.editor.mathBlock&&this.editor.mathBlock.clearCache()},resume:async function(e){e&&await this.brushQueue(),this.run()},restart:function(){this.queue=[],this.run()},brushNode:function(e){var t=this.editor.selection.buildUndo();k.call(this,e,{},t,!1)&&this.editor.undo.exeCommand(t)},brushQueue:async function(){var t,n,i,e,r,o,a,s=this,l={},c=s.queue.length;function d(e){return e.closest?e:e.parentElement}this.editor.isIME||this.editor.isMousePressed||(0<s.queue.length&&!File.isLocked&&(s.queue,n=!(t=!1),(a=s.editor.selection.getRangy())&&(r=(e=d(a.startContainer)).closest("[cid]"),o=d(a.endContainer).closest("[cid]"),r&&r.querySelectorAll(".md-math-after-sym").forEach(function(e){var t=e.textContent.replace(/\u200b/g,"");t!=e.textContent&&(e.textContent=t)}),o&&o!=r&&o.querySelectorAll(".md-math-after-sym").forEach(function(e){e.textContent=e.textContent.replace(/\u200b/g,"")}),a.collapsed)&&!a.startContainer.parentElement&&(a.selectNode(e),a.collapse(!1),s.editor.selection.setRange(a)),i=s.editor.selection.buildUndo(),await Promise.all(s.queue.map(e=>async function(e){return l[e.cid]||(l[e.cid]=1,t=await k.call(s,e.cid,l,i,e.inlineOnly,!0)||t,n=n&&e.inlineOnly),Promise.resolve()}(e))),s.queue=[],t&&i&&s.editor.undo.exeCommand(i),this.expand(!0,!1,n)),c&&this.triggerAutoComplete())},triggerAutoComplete:function(e){var t,n,i=null,r=null,o=this.editor,a=this.editor.autoComplete,s=this.editor.selection.getTextAround(),l=s[0],c=s[1],s=s[2],d=this.editor.getJQueryElem((this.editor.selection.getRangy()||{}).commonAncestorContainer),u=d.closest(".md-inline-math").length,e=e&&File.option.enableInlineMath,h=this.editor.selection.getRangy();if(s&&h&&h.collapsed&&(l||c)){if(o.lastCursor=o.selection.buildUndo(h),n=function(){if(h&&h.collapsed){var e=$(h.endContainer).closest(".md-lang"),t=e.text(),n=e.prev().text().length+e.parent().prevAll().text().length;if(t)return i={start:n,end:n+t.length,containerNode:e.closest("[mdtype]")[0]},t}}.call(this))return void a.show(this.editor.fences.ALL,i,n,{type:"fences",render:this.editor.fences.autoCompleteRender});if(r=/:(\w+)$/.exec(l))return void((t=/^(\w*:*)(\s|$)/.exec(c||""))&&(s.start-=r[1].length+1,s.end+=t[1].length,i=s,a.show([],i,r[1]+t[1],this.editor.emoji.autoCompleteOption())));e&&(n=/\$?\$$/.exec(l))&&0==$(".md-expand.md-inline-math").length&&(a=(/^\$+/.exec(c)||"").length)<=n[0].length&&((a="$".repeat(n[0].length-a)).length&&(h.insertNode(document.createTextNode(a)),h.collapse(!0)),s.start-=n[0].length,s.end+=n[0].length,h.moveToBookmark(s),o.mathInline.showAutoSuggest(h),o.restoreLastCursor(null,!0),o.undo.addSnap(o.focusCid,p.REPLACE),i=null)}else u&&d.trigger("inline-math-changed");this.editor.autoComplete.hide()},expandOnDelay:function(e){var t=this;this.willExpandSoon&&clearTimeout(this.willExpandSoon),this.willExpandSoon=setTimeout(function(){t.expand(e)},10)},closestExpandable:function(e){var t,e=e.closest("[md-inline]"),n=e.parent().closest("[md-inline]");return!n.length||(t=e.attr("md-inline"))&&!w.isType(t,x.plain,x.br,x.tag,x.autolink,x.pants,x.attr,x.linebreak)&&e.prevAll("[md-inline]").length||e.nextAll("[md-inline]").length?e:this.closestExpandable(n)},expand:function(l,e,t,c){if(e||this.editor.wordCount.updateInSelection(),this.willExpandSoon&&(clearTimeout(this.willExpandSoon),this.willExpandSoon=null),!this.editor.isIME&&!File.isLocked){var n,i=this.editor.selection,r=i.getRangy(),o=i.rangy,a=r?r.cloneRange():null;if(a&&(a.startContainer!=this.editor.writingArea||0!=a.startOffset))if($(".selected").removeClass("selected"),r){this.editor.selection.deRange(r),n=this.editor.getJQueryElem(r.commonAncestorContainer),this.editor.stylize.putBookmark(a,this.editor.stylize.buildBookmark(n));var s,d,u,h=n;try{var p,f,m=document.querySelector(".md-inline-math.md-expand");!m||h.length&&m.contains(h[0])||(p=m.querySelector(".md-inline-math-container script"),(f=(f=svgCache[p.innerHTML])?$(f)[0]:document.querySelector("#math-inline-preview-content mjx-container"))&&($(m.querySelector("mjx-container")).replaceWith(f),window.svgCache[p.textContent]=C.processExportedSVG(m.querySelector(".md-inline-math-container").innerHTML,!0)))}catch(e){}if(e||t||!function(e,t){var n=e.closest("[cid]");if(n.length&&e.closest("[md-inline]").length&&!e.closest(".md-block-like").length){n=n.find(".md-block-like");if(!n.length)return;var e=editor.findNodeByElem(e.closest("[cid]")),i=editor.selection.buildUndo(t);if(e.cid!=i.endId)return;var r=n.prevAll().rawText().length,o=n.rawText().length;if(!editor.lastCursor||editor.lastCursor.endId!=i.endId||editor.lastCursor.startOffset>r+o||editor.lastCursor.endOffset<r+o)return;var a=!1,t=(t.comparePoint(n[0],0)<0&&(i.start=i.end=i.end-r-o,a=!0),editor.simpleParse(e,!1));if(t)return editor.findElemById(t[2]).replaceWith(t[1]),a&&1<t[3].length&&(i.startId=i.endId=t[3].last().getVeryFirst().cid),editor.undo.exeCommand(i),t[0].undo[0]=editor.lastCursor,t[0].redo.push(editor.selection.buildUndo()),editor.undo.register(t[0]),editor.quickRefresh(),1}}(n,r))return isInputComponent(document.activeElement)||"write"!==document.activeElement.id&&document.activeElement.hasAttribute("tabindex")?($(".md-expand").removeClass("md-expand"),$(this.editor.sessionStr).trigger("cursorChange",this.editor.styleBookmark)):!n.closest("[cid]").length&&!n.find("[cid]").length||w.isType(n.closest("[cid]").attr("mdtype"),x.fences,x.math_block,x.html_block)?$(this.editor.sessionStr).trigger("cursorChange",this.editor.styleBookmark):(r.collapsed?(h=S(n),f=n.closest("[mdtype]"),s=[],(m=0<(p=h.visibleText().length)&&p<h.text().length&&g(r,h[0]))?([e,t]=m,d=$(e).addClass("md-expand"),a=o.createRange(),t?a.collapseToPoint(e,(e.childNodes||e).length):a.collapseToPoint(e,0),this.editor.selection.setRange(a,!0)):(y(r,-1),$(r.endContainer).parent().hasClass("md-softbreak")&&a.startContainer===a.endContainer&&(r=a.cloneRange()),d=f[0]!=$(r.startContainer).closest("[mdtype]")[0]?h:S(this.editor.getJQueryElem(r.startContainer)),r.startContainer===r.endContainer&&(r.toString().length&&r.collapse(!1),3==r.endContainer.nodeType&&r.endOffset==r.endContainer.textContent.length&&b(r.endContainer.nextElementSibling)?(r.endContainer.nextElementSibling.classList.add("selected"),r.selectNode(r.endContainer.nextElementSibling)):(y(r,1),(o=r.getNodes([1],b)).length&&(a.setStart(o[0],0),a.setEnd(o[0],0),editor.selection.setRange(a,!0)))))):d=S(this.editor.getJQueryElem(r.startContainer)),(s=S(this.editor.getJQueryElem(r.endContainer))).length||(s=d),d.length||s.length?(u=!1,a.collapsed||(u=(a=v(a)||a)&&!a.collapsed),$(".md-expand").removeClass("md-expand"),d.length?F.call(this,d):F.call(this,s),d.length&&s.length&&!s.hasClass("md-img-loaded")&&F.call(this,s,!0)):$(".md-expand").removeClass("md-expand"),u?this.editor.selection.deRange(a,!0,a.cloneRange()):((t=window.getSelection().anchorNode)&&(3===t.nodeType||t.hasAttribute&&t.hasAttribute("contenteditable"))&&(a=a||this.editor.selection.getRangy(),this.editor.selection.deRange(a,!0,a.cloneRange())),a.commonAncestorContainer.parentElement&&a.commonAncestorContainer.parentElement.classList.contains("ty-focusable-btn")?a.commonAncestorContainer.parentElement.classList.add("selected"):b(t)&&t.classList.add("selected")),void $(this.editor.sessionStr).trigger("cursorChange",this.editor.styleBookmark));function g(e,t){if(t){if(e.endOffset==e.endContainer.length||"​"==e.endContainer.textContent){for(var n=e.endContainer;(t.contains(n)||t==n)&&!n.parentElement.getAttribute("cid")&&function(e){for(var t=e.nextSibling;t;){if(t.offsetWidth)return;t=t.nextSibling}return 1}(n);)n=n.parentElement;return[n,!0]}if(0==e.startOffset){for(var i=e.startContainer;(t.contains(i)||t==i)&&!i.parentElement.getAttribute("cid")&&(!(r=i).previousSibling||1==r.previousSibling.nodeType&&!r.previousSibling.offsetWidth);)i=i.parentElement;return[i,!1]}var r}return null}}else n=this.editor.getMarkElem(),$(".md-expand").removeClass("md-expand"),n.length&&w.isType(n.attr("mdtype"),w.TYPE.hr,w.TYPE.toc)&&(this.editor.stylize.putBookmark(null,this.editor.stylize.buildBookmark(n)),$(this.editor.sessionStr).trigger("cursorChange",this.editor.styleBookmark))}function y(e,t){i.extendRange(e,t)}function v(e){var t,n=e.collapsed,i=!1;try{var r,o,a=e.commonAncestorContainer;if(0==e.startOffset&&d.length&&(d=editor.getJQueryElem(e.startContainer)).length)if(d.closest(".md-expand").length||d[0].hasAttribute("cid")||d[0].querySelector("[cid]")||d.closest(".md-image:not(.md-img-loaded)").length)(o=d.closest(".md-expand")).length&&(d=o);else{if(r=d.closest("[cid]")[0],!(d=function e(t,n){var i;return t.prevAll(":not(.md-meta, .md-content)").text().length?S(t):(i=t.parent()).attr("mdtype")?t:n.contains(i[0])||l?e(i,n):S(t)}(d,a.contains&&a.contains(r)?r:a)).length)return null;t=e.cloneRange(),e.setStartBefore(d[0]),i=!c&&!n&&0==e.startOffset&&e.startContainer.getAttribute&&e.startContainer.getAttribute("cid"),e.containsNode(d[0])||(e=t),n&&e.collapse(!0)}if(e.endOffset==(e.endContainer.nodeType===document.TEXT_NODE?e.endContainer:e.endContainer.childNodes).length){var s=editor.getJQueryElem(e.endContainer);if(s.length)if(s.closest(".md-expand").length||s[0].hasAttribute("cid")||s[0].querySelector("[cid]")||s.closest(".md-image:not(.md-img-loaded)").length)(o=s.closest(".md-expand")).length&&(s=o);else{if(r=s.closest("[cid]")[0],!(s=function e(t,n){var i;return t.nextAll(":not(.md-meta, .md-content)").text().length||(i=t.parent()).hasClass("[mdtype]")||i[0].contains(n)?S(t):e(i,n)}(s,a.contains&&a.contains(r)?r:a)).length)return null;t=e.cloneRange(),e.setEndAfter(s[0]),i&&e.endContainer.childNodes&&e.endContainer.childNodes.length==e.endOffset?e.setStartBefore(d[0]):e.containsNode(s[0])||(e=t),n&&e.collapse(!1)}}}catch(e){console.warn(e)}return e}function b(e){return e&&e.classList&&e.classList.contains("ty-focusable-btn")}},focusContainer:function(e){b.call(this,e)}},function(e){var t=e.closest("tr.md-end-block, li[cid]")[0],n=e[0];if(t&&n){for(;t!==n&&t.contains(n);){if(n.previousSibling&&n.previousSibling.hasAttribute&&n.previousSibling.hasAttribute("cid"))return!1;n=n.parentElement}t.classList.add("md-focus-container")}}),F=function(e,t){t||$(".md-focus-container").removeClass("md-focus-container"),e.length&&b(e.addClass("md-expand").trigger("expand").closest("[cid]").addClass("md-focus"))};function S(e){var t=e.parent().closest("[md-inline]");return t.length?S(t):e.closest("[md-inline]")}var k=async function(e,t,n,i,h){var r,o,a,s,l=e,c=e,p=0;function d(e){for(var t=0;t<e.attributes.length;t++)w.isType(e.attributes[t].name,"cid","contenteditable","id","for","onerror","onload")&&e.removeAttributeNode(e.attributes[t]);e.classList.remove("md-img-loaded"),e.classList.remove("md-img-error")}function f(e){for(var t=e.querySelectorAll("*"),n=0;n<t.length;n++)d(t[n]);d(e)}async function u(e,t,n,i,r,o){var a,s,l,c,d,u;if(e.length)return a=n.innerHtml,s=e[0].cloneNode(!0),l=document.createElement("div"),o=n.cursorDiff,c=e.find(".md-footnote").length,l.innerHTML=a,u=null,s.querySelectorAll(".md-expand").forEach(function(e){e.classList.contains("md-inline-math")&&((e.querySelector(".md-before")||{}).textContent!==(e.querySelector(".md-after")||{}).textContent?e.textContent="":u=e.rawText(!0)),e.classList.remove("md-expand")}),s.querySelectorAll(".md-inline-math").forEach(function(e){e.textContent=e.rawText(!0),e.setAttribute("id",""),u==e.textContent&&e.setAttribute("class","")}),l.querySelectorAll(".md-inline-math").forEach(function(e){e.textContent=e.rawText(!0),e.setAttribute("id",""),u==e.textContent&&e.setAttribute("class","")}),f(s),f(l),s.innerHTML.replace(/\s*class=\"\"/gi,"")!=l.innerHTML.replace(/\s*class=\"\"/gi,"")?(e.html(a),n.mdlike?e.attr("mdlike")!=n.mdlike&&e.attr("mdlike",n.mdlike):e.attr("mdlike")&&e.removeAttr("mdlike"),r.selection.clearGlobalColumn(),h?await r.mathInline.brush(e[0],i,!0):r.mathInline.brush(e[0],i,!0),d=!0):(e.hasClass("unholdable")&&e.removeClass("unholdable"),e.find(".math-jax-preprocess").length&&r.mathInline.brush(e[0],i,!0)),(e.find(".md-footnote").length||c)&&r.docMenu&&r.docMenu.refreshFootnoteReverseLink(),r.focusCid===t.cid?(function(e,t,n,i,r){if(r||t.length)return e&&(n&&n.undo.unshift(Object.clone(e)),e.start=g(t,e.start-p),e.end=g(t,e.end-p),n&&n.redo.push(e),i.undo)&&i.undo.exeCommand(e)}(i,o,n.command,r,d),!1):d}async function m(e,t,n,i,r){return n.blockChanged?(o=e,a=t,l=i,c=r,d=(s=n).cursorDiff||[],c.selection.clearGlobalColumn(),s.replaceCid?(c.findElemById(s.replaceCid).replaceWith(s.html),c.refreshUnder(c.findElemById(s.replaceCid)[0])):o.closest("p").replaceWith(s.html),s.toRemove&&s.toRemove.forEach(function(e){c.findElemById(e).remove()}),c.focusCid&&c.focusCid!==a.cid||(c.focusCid=s.focus,c.focusCid&&b(c.findElemById(c.focusCid)),l&&(s.command.undo.unshift(Object.clone(l)),d.length&&(l.start=g(d,l.start),l.end=g(d,l.end)),l.id=s.focus,l.startId=s.focus,l.endId=s.focus,l.start-=s.offset,l.end-=s.offset,s.command.redo.push(Object.clone(l))),c.undo.register(s.command)),!0):u(e,t,n,i,r);var o,a,s,l,c,d}function g(e,t){var n,i=t;for(n in e)void 0!==n&&n<=t&&(i+=e[n]);return i}try{return"string"==typeof e?l=this.editor.getNode(e):c=l.id,l?w.isType(l,x.meta_block)||-1<v.CONST.NoInline.indexOf(l.get("type"))?void 0:l.get("children").length?(l.get("children").toArray().map(function(e){t&&(t[e.id]=1),k.call(this,e,t,n,i)},this),!0):(s=this.editor.findElemById(c),l.get("type")==x.def_footnote?(o=(r=s.find(".md-def-content")).rawText(!1),p=0,a=y.quickParse(o,this,l,!0),await m(r,l,a,n,this.editor)):(o=s.rawText(!1),p=0,a=y.quickParse(o,this,l,i||!w.isType(l,x.paragraph),null,n),await m(s,l,a,n,this.editor))):void 0}catch(e){e.stack}};n.exports=i}),$__System.registerDynamic("25",["20","11","e","1b","28","1d"],!0,function(e,t,n){"use strict";this||self,e("20"),e("11");var r=e("e"),c=e("1b"),d=(e("28"),e("1d"));n.exports=class{constructor(e){this.editor=e,this.$container=r("#ty-auto-suggest"),this.onInput=e=>{this.makeVisible(),this.update(e.target.value||e.target.textContent||"")},this.onKeydown=e=>{!1===this.handleKeyEvents(e)&&(e.preventDefault(),e.stopPropagation())},this.onFocus=e=>{this.makeVisible()},this.onBlur=e=>{this.hide()},this.initState(),this.bindEvents()}bindEvents(){this.$container.on("mousedown","li[data-content]",e=>{e.preventDefault(),e.stopPropagation()}),this.$container.on("click","li[data-content]",e=>{this.apply(e.target.closest("[data-content]").getAttribute("data-content")),e.preventDefault(),e.stopPropagation()}),r(document).on("click",e=>{document.activeElement!=this.state.anchor&&document.activeElement!==editor.brush.articleArea&&this.hide()})}initState(){this.state={type:"",token:"",match:[],all:[],index:-1,anchor:null}}isShown(){return this.$container.hasClass("ty-show")}defaultSearchFuncWithoutExtract(e){return this.defaultSearchFunc(e,!0)}defaultSearchFunc(t,e){t=t.trim().toLowerCase();var n=this.state.all,i=[];return n.map(function(e){0==e.toLowerCase().indexOf(t)&&i.push(e)}),i.sort((e,t)=>e.toLowerCase().localeCompare(t.toLowerCase())),e&&1==i.length&&i[0]==v?this.state.match=[]:this.state.match=i,this.state.match}apply(a){var s=this.state.anchor,l=this.editor;a=this.state.beforeApply?this.state.beforeApply(a):a,this.hide(),s&&(void 0!==s.nodeType?function(){"INPUT"==s.tagName?s.value=a:s.hasAttribute("contenteditable")&&(s.textContent=a),s.focus(),s.select?s.select():l.selection.selectAllElem(r(this.state.anchor)),r(s).trigger("change")}.call(this):void 0!==s.start&&function(){if(l&&a){var e=l.selection.buildUndo();try{l.brush.pause(),e?l.focusCid=e.id||e.startId:l.refocus(void 0,void 0,!0);var t,n=s,i=d.createRange(),r=c.makeEmptyCommand(e||l.selection.buildUndo()),o=l.getNode(l.focusCid);r.undo.push(c.buildReplaceUndo(o)),i.moveToBookmark(n),l.selection.deRange(i),i.deleteContents(),i.insertNode(document.createTextNode(a)),n.start=n.start+=a.length,n.end=n.start,l.store(l.focusCid,!0),i.moveToBookmark(n),r.redo.push(c.buildReplaceUndo(o)),l.selection.setRange(i,!0),r.redo.push(l.selection.buildUndo()),l.undo.register(r),"fences"==this.state.type?(t=o.breakOn(!1,l),l.findElemById(t.oldCid).replaceWith(t.newHtml),l.selection.jumpIntoElemBegin(l.findElemById(t.nextFocus)),l.undo.register(t.command)):l.brush.addToQueue(l.focusCid,!0)}catch(e){console.sendError(e)}l.brush.resume(!0)}}.call(this))}postScroll(){var e=this.state.anchor,t=this.$container;t&&t.length&&e&&(e.nodeType?this.attachToDom(e):this.initState())}show(e,t,n,i){var r,o,a;this.state.anchor&&this.state.anchor.start===t.start&&null!=t.start?(this.state.anchor=t,this.update(n)):(this.initState(),{render:i,search:r,type:o,beforeApply:a}=i||{},this.state.all=this.state.match=e,this.state.type=o||"",this.state.beforeApply=a,this.render=i||function(e,t){return"<li class='"+(t?"active":"")+"' data-content=\""+e.replace(/[']/g,"&quot;")+'" > '+e+"</span></li>"},this.search=r||this.defaultSearchFunc,this.$container.css("max-height","none"),this.state.anchor=t,(e=this.$container)&&e.length&&t&&(t.nodeType&&this.attachToDom(t),void 0!==t.start&&this.attachToRange(t),void 0!==n)&&this.update(n))}attachToRange(){var e,t,n,i=this.$container;this.isShown()||(e=window.getSelection().getRangeAt(0).getClientRects()[0],t=document.querySelector("content").getBoundingClientRect(),n=200+(n=e.left-15)>window.innerWidth?window.innerWidth-200:n,i.css({top:e.bottom+(window._shouldFixFontGlitch?r("content").scrollTop()-t.top:0),left:n,right:"auto"}).addClass("ty-show"))}attachToDom(e){r(e).off("input",this.onInput).on("input",this.onInput).off("keydown",this.onKeydown).on("keydown",this.onKeydown).on("blur",this.onBlur).on("remove",function(e){r(e.target).off()})}updateDom(){var e,n,t;0==this.state.match.length?this.$container.removeClass("ty-show"):({match:e,index:n,type:t}=this.state,this.$container.addClass("ty-show").html("<ul class='auto-suggest-for-"+(t||"common")+"'>%@</ul>".replace("%@",e.map((e,t)=>this.render(e,t==n)).join(""))),"none"==this.$container.css("max-height")&&(t=this.$container.find("li")[0].clientHeight,this.state.rowHeight=t,this.$container.css("max-height",5*t+12+"px")))}updateActive(e){this.$container.find(".active").removeClass("active");var t,n,i=this.state.rowHeight;0<=this.state.index&&(n=this.$container.find("li:nth-child("+(this.state.index+1)+")").addClass("active"),t=this.$container.scrollTop(),(n=n[0].offsetTop)<t||5*i+t<n+i)&&(t=this.$container[0].querySelector("li:nth-child("+(e+1)+")"),this.$container.scrollTop(t.offsetTop))}update(e){this.state.token=e,this.state.match=this.search(e),this.state.match.length?this.state.index=Math.min(this.state.index,0):this.state.index=-1,this.updateDom()}makeVisible(){var e,t;this.state.anchor&&this.state.match.length&&(this.$container.hasClass("ty-show")||void 0!==this.state.anchor.nodeType&&(t=(e=this.state.anchor).getClientRects()[0],this.$container.css({top:t.bottom+6,left:t.left,minWidth:t.right-t.left+"px"}).addClass("ty-show"),this.update(e.value||e.textContent||"")))}hide(){this.$container.removeClass("ty-show")}handleKeyEvents(e){if(this.editor.fences.autoSuggestCodeLang(e))return!1;var{index:t,match:n}=this.state,n=n.length;if(n&&this.isShown())if(!e.shiftKey||"ArrowDown"!=e.key&&"ArrowUp"!=e.key&&"PageDown"!=e.key&&"PageUp"!=e.key&&"Home"!=e.key&&"End"!=e.key){if("ArrowDown"==e.key)return this.state.index=t<0?0:Math.min(t+1,n-1),this.updateActive(this.state.index),!1;if("ArrowUp"==e.key){if(!(t<0))return this.state.index=Math.max(t-1,0),this.updateActive(Math.max(this.state.index-4,0)),!1}else{if("PageDown"==e.key)return this.state.index=t<0?0:Math.min(t+5,n-1),this.updateActive(this.state.index),!1;if("PageUp"==e.key){if(!(t<0))return this.state.index=Math.max(t-5,0),this.updateActive(Math.max(this.state.index-4,0)),!1}else{if("End"==e.key)return this.state.index=t<0?0:n-1,this.updateActive(n-1),!1;if("Home"==e.key){if(!(t<0))return this.state.index=0,this.updateActive(0),!1}else if("Enter"==e.key){if(0<=this.state.index)return this.apply(this.state.match[this.state.index]),!1;this.hide()}else if("Escape"==e.key)return this.hide(),!1}}}else this.hide()}}}),$__System.registerDynamic("2d",["11"],!0,function(e,t,n){this||self;var c=e("11");t.getImageScaleByElection=function(r){var t,o,a;return!window.File||File.inBusyMode?Promise.resolve(1):(t=reqnode("fs"),o=reqnode("url").parse,a=new Date,new Promise(function(i,e){try{var n;/^file:/.exec(r)?(r=o(r).pathname,r=c.decodeFromEscapedURL(r),n=(/\.([^.\\\/]+)$/.exec(r)||[])[1]||"",t.readFile(r,function(e,t){e||!t?i(1):"png"==n.toLowerCase()?i(s(t)):"jpg"!=n.toLowerCase()&&"jpeg"!=n.toLowerCase()||i(l(t))})):/^https?:/.exec(r)&&JSBridge.invoke("url.request",r).then(e=>{var t,n;e?({type:e,data:t}=e,e||(r=o(r).pathname,r=c.decodeFromEscapedURL(r),e=(/\.([^.\\\/]+)$/.exec(r)||[])[1]||""),/png/i.exec(e)?(n=Buffer.concat(t.filter(function(e){return!!e}).map(function(e){return Buffer.from(e)})),i(s(n))):/jpe?g/i.exec(e)&&(n=Buffer.from(t[0]),i(l(n)))):i(1)})}catch(e){i(1)}}));function s(e){for(var t=8;t<(e||[]).length;){var n=t+8,i=t+8+e.readUInt32BE(t),r=i+4,o=e.toString("ascii",t+4,n),n=e.slice(n,i);if("pHYs"==o)return i=n.readUInt32BE(0),new Date,Math.round(.0254*i)/72||1;if(1e3<new Date-a)return 1;t=r}return 1}function l(e){for(var t,n=0;n<e.length-4;){var i=e[n],r=e[n+1];if(n+=2,255!=i)return 1;if(!t){if(t=216==r)continue;return 1}if(224==r)return 0!=e[i=n+2+5+1+1]&&1!=e[i]?1:Math.round(e.slice(i+1,i+1+2).readUInt16BE(0)/72);if(218==r)return 1;if(1e3<new Date-a)return 1;n+=e.slice(n,n+2).readUInt16BE(0)}return 1}}}),$__System.registerDynamic("2e",["e","13","2f","30","31","1b","28","11","32","2d","33","29","34","17"],!0,function(e,R,t){"use strict";var n,i=this||self,h=e("e"),l=e("13"),d=l.Node,p=l.TYPE,f=e("2f"),u=e("30"),O=e("31").rangy,m=e("1b"),g=m.SnapFlag,y=e("28"),v=e("11"),b=e("32"),I=e("2d"),w=e("33"),a=e("29"),r=(e("34"),e("17"),null),o={},s=null,c="typora-copy-images-to";function x(e){return/(^[\\\/])|(^[a-zA-Z]:)/.exec(e)}function C(e,t,n){var i;n&&e&&t&&(i=n.clientHeight,n=n.clientWidth,i)&&n&&(imagePreLoadAfterMove["file://"+e.replace(/^file:\/\//,"").replace(/\\/g,"/")]={src:t,size:"height:"+i+"px;width:"+n+"px;"})}function F(e,t){return e.replace(/(]\s*\(<?)((?:\([^)]*\)|[^()])*?)(>?[ \t]*((['"])(.*?)\5[ \t]*)?\))/,"$1"+t+"$3")}function S(e,t){return/src\s*=\s*['"]/.exec(e)?e.replace(/(src\s*=\s*(["'])).+?(\2)/i,"$1"+t+"$3"):e.replace(/(src\s*=\s*)([^\s'"]+)(\s|$)/i,'$1"'+t+'"$3')}function k(e){e.removeClass("md-on-uploading").removeClass("md-on-moving"),e.find(".md-image-uploading-mask-wrapper").remove(),e.removeAttr("data-origin-path")}function E(e){var t=h("[data-origin-path="+JSON.stringify(e)+"]");return uploadImageQueue.delete(e),moveImageQueue.delete(e),t.length&&k(t),t}function T(e){var t=reqnode("path").extname(e),n="-";return/[\/\\]$/.exec(e)&&(n=t=""),(e.replace(/(\.[^.\/\\]+?$)/,"")+n+v.tempString()+t).replace(/^\-/,"")}async function _(e){var t=v.tempString(),n=File.isWin?"\\":"/",n=File.option.userDataPath+n+"runtime-storage"+n+t;return e&&File.option.userDataPath?File.isNode?async function(e,t){var n=reqnode("fs-extra");try{await n.copy(e,t)}catch(e){return console.warn("failed to write temp image data",e),""}return t}(e,n):File.isMac&&await JSBridge.invoke("path.copyFile",{from:e,to:n})?n:void 0:""}function A(e,t,n,l,r){var i,o=u.applyUploadingStyle;return e.length&&(i=e.find("img")[0],loadedImgCache.remove(v.wkfile2file(i.getAttribute("src")||"")),i.onload=null),this.editor.brush.clearAndPause(!0),window.moveImageQueue.add(n),o(e,n,!0,!0),this.editor.brush.resume(),(File.isMac?function(e,i){if(i=i.replace(/^file:\/\//,""),!/^\w+:/.exec(i))try{i=decodeURI(i)}catch(e){}return new Promise(function(t,n){bridge.callHandler("images.copyImage",{src:i,folder:e,fileNameDefined:l||!1,ignoreAlert:r||!1},function(e){(e.success?t:n)(e.msg)})})}:function(a,s){return new Promise(function(d,u){var h=reqnode("fs-extra"),n=null;function i(e,t,n){var i,a,s,l,c,r;if(/^(http(s?))|(ftp):\/\//.exec(e))i=e,a=t,s=d,l=u,c=n,o=(r=reqnode("path")).dirname(a),r=r.basename(c?a:T(a)),JSBridge.invoke("app.download",i,o,r).then(({path:n,state:e,type:t})=>{var i=reqnode("fs"),r="";function o(){var e,t;r&&".jpg"!=(t=(e=reqnode("path")).parse(a)).ext&&(a=e.join(t.dir,t.name+"."+r)),i.rename(n,a,e=>{e?console.sendError(e):n=a,s(n)})}t&&-1<t.indexOf("image/")&&(r=t.substr("image/".length)),"completed"==e?c?n!=a?o():s(n):i.access(a,i.F_OK,function(e){e?o():s(n)}):(console.error(e),l(e?"Image download "+e:"unknown error for image download"))});else if(i=/^data:image\/[^;]+;base64,/.exec(e)){var o=decodeURI(e.substr(i[0].length));try{o=decodeURI(o)}catch(e){}h.writeFile(t,o,"base64",function(e){if(e)return u("Failed to copy image\n."+e.message);d(t)})}else{try{e=decodeURI(e)}catch(e){}h.copy(e,t,{overwrite:n},function(e){if(e)return u("Failed to copy image\n."+(e.message||e));d(t)})}}function r(t,n){h.access(n,h.F_OK,function(e){e||(n=T(n)),i(t,n,!1)})}var e,t,o=File.isWin?"\\":"/";if(l)i(s,n=a,!0);else{if(/^data:/.exec(s)){if(!(e=(/^data:image\/([^;]+);base64,/.exec(s)||[])[1]))return d(s);e=v.removeInvalidPathCh(((t=new Date).setHours(t.getHours()-t.getTimezoneOffset()/60),(t=t.toUTCString()).substr(0,t.length-4)+"."+e))}else e=b.getFileNameFromPath(s),e=v.removeInvalidPathCh(e.replace(/\?([^./]*)$/,""));a=(a+o).replace(/[\/\\]{2}$/,o),n=a+e,window.imageDownloadMap[n]&&window.imageDownloadMap[n]!=s?n=T(n):window.imageDownloadMap[n]=s,/^(https?|ftp):/.exec(s)?r(s,n):h.stat(s,(e,t)=>{e?u("Failed to copy image\n."+(e.message||e)):t&&t.isFile()?r(s,n):u("Failed to copy image\n. Image src is not a file")})}})}).call(this,t,n).then(function(t){return t?(a.recordMediaMoves(t),_(t).then(e=>[t,e])):[]},function(){E(n)})}function M(e,t){if("picgo-app"!=t&&"piclist-app"!=t){for(var t=e,n=t.split(/\r?\n/),i=(console.sendLog("[Upload Result] "+t),[]),r=n.length-1;0<=r;r--){var o=n[r].trim();if(o)if(/^(https?|ftp|file):\//.exec(o))i.unshift(o);else if(/^[a-z0-9]+([\-\.]{1}[a-z0-9]+)*\.[a-z]{2,5}\/.*$/.exec(o))i.unshift("http://"+o);else if(i.length)break}return i}t=e;try{var a=JSON.parse(t);return a.success?a.result:[]}catch(e){return[]}}function $(e,t){return this.editor.brush.pause(),t=v.absolutePathFrom(t),window.uploadImageQueue.add(t),u.applyUploadingStyle(e,t,!1),this.editor.brush.resume(),function(e){var t=this;return new Promise(function(n,i){var r;File.isMac?(r=t.getImageUploader(),bridge.callHandler("images.upload",{command:t.getImageUploaderCommand(r),file:e},function(e){var t;e.success?"ipic"==r?n(e.msg):(t=M(e.msg,r))[t.length-1]?n(t[t.length-1]):i(e.msg):i(e.msg)})):File.isNode?L.call(t,[e]).then(e=>{n(e[0])}).catch(i):i()})}.call(this,t)}function L(o){var n,a,s,l,c=this.getImageUploaderCommand();return c?((n="picgo-app"==c||"piclist-app"==c)?(a=c,s=File.option.picgoAppPath,l=File.option.piclistAppPath,"picgo-app"!==a||s?"piclist-app"!==a||l?function t(n){return window.fetch("http://127.0.0.1:36677/upload",{method:"POST",body:JSON.stringify({list:o})}).then(function(e){return 200===e.status?e.json().then(e=>e.success?(console.sendLog("[Upload Result] "+JSON.stringify(e.result)),e.result):Promise.reject(JSON.stringify(e))):Promise.reject(e.text())},function(e){return n?Promise.reject(e.message||"failed"):new Promise(function(e,i){var r=setTimeout(()=>{t(!(r=null)).then(e,i)},5e3);window.reqnode("child_process").exec(JSON.stringify("piclist-app"===a?l:s),(e,t,n)=>{r&&e&&(i("failed to launch PicGo app: "+e.message),clearTimeout(r))})})})}(!1):Promise.reject("请在偏好设置中配置 PicList (app) 的路径。"):Promise.reject("请在偏好设置中配置 PicGo (app) 的路径。")):new Promise((i,r)=>{reqnode("child_process").exec(c+" "+v.escapeShell(o),{maxBuffer:2097152},(e,t,n)=>{e?(console.warn("exec error: "+e),r(e)):t?i(t):(console.warn("error: "+n),r(n))})})).then(e=>{var t=n?e:M(e,c);return t.length==o.length?Promise.resolve(t):(console.log(e),Promise.reject("fail to parse result image path from: "+e))}):Promise.reject("Upload command not found.")}function N(e,s,t){var l,c,d,n=s,u=(s=this.resolveImagePath(s),this.editor);return u.undo.endSnap(!0),e.each(function(e,t){var n,i,r,o,a;t&&((n=t.querySelector(".md-content"))?(d||(l=u.selection.getRangy(),c=u.selection.buildUndo(l),d=m.makeEmptyCommand(c)),o=n.textContent,i=(t.getAttribute("md-inline")==p.imgtag?S:F)(o,s),r=h.extend({},c),o=i.length-o.length,a=u.findNodeByElem(h(t).closest("[cid]")),u.undo.endSnap(!0),t=t.querySelector(".md-content"),l&&t&&l.comparePoint&&l.comparePoint(t,1)<0&&(r.start+=o),l&&t&&l.comparePoint&&l.comparePoint(t,2)<0&&(r.end+=o),d.undo.push(m.buildReplaceUndo(a)),n.textContent=i,u.store(a,!0),t=u.findElemById(a.cid),u.brush.brushNode(a.cid),t.removeClass("md-expand"),u.undo.exeCommand(r),(l=u.selection.getRangy())&&h(l.commonAncestorContainer).closest(".md-image").length&&(r=u.imgEdit.selectComponent("alt",!0)),d.redo.push(m.buildReplaceUndo(a)),d.redo.push(r)):r=this.editor.selection.buildUndo())}),d&&!t&&((e=u.undo.lastRegisteredOperationCommand())&&e.src===n?m.append(e,d):u.undo.register(d)),d}async function D(e,t,n,i,r){e&&n&&t!=n&&(e.undo.push({type:"deleteMedia",from:n}),e.redo.unshift({type:"restoreMedia",from:i,to:n}),r&&x(t)&&await File.editor.imgEdit.deleteMedia(t,!0,e,i),File.isTextPack())&&x(n)}function P(r,e,o,t,n,a){var s=this;r&&r.length&&o&&A.call(this,r,e,o,t,!1).then(function(e){var t,n,i;e&&(t=e[0],e=e[1],void 0!==t)&&(r=E(o),C(t,o,r.find("img")[0]),n=N.call(s,r,t,File.isTextBundle()||File.isTextPack()),(File.isTextBundle()||File.isTextPack())&&((i=s.editor.undo.lastRegisteredOperationCommand())&&i.src===o?m.append(i,n):s.editor.undo.register(n)),D(n,o,t,e,a))},function(e){r=E(o),e&&console.error(e),e&&!n&&setTimeout(function(){y.showNotification(h.localize.getString("Failed to Copy Image to Target Folder.")+" <code>"+v.escape(e)+"</code>",!0)},500)})}window.imgLastModified=Math.floor(+new Date/1e3),window.uploadImageQueue=new Set,window.moveImageQueue=new Set,window.imagePreLoadAfterMove={},window.imageDownloadMap={};function H(e){return!/^\s*(https?):/.exec(e)}var B={};t.exports=class{constructor(i){var t=this;function n(){File.editor.contextMenu.hide(),File.editor.contextMenu.restoreLastCursor()}this.removeUploadingStyle=k,this.editor=i,this.uniqueFilePathOnNode=T,h(i.sessionStr).on("mousemove",".md-image>.md-meta",function(e){fastdom.measure(function(){e.offsetX-e.target.offsetLeft<20&&e.offsetY<30?this.nextElementSibling&&this.nextElementSibling.getAttribute("src").trim().length&&fastdom.mutate(function(){this.classList.add("md-show-hint")},this):fastdom.mutate(function(){this.classList.remove("md-show-hint")},this)},this)}).on("mouseleave",".md-image>.md-meta",function(){fastdom.mutate(function(){this.classList.remove("md-show-hint")},this)}).on("click","img",function(e){var t,n=h(e.target).closest(".md-image").addClass("md-expand");n.length&&(t=O.createRange(),n.attr("md-inline")==p.imgtag?t.selectNodeContents(n.find(".md-meta")[0]):t.moveToBookmark({containerNode:n.children(".md-meta")[0],start:2,end:2+(e.target.getAttribute("alt")||"").length}),i.selection.setRange(t,!0))}).on("btn-action",".md-image-input-src-btn",function(e){h("#ty-tooltip").hide();var t=document.createRange();t.setStart(this.parentElement,0),t.setEnd(this.parentElement,0),h(this).remove(),i.selection.setRange(t,!0)}).on("click btn-action",".md-image-pick-file-btn",function(e){return h("#ty-tooltip").hide(),t.insertLocalImage(),!1}).on("cursorChange",function(e,t){t&&-1!=t.style.inline.indexOf("image")||!document.querySelector("#user-context-menu.show")||i.contextMenu.hide("#user-context-menu")}),h(".context-menu").on("click","[data-key='select-img-target'] a",function(){n(),t.copyToSelectedFolderAction()}).on("click","[data-key='select-img-target-move'] a",function(){n(),t.copyToSelectedFolderAction(!0)}).on("click","[data-key='delete-img'] a",function(){n(),t.deleteImageAction(!1)}).on("click","[data-key='delete-img-file'] a",function(){n(),t.deleteImageAction(!0)}).on("click","[data-key='upload-img'] a",function(){n(),t.uploadAction()}).on("click","[data-key='copy-img-to-target'] a",function(){n(),t.copyToTargetFolderAction()}).on("click","[data-key='move-img-to-target'] a",function(){n(),t.copyToTargetFolderAction(!0)}).on("click","[data-key='copy-img'] a",function(){n(),t.copyImage()}).on("click","[data-key='reveal-img-in-finder'] a",function(){n(),t.revealInFinder()}).on("click","[data-key='reveal-img-in-browser'] a",function(){n(),t.revealInFinder()}).on("click","[data-key='zoom-smart'] a",function(){n();var e=h(".md-expand.md-img-loaded");e&&t.zoomAction(e,this.getAttribute("data-variable"))}).on("click","[data-key='zoom-img'] a",function(){h(this.parentElement).trigger("mouseenter")}),this.registerBridge()}registerBridge(){var i;File.isMac&&(i=this,bridge.registerHandler("images.fetchImageLocalStorageFolder",function(e,t){t(i.getTargetImageStorageFolder()||null)}),bridge.registerHandler("images.allImageUploadCallback",function(e,t){i.allImageUploadCallbackForMac(e.command,e.success,e.message,e.updateMap,e.sources),t&&t()}),bridge.registerHandler("images.tagetImageStorageFolderExcludeSetting",function(e,t){t&&t(i.getTargetImageStorageFolder(!0))}),bridge.registerHandler("images.doSetImageCopyToFolder",function(e,t){i.doSetImageCopyToFolder(e),t&&t()}),bridge.registerHandler("images.doSetImageCopyToIPic",function(e,t){i.doSetImageCopyToFolder("upload",!0),t&&t()}),bridge.registerHandler("images.doRemoveImageCopyToFolder",function(e,t){i.doRemoveImageCopyToFolder(),t&&t()}),bridge.registerHandler("images.doSetImageRootPath",function(e,t){i.doSetImageRootPath(e),t&&t()}),bridge.registerHandler("images.prepareUploadAllImagesOnMac",function(e,t){i.prepareUploadAllImagesOnMac(t)}),bridge.registerHandler("images.insertImage",function(e,t){e=a.insertURL(e);t&&t(e)}),bridge.registerHandler("images.zoomImage",function(e,t){e=i.zoomAction(null,e);t&&t(e)}),bridge.registerHandler("images.switchSyntax",function(e,t){i.switchPattern(null,e)}),bridge.registerHandler("images.copyAllImages",function([e,t],n){i._copyAllImages(e,t),n&&n()}))}getLocalRootUrlForInsert(){return this.editor.docMenu.getLocalRootUrl()||File.option.useRelativePathForImg&&b.getCurrentFileFolderPath()||""}getSrcFromDom(e,t){return e?e.dataset.isDataSrc&&e.querySelector("img")?e.querySelector("img").getAttribute("src"):t?this.getAbsolutePath(e.dataset.src):e.dataset.src:""}getAbsolutePath(e,t){if(!e)return e;e=v.absolutePathFrom(this.getRealSrc(e));if(t){if(!/^[a-z]+:/i.exec(e))return"file://"+e}else/^https?:/.exec(e)&&!/^data?:/.exec(e)&&!/^file?:/.exec(e)||(e=v.decodeFromEscapedURL(e));return e}getRealSrc(e,t,n,r){if(e){e=v.decodeFromEscapedPath(e);var i,o,a,s,l,c,d=(/#[^.\/\\]+$/.exec(e)||[])[0]||"";if(!/^data:/.exec(e)){if(/^\/\//.exec(e))return"http:"+e;try{return/^(file|ftp|https?):(\/\/|\\\\)/gi.exec(e)?e:!File.isTextBundle()&&!File.isTextPack()||/^assets[\/\\]/.exec(e)?t?u(function(e){if(/^(wk)?file:/.exec(e))return"file://"+h(v.absolutePathFrom(e))}(e)):(i=/^((\/)|(\/\/)|(\\\\)|([a-z]+\:[\\\/]))/i,o=this.editor.docMenu.getLocalRootUrl(),File.isNode?(a=reqnode("path"),(!o||File.isTextBundle()||File.isTextPack())&&i.exec(e)?u("file://"+h(e).replace(/^[\/\\]+/,"/")):u("file://"+h(a.resolve(o||b.getCurrentFileFolderPath()||"",e.replace(/^\s*(\\\\|\/)/,""))))):!o&&i.exec(e)?u((c=h(e||""),/[a-z]+:/.exec(c)?c:"file://"+b.normalizePath(c))):u(h((s=o||b.getCurrentFileFolderPath()||"",l=e||"","file://"+b.normalizePath(s.replace(/^file:\/\//,"").replace(/\/$/,"")+"/"+l.replace(/^\//gi,"")))))):""}catch(e){}}}return e;function u(e){return e=(e=encodeURI(e).replace(/%5C/g,"\\")).replace(/#[^.\/\\]+$/,"").replace(/#/g,"%23"),n&&(e+=d),e}function h(t){var e,n,i;return r&&w.shouldManageResource(t)?(e=File.isWin?"\\":"/",e=File.bundle.filePath+e+"assets"+e,n=v.trimPathParam(t.substring(e.length)),(i=w.deletedAssetsMap())[n]?(reqnode("fs-extra").copy(i[n],t,{errorOnExist:!1},()=>{var e=i[n];delete i[n],document.querySelectorAll(`[src^="file://${u(e)}"]`).forEach(e=>{e.src=u(t)})}),i[n]):((File.bundle.unusedAssets||[]).remove(n),t)):t}}updateImgRef(e){var t=this.editor.brush.inline;h("[data-ref='"+v.escapeSelector(e)+"']").each(function(){var e=(this.querySelector(".md-content")||{}).textContent;void 0!==e&&h(this).replaceWith(t.output(e))})}willUpdateImgRef(e){e&&(s&&clearTimeout(s),o[e]=!0,r=r||new Date,200<new Date-r?setTimeout(function(){Object.keys(o).map(this.updateImgRef,this)}.bind(this),10):s=setTimeout(function(){Object.keys(o).map(this.updateImgRef,this)}.bind(this),300))}startBusyImageLoader(){var s;window.IntersectionObserver&&(s=[],this.intersectionObserver=new IntersectionObserver(function(e){s=[],e.forEach(e=>{function t(e){return e&&"auto"!=e}var n,i,r,o,a;e.intersectionRatio<=0?(n=e.target,{naturalHeight:r,naturalWidth:a,height:o}=n,n.dataset.realSrc||(i=null,5e5<r*a&&0<o&&(i=[n,n.src,`data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 ${a} ${r}"%3E%3C/svg%3E`],t(n.style.height)||t(n.getAttribute("height"))||t(n.style.width)||t(n.getAttribute("width"))?(n.dataset.fixedSize=!0,i.push(0)):i.push(o),s.push(i)))):(a=e.target).dataset.realSrc&&(a.src=a.dataset.realSrc,a.dataset.realSrc="",a.dataset.fixedSize||a.removeAttribute("height"),a.dataset.fixedSize="")}),s.forEach(e=>{e[0].dataset.realSrc=e[1],e[0].src=e[2],e[3]&&e[0].setAttribute("height",e[3])}),s=[]}))}tryAddImageToBusyLoader(e){var t,n,i;File.isMac&&!e.dataset.realSrc&&({src:t,naturalHeight:n,naturalWidth:i}=e,this.intersectionObserver||this.startBusyImageLoader(),this.intersectionObserver)&&(/^file:/.exec(t)&&2e5<n*i?this.intersectionObserver.observe(e):this.intersectionObserver.unobserve(e))}async deleteMedia(e,t,n,i){i=i||await _(e);if(n&&!i)console.error("Failed to prepare undo / redo for image move / delete");else{a.recordMediaMoves(null,[i,e]),n&&(n.redo.push({type:"deleteMedia",from:e}),n.undo.unshift({type:"restoreMedia",from:i,to:e}));try{t&&await JSBridge.invoke("shell.trashItem",e)||(File.isNode&&await reqnode("node:fs/promises").unlink(e),File.isMac&&await JSBridge.invoke("path.delete",e))}catch(e){console.warn(e)}}}restoreMedia(n,e){if(n)try{a.recordMediaMoves(e);var i=this;File.isNode?reqnode("fs-extra").copySync(n,e):JSBridge.invoke("path.copyFile",{from:n,to:e}).then(function(e){var t;e&&(t=i.getRealSrc(n,!0,!1),h(".md-image.md-img-error img").each(function(){0==this.src.indexOf(t)&&i.refreshLocalImgDom(this)}))})}catch(e){}}refreshLocalImgDom(e,t,n){var i,r,o,a=function(e){e.target.removeAttribute("width"),e.target.removeAttribute("height"),e.target.removeEventListener("load",a),e.target.removeEventListener("error",a)},s=(t=t||Math.floor(+new Date/1e3),(e.parentElement||e).dataset.src||e.dataset.src);n&&!e.parentElement.classList.contains("md-img-error")||(n=this.getRealSrc(s))&&/^file:/.exec(n)&&(failImgCache.remove(n),v.fromExternalPath(n)&&(n=v.file2wkfile(n),failImgCache.remove(n)),"SOURCE"===e.tagName?(this.editor.htmlBlock.resetVideoDom(e.parentElement),e.setAttribute("src",n),(i=e.parentElement.parentElement)&&(r=e.parentElement.previousSibling,o=e.parentElement.outerHTML,e.parentElement.remove(),setTimeout(()=>{r?r.insertAdjacentHTML("afterend",o):i.insertAdjacentHTML("afterbegin",o)},0))):(!e.width&&!e.height&&("VIDEO"===e.tagName?2<e.readyState:e.complete)&&e.clientWidth&&(e.width=e.clientWidth,e.height=e.clientHeight,e.addEventListener("load",a),e.addEventListener("error",a)),e.setAttribute("src",n+"?lastModify="+t),"IMG"===e.tagName&&e.parentElement.dataset.src&&(e.dataset.localRefresh=!0,e.onload=onImageLoadedFunc,e.onerror=onImageErrorFunc),"VIDEO"===e.tagName&&this.editor.htmlBlock.resetVideoDom(e)))}refreshLocalImg(e){if(e||!File.inBusyMode){e&&(window.failImgCache=[],window.loadedImgCache=[]);var t=Math.floor(+new Date/1e3),n=this,i=h(".md-image img"),r=0,o=!1;if(!e)i.each(function(){1e7<r||(r+=(this.naturalHeight||0)*(this.naturalWidth||0))}),o=1e7<r;i.each(function(){n.refreshLocalImgDom(this,t,o)}),imgLastModified=t,o||h(".md-htmlblock-container video, .md-htmlblock-container img, .md-htmlblock-container source").each(function(){n.refreshLocalImgDom(this,t,o)})}}async reloadAllByNode(){await JSBridge.invoke("webContents.clearCache"),this.refreshLocalImg(!0)}updateLocalRootUrl(){var e=this.editor.docMenu.getLocalRootUrl()||"";if(this.editor.localRootUrl!=e){for(var t=document.querySelectorAll("[md-inline='image']"),n=0;n<t.length;n++){var i=(a=t[n]).querySelector("img"),r=a.getAttribute("data-src");r&&r!=i.getAttribute("src")&&(i=h.parseHTML(u.decorate({type:l.TYPE.image,markdown:a.textContent,alt:i.getAttribute("alt"),href:r}))[0],a.parentElement.replaceChild(i,a))}for(var o=document.querySelectorAll("[data-ty-watch-src]"),n=0;n<o.length;n++){var a,s=(a=o[n]).dataset.src;a.getAttribute("src")!=s&&(a.src=this.getAbsolutePath(s,!0),"VIDEO"==a.tagName)&&this.editor.htmlBlock.resetVideoDom(a)}}}selectComponent(e,t){this.editor.undo.endSnap(!0);var n=this.editor.selection.getRangy(),i=h(n.startContainer).closest("[md-inline='image']"),r=i.text(),i=n.getBookmark(i[0]),o=r.indexOf("]"),a=m.makeEmptyCommand(this.editor.selection.buildUndo());if(!i.containerNode)return this.editor.selection.buildUndo();"alt"!==e&&e?(i.start=o+2,i.end=r.length-1):(i.start=2,i.end=o),n.moveToBookmark(i),this.editor.selection.setRange(n,!0);e=this.editor.selection.buildUndo();return a.redo.push(e),t||this.editor.undo.register(a),e}prepareUploadAllImagesOnMac(n){var i=this;this.validateBeforeUpload().then(e=>{var t;e?(e=i.getImageUploader(),(t=i.getImageUploaderCommand(e))?("upic"==e&&t.replace("-u","-s -u"),e=i.buildImageMap(),n([!0,e,t]),e.length||y.showNotification(h.localize.getString("No local images found.","Panel"),void 0,void 0,void 0,!0)):n([!0,[],""])):n([!1,[],""])})}buildImageMap(e,t){B={},e=e||H;for(var n,i,r=document.querySelectorAll(".md-image.md-img-loaded"),o=r.length,a=0;a<o;a++)if(n=r[a],i=this.getRealSrc(n.dataset.src),e(i=(i=v.absolutePathFrom(i)).replace(/^file:\/\//,""))){if(t)return!0;B[i]=B[i]||[],B[i].push(n)}return!t&&Object.keys(B)}allImageUploadCallbackForMac(e,t,n,i,r){var o;"ipic"==e?this.replaceImageMap(i,t,n,e):t?(o=M(n,e)).length==r.length?(i={},r.forEach((e,t)=>{i[e]=o[t]}),this.replaceImageMap(i,!0,n,e)):this.showError(n,"Failed to fetch {0} images from: ".replace("{0}",r.length)):this.showError(n,"Failed to upload images:")}replaceImageMap(t,e,n,i){var o=m.makeEmptyCommand(this.editor.selection.buildUndo()),a=this.editor,s=new Set,l=0,c=0,r=(a.undo.endSnap(!0),Object.keys(t).forEach(function(e){var r;B[e]&&(c++,(r=t[e])==e?l++:B[e].forEach(function(e){e.querySelector("img").src=r,v.fromExternalPath(r)&&(e.querySelector("img").src=v.file2wkfile(r)),e.hasAttribute("data-src")&&e.setAttribute("data-src",r);var t,n=a.findNodeByElem(h(e).closest("[cid]")),i=e.getAttribute("md-inline");!s.has(n)&&d.isType(i,p.image,p.imgtag)&&(s.add(n),o.undo.push(m.buildReplaceUndo(n))),n=e.querySelector(".md-content").textContent,i==p.image?(t=F(n,r),e.querySelector(".md-content").textContent=t):i==p.imgtag?(t=S(n,r),e.querySelector(".md-content").textContent=t):i==p.refimg&&(t=((e=/^!\[((?:\[[^\]]*\]|[^\[\]]|\](?=[^\[]*\]))*)\]\s*\[([^\]]*)\]/.exec(n))[2]||e[1]).replace(/\s+/g," "),i=a.nodeMap.link_list.getNodeByRef(t),s.has(i)||(s.add(i),o.undo.push(m.buildReplaceUndo(i)),i.set("href",r),a.findElemById(i.cid).replaceWith(i.toHTML())))}))}),s.forEach(function(e){e.get("type")!==p.def_link&&a.store(e,!0),o.redo.push(m.buildReplaceUndo(e))}),o.redo.push(a.selection.buildUndo()),a.undo.register(o),Object.keys(B).length);B={},e?y.showNotification(h.localize.getString("Successfully uploaded {0} images.").format(c),!1,h.localize.getString("Undo"),function(){a.undo.undo()}):c?("upic"==i&&(c-=l),y.showNotification(h.localize.getString("Successfully uploaded {0} images, {1} failed.").format(c,r-c)+" "+v.truncate(n,600),!1,h.localize.getString("Undo"),function(){a.undo.undo()})):this.showError(n,"Failed to upload images:")}insertLocalImage(){function t(e){e&&0!=e.length&&a.insertURLs(e)}File.isLocked||(File.isNode?JSBridge.invoke("dialog.showOpenDialog",{filters:[{name:"Images",extensions:["png","jpg","jpeg","bmp","svg","tiff","webp","gif"]}],properties:["openFile","multiSelections"],buttonLabel:"Select"}).then(({filePaths:e})=>{t(e)}):File.isMac&&window.bridge.callHandler("images.insertLocalImage",t))}shouldTriggerMove(e,t){return!("upload"==(t=void 0===t?this.getTargetImageStorageFolder(!1,!0):t)&&"upload"!=this.getTargetImageStorageFolderFromSetting()&&!this.checkAutoUploadIsAllowed(!0,!0)||!e)&&(/^\s*(https?|ftp):\/\//.exec(e)?File.isTextBundle()||File.isTextPack()||File.option.applyImageMoveForWeb:!(!(File.isTextBundle()||File.isTextPack()||File.option.applyImageMoveForLocal)||/^data:/.exec(e)||0==e.indexOf(t)&&!e.substring(t.length+1).match(/[\\\/]/g)))}tryMoveImageDom(e,t,n){this.tryMoveImageDoms([e[0]],t,n)}tryMoveImageDoms(e,t,n){if(t&&e.length){var i,r,o=function(e,i){const r={};return e.forEach(e=>{var t=i(e),n=r[t];n?n.push(e):r[t]=[e]}),r}(e,e=>this.getSrcFromDom(e,!0));for(i in o)this.shouldTriggerMove(i,t)&&(r=h(o[i]),"ipic"==t||"upload"==t?this.uploadAction(r,!0):P.call(this,r,t,i,void 0,n))}}prepImageMove(l,c){var d=this;return new Promise(function(t,n){var e,i,r,o,a;return!c&&"upload"!=(l=void 0===l?d.getTargetImageStorageFolder():l)&&l?void(File.isMac?bridge.callHandler("images.prepImageMove",{folder:l,silent:l==d.getTargetImageStorageFolderFromSetting()},function(e){"success"!=e?s(e):t()}):(e=reqnode("fs-extra"),d.getTargetImageStorageFolder(!(i=!1))&&(i=!(File.isTextBundle()||File.isTextPack())),r=l,o=i,a=reqnode("fs-extra"),new Promise(function(n,i){if(!o)return n();a.stat(r,function(e){var t;return e?"ENOENT"!=e.code?i(e.message):(t=h("#image-create-folder-confirm").find("#image-create-folder-target").text(r).end().modal({backdrop:"static",keyboard:!1}),File.isLocked=!0,void t.off("mousedown",".image-create-folder-dialog-yes, .image-create-folder-dialog-no, .image-create-folder-dialog-help, .close").one("mousedown",".image-create-folder-dialog-yes",function(){t.modal("hide"),File.isLocked=!1,File.freshMenu(),n()}).one("mousedown",".image-create-folder-dialog-no",function(){t.modal("hide"),File.isLocked=!1,File.freshMenu(),i(!1)}).one("mousedown",".close",function(){t.modal("hide"),File.isLocked=!1,File.freshMenu(),i(!1)}).on("mousedown",".image-create-folder-dialog-help",function(){var e=File.option.useMirrorInCN?"typoraio.cn":"typora.io";JSBridge.showInBrowser(`https://support.${e}/Images/`)})):n()})}).then(function(){e.ensureDir(l,function(e){e?s(e):t()})},s))):t();function s(e){e&&alert(e.message||e),n()}})}tryMoveImageInRange(e,t){var n,i,r=this.editor,o=this.getTargetImageStorageFolder();o&&(this.editor.brush.clearAndPause(),(n=!(n=e.getNodes([document.ELEMENT_NODE],function(e){return"image"==e.getAttribute("md-inline")||"imgtag"==e.getAttribute("md-inline")})).length&&e&&(i=e.commonAncestorContainer.parentElement)&&"image"==i.getAttribute("md-inline")?[e.commonAncestorContainer.parentElement]:n).length&&this.prepImageMove(o).then(function(){r.imgEdit.tryMoveImageDoms(n,o,t)},()=>{}),this.editor.brush.resume())}generateAlt(e){return(b.getFileNameFromPath(e,!0)||"").replace(/(^\.)|(\.[^.]+$)/g,"")}insertImageFromURL(r){var o=r;function d(){return File.editor.imgEdit.generateAlt(r)}function u(){var e=window.getSelection(),t="";return t=!File.editor.sourceView.inSourceMode&&0<e.startOffset?" ":t}function e(e,t){var n,i,r,o,a,s,l=this.editor,c=l.getMarkElem();return!(!c.length||!l.stylize.canContainInline(c))&&(a=File.isTextBundle()||File.isTextPack(),i=d(),s=u(),n=l.getNode(c.attr("cid")),i=s+"!["+i+"]("+(s=a?e:this.resolveImagePath(e))+")",(r=l.selection.getRangy())?((o=h(r.startContainer).closest("[md-inline='image']")).length?((t?window.uploadImageQueue:window.moveImageQueue).add(e),a||N.call(this,o,e),this.selectComponent("alt",a),r=l.selection.getRangy(),(o=h(r.startContainer).closest("[md-inline='image']")).attr("data-src",s)):(t=r.getBookmark(c[0]).start,(a=m.makeEmptyCommand()).undo.push(l.selection.buildUndo()),f.insertInlineText(l,n,i,t,a,!0),a.src=e,s=l.findElemById(n.cid),l.brush.brushNode(n.cid),s.removeClass("md-expand"),r.moveToBookmark({containerNode:s[0],start:t+i.length,end:t+i.length}),(o=h(r.startContainer).closest(".md-image")).find("img").attr("src","file://"+e),l.undo.register(a),window.getSelection()),o):null)}r=File.isTextBundle()||File.isTextPack()?r:this.resolveImagePath(r);var t,n=o,i=this,a=this.editor,s=this.getTargetImageStorageFolder(!1,!0);!function(){var e,t=d(),n=u(),i=a.selection.getRangy();!i||!(e=h(i.startContainer).closest("[md-inline='image']")).length||(i=i).startContainer.parentElement.classList.contains("md-image-after-src")&&i.startContainer.textContent.length==i.startOffset?(f.pasteHandler(this.editor,n+"!["+t+"]("+r+")",!0,!0),this.editor.undo.lastRegisteredOperationCommand().src=o):(N.call(this,e,o),this.selectComponent("alt"))}.call(this),this.shouldTriggerMove(n,s)&&s&&("upload"==s?(i.editor.brush.clearAndPause(),t=e.call(i,n,!0),i.uploadAction(t),i.editor.brush.resume()):s&&(n=b.normalizePath(n),this.editor.brush.clearAndPause(),t=e.call(this,n),i.prepImageMove(s,File.isMac).then(function(){P.call(i,t,s,n)},()=>{E(n)}),this.editor.brush.resume()))}doInsertVideoFromURL(e){e='<video src="{url}"></video>'.replace("{url}",e);f.pasteHandler(this.editor,e,!1)}doInsertAudioFromURL(e){e='<audio src="{url}"></audio>'.replace("{url}",e);f.pasteHandler(this.editor,e,!1)}resolveImagePath(e){if(/^\/\//.exec(e))return"https://"+e;if(/^data:/.exec(e))return e;if(/^[^:]+:\/\//.exec(e))return e;if(!e)return e;function t(e){return File.option.autoEscapeImageURL?v.escapeURL(e):e}var n=this.getLocalRootUrlForInsert(),i=b.getCurrentFileFolderPath();if(File.isTextBundle())e=v.getRelativePath(n,e,!1,!1),!n||"/"!=e[0]&&"\\"!=e[0]||(e=e.substring(1));else if(File.isTextPack())e=v.getRelativePath(n,e,!1,!1),!n||"/"!=e[0]&&"\\"!=e[0]||(e=e.substring(1));else if(n&&n.length){var r=v.getRelativePath(n,e,!1,File.option.relativePathWithDot);e=(!(r=n==i?r.replace(/^\s*(\\\\|\/)/,""):r).match(/^\.[\/\\]/)&&this.editor.docMenu.getLocalRootUrl()?"/":"")+r}else{if(!File.option.useRelativePathForImg||!i||0!==e.indexOf(i))return t(e);e=e.substring(i.length).replace(/^\//,"").replace(/\\/,"/"),File.option.relativePathWithDot&&(e="./"+e)}return t(e=File.isWin?e.replace(/[\/\\]{1,2}/g,"/"):e)}getImageUploaderCommand(e){var t=(n=n||{ipic:"ipic","picgo-app":"picgo-app","piclist-app":"piclist-app",upic:"/Applications/uPic.app/Contents/MacOS/uPic -o url -u",picsee:"/Applications/Picsee.app/Contents/MacOS/Picsee -u","picgo-cli":File.isNode?(t=JSON.stringify(_options.userDataPath+"/picgo/"+(File.isWin?"x64"==i.process.arch?"win64":"win32":"linux")+"/picgo"+(File.isWin?".exe":""))+" u",t=File.isWin?"chcp 65001| "+t:t):null})[e||File.option.imageUploader||""];return(t=t||"custom"!==File.option.imageUploader?t:(File.option.customImageUploader||"").replace("${filepath}",File.bundle.filePath||"").replace("${filename}",(File.getFileName()||"").replace(/\.[^.\/\\]+$/,"")))||""}getImageUploader(){var e=this.editor.localSettingBridge&&this.editor.localSettingBridge.getSetting(c);return e&&!File.editor.sourceView.inSourceMode&&"ipic"==e.toLowerCase()?"ipic":"custom"==File.option.imageUploader?this.getImageUploaderCommand(File.option.imageUploader):File.option.imageUploader}isFixedImageStorageFolder(){function e(e){if(e)return v.isAbsolutePath(e)}var t;return!File.isTextBundle()&&!File.isTextPack()&&((t=this.editor.localSettingBridge&&this.editor.localSettingBridge.getSetting(c)||"")?e(t):File.option.defaultImageStorage?e(File.option.defaultImageStorage):void 0)}assetsFolderForTextBundle(){var e=File.isWin?"\\":"/";return this.editor.docMenu.getLocalRootUrl()+e+"assets"}getTargetImageStorageFolder(e,t){var n=this.editor.localSettingBridge&&this.editor.localSettingBridge.getSetting(c);if(File.isTextBundle())return this.assetsFolderForTextBundle();if(File.isTextPack())return this.assetsFolderForTextBundle();if(n&&!File.editor.sourceView.inSourceMode){if((File.option.allowImageUpload||t)&&("ipic"==n.toLowerCase()||"upload"==n.toLowerCase()))return"upload";t=b.getCurrentFileFolderPath();if(t)return/[\\/]$/.exec(t[t.length-1])||(t+="/"),b.normalizePath(t+n.replace(/\${filename}/g,(File.getFileName()||"").replace(/\.[^.\/\\]+$/,"")),!0)}return e?null:this.getTargetImageStorageFolderFromSetting()}getTargetImageStorageFolderFromSetting(){if("ipic"==File.option.defaultImageStorage||"upload"==File.option.defaultImageStorage)return"upload";var e=b.getCurrentFileFolderPath();if(this.cachedFileImageStorage)return this.cachedFileImageStorage;var t=File.option.defaultImageStorage;if(!e||/[\\/]$/.exec(e[e.length-1])||(e+="/"),"folder"==t){if(e)return this.cachedFileImageStorage=b.normalizePath(e.replace(/[\\/]$/,""),!0),this.cachedFileImageStorage}else if("assert"==t){if(e)return this.cachedFileImageStorage=b.normalizePath(e+"assets",!0),this.cachedFileImageStorage}else if("per-file-assert"==t){if(e)return this.cachedFileImageStorage=b.normalizePath(e+File.getFileName().replace(/\.[^.\/\\]+$/,"")+".assets",!0),this.cachedFileImageStorage}else if(t&&!d.isType(t,"upload")){var n=File.getFileName();if(-1<t.indexOf("${filename}")){if(!n)return null;t=t.replace(/\${filename}/g,n.replace(/\.[^.\/\\]+$/,""))}(File.isWin?/^[^\/\\]+:[\/\\]/:/^[\\\/]/).exec(t)?this.cachedFileImageStorage=b.normalizePath(t,!0):e&&(this.cachedFileImageStorage=b.normalizePath(e+t,!0))}return this.cachedFileImageStorage||""}async moveToTextbundleByNode(e,r){const t=File.isWin?"\\":"/";var n=e+t+"assets";const o=reqnode("path"),a=reqnode("fs-extra"),i=o.basename(r||"").replace(/^\..+$/,"");async function s(e,t){await File.editor.imgEdit.deleteMedia(t,!0,e)}var e=this.buildImageMap(),l=await this._copyAllImages(n,!0),c=await async function(){for(var e=o.dirname(r),t=await a.readdir(e),n=0,i=0;i<t.length;i++)if(-1<File.SupportedTextFiles.indexOf(b.getExtension(t[1]))&&n++,1<n)return null;return e}(),e=e.filter(e=>{return 0!=e.indexOf(n+File.isWin?"\\":"/")&&!(!x(e)||(0===o.dirname(e).indexOf(t+i)||c&&0===e.indexOf(e+t))&&(s(l,e),1))});e.length&&e.forEach(function(e){s(l,e)})}async onFileMoved(e,t){var n,i,r;function o(e){return 0==e.indexOf(t.replace(/[\\\/]$/,"")+(File.isWin?"\\":"/"))}this.cachedFileImageStorage=void 0,this.editor.localSettingBridge&&(i=(n=this).getTargetImageStorageFolder(),t!==i)&&t&&i&&v.pathByDeleteLastComponent(t)==v.pathByDeleteLastComponent(e)&&n.buildImageMap(o,!0)&&await async function(e){try{if(File.isNode){if(await reqnode("node:fs/promises").stat(e))return!0}else if(File.isMac)return await JSBridge.invoke("shell.isFolder",e)}catch(e){return!1}}(t)&&(e=v.getFolder(i),r=File.getMountFolder(),0==i.lastIndexOf(r)&&(e=i.substr(r.length+1)),r=h.localize.getString("Would you like to update image references and move image files to %@ ?","Panel").replace("%@",e),await n.shouldContinue(r,"noWarningForUpdateImageReference"))&&(await this._copyAllImages(i,!0,o,!0),async function(e){if(File.isNode)try{await reqnode("node:fs/promises").rmdir(e,{recursive:!1,force:!1})}catch(e){}else if(File.isMac)return JSBridge.invoke("shell.removeIfEmpty",e)}(t))}revealInFinder(){var e,t=h(".md-expand img").attr("src")||"";/^(wk)?file:/.exec(t)?(e=v.absolutePathFrom(t),JSBridge.showInFinder(e)):/^https?:/.exec(t)&&JSBridge.showInBrowser(t)}async copyImage(){var e=h(".md-expand.md-img-loaded");if(e){var t=this.getSrcFromDom(e[0],!0);if(File.isNode){var{clipboard:n,nativeImage:i}=reqnode("electron"),r=/^https?:/.exec(t)?i.createFromBuffer(Buffer.from(await(await fetch(t)).arrayBuffer())):i.createFromPath(t),o=(n.writeText(t),(e.find("img")[0]||{}).outerHTML);o&&n.writeHTML(o),/\.gif/.exec(t)?n.writeImage(i.createFromBuffer(r.toBitmap())):n.writeImage(r),await 0}File.isMac&&(o={},/\.svg$/.exec(t)&&((i=(e.find("img")[0]||{}).outerHTML)&&(o["text/html"]=i),o["image/svg+xml"]=await(await fetch(t)).text()),await!bridge.callHandler("clipboard.writeImage",{otherData:o,path:t}))}}moveImageTo_(e,t,n,i,r){P.call(this,e,t,n,i,!1,r)}async deleteImageAction(e){var t=h(".md-expand.md-img-loaded");if(t){var n=this.editor,i=this.getSrcFromDom(t[0],!0),t=(n.selection.selectAllElem(t),f.backspaceHandler(n,null,"delSelection",!1,!1));if(t&&t==n.undo.lastRegisteredOperationCommand()){if(e&&x(i)){if(!File.isTextBundle()&&!File.isTextPack()&&!await this.shouldContinue("Delete original image file?","noWarningForDeleteImage"))return}else e=!1;await this.deleteMedia(i,!0,t)}}}async shouldContinue(e,t){if(!File.option[t]){var{response:e,checkboxChecked:n}=await y.showWarningDialog(h.localize.getString(e),!0);if(0!=e)return!1;n&&(JSBridge.execForAll("window.File && File.option && (File.option."+t+" = true)"),JSBridge.putSetting(t,!0))}return!0}async copyToSelectedFolderAction(e){var t=h(".md-expand.md-img-loaded");if(t){var n,i=this.getSrcFromDom(t[0],!0),r=b.getFileNameFromPath(i,!0);if(/^data:/.exec(i)&&(n=(/^data:[\\\/]*image\/([^;]+)/.exec(i)||[])[1],r=t.find("img").attr("alt")||new Date+"",n)&&(r=r+"."+n),e&&x(i)){if(!await this.shouldContinue("Move image will delete the image file at original path, are you sure to continue?","noWarningForMoveImage"))return}else e=!1;(n=File.isMac?await JSBridge.invoke("images.selectImageSavePath",{defaultName:(e?i:r)||"",absolutePath:i||File.editor.imgEdit.cachedFileImageStorage||File.mountFolder_||""}):(await JSBridge.invoke("dialog.showSaveDialog",{title:h.localize.getString("Copy and update image source to…","Panel"),defaultPath:(e||File.isLinuxSnap?i:r)||"",properties:["showOverwriteConfirmation"]})).filePath)&&n!=i&&this.moveImageTo_(t,n,i,!0,e)}}async copyToTargetFolderAction(e){this.editor.brush.clearAndPause();var t=h(".md-expand.md-img-loaded");if(t){var n=this.getSrcFromDom(t[0],!0),i=this.getTargetImageStorageFolder(),r=this;if(e&&x(n)){if(!await r.shouldContinue("Move image will delete the image file at original path, are you sure to continue?","noWarningForMoveImage"))return}else e=!1;n&&this.prepImageMove(i,File.isMac).then(function(){r.moveImageTo_(t,i,n,void 0,e)},()=>{}),this.editor.brush.resume()}}switchPattern(e,t,n,i){if(!(e=e||h(".md-expand.md-img-loaded")))return!1;var r,o,a,s=e.find("img"),s=(i&&(a=e.closest("[cid]").attr("cid"),this.editor.undo.addSnap(a,g.NONE)),{type:t?p.imgtag:p.image,title:s.attr("title"),alt:s.attr("alt"),src:e.attr("data-src")||s.attr("src")}),l=e.attr("md-inline");if(t)return l!=p.imgtag&&((t=document.createElement("img")).setAttribute("src",s.src),s.alt&&t.setAttribute("alt",s.alt),s.title&&t.setAttribute("title",s.title),s.markdown=t.outerHTML.replace(/<\/img>$/,"").replace(/\s*>$/," />").replace(/&amp;/g,"&"),o=u.decorateImage(s,s.markdown,s.src),r=h(o),e.replaceWith(r),i&&(a=e.closest("[cid]").attr("cid"),this.editor.undo.addSnap(a,g.NONE)),[s,r]);if(l==p.image)return!1;if(l==p.imgtag&&n)for(var c=/(\w+)\s*=\s*(["']).+?\2/g;c.exec(void 0);)if(!["src","title","alt"].exec((void 0)[1].toLowerCase()))return!1;t=["!["+s.alt.replace(/]/g,"")+"](",s.src,(s.title?JSON.stringify(title):"")+")"];return s.markdown=t.join(""),o=u.decorateImage(s,s.markdown,s.src,t),r=h(o),e.replaceWith(r),i&&this.editor.undo.addSnap(a,g.REPLACE),[s,r]}ensureOneImg(e){if(e=e||h(".md-expand.md-img-loaded"))return 1==e.length?e:(this.editor.brush.expand(!0,!0,!0),h(".md-expand.md-img-loaded"))}addStyle(e,r,o){var t,n,a,s,i,l;(e=this.ensureOneImg(e))&&(t=e.closest("[cid]").attr("cid"),this.editor.undo.addSnap(t,g.NONE),!o&&e.attr("md-inline")!=p.imgtag||(l=e.find("img"),e.attr("md-inline")!=p.imgtag?(i=this.switchPattern(e,!0,!1,!0))&&(n=i[0],e=i[1]):n={type:p.imgtag,title:l.attr("title"),alt:l.attr("alt"),src:e.attr("data-src")||l.attr("src"),markdown:e.text()},a=document.createElement("img"),s=!1,n.markdown=n.markdown.replace(/(style\s*=\s*)(['"])(.*?)\2/,function(e,t,n,i){a.setAttribute("style",i||""),s=!0,a.style[r]=o;i=a.getAttribute("style");return i?t+JSON.stringify(i):""}),s||(n.markdown=n.markdown.replace(/(\s*\/?>)/,' style="'+r+":"+o+';" $1').replace(/\s+\/>$/," />")),i=u.decorateImage(n,n.markdown,n.src),l=h(i),e.replaceWith(l),l.find("img").click(),this.editor.undo.addSnap(t,g.REPLACE)))}zoomAction(e,t){(e=e||h(".md-expand.md-img-loaded"))&&this.addStyle(e,"zoom","100%"==t?"":t)}quickUploadValidation(e){var t=this.getImageUploader();return t||(e&&(t=h.localize.getString("Please set an image uploader in Preferences panel before using this function.","Panel"),File.isMac?bridge.callHandler("controller.showErrorDialog",t):y.showDialog({message:t})),!1)}validateBeforeUpload(){var n=this;return new Promise(function(e){var t=n.quickUploadValidation(!0);t?File.isMac&&"ipic"==t?bridge.callHandler("images.iPicValidateBeforeUpload",e):e(!0):e(!1)})}uploadAction(n,i){var r;(n=n||h(".md-expand.md-img-loaded"))&&(r=this).validateBeforeUpload().then(e=>{var t=v.absolutePathFrom(r.getRealSrc(n.attr("data-src")));e?$.call(r,n,t).then(function(e){i||C(e,t,n),n=E(t),N.call(r,n,e)},function(e){n=E(t),N.call(r,n,t),e&&setTimeout(function(){r.showError(e)},500)}):(E(t),k(n))})}showError(e,t){e=e.message||e,y.showNotification(`${h.localize.getString(t||"Failed to upload image. Error Message:")} <code style='font-size:0.8em'>${v.escape(v.truncate(e,600))}</code>`,!0,h.localize.getString("Learn More","Panel"),function(){var e=File.option.useMirrorInCN?"typoraio.cn":"typora.io";JSBridge.showInBrowser(`https://support.${e}/Upload-Image/`)})}async _copyAllImages(t,r,n,e,i,o){var a=this;if(t&&(!r||e||await a.shouldContinue("Move image will delete the image file at original path, are you sure to continue?","noWarningForMoveImage"))){var s,l,e=i?Object.keys(B):this.buildImageMap(function(e){return 0!=e.indexOf(t+File.isWin?"\\":"/")&&(!n||n(e))}),c=[],d=_options.userDataPath+(File.iwWin?"\\":"/")+"typora-user-images";y.hideNotification();try{await Promise.all(e.map(n=>A.call(a,h(B[n]),t,n,!1,!0).then(([e,t])=>{c.push([n,e,t])}))),l=Promise.all(c.map(e=>{var t,[e,n,i]=e;if(void 0!==n)return C(n,e,(t=E(e)).find("img")[0]),t=N.call(a,t,n,!0),s?m.append(s,t):s=t,t=r,o&&(t=r||0==e.indexOf(d)),D(s,e,n,i,t)})).then(function(){return s})}catch(e){console.error(e)}s&&(this.editor.undo.register(s),i=h.localize.getString(r?"Images moved to %@.":"Images copied to %@.","Panel").replace("%@",`<code>${v.getFolder(t)}</code>`),o&&(i=h.localize.getString("Images saved to TextBundle")),o||y.showNotification(i,!0),await l)}}moveAllImages(){return this.copyAllImages(!0)}async copyAllImages(e){var t,n=this.getTargetImageStorageFolder();File.isNode?(t=((await JSBridge.invoke("dialog.showOpenDialog",{defaultPath:n,title:h.localize.getString("Select Container Folder"),properties:["openDirectory","createDirectory"],buttonLabel:h.localize.getString("Select")})).filePaths||[])[0],this._copyAllImages(t,e)):bridge.callHandler("images.startCopyAllImages",[n,e||!1])}uploadAllImages(){var e,t;this.quickUploadValidation(!0)&&(e=this.buildImageMap(),L.call(t=this,e).then(n=>{y.hideNotification();var i={};e.forEach((e,t)=>{i[e]=n[t]}),t.replaceImageMap(i,!0)}).catch(e=>{t.showError(e,"Failed to upload images:")}),Object.keys(e).length?(y.hideNotification(),y.showProcessingNotification(h.localize.getString("Uploading in progress…","Panel"))):y.showNotification(h.localize.getString("No local images found.","Panel"),void 0,void 0,void 0,!0))}contextMenuItems(e){var t,n=(e.getAttribute("src")||"").replace(/\?(.+)$/,""),i=[],r=!e.closest(".md-img-error"),o=this.getTargetImageStorageFolder(),a=(o&&"upload"!=o&&(o=o.replace(/[\\\/]$/,"")+(File.isWin?"\\":"/")),v.escapeURL(o)),a=(o&&"upload"!=o&&(0!=n.replace(/^file:\/\//,"").indexOf(a)||n.replace(/^file:\/\//,"").substring(a.length+1).match(/[\\\/]/g))&&(t=v.getFolder(o))&&i.push("copyImgToTarget-"+t.replace(/\|/g,"")),/^(wk)?file:\/\//.exec(n)),r=(r&&(i.push("copyImgToSelect"),a&&(t&&i.push("moveImgToTarget-"+t.replace(/\|/g,"")),i.push("moveImgToSelect")),"upload"==o?i.unshift("uploadImg"):i.push("uploadImg"),i.push("copyImg")),a?i.unshift("revealImgInFinder"):/^https?:\/\//.exec(n)&&i.unshift("revealImgInBrowser"),e.getAttribute("data-pixel-ratio"));return r&&1!=(r=+r)&&i.push("zoomImgTo-"+v.floatToPercent(1/r)),i.push("zoomImg"),e.closest("[md-inline='image']")&&i.push("imgSyntaxMarkdown"),e.closest("[md-inline='imgtag']")&&i.push("imgSyntaxHTML"),i.push(a?"deleteImgFile":"deleteImg"),i}afterUserInsertImage(t){var n,i,r,e,o,a,s=(t.getAttribute("src")||"").replace(/\?(.+)$/,"");function l(){var e=i.selection.getRangy(),t=h(e.endContainer).closest("[md-inline='image']");e&&t.length&&!t.hasClass("md-on-moving")&&!t.hasClass("md-on-uploading")&&(i.lastCursor=i.selection.buildUndo(e),i.contextMenu.showCustom(n,"image"))}s!=this.lastUrl&&t.parentElement&&t.parentElement.contains(window.getSelection().anchorNode)&&(n=[],i=this.editor,e=t.getAttribute("data-pixel-ratio"),r=e=>1!=(e=+(e||1))&&e!=1/0&&!isNaN(e),e?r(e=+e)&&n.push({label:"Zoom Image to %@",key:"zoom-smart",variable:v.floatToPercent(1/e)}):File.isMac?bridge.callHandler("images.getScale",s.replace(/^wkfile:/,"file:"),function(e){r(e)&&(t.setAttribute("data-pixel-ratio",e),n.splice(n.length-1,0,{label:"Zoom Image to %@",key:"zoom-smart",variable:v.floatToPercent(1/e)}),l())}):File.isNode&&I.getImageScaleByElection(s,t.nativeHeight).then(function(e){r(e)&&(t.setAttribute("data-pixel-ratio",e),n.splice(n.length-1,0,{label:"Zoom Image to %@",key:"zoom-smart",variable:v.floatToPercent(1/e)}),l())}),File.isTextBundle()||File.isTextPack()||((e=this.getTargetImageStorageFolder())&&"upload"!=e&&(e=e.replace(/[\\\/]$/,"")+(File.isWin?"\\":"/"),s=v.absolutePathFrom(s),o=v.escapeURL(e),0!=s.replace(/[\\]/g,"/").indexOf(o)||s.substring(o.length+1).match(/[\\\/]/g)?(a=v.getFolder(e))&&n.push({label:"Copy to %@",key:"copy-img-to-target",variable:a}):this.lastUrl=s),n.push({label:"Copy Image to…",key:"select-img-target"}),a&&n.push({label:"Move to %@",key:"move-img-to-target",variable:a}),n.push({label:"Rename or Move Image to…",key:"select-img-target-move"}),File.isTextBundle())||File.isTextPack()||!this.quickUploadValidation()||("upload"==e?n.unshift({label:"Upload Image",key:"upload-img"}):n.push({label:"Upload Image",key:"upload-img"})),n.push({label:"Zoom Image",key:"zoom-img",hasExtraMenu:!0}),n.length)&&l()}toggleUploadForFile(){"upload"==this.getTargetImageStorageFolder(!0)?this.doRemoveImageCopyToFolder(!1):!this.quickUploadValidation(!0)||File.isNode&&!this.checkAutoUploadIsAllowed(!0)||this.doSetImageCopyToFolder("upload",!0)}checkAutoUploadIsAllowed(e,t){if(File.option.allowImageUpload)return!0;if(e){if(t&&File.option.noWarnigUploadDisabled)return!1;y.showNativeDialog({message:h.localize.getString("The option `%@` must be enabled first to automatically upload images.","Panel").replace("%@",h.localize.getString("Allow upload images automatically based on YAML settings","Panel")),buttons:[h.localize.getString("Enable this feature on preferences panel","Panel"),h.localize.getString("Close")],checkbox:t?h.localize.getString("Do not show this again","Panel"):null,callback:function(e,t){0===e&&(File.isNode?File.megaMenu.highlight("image-setting-group"):bridge.callHandler("setting.showAndHighlight","image-setting-group")),t&&(JSBridge.putSetting("noWarnigUploadDisabled",!0),JSBridge.execForAll("File.option.noWarnigUploadDisabled = true;"))}})}return!1}toggleCopyToFolder(){var t=this,e=this.getTargetImageStorageFolder(!0),n=b.getCurrentFileFolderPath();File.refreshImageCopyStatus(!0),File.isLocked||File.editor.sourceView.inSourceMode||(e?this.doRemoveImageCopyToFolder(!1):n?JSBridge.invoke("dialog.showOpenDialog",{defaultPath:b.getCurrentFileFolderPath(),title:h.localize.getString("Select Container Folder"),properties:["openDirectory","createDirectory"],buttonLabel:h.localize.getString("Select")}).then(({filePaths:e})=>{e&&0!=e.length&&t.doSetImageCopyToFolder(e[0])}):JSBridge.invoke("dialog.showMessageBox",{title:h.localize.getString("Document must be saved first.","Panel"),message:h.localize.getString("Typora will copy newly inserted image to folder by selected relative path, so please save the file first.","Panel"),defaultId:0,cancelId:0,buttons:[h.localize.getString("OK")]}))}toggleUseImageRootPath(){var e=this.editor.docMenu.getLocalRootUrl(),t=this.editor;e?this.editor.docMenu.removeProperty("typora-root-url"):JSBridge.invoke("dialog.showOpenDialog",{defaultPath:b.getCurrentFileFolderPath(),title:h.localize.getString("Select Container Folder"),properties:["openDirectory","createDirectory"],buttonLabel:h.localize.getString("Select")}).then(({filePaths:e})=>{e&&0!=e.length&&t.imgEdit.doSetImageRootPath(e[0])})}doSetImageCopyToFolder(e,t){e=t?"upload":v.getRelativePath(b.getCurrentFileFolderPath(),e,!0),this.editor.docMenu.writeProperty(c,e)}doSetImageRootPath(e){this.editor.docMenu.writeProperty("typora-root-url",v.getRelativePath(b.getCurrentFileFolderPath(),e,!0))}doRemoveImageCopyToFolder(e){return this.editor.docMenu.removeProperty(c,e)}}}),$__System.registerDynamic("35",["11","1d","26","20","19","13","30","28"],!0,function(e,t,n){"use strict";this||self;var l=e("11"),x=e("1d"),a=e("26"),s=e("20"),i=(e("19"),e("13")),c=e("30"),d=e("28"),C=i.Node,F=i.TYPE;var y=null;function v(e){return d.markRange(e,"md-search-hit")}function u(e){try{if(e){var t=e.initPos;if(!t&&e.curSelection)if(e.curSelection.isCm)t=e.curSelection;else{var n=x.createRange(),i=e.curSelection;if(!i.parentElement)return;n.selectNode(i),(t=(i=$(i).closest("[cid]")[0])?n.getBookmark(i):t)&&(t.cid=i.getAttribute("cid"))}return t||null}}catch(e){}return null}n.exports=class{constructor(e){this.editor=e,this.curSel=null,this.searchTimer,this.caseSensitive=File.option.caseSensitive,this.wholeWord=File.option.wholeWord,this.useRegexp=File.option.useRegexp,this.bindEvents(),this.MAX_HITS_COUNT=5e3}bindEvents(){var n,i=this,r=!1,o=a.map;File.isMac||File.isNode||a("command+f, ctrl+f",function(e){i.showPanel(),e.preventDefault()}),File.isMac||File.isNode||a("command+h, ctrl+h",function(e){i.showPanel(!0),e.preventDefault()}),$(document.body).on("keydown",function(e){if("Escape"==e.key&&i.isOpen())return i.closePanel(),!1}).on("mouseup",".md-search-hit",function(){i.closePanel(!1,$(this))}).on("mouseup",".cm-search-hit",function(e){var t=$(e.target).closest(".CodeMirror")[0].CodeMirror,e=s.posFromMouse(t,e),n=t.indexFromPos(e),e=i.searchStatus.hits.find(function(e){return e.isCm==t&&e.start<=n&&e.end>=n});if(i.closePanel(!0),e)return t.doc.setSelection(t.posFromIndex(e.start),t.posFromIndex(e.end)),!1}).on("mouseup",".CodeMirror",function(e){i.closePanel(!0)}),$("#md-searchpanel").on("blur",function(){i.closePanel()}).on("click",".close-btn",function(){i.closePanel()}).on("keydown","input",function(e){if("Escape"==e.key)return i.closePanel(),!1}).on("keydown","#search-panel-input",function(e){var t=e.keyCode||e.which;return"Enter"==o[t]?($(this).val()==i.searchStatus.searchText?i.highlightNext(e.shiftKey):i.doSearch($(this).val()),!1):"Tab"==o[t]?($("#md-searchpanel.searchpanel-replace-mode").length?$("#search-panel-replace-input").focus():this.value+="\t",!1):void 0}).on("beforeinput","#search-panel-input",function(e){n&&clearTimeout(n),n=null}).on("input","#search-panel-input",function(e){r||(n&&clearTimeout(n),n=null,i.doSearch($(this).val()))}).on("compositionstart","#search-panel-input",function(e){r=!0}).on("compositionend","#search-panel-input",function(e){r=!1;var t=this;n&&clearTimeout(n),n=setTimeout(()=>{r||i.doSearch(t.value),n=null},100)}).on("keydown","#search-panel-replace-input",function(e){var t=e.keyCode||e.which;if((r=229==t)||"Enter"!=o[t]){if("Tab"==o[t]&&!e.shiftKey)return!1}else i.replaceSelection()}).on("mousedown","#search-panel-prev",function(){i.highlightNext(!0)}).on("mousedown","#search-panel-next",function(){i.highlightNext()}).on("click","#md-search-type-label",function(){$("#md-searchpanel").addClass("searchpanel-replace-mode"),$("#search-panel-replace-input").focus(),document.body.classList.add("on-replace-panel-open")}).on("click","#md-replace-type-label",function(){$("#md-searchpanel").removeClass("searchpanel-replace-mode").removeClass("searchpanel-msg-mode"),$("#search-panel-input").focus(),document.body.classList.remove("on-replace-panel-open"),$("content").removeClass("on-replace-panel-open")}).on("click","#search-panel-replace-btn",function(){i.replaceSelection(),$("#md-searchpanel").removeClass("searchpanel-msg-mode")}).on("click","#search-panel-replaceall-btn",function(){$("#md-searchpanel").removeClass("searchpanel-msg-mode"),i.replaceAll()}).on("click","#searchpanel-msg-close-btn",function(){$("#md-searchpanel").removeClass("searchpanel-msg-mode")}).on("click","#searchpanel-msg-undo-btn",function(){i.editor.undo.undo(),$("#md-searchpanel").removeClass("searchpanel-msg-mode"),i.editor.sourceView.inSourceMode||i.doSearch($("#search-panel-input").val())}).on("mousedown","#searchpanel-regexp-option-btn",function(e){return this.classList.toggle("active"),i.useRegexp=!i.useRegexp,File.isMac&&bridge.callHandler("touchBar.updateFindReplaceMode",[!!i.caseSensitive,!!i.wholeWord]),JSBridge.putSetting("useRegexp",i.useRegexp),i.doSearch(),!1}).on("mousedown","#searchpanel-case-option-btn",function(e){return this.classList.toggle("active"),i.caseSensitive=!i.caseSensitive,File.isMac&&bridge.callHandler("touchBar.updateFindReplaceMode",[!!i.caseSensitive,!!i.wholeWord]),JSBridge.putSetting("caseSensitive",i.caseSensitive),i.doSearch(),!1}).on("mousedown","#searchpanel-word-option-btn",function(){return this.classList.toggle("active"),i.wholeWord=!i.wholeWord,File.isMac&&bridge.callHandler("touchBar.updateFindReplaceMode",[!!i.caseSensitive,!!i.wholeWord]),JSBridge.putSetting("wholeWord",i.wholeWord),i.doSearch(),!1}),i.wholeWord&&document.querySelector("#searchpanel-word-option-btn").classList.add("active"),i.caseSensitive&&document.querySelector("#searchpanel-case-option-btn").classList.add("active"),i.useRegexp&&document.querySelector("#searchpanel-regexp-option-btn").classList.add("active")}replaceAll(){if(this.searchStatus&&this.searchStatus.hits.length){var e=this.searchStatus.searchText,r=$("#search-panel-replace-input").val(),t=this.searchStatus.hits;if(!function(e){y&&clearTimeout(y),$("#md-searchpanel.searchpanel-replace-mode").addClass("searchpanel-msg-mode").find("#searchpanel-msg-content").text(e),y=setTimeout(function(){$("#md-searchpanel").removeClass("searchpanel-msg-mode")},5e3)}.call(this,(s=this.searchStatus.hits.length,this.searchStatus.searchText,"Replaced "+s+" occurrence(s)")),this.editor.sourceView.inSourceMode){var n="",i=0,o=t.length,a=0,e=this.editor.sourceView.cm.getValue();if(this.searchStatus.useRegexp)n=e.replace(this.searchStatus.regexp,r);else{for(;i<o;i++)n=n+e.substring(a,+t[i].start)+r,a=+t[i].end;n+=e.substring(a)}var s=this.editor.sourceView.cm.getScrollInfo().top;this.editor.sourceView.cm.setValue(n),this.editor.sourceView.cm.scrollTo(0,s),this.clearSearch()}else{var l,c,d=this.editor.undo.UndoManager,u=d.makeEmptyCommand(),h=this.searchStatus,p=h.regexp,s=(this.editor.undo.endSnap(!0),this.searchStatus.curSelection);s&&s.isCm?u.undo.push({cid:s.cid,start:s.start,end:s.end,type:"cursor"}):s&&s.parentElement&&((l=x.createRange()).selectNode(s),u.undo.push(this.editor.selection.buildUndo(l))),this.resetSearchStatus();for(i=0;i<t.length;i++){var f=(a=t[i]).isCm||a.isFutureCm?a.cid:$(a).closest("[cid]").attr("cid");c!=f&&g.call(this,c=f)}this.editor.undo.register(u)}}function m(e,t){var n,i=e.get(t);p.lastIndex=0,i&&(n=i,n=h.useRegexp?i.replace(p,r):i.replace(p,function(){return r}),e.set(t,n))}function g(e){var t,e=this.editor.getNode(e),n=(u.undo.push(d.buildReplaceUndo(e)),m(e,"text"),m(e,"title"),m(e,"ref"),u.redo.push(d.buildReplaceUndo(e)),this.editor.findElemById(e.cid));e.get("type")==F.fences&&(t=this.editor.fences.intersectionObserver)&&t.unobserve(n[0]),n.replaceWith(e.toHTML()),e.get("type")==F.fences&&this.editor.fences.intersectionObserve(this.editor.findElemById(e.cid)[0])}}replaceSelection(){var r,o,e,a,s,t,n,i,l,c,d,u,h,p,f,m,g,y,v,b,w;this.editor.sourceView.inSourceMode&&!this.searchStatus.curSelection&&this.highlightNext(),this.searchStatus&&this.searchStatus.hits&&this.searchStatus.hits.length&&$("#md-searchpanel.searchpanel-replace-mode").length&&(this.searchStatus.curSelection?(r=$("#search-panel-replace-input").val(),o=this.searchStatus.curPos,e=this.editor.undo.UndoManager.makeEmptyCommand(),a=this.searchStatus.curSelection,s=a.isCm,this.editor.undo.endSnap(!0),s?(this.searchStatus.useRegexp?s.doc.replaceSelection(s.doc.getSelection().replace(this.searchStatus.regexp,r),"start","+findReplace"):s.doc.replaceSelection(r,"start","+findReplace"),function(e){for(var t,n=o+1,i=r.length-(a.end-a.start);t=e.hits[n];){if(!t.isCm||t.isCm.cid!=s.cid)return;t.start+=i,t.end+=i,n++}}(this.searchStatus)):(t=editor,n=a,i=r,l=e,c=this.searchStatus.useRegexp?this.searchStatus.regexp:null,t.brush.pause(),b=t.undo.UndoManager,w=t.nodeMap.allNodes.get($(n).closest("[cid]").attr("cid")),C.isType(w,F.html_block)||((d=x.createRange()).selectNode(n),u=t.selection.buildUndo(d),h=Object.clone(u),c&&(p=n.rawText(),i=-1<c.source.indexOf("(?")&&0===(y=((m=(n.previousSibling||{}).textContent||"")+p+(f=(n.nextSibling||{}).textContent||"")).replace(c,i)).indexOf(m)&&y.lastIndexOf(f)==y.length-f.length?y.substring(m.length,y.length-f.length):p.replace(c,i)),h.end=h.end+i.length-n.textContent.length,l.undo.push(u),l.undo.push(b.buildReplaceUndo(w)),m=null,n.nextSibling&&"SCRIPT"==n.nextSibling.tagName?n.nextSibling.textContent=i+n.nextSibling.textContent:n.previousSibling&&"SCRIPT"==n.previousSibling.tagName?n.previousSibling.textContent=n.previousSibling.textContent+i:(m=document.createTextNode(i),n.parentElement.insertBefore(m,n),g=n.parentElement),n.remove(),(y=g&&g.closest(".md-image"))&&("img"==y.getAttribute("md-inline")&&(v=(/(^\!\[((?:\[[^\]]*\]|[^\[\]])*)\]\()(<?((?:\([^)]*\)|[^()])*?)>?[ \t]*((['"])((?:.|\n)*?)\6[ \t]*)?)(\)(?:\s*{([^{}\(\)]*)})?)/.exec(y.textContent)||[])[4]),v="imgtag"==y.getAttribute("md-inline")?(v=(/src\s*=\s*(['"])((.|\n)*?)\1/.exec(y.textContent)||[])[2])||(/src\s*=\s*([^\s'"]+)(\s|$)/.exec(y.textContent)||[])[1]:v)&&(y.dataset.src=v,y.querySelector("img").src=t.imgEdit.getRealSrc(v,void 0,!0)),t.store(w.cid),l.redo.push(b.buildReplaceUndo(w)),t.brush.addToQueue(w.cid),m?(d.selectNode(m),l.redo.push(t.selection.buildUndo(d))):l.redo.push(h))),1<this.searchStatus.hits.length&&this.highlightNext(),this.searchStatus.hits.splice(o,1),0<this.searchStatus.curPos&&this.searchStatus.curPos--,this.searchStatus.hits.length||this.clearSearch(),this.editor.sourceView.inSourceMode||this.editor.undo.register(e)):this.highlightNext())}isOpen(){return"block"==document.querySelector("#md-searchpanel").style.display}showPanel(e,t){document.body.classList.remove("ty-show-notification");var n,i,r=document.querySelector("#search-panel-input");this.isOpen()?(r.focus(),r.select()):(n=editor.selection.getRangy(),editor.lastCursor=editor.selection.buildUndo(n),$(".md-search-select").removeClass("md-search-select"),this.clearSearch(),this.searchStatus.initPos=editor.selection.getPosBookmark(n),$("#md-searchpanel").show(),(i=document.activeElement&&document.activeElement.closest(".CodeMirror"))&&(r.value=i.CodeMirror.getSelection()),n&&!n.collapsed&&(r.value=n.toString()),r.focus(),r.select(),r.value&&this.doSearch(r.value,{caseSensitive:$("#searchpanel-case-option-btn.active").length,wholeWord:$("#searchpanel-word-option-btn.active").length,useRegexp:$("#searchpanel-regexp-option-btn.active").length,noSelect:!t}),document.body.classList.add("on-search-panel-open")),e?($("#md-searchpanel").addClass("searchpanel-replace-mode"),document.body.classList.add("on-replace-panel-open")):($("#md-searchpanel").removeClass("searchpanel-replace-mode"),document.body.classList.remove("on-replace-panel-open")),File.isMac&&(bridge.callHandler("touchBar.showFindReplaceTouchBar"),bridge.callHandler("touchBar.updateFindReplaceMode",[!!this.caseSensitive,!!this.wholeWord]))}closePanel(e,t){t=t||$(".md-search-select"),this.editor.brush.resume();var n=this.editor.getMarkElem().length,i=(document.body.classList.remove("on-replace-panel-open"),document.body.classList.remove("on-search-panel-open"),document.querySelector("#file-library-search-result .select"));i&&i.classList.remove("select"),$("#md-searchpanel").removeClass("searchpanel-msg-mode").hide(),this.editor.sourceView.inSourceMode?(this.searchStatus&&this.searchStatus.hits.length&&(this.editor.fences.clearSearchAll(),this.editor.sourceView.cm.focus()),this.resetSearchStatus()):(e?n=!0:t.length?(this.editor.selection.selectAllElem(t),this.editor.lastCursor=this.editor.selection.buildUndo(),n=!1):this.searchStatus&&this.searchStatus.curSelection&&this.searchStatus.curSelection.isCm&&(this.searchStatus.curSelection.isCm.focus(),this.editor.lastCursor=this.editor.selection.buildUndo(),n=!1),$(".md-search-select").removeClass("md-search-select"),this.editor.mathInline.renderAll(!1),this.clearSearch(),$(".md-search-hit").removeClass("md-search-hit"),n||this.editor.restoreLastCursor(),e||this.editor.refocus())}updateIndexUI(){var e,t,n=document.querySelector("#search-panel-status");this.searchStatus.searchText?(e=this.searchStatus.hits.length,t=this.searchStatus.curPos,5e3<e?(this.clearSearch(!1,!1,!0),n.innerHTML=`<span ty-hint="${$.localize.getString("Too many matches","Front")}" class="error-message">5000+</span>`):e?n.textContent=t+1+" / "+e:n.innerHTML=`<span class="error-message">${$.localize.getString("No Results","Front")}</span>`):(n.textContent="",n.textContent="")}doSearch(e,t){var n=this.editor,i=this,r=this.searchStatus,o=r&&u(r),a=o&&document.querySelector("[cid='"+o.cid+"']"),s=t;t||(s={caseSensitive:$("#searchpanel-case-option-btn.active").length,wholeWord:$("#searchpanel-word-option-btn.active").length,useRegexp:$("#searchpanel-regexp-option-btn.active").length}),(s=Object.assign({caseSensitive:!1,wholeWord:!1,useRegexp:!1,noSelect:!1,delay:File.inBusyMode?400:50},s)).initPosContainer=a,s.initPos=o,s.searchText=void 0===e?$("#search-panel-input").val():e||"",(r=Object.assign(this.emptySearchStatus(),s)).searchText.length?(i=this,r.regexp=function(e,t){var n,i=t.caseSensitive?"g":"gi";if(!t.useRegexp)return n=l.escapeRegExp(e),t.wholeWord&&(n=`\\b${n}\\b`),new RegExp(n,i);try{return t.wholeWord&&(e=`\\b${e.replace(/^\\b|\\b$/g,"")}\\b`),new RegExp(e,i)}catch(e){return null}}(r.searchText,r),null==r.regexp?this.updateIndexUI():(this.searchTimer&&(clearTimeout(this.searchTimer),this.searchTimer=null),this.searchTimer=setTimeout(function(){if(i.editor.sourceView.inSourceMode)i.clearSearch(void 0,!0),i.searchStatus=r,i.findAtNode(i.editor.sourceView.cm,r.searchText,r,!0),s.noSelect||i.highlightNext();else{i.clearSearch(void 0,!0),$(".md-search-expand").removeClass("md-search-expand"),i.searchStatus=r;for(var e=n.nodeMap.getFirst();e;)if(i.findAtNode(e,r.searchText,r,!1,s.includeMeta),e=e.get("after"),5e3<r.hits.length)return void i.updateIndexUI();s.noSelect?i.updateIndexUI():i.highlightNext()}},s.delay))):($(".md-search-expand").removeClass("md-search-expand"),this.clearSearch(void 0,!0),this.searchStatus=r,this.updateIndexUI())}findAtNode(e,t,p,n,f){var m=this.editor,i=p.initPosContainer,r=p.initPos;function g(e){var t=e.containerNode||document.querySelector("[cid='"+e.cid+"']");return i&&(i.compareDocumentPosition(t)==Element.DOCUMENT_POSITION_PRECEDING||i==t&&e.start<r.start)}function d(e,t,n){var i=p.regexp,r=m.findElemById(e.cid)[0];if(r){var o,a,s,l,c,d=$(r).rawText(),u=0,h=(f&&C.isType(e,F.heading)&&(d=(h="#".repeat(e.get("depth")||1)+" ")+d,u=h.length),e.getText().replace(/\r?\n/g,File.useCRLF?"\r\n":"\n"));for(d=n?h:d,i.lastIndex=0;a=i.exec(d);){if((a={cid:e.cid,containerNode:r,start:Math.max(0,i.lastIndex-a[0].length-u),end:i.lastIndex-u}).start==a.end)return;if(n?p.hits.push({isFutureCm:e.cid,cid:e.cid,start:a.start,end:a.end}):((o=o||x.createRange()).moveToBookmark(a),s=v(o),l=s,c=void 0,(c=$(l)).closest(".md-meta, .md-content, script").length||c.hasClass("md-meta")||c.hasClass("md-content")||c[0]&&"script"==c[0].tagName?c.closest("[md-inline]").addClass("md-search-expand"):l.querySelectorAll(".md-meta, .md-content, script").forEach(function(e){$(e).closest("[md-inline]").addClass("md-search-expand")}),p.hits.push(s)),g(a)&&p.curPos++,5e3<p.hits.length)return}}else try{console.sendError("cannot found elem for ["+e.get("type")+"] from ["+e.get("parent").get("type")+"]")}catch(e){}}function u(e,t){var n,i=p.regexp,r=e.getValue(),o=!1;for(i.lastIndex=0;n=i.exec(r);){if(o=!0,(n={isCm:e,cid:e.cid,start:i.lastIndex-n[0].length,end:i.lastIndex}).start==n.end)return;if(p.hits.push(n),g(n)&&p.curPos++,5e3<p.hits.length)return}o&&m.fences.searchOn(e,t,p)}function h(e,t){if(e.get("children").length)e.get("children").sortedForEach(function(e){h(e,t)});else if(C.isType(e,F.fences))if(m.fences.queue[e.cid])u(m.fences.queue[e.cid],t);else{var n=p.regexp;try{d(e,0,!0)}catch(e){console.error(e)}n.lastIndex=0}else if(C.isType(e,F.math_block))(m.mathBlock.currentCm||{}).cid===e.cid&&(m.fences.clearSearchOn(m.mathBlock.currentCm),u(m.mathBlock.currentCm,t));else if(!C.isType(e,F.toc,F.hr))if(C.isType(e,F.html_block))if((m.htmlBlock.currentCm||{}).cid===e.cid)m.fences.clearSearchOn(m.htmlBlock.currentCm),u(m.htmlBlock.currentCm,t);else{var i,r,o=e,a=p.regexp,s=m.findElemById(o.cid)[0].querySelector(".md-htmlblock-container"),l=s.textContent;for(a.lastIndex=0;r=a.exec(l);){if((r={cid:o.cid,containerNode:s,start:a.lastIndex-r[0].length,end:a.lastIndex}).start==r.end)return;if((i=i||x.createRange()).moveToBookmark(r),3==i.commonAncestorContainer.nodeType){var c=v(i);if(p.hits.push(c),g(r)&&p.curPos++,5e3<p.hits.length)return}}}else d(e)}n?u(this.editor.sourceView.cm,t):h(e,t)}highlightNext(i){if(!this.isOpen())return this.showPanel(void 0,!0);$("#md-searchpanel").removeClass("searchpanel-msg-mode");var r,o,a=this.searchStatus,s=this.editor;function e(){if(s.lastCursor)if(null!=s.lastCursor.startId){var e=s.selection.rangy.createRange();e.moveToBookmark({containerNode:s.findElemById(s.lastCursor.startId)[0],start:s.lastCursor.start,end:s.lastCursor.start});for(var t=a.curPos=0;t<a.hits.length;t++){if(!(0<function(e,t){try{var n=s.selection.rangy.createRange();return t.isCm?n.selectNode(t.isCm.getWrapperElement()):t.isFutureCm?n.selectNode(s.findElemById(t.isFutureCm)[0]):n.selectNode(t),e.compareBoundaryPoints(Range.END_TO_END,n)}catch(e){console.sendError(e,"warning")}}(e,n=a.hits[t])))return;a.curPos++}}else if(s.lastCursor.pos)for(t=a.curPos=0;t<a.hits.length;t++){var n=a.hits[t];if(!(0<function(e,t){try{if(t.isCm&&t.isCm.cid==e.id)return t.isCm.indexFromPos(e.pos)-t.end;o||(o=s.selection.rangy.createRange()).selectNode(s.findElemById(e.id)[0]);var n=s.selection.rangy.createRange();return t.isCm?n.selectNode(t.isCm.getWrapperElement()):t.isFutureCm?n.selectNode(s.findElemById(t.isFutureCm)[0]):n.selectNode(t),o.compareBoundaryPoints(Range.END_TO_END,n)}catch(e){console.sendError(e,"warning")}}(s.lastCursor,n)))return;a.curPos++}}a&&a.hits.length||this.doSearch(),a&&a.hits.length&&(o=null,a.curSelection?a.curPos+=i?-1:1:e(),a.curPos>=a.hits.length?a.curPos=0:a.curPos<0?a.curPos=a.hits.length-1:isNaN(+a.curPos)&&(a.curPos=0),function(e){var t,n;!function(){a.curSelection&&((r=a.curSelection.isCm)?r.execCommand(i?"goDocStart":"goDocEnd"):a.curSelection.classList.remove("md-search-select"))}.call(this),a.curSelection=a.hits[a.curPos],a.initPos=null,$(".md-focus").removeClass("md-focus"),a.curSelection.isFutureCm&&(a.curSelection.isCm=s.fences.addCodeBlock(a.curSelection.isFutureCm),a.curSelection.isFutureCm=!1),(r=a.curSelection.isCm)?(a.lastRange=null,r.doc.setSelection(r.posFromIndex(a.curSelection.start),r.posFromIndex(a.curSelection.end)),(t=r.getScrollerElement())&&(n=t.querySelector(".CodeMirror-selectedtext"))&&(File.isTypeWriterMode?s.selection.typeWriterScroll(n):s.selection.scrollAdjust(n,void 0,200),$(t).closest("[cid]").addClass("md-focus"))):(a.curSelection.classList.add("md-search-select"),a.lastRange=a.curSelection,File.isTypeWriterMode?s.selection.typeWriterScroll($(a.curSelection)):s.selection.scrollAdjust($(a.curSelection),void 0,200),$(a.curSelection).closest("[cid]").addClass("md-focus"))}.call(this,a.curPos)),this.updateIndexUI()}clearSearch(e,t,n){var i=u(this.searchStatus);if(!this.editor.sourceView.inSourceMode){t||$(".md-search-expand").removeClass("md-search-expand");var r=[];if(this.searchStatus){for(var o=0;o<this.searchStatus.hits.length;o++){var a=this.searchStatus.hits[o];!a.parentElement||a.isCm||(a.parentElement.classList.contains("md-inline-math-container")?r.push(a.closest(".md-inline-math")):d.unmarkSpan(a))}var t=this.searchStatus.curSelection,s=(t||{}).isCm;s&&(s.doc.setSelection(s.posFromIndex(t.start)),$(s.display.input.textarea).blur())}r.forEach(e=>{e.outerHTML=c.decorate({type:F.inline_math,text:$(e.querySelector(".md-inline-math-container")).rawText(),pattern:e.querySelector(".md-before").textContent})})}this.editor.fences.clearSearchAll(),n||(this.resetSearchStatus(i),clearTimeout(this.searchTimer),this.searchTimer=null)}emptySearchStatus(e){return{hits:[],curPos:0,searchText:null,lastRange:null,initPos:e,curSelection:null}}resetSearchStatus(e){this.searchStatus=this.emptySearchStatus(e),this.updateIndexUI()}}}),$__System.registerDynamic("36",["11","e","13"],!0,function(e,t,n){this||self,e("11");function a(e){var t;return 0===e.trim().length?0:(t=0,e=["d",e.replace(/[\u3040-\uABFF\uD7A4-\uFAFF]/gi,function(e){return t++," "}).replace(/['’]\w+/g,"b").replace(/(^|\s+)[(\u3000-\u303F)!-\/:-@\[-`{-~]+(\s+|$)/gm," "),"d"].join(" ").split(/[(\u3000-\u303F)\s!-,\\:-@\[-`{-~]+/g).length,t+e-2)}var s=e("e"),e=e("13"),l=e.Node,c=e.TYPE,d={WORD:0,CHAR:1,LINE:2,TIME:3},u=["Words","Characters","Lines","Minutes"],h=["Word","Character","Line","Minute"];class i{constructor(e){this.editor=e,this.delimiter=+(File.option.wordCountDelimiter||0),this.Delimiter=d,this.defferUpdateTimer=null,this.defferSelectionUpdateTimer=null,this.lastCount=-1,this.selCount=0,this.excludedCid=null,this.excludedCount=-1,File.isNodeHtml&&this.bindWordCountOnNode(),File.isMac&&this.setupBridge()}setupBridge(){var n=this;bridge.registerHandler("wordCount.getLabelsToShowOnMac",function(e,t){t(n.getLabelsToShowOnMac())})}getText(e){var t,n,i=this.editor,r=e,o=(void 0===e.nodeType?e=document.querySelector("[cid='"+r+"']"):r=e.getAttribute("cid"),e&&e.getAttribute("mdtype"));return o==c.toc?"toc":l.isType(o,c.html_block,c.math_block,c.fences)?(n=(e.querySelector(".CodeMirror")||{}).CodeMirror)?o==c.fences?((t=e.getAttribute("lang"))?"```"+t+"\n":"")+n.getValue()+(t?"```":""):o==c.math_block?"$$\n"+n.getValue()+"\n$$":n.getValue():(t=i.getNode(r))?t.get("text"):"":o&&!l.canContainBlock(o,!0)?(this.useWordDelimiter()?(n=e,File.option.enableInlineMath&&e.querySelector("svg")&&(n=e.cloneNode(!0)).querySelectorAll("svg").forEach(function(e){e.textContent=""}),n):e).textContent:null}useWordDelimiter(){return this.delimiter==d.WORD}clearTimer(){this.defferUpdateTimer&&(cancelIdleCallback(this.defferUpdateTimer),this.defferUpdateTimer=null)}quickUpdate(e,t,n){var i=null,r=e;e&&(e.cid?(i=e.get("text"),r=e.cid):i=this.getText(r)),t&&(this.excludedCount=-1,this.excludedCid=null),null!==i&&(this.delimiter==d.CHAR&&this.quickUpdateCharCount(r,i,n),this.delimiter==d.WORD&&this.quickUpdateWordCount(r,i,n),this.delimiter==d.LINE&&this.quickUpdateLineCount(r,i,n),this.delimiter==d.TIME)&&this.quickUpdateReadTime(r,i,n)}quickUpdateWordCount(e,t,n,i){var r,o;if(this.excludedCid==e&&0<=this.excludedCount)return r=a(t)+this.excludedCount,n&&r==this.lastCount?void 0:(this.lastCount=r,void this.updateLabel(0,i?Math.round(this.lastCount/File.option.wordsPerMinute):this.lastCount));n||(this.clearTimer(),(o=this).defferUpdateTimer=requestIdleCallback(function(){o.lastCount=o.getWordCount(),o.excludedCid=e,o.excludedCount=o.lastCount-a(t),o.updateLabel(-1,i?Math.round(o.lastCount/File.option.wordsPerMinute):o.lastCount)}))}quickUpdateCharCount(e,t,n,i){var r;if(this.excludedCid==e&&0<=this.excludedCount)return r=(i?t.split(/\n/g):t).length+this.excludedCount,n&&r==this.lastCount?void 0:(this.lastCount=r,void this.updateLabel(0,this.lastCount));n||(r=this.editor.getMarkdown(),this.lastCount=(i?r.split(/\n/g):r).length,this.excludedCid=e,this.excludedCount=this.lastCount-(i?t.split(/\n/g):t).length,this.updateLabel(0,this.lastCount))}quickUpdateReadTime(e,t,n){this.quickUpdateWordCount(e,t,n,!0)}quickUpdateLineCount(e,t,n){this.quickUpdateCharCount(e,t,n,!0)}getLabelsToShowOnMac(){File.sync();var e=this.getWordCount(),t=this.editor.selection.getTextInSelection();return(t.length?[e,a(t),t.length,Math.round(e/File.option.wordsPerMinute)]:[e,0,0,Math.round(e/File.option.wordsPerMinute)]).join("|")}updateLabel(e,t){var n,i,r,o=s.localize.getString(u[this.delimiter],"Panel");e<0?e=this.selCount:this.selCount=e,0<e&&e<t?File.isMac?bridge.callHandler("word.updateWordCount",{sel:e,all:t}):File.isNodeHtml&&(n=document.querySelector("#footer-word-count-label")).textContent!=(i=e+" / "+t+" "+o)&&fastdom.mutate(function(){n.textContent=i}):0<=t&&(File.isMac?bridge.callHandler("word.updateWordCount",{sel:e,all:t}):File.isNodeHtml&&(r=document.querySelector("#footer-word-count-label"),this.delimiter==d.TIME&&0==t?(o=s.localize.getString(h[this.delimiter],"Panel"),t="≤ 1"):1==t&&(o=s.localize.getString(h[this.delimiter],"Panel")),fastdom.mutate(function(){r.textContent=t+" "+o})))}updateLineCount(e){e=(e=!0!==e&&e||this.editor.getMarkdown()).split(/\n/g).length;this.lastCount!=e&&(this.lastCount=e,this.updateLabel(0,this.lastCount))}updateCharCount(e){e=e||this.editor.getMarkdown();this.lastCount!=e.length&&(this.lastCount=e.length,this.updateLabel(0,this.lastCount))}getWordCount(){var t="";return this.editor.writingArea.querySelectorAll("[mdtype]").forEach(function(e){e=this.getText(e);e&&(t+="\n"+e)},this),a(t)}updateWordCount(){var e;this.delimiter==d.WORD&&(this.clearTimer(),(e=this).defferUpdateTimer=requestIdleCallback(function(){e.lastCount=e.getWordCount(),e.updateLabel(0,e.lastCount)}))}updateReadTime(){this.clearTimer();var e=this;this.defferUpdateTimer=requestIdleCallback(function(){e.lastCount=e.getWordCount(),e.updateLabel(0,Math.round(e.lastCount/File.option.wordsPerMinute))})}update(e){this.delimiter==d.WORD?this.updateWordCount():this.delimiter==d.CHAR?this.updateCharCount(e):this.delimiter==d.LINE?this.updateLineCount(e):this.delimiter==d.TIME&&this.updateReadTime(e)}updateInSelection(n){this.defferSelectionUpdateTimer&&clearTimeout(this.defferSelectionUpdateTimer);var i=this.editor,r=this;this.defferSelectionUpdateTimer=setTimeout(function(){var e=(null==n?i.selection.getTextInSelection():n)||"",t=0;if(this.defferSelectionUpdateTimer=null,r.delimiter==d.CHAR)t=e.length;else{if(r.delimiter!=d.WORD)return;t=a(e)}t=Math.min(t,r.lastCount);r.updateLabel(t,r.lastCount)},50)}getWordCountInSelection(){var e=editor.selection.getTextInSelection();return a(e)}getCharCountInSelection(){return editor.selection.getTextInSelection().length}bindWordCountOnNode(){var n=this,i=this.editor;s("#footer-word-count").on("click",function(){var e,t;document.body.classList.contains("ty-show-word-count")?(document.body.classList.remove("ty-show-word-count"),document.body.classList.remove("ty-show-word-count-in-selection")):(document.body.classList.remove("ty-show-spell-check"),document.body.classList.add("ty-show-word-count"),File.sync(),t=n.getWordCount(),s("#footer-word-count-td").text(t),e=i.getMarkdown(),t=Math.round(t/File.option.wordsPerMinute),s("#footer-read-time-count-td").text(t||"≤ 1"),s("#footer-line-count-td").text((e.match(/\n/g)||[]).length+1),s("#footer-char-count-td").text(e.length),(t=i.selection.getTextInSelection()).length?(s("#footer-char-count-td-sel").text(t.length),s("#footer-word-count-td-sel").text(a(t)),document.body.classList.add("ty-show-word-count-in-selection")):document.body.classList.remove("ty-show-word-count-in-selection"))}).on("before-show-ty-hint",function(e){document.body.classList.contains("ty-show-word-count")&&(e.cancel=!0)}),s("#footer-word-count-info").on("click","[data-delimiter]",function(){var e=+this.dataset.delimiter,e=(n.setDelimiter(e),this.children[0].textContent+" "+this.children[1].textContent);document.querySelector("#footer-word-count-label").textContent=e,document.body.classList.remove("ty-show-word-count"),i.restoreLastCursor(null,!0)})}setDelimiter(e){this.delimiter=e,this.update(!0),this.quickUpdate(editor.focusCid,!0),JSBridge.putSetting("wordCountDelimiter",this.delimiter)}}i.Delimiter=d,n.exports=i}),$__System.registerDynamic("37",[],!0,function(e,t,n){"use strict";this||self;n.exports=class{constructor(e){this.editor=e}search(n,i,r,o){var a=n.substring(i,i+r);return a?new Promise(function(t,e){File.isMac?bridge.callHandler("word.getSpellSuggestionInContext",{context:n,start:i,length:r},function(e){o.type="word",o.token=a,o.match=e,o.found=e.length,o.pageNo=0,o.pageCnt=Math.floor((e.length-1)/5+1),t(o)}):t(o)}):[]}}}),$__System.registerDynamic("38",["20"],!0,function(e,t,n){this||self;var i=e("20"),a="CodeMirror-activeline",s="CodeMirror-activeline-background",l="CodeMirror-activeline-gutter";function c(e){for(var t=0;t<e.state.activeLines.length;t++)e.removeLineClass(e.state.activeLines[t],"wrap",a),e.removeLineClass(e.state.activeLines[t],"background",s),e.removeLineClass(e.state.activeLines[t],"gutter",l)}function r(t,e){for(var n=[],i=0;i<e.length;i++){var r=e[i],o=t.getOption("styleActiveLine");("object"==typeof o&&o.nonEmpty?r.anchor.line==r.head.line:r.empty())&&(o=t.getLineHandleVisualStart(r.head.line),n[n.length-1]!=o)&&n.push(o)}!function(e,t){if(e.length==t.length){for(var n=0;n<e.length;n++)if(e[n]!=t[n])return;return 1}}(t.state.activeLines,n)&&t.operation(function(){c(t);for(var e=0;e<n.length;e++)t.addLineClass(n[e],"wrap",a),t.addLineClass(n[e],"background",s),t.addLineClass(n[e],"gutter",l);t.state.activeLines=n})}function o(e,t){r(e,t.ranges)}i.defineOption("styleActiveLine",!1,function(e,t,n){n=n!=i.Init&&n;t!=n&&(n&&(e.off("beforeSelectionChange",o),c(e),delete e.state.activeLines),t)&&(e.state.activeLines=[],r(e,e.listSelections()),e.on("beforeSelectionChange",o))})}),$__System.registerDynamic("39",["20"],!0,function(e,t,n){"use strict";this||self;var i=e("20");i.defineOption("visibleSpace",!1,function(e,t,n){(n=n==i.Init?!1:n)&&!t?e.removeOverlay("visiblespace"):!n&&t&&e.addOverlay({token:function(e,t){if(t){if(t.atBlockStart&&e.pos<t.atBlockStart)return e.eat(" ")?"startspace startspace-"+(e.pos-1):e.eat("\t")?"starttab startspace-"+(e.pos-1):(e.pos++,null);var t=/(^[ \t]+)|(\s+$)/.exec(e.string),n=e.string.length,i=t&&t[1]?t[1].length:-1;t&&t[2]&&t[2].length;if(0<i&&i>e.pos)return e.pos++,"startspace-"+(e.pos-1)+("\t"==e.string.charAt(e.pos-1)?" starttab":" startspace");e.pos=n}return null},name:"visiblespace"})})}),$__System.registerDynamic("3a",["20","38","39","e","13","11","19","1b"],!0,function(e,t,n){"use strict";this||self;function i(e){this.editor=e,this.cm=null,this.inSourceMode=!1,this.renderedHTML=""}var r,a=e("20"),c=(e("38"),e("39"),e("e")),o=e("13"),p=e("11"),f=e("19"),s=e("1b"),d=o.Node,m=o.TYPE,l=c("#typora-source"),u=!1;function h(e,t){var n="number"==typeof e?e:e.get("tail");return void 0===n?void 0===t?e.get("after")?1:0:t:n}function g(e,t){function n(e,n){return e.get("children").toArray().reduce(function(e,t){return e+g(t,n)},0)}function i(e){return d.isType(e.get("parent"),m.list_item)&&!1!==e.get("parent").get("tight")}switch(e.get("type")){case m.meta_block:return 2+e.get("text").match(/(\n|$)/g).length+h(e);case m.heading:return(e.get("ahead")||0)+((e.get("pattern")||(!d.isType(e.get("parent"),m.list_item)&&(1==File.option.headingStyle||3==File.option.headingStyle)&&e.get("depth")<=2?"===":"#")).match(/[-=]/)?2:1)+h(e);case m.paragraph:var r=e.get("tail");return(t||i(e))&&(r=0),d.isType(e.get("after"),m.paragraph)&&r<1&&(e.unset("tail"),r=1),void 0!==r||!d.isType(e.get("after"),m.math_block)&&e.get("after")||(r=0),(e.get("ahead")||0)+(e.get("text").split(/\n/g).length||1)+h(void 0===r?e:r,r);case m.blockquote:return(e.get("ahead")||0)+n(e)+h(e);case m.list:r=e.get("ahead")||0;return e.isLoose(!0),r+=n(e),d.isType(e.get("after"),m.list)&&(!e.get("tail")||e.get("tail"))<2&&e.get("pattern")==e.get("after").get("pattern")&&e.get("style")==e.get("after").get("style")&&(e.unset("tail"),r++,i(e))&&r++,t||(r+=h(e,i(e)||!e.get("after")?0:1)),r;case m.list_item:return e.toMark().split(/\n/).length;case m.html_block:return(e.get("ahead")||1)+(e.get("text").match(/\n/g)||[]).length+h(e);case m.fences:var r=/`|~/.exec(e.get("pattern")||"```"),o=(e.get("noCloseTag")?1:2)+(e.get("empty")?0:1);return(e.get("ahead")||0)+(r?o:1)+(e.get("text").match(/\n/g)||[]).length+h(e);case m.math_block:return(e.get("ahead")||0)+3+(e.get("text").match(/\n/g)||[]).length+h(e,d.isType(e.get("before"),m.paragraph)&&d.isType(e.get("after"),m.paragraph)?0:1);case m.hr:return(e.get("ahead")||0)+h(e)+1;case m.toc:return(e.get("ahead")||0)+(e.get("pattern")||"").split(/\n/).length+h(e);case m.def_footnote:case m.def_link:return(e.get("ahead")||0)+1+h(e,!e.get("after")||d.isType(e.get("after"),d.TYPE.def_link)?0:1);case m.table:return(e.get("ahead")||0)+e.get("children").length+1+h(e);case m.table_row:return e.get("before")?1:2;case m.table_cell:return 0;default:return 1}}i.prototype.prep=function(){var r,n,i,o;this.cm?this.cm.mode||this.cm.setOption("mode","gfm"):((r=this).cm=a(document.querySelector("#typora-source"),{lineWrapping:!0,mode:"gfm",theme:"typora-default",styleSelectedText:!0,maxHighlightLength:1/0,styleActiveLine:!0,visibleSpace:!0,viewportMargin:100,autoCloseBrackets:!File.option.noPairingMatch,autoCloseTags:!0,resetSelectionOnContextMenu:!1,extraKeys:{Enter:"newlineAndIndentContinueMarkdownList",Tab:"autoIndentMarkdownList","Shift-Tab":"autoUnindentMarkdownList"},lineNumbers:!0,dragDrop:!1,indentUnit:File.option.codeIndentSize,tabSize:File.option.codeIndentSize,lineWiseCopyCut:File.option.lineWiseCopyCut},this.editor),l.css("z-index","2"),n=this.editor,this.cm.on("changes",function(e,t){n.fences.handleUserReplacement(e,t),r.inSourceMode&&(document.querySelector(".on-search-panel-open")&&"+findReplace"!==t[0].origin&&"setValue"!==t[0].origin&&r.editor.searchPanel.closePanel(),(File.isTypeWriterMode||t[0]&&2<t[0].text.length)&&r.scrollAdjust(),"begin"!==t[0].origin)&&"sync"!==t[0].origin&&(u=!0,e=File.editor.sourceView.cm.doc.historySize(),JSBridge.menu.update({"Edit→Undo":{enabled:!File.isLocked&&0<e.undo},"Edit→Redo":{enabled:!File.isLocked&&0<e.redo}}),"fromDisk"!==t[0].origin&&File.updateChangeCount(File.ChangeType.NSChangeDone),n.syncChange([{type:"sync",srcChanges:t}]),File.needsUpdateSnap())}),this.cm.on("contextmenu",function(e,t){var n,i;r.inSourceMode&&(n=e.getCursor("from"),i=e.getCursor("to"),setTimeout(function(){e.setSelection(n,i,{scroll:!1})},180),File.isNodeHtml)&&File.editor.contextMenu.show(t)}),i=!1,o=!1,this.cm.on("cursorActivity",function(e,t){o=!1,r.inSourceMode&&(File.isFocusMode&&n.updateFocusMode(!0),e.curOp&&!e.curOp.scrollToPos||(File.isTypeWriterMode?File.option.scrollWithCursor&&(i?o=!0:r.scrollAdjust()):i||r.normalScrollAdjust()),File.isNodeHtml)&&File.editor.contextMenu.hide(t)}),this.cm.on("scrollCursorIntoView",function(e,t){r.inSourceMode&&!File.isTypeWriterMode||t.preventDefault()}),this.cm.display.scroller.addEventListener("mousedown",function(e){i=!0},!0),window.addEventListener("mouseup",function(e){o&&i&&r.scrollAdjust(),i=o=!1}),this.cm.display.scroller.addEventListener("wheel",function(e){Math.abs(e.deltaY)<4||File.isFocusMode&&File.isTypeWriterMode&&n.updateFocusMode(!1)},{passive:!0}))},i.prototype.show=function(){File.sync();var t,e=this.editor.getMarkdown();try{t=C.call(this)}catch(e){t=null,console.warn(e.stack)}this.editor.refocus(null),this.editor.cleanTooltip(),this.editor.searchPanel.closePanel(!0),this.inSourceMode=!0,File.isNode&&JSBridge.invoke("window.setInSourceMode",!0),c("body").addClass("typora-sourceview-on");var n=c("content");c("body").find(".md-tooltip-hide").hide(),document.body.classList.remove("ty-show-notification"),n.find(".auto-suggest-container.ty-show").removeClass("ty-show"),this.renderedHTML="",this.prep(),this.cm.setValue(e,"begin"),u=!1,l.show(),F.call(this,t),this.cm.refresh(),this.cm.focus(),this.cm.getDoc().clearHistory(),this.cm.options.readOnly=File.isLocked,this.enableTypeWriterMode(File.isTypeWriterMode)},i.prototype.enableTypeWriterMode=function(e){this.cm&&(e?(e=this.cm.defaultTextHeight(),r=document.querySelector("content").clientHeight,this.cm.display.lineSpace.parentNode.style.paddingTop=(r-e)/2+"px",this.cm.display.lineSpace.parentNode.style.paddingBottom=(r-e)/2+"px"):(this.cm.display.lineSpace.parentNode.style.paddingTop="",this.cm.display.lineSpace.parentNode.style.paddingBottom=""),this.scrollAdjust())},i.prototype.setValue=function(e,t,n){this.cm&&(e!=this.cm.getValue()&&this.cm.setValue(e,n||"begin"),t)&&(u=!0)},i.prototype.onSave=function(){this.cm.doc.history.lastModTime=0},i.prototype.hide=function(){var e,t,n=this.editor,i=(n.searchPanel.closePanel(),c("body").removeClass("typora-sourceview-on"),this.inSourceMode=!1,File.isNode&&JSBridge.invoke("window.setInSourceMode",!1),this.cm.getCursor());i.lineText=this.cm.getLine(i.line),t=(e=i).lineText.substring(0,e.ch),e.inRef=t.match(y)&&!t.match(v),e.textBefore=t,u?File.isMac&&!File.isDocumentEdited()&&this.renderedHTML?(c(File.editor.sessionStr).html(this.renderedHTML),setTimeout(function(){File.editor.refresh()},500),File.editor.syncChange([{type:"sync",allHtml:this.renderedHTML,json:s.buildAllDoc(File.editor.nodeMap).json}])):File.reloadContent(this.cm.getValue(File.useCRLF?"\r\n":"\n"),{delayRefresh:!0,skipChangeCount:!0,skipStore:!0}):File.editor.tryEnterBusyMode(this.cm.getValue()),l.hide(),x.call(this,i),n.selection.scrollAdjust(),window.Reporter.fullValidate()},i.prototype.scrollAdjust=function(){var e=this.cm.getScrollInfo(),t=this.cm.getCursor(),t=this.cm.charCoords(t,"local").top,e=e.clientHeight/2;this.cm.scrollTo(null,t-e-5)},i.prototype.normalScrollAdjust=function(){var e=this.cm.getScrollInfo(),t=this.cm.getCursor(),t=this.cm.charCoords(t,"local").bottom;e.clientHeight+e.top-59<t&&this.cm.scrollTo(null,e.top+60)};var y=/\[/,v=/\]/;var b=function(e,t,n,i){var r=null;function o(e,t,n){return void 0===n&&(n=(n=t?i.lineText.indexOf(e):i.lineText.lastIndexOf(e))<0?0:n),Math.max(0,i.ch-n)}var a,s,l=e.findElemById(t.cid);switch(t.get("type")){case m.paragraph:for(var c=t.get("text").split(/\n/),d=0,u=0;u<n&&u<c.length;u++)d+=c[u].length+1;l.find(".md-math-after-sym, .md-emoji-control-ch").text(""),e.undo.exeCommand({type:"cursor",id:t.cid,start:d+o(c[n])}),l.find(".md-math-after-sym, .md-emoji-control-ch").text("​");break;case m.heading:l.find(".md-math-after-sym, .md-emoji-control-ch").text(""),e.undo.exeCommand({type:"cursor",id:t.cid,start:function(e,t){var n,i=t;for(n in e)void 0!==n&&n<=t&&(i+=e[n]);return i}(t.cursorDiff||[],o(t.get("text")))}),l.find(".md-math-after-sym, .md-emoji-control-ch").text("​");break;case m.hr:case m.toc:t.get("after")?e.selection.jumpIntoElemBegin(e.findElemById(t.get("after").getVeryFirst().cid)):e.selection.selectNode(t);break;case m.math_block:r=e.mathBlock.startEditing(t.cid),n--;break;case m.html_block:r=e.htmlBlock.startEditing(t.cid);break;case m.fences:(t.get("pattern")||"```").match(/`/)&&n--,r=e.fences.getCm(t.cid);break;case m.def_link:case m.def_footnote:i.inRef?e.undo.exeCommand({type:"cursor",id:t.cid,start:o(t.get("ref"),!0)}):(h=(a=new RegExp("(]:\\s*)"+p.escapeRegExp(t.get("href")||t.get("text"))).exec(i.lineText))?a.index+a[1].length:0,e.undo.exeCommand({type:"cursor",id:t.cid,start:t.get("ref").length+o(void 0,void 0,h)}));break;case m.meta_block:for(var c=t.get("text").split(/\n/),h=i.ch,u=0;u<n-1;u++)h+=(c[u]||"").length+1;e.undo.exeCommand({type:"cursor",id:t.cid,start:h});break;case m.table_row:s=(a=i).textBefore,a.cellsBefore=f.splitTableCell(s.replace(/^\s*\|/,""),!0)||[s],a.cellsOffset=a.cellsBefore.last().length,a.cellsBefore=a.cellsBefore.length,e.undo.exeCommand({type:"cursor",id:t.getNthChild(Math.max(0,i.cellsBefore-1)).cid,start:i.cellsOffset});break;default:e.selection.jumpIntoElemEnd(e.findElemById(t.getVeryFirst(!0).cid))}r&&(r.focus(),n>=r.lineCount()?r.execCommand("goDocEnd"):r.setCursor({line:n,ch:o(r.getLine(n))}))},w=function(e,t,n,i){var r,o=0;for(n+(t.get("ahead")||0)>i.line&&e.selection.jumpIntoElemBegin(e.findElemById(t.getVeryFirst().cid)),o=g(t);t.get("after")&&n+o<=i.line;)n+=o,o=g(t=t.get("after"));t.get("children").length&&!d.isType(t,m.table_row)?w(e,t.getFirstChild(),n+(t.get("ahead")||0),i):n+o-(r=t,d.isType(r,m.table_row)?0:h(r))>i.line?b(e,t,i.line-n-(t.get("ahead")||0),i):e.selection.jumpIntoElemEnd(e.findElemById(t.getVeryFirst(!0).cid))},x=(i.prototype.gotoLine=function(e){var t=this.editor;try{w(t,t.nodeMap.getFirst(),0,e)}catch(e){console.warn(e.stack)}},function(e){var t=this.editor;try{w(t,t.nodeMap.getFirst(),0,e)}catch(e){console.warn(e.stack)}t.refocus()}),C=function(e){if(this.editor.focusCid){var t=this.editor.findElemById(this.editor.focusCid),n=this.editor.getNode(this.editor.focusCid),i=0,r="",o="",a=this.editor.selection.getRangy();if(n){i=function e(t,n){return n=n||0,t?t.get("before")?e(t.get("before"),n+g(t.get("before"))):t.get("parent")?e(t.get("parent"),n+(t.get("parent").get("ahead")||0)):n:n}(n)+(n.get("ahead")||0);if(d.isType(n,m.fences))return(s=!/`|~/.exec(n.get("pattern")||"```"))||i++,(e=document.activeElement.classList.contains("ty-cm-lang-input")?{line:-1,before:n.get("pattern")||"```"}:this.editor.fences.getCm(n.cid).doc.getCursor()).before=(s?n.get("pattern"):"")+this.editor.fences.getCm(n.cid).getLine(e.line).substring(0,e.ch),e.line=e.line+i,e.ch=void 0,e;if(d.isType(n,m.math_block))return this.editor.mathBlock.currentCm?((e=this.editor.mathBlock.currentCm.doc.getCursor()).line=e.line+i+1,e):{line:i,ch:-1};if(d.isType(n,m.toc))return{line:i,before:"]"};if(d.isType(n,m.hr))return{line:i,before:this.get("pattern")||"------"};if(d.isType(n,m.def_link,m.def_footnote)){var s=this.editor.getJQueryElem(a.startContainer),l=s.closest(".md-def-content");if(l.length)return a.setStartBefore(l[0]),{line:i,before:r="]: "+a.toString()};if((l=s.closest(".md-def-title")).length&&s.text().length)return a.setStartBefore(l[0]),{line:i,before:r='"'+a.toString()}}if(d.isType(n,m.table,m.table_row))return{line:i,ch:-1};if(a.setStartBefore(t[0]),r=c(a.toHtml()).rawText(),d.isType(n,m.table_cell)){for(o="",n=n.get("before");n;)o="\\|[^|]*"+o,n=n.get("before");return{line:i,beforeRegExp:r=o+"\\|\\s*"+p.escapeRegExp(r)}}if(d.isType(n,m.meta_block))return{line:i=((r=r.replace(/^---/gm,"​---").replace(/\n$/g,"")).match(/\n/g)||[]).length+1,before:r=r.substring(r.lastIndexOf("\\n"))};if(d.isType(n,m.html_block))return this.editor.htmlBlock.currentCm?((e=this.editor.htmlBlock.currentCm.doc.getCursor()).line=e.line+i,e):{line:i+2,ch:-1};if(""===r&&d.isType(n,m.paragraph,m.heading)){if(d.isType(n,m.heading)){s=n.toMark();if(/^\s*#/.exec(s))return{line:i,beforeRegExp:"^\\s*#+\\s*"}}l=n.getTopBlock();if(d.isType(l,m.list,m.blockquote))return{line:i,ch:0,afterIndent:!0}}t=r.split(/\n/)||[r],r=t.last();return{line:i+t.length-1,before:r.replace(/(\u200B*):(\u200B*)/g,":").replace(/\u200B\$/g,"$")}}}},F=function(e){if(e)try{var t,n,i=e.ch;e.line<0&&(e.line=this.cm.doc.lineCount()-1),e.afterIndent&&(t=this.cm.doc.getLine(e.line),i=(/^((\s+)|([-+*]\s)|(\[( |x)\])|>|(\d+(\.|\))\s))+/i.exec(t)||[""])[0].length),void 0===i&&(t=this.cm.doc.getLine(e.line)||"",e.before?i=t.indexOf(e.before)+e.before.length:e.beforeRegExp&&((n=new RegExp(e.beforeRegExp,"g")).exec(t),i=n.lastIndex)),this.cm.doc.setCursor({line:e.line,ch:0<i?i:0}),i<0&&this.cm.execCommand("goLineEnd")}catch(e){console.warn(e.stack)}};n.exports=i}),$__System.registerDynamic("3b",["32","11"],!0,function(e,t,n){this||self;var p=e("32"),f=e("11");const m=["typora-root-url","typora-copy-images-to"],o=["title","author","defaultCodeLang","end-of-line","papersize","margin","margin-left","margin-right","margin-top","margin-bottom","append-head","append-body"].concat(m);function i(e){this.editor=e,this.levels=[],this.fileSetting={},this.projectSetting={},this.isLoadingProjectSetting=!1,this.prevFilePath=null,File.bundle.path&&this.loadFromProject()}function g(n){var i={};function r(e){var t=n(e);return t||(t=e.replace(/-/g,"_"),n(t))}return o.map(e=>{var t=r(e);(t=!t&&/^typora/.exec(e)?r(e.replace(/^typora[-_]/,"")):t)&&(i[e]=t)}),i}i.prototype.preferCRLF=function(){var e=this.getSetting("end-of-line")||"";return e.length?"crlf"==e.toLowerCase():File.option.preferCRLF},i.prototype.preferFinalNewline=function(){var e=this.getSetting("prefer-final-newline")||"";return"true"==e.toLowerCase()?1:"false"==e.toLowerCase()?-1:File.option.preferFinalNewline},i.prototype.getCalculatedSetting=function(){return Object.assign({},this.projectSetting,this.fileSetting)},i.prototype.getSetting=function(e){var t=this.projectSetting[e]||this.projectSetting[e.toLowerCase()];return"unset"===(t="unset"!==t&&void 0!==t?t:this.fileSetting[e]||this.fileSetting[e.toLowerCase()])||void 0===t?File.option[e]:t};var r=["title","author","subject","creator","epub-chapter-level"],a=["header","footer","sidebar","append-head","append-head-extra","append-body","append-body-extra"].concat(r),s=(i.prototype.loadExportOption=function(e){var t=e.allowPerFileSetting?a:r,n={},i=(t.forEach(e=>{var t=this.getSetting("typora-"+e)||this.getSetting(e)||this.getSetting(f.capitalize(e));void 0!==t&&(n[f.camelize(e)]=t)}),"true"===n.sidebar&&(n.sidebar=!0),"false"===n.sidebar&&(n.sidebar=!1),"pdf"!=e.type&&"epub"!=e.type||(n.appendHead&&(n.userAppendHead=!0),n.appendBody&&(n.userAppendBody=!0),delete n.appendHead,delete n.appendBody,delete n.appendHeadExtra,delete n.appendBodyExtra),Object.assign({},e,n));return Object.keys(i).map(e=>{i[e]="unset"==i[e]?"":i[e]}),i},null),l=(i.prototype.cacheSetting=async function(){this.projectSetting=await this.getCalculatedProjectSetting(),s&&clearTimeout(s),s=setTimeout(()=>{this.editor.imgEdit.refreshLocalImg()},100)},i.prototype.loadFromFile=function(){var e=this.editor.docMenu.buildMetaMap();return this.fileSetting=e,this.fileSetting},i.prototype.loadFromProject=async function(e){},i.prototype.getCalculatedProjectSetting=async function(){const t=()=>{var e={};for(record of this.levels)Object.assign(e,record[1]);return e};return this.isLoadingProjectSetting?new Promise(e=>{setTimeout(()=>{this.isLoadingProjectSetting?setTimeout(()=>{e(t())},500):e(t())},100)}):t()},i.prototype.onFilePathChanged=async function(){if(this.prevFilePath!==File.bundle.filePath){this.prevFilePath=File.bundle.filePath;var e=[],t=null;for(record of this.levels){if(!File.bundle.filePath.startsWith(record[0]))break;t=record[0],e.push(record)}this.levels=e,await this.loadFromProject(t)}},i.prototype.searchProjectConfigByNode=async function(e){e||(this.levels=[],e="");const t=reqnode("path"),r=reqnode("fs-extra");if(n=p.getCurrentFileFolderPath()||File.getMountFolder()){for(var n,i=async e=>{try{var t,n,i=await r.readFile(e+"/.editorConfig","utf8");return i?(t=this.parseFromString(i),n={},t.map(t=>{t[0]||(n.notRoot="true"!==t[1].root),t[0]&&"typora"!==t[0]||(n=Object.assign(n,g(e=>t[1][e])))}),n):void 0}catch(e){}return null},o=async e=>{try{var t,n=await r.readFile(e+"/.typoraConfig","utf8");return n?(t=this.parseFromString(n)[0][1],g(e=>t[e])):void 0}catch(e){}return null},a=!1,s=!1,l=n=t.normalize(n),c=[];1<l.length&&e!=l&&(this.isLoadingProjectSetting=!0,!a||!s);){var[d,u]=await Promise.all([a?Promise.resolve(null):i(l),s?Promise.resolve(null):o(l)]),a=a||!(d||{}).notRoot,s=!!u,h=null;(h=d&&u?Object.assign(d,u):u||d)&&(m.map(e=>{var t=h[e];t&&(h[e]=f.getAbsolutePath(l,t))}),c.push([l,h])),l=f.pathByDeleteLastComponent(l)}this.levels=this.levels.concat(c.reverse()),this.cacheSetting(),this.levels}},{section:/^\s*\[(([^#;]|\\#|\\;)+)\]\s*([#;].*)?$/,param:/^\s*([\w\.\-\_]+)\s*[=:]\s*(.*?)\s*([#;].*)?$/,comment:/^\s*[!#;].*$/,eatNextLine:/\\\s*$/});i.prototype.parseFromString=function(e){var n,i={},r=[[null,i]],e=e.split(/\r\n|\r|\n/);function o(e){return e.replace(/\\([\s\\])/g,"$1").replace(/^[ \t]|[ \t]$/g,"")}var a=!1;return e.forEach(function(e){var t;a?(i[a]+=o(e),a=!!l.eatNextLine.exec(e)&&a):l.comment.test(e)||(l.param.test(e)?(t=e.match(l.param),i[t[1]]=o(t[2]),!t[3]&&l.eatNextLine.exec(t[2])&&(a=t[1])):l.section.test(e)&&(t=e.match(l.section),n=t[1].toLowerCase(),i={},r.push([n,i])))}),r},i.prototype.show=async function(){File.editor.library.tmpHideSidebar(!0);var e=document.querySelector("#ty-local-setting");e?e.contentWindow.postMessage({type:"reload",initData:{workspaceSetting:await this.getCalculatedProjectSetting(),fileSetting:this.fileSetting}},"*"):e=this.initFrame(),document.body.classList.add("ty-show-local-setting")},i.prototype.close=function(){File.editor.library.recoverSidebar(),document.body.classList.remove("ty-show-local-setting")},i.prototype.initFrame=function(){var i=document.createElement("IFRAME");return i.setAttribute("id","ty-local-setting"),i.setAttribute("src","http://localhost:3000/local-setting.html?os=win"),document.body.appendChild(i),window.addEventListener("message",async e=>{var t,n;e.source===i.contentWindow&&({type:e,_callbackID:t}=e.data,n=e=>{t&&(e=e||{},e=Object.assign({},e,{_callbackID:t,type:"callback"}),i.contentWindow.postMessage(e,"*")),t=null},"closeLocalSetting"==e?this.close():"fetchLocalSetting"==e&&n({userLocale:File.option.userLocale,workspaceSetting:await this.getCalculatedProjectSetting(),fileSetting:this.fileSetting}),n())},!1),i},n.exports=i}),$__System.registerDynamic("3c",["e","11","26","32"],!0,function(e,R,O){"use strict";this||self;function t(e){this.editor=e,this.worker=null}var a,s=e("e"),c=e("11"),r=e("26").map,I=(e("32"),s(s("#typora-quick-open-item-templ").html())),l=s(s("#typora-quick-loading-item-templ").html()),d=s(".typora-quick-open-list"),u=s(".typora-quick-open-list-inner"),o=s("#typora-quick-open-input input"),h=[],p=[],f=[],m=[],g=0,y=[],v="",b=[],w=40,n=8,x=-1,i=null,C=null,F=0,S=!0,k=-1,E=20;function T(e,t){var n;File.isMac&&(t?bridge.callHandler("controller.openFolder",e):bridge.callHandler("path.openFile",e)),File.isNode&&(t?JSBridge.invoke("app.openFolder",e,!0):JSBridge.invoke("app.openFileOrFolder",e,{mountFolder:(t=File.getMountFolder(),e=e,n=File.isWin?"\\":"/",t&&e&&0==e.indexOf(t.replace(/[\/\\]$/,"")+n)?File.getMountFolder():void 0)}))}function _(e){var t=File.getMountFolder();if(t){var n=t.lastIndexOf(File.isWin?"\\":"/"),n=t.substring(0,n+1);if(0===e.indexOf(t))return e.substring(n.length)}return 60<(e=(C=!C&&File.option.userPath?new RegExp("^"+c.escapeRegExp(File.option.userPath)):C)?e.replace(C,"~"):e).length?e.substring(0,30)+"..."+e.substring(e.length-30,e.length):e}function A(e,t,n,i){var r,o;function a(e){return b.length?e.replace(/</g,"").replace(/>/g,"").replace(new RegExp("(("+b.join(")|(")+"))","gi"),function(e,t){return"<b>"+t.replace(/</g,"").replace(/>/g,"")+"</b>"}).replace(/\uE27A/g,"&lt;").replace(/\uE27B/g,"&gt;").replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#39;"):c.escapeForPreWrap(e)}e.n?(l=e.n,o=e.p.replace(/[\/\\][^\/\\]+$/,"")+(File.isWin?"\\":"/"),r=e.p):(l=(s=/[^\\\/]+$/.exec(r=e))[0],o=r.substring(0,s.index)),l=a(l),i&&(l+=File.isWin?"\\":"/");var s=t.children(".typora-quick-open-info-item"),l=I.clone().find(".typora-quick-open-item-title").html(l).end().find(".typora-quick-open-item-path").html(a(e.rp||_(o))).end().attr("data-is-dir",i||!1).attr("data-path",r).attr("data-index",n+"").addClass(k==n?"active":"");s.length?s.before(l):t.append(l).css("translate3d","(0, 0, 0)")}function M(t){var n=0;return y.forEach(function(e){e<t&&(n+=20)}),n}function L(e){var t;h.length&&(k=-1==k?0:(k+e)%h.length,s(".typora-quick-open-item.active").removeClass("active"),s(".typora-quick-open-item[data-index='"+k+"']").addClass("active"),e=M(k),(e=k*w+e)<(t=d.scrollTop())||t+w*n-25<e)&&d.scrollTop(Math.min(e,(h.length-n)*w+M(h.length))-4)}function N(e,r){r=r||u;var o=h.length-g;function t(e){if(!(e<0)){r.find("[data-block-index='"+e+"']").remove();var t=s("<div class='quick-open-group-block' data-block-index='"+e+"'>").css("position","absolute").css("top",e*E*40+"px").css("width","100%");if(!((a=Math.min(o+F,e*E+E+F))<e*E)){for(var n,i=e*E;i<a;i++)i==o&&F?(n=o,t.append(l.clone().find(".typora-quick-open-info").text(s.localize.getString(n?"Gathering more results":"Searching")).end())):A(h[i+g],t,i+g);r.append(t)}}}var n=d.scrollTop(),n=Math.floor(n/40),n=Math.floor(n/E);n!=x&&(t((x=n)-1),t(x),t(x+1))}function D(e,t,n){if(e)return e=n.parent().show(),0<t?e.addClass("ty-has-prev"):e.removeClass("ty-has-prev"),1;n.parent().hide()}function P(e,n,i,r){$(e),e.length&&y.push(n),i.html(""),e.forEach(function(e,t){A(e,i,n+t,r)}),D(e.length,n,i)}function $(e){i&&k<0&&(k=e.findIndex(function(e){return e.p==i}))}function H(e){var t,n,e=(b=e.split(/\s+/).filter(c.isNotNullOrEmpty).map(function(e){return e.replace(/[.+?^${}()|[\]\\]/g,"\\$&").replace(/\*/g,".*")})).map(function(e){return new RegExp("(.)?"+c.normalize(e)+"(.)?","i")}),i=(h=File.bundle.filePath?[File.bundle.filePath]:[],y=[],k=-1,0),e=(File.getMountFolder()?(t=B(e,b.length?f:f.slice(0,12),h),n=B(e,b.length?m:m.slice(0,7),h)):(n=B(e,b.length?m:m.slice(0,7),h),t=B(e,b.length?f:f.slice(0,12),h)),B(e,p,h));h[0]===File.bundle.filePath&&h.splice(0,1),P(n,0,s("#ty-quick-open-folder-list-inner"),!0),P(t,i+=n.length,s("#ty-quick-open-recent-list-inner")),i+=t.length,n=i,x=-1,$(t=e),t.length&&y.push(n),g=n,u.html("").height(w*(t.length+F)),D(t.length+F,n,u)&&(0==g?u.prev().css("height","0"):u.prev().css("height","auto")),N(0,u),0<(i+=e.length)&&!s(".typora-quick-open-item.active").length&&(e=s(".typora-quick-open-item")[0])&&e.classList.add("active")}function B(o,e,a){a=a||[];var s=File.getMountFolder()+(File.isWin?"\\":"/"),l=[],c=[];return o.length?(e.forEach(function(t){var n,e=0;if(!(-1<a.indexOf(t.p))){for(var i=s&&0==t.p.indexOf(s),r=0;r<o.length;r++){if(!(n=2*U(t.n,o[r]))){let e=t.p;e=t.rp||_(e.replace(/[\/\\][^\/\\]+$/,"")+(File.isWin?"\\":"/")),n=U(t.rp=e,o[r])}if(!n)return;e+=n}i&&(e+=3),t.s=e,l.push(t),c.push(t.p)}}),l.sort(function(e,t){var n=t.s-e.s;return n||t.d-e.d})):((l=e.filter(function(e){return-1==a.indexOf(e.p)})).sort(function(e,t){var n=(0==t.p.indexOf(s)?1:0)-(0==e.p.indexOf(s)?1:0);return n||t.d-e.d}),c=l.map(function(e){return e.p})),a.splice.apply(a,[a.length,0].concat(c)),l}function U(e,t){e=c.normalize(e);t=t.exec(e)||t.exec(c.removeDiacritics(e));return t?(t[1]=t[1]||"",t[3]=t[3]||"",4-t[1].length-(/\w/.test(t[1])?1:0)-(/\w/.test(t[3])?1:0)):0}function j(e){i=h[k],S?(File.getMountFolder()&&this.setSearchState(1),File.isMac&&bridge.callHandler("quickOpen.query",e),File.isNode&&File.mountFolder_&&this.worker.postMessage(["quickFind",File.mountFolder_,e])):this.setSearchState(0),H.call(this,e),File.isMac&&bridge.callHandler("quickOpen.reindexFolderIfNeeded")}t.prototype.init=function(){this.bindEvent(),File.isMac?(this.registerBridge(),bridge.callHandler("quickOpen.cacheRecentFiles")):File.isNode&&(this.initWorker(),S=!1,JSBridge.invoke("setting.getRecentFiles").then(e=>{var{files:e,folders:t}=e,n=(this.setRecentFiles(e.map(e=>e.path)),[]),i=[];t.forEach(e=>{(e.pinned?n:i).push(e)}),this.setRecentFolders(n.concat(i).map(e=>e.path))}),this.cacheFolder(File.getMountFolder()),this.listenIpc())},t.prototype.registerBridge=function(){var n=this;bridge.registerHandler("quickOpen.initFileCache",function(e,t){n.initFileCache.apply(n,e||[]),t&&t()}),bridge.registerHandler("quickOpen.updateResult",function(e,t){n.updateResult(e),t&&t()}),bridge.registerHandler("quickOpen.setSearchState",function(e,t){n.setSearchState(e),t&&t()}),bridge.registerHandler("quickOpen.setRecentFiles",function(e,t){n.setRecentFiles(e),t&&t()}),bridge.registerHandler("quickOpen.setRecentFolders",function(e,t){n.setRecentFolders(e),t&&t()}),bridge.registerHandler("quickOpen.updateCacheByRename",function(e,t){n.updateCacheByRename(e.src,e.dest),t&&t()}),bridge.registerHandler("quickOpen.updateCache",function(e,t){n.updateCache(e.toDel,e.toAdd,e.group),t&&t()})},t.prototype.bindEvent=function(){var e,t,n,i=this;o.on("input",(e=function(){var e=o.val();e!=v&&(v=e.replace(/[()'"%\\\/.?]/g," "),j.call(i,v))},t=100,n=null,function(){n=n||setTimeout(function(){e(),n=null},t)})).on("keydown",function(e){var t=e.keyCode||e.which;if("Esc"==r[t]||"o"==r[t]&&e.shiftKey&&e.metaKey)return i.close(),!1;if("Tab"==r[t])return!1;if("Up"==r[t])return L(-1),!1;if("Down"==r[t])return L(1),!1;if("Enter"==r[t]){var n=s(".typora-quick-open-item.active")[0];if(n)return T(n.dataset.path,n.dataset.isDir+""=="true"),i.close(),!1}if(File.isMac&&e.ctrlKey&&!e.metaKey&&!e.shiftKey){if("P"==String.fromCharCode(t))return L(-1),!1;if("N"==String.fromCharCode(t))return L(1),!1}e.stopPropagation()}).on("blur",function(){setTimeout(i.close,200)}),d.on("mousedown",".typora-quick-open-item",function(e){1==e.which&&T(this.dataset.path,this.dataset.isDir+""=="true")}).on("scroll",N)},t.prototype.listenIpc=function(){var e=reqnode("electron").ipcRenderer,n=this;e.on("updateQuickOpenCache",function(e,t){n.updateCache(t.toDel,t.toAdd,t.group)})},t.prototype.stopQuery=function(){File.isMac&&bridge.callHandler("quickOpen.stopQuery"),File.isNode&&this.worker.postMessage(["stopQuery"])},t.prototype.initWorker=function(){this.worker=new Worker("appsrc/finder-worker.js");var t=this;this.worker.onmessage=function(e){switch(e.data.type){case"initFileCache":t.initFileCache.apply(t,e.data.detail);break;case"addInitFiles":t.addInitFiles.apply(t,e.data.detail);break;case"removeInitFiles":t.removeInitFiles.apply(t,e.data.detail);break;case"queryMatch":t.updateResult.apply(t,e.data.detail);break;case"queryEnd":t.setSearchState.apply(t,[0])}},this.worker.postMessage(["setSupportTextBundle",File.option.supportTextBundle,File.option.supportTextPack]),this.worker.postMessage(["setDefaultExtension",File.option.defaultExtension||"md"]),window.dirname&&this.worker.postMessage(["nodeInit",window.dirname])},t.prototype.cacheFolder=function(e){S=!0,p=[],File.isNode&&this.worker.postMessage(["listAllFiles",e])},t.prototype.show=function(){var e=s("#typora-quick-open:not(:visible)").show();this.editor.searchPanel.closePanel(!0),e.length&&(o[0].select(),k=-1,j.call(this,o.val().replace(/[()'"%\\\/.?]/g," "))),Analytics.record("QuickOpen")},t.prototype.close=function(){s("#typora-quick-open:visible").hide().length&&File.isMac&&bridge.callHandler("quickOpen.stopQuery"),k=-1},t.prototype.appendResultAtEnd=function(e,n){var i=u.children().last();return!!(i.hasClass("quick-open-group-block")&&i[0].childElementCount+e.length<=E)&&(e.forEach(function(e,t){A(e,i,n+t)}),!0)},t.prototype.updateResult=function(e){e=e.filter(function(e){return"object"==typeof e&&(e.rp=""),-1==h.indexOf(e)});var t=h.length;e.length&&(h=h.concat(e),u.height(w*(h.length-g+F)),h.length-t==e.length&&this.appendResultAtEnd(e,t)?D(e.length,t,u):(x=-1,u.html(""),N(0,u)))},t.prototype.addInitFiles=function(e,n,i){p=p.concat(e.map(function(e,t){return{n:n[t],p:e,d:i[t]}}));var t={};p=p.filter(function(e){return!t[e.p]&&(t[e.p]=1,!0)})},t.prototype.removeInitFiles=function(t){var n=t.length;p=p.filter(function(e){return e.p.substring(0,n)!=t}),this.updateCache(t)},t.prototype.initFileCache=function(e,n,i,t,r){p=e.map(function(e,t){return{n:n[t],p:e,d:i[t]}}),r&&(f=r.map(function(e){return{n:(/[^\\\/]+$/.exec(e)||[])[0]||"",p:e}})),S=t>e.length,s("#typora-quick-open:visible").length&&0==b.length&&this.updateResult(p)},t.prototype.updateCache=function(t,n,e){var i=File.isWin?"\\":"/";t&&[f,m].forEach(function(e){e.removeIf(function(e){return e.p!=t&&0!=(t+i).indexOf(e.p)&&File.isNode&&JSBridge.invoke("setting.removeRecentDocument",t),!0})},this),n&&n!=File.bundle.filePath&&((e={recentFiles:f,recentFolders:m}[e]).removeIf(function(e){return e.p==n}),e.unshift({n:(/[^\\\/]+$/.exec(n)||[])[0]||"",p:n}))},t.prototype.updateCacheByRename=function(t,n){var i=File.isWin?"\\":"/",e=[f,m];File.isNode&&e.push(p),e.forEach(function(e){e.forEach(function(e){e.p!=t&&0!=e.p.indexOf(t+i)||(e.p=n+e.p.substring(t.length),e.n=(/[^\\\/]+$/.exec(e.p)||[])[0]||"")})},this)},t.prototype.setRecentFiles=function(e){f=e.map(function(e){return{n:(/[^\\\/]+$/.exec(e)||[])[0]||"",p:e}})},t.prototype.setRecentFolders=function(e){m=e.map(function(e){return{n:(/[^\\\/]+$/.exec(e)||[])[0]||"",p:e}})},t.prototype.setSearchState=function(e){var t;F!==e&&(e&&a==h.length-g?(s(".typora-quick-open-item:last").after(l.clone().find(".typora-quick-open-info").text(s.localize.getString(a?"Gathering more results":"Searching")).end()),a++):e||(s(".typora-quick-open-info-item").remove().length&&(t=u.height()-40,u.height(t),t<10)&&u.parent().hide(),a==h.length-g+1&&a--),F=e)},O.exports=t}),$__System.registerDynamic("3d",["2b","e","32","26"],!0,function(e,t,n){"use strict";this||self,e("2b");function i(e){this.editor=e,this.perFileSettingCache_=new Map,this.langMode_=File.option.presetSpellCheck,this.missingLocale_,this.clear_();var t=this;window.requestIdleCallback?requestIdleCallback(function(){t.init_(),t.reset()}):setTimeout(function(){t.init_(),t.reset()},100)}var o=e("e"),r=e("32"),a=e("26").map,s=[{code:"en-US",userLang:"en-US",label:"English (US)",enLabel:"English (US)"},{code:"en-GB",userLang:"en-GB",label:"English (UK)",enLabel:"English (UK)"},{code:"id",userLang:"id-ID",label:"Bahasa Indonesia",enLabel:"Indonesian"},{code:"nb",userLang:"nb-NO",label:"Bokmål",enLabel:"Norwegian"},{code:"cs",userLang:"cs-CZ",label:"Čeština",enLabel:"Czech"},{code:"ca",userLang:"ca-ES",label:"Català",enLabel:"Catalan"},{code:"da",userLang:"da-DK",label:"Dansk",enLabel:"Danish"},{code:"de",userLang:"de-DE",label:"Deutsch",enLabel:"German"},{code:"de-CH",userLang:"de-CH",label:"Schweizerdeutsch",enLabel:"Swiss German"},{code:"es",userLang:"es-ES",label:"Español",enLabel:"Spanish"},{code:"el",userLang:"el-GR",label:"Ελληνικά",enLabel:"Greek"},{code:"fr",userLang:"fr-FR",label:"Français",enLabel:"French"},{code:"gl",userLang:"gl-ES",label:"Galego",enLabel:"Galician"},{code:"hr",userLang:"hr-HR",label:"Hrvatski",enLabel:"Croatian"},{code:"it",userLang:"it-IT",label:"Italiano",enLabel:"Italian"},{code:"ro",userLang:"ro-RO",label:"Limba Română",enLabel:"Romanian"},{code:"nl",userLang:"nl-NL",label:"Nederlands",enLabel:"Dutch"},{code:"nn",userLang:"nn-NO",label:"Nynorsk",enLabel:"Norwegian Nynorsk"},{code:"hu",userLang:"hu-HU",label:"Magyar",enLabel:"Hungarian"},{code:"ms",userLang:"ms-MY",label:"Orang Melayu",enLabel:"Malay"},{code:"pl",userLang:"pl-PL",label:"Polski",enLabel:"Polish"},{code:"pt-BR",userLang:"pt-BR",label:"Português (Brasil)",enLabel:"Portuguese (Brazil)"},{code:"pt",userLang:"pt-PT",label:"Português (Portugal)",enLabel:"Portuguese (Portugal)"},{code:"ru",userLang:"ru-RU",label:"Ру́сский",enLabel:"Russian"},{code:"sk",userLang:"sk-SK",label:"Slovenčina",enLabel:"Slovak"},{code:"sl",userLang:"sl-SI",label:"Slovenščina",enLabel:"Slovenian"},{code:"sv",userLang:"sv-SE",label:"Svenska",enLabel:"Swedish "},{code:"vi",userLang:"vi-VN",label:"Tiếng Việt",enLabel:"Vietnamese"},{code:"tr",userLang:"tr-TR",label:"Türkçe",enLabel:"Turkish"},{code:"uk",userLang:"uk-UA",label:"Українська мова",enLabel:"Ukrainian"},{code:"fa",userLang:"fa-IR",label:"فارسی",enLabel:"Persian"},{code:"ar",userLang:"ar-SA",label:"العربية",enLabel:"Arabic"},{code:"he",userLang:"he-IL",label:"עִבְרִית",enLabel:"Hebrew"},{code:"ko",userLang:"jo-KR",label:"한국어",enLabel:"Korean"},{code:"zh",userLang:"zh",label:"中文",enLabel:"Chinese"},{code:"ja",userLang:"ja-JP",label:"日本語",enLabel:"Japanese"}],l="disabled",c="auto",d=(i.prototype.useHunSpell=function(){return!/Windows NT (8|10)\./.exec(navigator.userAgent)},i.prototype.loadEnvLang_=function(){var t=new Map,e=(this.labelMap={},s.forEach(function(e){t.set(e.userLang,e.code),this.labelMap[e.code]=e.label},this),File.option.userLocale),n=(n=t.get(e))||(/^zh/.exec(e)?"zh":t.get(File.option.appLocale||"en-US")||"en-US");this.envLang_=n},i.prototype.loadSettingForFile_=function(){var e;this.spellCheckFactory&&(File.bundle.filePath?this.perFileSettingCache_.has(File.bundle.filePath)?this.langMode_=this.perFileSettingCache_.get(File.bundle.filePath)||File.option.presetSpellCheck:(this.langMode_=r.getItemInDB("[spellcheck]"+File.bundle.filePath),this.perFileSettingCache_.set(File.bundle.filePath,this.langMode_),this.langMode_=this.langMode_||File.option.presetSpellCheck):this.langMode_=File.option.presetSpellCheck,(e=this).langMode_!=c)&&this.langMode_!=l&&File.isNode&&setTimeout(async function(){e.curSpellchecker=await e.getSpellChecker(e.langMode_,!0)},1e3)},i.prototype.init_=function(){File.isNodeHtml&&(this.$label=document.querySelector("#footer-spell-check"),this.bindUI_(),File.isNode)&&(this.detectTimer_=null,this.loadEnvLang_(),this.bindSpellChecker_())},i.prototype.bindUI_=function(){var e=this;o("#footer-spell-check").on("click",function(){document.body.classList.contains("ty-show-spell-check")?e.hide():e.show()}),o("#spell-check-panel").on("click","[data-spell-lang]",function(){e.setLangMode(this.dataset.spellLang,!0),e.hide(),document.querySelector("#footer-spell-check").classList.contains("ty-spell-check-dict-error")&&e.showDictMissing()}).on("click","#ty-spell-check-global-setting",function(){e.hide(),File.megaMenu.highlight("spellcheck-option-wrapper")});const t=File.option.useMirrorInCN?"typora.com.cn":"typora.io";o("#md-notification").on("click",".dropdown-toggle",function(){o("#md-notification .dropdown-menu:visible").length?o("#md-notification .dropdown-menu").parent().removeClass("open"):o("#md-notification .dropdown-menu").dropdown("toggle")}).on("blur",".dropdown-toggle",function(){o("#md-notification .dropdown-menu").parent().removeClass("open")}).on("shown.bs.dropdown",function(e){var t=o(this),n=t.find(".dropdown-toggle-split"),t=t.find(".dropdown-menu"),i=n.offset();i.top+=n[0].clientHeight+4,i.left+=n[0].clientWidth-t[0].clientWidth+2,t.offset(i)}).on("click","#ty-spell-check-dict-missing-disable-btn",function(){e.setLangMode(l,!0),document.body.classList.remove("ty-show-notification")}).on("click","#ty-spell-check-dict-missing-close-btn",function(){document.body.classList.remove("ty-show-notification")}).on("click","#ty-spell-check-dict-missing-primary-btn",function(){e.useHunSpell()?e.askDownloadDict_():JSBridge.showInBrowser(`https://support.${t}/Spellcheck/`)}).on("mousedown","#ty-spell-check-dict-missing-secondary-btn",function(){e.useHunSpell()?JSBridge.showInBrowser(`https://support.${t}/Spellcheck/`):e.askDownloadDict_()}),o("#dict-install-dialog").on("click",".btn-primary",function(){e.doDownloadDict_()})},i.prototype.postSetSpellChecker_=function(e,t){try{this.resetSpellCheckProvider_()}catch(e){console.sendError(e)}this.userDictPath&&(null==this.curSpellchecker&&this.downloadDicts[e]<=1?o("#footer-spell-check").attr("ty-hint",o.localize.getString("Spell Check (%@ downloading)").replace("%@",this.labelMap[e])).removeClass("ty-spell-check-dict-error").addClass("ty-spell-check-dict-downloading"):(o("#footer-spell-check").removeClass("ty-spell-check-dict-downloading"),null==this.curSpellchecker&&t?(o("#footer-spell-check").attr("ty-hint",o.localize.getString("Spell Check (%@ unavailable)").replace("%@",this.labelMap[e])).addClass("ty-spell-check-dict-error"),this.langMode_==c&&e&&/^(zh|ja|hi)/.exec(e)||this.showDictMissing()):(t=this.labelMap[e]?(o.localize.getString("Spell Check")+" (%@)").replace("%@",this.labelMap[e]):this.langMode_==l?o.localize.getString("Spell Check (Disabled)"):o.localize.getString("Spell Check"),o("#footer-spell-check").attr("ty-hint",t).removeClass("ty-spell-check-dict-error"),o("#ty-spell-check-dict-missing-close-btn").length&&document.body.classList.remove("ty-show-notification"))))},i.prototype.setLangMode=async function(e,t){this.spellCheckFactory||(t=!(e=l)),this.langMode_=e,File.bundle.filePath&&t&&(r.setItemInDB("[spellcheck]"+File.bundle.filePath,e),this.perFileSettingCache_.set(File.bundle.filePath,this.langMode_));var n,t=this.curSpellchecker,e=!1;this.langMode_==l?this.curSpellchecker=null:this.langMode_==c?this.langAuto_?(n=this.langAuto_,this.curSpellchecker=await this.getSpellChecker(this.langAuto_,!0),e=!0):(this.curSpellchecker=null,this.spellCheckFactory.clearCache(),this.scheduleAutoUpdateLang()):(n=this.langMode_,this.curSpellchecker=await this.getSpellChecker(this.langMode_,!0),e=!0),this.postSetSpellChecker_(n,e),t&&t!=this.curSpellchecker&&(t||{}).lang!=(this.curSpellchecker||{}).lang&&o("[contenteditable='true']").prop("contenteditable",!1).prop("contenteditable",!0),this.updatePanel()},i.prototype.buildPanel_=function(){var t,n;this.panelBuilt_||(this.$panel=o("#spell-check-panel"),this.renderLangCandidate_(s),(t=this).panelBuilt_=!0,n=null,o("#ty-spell-check-panel-item-label").on("keydown",function(e){e.stopPropagation();e=e.keyCode||e.which;if("Esc"==a[e])t.hide();else{if("Tab"==a[e])return!1;{if("Up"==a[e]||"Down"==a[e])return t.selectMove_("Up"==a[e]),!1;"Enter"==a[e]?o("[data-spell-lang].ty-active").trigger("click"):"Backspace"!=a[e]&&"Delete"!=a[e]||o(this).trigger("input")}}}).on("input cut copy",function(e){n&&clearTimeout(n),n=setTimeout(function(){t.updateLangCandicate_(),n=null},50)}),this.updatePanel())},i.prototype.renderLangCandidate_=function(e){var t=this.$panel[0].querySelector(".ty-lang-list"),n=this.$panel[0].querySelector("#ty-spell-check-panel-item-temp").innerText.trim(),i=this.langMode_,e=e.map(function(e){return n.replace("%label",e.label).replace(/%code/g,e.code).replace(/%select/,i==e.code?"ty-checked":"")}).join("");t.innerHTML=e},i.prototype.updateLangCandicate_=function(){var n,e,i=o("#ty-spell-check-panel-item-label").val().trim().toLocaleLowerCase();i?(this.$panel[0].style.height||((e=this.$panel[0]).style.height=e.clientHeight+"px"),n={},e=(e=s.filter(function(e){var t=[e.code,e.userLang,e.label,e.enLabel].map(function(e){e=e.toLocaleLowerCase().indexOf(i);return~e?e:99}).sort()[0];return 99!=t&&(n[e.code]=t,!0)})).sort(function(e,t){return n[e.code]-n[t.code]}),this.renderLangCandidate_(e)):this.renderLangCandidate_(s),this.ensureHighlight_()},i.prototype.ensureHighlight_=function(){var e=this.$panel.find(".ty-active");return e=e.length?e:this.$panel.find(".ty-lang-list>.ty-spell-check-panel-item").first().addClass("ty-active")},i.prototype.selectMove_=function(e){var t=this.ensureHighlight_(),e=e?t.prev():t.next();t.removeClass("ty-active"),e.addClass("ty-active")},i.prototype.getSpellCheckLang_=function(){return this.langMode_==l?null:this.langMode_==c?this.langAuto_||"":this.langMode_},i.prototype.updatePanel=function(){var e=this.getSpellCheckLang_();o("#footer-spell-check-label").html((e||"").toUpperCase()||'<span class="ty-icon ty-spellcheck" style="font-size: 1.1em;vertical-align: middle;"></span>'),this.panelBuilt_&&(this.$panel.find(".ty-checked").removeClass("ty-checked"),this.$panel.find("[data-spell-lang='"+this.langMode_+"']").addClass("ty-checked"),this.$panel.find("[data-spell-lang='auto'] .ty-spell-check-panel-item-code").text(this.langAuto_||""))},i.prototype.show=function(){this.loadSpellCheckErr&&this.showLoadModuleError_(),this.editor.lastCursor=this.editor.selection.buildUndo(),this.buildPanel_(),document.body.classList.add("ty-show-spell-check"),document.body.classList.remove("ty-show-word-count"),this.autoUpdateLang(!0),setTimeout(function(){document.querySelector("#ty-spell-check-panel-item-label").focus()},10),this.$panel[0].style.height=""},i.prototype.hide=function(){document.body.classList.remove("ty-show-spell-check"),this.editor.restoreLastCursor(),o("#ty-spell-check-panel-item-label").val(""),this.$panel.find(".ty-active").removeClass("ty-active"),this.$panel[0].style.height="",this.renderLangCandidate_(s)},i.prototype.askDownloadDict_=function(){var t=o("#dict-install-dialog"),e=this.missingLocale_,n=(t.find("#dict-install-dialog-title").text(o.localize.getString("Download dictionary file for %@").replace("%@",e.label)),"https://dict.typora.io/"+e.code+"/LICENSE");t.modal({backdrop:"static"}).focus(),setTimeout(function(){var e=t.find("webview").attr("src",n);File.colorBrightness<.5&&e.length&&e[0].addEventListener("did-stop-loading",()=>{File.colorBrightness<.5&&e[0].insertCSS("body{color:white}")})},100)},i.prototype.onFinishDownloadProgress_=function(e){this.getSpellCheckLang_()==e&&(this.downloadDicts[e]=void 0,this.spellCheckFactory.clearCache(),o("#footer-spell-check").addClass("ty-spell-check-dict-downloaded"),this.setLangMode(e),setTimeout(function(){o("#footer-spell-check").removeClass("ty-spell-check-dict-downloaded")},1e3))},i.prototype.onUpdateDownloadProgress_=function(e,t,n){var i=this.downloadDictsDetail_,r=t||0;t<0?(i[e]=void 0,this.downloadDicts[e]=void 0):(i[e]||(i[e]=[0,0]),void 0!==t&&(i[e][0]=t),void 0!==n&&(i[e][1]=n),r=(i[e][0]+i[e][1])/2,this.downloadDicts[e]=r),this.getSpellCheckLang_()==e&&(t<0?(o("#footer-spell-check").attr("ty-hint",o.localize.getString("Spell Check (%@ unavailable)").replace("%@",this.labelMap[e])).addClass("ty-spell-check-dict-error").removeClass("ty-spell-check-dict-downloading"),document.querySelector("#footer-spell-check-download-process").innerText=""):(o("#footer-spell-check").attr("ty-hint",o.localize.getString("Spell Check (%@ downloading)").replace("%@",this.labelMap[e])).removeClass("ty-spell-check-dict-error").addClass("ty-spell-check-dict-downloading"),document.querySelector("#footer-spell-check-download-process").innerText="#footer-spell-check.ty-spell-check-dict-downloading:before {width: "+100*r+"%;}"))},i.prototype.doDownloadDict_=function(){var e=this.missingLocale_.code;JSBridge.invoke("setting.downloadDict",e),this.onUpdateDownloadProgress_(e,0,0),document.body.classList.remove("ty-show-notification")},i.prototype.bindSpellChecker_=function(){var n=this;try{var i=reqnode("electron").ipcRenderer;i.on("dict-loaded",function(e,t){n.userDictPath=t,n.spellCheckFactory.setUserDictionaryPath(n.userDictPath),n.langMode_&&n.setLangMode(n.langMode_)}),this.downloadDicts={},this.downloadDictsDetail_={},i.on("dict-download-start",function(e,t){n.onUpdateDownloadProgress_(t,0,0)}),i.on("dict-download-process",function(e,t){n.onUpdateDownloadProgress_(t.locale,"dic"==t.type?t.process:void 0,"dic"==t.type?void 0:t.process)}),i.on("dict-download-end",function(e,t){n.onUpdateDownloadProgress_(t,1,1),n.onFinishDownloadProgress_(t)}),i.on("dict-download-err",function(e,t){n.onUpdateDownloadProgress_(t,-1)}),this.spellCheckFactory=reqnode("spellchecker"),this.curSpellchecker=null,JSBridge.invoke("setting.getDownloadingDicts").then(e=>{JSON.parse(e||"[]").forEach(function(e){n.onUpdateDownloadProgress_(e,0,0)})}),JSBridge.invoke("setting.getUserDictionaryPath").then(async e=>{this.userDictPath=e,this.userDictPath,this.userDictPath&&this.spellCheckFactory.setUserDictionaryPath(this.userDictPath);var n=new(reqnode("events").EventEmitter),e=(n.add=function(e,t){t=t.replace(/[’]/g,"'"),i.send("user-dict-add",{lang:e,word:t})},n.remove=function(e,t){t=t.replace(/[’]/g,"'"),i.send("user-dict-remove",{lang:e,word:t})},await JSBridge.invoke("setting.getUserDict")),t=e?JSON.parse(e):{};n.loadUserDict=function(){return t},i.on("user-dict-update",function(e,t){n.emit("update",t)}),this.spellCheckFactory.setUserDictProvider(n),this.resetSpellCheckProvider_()}).catch(e=>{this.loadSpellCheckErr=e.stack||e.message,console.error(e)})}catch(e){this.loadSpellCheckErr=e.stack||e.message,console.error(e)}this.spellCheckFactory||o("#footer-spell-check").off("click").on("click",function(){n.showLoadModuleError_()})},i.prototype.showLoadModuleError_=function(){this.editor.EditHelper.showDialog({title:o.localize.getString("Failed to load spellcheck module"),message:this.loadSpellCheckErr.split(/\n/).map(function(e){return e.replace(/\((.+)(TypeMark|app)/,"(")}).join("\n"),type:"error",backdrop:"static"})},i.prototype.resetSpellCheckProvider_=function(e){var t,c=this;this.langMode_==l?this.curSpellchecker=null:(t=this.getSpellCheckLang_()||this.envLang_||"en-US",/^(zh|ja|hi)/.exec(t)&&(t="en-US"),reqnode("electron").webFrame.setSpellCheckProvider(t,{spellCheck:function(s,l){1e3<s.length?l([]):window.requestIdleCallback(function(){var e=[],t=Math.min(200,s.length),n=c.curSpellchecker;try{if(n)for(var i=0,r=0;r<t&&i<30;r++){var o=s[r],a=n.isMisspelled(o.replace(/[’]/g,"'"));(a=a&&0<o.indexOf(".")?n.isMisspelled(o+"."):a)&&(e.push(s[r]),i++)}else c.scheduleAutoUpdateLang()}catch(e){}l(e)})}}))},i.prototype.autoDetectLang_=function(){var r=this.editor;var e=this.getSpellCheckLang_()||this.envLang_;return this.spellCheckFactory?this.spellCheckFactory.detectLanguageForText?this.spellCheckFactory.detectLanguageForText(function(){for(var e=r.writingArea.querySelectorAll("p, h1, h2, h3, h4, h5, h6"),t=Math.min(e.length,4),n="",i=0;i<t&&((e[i].querySelectorAll("[md-inline='plain']")||[]).forEach(function(e){n+=e.textContent}),!(100<(n+="\n").length));i++);return n}(),{httpHint:e}):Promise.resolve("","detectLanguageForText is not a defined"):Promise.resolve("")},new Date);i.prototype.getSpellChecker=async function(e,t){e=/^(zh|ja|hi|th)/.exec(e||"")?"en-US":e;t=this.spellCheckFactory.getSpellChecker(e,t);return 5e4<new Date-d?t:t||(await new Promise(e=>{setTimeout(e,3e3)}),this.spellCheckFactory.getSpellChecker(e,!0))},i.prototype.autoUpdateLang=function(n){var i;!0!==n&&(this.langAuto_||this.langMode_==l)||((i=this).autoDetectLang_().then(async function(e,t){t?console.sendError(t):(e&&(/^en/.exec(e)?e=/^en/.exec(i.envLang_)?i.envLang_:"en-US":/^zh/.exec(e)?e="zh":i.labelMap[e]||(e=null)),e?(i.langAuto_=e,i.updatePanel(),i.langMode_==c&&(i.curSpellchecker=await i.getSpellChecker(e,n),i.postSetSpellChecker_(e,!0))):n&&i.langAuto_&&(i.langAuto_=null,i.updatePanel()))}),this.detectTimer_=null)},i.prototype.scheduleAutoUpdateLang=function(e){var t;this.langMode_!=c&&!e||(this.detectTimer_&&clearTimeout(this.detectTimer_),(t=this).detectTimer_=setTimeout(function(){t.autoUpdateLang(e)},2e3))},i.prototype.autoSet_=function(){this.loadSettingForFile_(),this.autoUpdateLang()},i.prototype.clear_=function(){this.langAuto_="",this.curSpellchecker=null,this.detectTimer_&&clearTimeout(this.detectTimer_)},i.prototype.reset=function(e){File.isNode&&(this.clear_(),this.loadSettingForFile_(),this.setLangMode(this.langMode_),e)&&this.scheduleAutoUpdateLang(!0)},i.prototype.showDictMissing=function(){var e,t=s.find(function(e){return e.code==(this.langMode_==c?this.langAuto_:this.langMode_)},this);t&&(this.missingLocale_=t,e=document.querySelector("#ty-spell-check-dict-missing-temp").innerText,o("#md-notification").html(e.replace("$1",o.localize.getString("Dictionary file is missing to enable spellcheck support for %@.")).replace("%@",t.label).replace("$2",o.localize.getString("Install Language Support")).replace("$3",o.localize.getString("Disable Spell Check")).replace("$4",o.localize.getString("Dismiss"))),document.body.classList.add("ty-show-notification"),this.useHunSpell()?o("#ty-spell-check-dict-missing-secondary-btn").text(o.localize.getString("Learn More…")):o("#ty-spell-check-dict-missing-secondary-btn").text(o.localize.getString("Install dictionary file only for Typora")))},n.exports=i}),$__System.registerDynamic("3e",[],!0,function(e,t,n){this||self;var p,E="http://www.w3.org/1999/xhtml",T="undefined"==typeof document?void 0:document,i=T?T.body||T.createElement("div"):{},i=i.hasAttributeNS?function(e,t,n){return e.hasAttributeNS(t,n)}:i.hasAttribute?function(e,t,n){return e.hasAttribute(n)}:function(e,t,n){return null!=e.getAttributeNode(t,n)},l=i;function _(e,t){var e=e.nodeName,n=t.nodeName;return e===n||!!(t.actualize&&e.charCodeAt(0)<91&&90<n.charCodeAt(0))&&e===n.toUpperCase()}function r(e,t,n){e[n]!==t[n]&&(e[n]=t[n],e[n]?e.setAttribute(n,""):e.removeAttribute(n,""))}var A={OPTION:function(e,t){r(e,t,"selected")},INPUT:function(e,t){r(e,t,"checked"),r(e,t,"disabled"),e.value!==t.value&&(e.value=t.value),l(t,null,"value")||e.removeAttribute("value")},TEXTAREA:function(e,t){var n,t=t.value,i=(e.value!==t&&(e.value=t),e.firstChild);i&&(n=i.nodeValue)!=t&&(t||n!=e.placeholder)&&(i.nodeValue=t)},SELECT:function(e,t){if(!l(t,null,"multiple")){for(var n=0,i=t.firstChild;i;){var r=i.nodeName;if(r&&"OPTION"===r.toUpperCase()){if(l(i,null,"selected")){0;break}n++}i=i.nextSibling}e.selectedIndex=n}}},M=1,L=3,N=8;function D(){}function P(e){return e.id}function o(f,m,e){e=e||{},"string"==typeof m&&("#document"===f.nodeName||"HTML"===f.nodeName?(t=m,(m=T.createElement("html")).innerHTML=t):(t=m,!p&&T.createRange&&(p=T.createRange()).selectNode(T.body),p&&p.createContextualFragment?r=p.createContextualFragment(t):(r=T.createElement("body")).innerHTML=t,m=r.childNodes[0]));var t,n,g=e.getNodeKey||P,y=e.onBeforeNodeAdded||D,v=e.onNodeAdded||D,b=e.onBeforeElUpdated||D,w=e.onElUpdated||D,i=e.onBeforeNodeDiscarded||D,o=e.onNodeDiscarded||D,x=e.onBeforeElChildrenUpdated||D,r=!0===e.childrenOnly,C={};function F(e){n?n.push(e):n=[e]}function S(e,t,n){!1!==i(e)&&(t&&t.removeChild(e),o(e),function e(t,n){if(t.nodeType===M)for(var i=t.firstChild;i;){var r=void 0;n&&(r=g(i))?F(r):(o(i),i.firstChild&&e(i,n)),i=i.nextSibling}}(e,n))}function k(e,t,n){var i=g(t);if(i&&delete C[i],!m.isSameNode||!m.isSameNode(f)){if(!n){if(!1===b(e,t))return;if(B(e,t),w(e),!1===x(e,t))return}if("TEXTAREA"!==e.nodeName){var r,o,a,s,l,c=t.firstChild,d=e.firstChild;e:for(;c;){for(a=c.nextSibling,r=g(c);d;){if(o=d.nextSibling,c.isSameNode&&c.isSameNode(d)){c=a,d=o;continue e}var u=g(d),h=d.nodeType,p=void 0;if(h===c.nodeType&&(h===M?(r?r!==u&&(!(s=C[r])||d.nextSibling===s?p=!1:(e.insertBefore(s,d),o=d.nextSibling,u?F(u):S(d,e,!0),d=s)):u&&(p=!1),(p=!1!==p&&_(d,c))&&("svg"==d.tagName&&"svg"==c.tagName?p=d.innerHTML==c.innerHTML:k(d,c))):h!==L&&h!=N||(p=!0,d.nodeValue!==c.nodeValue&&(d.nodeValue=c.nodeValue))),p){c=a,d=o;continue e}u?F(u):S(d,e,!0),d=o}r&&(s=C[r])&&_(s,c)?(e.appendChild(s),k(s,c)):!1!==(l=y(c))&&((c=l?l:c).actualize&&(c=c.actualize(e.ownerDocument||T)),e.appendChild(c),function e(t){v(t);for(var n=t.firstChild;n;){var i=n.nextSibling,r=g(n);(r=r&&C[r])&&_(n,r)&&(n.parentNode.replaceChild(r,n),k(r,n)),e(n),n=i}}(c)),c=a,d=o}for(;d;)o=d.nextSibling,(u=g(d))?F(u):S(d,e,!0),d=o}i=A[e.nodeName];i&&i(e,t)}}!function e(t){if(t.nodeType===M)for(var n=t.firstChild;n;){var i=g(n);i&&(C[i]=n),e(n),n=n.nextSibling}}(f);var a,s,l=(e=f).nodeType,c=m.nodeType;if(!r)if(l===M)c===M?_(f,m)||(o(f),e=function(e,t){for(var n=e.firstChild;n;){var i=n.nextSibling;t.appendChild(n),n=i}return t}(f,(a=m.nodeName,(s=m.namespaceURI)&&s!==E?T.createElementNS(s,a):T.createElement(a)))):e=m;else if(l===L||l===N){if(c===l)return e.nodeValue!==m.nodeValue&&(e.nodeValue=m.nodeValue),e;e=m}if(e===m)o(f);else if(k(e,m,r),n)for(var d=0,u=n.length;d<u;d++){var h=C[n[d]];h&&S(h,h.parentNode,!1)}return!r&&e!==f&&f.parentNode&&(e.actualize&&(e=e.actualize(f.ownerDocument||T)),f.parentNode.replaceChild(e,f)),e}var B;B=function(e,t){for(var n,i,r,o,a=t.attributes,s=a.length-1;0<=s;--s)i=(n=a[s]).name,r=n.namespaceURI,o=n.value,r?(i=n.localName||i,e.getAttributeNS(r,i)!==o&&e.setAttributeNS(r,i,o)):e.getAttribute(i)!==o&&e.setAttribute(i,o);for(s=(a=e.attributes).length-1;0<=s;--s)!1!==(n=a[s]).specified&&(i=n.name,(r=n.namespaceURI)?(i=n.localName||i,l(t,r,i)||e.removeAttributeNS(r,i)):l(t,null,i)||e.removeAttribute(i))};n.exports=o}),$__System.registerDynamic("3f",["11","13","32","34","28","e","3e"],!0,function(e,t,n){"use strict";this||self;var g=e("11"),i=e("13"),y=(i.Node,i.TYPE,e("32")),v=e("34"),g=e("11"),b=e("28"),w=e("e"),r=e("3e"),p=!1,o="_recent";function h(e,t){if(e.length&&t.length&&e[0].parentElement){let n=e.attr("data-has-sub")!=t.attr("data-has-sub");n&&e.attr("data-has-sub",t.attr("data-has-sub")),r(e[0],t[0],{childrenOnly:!n,getNodeKey:function(e){return e.dataset&&e.dataset.path},onBeforeElUpdated:function(e,t){e.classList.contains("file-node-collapsed")&&!n&&(t.classList.add("file-node-collapsed"),t.classList.remove("file-node-expanded"))}})}}var c=y.statWrapper;function a(t,e){return File.isMac?new Promise(function(e){f(t,e)}):u(t,!1,e)}function f(i,n){if(!i.path)return n(null);bridge.callHandler("library.listDocsUnder",i.path,function(e){if(!e||!e.name)return n(null);var t;i.fetched=!0,i.subdir=e.subdir,i.lastModified=e.lastModified,i.createDate=e.createDate,i.alias=e.alias,((t=i.subdir.map(function(e,n){return new Promise(function(t){e.isOpen?(e.fetched=!0,t()):document.querySelector(".file-node-expanded.file-tree-node[data-path='"+g.escapeSelector(e.path)+"']")?f(e,function(e){i.subdir[n]=e,i.subdir[n]&&(i.subdir[n].isOpen=!0),t()}):t()})}))&&t.length?Promise.all(t):Promise.resolve()).then(function(){i.content=e.content,i.isDirectory=e.isDirectory,i.isFile=e.isFile,i.name=e.name,n&&n(i)})})}function u(r,t,o){var a=reqnode("fs-plus"),s=reqnode("path"),l=File.isWin?"\\":"/";return new Promise(function(n,e){var i=r.path;if(r.name=s.basename(i)||i,r.subdir=[],r.content=[],r.fetched=!t,"."==r.name[0]&&!r.isOpen)return n();c(i,function(e){if(!e||e.shouldIgnore)return n();if(r.isDirectory=e.isDir,r.isFile=e.isFile,File.option.supportTextBundle&&r.isDirectory&&/\.textbundle$/.exec(r.name)&&(r.type=File.FileType.TextBundle,r.isDirectory=!1,r.isFile=!0),File.option.supportTextPack&&!r.isDirectory&&/\.textpack$/.exec(r.name)&&(r.type=File.FileType.TextPack,r.isDirectory=!1,r.isFile=!0),r.lastModified=e.mtime,r.createDate=e.birthtime,e.isFile)return r.fetched=!0,y.isSupportedFile(r.name)?n(r):n();if(e.isDir){if(e=i,File.bundle.filePath&&e&&0==File.bundle.filePath.indexOf(e.replace(/[\/\\]$/,"")+l))r.isOpen=!0;else if(t)return n(r);a.list(i,void 0,function(e,t){if(e)return n();r.isOpen||document.querySelector(".file-node-expanded.file-tree-node[data-path='"+g.escapeSelector(i)+"']")&&(r.isOpen=!0),Promise.all(t.map(function(e){return u({path:e},!r.isOpen,o)})).then(function(e){r.fetched=!0,"oversize"!=p&&File.editor.library.addWatchByUnix(r.path),0<r.subdir.length+r.content.length||e.forEach(function(e){e&&(e.isDirectory?r.subdir:r.content).push(e)}),n(r)})})}})})}n.exports=class{constructor(e){this.parent=e,this.editor=e.editor,this.$template=w(document.querySelector("#file-library-node-template").textContent),this.root,this.noGroup=File.option.treeNoGroup||!1,this.sortType=File.option.treeSortType}getRoot(){return this.parent.root}setRoot(e){return this.parent.root=e}renderNode(e,t){var n,i,r;return e?(n=this.$template.clone(),i=this.parent,this.noGroup||t||(e.subdir&&e.subdir.sort(i.compareItem.bind(i)),e.content&&e.content.sort(i.compareItem.bind(i))),e==this.getRoot()?(e.isOpen=!0,n.find(".file-node-open-state").remove()):e.isDirectory&&e.subdir&&(e.subdir.length||e.content.length)&&n.attr("data-has-sub","true").addClass(e.isOpen?"file-node-expanded":"file-node-collapsed"),((t=e.name.lastIndexOf("."))<0||e.isDirectory)&&(t=e.name.length),n.find(".file-node-title-name-part").text(e.name.substr(0,t)),n.find(".file-node-title-ext-part").text(e.name.substr(t)),n.attr("data-path",e.path).attr("data-is-directory",e.isDirectory),n.find(".file-node-icon").addClass(function(e){return e==this.getRoot()?e.path==o?"fa fa-history":"fa fa-folder":e.isDirectory?"fa fa-folder":e.type==File.FileType.TextBundle||e.type==File.FileType.TextPack?"ty-icon ty-textbundle":"fa fa-file-text-o"}.call(this,e)),n.find(".file-node-title").attr("title",g.abbreviatingWithTilde(e.path)),e.isDirectory||n.addClass("file-library-file-node"),e==this.getRoot()?n.addClass("file-node-root"):e.isDirectory||e.path!=y.getCurrentFilePath()||n.addClass("active"),e.isDirectory&&((r=n.find(".file-node-children")).html(""),e.isOpen)&&e.fetched&&(this.noGroup?((t=(e.subdir||[]).concat(e.content||[])).sort(i.compareItem.bind(i)),t.forEach(function(e){r.append(this.renderNode(e))},this)):(e.subdir.forEach(function(e){r.append(this.renderNode(e))},this),e.content.forEach(function(e){r.append(this.renderNode(e))},this))),n):w()}renderIfNeed(){return!p&&(this.render(),File.isNode&&this.parent.addWatch(File.getMountFolder()),!0)}render(t){p=!0;var n=this,i=File.getMountFolder();(n.getRoot()?Promise.resolve(n.getRoot()):new Promise(function(t){n.parent.calcMountFolder().then(function(e){n.parent.root={path:e,isOpen:!0},e?a(n.parent.root,n).then(function(e){n.parent.root=e,t(e),n.parent.silent=!1}):t(null)})})).then(function(e){e&&e.path?!t&&1!=p||function(){p="complete",w("#file-library-tree").html("").append(this.renderNode(this.getRoot())).attr("data-state",""),this.parent.markCurrentFile()}.call(n):(w("#file-library-tree").html(""),n.parent.onLoadFolderFailed(!i))}),w("#file-library-tree").attr("data-state","rendering").html("")}findElemFromPath(e){return e=(this.findNodeFromPath(e)||{}).path,w(".file-tree-node[data-path='"+g.escapeSelector(e)+"']")}focusToFile(o,e,a,s){var t,l,c,d,u,h;this.getRoot()&&o&&!0!==p&&(t=File.getMountFolder(),l=File.isWin?"\\":"/",c=this,d=window.innerHeight,u=File.isMac?w(".sidebar-content"):w("#file-library"),h=u.scrollTop(),0===o.indexOf(t))&&!function e(t,n){var i,r;0!=n.length&&(1==n.length?(i=a?c.findElemFromPath(o):c.markOpenedFile(o),(r=i).length&&((r=r[0].offsetTop)<h?(h=r,u.scrollTop(h)):d-200<r-h&&(h=r-d+300,u.scrollTop(h))),0==u.scrollTop()&&setTimeout(function(){0!=u.scrollTop()||h||u.scrollTop(h)},200),s&&s(i)):(t=(t+l+n.shift()).replace(/[\\]+/,"\\"),c.expandNode(c.findElemFromPath(t),t,function(){e(t,n)})))}(t,o.substr(t.length).replace(/^[\\/]+/g,"").split(/[\\/]+/)||[])}highlight(e){var t=this;this.focusToFile(e,!1,!0,function(e){e.addClass("blink-area"),setTimeout(function(){e.removeClass("blink-area")},2e3),e.length&&(t.parent.nextChangeHighlight=null)})}markOpenedFile(e){return this.parent.markOpenedFile(e).filter(".file-tree-node")}needRepaint(){p=!1}findNodeFromPath(e,a){if(e&&this.getRoot())return a=a||[],function e(t,n){if(t){if(g.isSamePath(t.path,n))return t;a.push(t);for(var i=0;i<(t.subdir||[]).length;i++){var r=t.subdir[i];if(r){if(g.isSamePath(r.path,n))return r.folderPath=t.path,r;if(g.isAncestorPathOf(r.path,n))return e(r,n)}}var o=t.content.find(function(e){return g.isSamePath(e.path,n)});return o&&(o.folderPath=t.path),o}return null}(this.getRoot(),e)}expand(e,t,n){t=t?w(t):this.findElemFromPath(e);return 1!=t[0].dataset.hasSub&&"true"!=t[0].dataset.hasSub||!t.hasClass("file-node-collapsed")?(n&&n(),!1):(this.expandNode(t,e,n),!0)}expandNode(t,e,n){var i;!0!==p&&(e=this.findNodeFromPath(e,[]),i=this,e)&&(e.isOpen=!0,t.children(".file-node-children").children().length?t.removeClass("file-node-collapsed").addClass("file-node-expanded"):(!e.fetched||0<e.subdir.length&&!e.subdir[0].fetched)&&t.length&&t[0].parentElement?a(e,i).then(function(e){e&&t.length&&t[0].parentElement&&(t.replaceWith(i.renderNode(e)),w(".file-library-node.active").length||i.markOpenedFile(y.getCurrentFilePath()),n)&&n()}):t.replaceWith(this.renderNode(e)),w(".file-library-node.active").length||this.markOpenedFile(y.getCurrentFilePath()),n)&&n()}setSortType(e){this.sortType=e,JSBridge.putSetting("treeSortType",e),"complete"===p&&this.getRoot()&&this.getRoot().fetched&&this.render(!0)}setGroupByFolder(e){e?w("#ty-group-by-folder-btn").removeClass("active"):w("#ty-group-by-folder-btn").addClass("active"),"complete"===p&&this.noGroup!=e&&(this.noGroup=e,this.render(!0),JSBridge.putSetting("treeNoGroup",e))}onChangeForMac(e){var t,i,r,n,o,a,s;function l(e){var t=s.findElemFromPath(e.path),n=null;t.hasClass("file-node-root")&&(n=w(".sidebar-content").scrollTop()),h(t,s.renderNode(e)),n&&w(".sidebar-content").scrollTop(n),c(e.path)}function c(e){var t=s.parent.nextChangeHighlight;t&&0==t.indexOf(e)&&s.highlight(t)}function d(e,t){e&&(s.findElemFromPath(e.path).remove(),s.parent.unwatchByUnix(e.path),(e.isDirectory?t.subdir:t.content).remove(e),t.subdir.length+t.content.length==0)&&(e.isOpen=!1,l.call(this,t))}function u(e,t){var n=g.pathByDeleteLastComponent(e),n=s.findNodeFromPath(n);s.findNodeFromPath(e)||(n&&!function(t,e,n){if(e.fetched&&!r.has(e)){if(File.option.supportTextBundle&&/\.textbundle$/.exec(t)&&(n=!1),e.content.length+e.subdir.length==0&&r.add(e),n){if(-1<e.subdir.findIndex(function(e){return e.path==t}))return;r.add(e)}else{if(-1<e.content.findIndex(function(e){return e.path==t}))return;n={path:t,isDirectory:!1,name:t.split("/").last(),lastModified:new Date,createDate:new Date},e.content.push(n)}i.add(e)}}.call(s,e,n,t),c(e))}p&&(t=[],i=new Set,r=new Set,o=(s=this).parent.dateAffectsSort(),a=w(".file-node-on-edit").attr("data-path"),e.forEach(function(e){n=this.findNodeFromPath(e.path,t),(e.oldPath||e.path)!=a&&this.getRoot()&&("removed"==e.type?e.path==this.getRoot().path?this.parent.root=null:n&&t.length&&d.call(this,n,t.last()):"rename"==e.type?e.oldPath==this.getRoot().path?this.parent.root=null:(t=[],n=this.findNodeFromPath(e.oldPath,t),d.call(this,n,t.last()),u(e.newPath,e.isDir)):"created"==e.type&&n!=this.getRoot()&&(n?o?(n.lastModified=new Date,this.onRemoveFile(n),this.onAddFile(n)):i.add(t.last()):(e.isDir||e.path&&!/~\.[^.]+$/.exec(e.path))&&u(e.path,e.isDir)))},this),this.getRoot()?(s=this,r.forEach(function(e){f(e,function(e){e&&l.call(s,e)}),i.delete(e)},this),i.forEach(function(e){l.call(this,e)},this)):this.parent.onRootChanged())}isPathTooDeepToDisplay(e,t){return this.findNodeFromPath(e,t=t||[]),!t.length||!!e.substr(t.last().path.length).replace(/^[\\/]+/,"").match(/[\\/]/)}onChangeForWin(t,e,n){var i,r,o,a,s,l,c;function d(e,t){r.onRemoveFile(e,(t||[]).last())}!p||this.parent.isSuppressOnChange()||this.parent.shouldIgnore(t)||(c=w(".file-node-on-edit").attr("data-path"),t==c)||(c=[],i=File.isWin?"\\":"/",(r=this).isPathTooDeepToDisplay(t,c))||(o=t,s=function(){var e;r.parent.useTreeStyle&&(e=r.parent.nextChangeHighlight)&&0==e.indexOf(t)&&r.highlight(e)},a=(a=c)||[],e.find(function(e){return e==o||0==o.indexOf(e+i)}))||(e.push(o),c=reqnode("path").dirname(o),(l=r.findNodeFromPath(c))&&l.fetched&&(c=!l.isOpen,"unlink"==n?d(o,a):u({path:o},c,r).then(function(e){var t,n,i;e?(t=o,e=e,n=l,(i=r.findNodeFromPath(t))&&i.fetched?i.path!=t&&(r.findElemFromPath(i.path).replaceWith(r.renderNode(e)),i.path=e.path,i.name=e.name):r.onAddFile(e,n),s&&s()):d(o,a)})))}onFileUpdated(e){e=this.findNodeFromPath(e);e&&(e.lastModified=new Date,this.parent.dateAffectsSort())&&(this.onRemoveFile(e),this.onAddFile(e))}onRemoveFile(e,t){var n,i;"string"==typeof e?n=this.findNodeFromPath(i=e):e&&e.path&&(i=(n=e).path),n&&(e=t||this.findNodeFromPath(n.folderPath),this.findElemFromPath(i).remove(),e)&&(e.subdir.removeIf(function(e){return g.isSamePath(e.path,n.path)}),e.content.removeIf(function(e){return g.isSamePath(e.path,n.path)}),e.subdir.length+e.content.length==0)&&this.findElemFromPath(e.path).replaceWith(this.renderNode(e))}onAddFile(e,t){var t=t||this.findNodeFromPath(e.folderPath),n=t.content.length+t.subdir.length==0,i=e.isDirectory?t.subdir:t.content,i=(i.splice(0,0,e),i.sort(this.parent.compareItem.bind(this.parent)),i.indexOf(e));if(e.isDirectory||(i+=t.subdir.length),!n)return n=this.findElemFromPath(t.path).children(".file-node-children"),t.isOpen||n.children().length?(e=this.renderNode(e)[0],n[0]&&n[0].insertChildAtIndex(e,i),e):void 0;this.findElemFromPath(t.path).replaceWith(this.renderNode(t))}newFile(e){this.newFileCommand(this.findElemFromPath(e),!1)}newFolderCommand(e){this.newFileCommand(e,!0)}newFileCommand(e,s){var e=this.editor.getJQueryElem(e).closest(".file-library-node"),l=e.attr("data-path"),t="true"==e.attr("data-is-directory"),c=this;async function d(e,t,n,i){if(t.parent().length||(t=c.findElemFromPath(e.path)),i){if(e.content.push(n),c.parent.isDiscardableUntitled())return await new Promise(e=>{c.parent.openFile(n.path,e)}),h(t,c.renderNode(e,!0)),c.focusToFile(n.path),void setTimeout(function(){c.parent.markCurrentFile(),c.parent.resumeOnChange(),c.renameFileCommand(c.findElemFromPath(n.path)[0],!0)},10)}else e.subdir.push(n);h(t,c.renderNode(e,!0)),c.renameFileCommand(c.findElemFromPath(n.path)[0],!0)}function n(){var t=this.findNodeFromPath(l);if(t){e=t,n=0;var n,e=s?(e.subdir.forEach(function(e){e&&(e=/^untitled folder( (\d+))?$/i.exec(e.name))&&(n=Math.max(n,+(e[2]||0)+1))}),"Untitled Folder"+(n?" "+n:"")):(e.content.forEach(function(e){e=/^untitled( (\d+))?\./i.exec(e.name);e&&(n=Math.max(n,+(e[2]||0)+1))}),"Untitled"+(n?" "+n:"")+"."+(File.option.defaultExtension||"md")),i=File.isNode&&reqnode("fs");try{var r=this.findElemFromPath(l),o=l+(File.isWin?"\\":"/")+e,a={fetched:!0,subdir:[],content:[],isDirectory:!!s,folderPath:l,isFile:!s,name:e,path:o};c.parent.pauseOnChange(!0),s?File.isNode?i.mkdir(o,function(e){e?c.parent.resumeOnChange():d(t,r,a,!1)}):bridge.callHandler("library.newFolder",o,function(e){e?d(t,r,a,!1):c.parent.resumeOnChange()}):File.isNode?i.writeFile(o,"",function(e){e?(b.showErrorDialog(w.localize.getString("Operation Failed"),e),console.error(e),c.parent.resumeOnChange()):d(t,r,a,!0)}):bridge.callHandler("library.newFile",o,function(e){e?d(t,r,a,!0):c.parent.resumeOnChange()})}catch(e){c.parent.resumeOnChange()}}}l||(e=w("#file-library-tree .file-node-root"),l=e.attr("data-path"),t=!0),l&&(t||(l=g.pathByDeleteLastComponent(l)),t?(c=this).expandNode(e,l,function(){n.call(c)}):n.call(this))}renameFileCommand(e,c,t){w(".file-node-on-edit").removeClass("file-node-on-edit");var d=this.editor.getJQueryElem(e).closest(".file-library-node").addClass("file-node-on-edit"),u=d.attr("data-path"),n=d.children(".file-node-content").children(".file-tree-rename-div"),h=n.prev().text().trim(),i=n.children("input").val(h),p=this;function f(){i.closest(".file-node-on-edit").removeClass("file-node-on-edit"),n.closest(".file-node-content").attr("draggable","true")}function m(e,t,n){var i=e.path;p.onRemoveFile(e),function t(e,n){e.path=e.path.replace(i,n),(e.content||[]).forEach(e=>{e.path=e.path.replace(i,n)}),(e.subdir||[]).forEach(e=>{t(e,n)})}(e,t),e.name=n,p.onAddFile(e)}n.length&&(e=w("#sidebar-content").width()-48-n[0].offsetLeft,e=Math.min(e,200),e=Math.max(e,140),i.width(e),n.closest(".file-node-content").attr("draggable","false"),e="true"===d.attr("data-is-directory"),this.parent.bindRename(i,function(e){var t,n,i,r,o,a,s;function l(e){b.showErrorDialog(w.localize.getString("Rename Failed"),w.localize.getString('Failed to rename from "{0}" to "{1}"').format(h,s)+"\n"+e),a&&v.watchFileChange(File.bundle.filePath),JSBridge.invoke("filesOp.clearUndo")}File.isMac?(n=(t=e).val().replace(/[\/\\]/g,"").trim(),i=g.pathByDeleteLastComponent(u)+"/"+n,p.parent.pauseOnChange(!0),r=u==y.getCurrentFilePath(),u!=i?bridge.callHandler("library.renameFile",{old:u,new:i},function(e){e?(e=p.findNodeFromPath(u))&&(m(e,i,n),r&&setTimeout(function(){p.parent.markOpenedFile(i,!0),p.focusToFile(i)},200),p.parent.scheduleChangeHighlight(i)):t.val(h)}):t.val(h),d.removeClass("file-node-on-edit"),p.editor.restoreLastCursor()):(s=(e=e).val().trim(),(s=File.isWin?s.replace(/[\\\/:*?"<>\|\000-\031]/g,"").replace(/\.+$/,"").trim():s.replace(/[\/\\\000-\031]/g,""))?(p.parent.pauseOnChange(),o=(o=g.pathByDeleteLastComponent(u)+(File.isWin?"\\":"/")+s).trim(),e.closest(".file-node-on-edit").removeClass("file-node-on-edit"),a=File.bundle.filePath&&g.isAncestorPathOf(u,File.bundle.filePath),e=reqnode("fs-extra"),!g.isSamePath(u,o)&&e.existsSync(o)?l(w.localize.getString("File with same name already exists at target path.")):(JSBridge.invoke("app.sendEvent","willRename",{oldPath:u}),p.parent.execRenameFileByNode(u,o).then(function([e]){d.removeClass("file-node-on-edit"),p.editor.restoreLastCursor(),e&&(o=u),JSBridge.invoke("app.sendEvent","didRename",{oldPath:u,newPath:o});var t=reqnode("path"),n=(p.parent.resumeOnChange(),t.basename(o)),i=p.findNodeFromPath(u);i&&(m(i,o,n),e?l(e):(c||(JSBridge.invoke("filesOp.registerUndo",o,u,w.localize.getString("Rename %@","Panel").replace("%@",t.basename(u))),p.parent.scheduleChangeHighlight(o)),File.bundle.filePath))}))):f())},f,e,!1,t,g.pathByDeleteLastComponent(u)),i.focus())}isShown(){return"file-tree"==this.parent.getActiveTab()}bindEvents(){var r=this;w("#file-library-tree").on("click",".file-node-content",function(e){if(1===e.which){e.preventDefault(),e.stopPropagation(),document.activeElement.blur();var t=w(this).parent(),n=t.attr("data-path"),i=t.attr("data-is-directory");if(t.hasClass("file-node-on-edit"))return!1;(File.isMacOrMacNode?e.metaKey:e.ctrlKey)?r.parent.openWithCtrl(n,"true"==i):"false"==i?r.parent.openFile(n):"true"==t.attr("data-has-sub")&&(t.hasClass("file-node-expanded")?(e=t,(r.findNodeFromPath(n)||{}).isOpen=!1,e.addClass("file-node-collapsed").removeClass("file-node-expanded")):r.expandNode(t,n))}})}}}),$__System.registerDynamic("40",["11","13","32","34","26","28","e"],!0,function(e,t,n){"use strict";this||self;function h(e,t){var n=t.lastIndexOf(".");n<0&&(n=t.length),e.find(".file-list-item-file-name-part").text(t.substr(0,n)),e.find(".file-list-item-file-ext-part").text(t.substr(n))}function p(e,t){var n,i=e.split(/\r*\n+/),r=i.length;if("---"==i[0])for(var o,a=[],s=1;s<r;s++){if("---"==i[s])return a.length<3&&a.push(c(i.slice(s+1).join("\n")||e)),a.join("\n");(n=(n=/^\s*(title)\s*:(.+)$/.exec(i[s]))||/^\s*(subtitle)\s*:(.+)$/.exec(i[s]))?(o=d(i,s,n[2],r))&&a.push(o.trim()):(n=/^\s*(overview|summary|description|excerpt)\s*:(.+)$/.exec(i[s]))&&(o=d(i,s,n[2],r))&&a.push(o.trim())}return c(e)}var w,i,f,r,m=e("11"),o=e("13"),l=o.Node,x=(o.TYPE,e("32")),m=(e("34"),e("11")),u=(e("26").map,e("28")),g=e("e"),y=g("#file-library-list-children"),C=g("#file-library-list"),c=function(e){return(File.option.strictMarkdown?e.replace(/^\s*(([\n>]+)|([-=*`\s]{3,}))/gm,"").replace(/^\s*#+\s+/gm,""):e.replace(/^\s*(([\n#>]+)|([-=*`\s]{3,}))/gm,"")).replace(/\s*[*_`$=]+\s*/gm," ").replace(/\[([^\]]+)\]\([^)]*\)/gm,"$1")},d=function(e,t,n,i){for(var r=t+1;r<i;r++){if(0<=e[r].indexOf(":"))return n;n+="\n"+e[r]}return n},F=x.statWrapper;function v(t,e,n){var i=File.isWin?"\\":"/";if(e.find(function(e){return e==t||0==t.indexOf(e+i)}))return 1;n||e.push(t)}var S=400;n.exports=class{constructor(e){this.parent=e,this.editor=e.editor,this.$template=g(document.querySelector("#file-list-item-template").textContent),this.noGroup=File.option.listNoGroup||!1,this.sortType=File.option.listSortType,this.setGroupByFolder(this.noGroup),this.registerBridge(),this.needRepaint(),File.isNode&&(S=Number.parseInt(File.option.maxFetchCountOnFileList)||200,Number.isNaN(S))&&(S=200)}registerBridge(){var i;File.isMac&&(i=this,bridge.registerHandler("fileList.renderAll",function(e,t){var n;"oversize"!=w&&(n=document.createDocumentFragment(),e[0].forEach(function(e){i.appendItemToView(e,!1,n)}),y.html(""),y.append(n),i.endRender(e[1],e[2],e[2]),t)&&t(null)}),bridge.registerHandler("fileList.appendItem",function(e,t){i.appendItemToView(e[0],e[1],void 0,{forceMark:e[2]}),t&&t(null)}))}isShown(){return this.parent.isFileTabShown()&&!this.parent.useTreeStyle}isRendering(){return w}renderIfNeed(){return!w&&(this.render(),File.isNode&&this.parent.addWatch(File.getMountFolder()),!0)}appendTreeByNode(e,t,l,c){var i=reqnode("fs-plus"),d=reqnode("path"),u=this,r=File.option.useFsQueue,a=(l=l||0,!!c),n=(c=c||C,[]),o=0,s=50,h=20,p=function(){n=[]},f=function(){if("oversize"==w)p();else for(var e=0;e<h&&n.length;){e++;var t=n.shift();(t[1]?m:g)(t[0],t[2])}},m=function(e,n){o++,i.readdir(e,function(e,t){o--,r&&o<s&&f(),n(e,t)})},g=function(e,t){o++,F(e,function(e){o--,r&&o<s&&f(),t(e)})},y=function(e,t){r&&s<=o?n.push([e,!0,t]):m(e,t)},v=function(e,t){r&&s<=o?n.push([e,!1,t]):g(e,t)},b=function(r,o,a,s){if(!r)return s();y(r,function(e,t){if(e)return s(void 0,e);function i(){--n<=0&&s()}var n=t.length;n||s();t.forEach(function(t){var n=d.join(r,t);v(n,function(e){if(w){if(!e||e.shouldIgnore)return i();50==l&&!0===w&&"rendering"!=c.attr("data-state")&&c.attr("data-state","rendering"),S<l?(p(),u.endRender(!0)):e.isFile?o(e,t,r,n,i)&&l++:e.isDir&&a(e,t,r,n)?b(n,o,a,i):i()}})})})};b(e,function(e,t,n,i,r){var o;if(!e.shouldIgnore)return o={folderPath:n,folderName:x.getFileNameFromPath(n),name:t,path:i,lastModified:e.mtime,createDate:e.birthtime},u.fetchSummaryByNode(i,e,function(e){o.summary=e,u.appendItemToView(o,!1,a?c[0]:void 0),r()}),!0;r()},function(e,t,n,i){return!e.shouldIgnore&&(u.parent.addWatchByUnix(i),!0)},t=t||function(){})}fetchAllDocsByNode(){var t=this;this.parent.calcMountFolder(!0).then(function(e){t.appendTreeByNode(e||"",t.endRender.bind(t))})}fetchSummaryByNode(e,t,n){var i,r=reqnode("fs-plus");t.isBundle?e=t.textFile:/\.textpack$/.exec(e)&&n(""),r.createReadStream(e,{start:0,end:600}).on("data",function(e){var t;i="string"==typeof e?e:(t=x.detectEncodeByNode(e),x.getContentFromBuffer(e,t.replace("-bom",""),!0))}).on("end",function(){n(i=void 0===i?"":i)})}render(e){var t;e&&this.needRepaint(),w||(w=!0,i=new Date,f=!1,t=this,setTimeout(function(){!0===w&&"rendering"!=C.attr("data-state")&&C.attr("data-state","rendering")},500),y.html("").removeClass("show-folder-name"),File.isMac?this.parent.calcMountFolder(!0).then(function(e){bridge.callHandler("library.fetchAllDocs",e||"")}):File.isNode&&this.fetchAllDocsByNode(),setTimeout(function(){!0===w&&8e3<new Date-i&&(console.warn("render file list timeout"),t.endRender(!0))},1e4))}endRender(e,t,n){if("oversize"!=w||!e){if(w=e?"oversize":"complete",g("#file-library-list").attr("data-state",w),r&&clearTimeout(r),r=setTimeout(function(){"oversize"==w&&g("#file-library-list").attr("data-state","oversize-end")},2e3),!e){if(t&&File.getMountFolder())return void this.parent.onLoadFolderFailed();this.parent.markCurrentFile(!1)}this.parent.silent=!1}}setSortType(e){var n;this.sortType=e,JSBridge.putSetting("listSortType",e),"complete"===w&&(y.html(""),n=document.createDocumentFragment(),this.noGroup?(this.files.sort(this.parent.compareItem.bind(this.parent)),this.files.forEach(function(e){this.appendItemToView(e,!1,n)},this)):this.dirArr.forEach(function(e){var t=e.content;e.content=[],t.forEach(function(e){this.appendItemToView(e,!1,n)},this)},this),y.append(n))}setGroupByFolder(e){var t;e?g("#ty-group-by-folder-btn").removeClass("active"):g("#ty-group-by-folder-btn").addClass("active"),"complete"===w&&this.noGroup!=e&&(this.noGroup=e,JSBridge.putSetting("listNoGroup",e),y.html(""),t=document.createDocumentFragment(),e?(this.files=[],this.dirArr.forEach(function(e){this.files=this.files.concat(e.content)},this),this.dirArr=[],this.dirMap={},this.files.sort(this.parent.compareItem.bind(this.parent)),this.files.forEach(function(e){this.appendItemToView(e,!1,t)},this)):(this.dirArr=[],this.dirMap={},this.files.forEach(function(e){this.appendItemToView(e,!1,t)},this),this.files=[]),y.append(t),"oversize"==w?this.endRender(!0):"complete"==w&&this.endRender(!1))}getItem(t){var e;if(!this.noGroup)return this.dirMap[t]?{path:t,isDir:!0}:(e=m.pathByDeleteLastComponent(t),this.dirMap[e]?this.dirMap[e].content.find(function(e){return e.path==t}):void 0);for(var n=this.files.length,i=0;i<n;i++){if(this.files[i].path==t)return this.files[i];if(this.files[i].folderPath==t)return{path:t,isDir:!0}}}getIndexOnView(e,t){for(var n=0;n<e.children.length;n++){if(t<=n)return t;e.children[n].classList.contains("ty-to-remove")&&t++}return t}computeIndex(e){return(this.noGroup?function(e){var t=this.files.indexOf(e);if(!(-1<t)){for(var t=0,n=0;n<this.files.length&&!(0<this.parent.compareItem(this.files[n],e));n++)t++;this.files.splice(t,0,e)}return t}:function(e){var t=e.folderPath,n=this.dirMap[t],i=0,r=0;n||(this.dirArr.push(n={path:t,content:[]}),this.dirMap[t]=n);for(var o=0;o<this.dirArr.length-1;o++){var a=this.dirArr[o];if(a.path==t)break;i+=a.content.length}for(o=0;o<n.content.length&&!(0<this.parent.compareItem(n.content[o],e));o++)r++;return n.content.splice(r,0,e),r+i}).call(this,e)}appendItemToView(t,e,n,i){if("oversize"!=w&&w){var i=i||{},r=i.forceMark,i=i.skipAnim,o=this,a=this.$template.clone();if(t&&t.path&&File.getMountFolder()){f||File.getMountFolder()!=t.folderPath&&(f=!0,y.addClass("show-folder-name")),a.attr("data-path",t.path).attr("data-create-date",+t.createDate).attr("data-parent-path",t.folderPath),a.find(".file-list-item-file-name").attr("title",m.abbreviatingWithTilde(t.path)),a.children(".file-list-item-parent-loc").text(t.folderName),a.children(".file-list-item-time").text(m.date2NaturalLang(new Date(t.lastModified),!0)),h(a,t.name);var s,l=a.children(".file-list-item-summary");if(l.text(p(t.summary,t.name)),l.html(l.html().replace(/([^\s]+)\s*\n+/g,"$1<br/>")),t.path==x.getCurrentFilePath()&&a.addClass("active"),n)s=this.computeIndex(t),n.insertChildAtIndex(a[0],s);else{var c,d,l=this.removeItemFromView(t,!0),n=l.hasClass("active");if(l&&l.length)return d=l.prevAll().length,s=this.computeIndex(t),s=this.getIndexOnView(y[0],s),(d!=s||t.oldPath?(t.oldPath=void 0,c=l[0].clientHeight,l.remove(),y[0].insertChildAtIndex(a[0],s),(n||r)&&a.addClass("active"),i||y.children().each(function(e){var t=this;if(t==a[0])t.style.transition="transform 0s",t.style.transform="translate(0px, "+c*(d-e)+"px)";else if(s<=e&&e<d)t.style.transition="transform 0s",t.style.transform="translate(0px, -"+c+"px)";else{if(!(d<=e&&e<s))return;t.style.transform="translate(0px, "+c+"px)"}requestAnimationFrame(function(){t.style.transform="",t.style.transition="transform 400ms"})}),x.getCurrentFilePath()==t.path&&this.parent.markCurrentFile(),u(),a):l.find("input").length?l:(l.replaceWith(a),u(),a))[0];s=this.computeIndex(t),s=this.getIndexOnView(y[0],s),y[0].insertChildAtIndex(a[0],s)}return u(),a[0]}}function u(){var e=o.parent.nextChangeHighlight;e&&0==e.indexOf(t.path)&&o.highlight(e)}}removeFileOrFolder(e,n){var t,i,r=this,o=File.isWin?"\\":"/";function a(e){var t=r.findElemFromPath(e);t.length&&(n?t.remove():(t.addClass("ty-to-remove"),t.hide(400,function(){t.remove()})))}r.noGroup?(t=e,r.files.removeIf(function(e){if(e.path==t||0==e.path.indexOf(t+o))return a(e.path),!0})):r.findElemFromPath(e).length?r.removeItemFromView({path:e},!1,n):(i=e,Object.keys(r.dirMap).clone().forEach(function(e){e!=i&&0!=e.indexOf(i+o)||(r.dirMap[e].content.forEach(function(e){a(e.path)}),delete r.dirMap[e])}),r.dirArr.removeIf(function(e){return e.path==i||0==e.path.indexOf(i+o)}))}removeItemFromView(e,t,n){function i(e,t){~e.indexOf(t)?e.remove(t):e.removeIf(function(e){return m.isSamePath(e.path,t.oldPath||t.path)},!0)}var r,o=this.findElemFromPath(e.oldPath||e.path);return e.folderPath||(e.folderPath=o.attr("data-parent-path")),o.length?(this.noGroup?i(this.files,e):(r=this.dirMap[e.folderPath])&&i(r.content,e),t||(n?o.remove():(o.addClass("ty-to-remove"),o.hide(400,function(){o.remove()}))),o):g()}appendItemToViewByMac(e,t,n){this.appendItemToView(JSON.parse(e),t,void 0,{forceMark:n})}bindEvents(){var o=this,a=(y.on("mousedown",".file-list-item",function(e){if("INPUT"==document.activeElement.tagName){var t=this.contains(document.activeElement);if(g(document.activeElement).trigger("blur"),t)return}if(1==event.which)return event.ctrlKey||event.metaKey?o.parent.openFileInNewWindowCommand(this):(g(".file-list-item:focus").blur(),o.parent.openFile(this.getAttribute("data-path"))),!1}),0);g("#file-library").on("dragenter",function(e){o.parent.useTreeStyle||(-1<(e.originalEvent.dataTransfer.types||[]).indexOf("Files")&&(e.preventDefault(),e.stopPropagation(),a||document.querySelector("#sidebar-content").classList.add("on-drop")),a++)}).on("dragover",function(e){e.preventDefault(),e.stopPropagation()}).on("dragleave",function(e){o.parent.useTreeStyle||--a||document.querySelector("#sidebar-content").classList.remove("on-drop")}).on("drop",function(e){if(!o.parent.useTreeStyle&&File.getMountFolder()&&File.isActiveWindow()){document.querySelector("#sidebar-content").classList.remove("on-drop"),a=0,e.stopPropagation(),e.preventDefault();var t=e.originalEvent.dataTransfer,n=[];if((t.files.item(i)||{}).path)for(var i=0;i<t.files.length;i++){var r=(t.files.item(i)||{}).path;r&&n.push(r)}else n=o.parent.filesInDragging||[];o.parent.copyOrMoveFiles(n,File.getMountFolder())}}).on("click","#switch-to-tree-on-oversize",function(){o.parent.switch("file-tree")})}needRepaint(e){!e&&!0===w||(w=!1,this.dirArr=[],this.dirMap={},this.files=[])}findNodeFromPath(t){if(this.noGroup)return this.files.find(e=>m.isSamePath(t,e.path));for(var e of this.dirArr){if(m.isSamePath(t,e.path))return e;e=e.content.find(e=>m.isSamePath(t,e.path));if(e)return e}}findElemFromPath(e,t){return(e=!t&&(this.findNodeFromPath(e)||{}).path||e)?g(".file-list-item[data-path='"+m.escapeSelector(e)+"']"):g()}onAddFile(e){return this.appendItemToView(e,!0)}onChangeForMac(e){if("complete"==w&&!this.parent.isSuppressOnChange()){for(var t,n=[],i=!1,r=g("input.file-list-item-file-name").closest(".file-list-item").attr("data-path"),o=0;o<e.length;o++){var a=e[o];if((a.oldPath||a.path)==r)return;if(l.isType(a.type,"created","modified")&&v(a.path,n))return;if(!this.parent.shouldIgnore(a.path||a.newPath)){if("rename"==a.type){if(a.isDir){i=!0;break}var s=x.getCurrentFilePath()==a.oldPath;this.removeFileOrFolder(a.oldPath),bridge.callHandler("library.updateListItem",{path:a.newPath,mark:s||!1})}else"removed"==a.type&&this.removeFileOrFolder(a.path);if(a.isDir&&"modified"!=a.type){i=!0;break}"created"==a.type?!a.isDir&&/~\.[^.]+$/.exec(a.path)||bridge.callHandler("library.updateListItem",{path:a.path,mark:!1}):"modified"!=a.type||a.isDir||"oversize"!=w&&bridge.callHandler("library.updateListItemIfIsOpen",a.path)}}!w&&i&&this.isShown()&&(t=g("#file-library").scrollTop(),this.render(!0),setTimeout(function(){g("#file-library").scrollTop(t)},0))}}onChangeForWin(e,t,o){var a,n,i;function r(r){File.getMountFolder()&&0==r.indexOf(File.getMountFolder())&&F(r,function(e){var t,n,i;!e||e.shouldIgnore?a.removeFileOrFolder(r):v(r,o)||(t=r,(n=e).isFile?(e=m.pathByDeleteLastComponent(t),i={folderPath:e,folderName:x.getFileNameFromPath(e),name:x.getFileNameFromPath(t),path:t},a.fetchSummaryByNode(t,n,function(e){i.summary=e,i.lastModified=n.mtime,i.createDate=n.birthtime,a.appendItemToView(i,!0)})):n.isDir&&a.appendTreeByNode(t))})}"complete"!=w||this.parent.isSuppressOnChange()||(a=this).parent.shouldIgnore(e)||(n=g("input.file-list-item-file-name").closest(".file-list-item").attr("data-path"),e!=n&&(t?v(i=e,o,!0)||0!=a.findElemFromPath(i).length&&F(i,function(t){var n;t&&!t.shouldIgnore&&t.isFile&&(n=a.getItem(i))&&(a.fetchSummaryByNode(i,t,function(e){n.summary=e,n.lastModified=t.mtime,n.createDate=t.birthtime,a.appendItemToView(n,!0)}),o.push(i))}):r(e)))}update(e,t){void 0!==t&&((e=this.parent.findElemFromPath(e).children(".file-list-item-summary")).text(p(t.substr(0,500))),e.html(e.html().replace(/([^\s]+)\s*\n+/g,"$1<br/>")))}highlight(e){var t=this.focusToFile(e,!0);t&&(t.classList.add("blink-area"),setTimeout(function(){t.classList.remove("blink-area"),this.parent.nextChangeHighlight=null},2e3))}focusToFile(e,t){var n,i,r,o,e=this.findElemFromPath(e)[0];if(e)return n=e?e.offsetTop:0,i=e.clientHeight,i=e?{scrollTop:Math.max(0,n-i)}:null,o=(r=g(File.isMac?".sidebar-content":"#file-library")).parent().height(),!i||r.scrollTop()<n+40&&o+r.scrollTop()>n+40||(t?r.finish().scrollTop(i.scrollTop):r.animate(i,500)),e}newFile(){var t,n,e,i,r,o=this;function a(e,t){var n=this.appendItemToView({folderPath:File.getMountFolder(),folderName:x.getFileNameFromPath(File.getMountFolder()),name:t,path:e,lastModified:new Date,createDate:new Date,summary:""},!0);o.parent.isDiscardableUntitled()?(o.parent.openFile(e),setTimeout(function(){o.renameFileCommand(n,!0)},100)):o.renameFileCommand(n,!0)}File.getMountFolder()&&(f?File.isMac?bridge.callHandler("library.newFileUnder",File.getMountFolder()):File.FileSave.doShowSaveDialog(!1,File.getMountFolder()+"/Untitled."+(File.option.defaultExtension||"md"),{title:"New",buttonLabel:"Create",properties:["showOverwriteConfirmation"]}).then(async({filePath:e})=>{e&&(o.parent.scheduleChangeHighlight(e),File.bundle.filePath?(await File.FileSave.saveUseNode(!1,!1,!0),await File.FileSave.makeEmptyFileByNode(e)):await File.FileSave.saveAsUseNode(e),o.parent.openFile(e))}):(i=File.getMountFolder(),r=0,g(".file-list-item[data-parent-path='"+m.escapeSelector(i)+"']").each(function(){var e=/^untitled( (\d+))?\./i.exec(this.querySelector(".file-list-item-file-name").textContent.trim());e&&(r=Math.max(r,+(e[2]||0)+1))}),t="Untitled"+(r?" "+r:"")+"."+(File.option.defaultExtension||"md"),n=File.getMountFolder()+(File.isWin?"\\":"/")+t,(o=this).parent.pauseOnChange(!0),File.isMac?(this.parent.pauseOnChange(!0),bridge.callHandler("library.newFile",n,function(e){e?a.call(o,n,t):(o.parent.resumeOnChange(),bridge.callHandler("library.newFileUnder",File.getMountFolder()))})):(i=reqnode("fs"),n=reqnode("path").resolve(n),e=i.openSync(n,"wx"),i.close(e,function(){}),this.parent.pauseOnChange(!0),a.call(this,n,t))))}onFileUpdated(e,t){var n=this.findNodeFromPath(e);n&&(t&&Object.assign(n,t),n.lastModified=new Date,(t=this.findElemFromPath(n.path,!0)).length)&&this.appendItemToView({path:e,folderPath:t.attr("data-parent-path"),folderName:t.children(".file-list-item-parent-loc").text(),lastModified:n.lastModified,createDate:n.createDate,name:x.getFileNameFromPath(e),summary:n.summary,oldPath:e},!0)}newFileCommand(e){this.newFile()}renameFileCommand(i,a){i=g(i).closest(".file-library-node")[0],File.isMac&&bridge.callHandler("window.focus");var s=this,r=g("<input class='file-list-item-file-name' />"),e=g(i).find(".file-list-item-file-name"),o=e.clone(),l=i.getAttribute("data-path"),c=e.children().text();function d(e,t){var n;t=t.trim(),e=e.trim(),h(o,e),r.replaceWith(o),l!=t&&(n=g(i),s.appendItemToView({path:t,folderPath:i.getAttribute("data-parent-path"),folderName:g(i).children(".file-list-item-parent-loc").text(),lastModified:new Date,createDate:new Date(+i.dataset.createDate),name:e,summary:(t=n.children(".file-list-item-summary")).length?t[0].textContent||t[0].innerText:"",oldPath:l},!0)),s.editor.restoreLastCursor()}e.replaceWith(r),r.val(c),this.parent.bindRename(r,function(e){return File.isMac?(r=e.val().replace(/[\/\\]/g,""),o=m.pathByDeleteLastComponent(l)+"/"+r,s.parent.pauseOnChange(!0),void(l!=o?bridge.callHandler("library.renameFile",{old:l,new:o},function(e){e?(d(r,o),l==x.getCurrentFilePath()&&setTimeout(function(){s.parent.markOpenedFile(o),s.focusToFile(o,!0)},200),s.highlight(o)):d(c,l)}):d(c,l))):(i=(e=e).val(),void(!(i=(File.isWin?i.replace(/[\\\/:*?"<>\|\000-\031]/g,"").replace(/\.+$/,""):i.replace(/[\/\\\000-\031]/g,"")).trim())||(n=reqnode("path").resolve(m.pathByDeleteLastComponent(l)+(File.isWin?"\\":"/")+i),e=reqnode("fs"),l==n)?d(c,l):!m.isSamePath(l,n)&&e.existsSync(n)?t(g.localize.getString("File with same name already exists at target path.")):(s.parent.pauseOnChange(!0),JSBridge.invoke("app.sendEvent","willRename",{oldPath:l}),s.parent.execRenameFileByNode(l,n).then(function([e]){JSBridge.invoke("app.sendEvent","didRename",{oldPath:l,newPath:e?l:n}),e?t(e):(a||JSBridge.invoke("filesOp.registerUndo",n,l,g.localize.getString("Rename %@","Panel").replace("%@",reqnode("path").basename(l))),d(i,n),s.highlight(n))}))));function t(e){d(c,l),u.showErrorDialog(g.localize.getString("Operation Failed"),g.localize.getString('Failed to rename from "{0}" to "{1}"').format(c,i)+"\n"+e)}var n,i,r,o},function(){d(c,l)},!1,a,!0,m.pathByDeleteLastComponent(l)),r.focus()}}}),$__System.registerDynamic("31",["11","e","1d","20","13","26"],!0,function(e,t,n){"use strict";this||self;function i(t){(this.rangy=B).init(),this.savedSel={},this.editor=t,E(document).on("selectionchange",function(e){t.selection.selectWordTime&&200<new Date-t.selection.selectWordTime&&(t.selection.selectWordTime=null)}),this.updateMetrics()}var a,P,s,b=e("11"),E=e("e"),B=e("1d"),o=e("20"),R=e("13"),O=R.Node,T=e("26").map,I=O.TYPE,w=b.WESTERN_WORD_SPLITTER,e=(window.setAttributeOnlyNeeded=function(e,t,n){if(e.getAttribute(t)!=n&&("true"!=n||"write"!=e.id||"<p>&nbsp;</p>"!=e.children[0].outerHTML)){var i;if(e.setAttribute(t,n),"write"===e.id&&File.isNode&&"false"===n&&((i=E(".md-list-item")).css("display","block"),setTimeout(()=>{i.css("display","list-item")},0)),"write"==e.id&&"false"==n&&File.editor&&File.editor.selection){t=document.activeElement;if(t&&O.isType(t.tagName,"INPUT","TEXTAREA"))return;if(t&&t.classList&&t.classList.contains("ty-input"))return;var e=File.editor.selection.getRangy(),n=e&&e.startContainer,t=n&&n.parentElement;t&&(n=t.closest("[contenteditable]"))&&"false"!=n.getAttribute("contenteditable")&&(n.focus(),File.editor.selection.setRange(e))}return!0}},E.fn.scrollTop);function r(e){e.preventDefault(),e.stopPropagation()}E.fn.oldScrollTop=e,E.fn.scrollTop=function(e){if(null!==e)return void 0===e?(this[0]||{}).scrollTop:(this[0]||{}).scrollTop=e},E(document.body).on("hidden.bs.modal",".modal",function(e){File.editor.restoreLastCursor()}).on(".show.bs.modal",".modal",function(){var e=File.editor.selection.buildUndo();e&&(File.editor.lastCursor=e)}),B.rangePrototype.insertNodeAtEnd=function(e){var t=this.cloneRange();t.collapse(!1),t.insertNode(e),t.detach(),this.setEndAfter(e)},E(window).on("resize",function(){File.suppressResize||(s=document.querySelector("content").clientHeight)}),i.prototype={clearGlobalColumn:function(){P=void 0},updateMetrics:function(){s=document.querySelector("content").clientHeight;var e=this.editor.defaultTextHeight;this.editor.defaultTextHeight=parseInt(E("#write p").css("line-height")),!isNaN(this.editor.defaultTextHeight)&&this.editor.defaultTextHeight||(this.editor.defaultTextHeight=e)},jumpIntoElemBegin:function(t,e){try{var n,i=this,r=this.editor,o=t.find(".CodeMirror")[0],a=t.children("[mdtype]");return t&&t.length?(1<t.length&&(t=E(t[0])),o?(o.CodeMirror.focus(),o.CodeMirror.execCommand("goDocStart")):N(r,!1,r.findNodeByElem(t))?void 0:O.isType(t.attr("mdtype"),O.TYPE.image,O.TYPE.hr,O.TYPE.math_block)?this.selectNode(null,t):t.hasClass("footnotes")?this.jumpIntoElemBegin(t.find(".md-def-name")):a.length?this.jumpIntoElemBegin(E(a[0]),e):(n=B.createRange(),t[0].querySelector("[md-inline]")&&t[0].querySelector("[md-inline]").classList.add("md-expand"),n.setStart(t[0],0),n.setEnd(t[0],0),this.deRange(n),i.setRange(n,!0),e?setTimeout(function(){i.setRange(n,!0),i.editor.refocus()},20):!window.getSelection().anchorNode&&t.length&&(function e(t){3!=t.nodeType&&t.childNodes.length?e(t.childNodes[0]):(n.setStart(t,0),n.setEnd(t,0))}(t[0]),window.getSelection().addRange(n.nativeRange)),window.getSelection().anchorOffset)):(console.sendError("cannot jumpIntoElemBegin to empty elem","warning"),window.getSelection().removeAllRanges(),!1)}catch(e){console.sendError("cursor may go wrong",!1),Reporter.error("cursor may go wrong",{level:"warning",filename:"Selection.js",extra:{dom:t&&Reporter.sanitizeDom(t[0])}})}},jumpIntoElemEnd:function(e,t){var n=e.find(".CodeMirror")[0];if(1<e.length&&(e=E(e[0])),n)n.CodeMirror.execCommand("goDocEnd");else if(!N(this.editor,!0,this.editor.findNodeByElem(e))){if(O.isType(e.attr("mdtype"),O.TYPE.image,O.TYPE.hr,O.TYPE.math_block))return this.selectNode(null,e);{if(e.children("[mdtype]").length)return this.jumpIntoElemEnd(E(e.children("[mdtype]")[0]),t);e.hasClass("md-def-footnote")?((n=B.createRange()).setStart(e.find(".md-def-content")[0],1),n.setEnd(e.find(".md-def-content")[0],1),this.deRange(n,!0)):(e.addClass("md-expand"),this.restoreSelection(e[0],e.text().length),e.removeClass("md-expand"))}}},jumpInto:function(e,t){if(""==e.text())return this.jumpIntoElemBegin(e);this.restoreSelection(e[0],t)},fixUnselectableRange:function(e,t){var n;return!(!e||!e.collapse||!(n=(e.startContainer.childNodes||[])[e.startOffset])||"IMG"!=n.tagName||(t||(e.setStart(n.previousElementSibling,n.previousElementSibling.childNodes.length-1),e.collapse(!0)),0))},setRange:function(e,t){var n;e&&(this.fixUnselectableRange(e),t||(t=this.editor.brush.closestExpandable(E(e.startContainer)),(n=this.editor.brush.closestExpandable(E(e.endContainer))).is(t.next())&&t.hasClass("md-image")&&e.endContainer.length==e.endOffset||t.addClass("md-expand"),n.addClass("md-expand")),e.commonAncestorContainer&&e.commonAncestorContainer.getAttribute&&"linebreak"==e.commonAncestorContainer.getAttribute("md-inline")&&"\n"==e.toString()&&e.collapse(!0),File.isTypeWriterMode&&File.option.scrollWithCursor&&(a=setTimeout(()=>{this.typeWriterScroll()},180)),this.rangy.getSelection().setSingleRange(e,e.isBackward),this.editor.wordCount.updateInSelection(this.getTextInSelection(e)),E(this.editor.sessionStr).trigger("cursorChange"))},getOffset:function(e,t){if(t=(t=t&&!t.nativeRange?this.wrappedRange(t):t)||this.getRangy())try{return void 0!==e.length&&(e=e[0]),t.getBookmark(e).start}catch(e){}return 0},restoreEdge:function(e,t,n,i){e.jquery&&(e=e.length?e[0]:null);var r=B.createRange();return e?(r.moveToBookmark({containerNode:e,start:t,end:t}),i?(n?i.setEnd(r.endContainer,r.endOffset):i.setStart(r.startContainer,r.startOffset),i):r):i||r},saveSelection:function(e,t){if(e)return e.jquery&&(e=e[0]),(t=t||this.getRangy())?(this.savedSel=t.getBookmark(e),this.savedSel):void 0},restoreSelection:function(e,t){var n,i,r;return(e=e&&(e.jquery?e[0]:e))?(n="false"===e.getAttribute("contenteditable"),null==t||""===t?t=this.savedSel:"number"==typeof t&&(t={start:t,end:t}),l(this.editor,e,t.start)?void 0:((i=B.createRange()).moveToBookmark({start:t.start,end:t.end,containerNode:e}),i.endContainer==e&&0==i.endOffset&&0<t.end&&(r=e.rawText().length,t.end>r)&&i.moveToBookmark({start:Math.min(t.start,r),end:Math.min(t.end,r),containerNode:e}),("BODY"==document.activeElement.tagName||"write"!==document.activeElement.id&&document.activeElement.hasAttribute("tabindex"))&&(t=E("content").scrollTop(),this.editor.writingArea.focus(),E("content").scrollTop(t)),i.collapsed&&this.deRange(i),n&&e.setAttribute("contenteditable","true"),this.setRange(i),!n||e.classList.contains("md-def-link")||e.classList.contains("md-def-footnote")||e.setAttribute("contenteditable","false"),i)):window.getSelection().removeAllRanges()},getVeryFirstElem:function(e){return 0<e.children("[cid]").length?this.getVeryFirstElem(e.children("[cid]").first()):e},getVeryLastElem:function(e){return 0<e.children("[cid]").length?this.getVeryLastElem(e.children("[cid]").last()):e},getSelection:function(){return this.rangy.getSelection()},prepNode:function(e,t,n,i){var r=this.editor,o=this.getRangy(),a=this.editor.undo.UndoManager,s=a.SnapFlag,l=o&&!o.collapsed;if(!(i&&l&&File.isWin&&(i=(i=o.commonAncestorContainer.closest?o.commonAncestorContainer:o.commonAncestorContainer.parentElement).closest("[cid]")))||i.querySelector("[cid]")||(r.undo.addSnap(i.getAttribute("cid"),s.NONE),r.brush.addToQueue(i.getAttribute("cid")),0)){P=void 0,File.inBusyMode&&setAttributeOnlyNeeded(this.editor.writingArea,"contenteditable","false");try{if(l){if(n)return w;if(r.UserOp.surroundPair(r,e,o))return void(t&&t.preventDefault());w=r.UserOp.backspaceHandler(r,null,"delSelection",!0,!0)}var c,d,u,h,p,f,m,g,y,v,b,w,x,o=this.getRangy(),C=this.rangy.getSelection(),F=C.anchorOffset==B.dom.getNodeLength(C.anchorNode),S=r.getJQueryElem(C.anchorNode),k=r.getMarkElem(C.anchorNode),E=r.findNodeByElem(k),T=o.getBookmark(k[0]);if(S[0]==this.editor.writingArea){if(0!=o.startOffset)return C.removeAllRanges(),void(t&&t.preventDefault());this.jumpTop()}if(!S.hasClass("ty-input")&&E){if(w||n||(r.undo.addSnap(E.cid,s.NONE),r.brush.addToQueue(E.cid)),File.inBusyMode&&(u=S.closest("[contenteditable='true']"),document.activeElement!==u[0])&&u.focus(),S.hasClass("md-def-url")&&(e.match(/\s/g)||[]).length)return F&&this.jumpIntoElemBegin(k.find(".md-def-title")),t&&t.preventDefault();if(!n&&w&&(h=k.attr("cid"),p=1<e.length?s.REPLACE:s.ADD,w.source=h+"#"+p,w.date=new Date),(k.is(".unholdable")?k:k.closest(".unholdable")).find(".math-jax-postprocess>.md-math-after-sym").text(""),O.isType(E,I.def_link,I.def_footnote)){if(k[0]==S[0]&&o.collapsed)return void this.jumpIntoElemBegin(k.find(".md-def-name"))}else E.get("type")!=I.meta_block&&E.get("type")!=I.fences&&(E.isBlock()&&E.canNotDirectEdit()?(window.getSelection().removeAllRanges(),t&&t.preventDefault()):S.hasClass("md-image")&&1==o.startOffset&&!S.prev().length&&(S.before("​"),o.setStartBefore(S.parent()),C.setSingleRange(o)));if(E.get("children").length&&(f=window.getSelection().anchorNode.childNodes,g=0<(m=window.getSelection().anchorOffset)?f[m-1]:null,y=m<f.length?f[m]:null,v=r.findNodeByElem(g?r.getMarkElem(g):[]),b=r.findNodeByElem(y?r.getMarkElem(y):[]),e=e.replace(/\u200B/g,""),O.isType(b,R.TYPE.table)?(r.undo.endSnap(!0),w=w||a.makeEmptyCommand(),x=new O({type:R.TYPE.paragraph,text:e,in:b.get("in")}),b.addBefore(x),a.addUndoForInsert(w,x),r.findElemById(b.id).before(x.toHTML()),r.selection.restoreSelection(r.findElemById(x.id)[0],e.length),c=x):O.isType(v,R.TYPE.table)?(r.undo.endSnap(!0),w=w||a.makeEmptyCommand(),x=new O({type:R.TYPE.paragraph,text:e,in:v.get("in")}),v.addAfter(x),a.addUndoForInsert(w,x),r.findElemById(v.id).after(x.toHTML()),r.selection.restoreSelection(r.findElemById(x.id)[0],e.length),c=x):b?(b=b.getVeryFirst(),r.undo.addSnap(b.cid,s.NONE),b.set("text",e+b.safeGetStrAttr("text",!0)),r.findElemById(b.id).replaceWith(b.toHTML()),b&&r.selection.jumpInto(r.findElemById(b.id),1),w=null):v&&(v=v.getVeryFirst(!0),r.undo.addSnap(v.cid,s.NONE),v.set("text",v.safeGetStrAttr("text",!0)+e),r.findElemById(v.id).replaceWith(v.toHTML()),r.selection.jumpIntoElemEnd(r.findElemById(v.id)),w=null),w&&w.redo.push(this.buildUndo()),n||r.refocus(c?c.id:void 0),t)&&t.preventDefault(),!n)if(!l&&e){var _=k,A=T,M=_.rawText(),L=_.rawText(!0),N=0,D=0;if(M!=L){for(;N<A.start;)if(M[N]!=L[D]){if("​"!=M[N])break;N++}else N++,D++;A.start-=N-D,A.end-=N-D}(d=(d=(d=r.UserOp.handlePair(r,e,E,T,w,o))||r.UserOp.PunctuationOp.handlerCh(r,e,E,T,w,o))||r.htmlBlock.autoCloseTagWhenInput(r,e,E,T,w,o))&&("object"==typeof d&&(w=d),t)&&t.preventDefault()}else w&&(r.UserOp.insertInlineText(r,E,e,T.start,w,!0),t)&&t.preventDefault();return!n&&w&&this.editor.undo.register(w),w}}catch(e){console.warn(e)}}},getPosBookmark:function(e){var t,n=editor.getMarkElem();if(n.length)return(t=this.editor.fences.queue[n.attr("cid")])?{isCm:t,cid:t.cid,start:t.indexFromPos(t.getCursor())}:e?{isCm:!1,cid:n.attr("cid"),start:e.getBookmark(n[0]).start}:null},wrappedRange:function(e){var t;return window.StaticRange&&e instanceof StaticRange?((t=this.rangy.createRange()).setStart(e.startContainer,e.startOffset),t.setEnd(e.endContainer,e.endOffset),t):this.rangy.WrappedRange(t)},getRangy:function(e){var t=this.rangy.getSelection(),n=t.rangeCount?t.getRangeAt(0):null;return n&&(n.isBackward=t.isBackward(),e)&&this.deRange(n),n},storeToJson:function(e){return(e=e||this.buildUndo())&&e.pos?{id:e.id,pos:e.pos}:e},buildUndo:function(e,t,n){var i={type:"cursor"};if(this.editor.sourceView&&this.editor.sourceView.inSourceMode)i.pos=this.editor.sourceView.cm.getCursor(),i.inSourceMode=!0;else try{if((t=((e=e||this.getRangy())&&e.commonAncestorContainer?this.editor.getMarkElem(e.commonAncestorContainer):t)||this.editor.getMarkElem()).find(".CodeMirror").length){var r=t.find(".CodeMirror")[0].CodeMirror;i.id=r.cid,i.pos=r.getCursor(),i.selections=r.listSelections()}else if(t.attr("mdtype")&&t.children("[tabindex]").addBack("[tabindex]").length)i.id=t.attr("cid"),i.focus=t.attr("mdtype");else{if(!e)return null;var o=this.editor.getMarkElem(this.getDetailPos(e.startContainer,e.startOffset)[0]),a=this.editor.getMarkElem(this.getDetailPos(e.endContainer,e.endOffset)[0]),s=e.getBookmark(o[0],n);if(O.isType(o.attr("mdtype"),I.fences,I.html_block,I.math_block)&&(s.start=0),o[0]===a[0]){if(i.id=o.attr("cid"),!i.id)return null;i.start=s.start,i.end=s.end}else{if(i.startId=o.attr("cid"),i.endId=a.attr("cid"),!i.startId||!i.endId)return null;i.start=s.start,i.end=e.getBookmark(a[0]).end}}}catch(e){return e.stack,null}return i},selectNode:function(e,t){(t=t||editor.findElemById(e.id)).length&&"write"!==t.attr("id")&&void 0!==t.attr("tabindex")&&(window.getSelection().removeAllRanges(),t.addClass("onfocus"),t.focus())},jumpToLineEdge:function(e,t){return this.extendToLineEdge(e,null,t,!0)},fixExtendToLineEdge:function(e,t,n,i){t=t||this.editor.getMarkElem()[0];var r=this.getRangy();if(r&&t&&!isInputComponent(document.activeElement)&&!isInputComponent(t)&&O.isType(t.getAttribute("mdtype"),I.paragraph,I.heading)){var o,a,s=null,l=this.rangy.createRange();if(e){if((s=t.querySelectorAll(".md-inline-math").last())&&(l.setStartBefore(s),l.collapse(!1),o=l.getBookmark(t),a=r.getBookmark(t),o.end==a.end)&&(a.end=t.textContent.length,i&&(a.start=a.end),r.moveToBookmark(a),!n))return this.setRange(r),void this.editor.brush.expandOnDelay(!0)}else if((s=t.querySelectorAll(".md-inline-math")[0])&&(l.setStartAndEnd(s,s.childNodes.length),o=l.getBookmark(t),a=r.getBookmark(t),o.start==a.start)&&(a.start=0,i&&(a.end=a.start),r.moveToBookmark(a),!n))return this.setRange(r),void this.editor.brush.expandOnDelay(!0);this.editor.brush.expandOnDelay(!0)}},extendToLineEdge:function(e,t,n,i){t=t||this.editor.getMarkElem()[0];var r,o=this.getRangy();return!(!o||!t||isInputComponent(document.activeElement)||isInputComponent(t))&&(o=o.getBookmark(t),r=B.createRange(),e?(o.end=t.textContent.length,i&&(o.start=o.end)):(o.start=0,i&&(o.end=0),r.isBackward=!0),r.moveToBookmark(o),n||this.setRange(r),r)},extendCharFromCollapse:function(e,t){var n=!1,i=!t;if(e.commonAncestorContainer.nodeType==document.TEXT_NODE&&(t&&0<e.startOffset&&(e.setStart(e.startContainer,e.startOffset-1),0<e.startOffset&&56320<=(r=e.toString().charCodeAt(0))&&r<=57343&&(e.setStart(e.startContainer,e.startOffset-1),55296<=(r=e.toString().charCodeAt(0))&&r<=56319||e.setStart(e.startContainer,e.startOffset+1)),n=!0),i)&&e.endOffset<e.commonAncestorContainer.textContent.length&&(e.setEnd(e.endContainer,e.endOffset+1),55296<=(r=e.toString().charCodeAt(e.toString().length))&&r<=56319&&e.endOffset<e.commonAncestorContainer.textContent.length&&e.setEnd(e.endContainer,e.endOffset+1),n=!0),!n){var r=this.editor.getMarkElem(e.startContainer)[0];if(!r)return e;n=e.getBookmark(r);if(t&&0===n.start||i&&n.end>=r.textContent.length)return!1;t?n.start--:n.end++,(r.classList.contains("md-def-link")||r.classList.contains("md-def-footnote"))&&(i=r.querySelector(".md-def-name").textContent.length,n.start!=i&&n.start!=i+1+r.querySelector(".md-def-content").textContent.length||(t?(n.end-n.start<=1&&n.end--,n.start--):(n.end-n.start<=1&&n.start++,n.end++))),e.moveToBookmark(n),"​"==e.toString()&&(t?0<n.end&&n.end--:n.end<r.textContent.length&&n.end++,e.moveToBookmark(n))}return e},isSameRange:function(e,t){try{return e.startContainer==t.startContainer&&e.endContainer==t.endContainer&&e.startOffset==t.startOffset&&e.endOffset==t.endOffset}catch(e){}return!1},moveLeftOrRight:function(n,t){P=void 0;var i=this,r=this.editor.getMarkElem()[0],o=this.getRangy(),e=this.editor;if(r&&"write"!==r.id&&r.hasAttribute("tabindex")&&t&&!t.metaKey&&!t.shiftKey&&!t.ctrlKey)return this.moveUpOrDown(n,t,!0);if(!(t&&isInputComponent(t.target)||!o)&&r){!File.inBusyMode||o&&!E(o.startContainer).closest("[contenteditable='false'][cid]").length||setAttributeOnlyNeeded(e.writingArea,"contenteditable","true");var a=t.shiftKey;if(!t||!E(n?o.startContainer:o.endContainer).closest("[mdtype='table_cell']").length){var s=o.getBookmark(r),l=B.createRange();if(t){if(!t.metaKey&&!t.ctrlKey&&!t.shiftKey&&o.toString().length)return o.collapse(n),this.setRange(o,!0),(c=this.editor.getMarkElem(o.startContainer)).length&&N(this.editor,!n,this.editor.findNodeByElem(c)),t.preventDefault(),!0;var c=File.isMac&&t.metaKey;if(n&&0===s.start&&(!o||o.collapsed||o.isBackward))return c?void 0:this.moveUpOrDown(!0,t,!0);var d=E(r).rawText().length;if(!n&&s.end>=d&&(!o||o.collapsed||!o.isBackward)&&(!r.classList.contains("md-def-link")||0!=e.getJQueryElem(o.startContainer).closest(".md-def-title").length))return c?void 0:this.moveUpOrDown(!1,t,!0);e=document.querySelector(".ty-focusable-btn.selected");if(e&&!t.metaKey&&!t.ctrlKey&&!t.shiftKey&&s.end==s.start)return e.classList.remove("selected"),s.end+=n?-1:1,s.start+=n?-1:1,l.moveToBookmark(s),this.setRange(l,!0),t.preventDefault(),!0;if(File.isNodeHtml&&!n&&t.ctrlKey&&!t.shiftKey){c=r.textContent.substring(s.end)||"";if(!/^[^\$]+\s+[^\$]/.exec(c)&&-1!=c.indexOf("$")){e=window.getSelection();if(null!=e)return e.modify("move","right","word"),u=e.anchorNode&&e.anchorNode.parentElement&&e.anchorNode.parentElement.closest("mjx-container"),0==e.startOffset&&u&&0==(i.getRangy().getBookmark(u)||{}).start&&e.collapse(u.parentElement.previousElementSibling,0),t.preventDefault(),!0}if(/^\w+$/.exec(c))return s.start=s.end=d,l.moveToBookmark(s),this.setRange(l,!0),t.preventDefault(),!0}}var e=Object.assign({},s),u=(n?(s.end=s.start,s.start--):(s.start=s.end,s.end++),l.moveToBookmark(s),l.toString());return/\u200b|\007F/g.exec(u)?(t.shiftKey?(n?e.start-=2:e.end+=2,n&&(e.start=Math.max(0,e.start)),l.moveToBookmark(e)):l.collapse(n),l.isBackward=o&&o.isBackward,this.setRange(l,!0),!0):(c=l).startContainer==c.endContainer||!E(n?c.startContainer:c.endContainer).closest(".md-inline-math").addClass("md-expand").length||t.ctrlKey||t.metaKey||t.altKey||t.shiftKey?(d=E(l.commonAncestorContainer).closest(".md-def-content"),s=E(o.commonAncestorContainer).closest(".md-def-name"),void(o.collapsed&&r&&!t.shiftKey&&(t.ctrlKey||t.metaKey)&&(d.length?setTimeout(function(){var e=i.getRangy();e&&r.contains(e.commonAncestorContainer)||(n?i.jumpIntoElemBegin(E(r)):i.jumpIntoElemEnd(E(r)))},0):s.length?n||o.endOffset!=o.endContainer.length||i.jumpIntoElemEnd(E(r)):setTimeout(function(){var e,t=i.getRangy();t&&t.endContainer&&(e=E(n?t.startContainer:t.endContainer).closest(".md-inline-math").addClass("md-expand"),(e=File.isMac&&!e.length&&t.endContainer.length==t.endOffset&&t.endContainer.nodeType==document.TEXT_NODE?E(t.endContainer.parentElement).next(".md-inline-math"):e).length)&&(n?(t.setStart(e.find(".md-before")[0],0),t.collapse(!0)):(t.setEnd(e.find(".md-math-after-sym")[0],0),t.collapse(!1)),i.setRange(t))},0)))):(l.collapse(n),this.setRange(l,!0),t&&t.preventDefault(),!0)}setTimeout(function(){var e;t&&t.isDefaultPrevented()||(e=i.getRangy(),i.isSameRange(e,o)&&(i.editor.tableEdit.moveToNextCell(!1,n),a)&&(e=i.getRangy(),n?e.setEnd(o.endContainer,o.endOffset):e.setStart(o.startContainer,o.startOffset),e.isBackward=n,E(o.endContainer).closest("figure").attr("contenteditable",!0),i.setRange(e)))},0)}},addUnholdable:function(e,t,n,i){o=e,r=n,a=I.paragraph,o.get("type")==I.list_item&&(a=I.list_item),a=new O({type:a}),r?o.addBefore(a):o.addAfter(a),O.normalizeNode(a);var r=a,o=this.editor.findElemById(e.id),a=n?e:void 0,e=n?void 0:e;return n?o.before(r.toHTML()):o.after(r.toHTML()),this.editor.undo.endSnap(!0),t=t||this.editor.undo.UndoManager.makeEmptyCommand(),E(".unholdable").removeClass("unholdable"),this.editor.findElemById(r.id).addClass(i?"":"unholdable"),this.editor.undo.UndoManager.addUndoForInsert(t,r,e,a),t.discardable=!0,r},jumpToNextBlock:function(e,t){var n=e.getClosetBlock(!0).getVeryFirstBrotherIncludeTopBlock(!1);if(!n){if(!t)return void window.getSelection().removeAllRanges();n=this.addUnholdable(e,t)}e=this.editor.findElemById(n.cid),this.jumpIntoElemBegin(e),t.redo.push(this.buildUndo());var i=this.editor;setTimeout(function(){i.refocus()},50)},unlockBlockUpOrDown:function(e,t){var n=this.editor,t=(File.inBusyMode&&(t.shiftKey||t.metaKey||t.ctrlK)&&setAttributeOnlyNeeded(n.writingArea,"contenteditable","true"),this.getRangy()),t=n.getMarkElem(t&&(e?t.startContainer:t.endContainer)),i=n.findNodeByElem(t);if(i){for(var r=[],o="false"===t.attr("contenteditable")?t:t.closest("[mdtype][contenteditable=false]");o.length;)o.attr("contenteditable","true"),r.push(o),o=o.closest("[mdtype][contenteditable=false]");for(t=i.getClosetBlock(!0).getVeryFirstBrotherIncludeTopBlock(e),i=t?n.findElemById(t.id):E(),o="false"===i.attr("contenteditable")?i:i.closest("[mdtype][contenteditable=false]");o.length;)o.attr("contenteditable","true"),r.push(o),o=o.closest("[mdtype][contenteditable=false]");r.length&&setTimeout(function(){r.forEach(function(e){e.attr("contenteditable","false")})},0)}},moveUpOrDown:function(d,u,h){File.inBusyMode&&u&&(u.shiftKey||u.metaKey||u.ctrlK)&&this.editor.writingArea.setAttribute("contenteditable","true");var s,l=this.getRangy(),p=this,c=u&&O.isType(T[u.keyCode||u.which],"Right","Left"),f=File.isNode&&u&&u.ctrlKey&&!u.shiftKey,r=u&&u.shiftKey,o=function(e,t){var n=t.endContainer.nodeType==document.TEXT_NODE?t.endContainer.parentElement.parentElement:null;if((n=n&&n.classList.contains("md-meta")?n.parentElement:n)&&n.classList.contains("md-image"))return t.endContainer.textContent.length==t.endOffset&&e.rawText().length==t.getBookmark(e[0]).end||(n=t.nativeRange.getClientRects()).length&&(n=n[n.length-1],!(!(n=document.elementFromPoint(n.x,n.y+28))||"IMG"!=n.tagName||(t.collapseAfter(n),e.rawText().length!=t.getBookmark(e[0]).end)))||void 0};function m(e,t){return t?!e||O.isType(e,I.fences,I.html_block,I.table,I.math_block,I.hr,I.toc):O.isType(e,I.fences,I.html_block,I.table,I.math_block,I.hr,I.toc,I.def_footnote,I.def_link)}function g(e,t,n,i,r){var o=e.getVeryFirstBrotherIncludeTopBlock(t),a=p.editor.undo.UndoManager.makeEmptyCommand();return!(!c&&!o&&!e.get(t?"before":"after")||m(e)&&m(e.get(t?"before":"after"),!0))||t&&O.isType(e,I.meta_block)||(o=p.addUnholdable(function e(t,n){return O.isType(t,I.fences,I.html_block,I.table,I.hr,I.def_link,I.def_footnote)||(n=n?"before":"after",!t.get("parent"))||t.get("parent").get(n)||t.get(n)?t:e(t.get("parent"))}(e),a,t)),a.undo.push(p.buildUndo()),n&&n(),c?t?p.jumpIntoElemEnd(p.editor.findElemById(o.id)):p.jumpIntoElemBegin(p.editor.findElemById(o.id)):f?p.jumpIntoElemBegin(p.editor.findElemById(o.id),!0):v(o,i,a,r),a}function y(e,t,n){S=g(e.getClosetBlock(),t,void 0,n),u&&u.preventDefault();e=p.editor.undo.UndoManager;e.isEmptyCommand(S)||(S.redo.push(p.buildUndo()),e.isEmptyOrUnchangedCommand(S))||p.editor.undo.register(S),p.scrollAdjust()}function e(e,t,n,i){var r,o=n||p.editor.fences.getCm(e.id),n=i[0].contains(document.activeElement)&&document.activeElement.classList.contains("ty-input"),a=t&&0==o.doc.getCursor().line,s=!t&&o.doc.getCursor().line==o.lineCount()-1;if(a&&t&&(a=(r=o.cursorCoords().top)==o.cursorCoords({line:0,ch:0}).top),s&&!t&&(s=(r=o.cursorCoords().top)==o.cursorCoords({line:o.lineCount()-1,ch:o.getLine(o.lineCount()-1).length}).top),f&&(a=!0),h||null!=P||(P=n?E(document.activeElement).offset().left+document.activeElement.clientWidth:o.cursorCoords(o.getCursor()).right),n){var l=document.activeElement.classList.contains("ty-input-before");if(!l&&t)return p.editor.fences.jumpCmEnd(o),h||L(o,P),_(u);if(l&&!t)return p.editor.fences.jumpCmBegin(o),h||L(o,P),_(u);s=s||document.activeElement.classList.contains("ty-input-after")}else if(s&&!t){if(e.get("type")==I.fences||e.get("type")==I.math_block&&e.get("tagAfter"))return o.getInputField().blur(),setTimeout(function(){p.selectAllElem(i.find(".ty-input-after").focus())},0),_(u)}else if(a&&t&&e.get("type")==I.math_block&&e.get("tagBefore"))return o.getInputField().blur(),setTimeout(function(){p.selectAllElem(i.find(".ty-input-before").focus())},0),_(u);(a||s)&&(l=o.getCursor(),n||(f=!P&&(0==l.ch||r!=o.cursorCoords({line:l.line,ch:l.ch-1}).top)),h&&(f=!t),S=g(e,t,function(){o.getInputField().blur()},i,h?void 0:P),p.editor.undo.UndoManager.isEmptyCommand(S)||(t&&S.redo.push(p.buildUndo()),p.editor.undo.register(S)),_(u),o.hasFocus()||b(S)),u&&u.stopPropagation()}function v(e,t,n,i){var r,o,a,s,l,c;e&&(r=p.editor.findElemById(e.id),o=t.closest(".unholdable"),a=F,l=n,o.hasClass("unholdable")&&a&&(o.text().length?o.removeClass("unholdable"):(p.editor.undo.endSnap(!0),p.editor.undo.UndoManager.addUndoForRemove(l,a),l.redo.push(p.buildUndo()),a.remove(),o.remove(),p.editor.undo.register(l))),!(a=u&&u.shiftKey)&&M(r)?(_(u),r.find("img:first").trigger("click")):a&&(O.isType(e,I.fences,I.html_block,I.math_block)||A(e))?r.length&&((c=B.createRange()).setStart(r[0],0),c.setEnd(r[0],r[0].childNodes.length),p.deRange(c,!0),"false"==r.attr("contenteditable"))&&r.attr("contenteditable","true"):N(p.editor,d,e,u,n,h?void 0:P)||(O.isType(e,I.paragraph,I.heading,I.def_link,I.def_footnote)&&!e.get("text")?(p.jumpIntoElemBegin(r),u&&u.preventDefault()):O.isType(e,I.meta_block)&&d?(p.jumpIntoElemEnd(r),u&&u.preventDefault()):O.isType(e,I.table,I.table_row,I.table_cell)?(p.jumpIntoElemBegin(r),_(u)):r.length&&(!h&&0!=t.closest("#write").length&&(editor.selection.scrollAdjust(r,void 0,!0,!0),File.inBusyMode&&editor.writingArea.setAttribute("contenteditable","true"),o=P,null!=(o=void 0!==i?c&&c.getBookmark(t[0]).end==t.text().length?P:i:o))?(l=null,((a=p.getRangy())&&a.nativeRange.getClientRects()[0]||null!=i)&&(s=(r.children[0]||r[0]).getBoundingClientRect(),n=d?s.y+s.height-8:s.y+4,l=document.caretRangeFromPoint(o,n)),e=l&&(r[0]==l.startContainer||r[0].contains(l.startContainer)),c=l?E(l.startContainer).closest(".md-reverse-footnote-area"):E(),e&&c.length&&(l.setStart(c[0].previousElementSibling,1),l.setEnd(c[0].previousElementSibling,1),p.deRange(l)),e?p.setRange(l):null==i&&a?window.getSelection().modify("move",d?"backward":"forward","line"):(d?p.jumpIntoElemEnd(r):p.jumpIntoElemBegin(r),(l=(s=(a=a||p.getRangy())&&a.nativeRange.getClientRects()[0])?document.caretRangeFromPoint(o,s.y):l)&&(r[0]==l.startContainer||r[0].contains(l.startContainer))&&p.setRange(l))):d?p.jumpIntoElemEnd(r):p.jumpIntoElemBegin(r),File.isFocusMode&&(E(".md-focus").removeClass("md-focus"),r.addClass("md-focus")),_(u))))}function t(e,t,n){var i,r,o,a=E(l.commonAncestorContainer.parentElement);if(!d&&a.hasClass("md-image-after-src"))return(a=a.closest(".md-image").next()).length?(p.jumpIntoElemBegin(a),_(u)):y(t,d,e),!1;s&&s.left&&((a=(a=!d&&l.collapsed)?(t=l.startContainer.parentElement.classList).contains("md-def-name")||t.contains("md-tab"):a)?(i=s.left,r=d?s.top-9:s.bottom+9,o=document.caretRangeFromPoint(i,r),this.setRange(o,!0),_(u)):(n||File.isTypeWriterMode&&File.option.scrollWithCursor)&&(i=n||s.left,r=d?s.top-9:s.bottom+9,o=document.caretRangeFromPoint(i,r),!d&&this.fixUnselectableRange(o,!0)&&(r=((o.startContainer.getClientRects&&(o.startContainer.getClientRects()||[{}])[0]).bottom||r)+9,o=document.caretRangeFromPoint(i,r),this.deRange(o)),this.editor.writingArea.contains(o.startContainer))&&(D(o)||{}).top!=s.top&&(this.setRange(o),_(u)))}function b(e){var t;r&&l&&(t=p.getRangy())&&(t.isBackward=l.isBackward||l.collapsed&&d,t.isBackward?t.setEnd(l.endContainer,l.endOffset):t.setStart(l.startContainer,l.startOffset),p.setRange(t),e.redo.push(p.buildUndo(t)),_(u))}try{var n,i,a,w,x=this.editor.getMarkElem(),C=x.attr("mdtype"),F=this.editor.findNodeByElem(x),S=p.editor.undo.UndoManager.makeEmptyCommand();if(F)if(A(F,x)||x.hasClass("rawedit"))document.activeElement!==this.editor.writingArea&&(n=E("content").scrollTop(),this.editor.writingArea.focus(),E("content").scrollTop(n),window.getSelection().removeAllRanges()),y(F,d,x),b(S);else if(C==R.TYPE.fences)e(F,d,void 0,x);else if(C==R.TYPE.html_block&&this.editor.htmlBlock.currentCm)e(F,d,this.editor.htmlBlock.currentCm,x);else if(C==R.TYPE.math_block&&this.editor.mathBlock.currentCm)e(F,d,this.editor.mathBlock.currentCm,x);else if(x.closest(".td-span").length){if(!u||!(u.altKey||u.ctrlKey||u.metaKey)){var k=function(e,t){var n=e.closest("td"),i=n.prevAll().length+1;if(!n.length){if(t)return[];i=(n=e.closest("th")).prevAll().length+1}return"TD"==n[0].tagName?(e=n.closest("tr")[t?"prev":"next"]().find("td:nth-child("+i+")>.td-span"),t&&!e.length?n.closest("tbody").prev().find("tr:last > th:nth-child("+i+") > .td-span"):e):t?[]:n.closest("thead").next().find("tr:first > td:nth-child("+i+")>.td-span")}(x.closest(".td-span"),d);if(k.length)u&&u.preventDefault(),d?this.jumpIntoElemEnd(k):this.jumpIntoElemBegin(k),this.scrollAdjust(void 0,void 0,!0);else{if(c)return _(u),!1;y(F,d,x)}}}else x.closest(".md-meta-block").length&&!d?(x[0].normalize(),x.text().substring(window.getSelection().focusOffset).match(/\S+\n+/)||y(F,d,x)):(h||null!=P||(i=l.nativeRange.getClientRects(),P=(1==i.length?i[0]:{}).left),a=F.getClosetBlock(!0).getVeryFirstBrotherIncludeTopBlock(d),S.undo.push(this.editor.lastCursor),(w=function(e,t){var n,i;return(t=t||this.getRangy())?r||t.collapsed||e[0].contains(t.commonAncestorContainer)||e[0]==t.commonAncestorContainer?!1===(s=D(t.nativeRange,!0))?0:s&&e.length&&e.text().length?(i=e[n=0].getBoundingClientRect(),(o(e,t)||i.bottom-s.bottom<parseInt(e.css("paddingBottom"))+10)&&(n|=1),s.top-i.top<parseInt(e.css("paddingTop"))+10&&(n|=2),n):3:void 0:0}.call(this,x))&(d?2:1)?a?v(a,x,S,P):!d&&x.text().trim().length&&y(F,d,x):w?t.call(this,x,F,P):t.call(this,x,F),b(S),!u.isDefaultPrevented()&&File.isTypeWriterMode&&setTimeout(this.scrollAdjust.bind(this),0))}catch(e){e.stack}},click:function(e,t,n){window.getSelection().removeAllRanges();var i=document.createEvent("MouseEvent"),r=document.elementFromPoint(e,t);i.initMouseEvent("click",!0,!0,window,null,e,t,0,0,!1,!1,!1,!1,0,null),r.dispatchEvent(i)},jumpDefComponent:function(e){var t=this.editor.getMarkElem(),n=B.createRange();e?n.selectNodeContents(t.find(".md-def-name")[0]):n.selectNodeContents(t.find(".md-def-content")[0]),this.deRange(n,!0),this.editor.refocus()},jumpSelection:function(){return this.scrollAdjust(null,20)},jumpToLineStart:function(e){var t,n=this.editor,n=(n.sourceView&&n.sourceView.inSourceMode&&n.sourceView.cm.execCommand(e?"goLineEnd":"goLineStart"),this.editor.getMarkElem());isInputComponent(document.activeElement)?window.getSelection().modify("move",e?"forward":"backward","paragraphboundary"):n.find(".CodeMirror").length?(t=n.find(".CodeMirror")[0].CodeMirror)&&t.execCommand(e?"goLineEnd":"goLineStart"):n.closest('[mdtype="table"]').length?e?this.jumpIntoElemEnd(n.closest("tr").find(".td-span").first()):this.jumpIntoElemBegin(n.closest("tr").find(".td-span").last()):n.closest(".md-meta-block").length?window.getSelection().modify("move",e?"forward":"backward","lineboundary"):e?this.jumpIntoElemEnd(n):this.jumpIntoElemBegin(n)},jumpToLineEnd:function(){this.jumpToLineStart(!0)},jumpTop:function(e){var t,n=this.editor;n.sourceView&&n.sourceView.inSourceMode?n.sourceView.cm.execCommand("goDocStart"):(t=this.getRangy(),e&&t?(t.setStart(n.writingArea,0),this.deRange(t,!0)):n.nodeMap&&(e=(e=n.nodeMap.getFirst())&&(e.getVeryFirst()||e),this.jumpIntoElemBegin(n.findElemById((e||{}).cid))),File.isTypeWriterMode||E("content").animate({scrollTop:0},"100","swing",function(){n.library.outline.highlightVisibleHeader()}))},jumpBottom:function(e){var t=this.editor;if(t.sourceView&&t.sourceView.inSourceMode)t.sourceView.cm.execCommand("goDocEnd");else{var n=this.getRangy();if(e&&n){n.setEnd(t.writingArea,t.writingArea.childNodes.length),n=this.deRange(n,!0);try{n.endContainer.parentElement.classList.contains("md-def-title")&&""==n.endContainer.parentElement.textContent&&(n.setEndAfter(n.endContainer.parentElement.previousSibling.previousSibling),n=this.deRange(n,!0))}catch(e){}}else{e=(e=t.nodeMap.getLast())&&(e.getVeryFirst(!0)||e);this.jumpIntoElemEnd(t.findElemById(e.cid))}File.isTypeWriterMode||E("content").animate({scrollTop:document.querySelector(this.editor.sessionStr).scrollHeight-window.innerHeight},"100","swing",function(){t.library.outline.highlightVisibleHeader()})}},lockNativeScroll:function(){window.addEventListener("wheel",r,{passive:!1}),window.addEventListener("DOMMouseScroll",r,{passive:!1}),this.nativeScrollLocked=!1;var e=()=>{this.nativeScrollLocked=setTimeout(()=>{this.editor.isScrolling()?e():(this.nativeScrollLocked=!1,window.removeEventListener("wheel",r,{passive:!1}),window.removeEventListener("DOMMouseScroll",r,{passive:!1}))},100)};e()},typeWriterScroll:function(e,t,n){var i,r=this.editor;function o(e){!e||0==e.top&&0==e.bottom||(isNaN(r.defaultTextHeight)&&r.selection.updateMetrics(),e=e.top-s/2+r.defaultTextHeight/2,2<Math.abs(e)?n?E("content").animate({scrollTop:E("content").scrollTop()+e},120,"swing",n):E("content").scrollTop(E("content").scrollTop()+e):n&&n())}a&&clearTimeout(a),a=null,File.isTypeWriterMode&&(t?(i=e.jquery&&e.length&&e[0].getBoundingClientRect())&&(i=document.caretRangeFromPoint((i.left+i.right)/2,i.bottom-10),this.typeWriterScroll(i)):!e||e.getBoundingClientRect?(i=e||window.getSelection().rangeCount&&window.getSelection().getRangeAt(0))?o(D(i)):n&&n():e.top?o(e):e.jquery&&e.length&&o(e[0].getBoundingClientRect()))},scrollAdjust:function(e,t,n,i){if(this.editor.sourceView&&this.editor.sourceView.inSourceMode)this.editor.sourceView.scrollAdjust();else if(!this.editor.isScrolling()||this.nativeScrollLocked){if(File.isTypeWriterMode&&!i)return this.typeWriterScroll(e);n&&(n="number"==(i=typeof n)||"string"==i&&!window.isNaN(+n)?+n:70);try{var r,o,a=window.innerHeight,s=document.querySelector("content").scrollTop,l=this.editor,c=e&&e.jquery&&e.closest("[mdtype='heading']").toArray();if(e&&e.jquery){if(!e.length)return;u=e.offset().top+s}else if(e&&e.closest){var d,u,h=e.closest(".md-diagram, .md-math-block"),p=e.getBoundingClientRect();a-160<(d=(h?h.getBoundingClientRect().bottom-40:p.top)+s)+40-(u=p.top+s)&&(d=p.bottom+s)}else if(e&&void 0!==e.startContainer)u=(e.nativeRange||e).getClientRects()[0].top+s;else{var f=document.activeElement.closest&&document.activeElement.closest(".CodeMirror-focused");if((f=f&&f.querySelector(".CodeMirror-selected"))&&f.length)return this.scrollAdjust(f);if(r=window.getSelection().getRangeAt(0),r=!document.activeElement||"VIDEO"!=document.activeElement.tagName&&"IMG"!=document.activeElement.tagName&&"IFRAME"!=document.activeElement.tagName?r:null)if((o=r.getBoundingClientRect())&&o.height)u=o.top+s;else{var m=r.endContainer;if(m.nodeType===document.TEXT_NODE)void 0===(o=m.parentElement.getClientRects()[0])&&(d=(o=m.parentElement.closest("[cid]").getClientRects()[0]).bottom+s),u=o.top+s;else if((u=void 0)===(u=m!==this.editor.writingArea&&(o=m.getClientRects()[0]).height<50?o.top+s:u))return}else u=E(document.activeElement).offset().top}d=d||u;var g=30;File.inBusyMode||(g=(File.isNodeHtml?E("#top-titlebar").height():document.body.classList.contains("mac-seamless-mode")?30:0)+(E(".on-search-panel-open #md-searchpanel").height()||0)),null!=t?File.inBusyMode||File._onInitParse?(E("content")[0].scrollTop=u-t-g,l.library.outline.highlightVisibleHeaderWithDelay(c)):E("content").animate({scrollTop:u-t-g},"500","swing",function(){l.library.outline.highlightVisibleHeaderWithDelay(c)}):u<s+g?y(u-g-(n||140)):a+s-(n?70:140)<d?y(d-a+(n||140)):l.library.outline.highlightVisibleHeaderWithDelay()}catch(e){}}function y(e){File.inBusyMode?E("content")[0].scrollTop=e:E("content").scrollTop(e),l.library.outline.highlightVisibleHeaderWithDelay(),l.selection.lockNativeScroll()}},selectAllElem:function(e){if(!e[0]||"INPUT"!=e[0].tagName&&"TEXTAREA"!=e[0].tagName)if(this.editor.sourceView.inSourceMode)this.editor.sourceView.cm.execCommand("selectAll");else{if(E("body").hasClass("typora-sourceview-on"))return this.editor.sourceView.cm.execCommand("selectAll");editor.needRemoveMathAfterSym=!0,e.find(".math-jax-postprocess>.md-math-after-sym").text("​");var t=B.createRange();if(e.children().length)t.setStart(e.children()[0]),t.setEndAfter(e.children()[e.children().length-1]);else{if(!e.length)return;t.selectNode(e[0])}this.deRange(t,!0)}else e[0].select()},selectAll:function(e){if(this.editor.sourceView.inSourceMode)this.editor.sourceView.cm.execCommand("selectAll");else if(File.inBusyMode&&!File.isLocked&&this.editor.writingArea.setAttribute("contenteditable","true"),editor.needRemoveMathAfterSym=!0,E(".math-jax-postprocess>.md-math-after-sym").text("​"),document.activeElement&&O.isType(document.activeElement.tagName,"INPUT","TEXTAREA"))document.activeElement.select();else{var t=this.editor.getMarkElem(),n=B.createRange();if(t.hasClass("rawedit"))e||(n.selectNode(t[0]),this.setRange(n));else{if(e&&O.isType(e.target.tagName,"INPUT","TEXTAREA"))return e.target.select(),!0;if(isInputComponent(e&&e.target||document.activeElement))return this.selectAllElem(E(e&&e.target||document.activeElement)),!1;t.find(".CodeMirror").length?t.find(".CodeMirror")[0].CodeMirror.execCommand("selectAll"):t.closest('[mdtype="table"]').length?(this.selectAllElem(t.closest("[mdtype='table_cell']")),e&&e.preventDefault()):t.closest(".md-meta-block").length?(this.selectAllElem(t.closest("[mdtype='meta_block']")),e&&e.preventDefault()):(E(this.editor.sessionStr).addClass("md-expand"),E(".footnotes, .md-fences, .hr, .md-rawblock").attr("contenteditable",!0),n.setStart(E(this.editor.sessionStr).children()[0]),E(this.editor.sessionStr).children()[0].classList.contains("md-hr")&&n.setStart(E(this.editor.sessionStr).children()[1]),n.setEndAfter(E(this.editor.sessionStr).children().last()[0]),E(this.editor.sessionStr).removeClass("md-expand"),n=this.deRange(n),this.fixSafariRange(n),this.setRange(n),e&&e.preventDefault(),File.isMac&&setTimeout(function(){E(".footnotes, .md-fences, .hr, .md-rawblock").prop("contenteditable",!1)},10))}this.editor.lastCursor=this.buildUndo()}},getEndNode:function(e){return this.getDetailPos(e.endContainer,e.endOffset)[0]},getDetailPos:function(e,t,n){var i={};function r(e){1===e.nodeType&&0===e.childNodes.length&&e.appendChild(document.createTextNode(""))}function o(e){if(r(e),e.childNodes.length)return e.childNodes.length;if(3===e.nodeType)return e.textContent.length;if(void 0!==e.length)return e.length;throw i}if(e.parentElement&&e.parentElement.classList.contains("md-def-split"))return 0==t?this.getDetailPos(e.parentElement.previousElementSibling,e.parentElement.previousElementSibling.textContent.length,n):this.getDetailPos(e.parentElement.nextElementSibling,0,n);if(1==e.nodeType){var a=e.childNodes;if(e.classList.contains("md-image")&&2===t&&(t=1),e.tagName=="mjx-assistive-mml".toUpperCase()){if(!n)return this.getDetailPos(e.parentElement.parentElement.parentElement,e.parentElement.parentElement.parentElement.childElementCount)}else if(e.tagName=="mjx-container".toUpperCase())return 0==t?this.getDetailPos(e.parentElement.parentElement,0):this.getDetailPos(e.parentElement.parentElement,e.parentElement.parentElement.childElementCount);if(r(e),!a||!a.length||e.classList&&e.classList.contains("md-fences"))return[e,t];try{var s=a[t]&&a[t].getAttribute&&"checkbox"===a[t].getAttribute("type");return n?(s&&t++,t==a.length?this.getDetailPos(a[t-1],o(a[t-1])):this.getDetailPos(a[t],0,!0)):0==t?(s&&t++,this.getDetailPos(a[t],0)):this.getDetailPos(a[t-1],o(a[t-1]))}catch(e){}}return[e,t]},fixSafariRange:function(e){var t,n,i;File.isSafari&&((t=E(e.startContainer).closest(".md-meta, .md-content")).length&&0==e.startOffset&&(i=(n=t.closest("[contenteditable='true'], [cid]")).children()[0])&&e.setStart(i,0),(t=E(e.endContainer).closest(".md-meta, .md-content")).length)&&(i=(n=(n=t.closest("[contenteditable='true'], [cid]")).hasClass("md-meta")?n.parent().closest("[contenteditable='true'], [cid]"):n).children().last()[0])&&e.setEndAfter(i)},deRange:function(e,t,n){var i=n||e.cloneRange();try{var r=e.isBackward,o=this.getDetailPos(e.startContainer,e.startOffset,!0),a=this.getDetailPos(e.endContainer,e.endOffset,!1);return(t&&o[0].parentElement&&"HR"==o[0].parentElement.tagName&&(o[0]=o[0].parentElement.parentElement),e.setStart.apply(e,o),e.setEnd.apply(e,a),e.isBackward=r,n&&n.equals(e))?n:(t&&this.setRange(e,!0),e)}catch(e){}return i},selectBlock:function(){this._selectLine("block")},selectLine:function(){return this._selectLine(!1)},selectLineWrap:function(){this._selectLine("line")},_selectLine:function(e){if(this.editor.sourceView.inSourceMode)n=(t=this.editor.sourceView.cm).getCursor(!0),t.setSelection(o.Pos(n.line,0),o.Pos(n.line,t.getLine(n.line).length));else{var t,n,i,r=E(document.activeElement).closest(".CodeMirror");if(r.length)n=(t=r[0].CodeMirror).getCursor(!0),"block"==e?t.execCommand("selectAll"):t.setSelection(o.Pos(n.line,0),o.Pos(n.line,t.getLine(n.line).length));else{if(!document.activeElement||!O.isType(document.activeElement.tagName,"INPUT"))return(r=window.getSelection()).rangeCount&&(t=this.editor.getMarkElem(r.commonAncestorContainer),n=B.createRange(),t.rawText().length)&&t.length?"block"==e?(t.closest('[mdtype="table"]').length&&(t=t.closest('[mdtype="table"]')),this.selectAllElem(t),t):t.closest("tr[mdtype='table_row']").length?(i=t.closest("tr[mdtype='table_row']"),n.selectNode(i[0]),i.closest('[mdtype="table"]').attr("contenteditable",!0),this.deRange(n,!0),void i.closest('[mdtype="table"]').attr("contenteditable",!1)):(t.addClass("md-expand-on-selection"),r=window.getSelection(),(n=this.getRangy()).getBookmark(t[0]).start&&r.modify("move","backward",e?"paragraphboundary":"sentence"),r.modify("extend","forward",e?"paragraphboundary":"sentence"),n=this.getRangy(),(i=E(n.commonAncestorContainer).closest(".md-meta")).length?this.selectAllElem(i.closest("[md-inline]")):(i=this.editor.getMarkElem(n.startContainer)).length&&i[0]!==this.editor.getMarkElem(n.endContainer)[0]&&(n.setEndAfter(i[0]),this.deRange(n,!0)),t.removeClass("md-expand-on-selection"),t):void 0;document.activeElement.select()}}},fixTripleClick:function(e){e=this.editor.getMarkElem(e.target);e.attr("mdtype")==R.TYPE.table_cell?this.selectAllElem(e):this.selectLineWrap()},fixDblClick:function(r){var e=this,o=this.editor,a=this.getRangy();if(!function(){var e=E(r.target).closest("[md-inline='image'],[md-inline='imgtag']");if(e.length){if("image"!=e.attr("md-inline"))return"IMG"==r.target.tagName&&(o.selection.selectAllElem(e),1);var t=E(r.target);if((t=t.hasClass("md-image-src-span")?t:t.closest(".md-image-src-span")).length){if(a){var n=(t.text().match(/\s['"]/)||{}).index;if(a.setStart(t[0],0),n){if(a.endOffset>n)return 1;a.setEnd(t[0].childNodes[0],n)}else a.setEnd(t[0],1);return o.selection.setRange(a),1}}else t=E(r.target).closest(".md-image-before-src");if(t.length&&a){var n=t.text(),i=n.indexOf("]")+2;if(a.startOffset>i)return a.setStart(t[0].childNodes[0],i),a.setEnd(t[0].childNodes[0],n.length-1),a.select(a.isBackward),1;if(2<=a.startOffset&&a.endOffset>a.startOffset&&a.endOffset<i-1)return a.setStart(t[0].childNodes[0],2),a.setEnd(t[0].childNodes[0],i-2),a.select(a.isBackward),1}return o.selection.selectAllElem(e),1}}()){if(a&&a.endContainer&&3==a.endContainer.nodeType&&1==a.endOffset){var t=a.endContainer,n=t.textContent.substring(0,1);if(/\s/.exec(n)){var i=c(t.parentElement);if(i){for(var s=d(i),l=!1;s;)a.containsNode(s)&&!s.offsetWidth&&(l=!0,a.setEndBefore(s)),s=(i=c(i))&&d(i);l&&e.setRange(a)}}}function c(e){for(var t=e.previousElementSibling;!t&&!(e=e.parentElement).getAttribute("cid")&&e;)t=e.previousElementSibling;return t}function d(e){if(e.classList.contains("md-meta"))return e;for(;e;){if(!e.children)return null;if((e=e.children[e.children.length-1])&&e.classList&&e.classList.contains("md-meta"))return e}return null}}},selectWord:function(e,t,n,i,r){if(this.editor.sourceView.inSourceMode)l=(s=this.editor.sourceView.cm).findWordAt(s.getCursor()),i||s.extendSelection(l.anchor,l.head);else{this.selectWordTime=new Date;var o=E(document.activeElement).closest(".CodeMirror");if(o.length)l=(s=o[0].CodeMirror).findWordAt(s.getCursor()),i||s.extendSelection(l.anchor,l.head);else if(n=n||this.getRangy()){o=null;if(e&&(o=E(n.startContainer).closest(".md-meta, .md-content")).length)return n.selectNode(o.closest("[md-inline]")[0]),i||this.setRange(n),n;if((o=E(n.startContainer).closest(".md-content, [md-inline='url'], [md-inline='emoji'], [md-inline='escape']")).length)return n.selectNode(o.closest("[md-inline]")[0]),i||this.setRange(n,!0),n;if((o=(o=E(n.startContainer).closest("[md-inline]")).length?o:E(n.startContainer).closest("[cid]")).length){var a=n.getBookmark(o[0]).start,s=o.rawText(),l=s.split(r?b.WESTERN_WORD_SPLITTER_SPELLCHECKER:w).filter(function(e){return!!e}),c=/[\u3040-\uABFF\uD7A4-\uFAFF]/,d=/[a-zA-Z\u00C0-\u00ff]/,u=/[0-9a-zA-Z\u00C0-\u00ff]/,h=/^['’‚‛]$/,p=[],f=null;if(l.forEach(function(e){if(c.test(e))f?f+=e:f=e;else{if(f)p.push(f);else{var t=p.length;if(h.exec(p[t-1]||"")){if(d.exec(e)&&d.exec(p[t-2]||""))return void(p[t-2]=p[t-2]+p.pop()+e)}else if("."==p[t-1]&&u.exec(e)&&u.exec(p[t-2]||""))return void(p[t-2]=p[t-2]+p.pop()+e)}p.push(e),f=null}}),f&&p.push(f),p.length){for(var r=0,l=s.length,m=0,g=0,y=!1,g=0;g<p.length;g++){var v=p[g].length;if(a<=m+v){y=m+v==a;break}m+=v}if(p.length-1<=g){if(r=(l=s.length)-p.last().length,e&&b.NOT_WORD.exec(p.last()))return}else if(y&&!b.NOT_WORD.exec(p[g+1]))l=(r=m+p[g].length)+p[1+g].length,t&&/\s/.exec(p[g+2]||"a")&&(l+=1);else if(b.NOT_WORD.exec(p[g])){if(e)return;l=(r=m+p[g].length)+p[1+g].length}else l=(r=m)+p[g].length,t&&/\s/.exec(p[g+1]||"a")&&(l+=1);return n.moveToBookmark({containerNode:o[0],start:r,end:l}),i||(this.setRange(n,!0),this.editor.wordCount.updateInSelection()),n}}}}},selectPhrase:function(){if(this.editor.sourceView.inSourceMode)e=(i=this.editor.sourceView.cm).findWordAt(i.getCursor()),i.extendSelection(e.anchor,e.head);else if(document.activeElement&&O.isType(document.activeElement.tagName,"INPUT"))document.activeElement.select();else{var e=E(document.activeElement).closest(".CodeMirror");if(e.length)(i=e[0].CodeMirror).execCommand("selectAll");else{var t,n,e=this.getRangy(!0),i=!1;if(e){if(this.editor.styleBookmark.style){var r=this.editor.styleBookmark.style.block;if(-1<r.indexOf(I.def_footnote)||-1<r.indexOf(I.def_link)?/md-def-(name|url|title)|/gi.exec(document.activeElement.className)&&(i=!0,t=E(e.startContainer).closest(".md-def-name, .md-def-url, .md-def-title")[0]):-1<r.indexOf(I.table)&&(i=!0,t=E(e.startContainer).closest("[mdtype='table_cell']")[0]),t=t||function e(t){return t?t.nodeType===t.ELEMENT_NODE?t.hasAttribute("md-inline")&&t.getAttribute("md-inline")!==I.plain||t.hasAttribute("mdtype")||t.classList.contains("md-def-name")||t.classList.contains("md-def-content")||t.classList.contains("md-def-title")?t:e(t.parentElement):t.nodeType===t.TEXT_NODE?e(t.parentElement):null:null}(e.startContainer))return r=e,i=i,(n=t).getAttribute("md-inline")==I.image&&(i=!1,n=n.children[0]),i?r.selectNodeContents(n):(r.selectNode(n),editor.selection.deRange(r)),this.setRange(e,!0)}return this.selectWord()}}}},isCrossBlock:function(e){return(e=e||this.getRangy())&&!e.collapsed&&this.editor.getJQueryElem(e.commonAncestorContainer).find("[mdtype]").length},handleMouseSelection:function(e){"false"!=this.editor.writingArea.getAttribute("contenteditable")||this.getBlockFromMouseEvent(e).closest(".md-focus").length||this.editor.writingArea.setAttribute("contenteditable","true")},getBlockFromMouseEvent:function(e){var t=e.target;return this.editor.writingArea.contains(e.target)||(t=document.elementFromPoint(e.clientX,e.clientY)),E(t).closest("[cid]")},getTextAround:function(){var e,t,n=this.getRangy();if(n&&n.collapsed){var i,r=E(n.startContainer).closest("[md-inline='plain'], .md-lang")[0];if(r)return i=n.getBookmark(r),n.setStartBefore(r),e=n.toString(),n.collapse(!1),n.setEndAfter(r),t=n.toString(),n.setStart(r,0),[e,t,i]}return[]},getTextInSelection:function(e){var t=E(document.activeElement).closest(".CodeMirror");return t.length?t[0].CodeMirror.getSelection():(e=e||this.getRangy())&&!e.collapsed&&E(e.commonAncestorContainer).closest("#write").length?E(E.parseHTML("<div>"+e.toHtml()+"</div>")).find("[mdtype]").after("\n").filter(".md-toc").text("[toc]").end().filter(".md-math-block").text(function(){return E(this).find("script").html()}).end().find(".CodeMirror-gutter-wrapper").remove().end().end().text():""},extendRange:function(e,t){if(e.commonAncestorContainer.nodeType===document.TEXT_NODE){if(0<t&&e.endOffset+t<=e.commonAncestorContainer.length)return e.setEnd(e.commonAncestorContainer,e.endOffset+t),e;if(t<0&&0<=e.startOffset+t)return e.setStart(e.commonAncestorContainer,e.startOffset+t),e}var n=E(e.startContainer).closest("[cid]")[0],n=e.getBookmark(n);return n.containerNode&&(0<t?n.end+=t:n.start+=t,e.moveToBookmark(n)),e},createRange:function(e,t,n,i){var r=B.createRange();return r.setStart(e,t),r.setEnd(n,i),r.startContainer?r:null},moveToSelectable:function(e,t){return N(this.editor,e,t)},includeTrailMeta:function(r){var e,t;return r&&!r.collapsed&&(0==r.startOffset&&(t=o(r.startContainer,!0))&&(e=!0,r.setStart(t,0)),(r.endContainer.childNodes&&r.endOffset==r.endContainer.childNodes.length||r.endContainer.nodeType==document.TEXT_NODE&&r.endOffset==r.endContainer.nodeValue.length)&&(t=o(r.endContainer,!1))&&(e=!0,r.setEnd(t,t.childNodes.length)),e)&&this.setRange(r,!0),r;function o(e,t,n){var i=t?e.previousElementSibling:e.nextElementSibling;return e==r.commonAncestorContainer||e.parentElement==r.commonAncestorContainer||!e.parentElement||e.getAttribute&&e.getAttribute("cid")?n:(i&&i.classList&&i.classList.contains("md-meta")&&!E(i.parentElement).closest(".md-expand").length&&(n=i),o(e.parentElement,t,n))}}};var _=function(e){e&&(e.codemirrorIgnore=!0,e.preventDefault(),e.stopPropagation())},A=function(e,t){return O.isType(e,O.TYPE.hr,O.TYPE.toc)&&(!t||"write"!==t.attr("id")&&t[0].hasAttribute("tabindex"))},M=function(e){var t=e[0];return 0<t.childElementCount&&function(){for(var e=0;e<t.childElementCount;e++)if(t.children[0].getAttribute("md-inline")!==I.image)return!1;return!0}()},l=function(e,t,n){var i;if(t.getAttribute("mdtype")===I.fences&&(i=e.fences.getCm(t.getAttribute("cid"))),t.getAttribute("mdtype")===I.math_block&&(i=e.mathBlock.startEditing(E(t))),i=t.getAttribute("mdtype")===I.html_block?e.htmlBlock.startEditing(E(t)):i)return i.then?i.then(e=>{e.focus(),e.setCursor(n)}):(i.focus(),i.setCursor(n)),!0},L=function(e,t){var n;null!=t&&((n=e.cursorCoords(e.getCursor())).left=n.right=t,t=e.coordsChar(n),e.setCursor(t))},N=function(e,t,n,i,r,o){var a,s;return!(!n||(a=e.findElemById(n.id),e.lastCursor=e.selection.buildUndo(),r=!r,O.isType(n,I.fences)?((s=e.fences.getCm(n.id)).focus(),t?(a.find(".ty-input-after").focus(),setTimeout(function(){File.isTypeWriterMode&&File.option.scrollWithCursor&&e.selection.typeWriterScroll(a.find(".ty-input-after"))},0)):(s.execCommand("goDocStart"),L(s,o)),_(i),0):O.isType(n,I.math_block)?(t?(s=e.mathBlock.startEditing(a,!n.get("tagAfter")&&"end",r),n.get("tagAfter")?setTimeout(function(){e.selection.selectAllElem(a.find(".ty-input-after").focus())},0):L(s,o)):(s=e.mathBlock.startEditing(a,!n.get("tagBefore")&&"start",r),n.get("tagBefore")?setTimeout(function(){e.selection.selectAllElem(a.find(".ty-input-before").focus())},0):L(s,o)),_(i),0):O.isType(n,I.html_block)?(s=e.htmlBlock.startEditing(a,t?"end":"start",r),L(s,o),_(i),0):!A(n)||(_(i),window.getSelection().removeAllRanges(),e.findElemById(n.id).focus(),e.refocus(),0)))},c=function(e){return e.collapsed&&e.startContainer&&e.startContainer.nodeType==document.TEXT_NODE&&"\n"==e.startContainer.textContent&&(e.startContainer.nextSibling||{}.classList)&&e.startContainer.nextSibling.classList.contains("md-emptyline")},D=function(e,t){if(c(e))return e.startContainer.nextSibling.getBoundingClientRect();var n=e.getClientRects(),i=1==n.length&&n[n.length-1];if(1<n.length){if(t)return!1;i=e.getBoundingClientRect()}return!i&&e.collapsed&&(!(n=e.startContainer.nodeType==document.TEXT_NODE?e.startContainer.parentElement:e.startContainer)||"write"==n.getAttribute("id")||150<(i=n.getBoundingClientRect()).height)?null:i};n.exports=i,n.exports.buildRange=function(e,o,a){if(!e)return window.getSelection().removeAllRanges();var s=0,l=B.createRange(),c=!1,d={};l.collapseToPoint(e,0);try{!function e(t){if(3==t.nodeType){var n=s+t.textContent.length;if(!c&&s<=o&&o<=n&&(l.setStart(t,o-s),c=!0),c&&s<=a&&a<=n)throw l.setEnd(t,a-s),d;s=n}else for(var i=0,r=t.childNodes.length;i<r;++i)e(t.childNodes[i])}(e)}catch(e){if(e==d)return l;throw e}},n.exports.rangy=B}),$__System.registerDynamic("41",["11","13","e","19","31","32","1b","34","30"],!0,function(e,t,n){"use strict";this||self;var c=e("11"),o=e("13"),a=o.Node,i=o.TYPE,d=e("e"),r=e("19"),s=(e("31").rangy,e("32")),u=e("1b"),l=e("34"),h=e("30");class p{constructor(){this.reset(),Object.defineProperty(this,"length",{get:function(){return this._set.length}})}get(e){return this._map.get(e)}add(e){e.cid&&this._map.set(e.cid,e),this._set.push(e)}push(e){this.add(e)}remove(e){var t;e.cid&&(t=this._map.get(e.cid),this._map.delete(e.cid),t)&&this._set.remove(t),this._set.remove(e)}reset(){this._set=[],this._map=new Map}forEach(e,t){this._set.clone().forEach(e,t)}indexOf(e){for(var t=0,n=this.sortedFirst();n;){if(e==n)return t;n=n.get("after"),t++}return-1}getNodeByRef(e){for(var t of this._set)if(c.escape(t.get("ref")).toLowerCase()==c.escape(e).toLowerCase())return t}getFootHTMLByRef(e,t){e=this.getNodeByRef(e);return e?(t&&File.editor.store(e.cid,!0),"<div class='code-tooltip md-tooltip-remove md-hover-tip md-f-tooltip' contenteditable='false'><div class='md-arrow' /><div class='code-tooltip-content'>"+editor.brush.inline.output(e.get("text"))+"</div></div>"):null}getHrefByRef(e,t,n){e=this.getNodeByRef(e),e&&t&&File.editor.store(e.cid,!0),t=e?e.get("href"):void 0;return n?t:t?c.escape(t):void 0}}var f,m=function(e){switch(e.type){case i.strong:return"<strong>"+e.inner+"</strong>";case i.em:return"<em>"+e.inner+"</em>";case i.code:return"<code>"+c.escape(e.text)+"</code>";case i.plain:return c.escape(e.text);case i.tag:return"";case i.imgtag:case i.refimg:case i.image:return"";case i.inline_math:return h.decorateAsExport(e,{forPrint:!0});case i.underline:return"<u>"+e.inner+"</u>";case i.del:return"<del>"+e.inner+"</del>";case i.footnote:return"";case i.escape:return c.escape(e.text);case i.highlight:return"<mark>"+e.inner+"</mark>";case i.superscript:return"<sup>"+e.inner+"</sup>";case i.subscript:return"<sub>"+e.inner+"</sub>";case i.linebreak:return"";case i.tab:return"<span>"+e.inner+"</span>";default:return e.inner||c.escape(e.text||"")}};function g(){return f=f||new r.InlineLexer(null,m)}class y{constructor(e){this.nodeMap=e,this.refresh(),this.delay=300,this.refreshTimeout=null}remove(e){e=this.headers.indexOf(e);-1<e&&this.headers.splice(e,1)}updateHeaderText(e){var t;this.refreshTimeout||File._onInitPars||!this.headers||-1!=this.headers.indexOf(e)&&(t=f.output(e.get("text")),d(".md-toc-item[data-ref='"+e.cid+"']").children(".md-toc-inner").html(t),d("#outline-content .outline-label[data-ref='"+e.cid+"']").html(t),window.File)&&File.editor&&File.editor.mathInline&&File.editor.mathInline.renderInToc()}refresh(e,t){var n;function i(){var e=this.nodeMap.getFirst();for(this.headers=[];e;)(a.isType(e,a.TYPE.heading)||File.option.expandSimpleBlock&&a.isType(e,a.TYPE.paragraph)&&e.get("depth"))&&this.headers.push(e),e=e.get("after");t||this.updateHTML(),this.refreshTimeout=null}File._onInitParse||((n=this).refreshTimeout&&clearTimeout(this.refreshTimeout),this.refreshTimeout=null,e?i.call(n):this.refreshTimeout=setTimeout(function(){i.call(n)},this.delay))}getTocInnerHTML(){var n="";return(this.headers||[]).map(function(e){var t;e.isDeleted()||(n+=(t=(e=e).get("text"),a.isType(e,a.TYPE.paragraph)&&(t=e.getText().replace(/(^#+\s*)|(#+\s*$)|\n.*/,"")),"<span role='listitem' class='md-toc-item md-toc-h"+e.get("depth")+"' data-ref='"+e.cid+"'><a class='md-toc-inner'>"+f.output(t)+"</a></span>"))}),n}updateHTML(e){var t=0,n=document.querySelectorAll(".md-toc-content");if(0<n.length)for(var i=this.getTocInnerHTML(),t=0;t<n.length;t++)n[t].innerHTML!=i&&(n[t].innerHTML=i);File.editor.library&&File.editor.library.outline.updateOutlineHtml(this,e),File.editor.mathInline&&File.editor.mathInline.renderInToc(),File.editor.tryEnterBusyModeWithDelay()}}class v{constructor(e){var t,n,i,r=this;function o(){t=!1,setTimeout(function(){t||d(".md-f-tooltip").remove()},500)}g(),this.expandedOutlineItem=[],e.nodeMap.foot_list=new p,e.nodeMap.link_list=new p,e.nodeMap.toc=new y(e.nodeMap),this.editor=e,i=r.editor,setTimeout(function(){d(document).on("mouseenter mousemove",".md-footnote",function(){t&&n===i.focusCid||window.getSelection().anchorNode&&this.contains(window.getSelection().anchorNode.parentElement)||(t=!0,n=i.focusCid,r.showTooltipForSup(d(this)))}).on("mouseleave",".md-footnote",o).on("mouseenter",".md-f-tooltip",function(){t=!0}).on("mouseleave",".md-f-tooltip",o)},300),this.registerBridge()}registerBridge(){var n;File.isMac&&(n=this,bridge.registerHandler("docMenu.getLocalRootUrl",function(e,t){t(n.getLocalRootUrl()||"")}),bridge.registerHandler("docMenu.removeProperty",function(e,t){n.removeProperty(e),t&&t()}))}getAttrByElem(e){return e.hasClass("md-def-name")?"ref":e.hasClass("md-def-content")?e.hasClass("md-def-url")?"href":"text":e.hasClass("md-def-title")?"title":void 0}addEmptyDef(i,r){var o=this.editor;function e(e){var t=o.findNodeByElem(e),n=o.undo.UndoManager.makeEmptyCommand();t.addAfter(new a({type:r,ref:i,url:"",text:""})),o.undo.UndoManager.addUndoForInsert(n,t.get("after")),e.after(t.get("after").toHTML()),o.selection.jumpIntoElemBegin(e.next().find(".md-def-content")),n.redo.push(o.selection.buildUndo()),o.undo.register(n),o.refocus()}o.undo.endSnap(!0);var t=d(o.sessionStr).find(r==a.TYPE.def_link?".md-def-link":".md-def-footnote").last();!t.length||t.nextAll(":not(.footnotes)").length?e(d(o.sessionStr).children().last()):e(t)}jumpToFootnote(e,t){this.editor.undo.endSnap(!0);var n=e.find(".md-def-name").text()||"",n=d(".md-footnote[data-ref='"+c.escape(n.trim()).toLowerCase()+"']")[t];n&&((t=this.editor.selection).jumpIntoElemEnd(e),e=u.makeEmptyCommand(t.buildUndo()),t.jumpInto(d(n),0),t.scrollAdjust(void 0,100),e.redo.push(t.buildUndo()),e.cursorOnly=!0,this.editor.undo.register(e),this.editor.refocus())}jumpToFootnoteDef(e){var t,n,i=this.editor;i.undo.endSnap(!0),e.length&&(t=e.find(".md-text").text()||"",(t=i.nodeMap.foot_list.getNodeByRef(t,!0))?(i.selection.jumpIntoElemEnd(e),n=u.makeEmptyCommand(i.selection.buildUndo()),i.selection.jumpIntoElemEnd(i.findElemById(t.cid)),i.selection.scrollAdjust(void 0,100),n.redo.push(i.selection.buildUndo()),n.cursorOnly=!0,i.undo.register(n),i.refocus()):this.showTooltipForSup(e))}refreshFootnoteReverseLink(e){if(!File.inBusyMode)try{if(!e||e.querySelector(".md-footnote, .md-def-footnote")){for(var s=this.editor,t=document.querySelectorAll("#write .md-footnote"),l={},n=0;n<t.length;n++){var i=(t[n].getAttribute("data-ref")||"").trim();l[i]=(l[i]||0)+1}s.nodeMap.foot_list.forEach(e=>{var t=l[c.escape((e.get("ref")||"").trim()).toLowerCase()]||0,e=s.findElemById(e.cid);if(e.length&&e.hasClass("md-def-footnote")){for(var n=e.find(".md-reverse-footnote-area"),i=n.html()||"",r="",o=d.localize.getString("back to document","Front"),a=0;a<t;a++)r+=" <a class='reversefootnote' title='"+o+"' data-index='"+a+"'>↩</a>";r&&!n.length?e.find(".md-def-content").after("<span class='md-reverse-footnote-area' contenteditable='false'>"+r+"</span>"):n.length&&!r?n.remove():i.replace(/[\s'"]/g,"")!=r.replace(/[\s'"]/g,"")&&n.html(r)}})}}catch(e){console.sendError(e)}}showTooltipForSup(e){var t,n,i,r=this.editor;e.length&&(n=e.find(".md-text").text(),i=r.nodeMap.foot_list.getFootHTMLByRef(n,!0),d(".md-tooltip-remove").remove(),i?(t=d(d.parseHTML(i)[0]),d("body").append(t)):File.isLocked||(i="<div class='code-tooltip md-tooltip-remove md-hover-tip md-f-tooltip' contenteditable='false'><div class='md-arrow' /><div class='code-tooltip-content'><span class='fa text-warning fa-exclamation-triangle' title='warning' aria-hidden='true' /> "+d.localize.getString("Need to define the reference footnote <b>{0}</b> with syntax <a>[^{1}]: www.example.com</a>").format(n,n).trim()+" </div></div>",t=d(d.parseHTML(i)[0]),d("body").append(t),t.find(".code-tooltip-content a").unbind("click").click(function(){r.docMenu.addEmptyDef(n,o.TYPE.def_footnote)})),this.editor.EditHelper.fixPopoverPosition(e,t))}getLocalRootUrl(e){var t,n;return File.isTextBundle()?File.bundle.filePath?s.getCurrentFilePath():l.assetsParentForUntitled():File.isTextPack()?File.bundle.unzipFolder||"":(t=null,(n=this.getMetaNode())&&(t=(/^\s*typora-root-url\s*:\s*(.*)$/im.exec(n.get("text"))||[])[1]),(t=t||e||!this.editor.localSettingBridge?t:this.editor.localSettingBridge.getSetting("typora-root-url")||null)?(n=s.getCurrentFilePath(),!c.isAbsolutePath(t)&&n?c.getAbsolutePath(n,t):t):null)}buildMetaMap(){var e=this.getMetaNode(),u=/^\s*([^\s\[\{:]+)\s*:\s*(.*)$/,h=/^\s*(\"([^"]+)\"|\'([^']+)\')\s*:\s*(.*)/,p=/^\s*#/,t={};function f(e){var t;if(t=e.match(/^\s*\[(.*)\]\s*$/))return t[1].split(/\s*,\s*/).map(f);if(t=e.match(/^\s*\{(.*)\}\s*$/)){var n={};if(t[1].split(/\s*,\s*/).forEach(e=>{e=e.split(/\s*:\s*/);2==e.length&&(n[e[0]]=e[1])}),Object.keys(n).length)return n}return/^"/.exec(e)?e.replace(/^"/,"").replace(/"$/,"").replace(/\n\n/g,"\n").replace(/\\\n/g,"").replace(/\n/g," ").replace(/\\n/g,"\n"):/^'/.exec(e)?e.replace(/^'/,"").replace(/'$/,"").replace(/\n\n/g,"\n").replace(/''/g,"'").replace(/\n/g," "):e.trim()}function m(e,t,n){for(var i=[];t<e.length;){var r=e[t];if(0!=r.indexOf(n)&&r.trim().length)break;i.push(r.substr(n.length)),t++}return[i,t]}if(e){if("string"==typeof(t=function e(t){for(var n,i,r=0,o={},a=!1;r<t.length;r++){var s,l,c,d=t[r];d.match(p)||(!a&&(i=/^\s+/.exec(d))?(l=i[0],s="",(i=/^\s*([\|\>])\s*$/.exec(o[n]||""))&&(s=i[1]),(c=m(t,r,l))[1]-1>r&&(r=c[1]-1),o[n=n||""]="|"==s?c[0].join("\n"):">"==s?c[0].map(e=>e.trim()?e.trim()+" ":"\n").join("").trim():e(c[0])):(i=/^[-+]\s/.exec(d))?(a=!1,(c=m(t,r+1,l=i[0].replace(/^[-+]/," ")))[1]-1>r&&(r=c[1]-1),o[n=n||""]=o[n]||[],o[n].push&&o[n].push(e([d.substr(l.length)].concat(c[0])))):(i=h.exec(d))?(a=!1,n=i[2]||i[3]||"",o[n]=i[4].trim(),(i=/^["']/.exec(o[n]))&&o[n][o[n].length-1]!=i[0]&&(a=i[0])):(i=u.exec(d))?(a=!1,n=i[1],o[n]=i[2].trim(),(i=/^["']/.exec(o[n]))&&o[n][o[n].length-1]!=i[0]&&(a=i[0])):(n=n||"",d=d.trim(),o[n]?o[n]+="\n"+d:o[n]=d,d[d.length-1]==a&&(a=!1)))}return 1==Object.keys(o).length&&void 0!==o[""]?o[""]:(Object.keys(o).map(e=>{"string"==typeof o[e]&&(o[e]=f(o[e]))}),o)}((e.get("text")||"").split(/\r|\n|\r\n/g))))return{};if(t instanceof Array)return{};delete t[""]}return t}getMetaNode(){var e=this.editor.nodeMap.getFirst();return a.isType(e,i.meta_block)?e:null}getValueInMeta(e,t){return(t=t||this.getMetaNode())?(e=(new RegExp("^s*"+e+"s*:s*(.*)$","mi").exec(t.get("text"))||[])[1])&&e.trim():null}writeProperty(e,t){this.editor.undo.endSnap(!0);var n=this.editor.docMenu.getMetaNode(),i=this.editor.selection.buildUndo()||{},r=u.makeEmptyCommand(i),t=e+": "+t,o=n&&i&&(i.id||i.startId)==n.id,i=d.extend({},i),a=0;if(n){r.undo.push(u.buildReplaceUndo(n));var s=n.get("text"),l=b(e,s);l?(i.start>l.index+l[0].length?a=t.length-l[0].length:i.start>l.index&&(a=i.start-l.index+t.length),i.end=i.start=i.start-a,l=new RegExp("^s*"+e+"s*:s*(.*)$","mi"),n.set("text",s.replace(l,t))):n.set("text",s?s.replace(/\n?$/,"\n"+t):t),r.redo.push(u.buildReplaceUndo(n)),this.editor.findElemById(n.cid).replaceWith(n.toHTML()),o&&this.editor.undo.exeCommand(i)}else{a=this.editor.stylize.insertMetaBlock(!0,t);if(!a)return;n=a.node,u.append(r,a.command),this.editor.findElemById(n.get("after").cid).before(n.toHTML())}r.redo.push(i),this.editor.undo.register(r)}removeProperty(e,t){this.editor.undo.endSnap(!0);var n=this.editor.docMenu.getMetaNode(),i=this.editor.selection.buildUndo(),r=u.makeEmptyCommand(i),o=!!i&&(i.id||i.startId)==(n||{}).id,a=new RegExp("^s*"+e+"s*:s*(.*)$","mi"),i=d.extend({},i||void 0),s=0;return n&&(r.undo.push(u.buildReplaceUndo(n)),o&&(e=b(e,n.get("text")))&&(i.start>e.index+e[0].length?s=e[0].length:i.start>e.index&&(s=i.start-e.index),i.end=i.start=i.start-s),n.set("text",n.get("text").replace(a,"")),r.redo.push(u.buildReplaceUndo(n)),this.editor.findElemById(n.cid).replaceWith(n.toHTML()),r.redo.push(i),o&&this.editor.undo.exeCommand(i),t||this.editor.undo.register(r)),r}}function b(e,t){return new RegExp("^s*"+e+"s*:s*(.*)$","mig").exec(t)}v.getTocInlineLexer=g,n.exports=v}),$__System.registerDynamic("42",["11","e","1d","26","28","13","41"],!0,function(e,t,n){"use strict";this||self;function c(e){var r="",o=[];function t(e){for(var t,n=0;n<e.length;n++)if(!e[n].isDeleted()){t=e[n],r+="<li class='outline-item-wrapper outline-h"+t.get("depth")+"'><div class='outline-item'><span class='outline-expander'></span><span class='outline-label' data-ref='"+t.cid+"'>"+a.output(t.get("text"))+"</span></div><ul class='outline-children'>",o.push(t.get("depth"));var i=e[n+1]&&!e[n+1].isDeleted()?e[n+1].get("depth"):1;if(i<=e[n].get("depth"))for(;o.last()&&o.last()>=i;)r+="</ul></li>",o.pop()}}try{t(e.headers)}catch(e){window.debugMode&&console.warn(e.stack),r=""}return r}var a,r,o=e("11"),y=e("e"),s=e("1d"),l=(e("26").map,e("28")),i=e("13"),d=(i.Node,i.TYPE),u=e("41"),v=null;function h(e,t){for(var n=e.find(".outline-item-wrapper"),i=0;i<n.length;i++)n[i].querySelector(".outline-item-wrapper")?t&&n[i].classList.contains("outline-h1")&&n[i].classList.add("outline-item-open"):(n[i].classList.add("outline-item-signle"),n[i].classList.add("outline-item-single"))}n.exports=class{constructor(e){this.editor=e.editor,this.parent=e,this.headerStr="h1, h2, h3, h4, h5, h6, [mdlike='h1'], [mdlike='h2'], [mdlike='h3'], [mdlike='h4'], [mdlike='h5'], [mdlike='h6']",a=u.getTocInlineLexer(),this.bindEvents()}bindEventForSearch(){var t=this;y("#typora-sidebar").on("click","#close-outline-filter-btn",function(){t.hideSearch()}).on("input","#file-library-search-input",function(){var e;t.parent.isOutlineShown()&&(e=this.value,t.searchTimer&&clearTimeout(t.searchTimer),t.searchTimer=setTimeout(function(){t.search(e)}))})}bindEventForToc(){var t=this.editor;y(document).on("mousedown",".md-toc-inner",function(e){if(1===e.which)return e=this.parentElement.getAttribute("data-ref"),e=t.findElemById(e),t.store(),t.selection.jumpIntoElemEnd(e),t.selection.scrollAdjust(e,10),!1}).on("mousedown",".md-delete-toc",function(e){1===e.which&&t.UserOp.deleteSelectable(t,y(this).closest(".md-toc"))}).on("click","#md-notification .close-btn",function(e){document.body.classList.remove("ty-show-notification")}).on("click","#md-notification .ty-icon-close-btn",function(e){document.body.classList.remove("ty-show-notification")})}toggleSearch(){this.isShown_?this.hideSearch():this.showSearch()}expandAll(){y("#outline-content .outline-item-wrapper").addClass("outline-item-open")}collapseAll(){y("#outline-content .outline-item-wrapper").removeClass("outline-item-open")}useCollapsibleOutline(){JSBridge.putSetting("can_collapse_outline_panel",!0),File.setCanCollapsePinnedOutline(!0),y("#outline-content>.outline-item-wrapper").addClass("outline-item-open"),this.highlightVisibleHeader()}useFlatOutline(){JSBridge.putSetting("can_collapse_outline_panel",!1),File.setCanCollapsePinnedOutline(!1)}bindContext(){var r=this;y("#outline-menu").on("mousedown","[data-key]",function(e){var t=this.getAttribute("data-action");t&&1==e.which&&(y(".context-menu").removeClass("show").find(".active").removeClass("active"),setTimeout(function(){switch(t){case"highlight":r.highlightVisibleHeader(void 0,void 0,!0,!0);break;case"filter":r.toggleSearch();break;case"expand-all":return r.expandAll(),!1;case"collapse-all":return r.collapseAll(),!1;case"collapsible-outline":r.useCollapsibleOutline();break;case"flat-outline":return r.useFlatOutline(),!1;default:return}},0),r.editor.restoreLastCursor(null,!0))}),y("#outline-content").on("contextmenu",function(e){r.editor.lastCursor=r.editor.selection.buildUndo();var t=!document.body.classList.contains("no-collapse-outline"),n=(y("#write").blur(),y(".context-menu").removeClass("show").find(".active").removeClass("active"),y("#outline-menu").addClass("show")),t=(t&&!r.isShown_?(n.find("[data-action='flat-outline'] a").removeClass("state-on"),n.find("[data-action='collapsible-outline'] a").addClass("state-on"),n.find("[data-collapse]").show()):(n.find("[data-action='flat-outline'] a").addClass("state-on"),n.find("[data-action='collapsible-outline'] a").removeClass("state-on"),n.find("[data-collapse]").hide()),r.isShown_?(n.find("[data-action='filter'] a").addClass("state-on"),n.find("[data-view]").hide()):(n.find("[data-action='filter'] a").removeClass("state-on"),n.find("[data-view]").show()),n.height()+48),i=e.clientX>window.innerWidth-220?window.innerWidth-220:e.clientX,t=e.clientY>window.innerHeight-t?window.innerHeight-t:e.clientY-y("#top-titlebar").height()+8;return n.css({top:t+"px",left:i+"px"}),!1})}bindEventForOutline(){var n=this,i=this.editor;y(document).on("click",".outline-expander",function(e){var t=this.nextElementSibling.getAttribute("data-ref");return y(".outline-label[data-ref='"+t+"']").parent().parent().toggleClass("outline-item-open"),!1}).on("click",".outline-item",function(e){var t=this.querySelector(".outline-label").getAttribute("data-ref"),t=i.findElemById(t);return n.autoHideOutline(),i.focusAndRestorePos(),i.selection.scrollAdjust(t,10),File.isFocusMode&&i.updateFocusMode(!1),this.parentElement.classList.add("outline-item-open"),!1}).on("post-wheel","content",function(e){document.querySelector(".dropmenu.open")&&!File.editor.sourceView.inSourceMode&&n.highlightVisibleHeaderWithDelay()}).on("click","#close-outline-btn, #close-sidebar-btn",function(){return i.focusAndRestorePos(),n.hideOutline(),!1}).on("click","#pin-outline-btn",function(){return i.focusAndRestorePos(),i.library.showSidebar("outline"),!1}).on("click","#unpin-outline-btn",function(){return i.focusAndRestorePos(),i.library.hideSidebar(),n.showOutline(),!1}),document.querySelector("#sidebar-content").addEventListener("mousewheel",function(){v&&clearTimeout(v)},!!File.option.passiveEvents&&{passive:!0})}bindEvents(){this.bindEventForToc(),this.bindEventForOutline(),this.bindEventForSearch(),File.isNodeHtml&&this.bindContext()}showSearch(){var e,t;this.parent.isOutlineShown()&&(this.isShown_=!0,t=(e=y("#typora-sidebar")).find("#file-library-search-input"),e.hasClass("ty-show-outline-filter")||(t.attr("placeholder",y.localize.getString("Filter","Front")),File.isNodeHtml&&(t.css("width","calc(100% - 18px)"),e.find("#close-outline-filter-btn").show()),e.addClass("ty-show-outline-filter"),r!=t.val()&&t.val(""),t.val()?t.select():t.focus()))}hideSearch(){this.isShown_&&(this.isShown_=!1,this.searchTimer&&clearTimeout(this.searchTimer),y("#typora-sidebar").removeClass("ty-show-outline-filter"),this.clearSearch())}isSearchShown(){return this.isShown_}clearSearch(e){this.searchTimer&&clearTimeout(this.searchTimer),this.searchTimer=null;var t=y("#typora-sidebar");e||t.removeClass("ty-on-outline-filter"),t.find(".ty-outline-hit").replaceWith(function(){return this.innerHTML}),t.find(".outline-item.select").removeClass("select"),document.querySelectorAll("#outline-content .outline-label").forEach(function(e){e.parentElement.classList.remove("ty-outline-miss")})}search(e){var t,i;(r=e).trim().length?(this.clearSearch(!0),t=document.querySelector("#outline-content"),i=new RegExp(o.escapeRegExp(e),"i"),t.querySelectorAll(".outline-label").forEach(function(e){var t,n;(t=i.exec(e.textContent))?(e.parentElement.classList.remove("ty-outline-miss"),t[0]&&t[0].trim().length&&((n=s.createRange()).moveToBookmark({containerNode:e,start:t.index,end:t.index+t[0].length}),l.markRange(n,"ty-outline-hit"))):e.parentElement.classList.add("ty-outline-miss")}),y("#typora-sidebar").addClass("ty-on-outline-filter"),this.searchTimer=null):this.clearSearch()}updateOutlineHtml(e,t){var n,i,r,o,a,s,l;(t||document.body.classList.contains("pin-outline"))&&(n=document.querySelector("#outline-content"),l=c(e),i=n.scrollTop,r=!document.body.classList.contains("no-collapse-outline"),o=[],a=0==n.innerHTML.trim().length,s=n.innerHTML,l=l,s=y(y.parseHTML("<div>"+s+"<div>")[0]),l=y(y.parseHTML("<div>"+l+"<div>")[0]),s.find(".outline-item-open, .outline-active, .outline-item-active").removeClass("outline-item-open").removeClass("outline-item-active").removeClass("outline-active"),s.html()==l.html()?t&&r&&h(y(n)):(r&&!a&&y(n).find(".outline-item-open>.outline-item>.outline-label").map(function(){o.push(this.getAttribute("data-ref"))}),n.innerHTML=c(e),n.scrollTop=i,r&&(h(y(n)),y(n.querySelector(".outline-active")).parents(".outline-item-wrapper:not(.outline-item-single)").addClass("outline-item-open"),a?1==n.children.length&&n.children[0].classList.add("outline-item-open"):o.forEach(function(e){e=n.querySelector("[data-ref='"+e+"']");e&&!(e=e.parentElement.parentElement).classList.contains("outline-item-single")&&e.classList.add("outline-item-open")})),this.highlightVisibleHeader()))}highlightVisibleHeader(e,t,n,i){if(document.querySelector("#typora-sidebar.open")){var r,o=this,a=this.editor,s=e||y(a.writingArea).children(this.headerStr),l=0,c=s.length-1,d=void 0===t?null:t;if(s.length){for(l=1===g(s[s.length-1])?0:s.length-1;1<c-l&&null==d;){var u=Math.floor((l+c)/2),h=g(s[u]);1==h?c=u:-1==h?l=u:d=function(e){for(e--;s[e]&&0==g(s[e]);)e--;return e+1}(u)}if((d=null==d?l:d)<s.length){y(".outline-item-active").removeClass("outline-item-active");var p=y("#outline-content .outline-label").removeClass("outline-active").filter("[data-ref='"+s[d].getAttribute("cid")+"']").addClass("outline-active").parent().addClass("outline-item-active"),e=!document.body.classList.contains("no-collapse-outline");if(i&&(p.addClass("blink-area"),setTimeout(function(){p.removeClass("blink-area")},2e3)),e)if(n)for(var f=p;f.length;)f.addClass("outline-item-open"),f=f.parent().closest(".outline-item-wrapper");else{var a=p.closest(".outline-item-open>.outline-children"),m=p[0];(a=a.length?a:y("#outline-content")).length&&(p=a.children().filter(function(){return this==m||this.contains(m)}).find(".outline-label").first().addClass("outline-active").parent().addClass("outline-item-active"))}t=p,o.editor.library&&!o.editor.library.isOutlineShown()||!t.length||(i=y("#outline-content:visible")[0])&&(File.isNodeHtml||(i=i.parentElement),(t=t.offset().top-y(i).offset().top)<0?r=t-200+i.scrollTop:t>i.offsetHeight-20&&(r=200+t-i.offsetHeight+i.scrollTop),void 0!==r)&&(i.scrollTop=r)}}v=null}function g(e){var t=y("content").scrollTop(),e=e.offsetTop;return e<t?-1:e>t+window.innerHeight?1:0}}highlightVisibleHeaderWithDelay(e){v&&clearTimeout(v),v=setTimeout(()=>{this.highlightVisibleHeader(e)},File.inBusyMode?200:100)}renderOutline(){var e=c(this.editor.nodeMap.toc),t=y(".outline-content");t.html(e),h(t,!0),this.editor.mathInline&&this.editor.mathInline.renderInToc(),this.expandedOutlineItem?(this.expandedOutlineItem.forEach(function(e){try{t.find("[data-ref='"+e+"']").parent().parent().addClass("outline-item-open")}catch(e){}}),this.expandedOutlineItem=null):(e=t.children()).length<20&&e.addClass(".outline-item-open")}moveUpOrDown(r){var o=!document.body.classList.contains("no-collapse-outline"),e=document.querySelector("#outline-content"),a=e.querySelectorAll(".outline-item:not(.ty-outline-miss)"),t=e.querySelector(".select");if(!t&&(t=e.querySelector(".outline-active"))){if(!(t=t.parentElement).classList.contains("ty-outline-miss"))return void t.classList.add("select");t=null}t?(e=function e(t,n){var i,t=Array.prototype.indexOf.call(a,t),t=a[r?t-1:t+1]||null;return t&&!n&&o&&!(i=t.parentElement.parentElement.parentElement).classList.contains("outline-item-open")&&i.classList.contains("outline-item-wrapper")?e(t,n):t}(t,document.querySelector("#typora-sidebar.ty-on-outline-filter")))&&(t.classList.remove("select"),e.classList.add("select")):(t=a[0])&&t.classList.add("select")}onEnterKey(e){var t=e.target.value.trim(),n=document.querySelector(".outline-item.select");n&&r==t?(y(n).children(".outline-label").trigger("click"),n.parentElement.classList.contains("outline-item-open")||y(n).children(".outline-expander").trigger("click"),setTimeout(function(){e.target.focus()},0)):this.search(t)}showOutline(){this.editor.library.isSidebarShown()?y("#toc-content").html(y("#outline-content").html()).find(".outline-active, .outline-item-active").removeClass("outline-active").removeClass("outline-item-active"):this.renderOutline(),y(".dropdown-menu.open, .dropdown-menu.show").removeClass("open").removeClass("show"),document.querySelector("#toc-dropmenu").classList.add("open")}storeOutline(){this.expandedOutlineItem=[];for(var e=document.querySelectorAll(".outline-item-open:not(.outline-h1)>.outline-item>.outline-label"),t=0;t<e.length;t++)this.expandedOutlineItem.push(e[t].getAttribute("data-ref"));return this.expandedOutlineItem}hideOutline(e){this.storeOutline(),document.querySelector("#toc-dropmenu").classList.remove("open")}autoHideOutline(){document.querySelector("#toc-dropmenu").classList.contains("open")&&this.hideOutline()}toggleOutline(){document.querySelector("#toc-dropmenu.open")?this.hideOutline():this.showOutline()}getHeaderMatrix(n){var i=[];return this.editor.nodeMap.toc.headers.map(function(e){var t=e.get("type")==d.heading?e.get("text"):e.getText().replace(/(^#+)|(#+$)/g,""),t=a.output(t);n&&(t=y.parseHTML("<div>"+t+"<div>")[0].textContent),i.push([+e.get("depth"),t,e.cid])}),i}}}),$__System.registerDynamic("43",["11","e","32","26"],!0,function(e,t,n){"use strict";this||self;var y,v=e("11"),b=e("e"),w=e("32"),p=e("26").map;n.exports=class{constructor(e){this.editor=e.editor,this.parent=e,this.templateDom=b.parseHTML(document.querySelector("#file-search-item-template").innerHTML.trim())[0],this.caseSensitive=File.option.fileSearchCaseSensitive,this.wholeWord=File.option.fileSearchWholeWord,this.useRegexp=File.option.fileSearchUseRegexp,this.bindEvents(),File.isMac&&this.registerBridge()}bindEvents(){var o,a,s,l,c,d=this;File.isWin;function u(e,t){t.scrollTop>e.offsetTop?t.scrollTop=Math.max(e.offsetTop-2,0):t.scrollTop+t.offsetHeight<e.offsetTop+e.offsetHeight&&(t.scrollTop=e.offsetTop)}File.isNode?(l=null,[document.querySelector("#file-library"),document.querySelector("#outline-content")].forEach(function(i,e){var r=1==e;i.addEventListener("wheel",function(e){var t,n=0===e.deltaY;16<e.deltaX||e.deltaX<-16?(a&&clearTimeout(a),a=setTimeout(function(){a=null},50)):(o?n||e.preventDefault():(t=c!==(e.deltaY<0?-1:1),c=e.deltaY<0?-1:1,t&&(clearTimeout(s),s=null)),s?clearTimeout(s):0==e.deltaX&&(l=i.scrollTop),s=setTimeout(function(){s=l=null},40),o||-1==l?n||e.preventDefault():0!==l||a||(t=r?d.parent.outline.isSearchShown():d.isShown_,e.deltaY<0&&i.scrollTop<2&&!t?(o=setTimeout(function(){o=null},50),clearTimeout(s),s=setTimeout(function(){l=null},50),d.showSearch(r),e.preventDefault(),l=-1):t&&0<e.deltaY&&(d.hideSearch(r),o=setTimeout(function(){o=null},50),clearTimeout(s),s=setTimeout(function(){l=null},50),e.preventDefault(),l=-1)))})}),b("#info-panel-tab-search-back").on("click",function(){d.hide()})):b(".sidebar-osx-tab").on("click","#sidebar-search-btn",function(){d.showSearch(d.parent.isOutlineShown())}).on("click","#ty-sidebar-search-back-btn",function(){d.hideSearch(d.parent.isOutlineShown())});var h=document.querySelector("#file-library-search-input");h.addEventListener("keydown",function(e){var t,n,i,r=p[e.keyCode||e.which];"Esc"==r?(d.onKeyDown=!0,setTimeout(function(){d.onKeyDown=!1},300),d.hideSearch(d.parent.isOutlineShown()),e.stopPropagation()):"Enter"==r?d.isShown_?(n=document.querySelector("#file-library-search-result").querySelector(".select"),i=h.value.trim(),n&&y==i?(n.classList.contains("ty-search-item")&&(n=n.querySelector(".ty-search-item-summary")),b(n).trigger("click").removeClass("select")):d.search(i)):d.parent.isOutlineShown()&&d.parent.outline.onEnterKey(e):"Up"==r||"Down"==r?d.isShown_?(n="Up"==r,i=document.querySelector("#file-library-search-result"),(e=i.querySelector(".select")||i.querySelector(".active"))?((t=(t=n?e.previousElementSibling:e.nextElementSibling)&&(!t.classList.contains("ty-search-item-line-more")||t.parentElement.parentElement.classList.contains("ty-search-item-expand")?t:null))||e.classList.contains("ty-search-item-line")&&(e=e.parentElement.parentElement,t=(t=n?e.previousElementSibling:e.nextElementSibling)&&(n?!t.classList.contains("ty-search-item-line-more")&&t.querySelector(".ty-search-item-line-expand")||t.querySelector(".ty-search-item-line:last-child"):t.querySelector(".ty-search-item-line:first-child"))))&&(e.classList.remove("select"),t.classList.add("select"),u(t,i)):((e=i.querySelector(".ty-search-item"))&&e.classList.add("select"),e&&u(e,i))):d.parent.isOutlineShown()&&d.parent.outline.moveUpOrDown("Up"==r):"Tab"==r&&d.editor.searchPanel.closePanel()}),h.addEventListener("focus",function(e){var t=document.querySelector("#file-library-search-result .select");t&&t.classList.remove("select")});var t=document.querySelector("#filesearch-case-option-btn"),n=(t.addEventListener("mousedown",function(e){t.classList.toggle("select"),d.caseSensitive=!d.caseSensitive,JSBridge.putSetting("fileSearchCaseSensitive",d.caseSensitive),e.preventDefault(),e.stopPropagation()}),d.caseSensitive&&t.classList.add("select"),document.querySelector("#filesearch-word-option-btn")),i=(n.addEventListener("mousedown",function(e){n.classList.toggle("select"),d.wholeWord=!d.wholeWord,JSBridge.putSetting("fileSearchWholeWord",d.wholeWord),e.preventDefault(),e.stopPropagation()}),d.wholeWord&&n.classList.add("select"),document.querySelector("#filesearch-regexp-option-btn"));i.addEventListener("mousedown",function(e){i.classList.toggle("select"),d.useRegexp=!d.useRegexp,JSBridge.putSetting("fileSearchUseRegexp",d.useRegexp),e.preventDefault(),e.stopPropagation()}),d.useRegexp&&i.classList.add("select"),b("#file-library-search").on("click",".ty-search-item-line-expand",function(e){b(this).closest(".ty-search-item").addClass("ty-search-item-expand"),e.stopPropagation()}).on("click",".ty-search-item-collapse-icon",function(e){var t=b(this).closest(".ty-search-item");t.hasClass("ty-search-item-collapse")?(t.removeClass("ty-search-item-collapse"),t.addClass("ty-search-item-expand")):(t.addClass("ty-search-item-collapse"),t.removeClass("ty-search-item-expand")),e.stopPropagation()}).on("click",".ty-search-item-summary",function(e){b("#file-library-search-result").find(".active, .select").removeClass("active select");var t=b(this).closest("[data-path]").addClass("active").attr("data-path");(File.isMacOrMacNode?e.metaKey:e.ctrlKey)?d.parent.openWithCtrl(t):d.parent.openFile(t)}).on("click",".ty-search-item-line",function(e){var t=this.dataset.line,n=this.dataset.match,i=this.dataset.lineText,r=b(this).closest("[data-path]").attr("data-path"),o=this;e.stopPropagation(),e.preventDefault(),null!=t&&(n?(File.isMacOrMacNode?e.metaKey:e.ctrlKey)?d.parent.openWithCtrl(r):r==w.getCurrentFilePath()?(d.goto(+t,n,i),b("#file-library-search-result").find(".active, .select").removeClass("active select"),o.classList.add("active")):(window._hasSwitchCallback=!0,d.parent.openFile(r,function(){d.goto(+t,n,i),b("#file-library-search-result").find(".active, .select").removeClass("active select"),o.classList.add("active")})):(File.isMacOrMacNode?e.metaKey:e.ctrlKey)?d.parent.openWithCtrl(r):(window._hasSwitchCallback=!0,r!=w.getCurrentFilePath()&&d.parent.openFile(r,function(){b("#file-library-search-result").find(".active, .select").removeClass("active select"),o.classList.add("active")})))})}registerBridge(){var t=this;bridge.registerHandler("globalSearch.onSearchUpdate",function(e){e.emptyFilePathMatch?e.text&&e.text.split(/\r?\n/g).map(function(e){t.onSearchUpdate(e,!0,{path:e,matches:[]})}):t.onSearchUpdate(e.text,e.pathMatch)}),bridge.registerHandler("globalSearch.onErrorMsg",function(e){t.onErrorMsg(e)})}toggleSearch(){this.isActive()?this.hide():this.show()}showSearch(e){e?this.parent.outline.showSearch():this.show()}hideSearch(e){e?this.parent.outline.hideSearch():this.hide()}markOpenedFile(e){var t;document.querySelector(".ty-on-search")&&(t=File.getMountFolder())&&0===e.indexOf(t)&&!document.querySelector(".ty-search-item-line.active")&&b(".ty-search-item[data-path='"+v.escapeSelector(e)+"']").addClass("active")}isActive(){return this.isShown_&&b("#typora-sidebar").hasClass("ty-on-search")}show(e){this.parent.isFileTabShown()||this.parent.showSidebar("files"),this.isShown_=!0;var t=b("#typora-sidebar"),n=t.find("#file-library-search-input");e&&y&&t.find(".ty-search-item").length&&(t.addClass("ty-show-search ty-on-search"),n.val(y).focus()),setTimeout(function(){JSBridge.menu.update({"View→Search":{state:t.hasClass("ty-on-search")}})},100),t.hasClass("ty-show-search")?n.focus():(n.attr("placeholder",b.localize.getString("Search","Front")),File.isNodeHtml&&(n.css("width","100%"),t.find("#close-outline-filter-btn").hide()),t.addClass("ty-show-search"),e=this.editor.selection.getRangy(),editor.lastCursor=editor.selection.buildUndo(e),this.clearSearch(),e&&e.toString().trim().length&&n.val(e.toString().trim().replace(/\n.*$/,"")),n.focus(),y!=n.val()&&n.val(""),n.val()&&n.select())}clearSearch(){b("#file-library-search-result").html("")}clearContentHighlight(){this.isShown_&&(b("#file-library-search-result").find(".select").removeClass("select"),b(".md-search-select").removeClass("md-search-select"),this.editor.searchPanel.clearSearch(),this.editor.searchPanel.resetSearchStatus(),b(".md-search-hit").removeClass("md-search-hit"))}hide(){this.isShown_=!1,0!=b("#typora-sidebar.ty-show-search").length&&(b("#typora-sidebar").removeClass("ty-show-search").removeClass("ty-on-search"),b("#info-panel-tab-file .info-panel-tab-border").addClass("ty-fadein-right"),setTimeout(function(){b("#info-panel-tab-file .info-panel-tab-border").removeClass("ty-fadein-right")},400),this.editor.searchPanel.closePanel())}onErrorMsg(){var e=document.querySelector("#file-library-search-result"),t=document.createElement("div");t.classList.add("ty-search-result-error-message"),t.textContent=this.curError,e.appendChild(t)}onSearchUpdate(e,s,t){var p=this,r=File.isWin?"\\":"/",o=document.querySelector("#file-library-search-result"),i=(o.querySelector(".ty-search-result-error-message")&&(o.innerHTML=""),void 0),f=function(){if(null==i){var e=p.caseSensitive?"g":"gi",t=y;if(p.useRegexp)try{p.wholeWord&&(t=`\\b${t.replace(/^\\b|\\b$/g,"")}\\b`),i=new RegExp(t,e)}catch(e){i=null}else t=v.escapeRegExp(y.trim()),p.wholeWord&&(t="\\b"+t+"\\b"),i=new RegExp(t,e)}return i&&(i.lastIndex=0),i},a=s?1:0,n=File.getMountFolder(),l={begin:function(e){File.isMac&&n&&0==e.path.text.indexOf(n)&&(e.path.text=e.path.text.substring(n.length).replace(/^[\/]/,"")),this.curFile[a]={path:e.path.text,matches:[]}},end:function(e){var t=this.curFile[a].path;if(w.isSupportedFile(t)){if(s){i=f();var n=t.replace(/\\/g,"/").replace(/\/$/,"").lastIndexOf("/"),n=t.substring(n+1)||t;if(!i.exec(n))return void(this.curFile[a]=null)}this.curFile[a].total=e.stats.matches,c.call(this,this.curFile[a])}this.curFile[a]=null},match:function(e){this.curFile[a].matches.push({line:e.line_number,text:e.lines.text,submatches:e.submatches})}},m=function(e,i){var t;e.trim()&&!p.useRegexp&&(t=f().exec(e))?[e.substring(0,t.index),t[0],e.substring(t.index+t[0].length)].forEach(function(e,t){var n=1==t?document.createElement("span"):document.createTextNode(e);1==t&&(n.innerText=e,n.classList.add("ty-file-search-match-text")),i.appendChild(n)}):i.innerText=e},g=function(e){var t=e.replace(/\\/g,"/").replace(/\/$/,"").lastIndexOf("/"),n=e.substring(t+1),e=e.substring(0,t),t=n.lastIndexOf("."),i=n.substring(t);return[e,n=n.substring(0,t),i]},c=function(c){var e,d,u,t,n;function h(e,t,n,i,r,o){var a=document.createElement("span"),e=(r&&a.classList.add(r),e.substring(t,n).replace(/\r*\n/,""));o&&0==t&&(e=e.replace(/^\s+/,"").replace(/\s+$/," ")),!s&&!r&&20<e.length&&o&&(e="..."+((e=e.substring(e.length-20,e.length)).replace(/^.+?\b/,"")||e)),a.innerText=e,i.appendChild(a)}function i(){c.matches.forEach(function(e,t){if(p.matchedLines++,!(20<t)){for(var n,i,r,o=document.createElement("div"),a=(o.classList.add("ty-search-item-line"),d-2<t&&(t==d-1&&c.matches.length>d&&u.appendChild((n=c.matches.length-t,(i=document.createElement("div")).classList.add("ty-search-item-line"),i.classList.add("ty-search-item-line-expand"),i.innerText="show "+n+" more matches",i)),o.classList.add("ty-search-item-line-more")),e.text=e.text||"",e.text.replace(/[\r\n]/g,"")),s=(o.dataset.line=e.line-1,o.dataset.lineText=a,e.submatches.length&&(o.dataset.match=e.submatches[0].match.text),0),l=f();r=l.exec(a);)s<r.index&&h(a,0,r.index,o,"",0==t),s=r.index+r[0].length,h(a,r.index,s,o,"ty-file-search-match-text",!0);s<a.length&&h(a,s,a.length,o),u.appendChild(o)}})}c&&c.path&&((e=this.templateDom.cloneNode(!0)).dataset.path=File.getMountFolder()+r+c.path,t=g(c.path),m(t[1],e.querySelector(".file-list-item-file-name-part")),m(t[2],e.querySelector(".file-list-item-file-ext-part")),t=t[0]?(t[0]+r).replace(/[\\\/]/g," / "):"",e.querySelector(".file-list-item-parent-loc").innerText=t,t=s?0:c.total,e.querySelector(".file-list-item-count").innerText=20<t?"20+":t,d=6,p.matchedLines<30&&d<t&&e.classList.add("ty-search-item-expand"),u=e.querySelector(".ty-search-item-matches"),s?(p.matchedLines++,c.matches.length&&((t=document.createElement("div")).classList.add("ty-search-item-line"),n=(c.matches[0]||[""]).text.replace(/[\r\n]/g,""),t.dataset.line=0,(t.dataset.lineText=n)&&h(n,0,n.length,t),u.appendChild(t))):i(),n=o.querySelector("[data-path='"+v.escapeSelector(File.getMountFolder()+r+c.path)+"']"),s?n||o.appendChild(e):(n&&n.remove(),o.appendChild(e)))};if(t)return w.isSupportedFile(e)&&(i=f(),d=e.replace(/\\/g,"/").replace(/\/$/,"").lastIndexOf("/"),d=e.substring(d+1)||e,i.exec(d))?void c.call(this,t):void 0;var d=((s?this.pathPrev:this.prev)+e).split(/\r?\n/g);s?this.pathPrev=d.splice(d.length-1,1)[0]:this.prev=d.splice(d.length-1,1)[0],d.forEach(function(e){if(e&&!(1e4<e.length))try{var t=JSON.parse(e);l[t.type]&&l[t.type].call(this,t.data)}catch(e){console.warn(e)}},this),""==e&&this.endCount--,30<p.matchedLines&&b(".ty-search-item.ty-search-item-expand").removeClass("ty-search-item-expand"),""!=e||o.childElementCount||this.endCount||(this.curError=this.curError||b.localize.getString("No result found.","Front"),this.onErrorMsg())}goto(e,t,n){this.editor.sourceView.gotoLine({line:e,ch:0,lineText:n,textBefore:n.substring(0,n.indexOf(t))}),this.editor.searchPanel.doSearch(t,{caseSensitive:this.caseSensitive,wholeWord:this.wholeWord,useRegexp:this.useRegexp,noSelect:!0,delay:0,includeMeta:!0});var i=this,r=i.editor.getMarkElem(),e=r.closest("tr"),o=(e.length&&(r=e),b(".md-search-select").removeClass("md-search-select"),b());setTimeout(function(){(o=r.find(".md-search-hit").first()).addClass("md-search-select"),r.addClass("md-focus")},10),setTimeout(function(){o.length&&i.editor.selection.scrollAdjust(o,60,void 0,!0)},200),document.querySelector("#file-library-search-input").focus()}search(e){b("#file-library-search-result .select").removeClass("select"),(y=e)?File.getMountFolder()&&(this.clearContentHighlight(),this.parent.updateMenu("search"),this.prev="",this.curFile=[],this.curError="",this.pathPrev="",this.endCount=this.useRegexp?1:2,this.matchedLines=0,File.isNode?this.searchByNode(e):this.searchByMac(e)):b("#typora-sidebar").removeClass("ty-on-search").find("#file-library-search-result").html("")}searchByMac(e){e=v.normalize(e);var t=v.normalize(e,"NFD");bridge.callHandler("library.search",{text:e,caseSensitive:this.caseSensitive||!1,wholeWord:this.wholeWord||!1,useRegexp:this.useRegexp||!1,args:this.buildRpArgs(e,t)},e=>{e&&b("#typora-sidebar").addClass("ty-on-search").find("#file-library-search-result").html("")})}buildRpArgs(e,t){e=["-F","--json","--no-multiline","-n","-m","21","--max-filesize","2M","-g","!.*","--no-messages","--",e];return this.useRegexp&&e.shift(),this.caseSensitive||e.unshift("-i"),this.wholeWord&&e.unshift("-w"),e}searchByNode(e,t){var n,i=this,r=(i.rpTask1&&(i.rpTask1.kill(),i.rpTask1=null),i.rpTask2&&(i.rpTask2.kill(),i.rpTask2=null),i.rpTask3&&(i.rpTask3.kill(),i.rpTask3=null),e=v.normalize(e),v.normalize(e,"NFD"));function o(e){var t=reqnode("child_process"),n=reqnode("vscode-ripgrep").rgPath.replace("node_modules.asar","node_modules"),t=t.spawn(n,e,{cwd:File.getMountFolder(),stdio:["ignore","pipe","pipe"]});return t.stdout.setEncoding("utf8"),t.stderr.setEncoding("utf8"),t}b("#typora-sidebar").addClass("ty-on-search").find("#file-library-search-result").html(""),i.useRegexp||(n="*"+v.escapeRegExp(e)+"*",(n=o(["-m","2","--max-filesize","2M",".*","-H","-U","--json","--no-messages",i.caseSensitive?"-g":"--iglob",n])).stdout.on("data",function(e){i.onSearchUpdate(e,!0)}),n.on("close",function(){i.onSearchUpdate("",!0),i.rpTask2=null}),i.rpTask2=n),(n=o(i.buildRpArgs(e,r))).stdout.on("data",function(e){i.onSearchUpdate(e)}),n.on("close",function(){i.onSearchUpdate(""),i.rpTask1=null}),n.stderr.on("data",function(e){i.curError+=e}),i.rpTask1=n,i.useRegexp||(r="*"+v.escapeRegExp(e)+"*",(r=o(["--max-filesize","0K","--files","--no-messages",i.caseSensitive?"-g":"--iglob",r])).stdout.on("data",function(e){e.split(/\r?\n/g).map(function(e){i.onSearchUpdate(e,!0,{path:e,matches:[]})})}),r.on("close",function(){i.rpTask3=null}),i.rpTask3=r)}}}),$__System.registerDynamic("44",["11","13","28","32","34","33","26","3f","40","42","43","e"],!0,function(e,t,n){"use strict";this||self;var a,i,o,s,y=e("11"),r=e("13"),l=r.Node,v=(r.TYPE,e("28")),b=e("32"),c=e("34"),d=e("33"),g=e("26").map,u=e("3f"),h=e("40"),p=e("42"),f=e("43"),w=e("e"),m=0;function x(e,t){return void 0===e?t:e}window._lastFocusTimeMark=+new Date,window.onWindowFocusForNode=function(e,t){window.File&&File.editor&&File.editor.imgEdit&&(t||File.freshMenu(!0),File._onFileSwitching?(console.sendLog("File.activeWindow = true"),File.activeWindow=!0):(t=reqnode("fs-plus"),i||!File.bundle.filePath||d.isFileSync(File.bundle.filePath)?(File.getMountFolder()&&!t.isDirectorySync(File.getMountFolder())&&File.editor.library.onRootChanged(),!e&&File.editor.selection?JSBridge.invoke("document.getSnapWithValidation",File.bundle.lastSnapDate).then(e=>{var{snap:e,shouldReadFromDisk:t}=JSON.parse(e);S(e,t,!0)}):(window._lastFocusTimeMark=+new Date,File.editor.imgEdit.refreshLocalImg())):c.onPresentationMoved()))},window.onWindowFocusForMac=function(){File.editor&&File.editor.imgEdit&&(File.freshMenu(!0),File.editor.imgEdit.refreshLocalImg(),File.editor.library.markOpenedFile(b.getCurrentFilePath()),window._lastFocusTimeMark=+new Date,File.editor.tryEnterBusyModeWithDelay())};function C(t,n){File.isBroken||(t=t||"").toLowerCase()!=(File.bundle.filePath||"").toLowerCase()&&b.tryLeaveDocument(async function(e){e?(File._onFileSwitching=!1,File.editor.library.resumeOnChange()):(File._onFileSwitching=!0,await File.editor.library.doSwitchByNode(t),n&&n())},!0)}var F,S=function(e,t,n,i){console.sendLog("onBecomeActive"),File.editor.brush.clearAndPause(),console.sendLog("File.activeWindow = true"),File.activeWindow=!0;var r=n?File.editor.lastCursor:null,t=File.restoreEditStateFromData(e,n,!1,t,i);File.editor.brush.restart(),!n&&File.isMac&&e?File.editor.library._onSwitchDocumentTarget?(s&&clearTimeout(s),window.getSelection().removeAllRanges(),s=setTimeout(File.recoverPosOrScroll,400)):File.recoverPosOrScroll():(b.refreshTitlebarText(),t?Reporter.record({message:"Restore state from other window (no change)",category:"window.focus"}):r?(File.editor.lastCursor=r,File.editor.restoreLastCursor(),File.editor.sourceView.inSourceMode||(i=window.getSelection(),r&&"None"!=i.type)||i.removeAllRanges()):window.getSelection().removeAllRanges())},k=(window.onWindowBlur=function(){try{window.File&&File.editor&&File.editor.sourceView&&File.isMac&&(window.File.isLocked=!0,File.backupDocumentSnap())}catch(e){console.sendError(e)}finally{return"DONE"}},window.reqnode&&(window.addEventListener("blur",function(){window.File&&File.editor&&File.editor.sourceView&&!window._onBackup&&File.isActiveWindow()&&File.backupDocumentSnap()}),window.onWindowResignForNode=async()=>!!window.File&&(console.sendLog("window.onWindowResignForNode"),await File.backupDocumentSnap(),File.activeWindow=!1,console.sendLog("File.activeWindow = false"),!0)),[]),E={CreateDateDescend:-3,DateDescend:-2,AlphabetDescend:-1,NaturalDescend:-3,Natural:0,Alphabet:1,Date:2,CreateDate:3};n.exports=class{constructor(e){this.editor=e,this.root,this.items,this.fsWatcher,this.watchedFolder,this.unixWatchers={},this.fileTree=new u(this),this.fileList=new h(this),this.fileSearch=new f(this),this.outline=new p(this),this.useTreeStyle=File.option.useTreeStyle,this.supportResize_,this.onInit_=!0,this.cursorBackups={},this.SortType=E,this.bindLiveResize(),this.registerBridge(),this.defaultTab=File.option.sidebarTab||(File.isMac?"file-list":"outline"),!File.option.initFilePath&&File.mountFolder_&&(this.defaultTab="files"),"outline"==this.defaultTab?document.querySelector("#typora-sidebar").classList.add("active-tab-outline"):document.querySelector("#typora-sidebar").classList.add("active-tab-files"),File.isNode&&w("#reveal-folder-from-sidebar-menu").text(w.localize.getString("Reveal in File Explorer")),File.option.pinFolder&&(this.setMountFolder(File.option.pinFolder,!!File.option.showSidebar,"pinFolder"),File.option.pinFolder=void 0),this.draggingItem=null,this.filesInDragging=[],File.option.showSidebar&&(File.option.sidebarTab="files",setTimeout(()=>{File.option.sidebarTab="files",this.showSidebar("files")},100)),setTimeout(()=>{document.body.classList.remove("no-animation")},1e3)}async doSwitchByNode(e){File.draftsRecoverList=[],this.isDiscardableUntitled()||await File.buildDocumentSnapForNode(!0),e?await File.loadFile(e,!0):await JSBridge.invoke("document.switchToUntitled",void 0,!0),window.uploadImageQueue.clear(),window.moveImageQueue.clear(),File._onFileSwitching=!1}registerBridge(){var n;File.isMac&&(n=this,bridge.registerHandler("library.onRootChanged",function(e,t){n.onRootChanged(e),t&&t()}),bridge.registerHandler("library.scheduleChangeHighlight",function(e,t){n.scheduleChangeHighlight(e),t&&t()}),bridge.registerHandler("library.onFileChanges",function(e,t){n.onFileChanges(e),t&&t()}),bridge.registerHandler("library.onLoadFolderFailed",function(e,t){n.onLoadFolderFailed(e),t&&t()}),bridge.registerHandler("library.setFilesInDragging",function(e,t){n.filesInDragging=e[0],n.draggingItem=e[1]?e[0][0]:null,t&&t()}),bridge.registerHandler("library.refreshOnRefocus",function(){n.isFileTabShown()&&n.useTreeStyle&&n.refreshPanelCommand()}),bridge.registerHandler("library.getActiveTab",function(e,t){t(n.getActiveTab())}),bridge.registerHandler("window.onBecomeActive",function(e,t){e[1]&&File.setDocumentState(e[1]),S(e[0],(e[0]||{}).isOutDated,e[2],e[3]),t&&t()}))}supportResize(){return void 0===this.supportResize_&&(this.supportResize_=!(!window.CSS||!window.CSS.supports||!window.CSS.supports("--sidebar-width",0)&&!window.CSS.supports("(--foo: red)"))),this.supportResize_}bindLiveResize(){var t,n,i,r,o=w("#typora-sidebar-resizer"),a=this,e=File.option.sidebarWidth;e&&this.setSidebarWidth(+e,!1),this.supportResize()?(t=!1,o.on("mousedown",function(e){1===e.which&&(n=!0)}).on("mousemove",function(e){1===e.which&&n&&(t||(t=!0,o.addClass("dragging"),i=window.innerWidth-220),e.pageX<100?(o.children().css("left",0),r=!0):(r=!1,e=Math.min(Math.max(160,e.pageX),i),o.children().css("left",e)))}).on("mouseup",function(e){t&&(t=n=!1,o.removeClass("dragging"),o.children().css("left",""),e.pageX<100?a.hideSidebar():(e=Math.min(Math.max(160,e.pageX),i),a.setSidebarWidth(e,!0)))}),w(window).on("mouseup",function(){t&&(t=n=!1,o.removeClass("dragging"),o.children().css("left",""),r)&&a.hideSidebar()})):o.remove()}listenCurrentTransition(){if(File.isNode){var e=document.querySelector("#typora-sidebar");const t=function(){window.dispatchEvent(new Event("resize"))},n=function(){window.dispatchEvent(new Event("optimizedResize")),e.removeEventListener("transitionstart",t),e.removeEventListener("transitionend",n)};e.addEventListener("transitionstart",t),e.addEventListener("transitionend",n)}else window.dispatchEvent(new Event("resize"))}setSidebarWidth(e,t){File.isNode&&window.dispatchEvent(new Event("beforeResize"));var n=(e=e&&Math.max(e,160))?e+"px":"";document.documentElement.style.setProperty("--sidebar-width",n),File.isMac&&("true"!=(window.getComputedStyle(document.body).getPropertyValue("--typora-center-window-title")||"").trim()&&document.body.classList.contains("pin-outline")?bridge.callHandler("window.setTitlebarTextMarginLeft",e):bridge.callHandler("window.setTitlebarTextMarginLeft",null)),t&&setTimeout(function(){JSBridge.putSetting("sidebar-width",e)},10),this.listenCurrentTransition()}isSuppressOnChange(){return a}markFocusOnDialogClose(){i=!0,setTimeout(function(){i=!1},200)}pauseOnChange(e,t){(a=!t||this.findElemFromPath(t).length)&&e&&setTimeout(function(){a=!1},File.isMac?800:200)}resumeOnChange(){a=!1}isFileTabShown(){return!!document.querySelector(".pin-outline .active-tab-files")}isSidebarShown(){return document.body&&document.body.classList.contains("pin-outline")}isOutlineShown(){return 0<w(".pin-outline .active-tab-outline").length}getActiveTab(){return this.isSidebarShown()?this.isFileTabShown()?this.useTreeStyle?"file-tree":"file-list":"outline":""}togglePanel(e){this.getActiveTab()!=e||this.fileSearch.isActive()?this.showSidebar(e):this.toggleSidebar()}toggleSidebar(){this.isSidebarShown()?this.hideSidebar():this.showSidebar()}tmpHideSidebar(e){this.savedSidebarStatus=this.isSidebarShown(),this.outline.autoHideOutline(),this.hideSidebar(!e)}recoverSidebar(){this.savedSidebarStatus&&this.showSidebar(),this.savedSidebarStatus=void 0}updateMenu(e){var t={};t["View→Outline"]={state:"outline"==e},t["View→Articles"]={state:"file-list"==e},t["View→File Tree"]={state:"file-tree"==e},t["View→Search"]={state:"search"==e},JSBridge.menu.update(t)}hideSidebar(e){File.isNode&&window.dispatchEvent(new Event("beforeResize")),this.outline.storeOutline(),document.querySelector("#typora-sidebar").classList.remove("open"),document.body.classList.remove("pin-outline"),e||JSBridge.putSetting("sidebar_tab",""),this.listenCurrentTransition(),File.isMac?(bridge.callHandler("window.setTitlebarTextMarginLeft",null),this.updateMenu("")):window.ClientCommand.refreshViewMenu()}showSidebar(e,t){this.fileSearch.isActive()&&this.fileSearch.hide(),this.outline.autoHideOutline(),this.isSidebarShown()?e&&!t&&this.switch(e):this.show(e)}show(e){File.isNode&&window.dispatchEvent(new Event("beforeResize")),document.querySelector("#typora-sidebar").classList.add("open"),document.body.classList.add("pin-outline"),this.switch(e||this.getActiveTab()||this.defaultTab),this.outline.renderOutline(),this.listenCurrentTransition(),File.isMac&&"true"!=(window.getComputedStyle(document.body).getPropertyValue("--typora-center-window-title")||"").trim()&&bridge.callHandler("window.setTitlebarTextMarginLeft",document.querySelector("#typora-sidebar").getBoundingClientRect().width)}updateOption(){var e=this.getDelegate(),t=x(e.sortType,this.sortType());e.setGroupByFolder(e.noGroup),this.setSortType(t)}switchTreeOrList(e){this.useTreeStyle===e&&!this.onInit_||(this.onInit_=!1,this.useTreeStyle=e,w(".sidebar-content").scrollTop(0),this.useTreeStyle?w("#typora-sidebar").addClass("use-file-tree-style").removeClass("use-file-list-style").find("#sidepanel-segmented-input-files").data("localize","Files").text(w.localize.getString("Files")):w("#typora-sidebar").addClass("use-file-list-style").removeClass("use-file-tree-style").find("#sidepanel-segmented-input-files").data("localize","Articles").text(w.localize.getString("Articles")),w.localize.isLoaded()||w("#sidepanel-segmented-input-files").localize("Front",{language:File.language,pathPrefix:"locales"}),File.isNode?window.ClientCommand.refreshViewMenu():this.updateMenu(e?"file-tree":"file-list"),JSBridge.putSetting("useTreeStyle",e)),this.isFileTabShown()&&!this.renderIfNeed()&&this.markCurrentFile(!0),w("[data-side-mode]").removeClass("selected-folder-menu-item"),(this.useTreeStyle?w("[data-side-mode='file-tree']"):w("[data-side-mode='file-list']")).addClass("selected-folder-menu-item"),this.updateOption(),this.refreshMenuVisibility(),JSBridge.putSetting("sidebar_tab",e?"file-tree":"file-list")}backupCursor(){var e,t;File.bundle.filePath&&(e=this.editor.selection.storeToJson()||{},t=File.editor.sourceView.inSourceMode,e.scrollOffset=t?0:w("content").scrollTop(),e.date=new Date,this.cursorBackups[File.bundle.filePath]=e)}openFile(e,t){var n;this._onSwitchDocumentTarget||File._onFileSwitching||(t||(window._hasSwitchCallback=!1),n=this,e&&!File.isBroken&&(w("#sidebar-files-menu").trigger("blur"),this.editor.searchPanel&&this.editor.searchPanel.resetSearchStatus(null),this.backupCursor(),File.isMac?(this._onSwitchDocumentTarget=!0,bridge.callHandler("controller.switchDocumentTarget",e,function(e){n._onSwitchDocumentTarget=!1,t&&t(e),e||n.refreshPanelCommand()}),setTimeout(()=>{n._onSwitchDocumentTarget=!1},200)):(File.megaMenu.hide(),C(e,t)),Analytics.record("openFile",{format:(/\.[^.\\\/]+$/.exec(e)||[""])[0]})))}openWithCtrl(e,t){this.openFileInNewWindow(e,t)}openFileInNewWindow(e,t){e&&File.backupDocumentSnap().then(function(){File.isMac?t?bridge.callHandler("controller.openFolder",e):bridge.callHandler("controller.openInNewWindow",e):JSBridge.invoke("app.openFileOrFolder",e,{forceCreateWindow:!File.bundle.filePath||e===File.bundle.filePath,mountFolder:File.getMountFolder()})})}onLoadFolderFailed(e){e=e||this.silent;var t=this;function n(){JSBridge.invoke("dialog.showMessageBox",{type:"question",message:w.localize.getString("Cannot open folder {0}").format(File.mountFolder_),buttons:[w.localize.getString("Choose Default Folder","Panel"),w.localize.getString("Ignore","Panel")],defaultId:0,cancelId:1,normalizeAccessKeys:!0}).then(({response:e})=>{JSBridge.putSetting("restoreWhenLaunch",0),JSBridge.putSetting("pinFolder",""),0==e&&JSBridge.invoke("dialog.showOpenDialog",{defaultPath:File.mountFolder_||"",properties:["openDirectory","promptToCreate"]}).then(({filePaths:e})=>{e&&0<e.length&&(JSBridge.putSetting("restoreWhenLaunch",3),JSBridge.putSetting("pinFolder",e[0]),t.setMountFolder(e[0]))})})}File.option.pinFolder&&File.mountFolder_==File.option.pinFolder&&(File.option.pinFolder=void 0,this.silent="pinFolder"),"pinFolder"==this.silent?n():e||alert(w.localize.getString("Cannot open folder {0}").format(File.mountFolder_)),File.isNode&&JSBridge.invoke("setting.removeRecentFolder",File.getMountFolder()),w("#file-library-tree, #file-library-list-children").attr("data-state","").html(""),File.mountFolder_=null,this.root=null,this.silent=!1,this.refreshMenuVisibility()}addWatch(e){this.fsWatcher&&e&&e==this.watchedFolder||(File.isWin?this.addFolderWatchByWin(e):this.addWatchByUnix(e))}unwatchByUnix(e){if((File.isLinux||File.isMacNode)&&e)for(var t in this.unixWatchers)-1==t.indexOf(e)&&(this.unixWatchers[t]&&this.unixWatchers[t].close(),this.unixWatchers[t]=null)}addWatchByUnix(n){if((File.isLinux||File.isMacNode)&&n){var i=this,e=this.unixWatchers[n];try{e&&(e.close(),e=null),this.unixWatchers[n]=reqnode("fs").watch(n,function(e,t){e=e,t=n+"/"+t,i.isSuppressOnChange()||i.shouldIgnore(t)||(o&&clearTimeout(o),k.push([t,e]),o=setTimeout(r,200))})}catch(e){console.warn(e)}}function r(){var e,t,n;i.isSuppressOnChange()||(e=k.clone(),o=null,k=[],t=[],n=[],e.forEach(function(e){i.fileTree.onChangeForWin(e[0],t,e[1]),i.fileList.onChangeForWin(e[0],"change"==e[1],n)}))}}addFolderWatchByWin(i,e){var r=this;if(this.fsWatcher&&(this.fsWatcher.close(),this.fsWatcher=null,this.watchedFolder=null),i)try{this.watchedFolder=i,this.fsWatcher=reqnode("fs").watch(i,{recursive:!0},function(e,t){var n;a||(t=i+"\\"+t,"rename"==e&&File.bundle.filePath&&0==File.bundle.filePath.indexOf(t+"\\")&&(n=t+"\\"+File.bundle.filePath.substr(t.length),window.doApplyRename(n)),n=t,t="rename"!==e,F&&clearTimeout(F),k.push([n,t]),F=setTimeout(o,200))})}catch(e){console.warn(e)}function o(){var e=k.clone(),t=(F=null,k=[],[]),n=[];e.forEach(function(e){e[1]||r.fileTree.onChangeForWin(e[0],t),r.fileList.onChangeForWin(e[0],e[1],n)})}}bindContext(){var r,o=this;function e(e){if((r=this)==document.querySelector("#file-library")&&o.useTreeStyle){if(e.target!=this||!File.editor.library.root)return!1;r=o.findElemFromPath(File.editor.library.root.path)[0],w("#file-menu").children("li").hide().end().find('[data-action="new_file"],[data-action="new_folder"]').show()}else w("#file-menu li").show();File.sync(),o.editor.lastCursor=o.editor.selection.buildUndo(),w("#write").blur(),w(".context-menu").removeClass("show").find(".active").removeClass("active");var t=w(r).closest(".file-library-node, .ty-search-item").focus(),n=w("#file-menu").addClass("show");File.isWin&&n.find("[for-win]").show(),n.find("li[data-key], .divider").show(),w("#typora-sidebar.ty-show-search").length?n.find("[data-action='search'] a").addClass("state-on"):n.find("[data-action='search'] a").removeClass("state-on"),t.hasClass("ty-search-item")?(n.find("li[data-key], .divider").hide(),n.find("[for-search]").show()):(n.find("[for-search-only]").hide(),o.useTreeStyle?(n.find('[data-action="new_folder"]').show(),(t.attr("data-path")==File.getMountFolder()?n.find("[for-file]"):"true"==t.attr("data-is-directory")?n.find("[for-file]:not([for-folder])"):n.find("[for-folder]:not([for-file])")).hide()):(n.find('[data-action="new_folder"]').hide(),n.find("[for-folder]:not([for-file])").hide(),o.editor.getJQueryElem(r).closest(".file-library-node").attr("data-path")||n.find("[for-folder],[for-file]").hide()),File.isWin||n.find("[for-win]").hide());var i=(i=File.getMountFolder())?i+(File.isWin?"\\":"/"):"";return n.find("[for-undo]").hide(),File.isNode&&JSBridge.invoke("filesOp.undoLabel",i).then(e=>{e&&(e=w.localize.getString("Undo %@","Panel").replace("%@",e),n.find('[data-action="undo_file_op"] a').text(e),n.find("[for-undo]").show())}),o.useTreeStyle?(n.find('[data-action="list_view"] a').removeClass("state-on"),n.find('[data-action="tree_view"] a').addClass("state-on")):(n.find('[data-action="list_view"] a').addClass("state-on"),n.find('[data-action="tree_view"] a').removeClass("state-on")),o.isReadOnlyRoot()?w("#file-menu").find("[for-new]").hide():w("#file-menu").find("[for-new]").show(),a(e,n),t.one("blur",function(){document.activeElement&&document.activeElement.classList.contains("file-node-content")||w(".context-menu").removeClass("show")}),!1}function a(e,t){var n=t.height()+48,i=e.clientX>window.innerWidth-220?window.innerWidth-220:e.clientX,n=e.clientY>window.innerHeight-n?window.innerHeight-n:e.clientY-w("#top-titlebar").height()+8;t.css({top:n+"px",left:i+"px"})}w("#file-menu").on("mousedown","[data-key]",function(e){var t=this.getAttribute("data-action");t&&1==e.which&&(w(".context-menu").removeClass("show").find(".active").removeClass("active"),setTimeout(function(){switch(t){case"open":o.openFileCommand(r);break;case"open_in_new_window":o.openFileInNewWindowCommand(r);break;case"new_file":return o.newFileCommand(r),!1;case"new_folder":return o.newFolderCommand(r),!1;case"delete":o.deleteFileCommand(r);break;case"properties":return o.showFilePropertyCommand(r),!1;case"rename":return o.getDelegate().renameFileCommand(r),!1;case"duplicate":return o.duplicateFileCommand(r),!1;case"copy_path":o.copyFullPathCommand(r);break;case"reveal":o.revealFileInFinderCommand(r);break;case"undo_file_op":File.isNode&&JSBridge.invoke("filesOp.getFocusPath").then(e=>{e&&o.scheduleChangeHighlight(e),JSBridge.invoke("filesOp.performUndo")});break;case"tree_view":o.switch("file-tree");break;case"list_view":o.switch("file-list");break;case"collapse_all":o.collapseAllSearch();break;case"expand_all":o.expandAllSearch();break;case"search":!o.fileSearch.isActive()&&w("#typora-sidebar.ty-show-search").length?o.fileSearch.hideSearch():o.fileSearch.toggleSearch();break;default:return}},0),o.editor.restoreLastCursor(null,!0))}),w("#file-library").on("contextmenu",".file-node-content, .file-list-item",e).on("contextmenu",e),w("#file-library-search").on("contextmenu",".ty-search-item",e).on("contextmenu",function(e){var t=w("#file-menu").addClass("show");return t.find("li").hide(),t.find('[data-action="search"]').show().find("a").addClass("state-on").parent().next().show(),t.find('[data-action="expand_all"], [data-action="collapse_all"]').show(),a(e,t),!1})}clearDraggingItem(){this.setDraggingItem(null),w(".ty-on-drag-enter").removeClass("ty-on-drag-enter")}setDraggingItem(e,t,n){null==(this.draggingItem=e)?m=0:File.isNode?e&&(t=window.dirname+(t?"/style/windows-folder-icon.png":"/style/typora-file-icon.png"),reqnode("electron").ipcRenderer.send("ondragstart",e,t),n)&&n.preventDefault():File.isMac&&bridge.callHandler("controller.startDrag",e)}expandAllSearch(){w(".ty-search-item").removeClass("ty-search-item-collapse").addClass("ty-search-item-expand")}collapseAllSearch(){w(".ty-search-item").addClass("ty-search-item-collapse").removeClass("ty-search-item-expand")}bindEvents(){var r,o=this,e=this.editor,t=w("#typora-sidebar");function n(){w(".show-sidebar-footer-context").removeClass("show-sidebar-footer-context")}var i=0;function a(e){var t,n;o.strollingBySelect||(o.strollingBySelect=!0,n=(t=w("#sidebar-content"))[0].scrollHeight-window.innerHeight,e=e?0:n,t.stop(!0).animate({scrollTop:e},Math.abs(e-t.scrollTop())/256*1e3,"linear"))}function s(){i=0,o.strollingBySelect&&(w("#sidebar-content").stop(!0),o.strollingBySelect=!1)}w("#sidepanel-segmented-input-files").click(function(){o.switch("files",!0)}),w("#sidepanel-segmented-input-outline").click(function(){o.switch("outline",!0)}),t.on("keydown","[tabindex]",function(e){"Esc"==g[e.keyCode||e.which]&&o.editor.focusCid&&o.editor.restoreLastCursor(null,!0)}).on("mousedown","[tabindex]",function(e){"INPUT"!=e.target.tagName&&(e=o.editor.selection.buildUndo())&&(o.editor.lastCursor=e)}),t.on("dragstart",".file-node-content",function(e){var t,n;"INPUT"!=document.activeElement.tagName&&(n=(t=this.parentElement).dataset.path,o.setDraggingItem(n,t.dataset.isDirectory+""=="true",e),e.originalEvent.dataTransfer.setData("file",n),e.originalEvent.dataTransfer.setData("text/plain",n))}).on("dragenter","[data-is-directory='true'] > .file-node-content",function(e){function t(e){setTimeout(function(){i.classList.contains("ty-on-drag-enter")&&i==r&&(w(i).addClass("file-node-collapsed").removeClass("file-node-expanded"),n(5e3))},e||1e3)}function n(e){setTimeout(function(){i.classList.contains("ty-on-drag-enter")&&i==r&&o.fileTree.expandNode(w(i),i.dataset.path,function(){t(5e3)})},e||1e3)}m++,e.stopPropagation(),e.preventDefault();var i,e=e.originalEvent.dataTransfer;File.isWK&&!o.draggingItem&&(o.draggingItem=e.getData("file")),(o.draggingItem||-1<(e.types||[]).indexOf("Files"))&&(i=this.parentElement,setTimeout(function(){r=i},0),w(this).closest(".ty-on-drag-enter").removeClass("ty-on-drag-enter"),!0!==i.dataset.hasSub&&"true"!=i.dataset.hasSub||(i.classList.contains("file-node-expanded")?t(3e3):n()),w(".ty-on-drag-enter").removeClass("ty-on-drag-enter"),i.classList.add("ty-on-drag-enter"))}).on("dragleave",".ty-on-drag-enter > .file-node-content",function(e){m--,r=null}).on("dragleave",".ty-on-drag-enter[data-is-directory='true']",function(e){var t;0<m||(t=(t=e.target).classList.contains("file-node-content")?t.parentElement:t).classList.contains("ty-on-drag-enter")&&(t.classList.remove("ty-on-drag-enter"),e.stopPropagation())}).on("drop","[data-is-directory='true']",function(e){e.stopPropagation(),e.preventDefault();var t=[],n=e.originalEvent.dataTransfer;if(File.isActiveWindow()){if(o.draggingItem)t.push(o.draggingItem);else if(n.files&&n.files.length){if((n.files.item(i)||{}).path||(t=o.filesInDragging||[]),File.isNodeHtml)for(var i=0;i<n.files.length;i++){var r=(n.files.item(i)||{}).path;r&&t.push(r)}}else n.getData("text/uri-list")&&t.push(n.getData("text/uri-list").replace(/^file:[\/]+/,""));o.clearDraggingItem(),t.length&&(o.fileTree.expand(this.dataset.path),o.copyOrMoveFiles(t,this.dataset.path))}}).on("drop",function(e){e.stopPropagation(),e.preventDefault()}).on("mouseup",function(){o.clearDraggingItem(),s()}),File.isMac&&t.on("dragenter",".sidebar-tabs",function(e){e.preventDefault(),i++,a(!0)}).on("dragleave",".sidebar-tabs",function(e){e.preventDefault(),--i||s()}).on("dragenter","#ty-sidebar-footer",function(e){e.preventDefault(),i++,a(!1)}).on("dragleave","#ty-sidebar-footer",function(e){e.preventDefault(),--i||s()}),w("#ty-sidebar-footer").on("click","#sidebar-new-file-btn",function(){return e.focusAndRestorePos(),o.newFile(File.getMountFolder()),!1}).on("click","#switch-file-list-btn",function(){return e.focusAndRestorePos(),o.switchTreeOrList(!o.useTreeStyle),!1}).on("click","#target-cur-file-btn",function(){return e.focusAndRestorePos(),File.getMountFolder()&&o.getDelegate().focusToFile(b.getCurrentFilePath()),!1}).on("mousedown","#sidebar-menu-btn .sidebar-footer-item",function(){return e.focusAndRestorePos(),w(".show-sidebar-footer-context").length?n():o.showSidebarMenu(),!1}),w(".sidebar-tabs").on("click","#hide-sidebar-btn",function(){return e.focusAndRestorePos(),o.hideSidebar(),!1}).on("click","#switch-sidebar-icon",function(){return e.focusAndRestorePos(),o.switch(o.isFileTabShown()?"outline":"files"),!1}),w("#sidebar-files-menu").on("blur",function(){setTimeout(n,10)}).on("mousedown","#close-sidebar-menu-btn",function(){n()}).on("mousedown","#new-file-from-sidebar-menu",function(e){1==e.which&&o.newFile(File.getMountFolder())}).on("mousedown","#reveal-folder-from-sidebar-menu",function(e){1==e.which&&File.getMountFolder()&&JSBridge.openFolder(File.getMountFolder())}).on("mousedown","#search-from-sidebar-menu",function(e){1==e.which&&File.getMountFolder()&&o.fileSearch.show(!0)}).on("mousedown","#refresh-from-sidebar-menu",function(e){1==e.which&&o.refreshPanelCommand()}).on("mousedown","#open-folder-from-sidebar-menu",function(e){1==e.which&&(w("#sidebar-files-menu").trigger("blur"),setTimeout(o.selectFolder.bind(o),100))}).on("mousedown","[data-side-mode]",function(e){1==e.which&&o.switch(this.getAttribute("data-side-mode"))}).on("mousedown",".sidebar-folder-pin",async function(e){var t;e.stopPropagation(),e.preventDefault(),1==e.which&&(t="true"==(e=w(this).closest(".folder-menu-item")).attr("data-pinned"),e=e.attr("data-path"),await JSBridge.invoke("setting.updateRecentFile",{path:e,pinned:!t}),o.showSidebarMenu())}).on("mousedown",".sidebar-folder-remove",function(e){e.stopPropagation(),e.preventDefault(),1==e.which&&(e=w(this).closest(".folder-menu-item"),JSBridge.invoke("setting.removeRecentFolder",e.attr("data-path")),e.remove())}).on("mousedown",".folder-menu-item",function(e){1==e.which&&((File.isMacOrMacNode?e.metaKey:e.ctrlKey)?o.openWithCtrl(this.getAttribute("data-path"),!0):File.getMountFolder()!=this.getAttribute("data-path")&&JSBridge.invoke("controller.switchFolder",this.getAttribute("data-path")),n())}).on("mousedown","#ty-group-by-folder-btn",function(e){return o.getDelegate().setGroupByFolder(!o.getDelegate().noGroup),!1}).on("mousedown","#ty-sort-by-natural-btn",function(){return this.classList.contains("active")?o.setSortType(o.sortType()?E.Natural:E.NaturalDescend):o.setSortType(this.classList.contains("ty-sort-by-natural-d")?E.NaturalDescend:E.Natural),w(this).trigger("mouseenter"),!1}).on("mousedown","#ty-sort-by-name-btn",function(){return this.classList.contains("active")?o.setSortType(-o.sortType()):o.setSortType(this.classList.contains("ty-sort-a")?-1:1),w(this).trigger("mouseenter"),!1}).on("mousedown","#ty-sort-by-date-btn",function(){return this.classList.contains("active")?o.setSortType(-o.sortType()):o.setSortType(this.classList.contains("ty-sort-t")?-2:2),w(this).trigger("mouseenter"),!1}).on("mousedown","#ty-sort-by-create-btn",function(){return this.classList.contains("active")?o.setSortType(-o.sortType()):o.setSortType(this.classList.contains("ty-sort-new-down")?-3:3),w(this).trigger("mouseenter"),!1}).on("keydown",function(e){"Esc"!=g[e.keyCode||e.which]||e.metaKey||e.ctrlKey||this.blur()}),this.fileTree.bindEvents(),this.fileList.bindEvents(),File.isNodeHtml&&this.bindContext()}async execRenameFileByNode(e,t,n){const i=reqnode("fs-extra");var r=reqnode("path"),o=t;if(n){n=r.basename(t);try{o=File.option.tempPath+sep+"typora-undo"+sep+n,i.copySync(file,o,{overwrite:!0,preserveTimestamps:!0})}catch(e){o=""}}r=null;try{if(await this.tryChangeEmptyFileFormat(e,t))return[];var a=e,s=t;try{await i.rename(a,s)}catch(e){e&&"EPERM"==e.code&&await i.move(a,s,{overwrite:!0})}await 0}catch(e){r=e}return[r,o]}copyOrMoveFiles(e,p){var f,m,g=File.isWin?"\\":"/",t=File.getMountFolder();t&&(f=this,m=1==e.length&&this.isDiscardableUntitled(),e.forEach(function(e){var t,n,i,o,a,r,s,l,c;function d(e){v.showNotification("<strong>"+w.localize.getString("Operation Failed","Panel")+"</strong>  "+y.escape(e.message||""),!0),JSBridge.invoke("filesOp.clearUndo")}async function u(e,t,n){var i,[n,r]=await f.execRenameFileByNode(e,t,n);e=e,i=t,(t=n)?("EXDEV"==t.code||"EPERM"==t.code?a.copy(e,i,async function(e){e?d(e):r&&(await JSBridge.invoke("filesOp.clearUndo"),f.scheduleChangeHighlight(i))}):d(t),i=e):r&&JSBridge.invoke("filesOp.registerUndo",r,e,w.localize.getString("Move %@","Panel").replace("%@",reqnode("path").basename(e))),t||(o?File.isNode&&b.statWrapper(i,function(e){e.isFile&&b.isSupportedFile(e.name)&&f.openFile(i)}):f.scheduleChangeHighlight(i)),JSBridge.invoke("app.sendEvent","didRename",{oldPath:e,newPath:i})}function h(){JSBridge.invoke("app.sendEvent","willRename",{oldPath:i}),a.existsSync(l)?JSBridge.invoke("dialog.showMessageBox",{type:"warning",message:w.localize.getString("File/directory already exists at target path.","Panel"),buttons:[w.localize.getString("Keep Both","Panel"),w.localize.getString("Replace"),w.localize.getString("Cancel")],defaultId:1,cancelId:2}).then(({response:e})=>{0==e?function e(){var t=s.indexOf(".");s=(-1==t?s:s.substring(0,t))+" (copy)"+(-1==t?"":s.substring(t)),l=r.join(p,s),a.existsSync(l)?e():f.execRenameFileByNode(i,l).then(function([e]){e?(d(e),l=i):(JSBridge.invoke("filesOp.registerUndo",l,i,w.localize.getString("Move %@","Panel").replace("%@",reqnode("path").basename(i))),o?f.openFile(l):f.scheduleChangeHighlight(l)),JSBridge.invoke("app.sendEvent","didRename",{oldPath:i,newPath:l})})}():1==e?u(i,l,!0):(l=i,JSBridge.invoke("app.sendEvent","didRename",{oldPath:i,newPath:l}))}):u(i,l)}e!=p&&(0==p.indexOf(e+g)||e.substring(0,e.lastIndexOf(g))==p?f.getDelegate().highlight(e):File.isNode?(i=e,o=m,a=reqnode("fs-extra"),r=reqnode("path"),s=r.basename(i),l=r.join(p,s),c=f.useTreeStyle?"noWarnigForMoveFile":"noWarnigForMoveFileToList",File.option[c]?h():v.showWarningDialog(w.localize.getString("Are you sure you want to move %@?","Panel").replace("%@",s),!0).then(({response:e,checkboxChecked:t})=>{0==e&&(h(),t)&&(JSBridge.execForAll("window.File && File.option && (File.option.%@ = true)".replace("%@",c)),JSBridge.putSetting(c,!0))})):File.isMac&&(e=e,t=m,n=b.getFileNameFromPath(e),t=t&&b.isSupportedFile(n),n=p+"/"+n,bridge.callHandler("library.moveFile",{source:e,dest:n,shouldOpen:t||!1})))}))}sortType(){return x(this.getDelegate().sortType,this.fileList.sortType||this.fileTree.sortType||0)}dateAffectsSort(){return l.isType(this.sortType,E.Date,E.DateDescend,E.CreateDate,E.CreateDateDescend)}compareItem(e,t){var n;return e&&t?(n=this.sortType())==E.Alphabet?i(e.name,t.name):n==E.Date?e.lastModified-t.lastModified:n==E.AlphabetDescend?i(t.name,e.name):n==E.DateDescend?t.lastModified-e.lastModified:n==E.CreateDate?e.createDate-t.createDate:n==E.CreateDateDescend?t.createDate-e.createDate:n==E.NaturalDescend?-y.naturalCompare(e.name,t.name):y.naturalCompare(e.name,t.name):1;function i(e,t){if(e==t)return 0;e=e.toLowerCase(),t=t.toLowerCase();var n=e.replace(/\..+/,""),i=t.replace(/\..+/g,"");return File.isWin?n==i?0==[e,t].sort().indexOf(e)?-1:1:0==[n,i].sort().indexOf(n)?-1:1:n==i?e.localeCompare(t):n.localeCompare(i)}}setSortType(e){w(".ty-side-sort-btn2").removeClass("active"),e==E.Alphabet?w("#ty-sort-by-name-btn").removeClass("ty-sort-a").addClass("active").attr("ty-hint",w.localize.getString("Sort by Name (Ascending)")):e==E.Date?w("#ty-sort-by-date-btn").removeClass("ty-sort-t").addClass("active").attr("ty-hint",w.localize.getString("Sort by Modification Date (Ascending)")):e==E.AlphabetDescend?w("#ty-sort-by-name-btn").addClass("ty-sort-a").addClass("active").attr("ty-hint",w.localize.getString("Sort by Name (Descending)")):e==E.DateDescend?w("#ty-sort-by-date-btn").addClass("ty-sort-t").addClass("active").attr("ty-hint",w.localize.getString("Sort by Modification Date (Descending)")):e==E.CreateDate?w("#ty-sort-by-create-btn").removeClass("ty-sort-new-down").addClass("active").attr("ty-hint",w.localize.getString("Sort by Creation Date (Ascending)")):e==E.CreateDateDescend?w("#ty-sort-by-create-btn").addClass("ty-sort-new-down").addClass("active").attr("ty-hint",w.localize.getString("Sort by Creation Date (Descending)")):e==E.NaturalDescend?w("#ty-sort-by-natural-btn").addClass("ty-sort-by-natural-d").addClass("active").attr("ty-hint",w.localize.getString("Sort Naturally (Descending)")):w("#ty-sort-by-natural-btn").removeClass("ty-sort-by-natural-d").addClass("active").attr("ty-hint",w.localize.getString("Sort Naturally (Ascending)")),this.getDelegate().sortType!=e&&this.getDelegate().setSortType(e)}selectFolder(){var t;File.isMac?bridge.callHandler("controller.selectFolder"):(t=this,JSBridge.invoke("dialog.showOpenDialog",{buttonLabel:w.localize.getString("Select"),properties:["openDirectory"]}).then(({filePaths:e})=>{e=(e||[])[0];e&&t.onRootChanged(e)}))}showSidebarMenu(){w(".sidebar-footer").addClass("show-sidebar-footer-context");var t,c=w("#sidebar-files-menu").focus(),i=w("#folder-menu-item-template").html();function d(e,t){var n=w(i);return n.find("span").text(e.name),n.attr("data-path",e.path),n.attr("data-pinned",e.pinned),n.attr("ty-hint",y.abbreviatingWithTilde(e.path)),e.pinned&&n.find(".sidebar-folder-pin").attr("ty-hint","Unpin"),t.before(n),n}t=function(e){c.find(".folder-menu-item").remove().end().find(".folder-menu-group").show();for(var t,n=w(".sidebar-content").height(),i=c.find("#reveal-folder-from-sidebar-menu")[0].clientHeight,r=c[0].clientHeight,n=Math.max(0,Math.min(6,Math.floor((n-r-20)/i))),o=[],a=[],s=(e.forEach(function(e){e.path===File.getMountFolder()?t=e:(e.pinned?o:a).push(e)}),File.getMountFolder()&&!t&&(t={path:File.getMountFolder(),name:b.getFileNameFromPath(File.getMountFolder()),pinned:!1}),e=(e=o.concat(a)).slice(0,n),w("#folder-menu-item-after")),l=0;l<e.length;l++)d(e[l],s);t?d(t,s).addClass("selected-folder-menu-item"):0==e.length&&c.find(".folder-menu-group").removeClass("show")},File.isMac?bridge.callHandler("library.getRecentFolders",t):File.isNode?JSBridge.invoke("setting.getRecentFiles").then(e=>{t(e.folders)}):t([])}init(){this.bindEvents();var t=this;File.option.sidebarTab&&this.show(),File.isMac&&!b.getCurrentFilePath()&&bridge.callHandler("controller.shouldLoadFolder",function(e){!e||t.isFileTabShown()||t.show(t.useTreeStyle?"file-tree":"file-list")})}switch(e,t){var n;w(".sidebar-content").scrollTop(0),"outline"==e?(this.fileSearch.hide(),w("#typora-sidebar").addClass("active-tab-outline").removeClass("active-tab-files"),w("[data-side-mode]").removeClass("selected-folder-menu-item"),w("[data-side-mode='outline']").addClass("selected-folder-menu-item"),w("#sidebar-footer-main-item-label").text(w.localize.getString("Outline")),this.outline.highlightVisibleHeader(),(this.useTreeStyle?(n=w.localize.getString("Switch to File Tree view"),w("#switch-sidebar-icon").html('<span class="ty-icon ty-file-tree"></span>')):(n=w.localize.getString("Switch to File List view"),w("#switch-sidebar-icon").html('<span class="ty-icon ty-three-cells"></span>'))).attr("ty-hint",n).attr("aria-label",n)):(this.outline.hideSearch(),w("#typora-sidebar").removeClass("active-tab-outline").addClass("active-tab-files"),n=this.useTreeStyle||!1,"file-list"==e?n=!1:"file-tree"==e?n=!0:e=n?"file-tree":"file-list",this.switchTreeOrList(n),this.refreshMenuVisibility(),w("#switch-sidebar-icon").html('<span class="ty-icon ty-list"></span>').attr("ty-hint",w.localize.getString("Switch to Outline view"))),w("#switch-sidebar-icon").localize("Front",{language:File.language,pathPrefix:"locales"}),JSBridge.putSetting("sidebar_tab",e),File.isNode?window.ClientCommand.refreshViewMenu():(this.updateMenu(e),w(".sidebar-tab").removeClass("active").filter("outline"==e?"#sidepanel-segmented-input-outline":"#sidepanel-segmented-input-files").addClass("active"))}shouldIgnore(e){e="/"+(e||"").substring((File.getMountFolder()||"").length);return!!/[\\\/](\.\w|node_modules[\\\/])/.exec(e)}calcMountFolder(o){var i=this;return new Promise(function(t,e){function n(e){File.mountFolder_=e,t(e),i.isFileTabShown()&&i.refreshMenuVisibility()}File.isMac?bridge.callHandler("controller.calcMountFolder",n):File.mountFolder_?n(File.getMountFolder()):File.isNode&&n(function(e){var t=reqnode("path"),n=reqnode("fs"),i=e;if(!e)return null;for(;i&&/^\w*\/+\w/.exec(i);){var r=n.readdirSync(i);if(-1<r.indexOf(".git")||-1<r.indexOf(".svn")||-1<r.indexOf(".hg")||-1<r.indexOf("package.json"))return i;if(/((dropbox\/apps\/[^\/]+)|pages|articles?|blogs?|content)\/?$/i.exec(i))return i;if(/(_?posts?|_?drafts?)\/?$/i.exec(i))return i;if(/(node_modules)\/[^\/]+\/?$/i.exec(i))return i;r=i;if((i=t.join(i,"../"))==r||o)break}return e||null}(b.getCurrentFileFolderPath()))})}renderIfNeed(){return(this.useTreeStyle?this.fileTree:this.fileList).renderIfNeed()}findElemFromPath(e){return w(".file-library-node[data-path='"+y.escapeSelector(e)+"']")}revealInSidebar(){this.fileSearch.hide(),this.isFileTabShown()?this.markCurrentFile():b.getCurrentFilePath()&&this.showSidebar("files")}revealInFileList(){this.showSidebar("file-list"),this.markCurrentFile()}revealInFileTree(){this.showSidebar("file-tree"),this.markCurrentFile()}markCurrentFile(e,t){var n=b.getCurrentFilePath();n&&(this.markOpenedFile(n),t||this.getDelegate().focusToFile(n,e),this.fileSearch.markOpenedFile(n))}markOpenedFile(e){return e?(e=this.findElemFromPath(e),w(".file-library-node.active").removeClass("active"),e.length&&e.addClass("active"),e):w()}end(){if(this.fileTree.needRepaint(),this.fileList.needRepaint(!0),this.root=null,File.mountFolder_=null,this.fsWatcher)this.fsWatcher.close(),this.fsWatcher=null,this.watchedFolder=null,F&&clearTimeout(F);else{for(var e in this.unixWatchers)this.unixWatchers[e]&&this.unixWatchers[e].close();this.unixWatchers={}}}refreshMenuVisibility(){var e=w("#ty-sidebar-footer");File.getMountFolder()?(e.find(".empty-menu-group").removeClass("show"),e.find(".not-empty-menu-group").addClass("show"),w("#typora-sidebar").removeClass("ty-no-mount-folder"),this.isReadOnlyRoot()?document.querySelector("#sidebar-new-file-btn").classList.add("hide"):document.querySelector("#sidebar-new-file-btn").classList.remove("hide")):(e.find(".empty-menu-group").addClass("show"),e.find(".not-empty-menu-group").removeClass("show"),w("#typora-sidebar").addClass("ty-no-mount-folder")),w("#sidebar-footer-main-item-label").text(b.getFileNameFromPath(File.getMountFolder())||w.localize.getString("Open Folder..."))}isReadOnlyRoot(){var e=File.getMountFolder();if(e)return File.isMac?-1<e.toLowerCase().indexOf("typora.app"):!window.debugMode&&(window.dirname?-1<e.toLowerCase().indexOf(window.dirname.toLowerCase()):void 0)}onRootChanged(e,t){var n;this.end(),e&&(File.setMountFolder(e),File.isNode)&&!t&&JSBridge.invoke("setting.addRecentFolder",e),w("#file-library:visible").length&&this.renderIfNeed(),this.editor.quickOpenPanel?this.editor.quickOpenPanel.cacheFolder(e):(n=this.editor,setTimeout(function(){n.quickOpenPanel&&n.quickOpenPanel.cacheFolder(e)},1e3)),this.refreshMenuVisibility()}setMountFolder(e,t,n){this.silent=n,this.onRootChanged(e),t&&this.showSidebar(this.useTreeStyle?"file-tree":"file-library",!0)}onFileUpdated(e){var t=(e||{}).path;try{t==File.bundle.filePath&&(File.bundle.modifiedDate=e.lastModifiedDate),this.fileList.onFileUpdated(t,e),this.fileTree.onFileUpdated(t)}catch(e){console.warn(e)}try{this.pauseOnChange(!0,t)}catch(e){}}onFileChanges(e){var t,n,i;File.getMountFolder()&&(this.fileTree.onChangeForMac(e),this.fileList.onChangeForMac(e),t=!1,n=b.getCurrentFilePath(),e.map(function(e){e.oldPath==n&&"rename"==e.type&&(t=!0)}),t)&&(i=this,setTimeout(function(){i.markCurrentFile()},1e3))}getDelegate(){return this.useTreeStyle?this.fileTree:this.fileList}isDiscardableUntitled(){return!(File.isDocumentEdited()||File.bundle.filePath)}newFile(e){File.getMountFolder()&&this.getDelegate().newFile(e)}openFileCommand(e){e||retrun;e=this.editor.getJQueryElem(e).closest(".file-library-node, .ty-search-item").attr("data-path");this.openFile(e),this.outline.autoHideOutline()}openFileInNewWindowCommand(e){var t;(e=this.editor.getJQueryElem(e).closest(".file-library-node, .ty-search-item")[0])&&(t="true"==e.dataset.isDirectory,e=e.dataset.path,this.openFileInNewWindow(e,t))}copyFullPathCommand(e){e=this.editor.getJQueryElem(e).closest(".file-library-node, .ty-search-item").attr("data-path");this.editor.UserOp.setClipboard("<span>"+e+"</span>",null,e,!0)}revealFileInFinderCommand(e){e="string"==typeof e?e:this.editor.getJQueryElem(e).closest(".file-library-node, .ty-search-item").attr("data-path");JSBridge.showInFinder(e)}renameFileCommand(e,t){this.getDelegate().renameFileCommand(e,t)}newFileCommand(e,t){this.getDelegate().newFileCommand(e,t)}newFolderCommand(e){this.fileTree.newFolderCommand(e)}doDeleteFile(r,e,o){var t,a=e?this.editor.getJQueryElem(e).closest(".file-library-node"):this.findElemFromPath(r),n=(r=r||a.attr("data-path"))==b.getCurrentFilePath();function s(){var e;n&&(e=t.useTreeStyle?w():a.filter(".file-list-item").next(),!o&&e.length?t.openFileCommand(e[0]):File.isNode?C(null,()=>{o&&o(!0)}):o&&o(!0))}async function i(){if(await JSBridge.invoke("shell.trashItem",r))s(),a.hide(),JSBridge.invoke("filesOp.clearUndo"),JSBridge.invoke("app.sendEvent","updateQuickOpenCache",{toDel:r});else{var t=File.option.tempPath+"/"+(new Date).getTime(),n=reqnode("fs-extra"),i=!1;try{await n.copyFile(r,t),i=!0}catch(e){}JSBridge.invoke("dialog.showMessageBox",{type:"info",title:w.localize.getString("Operation Failed","Panel"),message:w.localize.getString("Failed to move target file or folder to trash","Panel"),defaultId:0,cancelId:2,buttons:[w.localize.getString("Reveal in File Explorer"),w.localize.getString("Delete Permanently"+(i?"":" (cannot be undo)")),w.localize.getString("Cancel")]}).then(({response:e})=>{0==e?(JSBridge.invoke("shell.openItem",r),o&&o(!1)):1==e?n.unlink(r,function(e){e?JSBridge.invoke("dialog.showMessageBox",{type:"info",title:w.localize.getString("Error","Panel"),message:w.localize.getString("Operation Failed","Panel"),detail:e.stack||e.message||(e||"").toString(),defaultId:0,cancelId:1,buttons:[w.localize.getString("Reveal in File Explorer"),w.localize.getString("Cancel")]}).then(({response:e})=>{0==e&&JSBridge.invoke("shell.openItem",r),o&&o(!1)}):(i?JSBridge.invoke("filesOp.registerUndo",t,r,w.localize.getString("Delete %@","Menu").replace("%@",reqnode("path").basename(r))):JSBridge.invoke("filesOp.clearUndo"),s())}):o&&o(!1)})}}r?(t=this,File.isMac?bridge.callHandler("library.trashItem",r,function(e){e&&(s(),a.hide()),o&&o(e)}):File.isNode&&(File.option.noWarnigForDeleteFile?i():(e=reqnode("path").basename(r),JSBridge.invoke("dialog.showMessageBox",{type:"question",message:w.localize.getString("Are you sure you want to delete %@?","Panel").replace("%@",e),detail:w.localize.getString("You can restore from the Trash.","Panel"),defaultId:0,cancelId:1,buttons:[w.localize.getString("OK"),w.localize.getString("Cancel")],checkboxLabel:w.localize.getString("Do not show this again","Panel")}).then(({response:e,checkboxChecked:t})=>{0==e?(t&&(JSBridge.execForAll("window.File && File.option && (File.option.noWarnigForDeleteFile = true)"),JSBridge.putSetting("noWarnigForDeleteFile",!0)),i()):o&&o(!1)})))):o&&o(!1)}deleteFileCommand(e){this.doDeleteFile(null,e)}showFilePropertyCommand(e){e=this.editor.getJQueryElem(e).closest(".file-library-node").attr("data-path");e&&(File.isWin?b.winShell().openProperties(File.bundle.filePath):File.isMac&&bridge.callHandler("library.showProperty",e))}duplicateFileCommand(e){var n,r=this.editor.getJQueryElem(e).closest(".file-library-node").attr("data-path"),c=this;async function d(e){if(c.isDiscardableUntitled())return!0;if(e!==File.bundle.filePath)return!1;if(File.option.enableAutoSave||File.option.saveFileOnSwitch)return!0;if(File.isMac&&await JSBridge.invoke("controller.canSwitchWithoutAsk"))return!0;return!(File.isMac||File.bundle.hasModified&&File.changeCounter.isDocumentEdited())||new Promise(function(n,e){v.showNativeDialog({message:w.localize.getString("Current document contains unsaved changes. Do you want to switch to newly duplicated file?","Panel"),buttons:[w.localize.getString("Ok","Panel"),w.localize.getString("Cancel")],callback:function(e,t){n(0===e)}})})}function t(){var e=reqnode("path"),t=e.basename(r),n=t.lastIndexOf("."),i=e.dirname(r),s=reqnode("fs"),l=e.sep;n<0&&(n=newFileName.length),e=t.substr(n),t=t.substr(0,n),JSBridge.invoke("filesOp.clearUndo"),function t(n,i,r,o){i="%@ (copy)".replace("%@",i);var a=o+l+i+r;s.copyFile(n,a,s.constants.COPYFILE_EXCL,function(e){e?"EEXIST"==e.code?t(n,i,r,o):e&&v.showNotification("<strong>"+w.localize.getString("Operation Failed","Panel")+"</strong>  "+y.escape(e.message||""),!0):(c.scheduleChangeHighlight(a),File.isWin&&u(a),d(n).then(function(e){e&&c.openFile(a)}))})}(r,t,e,i)}function u(e){var t=c.findElemFromPath(r),n=File.isMac?e.replace(/\/[^\/]+$/,""):reqnode("path").dirname(e),n=c.getDelegate().onAddFile({isDirectory:!1,isFile:!0,name:b.getFileNameFromPath(e),path:e,folderPath:n,folderName:b.getFileNameFromPath(n),lastModified:new Date,summary:t.find(".file-list-item-summary").text(),fetched:!0});n&&(c.getDelegate().focusToFile(e,!1,!0),c.renameFileCommand(n,!0))}File.isNode?t():(n=r,bridge.callHandler("library.duplicate",n,function(t){t&&(d(n).then(function(e){e&&c.openFile(t)}),c.scheduleChangeHighlight(t),u(t))}))}scheduleChangeHighlight(e){this.nextChangeHighlight=e;var t=this;t.getDelegate().highlight(e),this.nextChangeHighlightTimer&&clearTimeout(this.nextChangeHighlightTimer),this.nextChangeHighlightTimer=setTimeout(function(){t.nextChangeHighlight=null,t.nextChangeHighlightTimer=null},2e3)}refreshPanelCommand(){var e=File.getMountFolder();e&&(this.end(),File.isNode?(File.setMountFolder(e),this.renderIfNeed(),this.refreshMenuVisibility()):bridge.callHandler("controller.switchFolder",e,function(){bridge.callHandler("controller.bindFolderMonitor")}))}async tryChangeEmptyFileFormat(e,t){var n=reqnode("node:fs/promises"),i=b.getExtension(e).toLowerCase(),r=b.getExtension(t).toLowerCase();return!(!("textbundle"!=i&&"textbundle"==r||"textbundle"==i&&"textbundle"!=r)||!await d.isEmptyFile(e)||(await n.rm(e,{force:!0,recursive:!0}),File.FileSave.saveAsUseNode(t),JSBridge.invoke("filesOp.clearUndo"),0))}async cannotRename(e,t,n){var i;return!!File.option.supportTextBundle&&!((i=b.getExtension(e).toLowerCase())===(t=b.getExtension(t).toLowerCase())||"textbundle"!==i&&"textpack"!==i&&"textbundle"!==t&&"textpack"!==t||await d.isEmptyFile(e)||(v.showWarningDialog(w.localize.getString('Cannot rename from $1 to $2, please use "File" → "Move To…" from menubar instead.'.replace("$1",r(i)).replace("$2",r(t)),"Panel")),0));function r(e){return"textbundle"===e?"TextBundle file":"textpack"===e?"TextPack file":"Markdown file"}}bindRename(i,n,r,o,t,a,s,l){var c,d,u=i.val(),h=this;function p(e){return(File.isWin?e.replace(/[\\\/:*?"<>\|\000-\031]/g,""):e.replace(/[\/\\\000-\031]/g,"")).trim()}async function f(){var e,t;d||(d=!0,e=p(i.val()),t=File.isWin?"\\":"/",0<e.length&&e!=u&&(o||s||!await h.cannotRename(l+t+u,l+t+e,a))?(i.val(e),n(i)):r())}function m(e){var t=i.val(),n=t.lastIndexOf(".");0<(n=n<0&&e?t.length:n)&&i[0].setSelectionRange(0,n)}i.off("blur").on("blur",function(){if(!c){if(h.stopRename)return!1;var e;c=!0,t?f():((e=i).val(p(e.val())),u==e.val()?r():v.confirm(w.localize.getString('Rename to "{0}" ?').format(e.val()),function(e){h.markFocusOnDialogClose(),f()},function(){r()}))}}).off("keydown").on("keydown",function(e){return"Enter"==g[e.keyCode||e.which]?(c=!0,f(),!1):"Esc"==g[e.keyCode||e.which]?(c=!0,r(),!1):"A"==g[e.keyCode||e.which]&&(File.isMacOrMacNode?e.metaKey:e.ctrlKey)?(m(!0),!1):void 0}).off("mousedown").on("mousedown",function(e){e.stopPropagation()}).off("click").on("click",function(e){e.stopPropagation()}).off("dblclick").on("dblclick",function(e){if(this.selectionEnd==this.value.length)return m(),!1}).on("focus",m)}}}),$__System.registerDynamic("45",["2b","e","11","13","19","12","14","1a","18","1c","27","2a","25","31","28","17","46","2e","1b","26","2f","29","34","47","48","41","2c","35","49","36","37","4a","3a","32","3b","3c","4b","3d","44"],!0,function($__require,exports,module){"use strict";var global=this||self,GLOBAL=global,_polyfill=$__require("2b"),$=$__require("e"),StringUtils=$__require("11"),NodeDef=$__require("13"),Node=NodeDef.Node,TYPE=NodeDef.TYPE,MarkParser=$__require("19"),Node2Mark=$__require("12"),Node2HTML=$__require("14"),NodeOperation=$__require("1a"),Fences=$__require("18"),MathBlock=$__require("1c"),MathInline=$__require("27"),Brush=$__require("2a"),AutoComplete=$__require("25"),Selection=$__require("31"),rangy=Selection.rangy,EditHelper=$__require("28"),HTMLBlock=$__require("17"),TableEdit=$__require("46"),ImageEdit=$__require("2e"),UndoManager=$__require("1b"),SnapFlag=UndoManager.SnapFlag,KeyMaster=$__require("26"),keyNames=KeyMaster.map,UserOp=$__require("2f"),MediaOp=$__require("29"),FileInfoPanel=$__require("34"),File=$__require("47"),FileAction=$__require("48"),DocMenu=$__require("41"),Stylize=$__require("2c"),SearchPanel=$__require("35"),Emoji=$__require("49"),WordCount=$__require("36"),Word=$__require("37"),Export=$__require("4a"),SourceView=$__require("3a"),FileHelper=$__require("32"),LocalSettingBridge=$__require("3b"),QuickOpenPanel=$__require("3c"),ContextMenu=$__require("4b"),SpellCheck=$__require("3d"),Library=$__require("44"),DBCLICK_DELAY=180,clicks=0,clickTimer=null,busyLoadTimer,$curLinkElem,isInputComponent=function(e){return!!e&&("TEXTAREA"==e.tagName||"INPUT"==e.tagName||"SELECT"==e.tagName||e.classList&&e.classList.contains("ty-input"))};window.isInputComponent=isInputComponent;class Editor{constructor(e,t){this.sessionStr=e,this.EditHelper=EditHelper,this.MarkParser=MarkParser,this.writingArea=document.querySelector(this.sessionStr),t.setEditor(this),t.readOption(),t._onInitTheme=!0,t.setTheme(),setTimeout(function(){t._onInitTheme=!1},300),this.nodeMap=new NodeDef.NodeMap,this.imgEdit=new ImageEdit(this),this.docMenu=new DocMenu(this),this.undo=new UndoManager(this),this.localSettingBridge=new LocalSettingBridge(this),t.exitOversize(),this.registerBridge(),t.setup(),t.loadFile(t.option.initFilePath),this.library=new Library(this),this.library.init(),this._pasteboard={},this.timerPool_={},this._bindGlobal(),this._bindKeyEvents(),this._bindMouseEvents(),this.focusCid=null,this.selection=new Selection(this),this.keypressMsg="",this.mathInline=new MathInline(this),this.wordCount=new WordCount(this),this.brush=new Brush(this),this.tableEdit=new TableEdit(this),this.fences=new Fences(this),this.mathBlock=new MathBlock(this),this.htmlBlock=new HTMLBlock(this),this.stylize=new Stylize(this),this.brush.run(),this.UserOp=UserOp,this.searchPanel=new SearchPanel(this),this.writingArea.focus(),this.sourceView=new SourceView(this),this.emoji=new Emoji(this),this.word=new Word(this),this.export=new Export(this),(t.isMac||t.isNode)&&setTimeout(t.bindMenu,200),t.freshLock(),this.quickOpenPanel=new QuickOpenPanel(this),this.quickOpenPanel.init(),this.spellChecker=new SpellCheck(this),this.contextMenu=new ContextMenu(this.sessionStr),this.dropTargetDom=null,this.strollingBySelect=!1,this.updateFocusMode(t.isFocusMode,!0,!0),this.setTypeWriterMode(t.isTypeWriterMode,!0,!0),setTimeout(function(){t.option.silentOpenFailure=!1},2e3),this.autoComplete=new AutoComplete(this),this.useIMEKeyboard=!1,this.busyModeSource}registerBridge(){var n;File.isMac&&(n=this,bridge.registerHandler("editor.applyChange",function(e,t){n.applyChange(e),t&&t()}),bridge.registerHandler("editor.applyFullContent",function(e,t){n.applyFullContent(e[0],e[1]).then(()=>{t&&t()})}),bridge.registerHandler("editor.insertText",function(e,t){n.insertText(e),t&&t()}),bridge.registerHandler("editor.setPasteboard",function(e,t){n.setPasteboard(e[0],e[1]),t&&t()}),bridge.registerHandler("editor.resetPasteboard",function(e,t){n.resetPasteboard(),t&&t()}),bridge.registerHandler("window.showNotificationWithTitle",function(e,t){EditHelper.showNotificationWithTitle(e[0],e[1]),t&&t()}),bridge.registerHandler("editor.showZoomPanel",function(e,t){EditHelper.showZoomPanel(e),t&&t()}),bridge.registerHandler("editor.getSpeechText",function(e,t){t(UserOp.getSpeechText())}),bridge.registerHandler("editor.jumpToAnchor",function(e,t){"#"==(e||"")[0]&&1<e.trim().length&&(File._onInitParse?File.option.initAnchor=e:(File._scrollTopTimer&&clearTimeout(File._scrollTopTimer),File._scrollTopTimer=setTimeout(()=>{n.tryOpenUrl(e)},0))),t&&t()}))}beforeSpellChecking(){File.isLocked||setAttributeOnlyNeeded(this.writingArea,"contenteditable","true");var e=this.writingArea.children[0];e&&"false"==e.getAttribute("contenteditable")?(e.setAttribute("contenteditable","true"),this.afterSpellChecking=function(){e.setAttribute("contenteditable","false")}):this.afterSpellChecking=function(){}}freeLayout(){File.isLocked||setAttributeOnlyNeeded(this.writingArea,"contenteditable","true")}tryEnterBusyModeWithDelay(e){busyLoadTimer&&clearTimeout(busyLoadTimer),busyLoadTimer=setTimeout(()=>{this.tryEnterBusyMode()},e||100)}tryEnterBusyMode(e,t,n){var i,r=this.writingArea,o=this;function a(){File.inBusyMode||console.sendLog("enter busy mode"),File.inBusyMode=!0,File.editor.brush.interval=500,t||setAttributeOnlyNeeded(r,"contenteditable","false")}function s(e){e&&o.busyModeSource&&o.busyModeSource!==e||(o.busyModeSource=null,File.inBusyMode&&console.sendLog("leave busy mode"),File.inBusyMode=!1,File.editor.brush.interval=200,File.isLocked)||t||setAttributeOnlyNeeded(r,"contenteditable","true")}void 0!==n?(n?a:s)():(n=this.useIMEKeyboard||File.isMac,null!=e?File.inBusyMode||(e.length>1e3*(n?35:60)?(a(),this.busyModeSource="content"):s("content")):(e=r.innerHTML.length,(i=1e4<this.nodeMap.allNodes.length||1e3*(n?1500:3e3)<e)||(e+=1e3*r.querySelectorAll("img, svg, .CodeMirror").length*5,File.option.showLineNumbersForFence&&(e+=1e3*r.querySelectorAll(".CodeMirror").length*2),i=1e3*(n?1200:2400)<e),i?(a(),this.busyModeSource="html"):s("html")))}runAllScript(){this.scriptTimer&&(clearTimeout(this.scriptTimer),this.scriptTimer=null);var writingArea=this.writingArea;this.scriptTimer=setTimeout(function(){writingArea.querySelectorAll("script[data-run]").forEach(function(d){d.removeAttribute("data-run"),eval(d.textContent)})},100)}reset(e){window.Reporter.record("editor.reset"),File._onInitParse=!0,File.bundle.unsupported&&(e="");var t=new NodeDef.Node({type:NodeDef.TYPE.raw_edit,in:this.nodeMap,attachTo:this.nodeMap,text:e}),n=(this.writingArea.innerHTML=t.parseFrom({skips:{old_code:!1}})[0],this.tryEnterBusyMode(e),this.focusCid=null,this.lastCursor=null,File._needsUpdateSnap=new Date,File._onInitParse=!1,this);setTimeout(function(){n.refresh(void 0,void 0,!0),n.wordCount&&n.wordCount.update(e)},80),this.spellChecker&&this.spellChecker.reset(),this.fences&&this.fences.onLeaveDocument(),this.mathInline&&this.mathInline.onLeaveDocument(),document.querySelectorAll("[guest-id]").forEach(window.loadedWebview),window.Reporter.fullValidate()}quickRefresh(){this.refresh(!1,!0)}refreshUnder(e,t,n){let i;return t||(i=n&&!File.inBusyMode?this.mathBlock.forceRefresh():this.mathBlock.renderUnder(e,n),this.docMenu&&this.docMenu.refreshFootnoteReverseLink(e)),this.fences.modeLoaded&&this.fences.refreshEditor(!1,t,e),this.diagrams.modeLoaded&&(t&&File.editor.diagrams.loadMermaidTheme(),this.diagrams.refreshDiagram(t,e)),!t&&this.htmlBlock&&this.htmlBlock.refreshUnder(e),e&&this.wordCount.quickUpdate(e.getAttribute("cid"),!0),i}refresh(e,t,n){var i;File._onInitParse||(i=File.isActiveWindow(),this.sourceView&&this.sourceView.inSourceMode?e&&this.sourceView.cm.refresh():this.brush?($(this.writingArea).find(".md-mathblock-panel").length||this.mathBlock&&(this.mathBlock.currentCm=void 0),t||e||this.nodeMap.toc.refresh(!0),n=this.refreshUnder(void 0,e,n),i&&!e&&(this.wordCount.quickUpdate(this.focusCid,!0),this.brush&&this.stylize&&(isInputComponent(document.activeElement)||this.brush.expand(void 0,!0),File.isNode)&&File.refreshImageCopyStatus(!0),this.runAllScript(),$("#typora-table-row-tracker, #typora-table-col-tracker").hide(),this.tryEnterBusyModeWithDelay(500),n)&&n.then(()=>{this.tryEnterBusyModeWithDelay()})):this._brushInitCallback=function(){this.refresh(e,t)}.bind(this))}getJQueryElem(e){return e?e.nodeType==e.ELEMENT_NODE?$(e):$(e.parentNode):$()}getMarkElem(e){return!e&&document.activeElement.nodeType==window.Node.ELEMENT_NODE&&("write"!==document.activeElement.id&&document.activeElement.hasAttribute("tabindex")||Node.isType(document.activeElement.tagName,"TEXTAREA","INPUT"))?$(document.activeElement).closest("[cid]"):(e=e||window.getSelection().focusNode||document.activeElement)?(!(e=e.nodeType==e.ELEMENT_NODE?$(e):$(e.parentNode)).length||"TH"!==e[0].tagName&&"TD"!==e[0].tagName||(e=e.children(".td-span")),StringUtils.isNullOrEmpty(e.attr("cid"))?e.closest("[cid]"):e):[]}autoRemoveUnholdable(e){var t,n,i,r,o=this.focusCid&&this.findElemById(this.focusCid).closest(".unholdable");if(o&&o.length)try{this.undo.endSnap(!0),o.next().length||o.text().length?o.removeClass("unholdable"):(t=this.findNodeByElem(o),n=n||UndoManager.makeEmptyCommand(this.selection.buildUndo()),i=this.selection.getRangy(),(!o[0]||i.commonAncestorContainer!==o[0]&&!o[0].contains(i.commonAncestorContainer))&&(this.undo.UndoManager.addUndoForRemove(n,t),n.redo.push(this.selection.buildUndo(i)),r=t.getVeryFirstBrother(!0,!0))&&!e&&(t.remove(),o.remove(),this.selection.jumpIntoElemEnd(this.findElemById(r.cid)),n.redo.push(this.selection.buildUndo()),this.undo.register(n),this.refocus(r.cid,!1,!0)))}catch(e){console.warn(e.stack)}else $("#write .unholdable").filter(function(){return this.textContent.length}).removeClass("unholdable")}store(e,t){if((!this.sourceView||!this.sourceView.inSourceMode)&&(e=e||this.focusCid)){e=e.id?e:this.nodeMap.allNodes.get(e);if(e){var n,i=this.findElemById(e.id);if(0<i.length)return n=i.rawText(!0),Node.isType(e,TYPE.hr,TYPE.toc)||(Node.isType(e,TYPE.meta_block)?(n=n.replace(/\n$/,""),e.set("text",n)):Node.isType(e,TYPE.math_block)?i.find(".CodeMirror-code").length&&this.mathBlock.syncToNode(e):Node.isType(e,TYPE.fences)?i.find(".CodeMirror-code").length&&this.fences.syncToNode(e):Node.isType(e,TYPE.html_block)?i.find(".CodeMirror-code").length&&this.htmlBlock.syncToNode(e):Node.isType(e,TYPE.def_footnote,TYPE.def_link)?Node.reverseAttrFromElem(e,i.clone(),void 0,!0):Node.isType(e,TYPE.heading,TYPE.raw_edit,TYPE.paragraph,TYPE.table_cell)&&!i[0].querySelector("[cid]")?Node.isType(e,TYPE.paragraph)?e.set("text",n.replace(/^( {4}|\t)/,"​$1")):e.set("text",n):t&&e.get("children").map(function(e){i[0].querySelector("[cid='"+e.cid+"']")?this.store(e):e.remove()},this)),e&&this.wordCount.quickUpdate(e,!1,!0),Node.isType(e,Node.TYPE.meta_block)&&!t&&this.imgEdit.updateLocalRootUrl(),e;this.focusCid=null}}}cleanTooltip(){$("content").find(".auto-suggest-container.ty-show").removeClass("ty-show"),normalCleanTooltip_(),this.mathBlock.stopEditing()}refocus(e,t,n,i,r){if(clickTimer&&clearTimeout(clickTimer),this.isIME)return e;if(!this.sourceView||!this.sourceView.inSourceMode){var o,a,s=e?this.findElemById(e):this.getMarkElem(),l=this,c=this.nodeMap.allNodes.get(this.focusCid),d=l.findElemById(this.focusCid);if(l.library&&l.library.outline.autoHideOutline(),e=void 0===(e=e&&s.find("[cid]").length?(s=this.getMarkElem()).attr("cid"):e)?s.attr("cid"):e,t&&e&&l.store(e),this.focusCid!=e||!s.hasClass("md-focus")){if(this.focusCid!=e&&(t=l.findElemById(l.focusCid),r?t.trigger("endfocus"):t.trigger("blur").trigger("losefocus"),t.find(".md-tooltip-hide").hide(),normalCleanTooltip_(),Node.isType(c,Node.TYPE.paragraph)&&c.unset("depth"),l.undo.endSnap()),this.focusCid==e)return s.hasClass("md-focus")||s.addClass("md-focus").trigger("refocus"),e;if((a=this.undo.lastRegisteredOperationCommand())&&!a.incomplete&&(a=null),this.store(this.focusCid),this.lastCursor&&this.lastCursor.startId===this.lastCursor.endId&&this.lastCursor.startId&&(this.lastCursor.id=this.lastCursor.startId),a&&this.lastCursor&&this.focusCid==this.lastCursor.id&&(a.redo.push(this.lastCursor),l.undo.endSnap(!0),a=null),s.hasClass(".md-meta-block")&&s[0].normalize(),s.addClass("md-focus").trigger("refocus"),$(document.activeElement).trigger("focus"),File.option.expandSimpleBlock&&(this.focusCid=UserOp.simpleExpand(this,e))?("block"==document.querySelector("#md-searchpanel").style.display&&this.searchPanel.closePanel(),e=this.focusCid):(n||r||this.brush.expandOnDelay(!1),this.wordCount.quickUpdate(e),this.focusCid=e),File.isLocked)return this.focusCid;(this.focusCid&&c&&!($.contains(d,s)||$.contains(s,d)||s.length&&s.is(d))||c&&!this.focusCid)&&(o=!r&&this.simpleParse(c,i))&&(o[0].undo[0]=l.lastCursor,setTimeout(function(){o[0].redo.push(l.selection.buildUndo()),l.findElemById(o[2]).replaceWith(o[1]),a?(UndoManager.append(a,o[0]),o[0]=a):l.undo.register(o[0],!0),l.quickRefresh(),l.selection.scrollAdjust(),l.undo.exeCommand(o[0].redo.last())},50)),l.undo.endSnap(!0),this.library.outline.highlightVisibleHeader(),this.focusCid&&this.brush.focusContainer(s)}return l.isIME=0,n||r||this.brush.expandOnDelay(),e}}focusAndRestorePos(){var e,t;document.activeElement==this.writingArea&&this.writingArea.contains(document.activeElement)||(t=(e=$("content")).scrollTop(),this.writingArea.focus(),e.scrollTop(t))}resetPasteboard(){this._pasteboard={}}setPasteboard(e,t){this._pasteboard=this._pasteboard||{},this._pasteboard[e]=t}_bindGlobal(){var e,t,c=this;function n(){$(".ty-table-edit").length&&c.tableEdit.resizeTableEdit($(".ty-table-edit").next()),$(".typora-table-tracker").hide(),c.setTypeWriterMode(File.isTypeWriterMode,!0),e=null}File.option.moveColLeftKey&&KeyMaster(File.option.moveColLeftKey,function(e){File.editor.tableEdit.moveColLeftOrRight(!0)&&(e.preventDefault(),e.stopPropagation())}),File.option.moveColRightKey&&KeyMaster(File.option.moveColRightKey,function(e){File.editor.tableEdit.moveColLeftOrRight(!1)&&(e.preventDefault(),e.stopPropagation())}),File.option.moveRowUpKey&&KeyMaster(File.option.moveRowUpKey,function(e){File.editor.tableEdit.moveRowUpOrDown(!0)&&(e.preventDefault(),e.stopPropagation())}),File.option.moveRowDownKey&&(KeyMaster(File.option.moveRowDownKey,function(e){File.editor.tableEdit.moveRowUpOrDown(!1)&&(e.preventDefault(),e.stopPropagation())}),File.isMac)&&(KeyMaster(File.option.jumpToLineStartKey,function(e){e.preventDefault(),File.editor.selection.jumpToLineStart()}),KeyMaster(File.option.jumpToLineEndKey,function(e){e.preventDefault(),File.editor.selection.jumpToLineEnd()})),File.isNodeHtml?(KeyMaster("ctrl+home",function(e){File.editor.selection.jumpTop()}),KeyMaster("ctrl+end",function(e){File.editor.selection.jumpBottom()}),KeyMaster("end",function(e){setTimeout(function(){File.editor.selection.fixExtendToLineEdge(!0,null,!1,!0)},0)}),KeyMaster("home",function(e){setTimeout(function(){File.editor.selection.fixExtendToLineEdge(!1,null,!1,!0)},0)}),KeyMaster("shift+end",function(e){setTimeout(function(){File.editor.selection.fixExtendToLineEdge(!0,null,!1,!1)},0)}),KeyMaster("shift+home",function(e){setTimeout(function(){File.editor.selection.fixExtendToLineEdge(!1,null,!1,!1)},0)}),KeyMaster("ctrl+z, command+z",function(e){return ClientCommand.undo(e),!1}),KeyMaster("ctrl+y, command+y, command+shift+z, ctrl+shift+z",function(e){return ClientCommand.redo(e),!1})):(KeyMaster("ctrl+k",function(e){var t,n=c.selection.getRangy();n&&!isInputComponent(document.activeElement)&&(n.collapsed&&(t=c.getMarkElem(),n.setEnd(t[0],t[0].childNodes.length),c.selection.setRange(n,!0)),n.toString().length?UserOp.backspaceHandler(c,e,"delSelection"):UserOp.backspaceHandler(c,e,!0),e.preventDefault(),e.stopPropagation())}),KeyMaster("command+right",function(e){setTimeout(function(){File.editor.selection.fixExtendToLineEdge(!0,null,!1,!0)},0)}),KeyMaster("command+left",function(e){setTimeout(function(){File.editor.selection.fixExtendToLineEdge(!1,null,!1,!0)},0)}),KeyMaster("command+shift+right",function(e){setTimeout(function(){File.editor.selection.fixExtendToLineEdge(!0,null,!1,!1)},0)}),KeyMaster("command+shift+left",function(e){setTimeout(function(){File.editor.selection.fixExtendToLineEdge(!1,null,!1,!0)},0)}),KeyMaster("command+up, command+down",function(e){setTimeout(function(){c.refocus()},0)}),KeyMaster("ctrl+h",function(e){c.selection.getRangy()&&!isInputComponent(document.activeElement)&&UserOp.backspaceHandler(c,e,"Backspace")}),KeyMaster("ctrl+d",function(e){c.selection.getRangy()&&!isInputComponent(document.activeElement)&&UserOp.backspaceHandler(c,e,"Delete")}),KeyMaster("ctrl+tab",function(e){File.isMac&&bridge.callHandler("window.selectNextTab")}),KeyMaster("ctrl+shift+tab",function(e){File.isMac&&bridge.callHandler("window.selectPreviousTab")}),KeyMaster("command+y",function(e){if(File.isLocked)return!1;File.editor.undo.redo(e),File.freshMenu()})),File.isMac||File.isNode||(File.isNodeHtml||(KeyMaster("command+z, ctrl+z",function(e){if(File.isLocked)return!1;c.writingArea.contains(e.target)&&c.undo.undo(e)}),KeyMaster("ctrl+y",function(e){if(File.isLocked)return!1;c.writingArea.contains(e.target)&&c.undo.redo(e)})),KeyMaster("command+l, ctrl+l",function(e){e.preventDefault(),c.selection.selectLine()}),KeyMaster("command+d, ctrl+d",function(e){e.preventDefault(),c.selection.selectWord()}),KeyMaster("command+e, ctrl+e",function(e){e.preventDefault(),c.selection.selectPhrase()}),KeyMaster("command+a, ctrl+a",function(e){e.preventDefault(),c.selection.selectAll()}),KeyMaster("shift+command+d, shift+ctrl+d",function(e){if(File.isLocked)return!1;e.preventDefault(),c.selection.selectWord(),UserOp.backspaceHandler(c,null,"delSelection")})),File.isNodeHtml&&(t=File.isMac||File.isMacNode,KeyMaster(t?"command+b":"ctrl+b",function(e){if(File.isLocked)return!1;e.preventDefault(),c.stylize.toggleStyle(NodeDef.TYPE.strong)}),KeyMaster(t?"command+i":"ctrl+i",function(e){if(File.isLocked)return!1;e.preventDefault(),c.stylize.toggleStyle(NodeDef.TYPE.em)}),KeyMaster(t?"command+u":"ctrl+u",function(e){if(File.isLocked)return!1;e.preventDefault(),c.stylize.toggleStyle(NodeDef.TYPE.underline)}),KeyMaster(t?"command+a":"ctrl+a",function(e){e.preventDefault(),File.isNodeHtml&&ClientCommand.selectAll()}),File.isNode&&((t=File.option.keys["Paste as Plain Text"]||"ctrl+shift+v")&&KeyMaster(t,function(e){ClientCommand.pasteAsPlain(),e.preventDefault()}),"ctrl+v"!=(t=File.option.keys.Paste))&&KeyMaster(t,function(e){ClientCommand.paste(),e.preventDefault()}),File.isLinux)&&KeyMaster("ctrl+/",function(e){File.toggleSourceMode(),e.preventDefault()}),$(document).on("dragover",function(e){e.originalEvent.dataTransfer.dropEffect="none"}).on("dragstart",function(e){if(c.writingArea.contains(e.target))return!1}).on("drop",function(t){t.stopPropagation(),t.preventDefault(),setTimeout(function(){c.resetPasteboard()},0);var e=t.originalEvent.dataTransfer;if(c.library.draggingItem||e.getData("file"))return c.library.clearDraggingItem(),!1;var n,i=e.getData("text/html"),r=e.getData("text/plain"),o=c._pasteboard.files||[];function a(){var e=document.caretRangeFromPoint(t.originalEvent.x,t.originalEvent.y);e&&e.startContainer&&(c.writingArea==e.startContainer||c.writingArea.contains(e.startContainer))&&("BODY"==document.activeElement.tagName&&c.writingArea.focus(),c.selection.setRange(e),c.lastCursor=c.selection.buildUndo(),c.refocus())}if(o=o||[],c._pasteboard.urlWithTitle){if(!FileAction.isKeyWindow())return!1;a(),UserOp.insertUrlWithTitle(c,c._pasteboard.urlWithTitle[0],c._pasteboard.urlWithTitle[1])}else if(c._pasteboard.image){if(!FileAction.isKeyWindow())return!1;a(),MediaOp.insertURL(c._pasteboard.image)}else if(i){if(!FileAction.isKeyWindow())return!1;a(),setTimeout(function(){UserOp.pasteHandler(c,i)},20)}else if(o.length||e.files&&e.files.length){if(File.isNodeHtml)for(var s=0;s<e.files.length;s++){var l=e.files.item(s).path;l&&o.push(l)}else o.length||(n=e.getData("text/uri-list"))&&(o=o.concat(n));if(!o.length)return!1;FileAction.onDropFile(o,e,a)}else{if(!r)return!1;{if(!FileAction.isKeyWindow())return!1;a(),setTimeout(function(){UserOp.pasteHandler(c,r)},20)}}}).on("paste",this.sessionStr,function(e){return!File.isLocked&&(c.sourceView.inSourceMode?void 0:UserOp.pasteHandler(c,e.originalEvent,File._PasteContentFlag))}).on("pasteAsPlainText",this.sessionStr,function(e){if(File.isLocked)return!1;if(File.isMac&&(c.sourceView.inSourceMode||isInputComponent(document.activeElement)))bridge.callHandler("window.pasteAsPlainText");else if(!c.sourceView.inSourceMode)return UserOp.pasteHandler(c,e.originalEvent,!0)}).on("copy",this.sessionStr,function(e){isInputComponent(document.activeElement)||(UserOp.beforeCopyStart(c),UserOp.copyHandler(c,e.originalEvent)),e.stopPropagation()}).on("copy",function(e){e.target!=document.body||!c.writingArea.contains(document.activeElement)||document.activeElement==e.target||isInputComponent(document.activeElement)||UserOp.copyHandler(c,e.originalEvent)}).on("cut",function(e){e.target!=document.body||!c.writingArea.contains(document.activeElement)||document.activeElement==e.target||isInputComponent(document.activeElement)||(UserOp.copyHandler(c,e.originalEvent),UserOp.backspaceHandler(c,e,"delSelection"))}).on("cut",this.sessionStr,function(e){return e.stopPropagation(),!File.isLocked&&(!!isInputComponent(document.activeElement)||(File.isNode?(File._CopyContentFlag="cut_before",File._CopyContentRange=null,JSBridge.invoke("webContents.copy"),!1):(c.refocus(void 0,!0,!0),void(UserOp.copyHandler(c,e.originalEvent,t)&&t()))));function t(){var e=File._CopyContentRange&&c.selection.buildUndo(File._CopyContentRange),t=UserOp.backspaceHandler(c,null,"delSelection");t&&File._CopyContentRange&&(t.undo.unshift(e),e=UserOp.backspaceHandler(c,null,!0,!0))&&UndoManager.append(t,e)}}).on("contextmenu",function(e){var t,n;File.isMac&&"TITLEBAR"!=e.target.tagName&&(n=[],0==(n=File.isWK&&"IFRAME"==e.target.tagName?(t=document.elementFromPoint(e.clientX,e.clientY),c.contextMenu.getMenuItemsForMac(t)):c.contextMenu.getMenuItemsForMac(e.target)).length?(e.preventDefault(),e.stopPropagation()):window.bridge.callSync("contextMenu.setItems",n))}).on("contextmenu",this.sessionStr,function(e){var t,n=$(e.target);if(n.closest(".CodeMirror")[0]||(Node.isType(c.getMarkElem(e.target).attr("mdtype"),Stylize.CONST.Selectable)?window.getSelection().removeAllRanges():((t=c.selection.getRangy())&&""==t.toString()&&(t.collapse(!0),t.select(t.isBackward)),File.isNodeHtml&&File.editor.brush.expand())),"IMG"===e.target.tagName&&n.closest(".md-image").length){$(".md-expand").removeClass("md-expand");n=n.closest(".md-image").addClass("md-expand");if(!n.length)return;(t=rangy.createRange()).selectNodeContents(n.children(".md-meta")[0]),c.selection.setRange(t,!0),File.editor.brush.expand()}File.isNodeHtml&&File.editor.contextMenu.show(e)}).on("click","#md-notification .undo-btn",function(){c.undo.undo(),document.body.classList.remove("ty-show-notification")}).on("click","#md-notification .ok-btn",function(){document.body.classList.remove("ty-show-notification")}).on("focus","body",function(e){if(e.target==document.body)return!1}).on("click",EditHelper.resetClick),$(window).on("resize",function(){File.suppressResize||(e&&clearTimeout(e),e=setTimeout(n,300))}).on("mouseup",function(e){c.selection.clearGlobalColumn(),c.stopScrolling(),1==e.which&&c.wordCount.updateInSelection()}),window.addEventListener("mac.enterFullscreen",function(){$("body").addClass("typora-fullscreen"),$("#top-hotpot, #bottom-hotpot").show()}),window.addEventListener("mac.exitFullscreen",function(){$("body").removeClass("typora-fullscreen"),$("#top-hotpot, #bottom-hotpot").hide()}),File.isMac&&($("#top-hotpot").on("mouseenter",function(e){1==e.which&&c.startScrolling(!0)}),$("#bottom-hotpot").on("mouseenter",function(e){1==e.which&&c.startScrolling(!1)}),$("#top-hotpot").on("mouseleave",function(e){c.stopScrolling()}),$("#bottom-hotpot").on("mouseleave",function(e){e.screenY+4>window.innerHeight||c.stopScrolling()})),$(c.sessionStr).on("change","[type='checkbox']",function(){var e=this.parentElement.getAttribute("cid"),t=this.checked;t?this.setAttribute("checked","checked"):this.removeAttribute("checked"),c.getNode(e).attr("checked",t,c,!1)}),document.addEventListener("selectionchange",function(e){var t;File.isNodeHtml&&(t=c.selection.getRangy(),$("svg.in-text-selection").attr("class",""),t)&&t.getNodes([1],function(e){"svg"===e.tagName&&e.classList.add("in-text-selection")}),File.isFocusMode&&enterFocusMode.call(c)},!1)}_bindKeyEvents(){var a,s,l,u,h=this,c=!1,i=!1;function d(t){fastdom.mutate(function(){document.querySelector("#write").querySelectorAll("a, .md-def-url, .md-url").forEach(function(e){e.style.cursor=t?"pointer":""})})}h.isIME=0,h.lastKeydownEvent=null,$(document.body).on("keydown",function(e){if(!(e.metaKey||e.ctrlKey||e.altKey)){h.library.outline.autoHideOutline();var t=document.body.classList,t=((t.contains("ty-show-word-count")||t.contains("ty-show-spell-check"))&&(t.remove("ty-show-word-count"),t.remove("ty-show-spell-check")),e.keyCode||e.which);if(EditHelper.keyOnControl(keyNames[t],e))return!1;if(document.activeElement==document.body&&!$(".modal-dialog:visible").length){var n=window.getSelection();if(!n||!n.startContainer||!h.writingArea.contains(startContainer))return!1;n=$("content").scrollTop();h.writingArea.focus(),"Delete"!=keyNames[t]&&"Backspace"!=keyNames[t]&&"Enter"!=keyNames[t]||(e.originalEvent!=h.lastKeydownEvent&&(e.target=h.writingArea,h.lastKeydownEvent=e.originalEvent,$(h.sessionStr).trigger(e)),e.preventDefault()),"IFRAME"==e.target.tagName&&e.stopPropagation(),$("content").scrollTop(n)}return!(h&&h.contextMenu&&h.contextMenu.handleKeyEvent(e))&&void 0}});function p(e){h.isIME&&!isInputComponent(document.activeElement)&&(h.useIMEKeyboard=!0,e&&(v=-1,setTimeout(function(){v=0},0)),(e=h.getMarkElem()).length||t(),h.focusCid=e.attr("cid"),h.brush.addToQueue(h.focusCid),h.isIME=0,setTimeout(function(){h.brush.brushQueue()},10),h.undo.addSnap(h.focusCid,SnapFlag.ADD))}function f(e){e&&(v=-1),isInputComponent(document.activeElement)||h.isIME||(h.selection.prepNode("",e,!1,!0),h.isIME=1)}var m,g,y,v=0,t=function(){var e=h.selection.getRangy(),e=$(e.startContainer).closest("[cid]"),t=h.findNodeByElem(e);t&&e.replaceWith(t.toHTML())},b=function(){g&&!0!==g&&(g[1]?(g[0].attr("contenteditable",g[1]),g[2]&&g[2].attr("contenteditable",g[3])):(g[0].removeAttr("contenteditable"),g[2]&&g[2].removeAttr("contenteditable")),g[4])&&h.selection.setRange(g[4]),g=!1,y&&clearTimeout(y),y=null};function w(e){y&&clearTimeout(y),(e=e||h.findElemById(h.focusCid))[0];var t=e.attr("contenteditable"),n=h.selection.getRangy();(g="false"!==t)&&(e.attr("contenteditable","false"),g=[e,t,null,null,n]),y=setTimeout(b,100)}$(h.sessionStr).on("keydown",function(e){h.lastKeydownEvent=e.originalEvent,h.keypressMsg=null;var t,n,i=e.keyCode||e.which,r=isInputComponent(e.target);if(229!=i){if("Tab"!=keyNames[i]||e.ctrlKey||e.altKey||e.stopPropagation(),h&&h.contextMenu&&h.contextMenu.handleKeyEvent(e))return!1;if(h.autoComplete&&!1===h.autoComplete.handleKeyEvents(e))return!1;if(EditHelper.keyOnControl(keyNames[i],e,!0))return!1;if(document.body.classList.contains("megamenu-opened"))"Esc"===keyNames[i]&&File.megaMenu.hide();else{if($(".dropdown-menu.open:not(#typora-sidebar), .dropdown-menu.show").removeClass("open").removeClass("show").find(".active").removeClass("active"),$(".ty-tooltip").removeClass("shown"),"Ctrl"!=keyNames[i]&&"Command"!=keyNames[i]||d(!0),Node.isType(keyNames[i],"Right","Left","Up","Down")){if($(".context-menu:visible").length&&h.contextmenu.handleArrowKey(keyNames[i]),e.target.classList&&e.target.classList.contains("ty-input")&&!e.ctrlKey&&!e.metaKey){if(n=h.selection.getRangy(),"Left"==keyNames[i]&&0==n.startOffset&&0==n.endOffset)return h.selection.moveUpOrDown(!0,e,!0),!1;if("Right"==keyNames[i]&&n.startOffset==n.endOffset&&n.endOffset==e.target.textContent.length)return h.selection.moveUpOrDown(!1,e,!0),!1}if(r&&Node.isType(keyNames[i],"Right","Left"))return;if(File.isLocked)return!0;if(File.inBusyMode&&e&&(e.shiftKey||e.metaKey||e.ctrlK)&&setAttributeOnlyNeeded(h.writingArea,"contenteditable","true"),$((h.selection.getRangy()||{}).commonAncestorContainer).closest("table.md-table").length&&!1===h.tableEdit.keydownHandler(e))return!1;if(e.ctrlKey||e.metaKey){if(File.isMac&&e.metaKey&&!e.ctrlKey&&!e.altKey&&("Up"==keyNames[i]||"Down"==keyNames[i]))return"Up"==keyNames[i]?h.selection.jumpTop(e.shiftKey):h.selection.jumpBottom(e.shiftKey),!1;if(e.target.classList&&e.target.classList.contains("md-def-name")&&"Right"===keyNames[i])return h.selection.jumpIntoElemEnd($(e.target).closest("[mdtype]")),!1}File.isMac&&e.metaKey&&(t={},$.extend(t,e),t.type="keyup",setTimeout(function(){$(e.target).trigger(t)},10)),e.shiftKey&&(h.needRemoveMathAfterSym=!0,$(".md-focus .math-jax-postprocess>.md-math-after-sym").text("​")),"Right"==keyNames[i]||"Left"==keyNames[i]?(h.lastCursor=h.selection.buildUndo(),h.autoComplete.isShown()&&h.brush.triggerAutoComplete(),h.selection.moveLeftOrRight("Left"==keyNames[i],e)):"Up"!=keyNames[i]&&"Down"!=keyNames[i]||(h.lastCursor=h.selection.buildUndo(),e.shiftKey?h.selection.unlockBlockUpOrDown("Up"==keyNames[i],e):h.selection.moveUpOrDown("Up"==keyNames[i],e))}if(!r){if("Esc"==keyNames[i]){if($("#table-insert-dialog:visible").modal("hide").length)return void $(File.editor.sessionStr).trigger("cursorChange");h.brush.triggerAutoComplete(!0),e.preventDefault()}else if("Tab"==keyNames[i]){if(e.metaKey||e.ctrlKey||e.altKey)return;e.preventDefault(),(e.shiftKey?UserOp.lessIndent(h):UserOp.moreIndent(h))||((o=h.getMarkElem()).closest(".md-table").length?h.tableEdit.moveToNextCell(!0,e.shiftKey,void 0,!0):o.hasClass("md-def-link")||o.hasClass("md-def-footnote")?(r=h.getJQueryElem(window.getSelection().anchorNode).closest("span[contenteditable]"),e.shiftKey?h.selection.selectAllElem($(r.prevAll("span[contenteditable='true']")[0])):h.selection.selectAllElem($(r.nextAll("span[contenteditable='true']")[0]))):e.shiftKey||(UserOp.pasteHandler(h,"\t",!0,!0,!0),h.refocus(),h.brush.addToQueue(h.focusCid)))}else if("Backspace"==keyNames[i]||"Delete"==keyNames[i]){if(File.bundle.isLocked)return void e.preventDefault();var o,r=!0;if(e.shiftKey&&File.isNode&&!e.ctrlKey&&"Delete"==keyNames[i])return;File.isNodeHtml?e.ctrlKey&&(h.selection.getRangy()||{}).collapsed?UserOp.backspaceHandler(h,e,keyNames[i]):r=UserOp.backspaceHandler(h,e,keyNames[i],!1,!0):e.metaKey?((o=h.getMarkElem(window.getSelection().commonAncestorContainer)).addClass("md-expand"),window.getSelection().modify("extend","backward","lineboundary"),UserOp.backspaceHandler(h,e,keyNames[i])):r=UserOp.backspaceHandler(h,e,keyNames[i],!1,!0),null===r?(h.undo.addSnap(h.focusCid,SnapFlag.NONE),h.brush.addToQueue(h.focusCid)):e.preventDefault(),e.stopPropagation(),window.Reporter.fullValidate()}else if("Enter"==keyNames[i]||File.isMac&&!e.shiftKey&&!e.metaKey&&e.ctrlKey&&"O"==String.fromCharCode(i)){if(1==$(".ty-focusable-btn.selected").length){if((n=h.selection.getRangy()).startContainer.classList&&n.startContainer.classList.contains("ty-focusable-btn"))return $(n.startContainer).trigger("btn-action"),void e.preventDefault();$(".ty-focusable-btn.selected").trigger("btn-action")}pressReturn.call(h,e.metaKey||e.ctrlKey,e.shiftKey,"O"==String.fromCharCode(i)),e.preventDefault(),e.stopPropagation()}c&&i==this.lastKey&&-1<[224,17,91,93].indexOf(i)&&this.lastKeyTime&&performance.now()-this.lastKeyTime<300?(e.preventDefault(),h.refocus(void 0,!0),this.lastKey=0):(this.lastKey=e.keyCode,this.lastKeyTime=performance.now()),c=!1}}}}).on("keypress",function(e){var t=e.keyCode||e.which;if(File.isLocked&&0<e.charCode)return e.ctrlKey||e.metaKey;isInputComponent(e.target)||KeyMaster.isCommand(e)||("Enter"==keyNames[t]?e.preventDefault():0<e.charCode&&h.selection.getRangy()&&(String.fromCharCode(e.charCode),(t=h.getMarkElem().attr("cid"))!=h.focusCid&&h.refocus(t),h.brush.addToQueue(h.focusCid)))}).on("keyup",function(e){c=!0;var t=e.keyCode||e.which;if(!isInputComponent(e.target)&&("CTRL"!=keyNames[t]&&"Command"!=keyNames[t]||d(!1),"Right"==keyNames[t]||"Left"==keyNames[t]||"Up"==keyNames[t]||"Down"==keyNames[t]||"Home"==keyNames[t]||"End"==keyNames[t]||"PageUp"==keyNames[t]||"PageDown"==keyNames[t]?(i=e.shiftKey)||h.isIME||e.metaKey||h.refocus():i&&"Shift"==keyNames[t]&&(i=!1,h.isIME||e.metaKey||h.refocus()),"Enter"==keyNames[t])){t=$("#write .md-focus");if(0==t.length){var n=h.selection.getRangy();if(!n)return;t=$(n.startContainer).closest("[cid]"),t=$("[cid='"+t.attr("cid")+"']")}1<t.length&&t.get(0).getAttribute("cid")===t.get(1).getAttribute("cid")?(t.filter(function(e){return 0<e}).remove(),h.selection.jumpIntoElemEnd($(t.get(0))),pressReturn.call(h,File.isMacOrMacNode?e.metaKey:e.ctrlKey,e.shiftKey)):t.next("div:not('[mdtype]')").remove().length&&pressReturn.call(h,File.isMacOrMacNode?e.metaKey:e.ctrlKey,e.shiftKey)}}).on("compositionend",p).on("compositionstart",f).on("compositionupdate",function(){}).on("beforeinput",function(i){var e,t,n,r,o,a,s,l,c;function d(e){var t,n=i.originalEvent.getTargetRanges()[0];n&&((t=rangy.createRange()).setStart(n.startContainer,n.startOffset),t.setEnd(n.endContainer,n.endOffset),h.selection.setRange(t,!0)),h.UserOp.pasteHandler(h,e,!0),w()}u=g=!1,h.lastKeydownEvent=null,isInputComponent(i.target)||(h.focusCid||h.refocus(void 0,!1,!0),e=i.originalEvent&&i.originalEvent.inputType,!(e=i.originalEvent?e:"deleteContentBackward")&&null==i.originalEvent.data&&h.isIME&&File.isMac?(h.isIME=0,w()):"deleteCompositionText"==e||"deleteByComposition"==e?((m="false"!==h.writingArea.getAttribute("contenteditable"))&&h.writingArea.setAttribute("contenteditable","false"),h.focusCid&&((l=h.findElemById(h.focusCid)).hasClass("md-def-link")||l.hasClass("md-def-footnote")?l.attr("contenteditable","false"):l.parent().is("th,td,li")&&(b(),c=(l=l.parent()).attr("contenteditable"),g="false"!==c)&&(l.attr("contenteditable","false"),g=l.is("th,td")?(l.parent().attr("contenteditable","false"),[l,c,l.parent(),c]):[l,c],y=setTimeout(b,100)))):"insertFromPaste"==e?(l=(i.originalEvent||{}).dataTransfer,File.isMac&&l?l.getData?h.UserOp.pasteHandler(h,StringUtils.orDefault(l.getData("text/html")||l.getData("text/plain"),i.originalEvent)):l.get?h.UserOp.pasteHandler(h,StringUtils.orDefault(l.get("text/html")||l.get("text/plain"),i.originalEvent)):h.UserOp.pasteHandler(h,i.originalEvent):h.UserOp.pasteHandler(h,i.originalEvent),w()):"insertFromDrop"==e?h.UserOp.pasteHandler(h,i.originalEvent):"insertFromComposition"!=e&&(/composition/i.exec(e||"")?/\n/.exec(i.originalEvent.data||"")?w():((c=$(".md-meta-block")).next().attr("cid")===h.focusCid&&(s=c.attr("contenteditable"),g=[c,s],c.attr("contenteditable","false"),y=setTimeout(b,100)),f(i)):"insertReplacementText"==e?(s=i.originalEvent.dataTransfer.getData("text/plain")||"",/[\n\r]/.exec(s)&&d(s),(a=i.originalEvent.getTargetRanges()[0])&&s.length&&s[0]!==s[0].toLowerCase()&&s.substr(1)==s.toLowerCase().substr(1)?a.startContainer==a.endContainer&&3==a.startContainer.nodeType&&a.startContainer.parentElement&&a.endOffset-a.startOffset&&("SCRIPT"==a.startContainer.parentElement.tagName?w():(t=a.startContainer.textContent.substr(a.startOffset,a.endOffset),(n=a.startContainer.textContent.substr(0,a.startOffset)).trim()||(r=a.startContainer.parentElement.closest("[mdtype]"),o=h.selection.getOffset(r,a),r&&(n=$(r).rawText().substr(0,o).trim(),/\$$/.exec(n))&&(t.replace(/\s*$/,"")==s.toLowerCase()?w():d(s))))):a&&a.endOffset-a.startOffset<2&&(u=!0)):"insertText"==e?((a=i.originalEvent.getTargetRanges()[0])&&a.collapsed||h.undo.endSnap(),/[\r\n]/.exec(i.originalEvent.data||"")?d(i.originalEvent.data):(h.selection.prepNode(i.originalEvent.data||"",i),h.focusCid&&h.undo.addSnap(h.focusCid,SnapFlag.NONE))):/deleteContent/.exec(e)?(a=h.selection.getRangy())&&!a.collapsed&&a.commonAncestorContainer&&a.commonAncestorContainer.querySelector&&a.commonAncestorContainer.querySelector("[cid]")&&(console.warn("detect deletion from IME"),w($(a.commonAncestorContainer)),window.getSelection().removeAllRanges()):e&&(i.preventDefault(),i.stopPropagation())))}).on("input",function(e){if(h.lastKeydownEvent=null,isInputComponent(e.target))b();else if(b(),!(e&&e.target&&"VIDEO"==e.target.tagName||"IMG"==e.target.tagName)){m&&h.writingArea.setAttribute("contenteditable","true"),h.selection.clearGlobalColumn();var t,n=e.originalEvent&&e.originalEvent.inputType||"",i=(e.originalEvent||(n="deleteContentBackward"),SnapFlag.NONE);if("insertReplacementText"==n){if(t=e.originalEvent.dataTransfer.getData("text/plain"),/[\n\r]/.exec(t||""))return!1;i=u?SnapFlag.ADD:SnapFlag.REPLACE}else{if("deleteCompositionText"==n)return;i=/insert/.exec(n)||/composition/i.exec(n)?SnapFlag.ADD:/deleteContent/.exec(n)?SnapFlag.DELETE:SnapFlag.REPLACE}u=!1,h.focusCid?(e=(t=$(e.target).closest("[cid]")).attr("cid"))&&h.focusCid!=e&&!t[0].querySelector("[cid='"+e+"']")&&h.refocus(e,!1,!0):h.refocus(void 0,!1,!0);var r;"insertFromPaste"!=n&&"insertCompositionText"!=n&&(0<v||h.isIME&&"insertText"==n?(v=0,p()):h.brush.addToQueue(h.focusCid),h.focusCid)&&(h.undo.addSnap(h.focusCid,i),(r=/deleteContent/.exec(n))||h.UserOp.PunctuationOp.clearLastQuoteState(),l&&clearTimeout(l),l=setTimeout(function(){h.selection.lockNativeScroll(),File.isTypeWriterMode?h.selection.typeWriterScroll(null,0):r||h.selection.scrollAdjust(),l=null},(File.inBusyMode?200:20)*(File.isMac?10:1)),h.wordCount.delimiter<WordCount.Delimiter.LINE&&h.wordCount.quickUpdate(h.focusCid),a&&(clearTimeout(a),a=null),s&&h.focusCid!=s&&o(s),s=h.focusCid,a=setTimeout(function(){o(s),a=s=null},200))}function o(e){h.syncChange([{type:"sync",id:e,html:h.findElemById(e).html()}])}}).on("drop",function(e){var t,n=null;(n=File.isWK&&e.originalEvent.dataTransfer.getData("file")||h.library.draggingItem)&&((t=document.caretRangeFromPoint(e.originalEvent.x,e.originalEvent.y))&&t.startContainer&&(h.writingArea==t.startContainer||h.writingArea.contains(t.startContainer))&&(h.selection.setRange(t),h.refocus(),"BODY"==document.activeElement.tagName)&&h.writingArea.focus(),setTimeout(function(){UserOp.insertFileLink(h,n)},20),h.library.clearDraggingItem(),e.stopPropagation(),e.preventDefault())}).on("dragover",function(e){-1<e.originalEvent.dataTransfer.types.indexOf("file")&&(e.preventDefault(),e.stopPropagation())}).on("dragenter",function(e){this==document.activeElement||this.contains(document.activeElement)||document.activeElement.contains(this)||(h.restoreLastCursor(),e.preventDefault(),e.stopPropagation())})}setCurLinkElem(e){$curLinkElem=e}getCurrentLinkHref(){var e=this.selection.getRangy().commonAncestorContainer,t="";if(!(e=(e=e.closest?e:e.parentElement).closest(".md-link, .md-def-link")))return"";if(e.classList.contains("md-def-link"))t=(e=e.querySelector(".md-def-url")).innerText;else{var n=e.querySelector("a");if(t=n.getAttribute("href"),"reflink"==e.getAttribute("md-inline")){e=$.localize.getString("Need to define the reference link <b>[{0}]</b> with syntax <b>[{1}]: www.example.com</b>"),n=n.dataset.ref;if(void 0===(t=this.nodeMap.link_list.getHrefByRef(n,!0,!0)))return EditHelper.showNotification(e.format(n,n),!0),File.isLocked||this.docMenu.addEmptyDef(n,NodeDef.TYPE.def_link),null;if(""===t)return EditHelper.showNotification(e.format(n,n),!0),null}}return t}openCurrentLink(){var e=this.getCurrentLinkHref();null!=e&&this.tryOpenUrl(e,!0)}copyCurrentLink(){var e=this.getCurrentLinkHref();null!=e&&(0,this.UserOp.setClipboard)(null,void 0,e,!0)}tryOpenLink(e,t){if((e=t?$curLinkElem:e).length){var t=e.attr("href"),n=$.localize.getString("Need to define the reference link <b>[{0}]</b> with syntax <b>[{1}]: www.example.com</b>");if(t=t||e.attr("xlink:href"),this.undo.endSnap(!0),e.hasClass("md-footnote"))return this.docMenu.jumpToFootnoteDef(e),!1;if(e.hasClass("reversefootnote"))return this.docMenu.jumpToFootnote(e.closest(".md-def-footnote"),+e.attr("data-index")),!1;if(e.hasClass("md-def-url"))this.tryOpenUrl(e.text());else if(e[0].hasAttribute("data-ref")){var i=e.data("ref");if(void 0===(t=this.nodeMap.link_list.getHrefByRef(i,!0,!0)))return EditHelper.showNotification(n.format(i,i),!0),File.isLocked||this.docMenu.addEmptyDef(i,NodeDef.TYPE.def_link),!1;if(""===t)return EditHelper.showNotification(n.format(i,i),!0),!1}t&&this.tryOpenUrl(t,e.closest("[md-inline='autolink'], [md-inline='url']").length)}}tryOpenUrl(n,i){var e,t,r,o=n=n.trim().replace(/(^<)|(>$)/g,"");n=StringUtils.decodeFromEscapedPath(n);const a=File.option.useMirrorInCN?"typoraio.cn":"typora.io";function s(e,t){e=e.replace(/^file:\/{0,2}/,""),FileHelper.isSupportedFile(e,!0)?/\.txt/.exec(e)?JSBridge.invoke("shell.openItem",e):JSBridge.invoke("app.openFileOrFolder",e,{forceCreateWindow:!1,mountFolder:File.getMountFolder(),anchor:t||""}):(t=reqnode("path").extname(e),/\.(app|bat|bin|cmd|sh|command|csh|exe|gadget|inf|inx|ins|isu|jse|link|msi|msc|ksh|out|prg|reg|res|run|scp|vb.*|ws|wsf|wsh|ahk|jar|py|js)$/i.exec(t)?JSBridge.showInFinder(e.replace(/^file:\/{0,2}/,"")):JSBridge.invoke("shell.openItem",e))}function l(t){var n,i,r=t;function o(t,e){var n;File.isNode?(n=reqnode("fs-extra"),(e?n.ensureFile:n.ensureDir)(t,function(e){e?alert(e.message):s(t)})):bridge.callHandler(e?"path.createFileAndOpen":"path.createFolderAndOpen",t)}return(r=StringUtils.ensureAbsolutePath(File.bundle.filePath||File.bundle.originalPath,t))&&function(){if(n=r.replace(/#([^.\/\\]+)$/,"").replace(/\?([^.\/\\]+)$/,""),!(i=((/\.([^.\/\\]+)$/.exec(r)||"")[1]||"").toLowerCase())){var e=(t.split(/[\/\\]/)||[""])[0];if(0<e.indexOf(".")||0<e.indexOf(":")&&File.isWin&&/^[A-Z]{1,2}:/.exec(e))return}return-1<File.SupportedFiles.indexOf(i)&&(n=r,1)}()&&(EditHelper.showNotification($.localize.getString("Cannot open location <code>$1</code>, would you want to create file at <code>$2</code> and continue?").replace("$2",StringUtils.escape(n)).replace("$1",StringUtils.escape(t))+` <a href='https://support.${a}/Links#faq' target="_blank" class='default-btn'>`+$.localize.getString("Learn More…")+"</a>",!0,i?[$.localize.getString("Create File","Panel")]:[$.localize.getString("Create Folder","Panel"),$.localize.getString("Create File","Panel")],e=>{1==e?o(r+".md",!0):o(r,!!i)}),1)}function c(e,t){return File.isMac?(r=e,o=t,new Promise(function(t,n){bridge.callHandler("path.openFile",{url:r.replace(/\\/g,"/"),relateToFolder:!0,anchor:o||""},function(e){(e?t:n)()})})):(e=e,t=t,n=reqnode("fs-plus"),(i=StringUtils.realPathForTextBundle(e))?n.existsSync(i)?(s(i,t),Promise.resolve()):n.isFileSync(i+".md")?(s(i+".md",t),Promise.resolve()):n.isFileSync(i+".markdown")?(s(i+".markdown",t),Promise.resolve()):File.option.supportTextBundle&&n.isFileSync(i+".textbundle")?(s(i+".textbundle",t),Promise.resolve()):File.option.supportTextPack&&n.isFileSync(i+".textpack")?(s(i+".textpack",t),Promise.resolve()):Promise.reject(i):Promise.reject(e));var n,i,r,o}function d(){if(File.isNode)if(/^file:/.exec(n))s(n);else if(/^https?:/.exec(n))JSBridge.showInBrowser(n);else try{JSBridge.showInBrowser(o)}catch(e){console.warn(e)}else File.isMac?bridge.callHandler("path.openURL",/^https?:/.exec(o)?o:n):window.open(encodeURI(n))}if(n.match(/^#/)){var u=EditHelper.findAnchorElem(n);u&&(this.selection.jumpIntoElemBegin(u),this.selection.scrollAdjust(u,10))}else{if(StringUtils.isFullUrl(n))return d();u=n.trim(),e=(/(#[^./\//]+)$/.exec(u)||[])[0]||"",t=(n=u.replace(/([#?][^./\//]+)$/,"")).replace(/([#?][^/\//]+)$/,""),n!=t&&(r=((t.split(/[\/\\]/)||[""]).last().split(".")||[""]).last(),-1<File.SupportedFiles.indexOf(r))&&(n=t,e=(/(#[^/\//]+)$/.exec(u)||[])[0]||""),c(n,e).then(function(){},function(e){var t;i?(n=/^[A-Za-z.+-]+:/.exec(o)?o:"https://"+o,d()):l(n)||(t="https://",/^\S+@\S+\.\S+$/.exec(n)&&!/[\\\/]/.exec(n)&&(t="mailto:"),EditHelper.showNotification($.localize.getString("Cannot open location <code>$1</code>, do you mean <a href='$3' target='_blank'>$2</a> ?").replace("$3",t+StringUtils.escapeForPreWrap(o)).replace("$2",t+StringUtils.escape(o)).replace("$1",StringUtils.escape(e||o))+`<a href='https://support.${a}/Links#faq' target='_blank' class='default-btn'>`+$.localize.getString("Learn More…")+"</a>",!0))})}}_bindMouseEvents(){function t(){exitFocusModeTimer&&clearTimeout(exitFocusModeTimer),exitFocusModeTimer=setTimeout(exitFocusMode.bind(m),100)}var r,m=this,g=!1,y='.footnotes, [mdtype="table"], .md-task-list-item, .md-image',o=(window.addEventListener("mouseup",function(e){m.isMousePressed&&1===e.which&&m.brush.expandOnDelay(),m.isMousePressed=!1}),$(this.sessionStr).on("mouseenter",".md-htmlblock-container",function(e){1!=e.which||!File.isNodeHtml||!(e=m.selection.getRangy())||this==e.commonAncestorContainer||this.contains(e.commonAncestorContainer)||e.commonAncestorContainer.contains(this)||this.parentElement.classList.contains("md-rawblock-on-edit")||-1==e.comparePoint(this.parentElement,this.parentElement.childNodes.length)&&(this.parentElement.setAttribute("contenteditable","true"),e.setStartBefore(this),e.select())}).on("mouseenter","[md-inline='reflink']",function(){var e=this.querySelector("a"),t=e.dataset.ref,t=m.nodeMap.link_list.getNodeByRef(t),t=t&&t.get("title")||"";e.setAttribute("title",t)}).on("mouseenter mouseover mouseleave",y,function(e){1==e.which&&$(this).attr("contenteditable",!0)}).on("mouseover mouseleave",".td-span",function(e){1==e.which&&$(this).closest('[mdtype="table"]').attr("contenteditable","true")}).on("mousedown",function(e){g=!1,m.selection.clearGlobalColumn();var t,n,i=document.body.classList,i=((i.contains("ty-show-word-count")||i.contains("ty-show-spell-check"))&&(i.remove("ty-show-word-count"),i.remove("ty-show-spell-check")),File.isNode&&i.contains("typora-fullscreen")&&i.contains("native-window")&&JSBridge.invoke("window.setMenuBarVisibility",!1),"UL"==e.target.tagName&&(n=(n=m.getMarkElem(e.target)).attr("mdtype")==TYPE.list&&(i=n.find("li").offset(),t=i?document.caretRangeFromPoint(i.left+1,e.clientY):null,setTimeout(function(){m.selection.setRange(t)},10),t)?$(t.startContainer).closest("[cid]"):null),e.target.closest(".md-alert-text-container")),r=(i&&((r=m.selection.rangy.createRange()).setEnd(i.nextElementSibling,0),r.setStart(i.nextElementSibling,0),i.parentElement.classList.add("md-expand"),m.selection.deRange(r,!0)),(File.inBusyMode||n)&&(n=n||m.getMarkElem(e.target),!e.shiftKey&&n.length||!n.hasClass("md-focus")&&n.length&&(document.querySelectorAll(".md-focus").forEach(function(e){e.classList.remove("md-focus")}),setAttributeOnlyNeeded(m.writingArea,"contenteditable","true")),i=n.attr("mdtype"),!n.length||Node.canContainBlock(i,!0)||Node.isType(i,TYPE.fences,TYPE.hr,TYPE.def_link,TYPE.def_footnote,TYPE.math_block)||(n.hasClass("md-focus")||n.addClass("md-focus"),setAttributeOnlyNeeded(n[0],"contenteditable","true"))),$(e.target));if(Node.isType(r.attr("mdtype"),TYPE.paragraph,TYPE.heading)&&r.find(".math-jax-postprocess>.md-math-after-sym").last().text("​"),$(".dropdown-menu.open:not(#typora-sidebar), .dropdown-menu.show").removeClass("open").removeClass("show").find(".active").removeClass("active"),$(".ty-tooltip").removeClass("shown"),$(y).filter(function(){return(this==e.target||this.contains(e.target))&&"true"!==this.getAttribute("contenteditable")}).attr("contenteditable","true"),r.hasClass("md-def-footnote"))setTimeout(function(){var e,t,n=window.getSelection();n&&((e=$(n.focusNode).closest(".md-reverse-footnote-area")).length?((t=m.selection.getRangy()).isBackward?t.setStart(e[0].previousSibling,1):t.setEnd(e[0].previousSibling,1),n.anchorNode==self.focusNode&&t.collapse(),m.selection.deRange(t,!0)):n&&n.isCollapsed&&n.anchorOffset==n.anchorNode.length&&(t=m.selection.getRangy(),m.selection.deRange(t,!0)))},0);else{if(r.closest("a").length&&!r.closest("img").length&&(File.isMacOrMacNode?e.metaKey:e.ctrlKey))return e.stopPropagation(),e.preventDefault(),!1;r.closest(".md-fences:not(.CodeMirror)").length}m.lastCursor=m.selection.buildUndo(),m.isMousePressed=1===e.which}).on("click","[md-inline='link']>.md-content, .md-def-url",function(e){if(e.ctrlKey||e.metaKey)return JSBridge.putSetting("noHintForOpenLink",!0),m.tryOpenUrl($(this).text()),!1;EditHelper.showHintOrWarning({key:"noHintForOpenLink",title:$.localize.getString(File.isMac?"You can press <strong>⌘ + Click</strong> to open <a href='#'>links</a> or jump to footnote definition.":"You can press <strong>CTRL + Click</strong> to open <a href='#'>links</a> or jump to footnote definition.","Front"),checked:!0})}).on("mousemove",function(e){g=!0,1==e.which&&File.inBusyMode&&m.selection.handleMouseSelection(e)}).on("mousedown","mjx-container a",function(e){if(e.ctrlKey||e.metaKey)return JSBridge.putSetting("noHintForOpenLink",!0),m.tryOpenLink($(e.target).closest("a")),!1;EditHelper.showHintOrWarning({key:"noHintForOpenLink",title:$.localize.getString(File.isMac?"You can press <strong>⌘ + Click</strong> to open <a href='#'>links</a> or jump to footnote definition.":"You can press <strong>CTRL + Click</strong> to open <a href='#'>links</a> or jump to footnote definition.","Front"),checked:!0})}).on("mousedown",function(e){3==(e.originalEvent||e).detail&&(m.selection.fixTripleClick(e),e.preventDefault())}).on("click",function(e){if(3!=(e.originalEvent||e).detail){var t,n=m.getMarkElem(e.target);if(m.library.outline.autoHideOutline(),m.autoComplete.isShown()&&m.brush.triggerAutoComplete(),m.searchPanel.isOpen()&&(t=(t=m.selection.getRangy())?t.nativeRange.getBoundingClientRect().top:null,m.searchPanel.closePanel(!0)),"INPUT"!==e.target.tagName||"checkbox"!==e.target.getAttribute("type")){if(!(isInputComponent(e.target)||e.target.classList&&e.target.classList.contains("code-tooltip"))){if(n.hasClass("md-fences")&&m.fences.clickEventHandled.call(m.fences,e,n.attr("cid")))return!1;var i=$(e.target).closest("a, area, .md-footnote");if(i.length){if(e.stopPropagation(),e.preventDefault(),i.closest(".md-toc").length)return;var r=File.isMacOrMacNode?e.metaKey:e.ctrlKey;if(r||i.closest(".md-htmlblock-container, .md-reverse-footnote-area").length)return m.tryOpenLink(i),r&&JSBridge.putSetting("noHintForOpenLink",!0),!1;i=$(e.target).closest(".md-image"),r=i.closest('[md-inline="link"]');(r.length?r:i).addClass("md-expand"),EditHelper.showHintOrWarning({key:"noHintForOpenLink",title:$.localize.getString(File.isMac?"You can press <strong>⌘ + Click</strong> to open <a href='#'>links</a> or jump to footnote definition.":"You can press <strong>CTRL + Click</strong> to open <a href='#'>links</a> or jump to footnote definition.","Front"),checked:!0})}var r=m.findNodeByElem(n),i=(Node.isType(r,NodeDef.TYPE.paragraph,NodeDef.TYPE.heading)&&$(".md-tooltip-remove").remove(),m.selection.getRangy());return i&&t&&(n=document.querySelector("content"),r=i.nativeRange.getBoundingClientRect().top)&&(n.scrollTop=n.scrollTop+(r-t)),i&&i.commonAncestorContainer==m.writingArea&&!i.collapsed?(e.stopPropagation(),!1):void 0}e.preventDefault(),$(e.target).trigger("focus")}}}).on("dblclick",function(e){m.selection.fixDblClick(e),m.brush.expand(void 0,void 0,!0,!0)}).on("mouseup",function(e){if(m.isMousePressed=!1,m.isIME=!1,!File.isLocked&&!isInputComponent(document.activeElement)&&!isInputComponent(e.target)){$(y+", .md-rawblock").filter(function(){return!(this==e.target||this.contains(e.target))&&"false"!=this.getAttribute("contenteditable")}).attr("contenteditable","false");var t=m.selection.getRangy(),n=(t&&!t.collapsed&&Node.isType(t.commonAncestorContainer.tagName,"LI","UL","QUOTEBLOCK","ARTICLE")&&m.refocus(null),t?t.commonAncestorContainer:e.target);if((n==m.writingArea||m.writingArea.contains(n))&&!e.button){var i,r,o,a,s=(n=m.getMarkElem(e.target))[0],l=s&&!s.querySelector("[cid]")?s.getAttribute("cid"):void 0;if(n.closest(".md-fences:not(.CodeMirror)").length&&(i=$("content").scrollTop(),m.fences.focus(s.getAttribute("cid")),t&&t.collapsed||$("content").scrollTop(i)),!n.length&&e.target==m.writingArea&&(!g||!t||t.collapsed))try{var c,d,u,h=m.nodeMap.getLast(),p=m.findElemById(h.cid);0<e.pageY-p.offset().top-p.height()&&((n=!Node.isType(h,TYPE.paragraph,TYPE.heading)||h.get("text").length?(c=UndoManager.makeEmptyCommand(m.selection.buildUndo()),d=m.selection.addUnholdable(h,c),u=m.findElemById(d.cid),m.undo.register(c),m.selection.jumpIntoElemBegin(u),u):(m.selection.jumpIntoElemEnd(m.findElemById(h.getVeryFirst(!0).cid)),p)).length&&File.inBusyMode&&setAttributeOnlyNeeded(m.writingArea,"contenteditable","false"),m.refocus(n.attr("cid")),e.stopPropagation())}catch(e){}try{clearTimeout(clickTimer),"BODY"==document.activeElement.tagName?(clicks=0,m.writingArea.contains(e.target)&&l&&f()):clicks<2?(clickTimer=setTimeout(function e(){m.isMousePressed?clickTimer=setTimeout(e,DBCLICK_DELAY):(clicks=0,f())},DBCLICK_DELAY),clicks++):(clicks=0,f()),m.undo.endSnap(!0),(a=m.writingArea.querySelector(".unholdable"))&&a.getAttribute("cid")!=m.focusCid&&(!a.textContent.length&&(!(r=window.getSelection())||r.anchorNode!=a&&r.extentNode!=a)?(r=UndoManager.makeEmptyCommand(m.selection.buildUndo()),o=m.getNode(a.getAttribute("cid")),m.undo.UndoManager.addUndoForRemove(r,o),r.redo.push(m.selection.buildUndo()),o.remove(),a.remove(),m.undo.register(r)):a.classList.remove("unholdable"))}catch(e){console.warn(e.stack)}File.isLocked||File._onInitParse||(File.inBusyMode?t&&t.collapsed&&setAttributeOnlyNeeded(m.writingArea,"contenteditable","false"):setAttributeOnlyNeeded(m.writingArea,"contenteditable","true"))}}function f(){File.isTypeWriterMode&&File.option.scrollWithCursor?m.selection.typeWriterScroll(null,null,function(){m.refocus(l)}):m.refocus(l)}}),$(document).on("mouseup",function(e){isInputComponent(e.target)||"SELECT"==e.target.tagName||isInputComponent(document.activeElement)||(0==$(e.target).closest("#write").length&&(window.getSelection().toString().length&&(clicks=0),File.isLocked||File.inBusyMode||setAttributeOnlyNeeded(m.writingArea,"contenteditable","true"),fastdom.mutate(function(){$(".md-tooltip-hide").hide()})),$(e.target).closest(".context-menu").length)||m.contextMenu&&m.contextMenu.hide()}).on("mousedown","svg a",function(e){var t=this.getAttribute("href")||"";if(/^(%20|\s)*(javascript|data)/im.exec(t)&&this.setAttribute("href",""),e.ctrlKey||e.metaKey)return $(e.target).closest(".md-diagram").length||(m.tryOpenLink($(e.target).closest("a")),JSBridge.putSetting("noHintForOpenLink",!0)),!1;EditHelper.showHintOrWarning({key:"noHintForOpenLink",title:$.localize.getString(File.isMac?"You can press <strong>⌘ + Click</strong> to open <a href='#'>links</a> or jump to footnote definition.":"You can press <strong>CTRL + Click</strong> to open <a href='#'>links</a> or jump to footnote definition.","Front"),checked:!0})}).on("click",".md-f-tooltip",function(e){e=$(e.target).closest("a");if(e.length)return m.tryOpenLink(e),!1}),document.querySelector("content"));o.addEventListener("wheel",function(e){Math.abs(e.deltaY)<4||e.target.closest(".dropdown-menu")||m.lazyFireEvent_(o,"post-wheel",500)},!!File.option.passiveEvents&&{passive:!0}),setTimeout(()=>{o.addEventListener("scroll",function(e){m.isMousePressed&&File.isFocusMode&&File.isTypeWriterMode&&t(),m.lastScrolling=(new Date).getTime(),m.lazyFireEvent_(o,"post-scroll")},!!File.option.passiveEvents&&{passive:!0})},1e3),o.addEventListener("mousedown",function(e){r=e.target}),o.addEventListener("click",function(e){if(m.library&&m.library.fileSearch&&m.library.fileSearch.clearContentHighlight(),e.target==o||e.target==m.writingArea)r==e.target&&m.forceClick(e);else if(e.target.hasAttribute&&e.target.getAttribute("mdtype")==TYPE.paragraph){if(r!==e.target)return void(r=null);var t=m.selection.getRangy();if(!t)return;var n=e.target,i=t.commonAncestorContainer;if(i&&i.classList&&i.classList.contains("MathJax_SVG")||n!=t.startContainer&&n!=t.endContainer&&!n.contains(t.startContainer)&&!n.contains(t.endContainer)){if(!n||!n.lastElementChild)return;e.clientX>n.lastElementChild.getBoundingClientRect().right&&m.selection.jumpIntoElemEnd($(n))}}r=null}),$(o).on("post-scroll",function(){$(".auto-suggest-container.ty-show").removeClass("ty-show"),m.autoComplete&&m.autoComplete.postScroll()}).on("post-wheel",function(){File.isFocusMode&&File.isTypeWriterMode&&t()})}isScrolling(){if(!File.option.initAnchor&&this.lastScrolling){if((new Date).getTime()-this.lastScrolling<60)return!0;this.lastScrolling=0}return!1}forceClick(n){function e(e,t){t?i.selection.jumpIntoElemEnd(e):i.selection.jumpIntoElemBegin(e),n.preventDefault(),n.stopPropagation()}var i=this,t=i.selection.getRangy();if(t&&t.startContainer){if(i.writingArea.contains(t.commonAncestorContainer))return;if($(t.startContainer.parentElement).offset().top>n.clientY-30)return}File.isLocked;for(var r,o,a=window.innerHeight,t=document.querySelector("#write > *").getBoundingClientRect(),s=n.pageX>t.right-2,l=n.pageX<t.left+2,c=(t.left+t.right)/2,d=n.pageY;d<a;d+=20)if(o=(r=$(document.elementFromPoint(c,d))).closest("[mdtype]").addBack("[mdtype]"),!r.find("[mdtype]").length&&o.length)return e(o,s),i.refocus(o.attr("cid")),void(File.inBusyMode&&o.focus());for(d=n.pageY;0<d;d-=20)if(o=(r=$(document.elementFromPoint(c,d))).closest("[mdtype]").addBack("[mdtype]"),!r.find("[mdtype]").length&&o.length)return e(o,!l),i.refocus(o.attr("cid")),void(File.inBusyMode&&o.focus())}lazyFireEvent_(e,t,n){var i=this.timerPool_,r=this.timerPool_[t];r&&clearTimeout(r),setTimeout(function(){$(e).trigger(t),i[t]=null},100)}onDropContent(e,t){if(!File.isMac||!File.isActiveWindow())return dropContents=null,!1;t&&this.selection.setRange(t),UserOp.insertDom(e)}simpleParse(e,t){var n,i=Node.isType(e,TYPE.paragraph);if(Node.isType(e,TYPE.raw_edit,TYPE.paragraph)&&/(^[<\u2013\u2014`~>#|\-+*1-9=\[])|\n\s*\S/gm.test(e.safeGetStrAttr("text")))return this.brush.pause(),(n=this.undo.UndoManager.makeEmptyCommand()).undo.push(this.selection.buildUndo()),n.undo.push(UndoManager.buildReplaceUndo(e)),t=e.parseFrom(t?{skips:{enableStartMatch:!0,enableRemap:!0}}:{skips:{enableRemap:!0}}),i&&Node.isType(e,TYPE.paragraph)&&1==t[1].length?(this.brush.restart(),null):(n.redo.push(this.undo.buildReplaceUndo(t[1][0])),UndoManager.addUndoForInsertArray(n,t[1].slice(1)),i=t[0],this.brush.restart(),[n,i,e.cid,t[1]])}findElemById(e){return e?$(this.writingArea.querySelector('[cid="'+e+'"]')):$()}findNodeByElem(e){return e.length?this.getNode(e.attr("cid"),!1):null}insertText(e){this.UserOp.pasteHandler(this,e,!0,!0,!0)}finishRawBlockEdit(e){var t=null,e=(t=$(e?e.target:document.activeElement).closest(".md-rawblock")).attr("mdtype");e==TYPE.html_block&&this.htmlBlock.stopEditing(t.attr("cid"),!0),e==TYPE.math_block&&this.mathBlock.stopEditing(t.attr("cid"),!0),$(".ty-tooltip").removeClass("shown")}warpContentWithOption(e){return File.finalNewline&&"\n"!=e.substr(e.length-1)?e+(File.useCRLF?"\r\n":"\n"):e}getMarkdown(){return this.sourceView.inSourceMode?this.sourceView.cm.getValue():this.warpContentWithOption(this.nodeMap.toMark())}getNode(e,t,n){return n?e=this.refocus():t&&(e=(e=e||this.focusCid)||this.refocus()),this.nodeMap.allNodes.get(e)}restoreLastCursor(e,t){e&&e.preventDefault(),this.lastCursor&&(document.activeElement!=this.writingArea&&(e=$("content").scrollTop(),this.writingArea.focus(),$("content").scrollTop(e)),this.undo.exeCommand(this.lastCursor,t?[]:void 0))}toggleFocusMode(){File.isFocusMode=!File.isFocusMode,JSBridge.putSetting("isFocusMode",File.isFocusMode),this.updateFocusMode(File.isFocusMode,!0,!0),File.isFocusMode||document.body.classList.remove("ty-show-notification")}updateFocusMode(e,t,n){(e?enterFocusMode:exitFocusMode).call(this),t&&(File.isNode?window.ClientCommand.refreshViewMenu():File.isMac&&JSBridge.menu.update("View→Focus Mode",{state:File.isFocusMode})),e&&n&&EditHelper.showFocusModeWarning()}setTypeWriterMode(e,t,n){var i;File.isTypeWriterMode==e&&!t||(File.isTypeWriterMode=e,i=this,e?(document.body.classList.contains("ty-on-typewriter-mode")||document.body.classList.add("ty-on-typewriter-mode"),setTimeout(function(){var e=(document.querySelector("content").clientHeight-i.defaultTextHeight)/2;document.querySelector("#write-style").innerHTML="#write { \npadding-top: $1px;\npadding-bottom: 0;\n}\n#write:after {\nheight: $2px;\n}".replace(/\$1/g,e-i.defaultTextHeight).replace(/\$2/g,e+i.defaultTextHeight),i.sourceView&&i.sourceView.inSourceMode||i.selection.typeWriterScroll(null,null)},100)):t||(document.querySelector("#write-style").innerHTML=0,document.body.classList.remove("ty-on-typewriter-mode"),i.selection.scrollAdjust()),i.sourceView&&i.sourceView.enableTypeWriterMode(e),t)||(File.isNode?window.ClientCommand.refreshViewMenu():File.isMac&&JSBridge.menu.update("View→Typewriter Mode",{state:File.isTypeWriterMode})),e&&n&&EditHelper.showTypeWriterModeWarning()}toggleTypeWriterMode(e){void 0===e&&(e=!File.isTypeWriterMode),this.setTypeWriterMode(e,!1,!0),JSBridge.putSetting("isTypeWriterMode",e),e||document.body.classList.remove("ty-show-notification")}syncFullContent(){var e,t=File.editor.sourceView.inSourceMode||!1;File.isMac?File.isActiveWindow()&&(e=File.sync(),bridge.callHandler("controller.syncFullContent",[!!t,e])):File.isNode&&File.isActiveWindow()&&JSBridge.invoke("document.syncFullContent",t)}async applyFullContent(e,t){File.isActiveWindow()||(t=t,void 0!==(t=File.isNode?await JSBridge.invoke("document.getContent"):t)&&(this.undo.exeCommand({type:"sync",content:t,fromSourceMode:e},void 0,!0),this.refresh()))}syncChange(e){function t(e,t){return e.map(function(e){return!e||"fences"==e.type?null:e},t)}var n;e&&(File.isMac?bridge.callHandler("document.syncChangeIfNeeded",JSON.stringify(t(e,this)),function(e){e&&scheduleFullContentSync()}):File.isNode&&(n=reqnode("electron").ipcRenderer,(e=t(e,this)||[]).length)&&n.send("doc.syncChange",JSON.stringify(e)))}applyChange(e){try{var t,n;e&&!File.isActiveWindow()&&(t="string"==typeof e?JSON.parse(e):e,n=!1,window.debugMode&&(i=t[0])&&("sync"==i.type?void 0===i.html&&void 0===i.allHtml&&void 0===i.cmChanges&&void 0===i.tex&&void 0===i.srcChanges&&i.content:i.type),t.forEach(function(e){n=this.undo.exeCommand(e,void 0,!0)||n},this),n)&&this.refresh()}catch(e){console.error(e)}var i}startScrolling(e){this.strollingBySelect=!0;var t=$("content"),n=t[0].scrollHeight-window.innerHeight,e=e?0:n;t.stop(!0).animate({scrollTop:e},Math.abs(e-t.scrollTop())/256*1e3,"linear")}stopScrolling(){this.strollingBySelect&&($("content").stop(!0),this.strollingBySelect=!1)}}var syncTimer,doSync=function(){editor.syncFullContent(),syncTimer=null},scheduleFullContentSync=function(){syncTimer&&clearTimeout(syncTimer),syncTimer=setTimeout(doSync,500)},ipc,pressReturn=(window.reqnode&&(ipc=reqnode("electron").ipcRenderer,ipc.on("scheduleFullContentSync",function(){scheduleFullContentSync()})),Editor.prototype.scheduleFullContentSync=scheduleFullContentSync,function(n,i,e){var t,r,o=this,a=(this.autoComplete&&this.autoComplete.hide(),this.undo.endSnap(!0),this.getMarkElem()),s=(this.brush.brushNode(a.attr("cid")),this.selection.getRangy()),l=(s||{}).startContainer;if(l){if(a=this.getMarkElem(l),!Node.isType(a.attr("mdtype"),NodeDef.TYPE.fences,NodeDef.TYPE.footnote)){this.brush.pause(),o.getJQueryElem(s.commonAncestorContainer).closest("[mdlike='fences']").length?(t=r=UndoManager.makeEmptyCommand(o.selection.buildUndo(s)),o.selection.jumpIntoElemEnd(a)):(t=r=UserOp.backspaceHandler(this,null,"delSelection",!0,!1),a=this.getMarkElem());var c,d,l=a.closest(".md-table").length,s=l,u=a.attr("cid"),h=this.store(u),p=this.selection.buildUndo();if(File.isTypeWriterMode&&this.selection.lockNativeScroll(),function(e){if(a.attr("mdtype")==NodeDef.TYPE.meta_block)try{var t=e.selection.getRangy();return!n&&!i&&t.collapsed&&t.endContainer.textContent.replace(/\n$/,"").length<=t.endOffset&&t.endContainer.textContent.match(/\n{2,}$/g)?void 0:1}catch(e){return 1}}(this))(t=t||UndoManager.makeEmptyCommand()).undo.push(p),UserOp.insertInlineText(this,null,"\n",this.selection.getOffset(a),t,!0),this.undo.register(t),this.brush.addToQueue(u);else if(d=(d=this).getNode(u),!Node.isType(d,TYPE.def_link,TYPE.def_footnote)||!Node.isEmptyBlock(d))if(l)if(i)this.UserOp.pasteHandler(this,"<br />",!0);else if(n)t=this.tableEdit.addRow(!1,r),r&&(t=UndoManager.append(r,t),this.undo.register(t));else{for(;r&&r.undo.length;)this.undo.exeCommand(r.undo.pop());this.tableEdit.moveToBelowCell(!0)}else s||h&&(c=h.breakOn(n,this,i))&&(d=document.querySelector("content").scrollTop,l=this.findElemById(c.oldCid),(s=$.parseHTML(c.newHtml)).length?(l.replaceWith(s),0):l.remove(),h=this.getNode(c.nextFocus),e?(this.undo.exeCommand(p),c.command.redo.push(p)):(Node.isType(h,TYPE.math_block)?(c.command.redo.push({type:"fences-pos",id:c.nextFocus,pos:{line:0,ch:0}}),c.nextFocus,setTimeout(function(){o.mathBlock.startEditing(c.nextFocus,"begin")},0)):Node.isType(h,TYPE.html_block)?(c.command.redo.push({type:"fences-pos",id:c.nextFocus,pos:{line:0,ch:0}}),setTimeout(function(){o.htmlBlock.startEditing(c.nextFocus,"auto")},0)):(s=this.findElemById(c.nextFocus),c.cursor?(i&&s.find(".md-emoji-control-ch").text(""),this.undo.exeCommand(c.cursor),i&&s.find(".md-emoji-control-ch").text("​")):c.cursorDiff?this.selection.jumpInto(s,c.cursorDiff):this.selection.jumpIntoElemBegin(s),c.command.redo.push(this.selection.buildUndo())),this.focusCid=this.refocus(c.nextFocus,void 0,void 0,!0),this.findElemById(c.nextFocus).addClass("md-focus"),Node.isType(h,TYPE.fences)&&(this.fences.lastCodeLang=h.get("lang")||"")),r&&(c.command=UndoManager.append(r,c.command)),this.undo.register(c.command),this.quickRefresh(),document.querySelector("content").scrollTop=d);else t=this.UserOp.backToParagraph(o,this.getNode(u),!0,!1),r&&(t=UndoManager.append(r,t)),this.undo.register(t);c&&c.nextFocus||this.refocus(),this.brush.resume(),this.selection.scrollAdjust()}return!0}}),normalCleanTooltip_=function(){$(".md-tooltip-remove").remove(),$(".md-focus").removeClass("md-focus"),$(".md-focus-container").removeClass("md-focus-container");var e=document.body.classList;(e.contains("ty-show-word-count")||e.contains("ty-show-spell-check"))&&(e.remove("ty-show-word-count"),e.remove("ty-show-spell-check"))},viewInFocusMode=!1,exitFocusModeTimer,enterFocusMode=function(){exitFocusModeTimer&&clearTimeout(exitFocusModeTimer),viewInFocusMode||(viewInFocusMode=!0,document.body.classList.add("on-focus-mode"),exitFocusModeTimer=setTimeout(enterFocusMode,100))},exitFocusMode=function(){exitFocusModeTimer&&(clearTimeout(exitFocusModeTimer),exitFocusModeTimer=null),viewInFocusMode&&(viewInFocusMode=!1,document.body.classList.remove("on-focus-mode"))};function performClick(e,t,n,i){var r=document.createEvent("MouseEvents");r.initMouseEvent("mousedown",!0,!0,t.ownerDocument.defaultView,1,e.screenX+n,e.screenY+i,e.clientX+n,e.clientY+i,e.ctrlKey,e.altKey,e.shiftKey,e.metaKey,e.button),t.dispatchEvent(r)}module.exports=Editor}),$__System.registerDynamic("4c",["e","b","c","d","f","10","47","45"],!0,function(e,t,n){this||self;window.$=e("e"),window.jQuery=window.$,window.fastdom=e("b"),window.fastdomPromised=e("c"),(fastdom=fastdom.extend(fastdomPromised)).strict&&fastdom.strict(!1),e("d"),e("f"),window.NFile=window.File;var i=window._options.userLocale||"Base",r=(e("10"),e("47")),o=e("45"),a={language:i=window._options?_options.locale||_options.userLocale:i,pathPrefix:"locales"};$.localize.localeOption=a,$("[data-lg='Front'], [data-after-content], [ty-hint]").localize("Front",a),window.reqnode&&window._options.sidebarTab&&540<window.innerWidth&&((e=document.querySelector("#typora-sidebar")).classList.add("open"),e.style.transition="0s",document.body.classList.add("pin-outline"),_options.sidebarWidth)&&document.documentElement.style.setProperty("--sidebar-width",_options.sidebarWidth+"px"),$.fn.rawText=function(e){return this.length?this[0].rawText(e):""},window.setWritingContent=function(e,t){for(;e.lastChild;)e.removeChild(e.lastChild);for(var n=document.createElement("div"),i=(n.innerHTML=t,document.createDocumentFragment());n.firstChild;)i.appendChild(n.firstChild);e.appendChild(i)},(window.File=r).language=i,init=function(){var e,t=new o("#write",r);e=t,window.getMarkdown=function(){return e.getMarkdown()},window.editor=t,setTimeout(function(){document.querySelector("#typora-sidebar").style.transition="",$("[data-lg='Panel']").localize("Panel",a),$("[data-lg='Menu']").localize("Menu",a)},20)},t.init=init,r.isNodeHtml||init()}),$__System.registerDynamic("4b",["26","13","2c","2f","29","11","1b"],!0,function(e,R,t){"use strict";this||self;var s="",n=(e("26"),e("13")),h=n.Node,p=n.TYPE,f=e("2c"),i=e("2f"),r=e("29"),m=e("11"),n=e("26"),o=(e("1b").SnapFlag,n.map);function a(e){e=e||".context-menu",$(e).removeClass("show").find(".active").removeClass("active"),$(".ty-tooltip").removeClass("shown")}function l(e){a(),JSBridge.invoke("window.inspectElement",e.clientX,e.clientY)}var c,d,u=!1;function g(){u=!0;var i=_options.searchService||[["Search with Google","https://google.com/search?q=%s"]];i.forEach(function(t,e){var n=$($.parseHTML('<li data-group="search" data-key>\n<a role="menuitem">'+m.escape($.localize.getString(t[0],"Menu"))+"</a></li>")[0]);0===e?($("#search-service-placeholder").after('<li class="divider" data-group="search"></li>').replaceWith(n),n.attr("data-key","search-default"),2<i.length&&n.after('<li data-key="search-with" data-group="search" class="has-extra-menu">\n<a role="menuitem"><span>'+$.localize.getString("Search With…")+'</span><i class="fa fa-caret-right"></i></a></li>')):1===e&&2==i.length?$("[data-key='search-default']").after(n):$("#search-menu").append(n),n.click(function(){var e;e=t[1],a(),JSBridge.showInBrowser(e.replace(/%s/,encodeURIComponent(s)))})})}function y(e,t){e=$("[data-group='"+e+"']");t?e.removeClass("hide"):e.addClass("hide")}function v(){return File.editor&&File.editor.spellChecker&&File.editor.spellChecker.curSpellchecker}function b(e){var t,n,i;c=null,d="",!e&&(e=v(),t=$("#context-menu"),(c=File.editor.selection.getRangy())&&(File.editor.selection.selectWord(!1,!1,c,!0,!0),d=c.toString().trim()),d=((d=";"==d?"":d)||"").replace(/[’]/g,"'"),e)&&d.length?(n=d,i=File.editor.spellChecker.getSpellCheckLang_(),File.isWin&&"zh"==i&&n&&n.match(/\p{Script=Han}/u)||!e.isMisspelled(n)||-1<n.indexOf(".")&&!e.isMisspelled(n+".")?e.isLearned(d)?(t.find("[data-key='correct']").remove(),y("spell-check",!0),t.find("[data-key='learn'], #divider-before-learn").addClass("hide"),t.find("[data-key='unlearn']").removeClass("hide")):y("spell-check",!1):(y("spell-check",!0),t.find("[data-key='correct']").remove(),t.find("[data-key='unlearn']").addClass("hide"),0==(i=e.getCorrectionsForMisspelling(d.trim())).length?t.find("#divider-before-learn").addClass("hide"):(i=i.slice(0,6),t.find("#divider-before-learn").removeClass("hide").before(i.reduce(function(e,t){return e+='<li data-group="spell-check" data-key="correct"><a role="menuitem">'+t+"</a></li>"},""))))):y("spell-check",!1)}function w(e,t){var n,i,r;File.editor.sourceView&&File.editor.sourceView.inSourceMode?(r=(n=File.editor.sourceView.cm).getCursor("from"),i=n.getCursor("to"),n.setSelection(r,i,{scroll:!1}),n.focus()):e?(t&&3==c.endContainer.nodeType&&"."==(r=c.endContainer.textContent)[c.endOffset]&&"."!=r[c.endOffset-1]&&c.setEnd(c.endContainer,c.endOffset+1),File.editor.selection.setRange(c)):File.editor.lastCursor&&File.editor.undo.exeCommand(File.editor.lastCursor)}async function x(){var n,i,t,r,o;File.isNode&&(n=await JSBridge.invoke("setting.getKeyBinding"),i={"Delete Table":"Delete Block","Paragraph (before)":"Insert Paragraph Before","Paragraph (after)":"Insert Paragraph After",Table:"Insert Table",Image:"Insert Image"},t={Backspace:"⌫"},r=function(e){return e.trim().split(/\s*\+\s*/g).map(function(e){return m.capitalize($.localize.getString(t[e]||e,"Menu"))}).join("+")},o=function(e,t){t=n[e]||n[t]||n[e.replace(/\.\.\.|…/,"")]||n[t.replace(/\.\.\.|…/,"")];return t=!t&&i[e]?n[i[e]]:t},document.querySelectorAll("#context-menu .menu-style-btn").forEach(e=>{var t=e.dataset.label,n=$.localize.getString(t,"Menu"),t=o(t,n)||e.dataset.keyStr;t?e.setAttribute("ty-hint",n+`	`+r(t)):e.setAttribute("ty-hint",n)}),document.querySelectorAll(".ty-menu-shortcut").forEach(e=>{var t,n,i="";e.classList.contains("ty-no-key-mod")?i=e.textContent:(t=e.previousElementSibling)&&(n=t.dataset.localize,i=o(n,t.textContent)||e.textContent),i&&i.trim()&&(e.textContent=r(i))}))}function C(e){this.sessionStr=e,$(A.bind(this))}var F,S,k,E,T,_=function(){!!document.querySelector("#user-context-menu.show")?this.showCustom(T,E):a()},A=function(){$("content").on("post-wheel",_.bind(this)),$(window).on("resize",_.bind(this)),U.call(this),O.call(this),q.call(this),File.isMac||(W.call(this),L.call(this),I.call(this),H.call(this),window.reqnode&&(setTimeout(j.bind(this),1e3),setTimeout(x,1e3)))},M=function(e){var t=File.editor,n=t.styleBookmark.style,i=n.block[0],r=document.querySelector("#context-menu"),o=n.cannotContainInline,a=!1,s=!1,l=!1,c=!1,d=!1,o=(y("inline-style",!o),$("[data-style]").removeClass("active"),n.inline.map(function(e){var t=document.querySelector("[data-style='"+e+"']");t&&t.classList.add("active"),h.isType(e,p.inline_math)&&(l=!0),(h.isType(e,p.image)||h.isType(e,p.imgtag))&&(c=!0),h.isType(e,p.emoji)&&(d=!0),h.isType(e,p.image)&&(c=p.image),h.isType(e,p.imgtag)&&(c=p.imgtag)}),$(e)),e=o.closest("[md-inline]").attr("md-inline"),e=(!c&&h.isType(e,p.imgtag,p.image)&&(c=e),o.closest(".CodeMirror").length),o=(c===p.image&&($("[data-key='switch-img-syntax-markdown'] > a").addClass("state-on"),$("[data-key='switch-img-syntax-html'] > a").removeClass("state-on")),c===p.imgtag&&($("[data-key='switch-img-syntax-markdown'] > a").removeClass("state-on"),$("[data-key='switch-img-syntax-html'] > a").addClass("state-on")),n.block.map(function(e){h.isType(e,p.blockquote,p.list_item,"ul","ol")&&(a=!0),h.isType(e,p.table)&&(s=!0),h.isType(e,p.math_block)&&(l=!0)}),$.localize.getString(f.CONST.StyleToNameMap[i],"Menu"));if(h.isType(i,p.html_block,p.math_block)?$("[data-key='block-style']").addClass("hide"):($("[data-key='block-style']").removeClass("hide"),$("[data-key='block-style'] span").text(o||$.localize.getString("Paragraph","Menu"))),!(o=i==p.paragraph&&(!(t=t.getNode(F.attr("cid")))||t.get("before")||t.get("after")||t.get("parent")&&(t=t.get("parent")),t)?$.localize.getString(f.CONST.StyleToNameMap[t.get("type")],"Menu"):o)||h.isType(i,p.paragraph,p.heading)||/header/.exec(i)?$("[data-group='delete-block']").addClass("hide"):$("[data-key='delete-block']").children("a").text($.localize.getString("Delete %@","Menu").replace("%@",o||"")).removeClass("hide"),$("#block-style-menu [data-block]").removeClass("state-on").filter("[data-block='"+i+"']").addClass("state-on"),0<n.block.length&&File.editor.stylize.CONST.NormalBlockMap[i]?($("[data-block-auto-disable]").removeClass("disabled"),$("[data-block-auto-hide]").removeClass("hide")):($("[data-block-auto-disable]").addClass("disabled"),$("[data-block-auto-hide]").addClass("hide")),i!=p.def_footnote&&i!=p.def_link||($("#insert-menu [data-block-auto-disable]").addClass("disabled"),$("#insert-menu [data-block-auto-hide]").addClass("hide")),i==p.meta_block?$('[data-insert-p="before"]').parent().addClass("disabled"):$('[data-insert="meta_block"]').removeClass("hide"),h.isType(i,p.html_block,p.math_block,p.meta_block)?$("[data-group='block-wrap']").addClass("hide"):$("[data-group='block-wrap']").removeClass("hide"),a?r.querySelector('[data-group="block-tab"]').classList.remove("hide"):r.querySelector('[data-group="block-tab"]').classList.add("hide"),e?($("[data-group='code']").removeClass("hide"),$("[data-group='inline-style']").addClass("hide")):($("[data-group='code']").addClass("hide"),$("[data-group='inline-style']").removeClass("hide")),s?($('[data-group="table"]').removeClass("hide"),r.querySelector('[data-key="block-style"]').classList.add("hide")):($('[data-group="table"]').addClass("hide"),r.querySelector('[data-key="block-style"]').classList.remove("hide")),d?((t=$(".md-emoji.md-expand [data-emoji]").attr("data-emoji"))&&(r.querySelector('[data-key="copy-emoji"] a').textContent=$.localize.getString("Copy '%@'","Menu").replace("%@",t)),$("#context-menu [data-group='emoji']").addClass(t?"show":"hide")):$("#context-menu [data-group='emoji']").addClass("hide"),$("#context-menu [data-group='image']").addClass("hide"),c){i=(o=$(".md-image.md-expand")).find("img").attr("src")||"",o=!o.hasClass("md-img-error");if(i){const u=/^file:\/\//.exec(i);["reveal-img-in-finder","delete-img-file","select-img-target-move"].forEach(e=>{var t=r.querySelector(`[data-key="${e}"]`).classList;("reveal-img-in-finder"!==e||!File.isTextPack()&&!File.isTextBundle())&&u?t.remove("hide"):t.add("hide")}),["reveal-img-in-browser","delete-img"].forEach(e=>{e=r.querySelector(`[data-key="${e}"]`).classList;u?e.add("hide"):e.remove("hide")}),r.querySelector('[data-key="zoom-img"]').classList.remove("hide"),r.querySelector('[data-key="switch-img-syntax"]').classList.remove("hide"),!o||File.isTextBundle()||File.isTextPack()||(r.querySelector('[data-key="copy-img"]').classList.remove("hide"),r.querySelector('[data-key="upload-img"]').classList.remove("hide"),(o=File.editor.imgEdit.getTargetImageStorageFolder())&&"upload"!=o&&(e=m.escapeURL(o),-1==i.replace(/^file:\/\//,"").indexOf(e))&&(i=m.getFolder(o))&&($(r).find('[data-key="copy-img-to-target"] a').text($.localize.getString("Copy to %@","Menu").replace("%@",i)),r.querySelector('[data-key="copy-img-to-target"]').classList.remove("hide")),r.querySelector('[data-key="select-img-target"]').classList.remove("hide"),r.querySelector('[data-key="select-img-target-move"]').classList.remove("hide"),$('.divider[data-group="image"]').removeClass("hide"))}}n.textSelected?$("[data-key='copy'], [data-key='cut'], [data-copy-action], [data-key='backspace']").removeClass("disabled"):($("[data-copy-action]").addClass("disabled"),File.option.lineWiseCopyCut||$("[data-key='copy'], [data-key='cut']").addClass("disabled"));t=$(S).closest(".md-rawblock-container");return t.length?($("[data-group='copy-paste']").addClass("hide"),$("[data-key='copy'], [data-group='edit-block']").removeClass("hide"),t.hasClass("md-htmlblock-container")&&$("[data-key='copy']").addClass("hide")):($("[data-group='copy-paste']").removeClass("hide"),$("[data-group='edit-block']").addClass("hide")),S.closest&&S.closest(".md-diagram-panel, .md-math-container, .md-mathjax-preview")?$("[data-group='adv-media']").removeClass("hide"):$("[data-group='adv-media']").addClass("hide"),(l?($("[data-group='math']").removeClass("hide"),$("[data-group='adv-media'].divider, [data-copy-action], [data-paste-action]").addClass("hide"),$("[data-key='copy-as']")):($("[data-group='math']").addClass("hide"),$("[data-copy-action], [data-paste-action]"))).removeClass("hide"),S.closest&&S.closest("img, svg, video, .md-diagram-panel, .md-math-container, .md-mathjax-preview")&&$("[data-key='download-as']").removeClass("hide").find("[data-localize]").text(function(){return $.localize.getString(this.dataset.localize,"Menu").replace("%@",$.localize.getString("Image","Menu"))}),S.closest&&S.closest(".md-diagram")&&$("[data-key='download-as']").find("[data-localize]").text(function(){return $.localize.getString(this.dataset.localize,"Menu").replace("%@",$.localize.getString("Diagram","Menu"))}),l&&$("[data-key='download-as'] [data-localize]").text(function(){return $.localize.getString(this.dataset.localize,"Menu").replace("%@",$.localize.getString("Math","Menu"))}),$(S).closest("video").length?($("[data-group='video']").removeClass("hide"),$("[data-key='download-as'] [data-localize]").text(function(){return $.localize.getString(this.dataset.localize,"Menu").replace("%@",$.localize.getString("Video","Menu"))})):$(S).closest("video").length&&$("[data-group='video']").addClass("hide"),{showIndent:a,showTable:s,showMath:l,showImage:c,showEmoji:d}},L=function(){$("[data-style]").click(function(){a(),w(),File.editor.refocus(),File.editor.stylize.toggleStyle(this.getAttribute("data-style"))})},N=function(){var e=File.editor.getMarkElem(),t=!1;e.closest("tbody").children().length?($("[data-key='delete_table_row']").removeClass("hide"),t=!0):$("[data-key='delete_table_row']").addClass("hide"),2<=e.closest("tr").children().length?($("[data-key='delete_table_col']").removeClass("hide"),t=!0):$("[data-key='delete_table_col']").addClass("hide"),t?$("[data-key='delete_table_col']").next(".divider").removeClass("hide"):$("[data-key='delete_table_col']").next(".divider").addClass("hide")},O=(C.prototype.updateTableVisibility=N,function(){$("body").on("mouseenter",".context-menu [data-key]",function(){var e=$(this);e.closest(".context-menu").find(".active").removeClass("active"),e.addClass("active")}).on("mouseleave",".context-menu",function(e){$(this).find(".active:not(.has-extra-menu)").removeClass("active")}),$("#context-menu, #user-context-menu").on("mouseenter","[data-key]",function(){var e=$(this);"block-style"==e.attr("data-key")?(P("#block-style-menu",e),e.addClass("active")):(document.querySelector("#block-style-menu").classList.remove("show"),document.querySelector("[data-key='block-style']").classList.remove("active")),"insert"==e.attr("data-key")?(P("#insert-menu",e),e.addClass("active")):(document.querySelector("#insert-menu").classList.remove("show"),document.querySelector("[data-key='insert']").classList.remove("active")),"copy-as"==e.attr("data-key")?(P("#edit-menu",e),e.addClass("active")):(document.querySelector("[data-key='copy-as']").classList.remove("active"),document.querySelector("#edit-menu").classList.remove("show")),"zoom-img"==e.attr("data-key")?(P("#zoom-img-menu",e),e.addClass("active")):(document.querySelector("[data-key='zoom-img']").classList.remove("active"),document.querySelector("#zoom-img-menu").classList.remove("show")),"switch-img-syntax"==e.attr("data-key")?(P("#switch-img-syntax-menu",e),e.addClass("active")):(document.querySelector("[data-key='switch-img-syntax']").classList.remove("active"),document.querySelector("#switch-img-syntax-menu").classList.remove("show")),"search-with"==e.attr("data-key")?(P("#search-menu",e),e.addClass("active")):(document.querySelector("#search-menu").classList.remove("show"),$("[data-key='search-with']").removeClass("active")),"table"==e.attr("data-key")?(N(),P("#table-menu",e),e.addClass("active")):(document.querySelector("#table-menu").classList.remove("show"),document.querySelector("[data-key='table']").classList.remove("active"))})}),I=function(){$("#context-menu").on("click","[data-indent]",function(){var e=this.getAttribute("data-indent");a(),w(),File.editor.refocus(),File.editor.stylize.toggleIndent(e)}).on("click","[data-tab]",function(){a(),w(),File.editor.refocus();"left"==this.getAttribute("data-tab")?i.lessIndent(File.editor):i.moreIndent(File.editor)}),$("#block-style-menu").on("click","[data-block]",function(){var e=this.getAttribute("data-block");a(),w(),File.editor.refocus(),File.editor.stylize.changeBlock(e)}),$("#insert-menu").on("click","[data-insert]",function(){var e=this.getAttribute("data-insert");a(),w(),File.editor.refocus(),e===p.table?File.editor.tableEdit.insertTable():e===p.meta_block?File.editor.stylize.insertMetaBlock():File.editor.stylize.insertBlock(e)}).on("click","[data-insert-p]",function(){var e="before"==this.getAttribute("data-insert-p");a(),File.editor.refocus(F.attr("cid")),File.editor.UserOp.insertParagraph(e,File.editor,F)})},H=function(){$("#edit-menu").on("click",'[data-key="copy_as_mathml"]',function(){a(),w(),-1<File.editor.styleBookmark.style.block.indexOf(p.math_block)?File.editor.mathBlock.copyAsMathML(F[0]):File.editor.mathInline.copyAsMathML()}).on("click",'[data-key="copy_as_word"]',function(){a(),w(),-1<File.editor.styleBookmark.style.block.indexOf(p.math_block)?File.editor.mathBlock.copyAsMathML(F[0],!0):File.editor.mathInline.copyAsMathML(!0)}).on("click",'[data-key="copy_as_math_tex"]',function(){a(),w(),-1<File.editor.styleBookmark.style.block.indexOf(p.math_block)?File.editor.mathBlock.copyAsTex(F[0]):File.editor.mathInline.copyAsTex()}).on("click",'[data-key="copy_as_math_image"]',function(){a(),w(),-1<File.editor.styleBookmark.style.block.indexOf(p.math_block)?File.editor.mathBlock.copyAsImage(F[0]):File.editor.mathInline.copyAsImage()}),File.isWin||$("#math-menu [menu-for-win]").addClass("hide")},U=function(){$("#table-menu").on("click",'[data-key="insert_row_before"]',function(){a(),w(),File.editor.tableEdit.addRow(!0)}).on("click",'[data-key="insert_row_after"]',function(){a(),w(),File.editor.tableEdit.addRow(!1)}).on("click",'[data-key="delete_table_row"]',function(){a(),w(),File.editor.tableEdit.deleteRow(!1)}).on("click",'[data-key="insert_col_before"]',function(){a(),w(),File.editor.tableEdit.addCol(!0)}).on("click",'[data-key="insert_col_after"]',function(){a(),w(),File.editor.tableEdit.addCol(!1)}).on("click",'[data-key="delete_table_col"]',function(){a(),w(),File.editor.tableEdit.deleteCol()}).on("click",'[data-key="delete_table"]',function(){a(),w(),File.editor.tableEdit.deleteTable()}).on("click",'[data-key="copy_table"]',function(){a(),w(),File.editor.tableEdit.copyTable()}).on("click",'[data-key="reformat_table"]',function(){a(),w(),File.editor.tableEdit.reformatTable()}).on("click",'[data-key="move_row_up"]',function(){a(),w(),File.editor.tableEdit.moveRowUpOrDown(!0)}).on("click",'[data-key="move_row_down"]',function(){a(),w(),File.editor.tableEdit.moveRowUpOrDown(!1)}).on("click",'[data-key="move_col_left"]',function(){a(),w(),File.editor.tableEdit.moveColLeftOrRight(!0)}).on("click",'[data-key="move_col_right"]',function(){a(),w(),File.editor.tableEdit.moveColLeftOrRight(!1)})},j=function(){$("#context-menu").on("click","[data-key='learn']",function(){a(),w(),v().add(d)}).on("click","[data-key='unlearn']",function(){a(),w(),v().remove(d)}).on("click","[data-key='correct']",function(e){a();e=$(e.target).text();w(!0,!!/\.$/.exec(e)),i.pasteHandler(File.editor,e,!0)})},q=function(){$("#zoom-img-menu").on("click","[data-key='zoom-img-to-factor']",function(){a(),w(),File.editor.imgEdit.zoomAction(null,this.dataset.factor)}),$("#switch-img-syntax-menu").on("click","[data-key='switch-img-syntax-markdown']",function(){a(),w(),File.editor.imgEdit.switchPattern(null,!1)}),$("#switch-img-syntax-menu").on("click","[data-key='switch-img-syntax-html']",function(){a(),w(),File.editor.imgEdit.switchPattern(null,!0)})},W=function(){$("#context-menu, #context-menu-for-source").on("click","[data-key='jumpto']",function(){a(),w();var e=File.editor.getJQueryElem(window.getSelection().anchorNode),t=e.closest("a");t.length||(t=e.closest("[md-inline]").find("a")),File.editor.tryOpenLink(t)}).on("click","[data-key='copy_link']",function(){a(),w(),File.editor.copyCurrentLink()}).on("click","[data-key='dev-tool']",l).on("click","[data-key='edit']",function(e){return a(),w(),File.editor.undo.prepCursorSnap(),$(S).closest(".md-rawblock-container").trigger("startedit"),File.editor.undo.endSnap(),!1}).on("click","[data-key='cut']",function(e){var t;a(),w(),ClientCommand.cut(),document.activeElement&&(t=document.activeElement.closest(".CodeMirror"))&&setTimeout(function(){t.CodeMirror.replaceSelection("","start")},30)}).on("click","[data-key='backspace']",function(e){a(),w(),File.editor.selection.getRangy()?File.delete():File.deleteActive(S)}).on("click","[data-key='copy']",function(e){a(),F.find(".md-rawblock-container").focus().length||w(),ClientCommand.copy()}).on("click","[data-key='delete-block']",function(e){a(),w(),F.length&&(File.editor.refocus(F.attr("cid")),File.editor.UserOp.deleteBlock(File.editor))}).on("click","[data-key='paste']",function(e){a(),w(),ClientCommand.paste()}).on("click","[data-key='copy-emoji']",function(e){a(),w();var t=$(".md-emoji.md-expand [data-emoji]").attr("data-emoji");File.editor.UserOp.setClipboard("","",t,!0)}).on("click","[data-key='download-as']",function(e){a(),w();var t=F.find(".md-fences-adv-panel svg, .md-math-container svg, .md-mathjax-preview svg")[0];r.downloadAs(t||S.closest("svg, img, video"))}).on("click","[data-key='copy-all-code']",function(e){a(),w(),File.editor.fences.copyContent()}).on("click","[data-key='format-all-code']",function(e){a(),File.editor.refocus(F.attr("cid")),File.editor.fences.formatContent()}).on("click","[data-key='format-selected-code']",function(e){a(),File.editor.refocus(F.attr("cid")),File.editor.fences.formatContent(!0)}),$(".context-menu").on("mousedown",function(e){if(!$(e.target).closest("a").length)return!1}),File.isNode&&(File.option.debug?$("[data-group='dev-tool']").removeClass("hide"):$("[data-group='dev-tool']").addClass("hide")),$("#edit-menu").on("click","[data-key='copy_as_image']",function(e){a(),w();var t=F.find(".md-fences-adv-panel svg, .md-math-container svg, .md-mathjax-preview svg")[0];r.copyImage(t||S.closest("svg, img, video"))}).on("click","[data-key='copy_as_markdown']",function(e){a(),w(),ClientCommand.copyAsMarkdown()}).on("click","[data-key='copy_as_html_source']",function(e){a(),w();var t=F.find(".md-fences-adv-panel svg, .md-math-container svg, .md-mathjax-preview svg")[0];t?r.copyAsHtml(t):ClientCommand.copyAsHTMLSource()}).on("click","[data-key='copy_as_simple_html']",function(e){a(),w(),ClientCommand.copyAsSemanticHTML()}).on("click","[data-key='paste_as_plain']",function(e){a(),w(),ClientCommand.pasteAsPlain()}),$("[data-key='play']").click(function(e){a();try{$(S).closest("video")[0].play()}catch(e){}}),$("[data-key='pause']").click(function(e){a();try{$(S).closest("video")[0].pause()}catch(e){}})},D=function(e,t){e.addClass("show");var n=e.width()+20,i=e.height()+48,n=t.clientX>window.innerWidth-n?window.innerWidth-n:t.clientX,i=t.clientY>window.innerHeight-i?window.innerHeight-i:t.clientY-$("#top-titlebar").height()+8;e.css({top:i+"px",left:n+"px"})},P=(C.prototype.show=function(e,t){if(!u&&window.reqnode&&g.call(this),(S=t||e.target)==document.querySelector("#write")&&(S=(window.getSelection()||{}).anchorNode||S),(F=$(S).closest("[cid]")).hasClass("md-rawblock")||($(File.editor.sessionStr).trigger("cursorChange"),File.editor.lastCursor=File.editor.selection.buildUndo()),File.editor.stylize.putBookmark(null,File.editor.stylize.buildBookmark(F)),$(".context-menu").removeClass("show").find(".active").removeClass("active"),File.editor.sourceView.inSourceMode)return D($("#context-menu-for-source"),e),!1;try{var n,i=File.editor.getJQueryElem(window.getSelection().anchorNode).closest("a, .md-link"),r=i.attr("href")||i.attr("data-ref");y("hyperlink",r=i.hasClass("md-link")?(n=i.find("a")).attr("href")||n.attr("data-ref"):r)}catch(e){y("hyperlink",!1)}t=M(S)||{};if(t.showImage||t.showMath)y("search",!1);else{s="";try{var o,a=editor.selection.getRangy();y("search",0<(s=-1==(s=a.toString()).indexOf("\n")&&(o=a.toHtml(),(o=$("<div>"+a.toHtml()+"</div>").find(".md-meta").remove().end().text()).trim().length)?o:s).trim().length)}catch(e){y("search",!1)}}window.reqnode&&b(t.showImage||t.showMath),D($("#context-menu"),e),e.preventDefault(),e.stopPropagation()},C.prototype.hide=a,function(e,t){var n=t.width(),e=$(e).addClass("show"),i=e.width(),r=e.height()+48,t=t.offset(),o=t.left,n=o+n,t=t.top-30,o=n+i>window.innerWidth?Math.max(0,o-i-6):n+6,i=t+r>window.innerHeight?window.innerHeight-r:t;return e.css({top:i+"px",left:o+"px"}),!1}),B=(C.prototype.showExtMenu=P,function(e,t){var n,i,e=$(e);if("Enter"==t){if(!e.hasClass("has-extra-menu"))return((i=e.find("a")).length?i:e).trigger("click"),!0;t="OpenSubmenu"}if("Up"==t||"Down"==t){if(e.trigger("mouseleave"),e=e.closest("li"),0==(n="Up"==t?e.prev():e.next()).length){if(e.closest("#user-context-menu").length)return a(),!0;n="Up"==t?e.parent().children().last():e.parent().children().first()}return n.hasClass("hide")||n.hasClass("divider")?B(n[0],t):(e=e.closest(".context-menu").find(".active"),n.hasClass("has-btn-submenu")?(i=e.prevAll("a").length/(e.closest(".has-btn-submenu").find("a").length||1)*n.find("a").length,(n=$(n.find("[data-key]")[Math.floor(i)])).trigger("mouseenter")):(e.removeClass("active"),n.addClass("active")),!0)}if(("Left"==t||"Right"==t)&&"A"==e[0].tagName)return e.trigger("mouseleave"),(n=(n="Left"==t?e.prev():e.next()).length?n:"Up"==t?e.parent().children().last(""):e.parent().children().first()).trigger("mouseenter"),e.removeClass("active"),n.addClass("active"),!0;if("Left"==t||"Esc"==t){if((e=e.closest(".context-menu")).hasClass("ext-context-menu"))return e.find(".active").removeClass("active"),e.removeClass("show"),!0;if("Left"==t)return!0}return"Right"==t||"OpenSubmenu"==t?(e.hasClass("has-extra-menu")&&(e.trigger("mouseenter"),$(".ext-context-menu:visible [data-key]:visible").first().trigger("mouseenter")),!0):void 0});C.prototype.handleKeyEvent=function(e){var t,n,e=o[e.keyCode||e.which];if(h.isType(e,"Esc","Right","Left","Up","Down","Return","Enter"))return!!(t=$(".context-menu:visible")).length&&("Esc"==e?($(".context-menu").removeClass("show").find(".active").removeClass("active"),!0):t.find(".active").length?(n=$(".ext-context-menu .active")[0])?B(n,e):B($(".context-menu .active")[0],e):"Up"==e?(t.find("li[data-key]:visible").last().addClass("active"),!0):"Down"==e?(t.find("li[data-key]:visible").first().addClass("active"),!0):void 0)},C.prototype.getCustomFocuedElem=function(){return k.length?k:null},C.prototype.hideCustomMenu=function(e){e==E&&$("#user-context-menu.show").length&&this.addClass("hide")},C.prototype.showCustom=function(e,t){var i;k=null,window.getSelection().rangeCount&&(E=t,T=e,i=$("#user-context-menu").html(e.map(function(e){return e.key==C.SPLITER?'<li for-file class="divider"></li>':'<li data-key="'+e.key+'"'+(e.hasExtraMenu?' class="has-extra-menu" ':"")+'><a role="menuitem"'+(e.variable?" data-variable="+JSON.stringify(e.variable):"")+">"+$.localize.getString(e.label,"Menu").replace("%@",e.variable||"")+(e.hasExtraMenu?'<i class="fa fa-caret-right"></i>':"")+"</a></li>"}).join("")),setTimeout(function(){var e=window.getSelection().getRangeAt(0),t=e.getClientRects(),n=t.length&&t[t.length-1];n&&(0!=n.left||0!=n.height)||(e.selectNodeContents(e.commonAncestorContainer),n=(t=e.getClientRects()).length&&t[t.length-1]),!n||0==n.left&&0==n.height||(t=(t=$(e.commonAncestorContainer).closest("[cid]")[0])&&t.getBoundingClientRect().left||0,i.addClass("show").css({top:n.bottom+"px",left:Math.max(t,n.right-i.width()+20)+"px"}),k=$(e.commonAncestorContainer).closest("[md-inline]"))},100))},C.prototype.getContextTarget=function(){return S},C.prototype.getMenuItemsForMac=function(e,t){function n(){e.ownerDocument.defaultView!=window&&(e=function e(t){return t.parent==window?t.frameElement:t&&t.parent?e(t.parent):null}(e.ownerDocument.defaultView))}if(S=e,F=$(S).closest("[cid]"),e.closest&&!e.closest("body")&&e.closest(".CodeMirror-line")&&(e=document.activeElement.closest(".CodeMirror"),S=e),e){if(n(),document.querySelector("#write").contains(e)){var i=[],r=["normal"];try{var o=editor.getMarkElem(e);if(h.isType(document.activeElement.tagName,"INPUT","TEXTAREA")&&!o.length)return["input"];!o.length||t||o.hasClass("md-diagram")||File.editor.refocus(o.attr("cid"));var a=editor.selection.getRangy(),s=$(e).closest(".md-expand"),l=o.attr("mdtype"),c=null,d=(e.closest("img, svg")&&(c="download-image"),e.closest("video")&&(c="download-video"),o.attr("tabindex")&&(i=["insertParagraphBefore","insertParagraphAfter","delete"]),/^table/g.exec(l)&&!File.isLocked&&(i=["|","table","|","insertParagraphBefore","insertParagraphAfter"]),h.isType(l,p.html_block)&&(i=["|","edit","code-tools","|","insertParagraphBefore","insertParagraphAfter","delete"]),h.isType(l,p.math_block)&&(c=null,i=["|","edit","copyMathBlock","download-math","code-tools","|","insertParagraphBefore","insertParagraphAfter","delete"]),h.isType(l,p.fences)&&(i=o.hasClass("md-diagram")?(c=null,["|","edit","copy-as-image","download-diagram","code-tools","|","insertParagraphBefore","insertParagraphAfter","delete"]):["|","code-tools","|","insertParagraphBefore","insertParagraphAfter","delete-fences"]),$(e));r.push(c),o.hasClass("md-def-link")&&(u=$(a.commonAncestorContainer).closest(".md-def-url")).length&&(File.editor.setCurLinkElem(u),r=["openLink","copyLink","|","normal",c]),d.closest("a, .md-link").length&&(File.editor.setCurLinkElem(d.closest("a, .md-link").find("a").addBack("a")),r=["openLink","copyLink","|","normal",c]),d.closest(".md-emoji").length&&(r=["copyEmoji-"+d.closest(".md-emoji").find("[data-emoji]").attr("data-emoji"),"|"].concat(r)),a&&$(a.commonAncestorContainer).closest(".md-inline-math").length&&(r=["copyMathInline","|"].concat(r)),h.isType(s.hasClass("md-img-loaded")&&s.attr("md-inline"),p.refimg)&&/^file:\/\//.exec(s.find("img").attr("src")||"")&&(r=["revealInFinder","|"].concat(r)),h.isType(s.hasClass("md-img-loaded")&&s.attr("md-inline"),p.image,p.imgtag)&&(r=File.editor.imgEdit.contextMenuItems(s.find("img")[0]).concat("revealInFinder"==r[0]?[]:["|"]).concat(r))}catch(e){}return r.concat(i).filter(e=>null!=e)}if(File.editor.sourceView.inSourceMode&&document.querySelector("#typora-source").contains(e))return["input"];var u,t=File.editor.getJQueryElem(e),l=t.closest(".file-library-node, .ty-search-item, #file-library-search, #outline-content");if(l.hasClass("outline-content"))return o=File.editor.library.outline,u=!document.body.classList.contains("no-collapse-outline"),o.isShown_?["highlight","|","filter-on"]:u?["highlight","|","filter-off","|","expand-all","collapse-all","|","collapsible-outline-on","flat-outline-off"]:["highlight","|","filter-off","|","collapsible-outline-off","flat-outline-on"];if(l.hasClass("ty-search-item"))return["file-search"];if("file-library-search"==l.attr("id"))return["file-search-empty"];if(File.editor.library.useTreeStyle){if(l.length)return l.attr("data-path")==File.getMountFolder()?["folder-root"+(File.editor.library.isReadOnlyRoot()?"-readonly":"")]:[("true"==l.attr("data-is-directory")?"folder":"file")+(File.editor.library.isReadOnlyRoot()?"-readonly":"")];if(File.getMountFolder()&&t.closest("#file-library").length)return["folder-root"+(File.editor.library.isReadOnlyRoot()?"-readonly":"")]}else if(l.length)return["file-list"+(File.editor.library.isReadOnlyRoot()?"-readonly":"")]}return[]},C.prototype.downloadAsAction=function(){var e=F.find(".md-fences-adv-panel svg, .md-math-container svg, .md-mathjax-preview svg")[0];r.downloadAs(e||S.closest("svg, img, video"))},C.prototype.copyAsImageAction=function(){var e=F.find(".md-fences-adv-panel svg, .md-math-container svg, .md-mathjax-preview svg")[0];r.copyImage(e||S.closest("svg, img, video"))},C.prototype.insertParagraphBefore=function(){File.editor.UserOp.insertParagraph(!0,void 0,F.closest("[cid]"))},C.prototype.insertParagraphAfter=function(){File.editor.UserOp.insertParagraph(!1,void 0,F.closest("[cid]"))},C.prototype.editActive=function(){File.editActive(S)},C.prototype.deleteActive=function(){File.deleteActive(S)},C.prototype.restoreLastCursor=w,C.SPLITER="divider",t.exports=C}),!function(){function o(e,t,n){var i=o.resolve(e);if(null==i)throw n=n||e,t=t||"root",(e=new Error('Failed to require "'+n+'" from "'+t+'"')).path=n,e.parent=t,e.require=!0,e;n=o.modules[i];return n._resolving||n.exports||((t={exports:{}}).client=t.component=!0,n._resolving=!0,n.call(this,t.exports,o.relative(i),t),delete n._resolving,n.exports=t.exports),n.exports}o.modules={},o.aliases={},o.resolve=function(e){for(var t=[e="/"===e.charAt(0)?e.slice(1):e,e+".js",e+".json",e+"/index.js",e+"/index.json"],n=0;n<t.length;n++){e=t[n];if(o.modules.hasOwnProperty(e))return e;if(o.aliases.hasOwnProperty(e))return o.aliases[e]}},o.normalize=function(e,t){var n=[];if("."!=t.charAt(0))return t;e=e.split("/"),t=t.split("/");for(var i=0;i<t.length;++i)".."==t[i]?e.pop():"."!=t[i]&&""!=t[i]&&n.push(t[i]);return e.concat(n).join("/")},o.register=function(e,t){o.modules[e]=t},o.alias=function(e,t){if(!o.modules.hasOwnProperty(e))throw new Error('Failed to alias "'+e+'", it does not exist');o.aliases[t]=e},o.relative=function(i){var r=o.normalize(i,"..");function t(e){return o(t.resolve(e),i,e)}return t.resolve=function(e){var t,n=e.charAt(0);return"/"==n?e.slice(1):"."==n?o.normalize(r,e):(t=(t=function(e,t){for(var n=e.length;n--;)if(e[n]===t)return n;return-1}(n=i.split("/"),"deps")+1)||0,n.slice(0,t+1).join("/")+"/deps/"+e)},t.exists=function(e){return o.modules.hasOwnProperty(t.resolve(e))},t},o.register("component-classes/index.js",function(e,t,n){var i=t("indexof"),r=/\s+/,o=Object.prototype.toString;function a(e){if(!e)throw new Error("A DOM element reference is required");this.el=e,this.list=e.classList}n.exports=function(e){return new a(e)},a.prototype.add=function(e){var t;return this.list?this.list.add(e):(t=this.array(),~i(t,e)||t.push(e),this.el.className=t.join(" ")),this},a.prototype.remove=function(e){var t;return"[object RegExp]"==o.call(e)?this.removeMatching(e):(this.list?this.list.remove(e):(t=this.array(),~(e=i(t,e))&&t.splice(e,1),this.el.className=t.join(" ")),this)},a.prototype.removeMatching=function(e){for(var t=this.array(),n=0;n<t.length;n++)e.test(t[n])&&this.remove(t[n]);return this},a.prototype.toggle=function(e,t){return this.list?void 0!==t&&t===this.list.toggle(e,t)||this.list.toggle(e):void 0!==t?t?this.add(e):this.remove(e):this.has(e)?this.remove(e):this.add(e),this},a.prototype.array=function(){var e=this.el.className.replace(/^\s+|\s+$/g,"").split(r);return""===e[0]&&e.shift(),e},a.prototype.has=a.prototype.contains=function(e){return this.list?this.list.contains(e):!!~i(this.array(),e)}}),o.register("segmentio-extend/index.js",function(e,t,n){n.exports=function(e){for(var t,n=Array.prototype.slice.call(arguments,1),i=0;t=n[i];i++)if(t)for(var r in t)e[r]=t[r];return e}}),o.register("component-indexof/index.js",function(e,t,n){n.exports=function(e,t){if(e.indexOf)return e.indexOf(t);for(var n=0;n<e.length;++n)if(e[n]===t)return n;return-1}}),o.register("component-event/index.js",function(e,t,n){var r=window.addEventListener?"addEventListener":"attachEvent",o=window.removeEventListener?"removeEventListener":"detachEvent",a="addEventListener"!=r?"on":"";e.bind=function(e,t,n,i){return e[r](a+t,n,i||!1),n},e.unbind=function(e,t,n,i){return e[o](a+t,n,i||!1),n}}),o.register("timoxley-to-array/index.js",function(e,t,n){n.exports=function(e){if(void 0===e)return[];if(null===e)return[null];if(e===window)return[window];if("string"==typeof e)return[e];if("[object Array]"===Object.prototype.toString.call(e))return e;if("number"!=typeof e.length)return[e];if("function"==typeof e&&e instanceof Function)return[e];for(var t=[],n=0;n<e.length;n++)(Object.prototype.hasOwnProperty.call(e,n)||n in e)&&t.push(e[n]);return t.length?t:[]}}),o.register("javve-events/index.js",function(e,t,n){var o=t("event"),a=t("to-array");e.bind=function(e,t,n,i){e=a(e);for(var r=0;r<e.length;r++)o.bind(e[r],t,n,i)},e.unbind=function(e,t,n,i){e=a(e);for(var r=0;r<e.length;r++)o.unbind(e[r],t,n,i)}}),o.register("javve-get-by-class/index.js",function(e,t,n){n.exports=document.getElementsByClassName?function(e,t,n){return n?e.getElementsByClassName(t)[0]:e.getElementsByClassName(t)}:document.querySelector?function(e,t,n){return t="."+t,n?e.querySelector(t):e.querySelectorAll(t)}:function(e,t,n){for(var i=[],r=(e=null==e?document:e).getElementsByTagName("*"),o=r.length,a=new RegExp("(^|\\s)"+t+"(\\s|$)"),s=0,l=0;s<o;s++)if(a.test(r[s].className)){if(n)return r[s];i[l]=r[s],l++}return i}}),o.register("javve-get-attribute/index.js",function(e,t,n){n.exports=function(e,t){var n=e.getAttribute&&e.getAttribute(t)||null;if(!n)for(var i=e.attributes.length,r=0;r<i;r++)void 0!==t[r]&&t[r].nodeName===t&&(n=t[r].nodeValue);return n}}),o.register("javve-natural-sort/index.js",function(e,t,n){n.exports=function(e,t,n){function i(e){return n.insensitive&&(""+e).toLowerCase()||""+e}var r,o,a=/(^-?[0-9]+(\.?[0-9]*)[df]?e?[0-9]?$|^0x[0-9a-f]+$|[0-9]+)/gi,s=/(^[ ]*|[ ]*$)/g,l=/(^([\w ]+,?[\w ]+)?[\w ]+,?[\w ]+\d+:\d+(:\d+)?[\w ]?|^\d{1,4}[\/\-]\d{1,4}[\/\-]\d{1,4}|^\w+, \w+ \d+, \d{4})/,c=/^0x[0-9a-f]+$/i,d=/^0/,n=n||{},e=i(e).replace(s,"")||"",t=i(t).replace(s,"")||"",u=e.replace(a,"\0$1\0").replace(/\0$/,"").replace(/^\0/,"").split("\0"),h=t.replace(a,"\0$1\0").replace(/\0$/,"").replace(/^\0/,"").split("\0"),s=parseInt(e.match(c))||1!=u.length&&e.match(l)&&Date.parse(e),a=parseInt(t.match(c))||s&&t.match(l)&&Date.parse(t)||null,p=n.desc?-1:1;if(a){if(s<a)return-1*p;if(a<s)return p}for(var f=0,m=Math.max(u.length,h.length);f<m;f++){if(r=!(u[f]||"").match(d)&&parseFloat(u[f])||u[f]||0,o=!(h[f]||"").match(d)&&parseFloat(h[f])||h[f]||0,isNaN(r)!==isNaN(o))return isNaN(r)?1:-1;if(typeof r!=typeof o&&(r+="",o+=""),r<o)return-1*p;if(o<r)return p}return 0}}),o.register("javve-to-string/index.js",function(e,t,n){n.exports=function(e){return e=(e=null===(e=void 0===e?"":e)?"":e).toString()}}),o.register("component-type/index.js",function(e,t,n){var i=Object.prototype.toString;n.exports=function(e){switch(i.call(e)){case"[object Date]":return"date";case"[object RegExp]":return"regexp";case"[object Arguments]":return"arguments";case"[object Array]":return"array";case"[object Error]":return"error"}return null===e?"null":void 0===e?"undefined":e!=e?"nan":e&&1===e.nodeType?"element":typeof e.valueOf()}}),o.register("list.js/index.js",function(e,p,t){!function(){"use strict";function o(e,t,n){var s=this,l=p("./src/item")(s),c=p("./src/add-async")(s),i=p("./src/parse")(s),r={start:function(){s.listClass="list",s.searchClass="search",s.sortClass="sort",s.page=200,s.i=1,s.items=[],s.visibleItems=[],s.matchingItems=[],s.searched=!1,s.filtered=!1,s.handlers={updated:[]},s.plugins={},s.helpers={getByClass:d,extend:u,indexOf:h},u(s,t),s.listContainer="string"==typeof e?a.getElementById(e):e,s.listContainer&&(s.list=d(s.listContainer,s.listClass,!0),s.templater=p("./src/templater")(s),s.search=p("./src/search")(s),s.filter=p("./src/filter")(s),s.sort=p("./src/sort")(s),this.items(),s.update(),this.plugins())},items:function(){i(s.list),void 0!==n&&s.add(n)},plugins:function(){for(var e=0;e<s.plugins.length;e++){var t=s.plugins[e];(s[t.name]=t).init(s,o)}}};this.add=function(e,t){if(!t){for(var n,i=[],r=0,o=(e=void 0===e[0]?[e]:e).length;r<o;r++){var a=null;e[r]instanceof l?(a=e[r]).reload():(n=s.items.length>s.page,a=new l(e[r],void 0,n)),s.items.push(a),i.push(a)}return s.update(),i}c(e,t)},this.show=function(e,t){return this.i=e,this.page=t,s.update(),s},this.remove=function(e,t,n){for(var i=0,r=0,o=s.items.length;r<o;r++)s.items[r].values()[e]==t&&(s.templater.remove(s.items[r],n),s.items.splice(r,1),o--,r--,i++);return s.update(),i},this.get=function(e,t){for(var n=[],i=0,r=s.items.length;i<r;i++){var o=s.items[i];o.values()[e]==t&&n.push(o)}return n},this.size=function(){return s.items.length},this.clear=function(){return s.templater.clear(),s.items=[],s},this.on=function(e,t){return s.handlers[e].push(t),s},this.off=function(e,t){e=s.handlers[e],t=h(e,t);return-1<t&&e.splice(t,1),s},this.trigger=function(e){for(var t=s.handlers[e].length;t--;)s.handlers[e][t](s);return s},this.reset={filter:function(){for(var e=s.items,t=e.length;t--;)e[t].filtered=!1;return s},search:function(){for(var e=s.items,t=e.length;t--;)e[t].found=!1;return s}},this.update=function(){var e=s.items,t=e.length;s.visibleItems=[],s.matchingItems=[],s.templater.clear();for(var n=0;n<t;n++)e[n].matching()&&s.matchingItems.length+1>=s.i&&s.visibleItems.length<s.page?(e[n].show(),s.visibleItems.push(e[n]),s.matchingItems.push(e[n])):(e[n].matching()&&s.matchingItems.push(e[n]),e[n].hide());return s.trigger("updated"),s},r.start()}var a=window.document,d=p("get-by-class"),u=p("extend"),h=p("indexof");t.exports=o}()}),o.register("list.js/src/search.js",function(e,t,n){var c=t("events"),d=t("get-by-class"),u=t("to-string");n.exports=function(n){function t(e){return n.trigger("searchStart"),s.resetList(),s.setSearchString(e),s.setOptions(arguments),s.setColumns(),""===o?l.reset():(n.searched=!0,a?a(o,r):l.list()),n.update(),n.trigger("searchComplete"),n.visibleItems}var i,r,o,a,s={resetList:function(){n.i=1,n.templater.clear(),a=void 0},setOptions:function(e){2==e.length&&e[1]instanceof Array?r=e[1]:2==e.length&&"function"==typeof e[1]?a=e[1]:3==e.length&&(r=e[1],a=e[2])},setColumns:function(){r=void 0===r?s.toArray(n.items[0].values()):r},setSearchString:function(e){e=(e=u(e).toLowerCase()).replace(/[-[\]{}()*+?.,\\^$|#]/g,"\\$&"),o=e},toArray:function(e){var t,n=[];for(t in e)n.push(t);return n}},l={list:function(){for(var e=0,t=n.items.length;e<t;e++)l.item(n.items[e])},item:function(e){e.found=!1;for(var t=0,n=r.length;t<n;t++)if(l.values(e.values(),r[t]))return void(e.found=!0)},values:function(e,t){return!!(e.hasOwnProperty(t)&&(i=u(e[t]).toLowerCase(),""!==o)&&-1<i.search(o))},reset:function(){n.reset.search(),n.searched=!1}};return n.handlers.searchStart=n.handlers.searchStart||[],n.handlers.searchComplete=n.handlers.searchComplete||[],c.bind(d(n.listContainer,n.searchClass),"keyup",function(e){e=e.target||e.srcElement;""===e.value&&!n.searched||t(e.value)}),c.bind(d(n.listContainer,n.searchClass),"input",function(e){""===(e.target||e.srcElement).value&&t("")}),n.helpers.toString=u,t}}),o.register("list.js/src/sort.js",function(e,t,n){var i=t("natural-sort"),a=t("classes"),r=t("events"),s=t("get-by-class"),l=t("get-attribute");n.exports=function(t){t.sortFunction=t.sortFunction||function(e,t,n){return n.desc="desc"==n.order,i(e.values()[n.valueName],t.values()[n.valueName],n)};function e(){t.trigger("sortStart"),options={};var e=arguments[0].currentTarget||arguments[0].srcElement||void 0;e?(options.valueName=l(e,"data-sort"),o.getInSensitive(e,options),options.order=o.getOrder(e)):((options=arguments[1]||options).valueName=arguments[0],options.order=options.order||"asc",options.insensitive=void 0===options.insensitive||options.insensitive),o.clear(),o.setOrder(options),options.sortFunction=options.sortFunction||t.sortFunction,t.items.sort(function(e,t){return options.sortFunction(e,t,options)}),t.update(),t.trigger("sortComplete")}var o={els:void 0,clear:function(){for(var e=0,t=o.els.length;e<t;e++)a(o.els[e]).remove("asc"),a(o.els[e]).remove("desc")},getOrder:function(e){var t=l(e,"data-order");return"asc"==t||"desc"==t?t:!a(e).has("desc")&&a(e).has("asc")?"desc":"asc"},getInSensitive:function(e,t){e=l(e,"data-insensitive");t.insensitive="true"===e},setOrder:function(e){for(var t=0,n=o.els.length;t<n;t++){var i,r=o.els[t];l(r,"data-sort")===e.valueName&&("asc"!=(i=l(r,"data-order"))&&"desc"!=i||i==e.order)&&a(r).add(e.order)}}};return t.handlers.sortStart=t.handlers.sortStart||[],t.handlers.sortComplete=t.handlers.sortComplete||[],o.els=s(t.listContainer,t.sortClass),r.bind(o.els,"click",e),t.on("searchStart",o.clear),t.on("filterStart",o.clear),t.helpers.classes=a,t.helpers.naturalSort=i,t.helpers.events=r,t.helpers.getAttribute=l,e}}),o.register("list.js/src/item.js",function(e,t,n){n.exports=function(r){return function(e,t,n){var i=this;this._values={},this.found=!1,this.filtered=!1;this.values=function(e,t){if(void 0===e)return i._values;for(var n in e)i._values[n]=e[n];!0!==t&&r.templater.set(i,i.values())},this.show=function(){r.templater.show(i)},this.hide=function(){r.templater.hide(i)},this.matching=function(){return r.filtered&&r.searched&&i.found&&i.filtered||r.filtered&&!r.searched&&i.filtered||!r.filtered&&r.searched&&i.found||!r.filtered&&!r.searched},this.visible=function(){return i.elm.parentNode==r.list},e=e,n=n,void 0===(t=t)?n?i.values(e,n):i.values(e):(i.elm=t,n=r.templater.get(i,e),i.values(n))}}}),o.register("list.js/src/templater.js",function(e,t,n){function i(o){var n=function(e){{var t;if(void 0!==e)return-1!==e.indexOf("<")?((t=document.createElement("div")).innerHTML=e,t.firstChild):document.getElementById(o.item);for(var n=o.list.childNodes,i=0,r=n.length;i<r;i++)if(void 0===n[i].data)return n[i];return null}}(o.item),a=this;this.get=function(e,t){a.create(e);for(var n={},i=0,r=t.length;i<r;i++){var o=s(e.elm,t[i],!0);n[t[i]]=o?o.innerHTML:""}return n},this.set=function(e,t){if(!a.create(e))for(var n in t){var i;t.hasOwnProperty(n)&&(i=s(e.elm,n,!0))&&("IMG"===i.tagName&&""!==t[n]?i.src=t[n]:i.innerHTML=t[n])}},this.create=function(e){var t;return void 0===e.elm&&((t=n.cloneNode(!0)).removeAttribute("id"),e.elm=t,a.set(e,e.values()),!0)},this.remove=function(e){o.list.removeChild(e.elm)},this.show=function(e){a.create(e),o.list.appendChild(e.elm)},this.hide=function(e){void 0!==e.elm&&e.elm.parentNode===o.list&&o.list.removeChild(e.elm)},this.clear=function(){if(o.list.hasChildNodes())for(;1<=o.list.childNodes.length;)o.list.removeChild(o.list.firstChild)}}var s=t("get-by-class");n.exports=function(e){return new i(e)}}),o.register("list.js/src/filter.js",function(e,t,n){n.exports=function(o){return o.handlers.filterStart=o.handlers.filterStart||[],o.handlers.filterComplete=o.handlers.filterComplete||[],function(e){if(o.trigger("filterStart"),o.i=1,o.reset.filter(),void 0===e)o.filtered=!1;else{o.filtered=!0;for(var t=o.items,n=0,i=t.length;n<i;n++){var r=t[n];e(r)?r.filtered=!0:r.filtered=!1}}return o.update(),o.trigger("filterComplete"),o.visibleItems}}}),o.register("list.js/src/add-async.js",function(e,t,n){n.exports=function(r){return function(e,t,n){var i=e.splice(0,100);n=(n=n||[]).concat(r.add(i)),0<e.length?setTimeout(function(){addAsync(e,t,n)},10):(r.update(),t(n))}}}),o.register("list.js/src/parse.js",function(e,t,n){n.exports=function(o){function a(e,t){for(var n=0,i=e.length;n<i;n++)o.items.push(new r(t,e[n]))}var r=t("./item")(o);return function(){var e,t,n,i=function(e){for(var t=e.childNodes,n=[],i=0,r=t.length;i<r;i++)void 0===t[i].data&&n.push(t[i]);return n}(o.list),r=o.valueNames;o.indexAsync?(t=r,n=(e=i).splice(0,100),a(n,t),0<e.length?setTimeout(function(){init.items.indexAsync(e,t)},10):o.update()):a(i,r)}}}),o.alias("component-classes/index.js","list.js/deps/classes/index.js"),o.alias("component-classes/index.js","classes/index.js"),o.alias("component-indexof/index.js","component-classes/deps/indexof/index.js"),o.alias("segmentio-extend/index.js","list.js/deps/extend/index.js"),o.alias("segmentio-extend/index.js","extend/index.js"),o.alias("component-indexof/index.js","list.js/deps/indexof/index.js"),o.alias("component-indexof/index.js","indexof/index.js"),o.alias("javve-events/index.js","list.js/deps/events/index.js"),o.alias("javve-events/index.js","events/index.js"),o.alias("component-event/index.js","javve-events/deps/event/index.js"),o.alias("timoxley-to-array/index.js","javve-events/deps/to-array/index.js"),o.alias("javve-get-by-class/index.js","list.js/deps/get-by-class/index.js"),o.alias("javve-get-by-class/index.js","get-by-class/index.js"),o.alias("javve-get-attribute/index.js","list.js/deps/get-attribute/index.js"),o.alias("javve-get-attribute/index.js","get-attribute/index.js"),o.alias("javve-natural-sort/index.js","list.js/deps/natural-sort/index.js"),o.alias("javve-natural-sort/index.js","natural-sort/index.js"),o.alias("javve-to-string/index.js","list.js/deps/to-string/index.js"),o.alias("javve-to-string/index.js","list.js/deps/to-string/index.js"),o.alias("javve-to-string/index.js","to-string/index.js"),o.alias("javve-to-string/index.js","javve-to-string/index.js"),o.alias("component-type/index.js","list.js/deps/type/index.js"),o.alias("component-type/index.js","type/index.js"),"object"==typeof exports?module.exports=o("list.js"):$__System.registerDynamic("4d",[],!1,function(e,t,n){return function(){return o("list.js")}.call(this)})}(),!function(){function o(e,t,n){var i=o.resolve(e);if(null==i)throw n=n||e,t=t||"root",(e=new Error('Failed to require "'+n+'" from "'+t+'"')).path=n,e.parent=t,e.require=!0,e;n=o.modules[i];return n._resolving||n.exports||((t={exports:{}}).client=t.component=!0,n._resolving=!0,n.call(this,t.exports,o.relative(i),t),delete n._resolving,n.exports=t.exports),n.exports}o.modules={},o.aliases={},o.resolve=function(e){for(var t=[e="/"===e.charAt(0)?e.slice(1):e,e+".js",e+".json",e+"/index.js",e+"/index.json"],n=0;n<t.length;n++){e=t[n];if(o.modules.hasOwnProperty(e))return e;if(o.aliases.hasOwnProperty(e))return o.aliases[e]}},o.normalize=function(e,t){var n=[];if("."!=t.charAt(0))return t;e=e.split("/"),t=t.split("/");for(var i=0;i<t.length;++i)".."==t[i]?e.pop():"."!=t[i]&&""!=t[i]&&n.push(t[i]);return e.concat(n).join("/")},o.register=function(e,t){o.modules[e]=t},o.alias=function(e,t){if(!o.modules.hasOwnProperty(e))throw new Error('Failed to alias "'+e+'", it does not exist');o.aliases[t]=e},o.relative=function(i){function t(e){return o(t.resolve(e),i,e)}var r=o.normalize(i,"..");return t.resolve=function(e){var t,n=e.charAt(0);return"/"==n?e.slice(1):"."==n?o.normalize(r,e):(t=(t=function(e,t){for(var n=e.length;n--;)if(e[n]===t)return n;return-1}(n=i.split("/"),"deps")+1)||0,n.slice(0,t+1).join("/")+"/deps/"+e)},t.exists=function(e){return o.modules.hasOwnProperty(t.resolve(e))},t},o.register("component-indexof/index.js",function(e,t,n){n.exports=function(e,t){if(e.indexOf)return e.indexOf(t);for(var n=0;n<e.length;++n)if(e[n]===t)return n;return-1}}),o.register("component-classes/index.js",function(e,t,n){function i(e){if(!e)throw new Error("A DOM element reference is required");this.el=e,this.list=e.classList}var r=t("indexof"),o=/\s+/,a=Object.prototype.toString;n.exports=function(e){return new i(e)},i.prototype.add=function(e){var t;return this.list?this.list.add(e):(t=this.array(),~r(t,e)||t.push(e),this.el.className=t.join(" ")),this},i.prototype.remove=function(e){var t;return"[object RegExp]"==a.call(e)?this.removeMatching(e):(this.list?this.list.remove(e):(t=this.array(),~(e=r(t,e))&&t.splice(e,1),this.el.className=t.join(" ")),this)},i.prototype.removeMatching=function(e){for(var t=this.array(),n=0;n<t.length;n++)e.test(t[n])&&this.remove(t[n]);return this},i.prototype.toggle=function(e){return this.list?this.list.toggle(e):this.has(e)?this.remove(e):this.add(e),this},i.prototype.array=function(){var e=this.el.className.replace(/^\s+|\s+$/g,"").split(o);return""===e[0]&&e.shift(),e},i.prototype.has=i.prototype.contains=function(e){return this.list?this.list.contains(e):!!~r(this.array(),e)}}),o.register("segmentio-extend/index.js",function(e,t,n){n.exports=function(e){for(var t,n=Array.prototype.slice.call(arguments,1),i=0;t=n[i];i++)if(t)for(var r in t)e[r]=t[r];return e}}),o.register("component-event/index.js",function(e){var r=void 0!==window.addEventListener?"addEventListener":"attachEvent",o=void 0!==window.removeEventListener?"removeEventListener":"detachEvent",a="addEventListener"!=r?"on":"";e.bind=function(e,t,n,i){return e[r](a+t,n,i||!1),n},e.unbind=function(e,t,n,i){return e[o](a+t,n,i||!1),n}}),o.register("component-type/index.js",function(e,t,n){var i=Object.prototype.toString;n.exports=function(e){switch(i.call(e)){case"[object Function]":return"function";case"[object Date]":return"date";case"[object RegExp]":return"regexp";case"[object Arguments]":return"arguments";case"[object Array]":return"array";case"[object String]":return"string"}return null===e?"null":void 0===e?"undefined":e&&1===e.nodeType?"element":e===Object(e)?"object":typeof e}}),o.register("timoxley-is-collection/index.js",function(e,t,n){var i=t("type");n.exports=function(e){var t,n=i(e);if("array"===n)return 1;switch(n){case"arguments":return 2;case"object":if("object"==typeof(t=e)&&/^\[object (NodeList)\]$/.test(Object.prototype.toString.call(t))&&t.hasOwnProperty("length")&&(0==t.length||"object"==typeof t[0]&&0<t[0].nodeType))return 2;try{if("length"in e&&!e.tagName&&(!e.scrollTo||!e.document)&&!e.apply)return 2}catch(e){}default:return 0}}}),o.register("javve-events/index.js",function(e,t){var o=t("event"),a=t("is-collection");e.bind=function(e,t,n,i){if(a(e)){if(e&&void 0!==e[0])for(var r=0;r<e.length;r++)o.bind(e[r],t,n,i)}else o.bind(e,t,n,i)},e.unbind=function(e,t,n,i){if(a(e)){if(e&&void 0!==e[0])for(var r=0;r<e.length;r++)o.unbind(e[r],t,n,i)}else o.unbind(e,t,n,i)}}),o.register("javve-get-by-class/index.js",function(e,t,n){n.exports=document.getElementsByClassName?function(e,t,n){return n?e.getElementsByClassName(t)[0]:e.getElementsByClassName(t)}:document.querySelector?function(e,t,n){return n?e.querySelector(t):e.querySelectorAll(t)}:function(e,t,n){for(var i=[],r=(e=null==e?document:e).getElementsByTagName("*"),o=r.length,a=new RegExp("(^|\\s)"+t+"(\\s|$)"),s=0,l=0;s<o;s++)if(a.test(r[s].className)){if(n)return r[s];i[l]=r[s],l++}return i}}),o.register("javve-to-string/index.js",function(e,t,n){n.exports=function(e){return(e=null===(e=void 0===e?"":e)?"":e).toString()}}),o.register("list.fuzzysearch.js/index.js",function(e,t,n){t("classes");var r=t("events"),s=t("extend"),c=t("to-string"),d=t("get-by-class");n.exports=function(o){s(o=o||{},{location:0,distance:100,threshold:.4,multiSearch:!0,searchClass:"fuzzy-search"});var a,i=t("./src/fuzzy"),l={search:function(e,t){for(var n=o.multiSearch?e.replace(/ +$/,"").split(/ +/):[e],i=0,r=a.items.length;i<r;i++)l.item(a.items[i],t,n)},item:function(e,t,n){for(var i=!0,r=0;r<n.length;r++){for(var o=!1,a=0,s=t.length;a<s;a++)l.values(e.values(),t[a],n[r])&&(o=!0);o||(i=!1)}e.found=i},values:function(e,t,n){if(e.hasOwnProperty(t)){e=c(e[t]).toLowerCase();if(i(e,n,o))return!0}return!1}};return{init:function(e){a=e,r.bind(d(a.listContainer,o.searchClass),"keyup",function(e){e=e.target||e.srcElement;a.search(e.value,l.search)})},search:function(e,t){a.search(e,t,l.search)},name:o.name||"fuzzySearch"}}}),o.register("list.fuzzysearch.js/src/fuzzy.js",function(e,t,n){n.exports=function(e,n,t){function i(e,t){e/=n.length,t=Math.abs(c-t);return o?e+t/o:t?1:e}var r=t.location||0,o=t.distance||100,t=t.threshold||.4;if(n===e)return!0;if(32<n.length)return!1;for(var a,s,l,c=r,d=function(){for(var e={},t=0;t<n.length;t++)e[n.charAt(t)]=0;for(t=0;t<n.length;t++)e[n.charAt(t)]|=1<<n.length-t-1;return e}(),u=t,h=(-1!=(p=e.indexOf(n,c))&&(u=Math.min(i(0,p),u),-1!=(p=e.lastIndexOf(n,c+n.length)))&&(u=Math.min(i(0,p),u)),1<<n.length-1),p=-1,f=n.length+e.length,m=0;m<n.length;m++){for(a=0,s=f;a<s;)i(m,c+s)<=u?a=s:f=s,s=Math.floor((f-a)/2+a);var f=s,g=Math.max(1,c-s+1),y=Math.min(c+s,e.length)+n.length,v=Array(y+2);v[y+1]=(1<<m)-1;for(var b=y;g<=b;b--){var w=d[e.charAt(b-1)];if(v[b]=0===m?(v[b+1]<<1|1)&w:(v[b+1]<<1|1)&w|(l[b+1]|l[b])<<1|1|l[b+1],v[b]&h){w=i(m,b-1);if(w<=u){if(u=w,!(c<(p=b-1)))break;g=Math.max(1,2*c-p)}}}if(i(m+1,c)>u)break;l=v}return!(p<0)}}),o.alias("component-classes/index.js","list.fuzzysearch.js/deps/classes/index.js"),o.alias("component-classes/index.js","classes/index.js"),o.alias("component-indexof/index.js","component-classes/deps/indexof/index.js"),o.alias("segmentio-extend/index.js","list.fuzzysearch.js/deps/extend/index.js"),o.alias("segmentio-extend/index.js","extend/index.js"),o.alias("javve-events/index.js","list.fuzzysearch.js/deps/events/index.js"),o.alias("javve-events/index.js","events/index.js"),o.alias("component-event/index.js","javve-events/deps/event/index.js"),o.alias("timoxley-is-collection/index.js","javve-events/deps/is-collection/index.js"),o.alias("component-type/index.js","timoxley-is-collection/deps/type/index.js"),o.alias("javve-get-by-class/index.js","list.fuzzysearch.js/deps/get-by-class/index.js"),o.alias("javve-get-by-class/index.js","get-by-class/index.js"),o.alias("javve-to-string/index.js","list.fuzzysearch.js/deps/to-string/index.js"),o.alias("javve-to-string/index.js","list.fuzzysearch.js/deps/to-string/index.js"),o.alias("javve-to-string/index.js","to-string/index.js"),o.alias("javve-to-string/index.js","javve-to-string/index.js"),o.alias("list.fuzzysearch.js/index.js","list.fuzzysearch.js/index.js"),"object"==typeof exports?module.exports=o("list.fuzzysearch.js"):$__System.registerDynamic("4e",[],!1,function(e,t,n){return function(){return o("list.fuzzysearch.js")}.call(this)})}(),$__System.registerDynamic("4f",["e","11","1b","2b","28","32","50","51","34"],!0,function(e,t,n){this||self;var l=e("e"),r=e("11"),i=e("1b"),o=(e("2b"),e("28")),a=e("32"),s=e("50"),c=e("51"),d=e("34"),u=c.Reporter;const h=function(t,n){let i=null;return(...e)=>{null===i&&(t(...e),i=setTimeout(()=>{i=null},n))}}(function(e){e<0?JSBridge.zoom.zoomIn():JSBridge.zoom.zoomOut()},500);var p={DEFAULT_OPTIONS:{keys:{},indentByTab:!1,indentSize:2,codeIndentSize:4,enableInlineMath:!0,autoNumberingForMath:!1,enableHighlight:!1,enableSubscript:!1,enableSuperscript:!1,enableDiagram:!1,enableAlert:!0,copyMarkdownByDefault:!1,showLineNumbersForFence:!1,useRelativePathForImg:!1,autoCorrectMisspell:!1,noPairingMatch:!1,autoPairExtendSymbol:!1,enableAutoSave:!1,scrollWithCursor:!1,expandSimpleBlock:!1,allowImageMove:!0,allowImageUpload:!0,headingStyle:0,ulStyle:0,olStyle:0,strictMarkdown:!1,preferCRLF:!1,sortType:0,sidebarTab:"",useTreeStyle:!1,noLineWrapping:!1,prettyIndent:!1,defaultImageStorage:null,applyImageMoveForWeb:!1,applyImageMoveForLocal:!0,ignoreLineBreak:!1,preLinebreakOnExport:!1,hideBrAndLineBreak:!1,indentFirstLine:!1,monocolorEmoji:!1,useFsQueue:!0,isLocked:!1,convertSmartOnRender:!1,remapUnicodePunctuation:!1,smartDash:!1,smartQuote:!1,userQuotesArray:null,autoResizeIframe:!0,blockHTML:!0,sendAnonymousUsage:!0,presetSpellCheck:"auto",sidebarWidth:null,caseSensitive:!1,wholeWord:!1,fileSearchCaseSensitive:!1,fileSearchWholeWord:!1,wordCountDelimiter:0,listNoGroup:!1,treeNoGroup:!1,wordsPerMinute:382,autoEscapeImageURL:!1,mathFormatOnCopy:"svg",gitlabMath:!1,spellcheckForCodeAndLink:!1,preferFinalNewline:!1,htmlMath:!1,strictNumberStartOnNewLine:!1,noDisplayLinesInMath:!1,lineWiseCopyCut:!1,noAutoLink:!1,defaultExtension:"md",defaultCodeLang:"",defaultCodeLangOption:1,DefaultCodeLangOptionCode:1,DefaultCodeLangOptionMenu:2},readOption:function(){window._options&&(File.option=l.extend(File.option,window._options)),window._documentState&&File.setDocumentState(_documentState);var e=(window._options||{}).autoNumberingForMath;File.option.autoNumberingForMath=!!e&&"all","ams"==e&&(File.option.autoNumberingForMath="ams"),"0"!=e&&"none"!=e&&"null"!=e&&"false"!=e&&"nil"!=e||(File.option.autoNumberingForMath=!1),File.option.headingStyle=File.option.headingStyle||0,File.option.ulStyle=File.option.ulStyle||0,File.option.olStyle=File.option.olStyle||0,File.option.wordCountDelimiter=File.option.wordCountDelimiter||0,File.option.sortType=File.option.sortType||0,File.option.indentSize=+File.option.indentSize||2,File.option.codeIndentSize=+File.option.codeIndentSize||4,File.option.curTheme=File.option.curTheme||File.option.theme,isNaN(File.option.indentSize)&&(File.option.indentSize=2),isNaN(File.option.codeIndentSize)&&(File.option.codeIndentSize=4),(window._options||{}).mountFolder&&File.setMountFolder(_options.mountFolder),File.setIndentSize(File.option.indentSize),window.innerWidth<540&&(File.option.sidebarTab=null),File.option.useCustomFontSize&&(document.body.parentElement.style.fontSize=File.option.customFontSize+"px"),File.setCanCollapsePinnedOutline(File.option.canCollapseOutlinePanel),3==File.option.headingStyle&&document.body.classList.add("use-varible-width-setex"),File.option.noLineWrapping&&l("#write").addClass("fences-no-line-wrapping"),File.isMac&&((_options.osVersion||"").indexOf(!0)&&document.body.classList.add("mac-os-11"),document.body.classList.add("mac-os"),bridge.callHandler("window.refreshFullContentState")),File.isNode&&(File.option.arch=process.arch),File.setIndentFirstLine(File.option.indentFirstLine,!0),File.setHideBrAndLineBreak(File.option.hideBrAndLineBreak||!1,!0),File.isFocusMode=File.option.isFocusMode,File.isTypeWriterMode=File.option.isTypeWriterMode,File.setIgnoreLineBreak(File.option.ignoreLineBreak||!1,!0),File.option.monocolorEmoji&&document.body.classList.add("monocolor-emoji"),File.option.indentEmptyP&&document.body.classList.add("indent-empty-p"),p.setConvertSmartOnRender(File.option.convertSmartOnRender),File.option.framelessWindow&&setTimeout(function(){l.localize.getString&&o.showHintOrWarning({key:"noHintForUnibody",title:l.localize.getString("<strong>Unibody</strong> style has been turned on.","Front"),body:l.localize.getString("You can right click titlebar to popup application menu.","Front"),checked:!0})},1e3),File.option.supportTextBundle&&File.SupportedFiles.push("textbundle"),File.option.supportTextPack&&File.SupportedFiles.push("textpack"),-1==File.SupportedFiles.indexOf(File.option.defaultExtension||"md")&&File.SupportedFiles.push(File.option.defaultExtension)},setDefaultExtension(e){File.option.defaultExtension=e||"md",e&&(-1==File.SupportedFiles.indexOf(e)&&File.SupportedFiles.push(e),File.isNode&&File.editor.quickOpenPanel.worker.postMessage(["setDefaultExtension",e]),File.editor.quickOpenPanel.cacheFolder(File.getMountFolder()),File.editor.library.refreshPanelCommand())},setConvertSmartOnRender:function(e){File.option.convertSmartOnRender=e},setup:function(){window.Reporter.install(),window.Analytics.install(),File.isMac&&(p.setupSafari(),p.setupBridge(),p.setupMouseZoom())},setupBridge:function(){bridge.registerHandler("File.getSuggestedFileName",function(e,t){t(File.getSuggestedFileName())}),bridge.registerHandler("File.reloadContent",function(e,t){File.reloadContent.apply(File,e),t(null)}),bridge.registerHandler("File.setFilePath",function(e,t){var n=e[2],i=File.editor.imgEdit&&File.editor.imgEdit.getTargetImageStorageFolder();File.bundle.filePath!=e[0]&&u.record("File.setFilePath, File.bundle.filePath = "+r.hashCode(e[0])),File.bundle.filePath=e[0],File.bundle.currentFolderPath=e[1],d.onFilePathUpdated(void 0,n,i),t&&t(null)}),bridge.registerHandler("File.loadFile",async function(e,t){File.loadFile(null,!0,e),t&&t(null)}),bridge.registerHandler("File.generateSnapForBackup",function(e,t){try{t(File._needsUpdateSnap?File.generateSnap():null)}catch(e){console.sendError(e,"warning"),t("ERROR")}File._needsUpdateSnap=!1}),bridge.registerHandler("File.getContent",function(e,t){!1===File.validateContentForSave()&&(u.record("handler File.getContent"),File.showDataLostError()),t(File.sync(!0,!1,!0,e))})},setupMouseZoom:function(){window.addEventListener("wheel",function(e){e.metaKey&&File.option.zoomByMouse&&(3<e.deltaY?h(1):e.deltaY<-3&&h(-1))},!!File.option.passiveEvents&&{passive:!0})},setupSafari:function(){try{var e=Object.defineProperty({},"passive",{get:function(){File.option.passiveEvents=!0}});window.addEventListener("test",null,e)}catch(e){}},shouldRemapPunctuation:function(){return File.option.remapUnicodePunctuation||!File.option.convertSmartOnRender&&(File.option.smartQuote||File.option.smartDash)},setFinalNewline:function(e){var t;!File.finalNewline!=!e&&(File.finalNewline=e,(t=i.makeEmptyCommand()).undo.push({type:"option",option:"finalNewline",value:!e}),t.redo.push({type:"option",option:"finalNewline",value:e}),File.editor.undo.register(t))},setIndentFirstLine:function(e,t,n){File.option.indentFirstLine=e,File.option.indentFirstLine?File.editor.writingArea.classList.add("first-line-indent"):File.editor.writingArea.classList.remove("first-line-indent"),t&&(JSBridge.menu.update("Edit→Whitespace and Line Breaks→Indent first line of paragraphs",{state:File.option.indentFirstLine}),s.forceRefreshMenu()),n&&JSBridge.putSetting("indentFirstLine",e)},setHideBrAndLineBreak:function(e,t,n){File.option.hideBrAndLineBreak=e,File.option.hideBrAndLineBreak?document.body.classList.add("hide-br-and-line-break"):document.body.classList.remove("hide-br-and-line-break"),t&&(JSBridge.menu.update("Edit→Whitespace and Line Breaks→Visible <br/>",{state:!File.option.hideBrAndLineBreak}),s.forceRefreshMenu()),n&&JSBridge.putSetting("hideBrAndLineBreak",e)},setIgnoreLineBreak:function(e,t,n){(e=1==e||"true"==e)?document.body.classList.add("ignore-line-break"):document.body.classList.remove("ignore-line-break"),File.option.ignoreLineBreak!=e&&(e?l(".md-softbreak").html("<span contenteditable='false'></span>\n"):(l(".md-softbreak-emptyline").replaceWith("&#10;<span md-inline='emptyline' class='md-emptyline'>&#10;</span>"),l(".md-softbreak [contenteditable]").remove())),File.option.ignoreLineBreak=e,n&&JSBridge.putSetting("ignoreLineBreak",e),t&&(JSBridge.menu.update("Edit→Whitespace and Line Breaks→Preserve single line break",{state:!e}),s.forceRefreshMenu())},setIndentSize:function(e){File.option.indentSize=+(e||2),File.option.indentSize<0?(File.option.indentSize=2,File.option.indentByTab=!0):File.option.indentByTab=!1},setLineEnding:function(e,t,n){(e!=File.useCRLF||n)&&(File.useCRLF=e,n={"Edit→Line Endings→Windows Line Endings (CRLF)":{state:File.useCRLF,enabled:!File.isLocked},"Edit→Line Endings→Unix Line Endings (LF)":{state:!File.useCRLF,enabled:!File.isLocked}},JSBridge.menu.update(n),t)&&(File.sync(),e=((e=File.editor.getMarkdown()).split(/\r?\n/g)||[e]).join(File.useCRLF?"\r\n":"\n"),File.reloadContent(e),File.needSaveState=!0,File.backupWindow())},setTheme:function(e){function t(){var e,t,n=(window.getComputedStyle(document.body).backgroundColor.match(/[\d.]+/gi)||[]).map(function(e){return+e});function i(e){e=Number(e).toString(16).toUpperCase();return 1==e.length?"0"+e:e}void 0!==n[3]&&null!==n[3]||(n[3]=1),n.length&&(File.colorBrightness=(299*n[0]+587*n[1]+114*n[2])/256e3,File.isMac?(n[0]+n[1]+n[2]+n[3]==0&&(n=[255,255,255,0]),bridge.callHandler("window.setBackground",n),bridge.callHandler("window.setIsSchemeAwareness",s())):(JSBridge.invoke("theme.setThemeSource",File.colorBrightness<.5?"dark":"system"),JSBridge.putSetting("backgroundColor",(t=n[0],e=n[1],n=n[2],"#"+i(t)+i(e)+i(n))),JSBridge.putSetting("isDarkMode",File.colorBrightness<.5))),File.isMac&&(t=null,"true"!=(window.getComputedStyle(document.body).getPropertyValue("--typora-center-window-title")||"").trim()&&document.body.classList.contains("pin-outline")&&(t=document.querySelector("#typora-sidebar").getBoundingClientRect().width),bridge.callHandler("window.setTitlebarTextMarginLeft",t))}File.colorBrightness=1;function n(){l("#bg_css").remove(),setTimeout(()=>{t(),File._onInitTheme||File.editor.refresh(!0),File._onInitTheme=!1,File.isNode&&File.megaMenu&&File.megaMenu.applyTheme()},100),File.isFocusMode&&File.editor.updateFocusMode(File.isFocusMode),File.isTypeWriterMode&&File.editor.setTypeWriterMode(!0,!0)}var i,r,o,a,s=function(){var e,t=document.getElementById("theme_css");for(e of document.styleSheets)if(e.href===t.href&&t.href)for(var n of e.rules)if(4===n.type&&/prefers\-color\-scheme/.exec(n.cssText||""))return!0;return!1};File.isMac?(a=(i=document.getElementById("theme_css")).getAttribute("href"),r="file://"+_options.currentThemeFolder,e=(e=e||File.option.curTheme||"github").replace(/\s*([A-Z])/g,"-$1").replace(/^-/,"").toLowerCase(),File.option.curTheme=e,File.option.useCustomFontSize?(o=(File.option.customFontSize||16)+"",document.body.parentElement.style.fontSize=o+"px"):document.body.parentElement.style.fontSize="",(a=(/([^\\\/]+)\.css$/.exec(a)||[])[1])!=e&&i.setAttribute("href",r+"/"+e+".css"),setTimeout(n,20),document.querySelector("#base_user_css").setAttribute("href",r+"/base.user.css"),document.querySelector("#theme_user_css").setAttribute("href",r+"/"+e+".user.css")):File.isNode&&(File.option.curTheme=e||File.option.curTheme||"github.css",e=File.option.curTheme.replace(/\.css$/,""),o="typora://app/userData",a=File.isWin?"\\":"/",l("#theme_css").attr("href",[o,"themes",e+".css"].join(a)),setTimeout(n,20),document.querySelector("#base_user_css").setAttribute("href",[o,"themes","base.user.css"].join(a)),document.querySelector("#theme_user_css").setAttribute("href",[o,"themes",e+".user.css"].join(a)),File.isMacNode)&&JSBridge.invoke("menu.refreshThemeMenu"),document.body.style.backgroundColor="",document.body.style.setProperty("--bg-color","")},setCanCollapsePinnedOutline:function(e){e?document.body.classList.remove("no-collapse-outline"):document.body.classList.add("no-collapse-outline"),File.option.canCollapseOutlinePanel=e,this.editor&&this.editor.nodeMap&&this.editor.nodeMap.toc&&this.editor.nodeMap.toc.updateHTML(!0)},decideLineEnding:function(e){var t=-1<e.indexOf("\r\n")||!(-1<e.indexOf("\n"))&&null,t=(null!==t?File.setLineEnding(t):(t=File.editor.localSettingBridge?File.editor.localSettingBridge.preferCRLF():File.option.preferCRLF,File.setLineEnding(t)),e.length),n=File.editor.localSettingBridge?File.editor.localSettingBridge.preferFinalNewline():File.option.preferFinalNewline;!t||(File.finalNewline="\n"==e.substr(t-1),1<e.length&&"\n"==e.substr(t-2))?File.finalNewline=n:1<e.length&&"\r"==e.substr(t-2)&&(2<e.length&&e.substr(t-3)?File.finalNewline="\n"==e.substr(t-3):File.finalNewline=n)},setDefaultImageStorage:function(e){File.option.defaultImageStorage=e,File.editor.imgEdit&&(File.editor.imgEdit.cachedFileImageStorage=null)},exitOversize:function(){var e=document.querySelector("#ty-oversize-body");e&&!e.style.display&&(e.style.display="none",console.sendLog("[exitOversize]")),File.bundle.unsupported=!1},doEnterOversize:function(e){console.sendLog("[doEnterOversize] "+(e?"fromBroadcast":"fromSelf")),document.querySelector("#ty-oversize-body").style.display="",File.bundle.unsupported=File.UNSUPPORTED_REASON.OVERSIZE,File.isNode&&!e&&JSBridge.invoke("document.addSnap",null)},tryEnterOversize:function(e,t,n){return(!File.isMac||File.bundle.filePath)&&(a.bindOversizePlaceholder(),t||e.length>File.MAX_FILE_SIZE)?(File.doEnterOversize(n),""):(File.exitOversize(),e)},recoverPosOrScroll:function(e){File.bundle.filePath;var t=File.editor.library.cursorBackups[File.bundle.filePath||""];e&&(e.cursorPos&&"null"!==e.cursorPos||e.scrollOffset)&&(!t||t.date<e.timeStamp)?(!e.cursorPos||"null"===e.cursorPos||"INPUT"===document.activeElement.tagName&&document.activeElement.closest("#sidebar-content")||(File.editor.undo.exeCommand(JSON.parse(e.cursorPos)),File.editor.selection.scrollAdjust()),null!=e.scrollOffset&&(e.scrollOffset,l("content").scrollTop(e.scrollOffset))):t?(t.type?(File.editor.undo.exeCommand(t),File.editor.selection.scrollAdjust()):window.getSelection().removeAllRanges(),null!=t.scrollOffset&&l("content").scrollTop(t.scrollOffset)):window._hasSwitchCallback||isInputComponent(document.activeElement)||(window.getSelection().removeAllRanges(),File.editor.writingArea.focus(),l("content").scrollTop(0))},getFileName:function(e){var t,n,i;return File.isMac?(t=File.bundle.filePath,n=File.bundle.currentFolderPath,i=void 0,(i=t&&n?t.replace(n,"").replace(/^\//g,""):i)||(e?File.getSuggestedFileName():void 0)):File.bundle.fileName||(File.bundle.filePath?(File.bundle.fileName=a.getFileNameFromPath(File.bundle.filePath),File.bundle.fileName):e?File.getSuggestedFileName():void 0)},getSuggestedFileName:function(e){if(File.bundle.fileName)return File.bundle.fileName.replace(/\.[^.]+$/,"");if(e){e=File.getFileName();if(e)return e.replace(/\.[^.]+$/,"")}var t,n,e="",i="";try{(n=File.editor.docMenu.getMetaNode())&&(i=File.editor.docMenu.getValueInMeta("date",n)||"",i=(/\d+-\d+-\d+/g.exec(i)||/\d+\/\d+\/\d+/g.exec(i)||[""])[0],e=(e=File.editor.docMenu.getValueInMeta("title",n)||"").replace(/(^\s*("|'))|(("|')\s*)/gi,"").replace(/\s+(.)/gi,"-$1").toLocaleString(),e=i&&e?[i,e].join("-"):e),0!=e.trim().length&&"-"!=e||(t=l(l("[mdlike='h1'], [mdlike='h2'], [mdlike='h3'], #write h1, #write h2, #write h3")[0]),File.editor.sourceView.inSourceMode?60<(e=(e=File.editor.getMarkdown()).substring(0,e.indexOf("\n"))||e).length&&(e=e.substring(0,e.indexOf("."))||e):t.length?e=File.editor.UserOp.getDisplayText(t).replace(/\r?\n/gi,""):60<(e=(e=(t=l(l("[cid]:not(.md-meta-block)")[0])).length?File.editor.UserOp.getDisplayText(t):"").substring(0,e.indexOf("\n"))||e).length&&(e=e.substring(0,e.indexOf("."))||e)),120<e.length&&(e=e.substring(0,120))}catch(e){}return 0==e.trim().length&&(e=l.localize.getString("Untitled","Front")),r.removeInvalidPathCh(e.trim())||"Untitled"}};n.exports=p}),$__System.registerDynamic("48",["e","11","1b","13","2b","28","2f","29","52"],!0,function(e,t,n){this||self;var i=e("e"),r=e("11"),o=(e("1b"),e("13")),a=o.Node,s=o.TYPE,l=(e("2b"),e("28")),u=(e("2f"),e("29")),c=e("52"),h={copy:function(){File.editor.UserOp.copyHandler(File.editor)},delete:function(e){e=e||document.activeElement,isInputComponent(e)?(e=document.activeElement.closest(".CodeMirror"))&&(e=e.CodeMirror).replaceSelection("","start"):File.editor.UserOp.backspaceHandler(File.editor,null,"Backspace")},editActive:function(e){var t=File.editor,e=(t.undo.prepCursorSnap(),e?i(e).closest("[cid]"):t.findElemById(t.focusCid));a.isType(e.attr("mdtype"),s.html_block,s.math_block)?e.find(".md-rawblock-container").trigger("startedit"):a.isType(e.attr("mdtype"),s.fences)&&t.refocus(e.attr("cid"))},deleteActive:function(e){e=File.editor.getMarkElem(e),e=File.editor.findNodeByElem(e),!e&&File.editor.focusCid&&(e=File.editor.getNode(File.editor.focusCid)),e=File.editor.UserOp.backToParagraph(editor,e,!0);File.editor.undo.register(e)},cut:function(){if(File.isLocked)return!1;File.editor.refocus(void 0,!0),File.editor.UserOp.copyHandler(editor,null),File.editor.UserOp.backspaceHandler(editor,null,"delSelection")},pasteAsPlainText:function(){i(File.editor.sessionStr).trigger("pasteAsPlainText")},lock:function(){File.isLocked=!0,File.freshLock()},unlock:function(){File.isLocked=!1,File.freshLock()},toggleSourceMode:function(){File.editor.sourceView.inSourceMode?(File.editor.sourceView.hide(),File.editor.library.recoverSidebar()):(File.editor.library.tmpHideSidebar(),File.editor.sourceView.show()),File.freshMenuWithDelay()},freshLock:function(e,t){File.editor&&(void 0!==e&&(File.isLocked=e),i("content input, selector").prop("readOnly",File.isLocked||!1),i(".CodeMirror").each(function(){this.CodeMirror&&(this.CodeMirror.options.readOnly=File.isLocked||!1)}),File.isLocked?(File.editor.tableEdit.unfocusAll(),i("[contenteditable=true]").attr("locked","true").attr("contenteditable","false"),i(File.editor.sessionStr).blur(),i(".md-expand").removeClass("md-expand")):i("[locked='true']").attr("locked","false").attr("contenteditable","true"),i("#md-searchpanel input").prop("readOnly",!1),t||File.freshMenu(),File.editor)&&File.editor.sourceView&&File.editor.sourceView.inSourceMode&&File.editor.sourceView.cm.focus()},validateContentForSave:function(){return!!function(){try{var e,t;return File.editor.sourceView&&File.editor.sourceView.inSourceMode?1:(e=File.editor.nodeMap.getFirst())&&(e.cid==i("#write [cid]").first().attr("cid")&&1==i("#write [cid='"+e.cid+"']").length)&&(t=e.getLastBrother(!1,!1,!0).getVeryFirst(!0))?t.cid==i("#write [cid]").last().attr("cid")&&1==i("#write [cid='"+t.cid+"']").length:void 0}catch(e){console.sendError(e)}}()||(window.Reporter.record("doValidateContentForSave failed"),window.Reporter.buildExtraDebugInfo().then(e=>{console.sendError(`detect data lost (${File.option.appVersion})`,"error",{extra:e})}),!1)},tryRecoveryFromDom:function(){var e=i("#write").html(),t=File.editor.UserOp.setClipboard,e=(t(e,void 0,void 0,!0),c.getMarkElemFromCurrentHtml(e,File.editor).html()),n=(File.editor.nodeMap.reset(),i("content").scrollTop()),e=c.getBlocksFromMarkHtml(e,void 0,void 0,!0),e="string"==typeof e?e:a.markFromArr(e);File.editor.reset(e),t(void 0,void 0,e),File.editor.writingArea.focus(),File.editor.undo.reset(),File.changeCounter&&File.changeCounter.reset(),File.updateChangeCount(File.ChangeType.NSChangeReadOtherContents),i("content").scrollTop(n),File._needsUpdateSnap=new Date,File.backupDocumentSnap(),File.needSaveState=!0,File.backupWindow()},showDataLostError:function(){l.showDialog({title:i.localize.getString("Error"),message:i.localize.getString("Sorry, some error happened, current writing content has been copied to clipboard. You could report this to <hi@typora.io> to help us fix this error.","Panel"),buttons:[i.localize.getString("Try Recovery","Panel"),i.localize.getString("Other Options for Data Recovery","Panel")],type:"error",tag:"content-lost",callback:function(e){var t=File.option.useMirrorInCN?"typoraio.cn":"typora.io";1==e&&JSBridge.showInBrowser(`https://support.${t}/Version-Control/`)}}),File.saveAndBackup(),File.tryRecoveryFromDom()},isKeyWindow:function(){return!!File.isActiveWindow()&&!(File.isMac?File.bundle:File).isLocked},doImportFile:async function(t){var e=window.ClientCommand;await e.validatePandocInstall()&&(File.changeCounter.isDiscardableUntitled()?(window.getSelection().removeAllRanges(),e.doImport(t)):JSBridge.invoke("app.openFile").then(({winId:e})=>{JSBridge.invoke("executeJavaScript",e,'setTimeout(function(){window.getSelection().removeAllRanges();ClientCommand.doImport("'+r.escapeInQuote(t)+'")}, 200)')}))},onDropFile:async function(e,n,t){var i=-1<n.types.indexOf("typora.url"),r=File.isNode&&n.items.length==n.files.length,o=File.editor,a=e[0];if(a)if(await function(t,e){if(/^[a-z-]:/g.exec(t))return Promise.resolve(!1);if(r){e=n.items[e].webkitGetAsEntry();if(e)return Promise.resolve(e.isDirectory)}return new Promise(function(n,e){if(File.isNode)return reqnode("fs").lstat(t,function(e,t){n(!e&&t.isDirectory())});File.isMac&&bridge.callHandler("path.isDirectory",t,function(e){n(e)})})}(a,0))File.option.supportTextBundle&&/\.textbundle$/i.exec(a)?"link"===File.option.actionWhenDropFile?c(a):d():"link"===File.option.actionWhenDropFolder?c(a):File.bundle.filePath||File.getMountFolder()?File.isNode?JSBridge.invoke("app.openFolder",a):File.isMac&&bridge.callHandler("controller.openFolder",a):JSBridge.invoke("controller.switchFolder",a);else{var s=((s=a.match(/(?:^|\.)([^.]+)$/))[1]||"").toLowerCase();if(~["latex","ltx","tex","wiki","dokuwiki","docx","rst","rest","org","textile","opml"].indexOf(s))return"link"===File.option.actionWhenDropImport?c(a):File.isNode?h.doImportFile(a):bridge.callHandler("controller.openInTypora",a),!1;if(~File.SupportedFiles.indexOf(s))return i||"link"===File.option.actionWhenDropFile?c(a):d(),!1;if(!h.isKeyWindow())return!1;for(var l=0;l<e.length;l++)0<l?o.UserOp.insertParagraph(!1,o):t(),c(e[l])}function c(e){if(File.isMac){if(File.bundle.isLocked)return}else if(File.isLocked)return;File.editor.sourceView.inSourceMode||u.insertURL(e)}function d(){File.isNode?JSBridge.invoke("app.openFile",a,{curWindow:!0}):bridge.callHandler("controller.openInTypora",a)}},handleFileNotExist:async function(e){File.option.noFileNonExistWarning||File.option.silentOpenFailure||(e=(await JSBridge.invoke("dialog.showMessageBox",{type:"warning",message:i.localize.getString("File does not exist at path %@.").replace("%@",e),defaultId:0,buttons:[i.localize.getString("OK")],checkboxLabel:i.localize.getString("Do not show this again","Panel")}))["checkboxChecked"],e&&(JSBridge.execForAll("window.File && File.option && (File.option.noFileNonExistWarning = true)"),JSBridge.putSetting("noFileNonExistWarning",!0)))}};n.exports=h}),$__System.registerDynamic("53",["e","11","2b","28","32","33","54","34","55","51"],!0,function(e,t,n){"use strict";this||self;function v(n,i,r,o){var e=File.bundle.filePath||File.bundle.originalPath;e||File.isLinuxSnap||(e=x.getDefaultPathOrName()),/\.textbundle$/i.exec(e)&&File.bundle.filePath&&(e=e.replace(/\.textbundle$/i,"-2.textbundle")),a(!0,e).then(async({filePath:e})=>{var t;e?(t=await s.saveAsUseNode(e,o))?r&&r(t):n&&n(e):i&&i()},e=>{r&&r(e)})}var b=e("e"),w=e("11"),r=(e("2b"),e("28")),x=e("32"),C=e("33"),F=e("54"),S=e("34"),x=e("32"),k=e("55"),E=e("51").Reporter,o=function(e,t,n){var i=e[t];e[t]=e[n],e[n]=i},a=function(e,t,n){n=n||{};var i=[{name:b.localize.getString("Markdown File","Panel"),extensions:["md","markdown","mmd","mdwn","mdown"]},{name:b.localize.getString("TextBundle","Panel"),extensions:["textbundle"]},{name:b.localize.getString("Plain Text File","Panel"),extensions:["txt","text",""]}];return e&&i.push({name:b.localize.getString("All Files","Panel"),extensions:["*"]}),/\.textbundle$/i.exec(t)?o(i,0,1):/\.(txt|text)$/i.exec(t)||/[\\\/][^\\\/\.]+$/i.exec(t)?o(i,0,2):/\.(md|markdown|mmd|mdwn|mdown)$/i.exec(t)||(e||i.push({name:b.localize.getString("All Files","Panel"),extensions:["*"]}),o(i,0,3)),JSBridge.invoke("dialog.showSaveDialog",Object.assign({properties:["saveFile","showOverwriteConfirmation"],title:b.localize.getString("Save","Menu")},n,{defaultPath:t,filters:i}))},s={doShowSaveDialog:a,makeEmptyFileByNode:async function(e){var t,n=e,i=(C.isTextBundle(e)?(await C.makeTextBundleSkeleton(e),n+="/text.md"):C.isTextPack(e)&&(t=+new Date+"-"+Math.random()+".textbundle",t=reqnode("path").normalize(File.option.tempPath+"/"+t),await C.makeTextBundleSkeleton(t),n=t+"/text.md"),reqnode("fs")),n=(e=reqnode("path").resolve(n),i.openSync(e,"wx"));i.close(n,function(){}),C.isTextPack(e)&&F.zipFolder(t,e)},saveAsUseNode:async function(e,t){var n,i,r=File.bundle.filePath,o=File.bundle.originalPath,a=File.editor.imgEdit.getTargetImageStorageFolder(),s=File.isWin?"\\":"/",l=(File.option.lastSaveLocation=reqnode("path").dirname(e),JSBridge.invoke("app.sendEvent","willSave",e),File.editor.imgEdit.buildImageMap(null,null,!0),File.editor.getMarkdown()),c=(File.bundle.filePath=e,!1);if(C.isTextBundle(e)){if(File.isTextBundle()&&r&&r!=e)try{await File.fs.copy(r,e),c=!0}catch(e){}File.bundle.type=File.FileType.TextBundle,c||(File.bundle.textFile=File.bundle.textFile||"text.md",await C.makeTextBundleSkeleton(e)),c?await C.removeUnusedAssets():(await File.editor.imgEdit._copyAllImages(e+s+"assets",!1,null,!0,!0,!0),l=File.editor.getMarkdown())}else File.isTextBundle()&&(File.bundle.type=File.FileType.Markdown,c=w.pathByDeleteLastComponent(e)+s+w.getFileName(e).replace(/\.[^.\/\\]+$/,"")+".assets",await File.editor.imgEdit._copyAllImages(c,!1,null,!0,!0,!1),l=File.editor.getMarkdown());File.bundle.originalPath="",File.bundle.assetsChanges=null;try{File.fs.writeFileSync((n=e,C.isTextBundle(n)?(i=File.bundle.textFile||"text.md",n+(File.isWin?"\\":"/")+i):n),l,"utf8"),File.updateChangeCount(File.ChangeType.NSChangeAutoSaved);try{File.bundle.modifiedDate=File.fs.statSync(e).mtimeMs}catch(e){console.error(e),File.bundle.modifiedDate=new Date}}catch(e){return console.sendError(e),alert(b.localize.getString("Save File Failed","Panel")+"\n"+e.stack),File.inSavingProcess=!1,File._onFileSwitching=!1,e}File.inSavingProcess=!1,File._onFileSwitching=!1,t||(r||o)!=e?await JSBridge.invoke("document.checkIfMoveOnSave",e)&&(JSBridge.invoke("app.sendEvent","didRename",{oldPath:r,newPath:e}),S.onFilePathUpdated(void 0,r,a)):File.FileInfoPanel.onFilePathUpdated(),File.needsUpdateSnap(),File.bundle.savedContent=l,JSBridge.invoke("app.sendEvent","didSave",{path:e,summary:l.substr(0,200),lastModifiedDate:File.bundle.modifiedDate}),r!=e&&t&&r&&JSBridge.invoke("shell.trashItem",r),JSBridge.invoke("document.setLastSync",File.bundle.modifiedDate),Analytics.record("saveFile")},saveUseNode:async function(c,d){if(File.isActiveWindow()&&!File.bundle.unsupported&&!File.isFileLoading()){var u=File.sync();if(void 0!==u){if(!1===File.validateContentForSave())return E.record(`saveUseNode to ${w.hashCode(File.bundle.filePath)} saveAs: `+c),File.showDataLostError(),!1;var h,p=File.bundle.filePath,n=p,f=File.bundle.fileEncode||"utf8",m=!1;if(/-bom$/.exec(f)&&(m=!0,f=f.replace("-bom","")),File.bundle.fileMissingWhenOpen&&!p&&(p=File.bundle.originalPath),!c&&File.isTextBundle()){let e=!1;try{e=(await File.fs.stat(p)).isDirectory()}catch(e){}if(!e&&p)return await S.saveFileToRecover(!0),void await s.saveAsUseNode(p)}return!p&&d||!File.isNode?void 0:new Promise(async t=>{var n,e=reqnode("iconv-lite");try{if("utf8"!=f||m){var i,r=u;if(h=e.encode(u,f,{addBOM:m}),f&&-1==f.indexOf("utf")){try{i=e.decode(h,f)}catch(e){}if(r!=i)throw console.error(`Failed to save in ${f} due to untransliteral char, saving in utf8`),new Error("iconv-lite transliteration error")}}else h=Buffer.from(u,"utf-8")}catch(e){g()}if(""!=u&&(0==h.length||1<h.length&&0==h[0]&&0==h[1])&&g(),p&&!c){File.markSaved(),File.bundle.assetsChanges=null;let e=C.getTextFile()||p;if(File.inSavingProcess=File.inSavingProcess||!c,JSBridge.invoke("app.sendEvent","willSave",p),File.bundle.savedContent=u,File.bundle.modifiedDate=new Date,await S.saveFileToRecover(),File.isTextPack())await F.saveFile(p,u),File.inSavingProcess=!1,setTimeout(()=>{x.refreshTitlebarText()});else{try{var o=await new Promise(n=>{k.writeFile(e,h,async function(e,t){n({err:e,watchFile:t})})}),a=o.err,s=o.watchFile}catch(e){a=e}if(a)return t(!1),E.error(a,{fingerprint:["steno2","writeFile"]}),void y(a.stack,a.code);s&&S.watchFileChange(p),File.bundle.filePath||(File.bundle.filePath=p),File.bundle.fileMissingWhenOpen=!1,File.bundle.savedContent=u;try{var l=null,l=d?await File.fs.stat(e):File.fs.statSync(e);if(h.length&&0==Number(l.size))return t(!1),y("Failed to write file"),void E.error("Failed to write file: File size is 0 but data is not",{fingerprint:["steno2","afterWriteFile"]});File.bundle.modifiedDate=l.mtimeMs}catch(e){return t(!1),void y(e.stack,e.code)}t(!0),JSBridge.invoke("document.setLastSync",File.bundle.modifiedDate),File.updateChangeCount(File.ChangeType.NSChangeAutoSaved),JSBridge.invoke("app.sendEvent","didSave",{path:p,summary:u.substr(0,200),lastModifiedDate:File.bundle.modifiedDate}),File.inSavingProcess=!1,x.refreshTitlebarText(),File.option.enableAutoSave&&!c||await File.backupWindow()}C.removeUnusedAssets(),File.updateChangeCount(File.ChangeType.NSChangeAutoSaved)}else d||(n=()=>{File.inSavingProcess=!1,File._onFileSwitching=!1},v(async e=>{t(!0),n()},()=>{t(void 0),n()},()=>{t(!1),n()}),Analytics.record("saveFile"));File.editor.nodeMap.toc.updateHTML()})}}function g(){console.log("switch to utf8 encode"),h=Buffer.from(u),File.bundle.fileEncode="utf8",x.removeItemInDB("[encode]"+p),File.needsUpdateSnap()}function i(e){var t=c&&n?[b.localize.getString("Save As","Menu"),b.localize.getString("Open File Location","Menu"),b.localize.getString("Cancel")]:[b.localize.getString("Save As","Menu"),b.localize.getString("Cancel")];r.showDialog({title:b.localize.getString("Save File Failed"),message:e,buttons:t,type:"error",callback:function(e){0==e?ClientCommand.saveAs():e==t.length-2&&ClientCommand.openFileLocation()}})}function y(e,t){E.record("onSaveError "+(t||"")),d||(i("EPERM"==t?b.localize.getString("The file is read-only, or you do not have right permissions to modify the file."):e),console.sendError("fs write failed",!1,t||e),File.saveAndBackup()),File.inSavingProcess=!1,File._onFileSwitching=!1,File.updateChangeCount(File.ChangeType.NodeSaveFailed)}},moveTo:async function(){return new Promise(function(e){var t=()=>{e(!1),File.inSavingProcess=!1,File._onFileSwitching=!1};v(()=>{e(!0),File.inSavingProcess=!1,File._onFileSwitching=!1},t,t,!0)})},markSaved:function(){var e=File.editor&&File.editor.undo.lastRegisteredOperationCommand();e&&(e.date=void 0)}};n.exports=s}),$__System.registerDynamic("54",["33","11","34"],!0,function(e,t,n){this||self;var l=e("33"),i=e("11"),r=e("34"),o={loadFile:async function(e){var n,i,a,s=new(reqnode("adm-zip"))(e);if(s.getEntries().forEach(function(e){var t;a||(a=e.entryName.split("/")[0],/textbundle$/.exec(a))?-1!==e.entryName.indexOf(a+"/")&&("info.json"===(t=e.entryName.substring(a.length+1))?e.getData().toString("utf8"):/^text\./.exec(t)&&(t=((t=e.name.match(/(?:^|\.)([^.]+)$/))[1]||"").toLowerCase(),~File.SupportedTextFiles.indexOf(t))&&(n=e.entryName,i=e.getData().toString("utf8"))):a=""}),n)return r.textBundleDraftFolder().then(t=>{const o=reqnode("fs-extra");var e=s.getEntries().map(async function(r){if(-1===r.entryName.indexOf(a+"/"))return Promise.resolve();var e=r.entryName.substring(a.length+1).split("/").slice(0,-1).join("/");if(r.isDirectory)return Promise.resolve();{let i=t+(File.isWin?"\\":"/")+e;return new Promise((t,n)=>{try{o.ensureDirSync(i)}catch(e){o.unlinkSync(i),o.ensureDirSync(i)}var e=s.readFile(r);o.writeFile(i+(File.isWin?"\\":"/")+r.name,e,function(e){e?n(e):t()})})}});Promise.all(e).then(()=>{File.bundle.unzipFolder=t,File.editor.imgEdit.refreshLocalImg(!0)},()=>{File.bundle.unsupported=File.UNSUPPORTED_REASON.READ_FAIL})}),File.bundle={fileEncode:"utf8",filePath:e,savedContent:i,modifiedDate:new Date,type:File.FileType.TextPack,textFile:n,bundleFile:a,zip:s,unzipFolder:""},i;throw new Error(l.NotMarkdownError)},findUnusedAssets:async function(){var t,n;return File.isNode&&File.isTextPack()&&File.bundle.zip?(t=l.getAllUsedAssets(!0),n=new Set,File.bundle.zip.getEntries().map(async function(e){if(-1===e.entryName.indexOf(File.bundle.bundleFile+"/assets/"))return Promise.resolve();e=e.entryName.substring(File.bundle.bundleFile.length+"/assets/".length);t.has(e)||n.add(e)}),n):[]},recordUnusedAssets:function(){var e=o.findUnusedAssets();File.bundle.unusedAssets=Array.from(e||[])},zipFolder:async function(e,t){var n=new(reqnode("adm-zip"));n.addLocalFolder(e,i.getFolder(e)),n.writeZip(t)},saveFile:async function(e,t){var n=reqnode("fs-extra"),i=new Set(l.getAllUsedAssets(!0)),r=(File.bundle.unusedAssets.forEach(e=>{i.add(e)}),new Set(i)),o=new Set(i);if(File.bundle.zip.getEntries().map(async function(e){if(-1===e.entryName.indexOf(File.bundle.bundleFile+"/assets/"))return Promise.resolve();e=e.entryName.substring(File.bundle.bundleFile.length+"/assets/".length);r.add(e),o.delete(e)}),i.forEach(e=>{r.delete(e)}),!r.size){o.forEach(function(e){File.bundle.zip.addLocalFile(File.bundle.unzipFolder+"/assets/"+e,File.bundle.bundleFile+"/assets/")}),File.bundle.zip.updateFile(File.bundle.textFile,Buffer.from(t,"utf8"));try{return void File.bundle.zip.writeZip(e)}catch(e){}}const a=new(reqnode("adm-zip"));a.addFile(File.bundle.textFile,Buffer.from(t,"utf8")),i.forEach(function(e){a.addLocalFile(File.bundle.unzipFolder+"/assets/"+e,File.bundle.bundleFile+"/assets/")}),n.pathExistsSync(File.bundle.unzipFolder+"/info.json")&&a.addLocalFile(File.bundle.unzipFolder+"/info.json",""+File.bundle.bundleFile),File.bundle.zip=a,File.bundle.zip.writeZip(e)}};n.exports=o}),$__System.registerDynamic("55",[],!0,function(e,t,n){"use strict";var l,i,r,c,o,d=this||self;window.reqnode&&(l=reqnode("fs"),i=reqnode("path"),r={},c=function(e){return i.join(i.dirname(e),".~"+i.basename(e))},(o=function(e){this.file=e,this.callbacks=[],this.nextData=null,this.nextCallbacks=[]}).prototype.write=function(i,n){var t=this;function r(e){for(;this.callbacks.length;)this.callbacks.shift()(e);n(e),o()}function o(){var e;t.lock=!1,t.nextData&&(e=t.nextData,t.callbacks=t.nextCallbacks,t.nextData=null,t.nextCallbacks=[],t.write(e,t.callbacks.pop()))}function a(e,t){for(;this.callbacks.length;)this.callbacks.shift()(e);n(null,t),o()}function s(n){l.readFile(this.file,(e,t)=>{n(!!e||0==Buffer.compare(i,t))})}this.lock?(n&&this.nextCallbacks.push(n),this.nextData=i):(this.lock=!0,l.stat(this.file,function(e,t){var n;e||!t?function(){l.writeFile(this.file,i,function(e){e?r.call(this,e):s.call(this,e=>{e?a.call(this,null,!0):r.call(this,new Error("write data failed"))})}.bind(this))}.call(this):(n=c(this.file),l.writeFile(n,i,function(e){e&&(console.log("[Warn] write to tmp file failed"),d.File)&&d.File.backupVersionWorker&&File.backupVersionWorker(),l.writeFile(this.file,i,function(e){e?r.call(this,e):s.call(this,e=>{e?(l.open(this.file,(e,t)=>{e?r(!0):l.fsync(t,function(){l.close(t,function(){})})}),l.unlink(n,a.bind(this))):r.call(this,new Error("write data failed"))})}.bind(this))}.bind(this)))}.bind(this)))},t.writeFile=function(e,t,n){e=i.resolve(e),r[e]=r[e]||new o(e),r[e].write(t,n)},t.writeFileSync=function(e,t){l.writeFileSync(c(e),t),l.renameSync(c(e),e)})}),!function(i){"object"==typeof exports&&void 0!==module?module.exports=i():$__System.registerDynamic("56",[],!1,function(e,t,n){return i.call(this)})}(function(){return function i(r,o,a){function s(n,e){if(!o[n]){if(!r[n]){var t="function"==typeof require&&require;if(!e&&t)return t(n,!0);if(l)return l(n,!0);e=new Error("Cannot find module '"+n+"'");throw e.code="MODULE_NOT_FOUND",e}t=o[n]={exports:{}};r[n][0].call(t.exports,function(e){var t=r[n][1][e];return s(t||e)},t,t.exports,i,r,o,a)}return o[n].exports}for(var l="function"==typeof require&&require,e=0;e<a.length;e++)s(a[e]);return s}({1:[function(e,t,n){function i(e){this.name="RavenConfigError",this.message=e}i.prototype=new Error,t.exports=i.prototype.constructor=i},{}],2:[function(e,t,n){var l=e(5);t.exports={wrapMethod:function(e,i,r){var o,a=e[i],s=e;i in e&&(o="warn"===i?"warning":i,e[i]=function(){var e=[].slice.call(arguments),t=l.safeJoin(e," "),n={level:o,logger:"console",extra:{arguments:e}};"assert"===i?!1===e[0]&&(t="Assertion failed: "+(l.safeJoin(e.slice(1)," ")||"console.assert"),n.extra.arguments=e.slice(1),r)&&r(t,n):r&&r(t,n),a&&Function.prototype.apply.call(a,s,e)})}}},{5:5}],3:[function(q,W,e){!function(e){var o=q(6),a=q(7),i=q(8),s=q(1),t=q(5),r=t.isErrorEvent,l=t.isDOMError,c=t.isDOMException,d=t.isError,u=t.isObject,h=t.isPlainObject,n=t.isUndefined,p=t.isFunction,f=t.isString,m=t.isArray,g=t.isEmptyObject,y=t.each,v=t.objectMerge,b=t.truncate,w=t.objectFrozen,x=t.hasKey,C=t.joinRegExp,F=t.urlencode,S=t.uuid4,k=t.htmlTreeAsString,E=t.isSameException,R=t.isSameStacktrace,T=t.parseUrl,_=t.fill,A=t.supportsFetch,O=t.supportsReferrerPolicy,I=(t.serializeKeysForMessage,t.serializeException),$=t.sanitize,H=q(2).wrapMethod,U="source protocol user pass host port path".split(" "),j=/^(?:(\w+):)?\/\/(?:(\w+)(:\w+)?@)?([\w\.-]+)(?::(\d+))?(\/.*)/;function M(){return+new Date}var L="undefined"!=typeof window?window:void 0!==e?e:"undefined"!=typeof self?self:{},N=L.document,D=L.navigator;function P(t,n){return p(n)?function(e){return n(e,t)}:n}function B(){for(var e in this._hasJSON=!("object"!=typeof JSON||!JSON.stringify),this._hasDocument=!n(N),this._hasNavigator=!n(D),this._lastCapturedException=null,this._lastData=null,this._lastEventId=null,this._globalServer=null,this._globalKey=null,this._globalProject=null,this._globalContext={},this._globalOptions={release:L.SENTRY_RELEASE&&L.SENTRY_RELEASE.id,logger:"javascript",ignoreErrors:[],ignoreUrls:[],whitelistUrls:[],includePaths:[],headers:null,collectWindowErrors:!0,captureUnhandledRejections:!0,maxMessageLength:0,maxUrlLength:250,stackTraceLimit:50,autoBreadcrumbs:!0,instrument:!0,sampleRate:1,sanitizeKeys:[]},this._fetchDefaults={method:"POST",keepalive:!0,referrerPolicy:O()?"origin":""},this._ignoreOnError=0,this._isRavenInstalled=!1,this._originalErrorStackTraceLimit=Error.stackTraceLimit,this._originalConsole=L.console||{},this._originalConsoleMethods={},this._plugins=[],this._startTime=M(),this._wrappedBuiltIns=[],this._breadcrumbs=[],this._lastCapturedEvent=null,this._keypressTimeout,this._location=L.location,this._lastHref=this._location&&this._location.href,this._resetBackoff(),this._originalConsole)this._originalConsoleMethods[e]=this._originalConsole[e]}(B.prototype={VERSION:"3.26.4",debug:!1,TraceKit:o,config:function(e,t){var n,i=this;return i._globalServer?this._logDebug("error","Error: Raven has already been configured"):e&&(n=i._globalOptions,t&&y(t,function(e,t){"tags"===e||"extra"===e||"user"===e?i._globalContext[e]=t:n[e]=t}),i.setDSN(e),n.ignoreErrors.push(/^Script error\.?$/),n.ignoreErrors.push(/^Javascript error: Script error\.? on line 0$/),n.ignoreErrors=C(n.ignoreErrors),n.ignoreUrls=!!n.ignoreUrls.length&&C(n.ignoreUrls),n.whitelistUrls=!!n.whitelistUrls.length&&C(n.whitelistUrls),n.includePaths=C(n.includePaths),n.maxBreadcrumbs=Math.max(0,Math.min(n.maxBreadcrumbs||100,100)),t={xhr:!0,console:!0,dom:!0,location:!0,sentry:!0},e=n.autoBreadcrumbs,"[object Object]"==={}.toString.call(e)?e=v(t,e):!1!==e&&(e=t),n.autoBreadcrumbs=e,t={tryCatch:!0},e=n.instrument,"[object Object]"==={}.toString.call(e)?e=v(t,e):!1!==e&&(e=t),n.instrument=e,o.collectWindowErrors=!!n.collectWindowErrors),i},install:function(){var e=this;return e.isSetup()&&!e._isRavenInstalled&&(o.report.subscribe(function(){e._handleOnErrorStackInfo.apply(e,arguments)}),e._globalOptions.captureUnhandledRejections&&e._attachPromiseRejectionHandler(),e._patchFunctionToString(),e._globalOptions.instrument&&e._globalOptions.instrument.tryCatch&&e._instrumentTryCatch(),e._globalOptions.autoBreadcrumbs&&e._instrumentBreadcrumbs(),e._drainPlugins(),e._isRavenInstalled=!0),Error.stackTraceLimit=e._globalOptions.stackTraceLimit,this},setDSN:function(e){var t=this,n=t._parseDSN(e),i=n.path.lastIndexOf("/"),r=n.path.substr(1,i);t._dsn=e,t._globalKey=n.user,t._globalSecret=n.pass&&n.pass.substr(1),t._globalProject=n.path.substr(i+1),t._globalServer=t._getGlobalServer(n),t._globalEndpoint=t._globalServer+"/"+r+"api/"+t._globalProject+"/store/",this._resetBackoff()},context:function(e,t,n){return p(e)&&(n=t||[],t=e,e={}),this.wrap(e,t).apply(this,n)},wrap:function(i,r,o){var e,a=this;if(n(r)&&!p(i))return i;if(p(i)&&(r=i,i=void 0),!p(r))return r;try{if(r.__raven__)return r;if(r.__raven_wrapper__)return r.__raven_wrapper__}catch(e){return r}function t(){var e=[],t=arguments.length,n=!i||!1!==i.deep;for(o&&p(o)&&o.apply(this,arguments);t--;)e[t]=n?a.wrap(i,arguments[t]):arguments[t];try{return r.apply(this,e)}catch(e){try{a._ignoreNextOnError(),a.captureException(e,i)}catch(e){}throw e}}for(e in r)x(r,e)&&(t[e]=r[e]);return t.prototype=r.prototype,(r.__raven_wrapper__=t).__raven__=!0,t.__orig__=r,t},uninstall:function(){return o.report.uninstall(),this._detachPromiseRejectionHandler(),this._unpatchFunctionToString(),this._restoreBuiltIns(),this._restoreConsole(),Error.stackTraceLimit=this._originalErrorStackTraceLimit,this._isRavenInstalled=!1,this},_promiseRejectionHandler:function(e){this._logDebug("debug","Raven caught unhandled promise rejection:",e),this.captureException(e.reason,{mechanism:{type:"onunhandledrejection",handled:!1}})},_attachPromiseRejectionHandler:function(){return this._promiseRejectionHandler=this._promiseRejectionHandler.bind(this),L.addEventListener&&L.addEventListener("unhandledrejection",this._promiseRejectionHandler),this},_detachPromiseRejectionHandler:function(){return L.removeEventListener&&L.removeEventListener("unhandledrejection",this._promiseRejectionHandler),this},captureException:function(t,e){if(e=v({trimHeadFrames:0},e||{}),r(t)&&t.error)t=t.error;else{var n;if(l(t)||c(t))return n=t.name||(l(t)?"DOMError":"DOMException"),n=t.message?n+": "+t.message:n,this.captureMessage(n,v(e,{stacktrace:!0,trimHeadFrames:e.trimHeadFrames+1}));if(!d(t)){if(!h(t))return this.captureMessage(t,v(e,{stacktrace:!0,trimHeadFrames:e.trimHeadFrames+1}));e=this._getCaptureExceptionOptionsFromPlainObject(e,t),t=new Error(e.message)}}this._lastCapturedException=t;try{var i=o.computeStackTrace(t);this._handleStackInfo(i,e)}catch(e){if(t!==e)throw e}return this},_getCaptureExceptionOptionsFromPlainObject:function(e,t){var n=Object.keys(t).sort(),n=v(e,{message:JSON.stringify(t),fingerprint:[i(n)],extra:e.extra||{}});return n.extra.__serialized__=I(t),n},captureMessage:function(e,t){if(!this._globalOptions.ignoreErrors.test||!this._globalOptions.ignoreErrors.test(e)){var n=v({message:e+=""},t=t||{});try{throw new Error(e)}catch(e){i=e}i.name=null;var i=o.computeStackTrace(i),r=m(i.stack)&&i.stack[1],r=(r=r&&"Raven.captureException"===r.func?i.stack[2]:r)&&r.url||"";if(!this._globalOptions.ignoreUrls.test||!this._globalOptions.ignoreUrls.test(r))if(!this._globalOptions.whitelistUrls.test||this._globalOptions.whitelistUrls.test(r))return(this._globalOptions.stacktrace||t.stacktrace||""===n.message)&&(n.fingerprint=null==n.fingerprint?e:n.fingerprint,(t=v({trimHeadFrames:0},t)).trimHeadFrames+=1,r=this._prepareFrames(i,t),n.stacktrace={frames:r.reverse()}),n.fingerprint&&(n.fingerprint=m(n.fingerprint)?n.fingerprint:[n.fingerprint]),this._send(n),this}},captureBreadcrumb:function(e){e=v({timestamp:M()/1e3},e);if(p(this._globalOptions.breadcrumbCallback)){var t=this._globalOptions.breadcrumbCallback(e);if(u(t)&&!g(t))e=t;else if(!1===t)return this}return this._breadcrumbs.push(e),this._breadcrumbs.length>this._globalOptions.maxBreadcrumbs&&this._breadcrumbs.shift(),this},addPlugin:function(e){var t=[].slice.call(arguments,1);return this._plugins.push([e,t]),this._isRavenInstalled&&this._drainPlugins(),this},setUserContext:function(e){return this._globalContext.user=e,this},setExtraContext:function(e){return this._mergeContext("extra",e),this},setTagsContext:function(e){return this._mergeContext("tags",e),this},clearContext:function(){return this._globalContext={},this},getContext:function(){return JSON.parse(a(this._globalContext))},setEnvironment:function(e){return this._globalOptions.environment=e,this},setRelease:function(e){return this._globalOptions.release=e,this},setDataCallback:function(e){var t=this._globalOptions.dataCallback;return this._globalOptions.dataCallback=P(t,e),this},setBreadcrumbCallback:function(e){var t=this._globalOptions.breadcrumbCallback;return this._globalOptions.breadcrumbCallback=P(t,e),this},setShouldSendCallback:function(e){var t=this._globalOptions.shouldSendCallback;return this._globalOptions.shouldSendCallback=P(t,e),this},setTransport:function(e){return this._globalOptions.transport=e,this},lastException:function(){return this._lastCapturedException},lastEventId:function(){return this._lastEventId},isSetup:function(){return!(!this._hasJSON||!this._globalServer&&(this.ravenNotConfiguredError||(this.ravenNotConfiguredError=!0,this._logDebug("error","Error: Raven has not been configured.")),1))},afterLoad:function(){var e=L.RavenConfig;e&&this.config(e.dsn,e.config).install()},showReportDialog:function(e){if(N){if(!(e=Object.assign({eventId:this.lastEventId(),dsn:this._dsn,user:this._globalContext.user||{}},e)).eventId)throw new s("Missing eventId");if(!e.dsn)throw new s("Missing DSN");var t,n,i=encodeURIComponent,r=[];for(t in e)"user"===t?((n=e.user).name&&r.push("name="+i(n.name)),n.email&&r.push("email="+i(n.email))):r.push(i(t)+"="+i(e[t]));var o=this._getGlobalServer(this._parseDSN(e.dsn)),a=N.createElement("script");a.async=!0,a.src=o+"/api/embed/error-page/?"+r.join("&"),(N.head||N.body).appendChild(a)}},_ignoreNextOnError:function(){var e=this;this._ignoreOnError+=1,setTimeout(function(){--e._ignoreOnError})},_triggerEvent:function(e,t){var n,i;if(this._hasDocument){for(i in t=t||{},e="raven"+e.substr(0,1).toUpperCase()+e.substr(1),N.createEvent?(n=N.createEvent("HTMLEvents")).initEvent(e,!0,!0):(n=N.createEventObject()).eventType=e,t)x(t,i)&&(n[i]=t[i]);if(N.createEvent)N.dispatchEvent(n);else try{N.fireEvent("on"+n.eventType.toLowerCase(),n)}catch(e){}}},_breadcrumbEventHandler:function(n){var i=this;return function(e){if(i._keypressTimeout=null,i._lastCapturedEvent!==e){var t;i._lastCapturedEvent=e;try{t=k(e.target)}catch(e){t="<unknown>"}i.captureBreadcrumb({category:"ui."+n,message:t})}}},_keypressEventHandler:function(){var i=this;return function(e){var t;try{t=e.target}catch(e){return}var n=t&&t.tagName;n&&("INPUT"===n||"TEXTAREA"===n||t.isContentEditable)&&((n=i._keypressTimeout)||i._breadcrumbEventHandler("input")(e),clearTimeout(n),i._keypressTimeout=setTimeout(function(){i._keypressTimeout=null},1e3))}},_captureUrlChange:function(e,t){var n=T(this._location.href),i=T(t),r=T(e);this._lastHref=t,n.protocol===i.protocol&&n.host===i.host&&(t=i.relative),n.protocol===r.protocol&&n.host===r.host&&(e=r.relative),this.captureBreadcrumb({category:"navigation",data:{to:t,from:e}})},_patchFunctionToString:function(){var e=this;e._originalFunctionToString=Function.prototype.toString,Function.prototype.toString=function(){return"function"==typeof this&&this.__raven__?e._originalFunctionToString.apply(this.__orig__,arguments):e._originalFunctionToString.apply(this,arguments)}},_unpatchFunctionToString:function(){this._originalFunctionToString&&(Function.prototype.toString=this._originalFunctionToString)},_instrumentTryCatch:function(){var c=this,t=c._wrappedBuiltIns;function e(o){return function(e,t){for(var n=new Array(arguments.length),i=0;i<n.length;++i)n[i]=arguments[i];var r=n[0];return p(r)&&(n[0]=c.wrap({mechanism:{type:"instrument",data:{function:o.name||"<anonymous>"}}},r)),o.apply?o.apply(this,n):o(n[0],n[1])}}var d=this._globalOptions.autoBreadcrumbs;_(L,"setTimeout",e,t),_(L,"setInterval",e,t),L.requestAnimationFrame&&_(L,"requestAnimationFrame",function(t){return function(e){return t(c.wrap({mechanism:{type:"instrument",data:{function:"requestAnimationFrame",handler:t&&t.name||"<anonymous>"}}},e))}},t);for(var n=["EventTarget","Window","Node","ApplicationCache","AudioTrackList","ChannelMergerNode","CryptoOperation","EventSource","FileReader","HTMLUnknownElement","IDBDatabase","IDBRequest","IDBTransaction","KeyOperation","MediaController","MessagePort","ModalWindow","Notification","SVGElementInstance","Screen","TextTrack","TextTrackCue","TextTrackList","WebSocket","WebSocketWorker","Worker","XMLHttpRequest","XMLHttpRequestEventTarget","XMLHttpRequestUpload"],i=0;i<n.length;i++)!function(l){var e=L[l]&&L[l].prototype;e&&e.hasOwnProperty&&e.hasOwnProperty("addEventListener")&&(_(e,"addEventListener",function(s){return function(e,t,n,i){try{t&&t.handleEvent&&(t.handleEvent=c.wrap({mechanism:{type:"instrument",data:{target:l,function:"handleEvent",handler:t&&t.name||"<anonymous>"}}},t.handleEvent))}catch(e){}var r,o,a;return d&&d.dom&&("EventTarget"===l||"Node"===l)&&(o=c._breadcrumbEventHandler("click"),a=c._keypressEventHandler(),r=function(e){if(e){var t;try{t=e.type}catch(e){return}return"click"===t?o(e):"keypress"===t?a(e):void 0}}),s.call(this,e,c.wrap({mechanism:{type:"instrument",data:{target:l,function:"addEventListener",handler:t&&t.name||"<anonymous>"}}},t,r),n,i)}},t),_(e,"removeEventListener",function(r){return function(e,t,n,i){try{t=t&&(t.__raven_wrapper__||t)}catch(e){}return r.call(this,e,t,n,i)}},t))}(n[i])},_instrumentBreadcrumbs:function(){var s=this,e=this._globalOptions.autoBreadcrumbs,t=s._wrappedBuiltIns;e.xhr&&"XMLHttpRequest"in L&&(r=L.XMLHttpRequest&&L.XMLHttpRequest.prototype,_(r,"open",function(n){return function(e,t){return f(t)&&-1===t.indexOf(s._globalKey)&&(this.__raven_xhr={method:e,url:t,status_code:null}),n.apply(this,arguments)}},t),_(r,"send",function(r){return function(){var e=this;function t(){if(e.__raven_xhr&&4===e.readyState){try{e.__raven_xhr.status_code=e.status}catch(e){}s.captureBreadcrumb({type:"http",category:"xhr",data:e.__raven_xhr})}}for(var n=["onload","onerror","onprogress"],i=0;i<n.length;i++)!function(t,e){t in e&&p(e[t])&&_(e,t,function(e){return s.wrap({mechanism:{type:"instrument",data:{function:t,handler:e&&e.name||"<anonymous>"}}},e)})}(n[i],e);return"onreadystatechange"in e&&p(e.onreadystatechange)?_(e,"onreadystatechange",function(e){return s.wrap({mechanism:{type:"instrument",data:{function:"onreadystatechange",handler:e&&e.name||"<anonymous>"}}},e,t)}):e.onreadystatechange=t,r.apply(this,arguments)}},t)),e.xhr&&A()&&_(L,"fetch",function(a){return function(){for(var e=new Array(arguments.length),t=0;t<e.length;++t)e[t]=arguments[t];var n,i,r=e[0],o="GET";return"string"==typeof r?n=r:"Request"in L&&r instanceof L.Request?(n=r.url,r.method&&(o=r.method)):n=""+r,-1!==n.indexOf(s._globalKey)?a.apply(this,e):(i={method:o=e[1]&&e[1].method?e[1].method:o,url:n,status_code:null},a.apply(this,e).then(function(e){return i.status_code=e.status,s.captureBreadcrumb({type:"http",category:"fetch",data:i}),e}).catch(function(e){throw s.captureBreadcrumb({type:"http",category:"fetch",data:i,level:"error"}),e}))}},t),e.dom&&this._hasDocument&&(N.addEventListener?(N.addEventListener("click",s._breadcrumbEventHandler("click"),!1),N.addEventListener("keypress",s._keypressEventHandler(),!1)):N.attachEvent&&(N.attachEvent("onclick",s._breadcrumbEventHandler("click")),N.attachEvent("onkeypress",s._keypressEventHandler())));var n,i,r=L.chrome,r=!(r&&r.app&&r.app.runtime)&&L.history&&L.history.pushState&&L.history.replaceState;e.location&&r&&(n=L.onpopstate,L.onpopstate=function(){var e=s._location.href;if(s._captureUrlChange(s._lastHref,e),n)return n.apply(this,arguments)},_(L.history,"pushState",r=function(t){return function(){var e=2<arguments.length?arguments[2]:void 0;return e&&s._captureUrlChange(s._lastHref,e+""),t.apply(this,arguments)}},t),_(L.history,"replaceState",r,t)),e.console&&"console"in L&&console.log&&(i=function(e,t){s.captureBreadcrumb({message:e,level:t.level,category:"console"})},y(["debug","info","warn","error","log"],function(e,t){H(console,t,i)}))},_restoreBuiltIns:function(){for(;this._wrappedBuiltIns.length;){var e=(n=this._wrappedBuiltIns.shift())[0],t=n[1],n=n[2];e[t]=n}},_restoreConsole:function(){for(var e in this._originalConsoleMethods)this._originalConsole[e]=this._originalConsoleMethods[e]},_drainPlugins:function(){var i=this;y(this._plugins,function(e,t){var n=t[0],t=t[1];n.apply(i,[i].concat(t))})},_parseDSN:function(t){var e=j.exec(t),n={},i=7;try{for(;i--;)n[U[i]]=e[i]||""}catch(e){throw new s("Invalid DSN: "+t)}if(n.pass&&!this._globalOptions.allowSecretKey)throw new s("Do not specify your secret key in the DSN. See: http://bit.ly/raven-secret-key");return n},_getGlobalServer:function(e){var t="//"+e.host+(e.port?":"+e.port:"");return t=e.protocol?e.protocol+":"+t:t},_handleOnErrorStackInfo:function(e,t){(t=t||{}).mechanism=t.mechanism||{type:"onerror",handled:!1},this._ignoreOnError||this._handleStackInfo(e,t)},_handleStackInfo:function(e,t){var n=this._prepareFrames(e,t);this._triggerEvent("handle",{stackInfo:e,options:t}),this._processException(e.name,e.message,e.url,e.lineno,n,t)},_prepareFrames:function(n,e){var i=this,r=[];if(n.stack&&n.stack.length&&(y(n.stack,function(e,t){t=i._normalizeFrame(t,n.url);t&&r.push(t)}),e)&&e.trimHeadFrames)for(var t=0;t<e.trimHeadFrames&&t<r.length;t++)r[t].in_app=!1;return r=r.slice(0,this._globalOptions.stackTraceLimit)},_normalizeFrame:function(e,t){var n={filename:e.url,lineno:e.line,colno:e.column,function:e.func||"?"};return e.url||(n.filename=t),n.in_app=!(this._globalOptions.includePaths.test&&!this._globalOptions.includePaths.test(n.filename)||/(Raven|TraceKit)\./.test(n.function)||/raven\.(min\.)?js$/.test(n.filename)),n},_processException:function(e,t,n,i,r,o){var a,s=(e?e+": ":"")+(t||"");this._globalOptions.ignoreErrors.test&&(this._globalOptions.ignoreErrors.test(t)||this._globalOptions.ignoreErrors.test(s))||(r&&r.length?(n=r[0].filename||n,r.reverse(),a={frames:r}):n&&(a={frames:[{filename:n,lineno:i,in_app:!0}]}),this._globalOptions.ignoreUrls.test&&this._globalOptions.ignoreUrls.test(n))||this._globalOptions.whitelistUrls.test&&!this._globalOptions.whitelistUrls.test(n)||(null==(r=(s=v({exception:{values:[{type:e,value:t,stacktrace:a}]},transaction:n},o)).exception.values[0]).type&&""===r.value&&(r.value="Unrecoverable error caught"),!s.exception.mechanism&&s.mechanism&&(s.exception.mechanism=s.mechanism,delete s.mechanism),s.exception.mechanism=v({type:"generic",handled:!0},s.exception.mechanism||{}),this._send(s))},_trimPacket:function(e){var t=this._globalOptions.maxMessageLength,n=(e.message&&(e.message=b(e.message,t)),e.exception&&((n=e.exception.values[0]).value=b(n.value,t)),e.request);return n&&(n.url&&(n.url=b(n.url,this._globalOptions.maxUrlLength)),n.Referer)&&(n.Referer=b(n.Referer,this._globalOptions.maxUrlLength)),e.breadcrumbs&&e.breadcrumbs.values&&this._trimBreadcrumbs(e.breadcrumbs),e},_trimBreadcrumbs:function(e){for(var t,n,i=["to","from","url"],r=0;r<e.values.length;++r)if((n=e.values[r]).hasOwnProperty("data")&&u(n.data)&&!w(n.data)){for(var o=v({},n.data),a=0;a<i.length;++a)o.hasOwnProperty(t=i[a])&&o[t]&&(o[t]=b(o[t],this._globalOptions.maxUrlLength));e.values[r].data=o}},_getHttpData:function(){var e;if(this._hasNavigator||this._hasDocument)return e={},this._hasNavigator&&D.userAgent&&(e.headers={"User-Agent":D.userAgent}),L.location&&L.location.href&&(e.url=L.location.href),this._hasDocument&&N.referrer&&(e.headers||(e.headers={}),e.headers.Referer=N.referrer),e},_resetBackoff:function(){this._backoffDuration=0,this._backoffStart=null},_shouldBackoff:function(){return this._backoffDuration&&M()-this._backoffStart<this._backoffDuration},_isRepeatData:function(e){var t=this._lastData;return!(!t||e.message!==t.message||e.transaction!==t.transaction)&&(e.stacktrace||t.stacktrace?R(e.stacktrace,t.stacktrace):!e.exception&&!t.exception||E(e.exception,t.exception))},_setBackoffState:function(e){if(!this._shouldBackoff()){var t,n=e.status;if(400===n||401===n||429===n){try{t=A()?e.headers.get("Retry-After"):e.getResponseHeader("Retry-After"),t=1e3*parseInt(t,10)}catch(e){}this._backoffDuration=t||2*this._backoffDuration||1e3,this._backoffStart=M()}}},_send:function(t){var e=this._globalOptions,n={project:this._globalProject,logger:e.logger,platform:"javascript"},i=this._getHttpData();i&&(n.request=i),t.trimHeadFrames&&delete t.trimHeadFrames,(t=v(n,t)).tags=v(v({},this._globalContext.tags),t.tags),t.extra=v(v({},this._globalContext.extra),t.extra),t.extra["session:duration"]=M()-this._startTime,this._breadcrumbs&&0<this._breadcrumbs.length&&(t.breadcrumbs={values:[].slice.call(this._breadcrumbs,0)}),this._globalContext.user&&(t.user=this._globalContext.user),e.environment&&(t.environment=e.environment),e.release&&(t.release=e.release),e.serverName&&(t.server_name=e.serverName),t=this._sanitizeData(t),Object.keys(t).forEach(function(e){null!=t[e]&&""!==t[e]&&!g(t[e])||delete t[e]}),!(t=p(e.dataCallback)?e.dataCallback(t)||t:t)||g(t)||p(e.shouldSendCallback)&&!e.shouldSendCallback(t)||(this._shouldBackoff()?this._logDebug("warn","Raven dropped error due to backoff: ",t):("number"!=typeof e.sampleRate||Math.random()<e.sampleRate)&&this._sendProcessedPayload(t))},_sanitizeData:function(e){return $(e,this._globalOptions.sanitizeKeys)},_getUuid:function(){return S()},_sendProcessedPayload:function(t,n){var e,i,r,o=this,a=this._globalOptions;this.isSetup()&&(t=this._trimPacket(t),!this._globalOptions.allowDuplicates&&this._isRepeatData(t)?this._logDebug("warn","Raven dropped repeat event: ",t):(this._lastEventId=t.event_id||(t.event_id=this._getUuid()),this._lastData=t,this._logDebug("debug","Raven about to send:",t),e={sentry_version:"7",sentry_client:"raven-js/"+this.VERSION,sentry_key:this._globalKey},this._globalSecret&&(e.sentry_secret=this._globalSecret),i=t.exception&&t.exception.values[0],this._globalOptions.autoBreadcrumbs&&this._globalOptions.autoBreadcrumbs.sentry&&this.captureBreadcrumb({category:"sentry",message:i?(i.type?i.type+": ":"")+i.value:t.message,event_id:t.event_id,level:t.level||"error"}),r=this._globalEndpoint,(a.transport||this._makeRequest).call(this,{url:r,auth:e,data:t,options:a,onSuccess:function(){o._resetBackoff(),o._triggerEvent("success",{data:t,src:r}),n&&n()},onError:function(e){o._logDebug("error","Raven transport failed to send: ",e),e.request&&o._setBackoffState(e.request),o._triggerEvent("failure",{data:t,src:r}),e=e||new Error("Raven send failed (no additional details provided)"),n&&n(e)}})))},_makeRequest:function(n){var e,t=n.url+"?"+F(n.auth),i=null,r={};if(n.options.headers&&(i=this._evaluateHash(n.options.headers)),n.options.fetchParameters&&(r=this._evaluateHash(n.options.fetchParameters)),A())return r.body=a(n.data),e=v({},this._fetchDefaults),e=v(e,r),i&&(e.headers=i),L.fetch(t,e).then(function(e){var t;e.ok?n.onSuccess&&n.onSuccess():((t=new Error("Sentry error code: "+e.status)).request=e,n.onError&&n.onError(t))}).catch(function(){n.onError&&n.onError(new Error("Sentry error code: network unavailable"))});var o=L.XMLHttpRequest&&new L.XMLHttpRequest;o&&("withCredentials"in o||"undefined"!=typeof XDomainRequest)&&("withCredentials"in o?o.onreadystatechange=function(){var e;4===o.readyState&&(200===o.status?n.onSuccess&&n.onSuccess():n.onError&&((e=new Error("Sentry error code: "+o.status)).request=o,n.onError(e)))}:(o=new XDomainRequest,t=t.replace(/^https?:/,""),n.onSuccess&&(o.onload=n.onSuccess),n.onError&&(o.onerror=function(){var e=new Error("Sentry error code: XDomainRequest");e.request=o,n.onError(e)})),o.open("POST",t),i&&y(i,function(e,t){o.setRequestHeader(e,t)}),o.send(a(n.data)))},_evaluateHash:function(e){var t,n,i={};for(t in e)e.hasOwnProperty(t)&&(n=e[t],i[t]="function"==typeof n?n():n);return i},_logDebug:function(e){this._originalConsoleMethods[e]&&(this.debug||this._globalOptions.debug)&&Function.prototype.apply.call(this._originalConsoleMethods[e],this._originalConsole,[].slice.call(arguments,1))},_mergeContext:function(e,t){n(t)?delete this._globalContext[e]:this._globalContext[e]=v(this._globalContext[e]||{},t)}}).setUser=B.prototype.setUserContext,B.prototype.setReleaseContext=B.prototype.setRelease,W.exports=B}.call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{1:1,2:2,5:5,6:6,7:7,8:8}],4:[function(o,a,e){!function(e){var t=o(3),n="undefined"!=typeof window?window:void 0!==e?e:"undefined"!=typeof self?self:{},i=n.Raven,r=new t;r.noConflict=function(){return n.Raven=i,r},r.afterLoad(),a.exports=r,a.exports.Client=t}.call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{3:3}],5:[function(g,y,e){!function(e){var o=g(7),n="undefined"!=typeof window?window:void 0!==e?e:"undefined"!=typeof self?self:{};function r(e){return void 0===e}function a(e){return"[object Object]"===Object.prototype.toString.call(e)}function l(e){return"[object String]"===Object.prototype.toString.call(e)}function s(e){return"[object Array]"===Object.prototype.toString.call(e)}function t(){if(!("fetch"in n))return!1;try{return new Headers,new Request(""),new Response,!0}catch(e){return!1}}function i(e,t){var n,i;if(r(e.length))for(n in e)d(e,n)&&t.call(null,n,e[n]);else if(i=e.length)for(n=0;n<i;n++)t.call(null,n,e[n])}function c(e,t){if("number"!=typeof t)throw new Error("2nd argument to `truncate` function should be a number");return"string"!=typeof e||0===t||e.length<=t?e:e.substr(0,t)+"…"}function d(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function u(e){for(var t,n=[],i=0,r=e.length;i<r;i++)l(t=e[i])?n.push(t.replace(/([.*+?^=!:${}()|\[\]\/\\])/g,"\\$1")):t&&t.source&&n.push(t.source);return new RegExp(n.join("|"),"i")}function h(e){var t,n,i,r,o=[];if(!e||!e.tagName)return"";if(o.push(e.tagName.toLowerCase()),e.id&&o.push("#"+e.id),(t=e.className)&&l(t))for(n=t.split(/\s+/),s=0;s<n.length;s++)o.push("."+n[s]);for(var a=["type","name","title","alt"],s=0;s<a.length;s++)(r=e.getAttribute(i=a[s]))&&o.push("["+i+'="'+r+'"]');return o.join("")}function p(e,t){if(!!e^!!t)return!1;var n,i,r=e.frames,o=t.frames;if(void 0===r||void 0===o)return!1;if(r.length!==o.length)return!1;for(var a=0;a<r.length;a++)if(n=r[a],i=o[a],n.filename!==i.filename||n.lineno!==i.lineno||n.colno!==i.colno||n.function!==i.function)return!1;return!0}function f(e){return e=JSON.stringify(e),~-encodeURI(e).split(/%..|./).length}function m(e){var t;return"string"==typeof e?c(e,40):"number"==typeof e||"boolean"==typeof e||void 0===e?e:"[object Object]"===(t=Object.prototype.toString.call(e))?"[Object]":"[object Array]"===t?"[Array]":"[object Function]"===t?e.name?"[Function: "+e.name+"]":"[Function]":e}y.exports={isObject:function(e){return"object"==typeof e&&null!==e},isError:function(e){switch(Object.prototype.toString.call(e)){case"[object Error]":case"[object Exception]":case"[object DOMException]":return!0;default:return e instanceof Error}},isErrorEvent:function(e){return"[object ErrorEvent]"===Object.prototype.toString.call(e)},isDOMError:function(e){return"[object DOMError]"===Object.prototype.toString.call(e)},isDOMException:function(e){return"[object DOMException]"===Object.prototype.toString.call(e)},isUndefined:r,isFunction:function(e){return"function"==typeof e},isPlainObject:a,isString:l,isArray:s,isEmptyObject:function(e){if(!a(e))return!1;for(var t in e)if(e.hasOwnProperty(t))return!1;return!0},supportsErrorEvent:function(){try{return new ErrorEvent(""),!0}catch(e){return!1}},supportsDOMError:function(){try{return new DOMError(""),!0}catch(e){return!1}},supportsDOMException:function(){try{return new DOMException(""),!0}catch(e){return!1}},supportsFetch:t,supportsReferrerPolicy:function(){if(!t())return!1;try{return new Request("pickleRick",{referrerPolicy:"origin"}),!0}catch(e){return!1}},supportsPromiseRejectionEvent:function(){return"function"==typeof PromiseRejectionEvent},wrappedCallback:function(n){return function(e,t){return e=n(e)||e,t&&t(e)||e}},each:i,objectMerge:function(n,e){return e&&i(e,function(e,t){n[e]=t}),n},truncate:c,objectFrozen:function(e){return!!Object.isFrozen&&Object.isFrozen(e)},hasKey:d,joinRegExp:u,urlencode:function(e){var n=[];return i(e,function(e,t){n.push(encodeURIComponent(e)+"="+encodeURIComponent(t))}),n.join("&")},uuid4:function(){var e,t=n.crypto||n.msCrypto;return!r(t)&&t.getRandomValues?(e=new Uint16Array(8),t.getRandomValues(e),e[3]=4095&e[3]|16384,e[4]=16383&e[4]|32768,(t=function(e){for(var t=e.toString(16);t.length<4;)t="0"+t;return t})(e[0])+t(e[1])+t(e[2])+t(e[3])+t(e[4])+t(e[5])+t(e[6])+t(e[7])):"xxxxxxxxxxxx4xxxyxxxxxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})},htmlTreeAsString:function(e){for(var t,n=[],i=0,r=0,o=" > ".length;e&&i++<5&&!("html"===(t=h(e))||1<i&&80<=r+n.length*o+t.length);)n.push(t),r+=t.length,e=e.parentNode;return n.reverse().join(" > ")},htmlElementAsString:h,isSameException:function(e,t){var n,i;return!(!!e^!!t||(e=e.values[0],t=t.values[0],e.type!==t.type)||e.value!==t.value||(n=e.stacktrace,i=t.stacktrace,r(n)&&r(i)))&&p(e.stacktrace,t.stacktrace)},isSameStacktrace:p,parseUrl:function(e){var t,n;return"string"!=typeof e?{}:(t=(e=e.match(/^(([^:\/?#]+):)?(\/\/([^\/?#]*))?([^?#]*)(\?([^#]*))?(#(.*))?$/))[6]||"",n=e[8]||"",{protocol:e[2],host:e[4],path:e[5],relative:e[5]+t+n})},fill:function(e,t,n,i){var r;null!=e&&(r=e[t],e[t]=n(r),e[t].__raven__=!0,e[t].__orig__=r,i)&&i.push([e,t,r])},safeJoin:function(e,t){if(!s(e))return"";for(var n=[],i=0;i<e.length;i++)try{n.push(String(e[i]))}catch(e){n.push("[value cannot be serialized]")}return n.join(t)},serializeException:function e(t,n,i){if(!a(t))return t;i="number"!=typeof(n="number"!=typeof n?3:n)?51200:i;var r=function n(i,r){return 0===r?m(i):a(i)?Object.keys(i).reduce(function(e,t){return e[t]=n(i[t],r-1),e},{}):Array.isArray(i)?i.map(function(e){return n(e,r-1)}):m(i)}(t,n);return f(o(r))>i?e(t,n-1):r},serializeKeysForMessage:function(e,t){if("number"==typeof e||"string"==typeof e)return e.toString();if(Array.isArray(e)){if(0===(e=e.filter(function(e){return"string"==typeof e})).length)return"[object has no keys]";if(e[0].length>=(t="number"!=typeof t?40:t))return e[0];for(var n=e.length;0<n;n--){var i=e.slice(0,n).join(", ");if(!(i.length>t))return n===e.length?i:i+"…"}}return""},sanitize:function(t,e){if(!s(e)||s(e)&&0===e.length)return t;var n,r=u(e);try{n=JSON.parse(o(t))}catch(e){return t}return function n(i){return s(i)?i.map(n):a(i)?Object.keys(i).reduce(function(e,t){return r.test(t)?e[t]="********":e[t]=n(i[t]),e},{}):i}(n)}}}.call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{7:7}],6:[function(x,C,e){!function(e){var c,t,r,o,a,d,u=x(5),h={collectWindowErrors:!0,debug:!1},n="undefined"!=typeof window?window:void 0!==e?e:"undefined"!=typeof self?self:{},s=[].slice,p=/^(?:[Uu]ncaught (?:exception: )?)?(?:((?:Eval|Internal|Range|Reference|Syntax|Type|URI|)Error): )?(.*)$/;function f(){return"undefined"==typeof document||null==document.location?"":document.location.href}function m(e,t){var n=null;if(!t||h.collectWindowErrors){for(var i in r)if(r.hasOwnProperty(i))try{r[i].apply(null,[e].concat(s.call(arguments,2)))}catch(e){n=e}if(n)throw n}}function i(e,t,n,i,r){var o,a,s=u.isErrorEvent(r)?r.error:r,l=u.isErrorEvent(e)?e.message:e;return d?(h.computeStackTrace.augmentStackTraceWithInitialElement(d,t,n,l),g()):s&&u.isError(s)?m(h.computeStackTrace(s),!0):(s={url:t,line:n,column:i},o=void 0,"[object String]"==={}.toString.call(l)&&(a=l.match(p))&&(o=a[1],l=a[2]),s.func="?",m({name:o,message:l,url:f(),stack:[s]},!0)),!!c&&c.apply(this,arguments)}function g(){var e=d,t=o;a=d=o=null,m.apply(null,[e,!1].concat(t))}function l(e,t){var n=s.call(arguments,1);if(d){if(a===e)return;g()}var i=h.computeStackTrace(e);if(d=i,a=e,o=n,setTimeout(function(){a===e&&g()},i.incomplete?2e3:0),!1!==t)throw e}function y(e){if(void 0!==e.stack&&e.stack){for(var t,n,i=/^\s*at (?:(.*?) ?\()?((?:file|https?|blob|chrome-extension|native|eval|webpack|<anonymous>|[a-z]:|\/).*?)(?::(\d+))?(?::(\d+))?\)?\s*$/i,r=/^\s*at (?:((?:\[object object\])?.+) )?\(?((?:file|ms-appx(?:-web)|https?|webpack|blob):.*?):(\d+)(?::(\d+))?\)?\s*$/i,o=/^\s*(.*?)(?:\((.*?)\))?(?:^|@)((?:file|https?|blob|chrome|webpack|resource|moz-extension).*?:\/.*?|\[native code\]|[^@]*bundle)(?::(\d+))?(?::(\d+))?\s*$/i,a=/(\S+) line (\d+)(?: > eval line \d+)* > eval/i,s=/\((\S*)(?::(\d+))(?::(\d+))\)/,l=e.stack.split("\n"),c=[],d=(/^(.*) is undefined$/.exec(e.message),0),u=l.length;d<u;++d){if(n=i.exec(l[d])){var h=n[2]&&0===n[2].indexOf("native");n[2]&&0===n[2].indexOf("eval")&&(t=s.exec(n[2]))&&(n[2]=t[1],n[3]=t[2],n[4]=t[3]),h={url:h?null:n[2],func:n[1]||"?",args:h?[n[2]]:[],line:n[3]?+n[3]:null,column:n[4]?+n[4]:null}}else if(n=r.exec(l[d]))h={url:n[2],func:n[1]||"?",args:[],line:+n[3],column:n[4]?+n[4]:null};else{if(!(n=o.exec(l[d])))continue;n[3]&&-1<n[3].indexOf(" > eval")&&(t=a.exec(n[3]))?(n[3]=t[1],n[4]=t[2],n[5]=null):0!==d||n[5]||void 0===e.columnNumber||(c[0].column=e.columnNumber+1),h={url:n[3],func:n[1]||"?",args:n[2]?n[2].split(","):[],line:n[4]?+n[4]:null,column:n[5]?+n[5]:null}}!h.func&&h.line&&(h.func="?"),h.url&&"blob:"===h.url.substr(0,5)&&((n=new XMLHttpRequest).open("GET",h.url,!1),n.send(null),200===n.status)&&(n=(n.responseText||"").slice(-300).match(/\/\/# sourceMappingURL=(.*)$/))&&("~"===(n=n[1]).charAt(0)&&(n=("undefined"==typeof document||null==document.location?"":document.location.origin||document.location.protocol+"//"+document.location.hostname+(document.location.port?":"+document.location.port:""))+n.slice(1)),h.url=n.slice(0,-4)),c.push(h)}return c.length?{name:e.name,message:e.message,url:f(),stack:c}:null}}function v(e,t,n,i){t={url:t,line:n};if(t.url&&t.line){if(e.incomplete=!1,t.func||(t.func="?"),0<e.stack.length&&e.stack[0].url===t.url){if(e.stack[0].line===t.line)return!1;if(!e.stack[0].line&&e.stack[0].func===t.func)return e.stack[0].line=t.line,!1}return e.stack.unshift(t),e.partial=!0}return!(e.incomplete=!0)}function b(e,t){for(var n,i,r=/function\s+([_$a-zA-Z\xA0-\uFFFF][_$a-zA-Z0-9\xA0-\uFFFF]*)?\s*\(/i,o=[],a={},s=!1,l=b.caller;l&&!s;l=l.caller)if(l!==w&&l!==h.report){if(i={url:null,func:"?",line:null,column:null},l.name?i.func=l.name:(n=r.exec(l.toString()))&&(i.func=n[1]),void 0===i.func)try{i.func=n.input.substring(0,n.input.indexOf("{"))}catch(e){}a[""+l]?s=!0:a[""+l]=!0,o.push(i)}t&&o.splice(0,t);t={name:e.name,message:e.message,url:f(),stack:o};return v(t,e.sourceURL||e.fileName,e.line||e.lineNumber,e.message||e.description),t}function w(e,t){var n=null;t=null==t?0:+t;try{if(n=y(e))return n}catch(e){if(h.debug)throw e}try{if(n=b(e,t+1))return n}catch(e){if(h.debug)throw e}return{name:e.name,message:e.message,url:f()}}h.report=(r=[],d=a=o=null,l.subscribe=function(e){t||(c=n.onerror,n.onerror=i,t=!0),r.push(e)},l.unsubscribe=function(e){for(var t=r.length-1;0<=t;--t)r[t]===e&&r.splice(t,1)},l.uninstall=function(){t&&(n.onerror=c,t=!1,c=void 0),r=[]},l),h.computeStackTrace=(w.augmentStackTraceWithInitialElement=v,w.computeStackTraceFromStackProp=y,w),C.exports=h}.call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{5:5}],7:[function(e,t,n){function d(e,t){for(var n=0;n<e.length;++n)if(e[n]===t)return n;return-1}function r(a,s){var l=[],c=[];return null==s&&(s=function(e,t){return l[0]===t?"[Circular ~]":"[Circular ~."+c.slice(0,d(l,t)).join(".")+"]"}),function(e,t){var n;{if(0<l.length?(~(n=d(l,this))?l.splice(n+1):l.push(this),~n?c.splice(n,1/0,e):c.push(e),~d(l,t)&&(t=s.call(this,e,t))):l.push(t),null!=a)return a.call(this,e,t);if(t instanceof Error){var i=t,r,o={stack:i.stack,message:i.message,name:i.name};for(r in i)Object.prototype.hasOwnProperty.call(i,r)&&(o[r]=i[r]);return o}return t}}}(n=t.exports=function(e,t,n,i){return JSON.stringify(e,r(t,i),n)}).getSerialize=r},{}],8:[function(e,t,n){function u(e,t){var n=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(n>>16)<<16|65535&n}function s(e,t,n,i,r,o){return u((t=u(u(t,e),u(i,o)))<<r|t>>>32-r,n)}function h(e,t,n,i,r,o,a){return s(t&n|~t&i,e,t,r,o,a)}function p(e,t,n,i,r,o,a){return s(t&i|n&~i,e,t,r,o,a)}function f(e,t,n,i,r,o,a){return s(t^n^i,e,t,r,o,a)}function m(e,t,n,i,r,o,a){return s(n^(t|~i),e,t,r,o,a)}function a(e,t){e[t>>5]|=128<<t%32,e[14+(t+64>>>9<<4)]=t;for(var n,i,r,o,a=1732584193,s=-271733879,l=-1732584194,c=271733878,d=0;d<e.length;d+=16)a=h(n=a,i=s,r=l,o=c,e[d],7,-680876936),c=h(c,a,s,l,e[d+1],12,-389564586),l=h(l,c,a,s,e[d+2],17,606105819),s=h(s,l,c,a,e[d+3],22,-1044525330),a=h(a,s,l,c,e[d+4],7,-176418897),c=h(c,a,s,l,e[d+5],12,1200080426),l=h(l,c,a,s,e[d+6],17,-1473231341),s=h(s,l,c,a,e[d+7],22,-45705983),a=h(a,s,l,c,e[d+8],7,1770035416),c=h(c,a,s,l,e[d+9],12,-1958414417),l=h(l,c,a,s,e[d+10],17,-42063),s=h(s,l,c,a,e[d+11],22,-1990404162),a=h(a,s,l,c,e[d+12],7,1804603682),c=h(c,a,s,l,e[d+13],12,-40341101),l=h(l,c,a,s,e[d+14],17,-1502002290),a=p(a,s=h(s,l,c,a,e[d+15],22,1236535329),l,c,e[d+1],5,-165796510),c=p(c,a,s,l,e[d+6],9,-1069501632),l=p(l,c,a,s,e[d+11],14,643717713),s=p(s,l,c,a,e[d],20,-373897302),a=p(a,s,l,c,e[d+5],5,-701558691),c=p(c,a,s,l,e[d+10],9,38016083),l=p(l,c,a,s,e[d+15],14,-660478335),s=p(s,l,c,a,e[d+4],20,-405537848),a=p(a,s,l,c,e[d+9],5,568446438),c=p(c,a,s,l,e[d+14],9,-1019803690),l=p(l,c,a,s,e[d+3],14,-187363961),s=p(s,l,c,a,e[d+8],20,1163531501),a=p(a,s,l,c,e[d+13],5,-1444681467),c=p(c,a,s,l,e[d+2],9,-51403784),l=p(l,c,a,s,e[d+7],14,1735328473),a=f(a,s=p(s,l,c,a,e[d+12],20,-1926607734),l,c,e[d+5],4,-378558),c=f(c,a,s,l,e[d+8],11,-2022574463),l=f(l,c,a,s,e[d+11],16,1839030562),s=f(s,l,c,a,e[d+14],23,-35309556),a=f(a,s,l,c,e[d+1],4,-1530992060),c=f(c,a,s,l,e[d+4],11,1272893353),l=f(l,c,a,s,e[d+7],16,-155497632),s=f(s,l,c,a,e[d+10],23,-1094730640),a=f(a,s,l,c,e[d+13],4,681279174),c=f(c,a,s,l,e[d],11,-358537222),l=f(l,c,a,s,e[d+3],16,-722521979),s=f(s,l,c,a,e[d+6],23,76029189),a=f(a,s,l,c,e[d+9],4,-640364487),c=f(c,a,s,l,e[d+12],11,-421815835),l=f(l,c,a,s,e[d+15],16,530742520),a=m(a,s=f(s,l,c,a,e[d+2],23,-995338651),l,c,e[d],6,-198630844),c=m(c,a,s,l,e[d+7],10,1126891415),l=m(l,c,a,s,e[d+14],15,-1416354905),s=m(s,l,c,a,e[d+5],21,-57434055),a=m(a,s,l,c,e[d+12],6,1700485571),c=m(c,a,s,l,e[d+3],10,-1894986606),l=m(l,c,a,s,e[d+10],15,-1051523),s=m(s,l,c,a,e[d+1],21,-2054922799),a=m(a,s,l,c,e[d+8],6,1873313359),c=m(c,a,s,l,e[d+15],10,-30611744),l=m(l,c,a,s,e[d+6],15,-1560198380),s=m(s,l,c,a,e[d+13],21,1309151649),a=m(a,s,l,c,e[d+4],6,-145523070),c=m(c,a,s,l,e[d+11],10,-1120210379),l=m(l,c,a,s,e[d+2],15,718787259),s=m(s,l,c,a,e[d+9],21,-343485551),a=u(a,n),s=u(s,i),l=u(l,r),c=u(c,o);return[a,s,l,c]}function l(e){for(var t="",n=32*e.length,i=0;i<n;i+=8)t+=String.fromCharCode(e[i>>5]>>>i%32&255);return t}function c(e){var t=[];for(t[(e.length>>2)-1]=void 0,i=0;i<t.length;i+=1)t[i]=0;for(var n=8*e.length,i=0;i<n;i+=8)t[i>>5]|=(255&e.charCodeAt(i/8))<<i%32;return t}function i(e){for(var t,n="0123456789abcdef",i="",r=0;r<e.length;r+=1)t=e.charCodeAt(r),i+=n.charAt(t>>>4&15)+n.charAt(15&t);return i}function d(e){return unescape(encodeURIComponent(e))}function r(e){return l(a(c(e=d(e)),8*e.length))}function o(e,t){var n,e=d(e),t=d(t),i=c(e),r=[],o=[];for(r[15]=o[15]=void 0,16<i.length&&(i=a(i,8*e.length)),n=0;n<16;n+=1)r[n]=909522486^i[n],o[n]=1549556828^i[n];return e=a(r.concat(c(t)),512+8*t.length),l(a(o.concat(e),640))}t.exports=function(e,t,n){return t?n?o(t,e):i(o(t,e)):n?r(e):i(r(e))}},{}]},{},[4])(4)}),$__System.registerDynamic("51",["56"],!0,function(e,t,n){var a=this||self,o=e("56");function s(){var n=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=(n+16*Math.random())%16|0;return n=Math.floor(n/16),("x"==e?t:3&t|8).toString(16)})}function i(){this.sendInterval=-1,this.lastSend=0,this.initialized=!1}var l,r,c,d=()=>!window.debugMode&&File&&File.option&&File.option.sendAnonymousUsage,u=(i.prototype.record=function(e){try{e&&this.initialized&&((e="string"==typeof e?{message:e}:e).fromApp=!0,o.captureBreadcrumb(e),e.message)}catch(e){}},i.prototype.error=function(e,t){if(this.initialized)try{"string"==typeof e?o.captureMessage(e,t):o.captureException(e,t)}catch(e){}},i.prototype.sanitizeDom=function(e){var t="<dom>";return e?(e.nodeType!==e.ELEMENT_NODE?t+="[nodeType="+e.nodeType+"]":(t+=e.tagName,e.getAttribute("cid")&&(t=(t=(t+="[cid="+e.getAttribute("cid")+"]")+"[type="+e.getAttribute("mdtype")+"]")+"[class="+e.getAttribute("class")+"]")),t):t+"null"},i.prototype.assert=function(e){if(a.debugMode&&!e)throw new Error("assert fail")},i.prototype.fullValidate=function(e){if(a.debugMode||e){var e=File.editor.nodeMap.blocks.sortedFirst(),t=document.querySelector(`[cid="${e.cid}"]`);try{r(t,e)}catch(e){throw window.alert("error"),e}}function r(e,t){var n=e,i=t;if(e.previousElementSibling&&e.previousElementSibling.getAttribute("cid"))throw console.log(t),console.error(e),new Error("fullValidate fail under "+i.cid);for(;i;){if("table_row"==i.get("type")||"table_row"==i.get("type"))return;!function(e,t){var n=e.getAttribute("mdtype");if(n!=t.get("type")||e.getAttribute("cid")!=t.cid)throw console.log(t),console.error(e),new Error("fullValidate fail for "+t.cid);var i=t.getFirstChild();if(i)return r(e.querySelector(`[cid="${i.cid}"]`),i);if("list"==n||"list_item"==n||"blockquote"==n||"table"==n.substring(0,"table".length))throw new Error(`no children for ${n} `+t.cid);if(e.querySelector("[cid]"))throw console.log(t),console.error(e),new Error("fullValidate under for "+t.cid)}(n,i),i=i.get("after"),n=n.nextElementSibling}if(n)throw console.error(n),new Error("fullValidate fail for "+n.getAttribute("cid"))}},i.prototype.sanitizeData=function(e){var n;e&&(n=e.stacktrace||[],((e.exception||{}).values||[]).forEach(function(e,t){e&&(e.value&&(e.value=e.value.replace(/[^\s."'{]+\.(md|mmd|markdown|mdwn|txt|text)/g,"{filepath}")),e.stacktrace)&&e.stacktrace.frames&&(n=n.concat(e.stacktrace.frames))}),n.length)&&n.forEach(function(e){var t=-1;-1<(t=-1==(t=File.isNode?e.filename.lastIndexOf("typora://app"):t)?e.filename.lastIndexOf("TypeMark"):t)&&(e.filename=e.filename.substring(t).replace(/\\/g,"/").replace(/#[^.\/]*$/,"").replace("lib.asar","lib").replace(/^(typora:\/\/app\/typemark)\/(.+)$/,"http://typora/$2").replace(/([^\/:])(?:\/{2,})/g,"$1/"))})},i.prototype.install=function(){var n,i,r,e,t;!this.initialized&&window._options&&(n=this,t=window._options.buildTime,i=window._options.tooOldToReport,r=.1,e=new Date-t,isNaN(t)||(e>864e5*(File.option.devVersion?45:20)&&(i=!0),3456e5<e&&(r=.03),6048e5<e&&(r=.02),1296e6<e&&(r=.01),2592e6<e&&(r=.001)),File.option.devVersion&&(r=Math.min(.4,8*r)),t={autoBreadcrumbs:{xhr:!1,console:!1,location:!1,dom:!1},logger:"render",release:"<%= releaseHash %>"==window._releaseNo?void 0:window._releaseNo,sanitizeKeys:[]},window.debugMode||!window._options?t.instrument={tryCatch:!1}:(o.config("https://41af752e6d61480d85276af874a7f69b@sentry.typora.io/2",t).install(),o.setTagsContext({conversation:s()}),o.setShouldSendCallback(function(e){var t;return!(!File.isMac&&i||!d()||File.option.hasUpdates||(-1<(t=e.message||"").indexOf("EPERM")||-1<t.indexOf("ENOENT"))&&-1<t.indexOf("Typora\\draftsRecover"))&&(new Date-n.lastSend>n.sendInterval&&(Math.random()<r||"detect data lost"==e.message)||void 0)}),o.setDataCallback(function(e){try{var t;return(n.lastSend=new Date,e)?(e.request&&(e.request.url="http://typora/"),e.mechanism&&delete e.mechanism,e.transaction&&(t=e.transaction.split(/[\/\\]/)||[],e.transaction=t.last().replace(/[#][^.\/]*$/,""),2<=t.length)&&(e.transaction=t[t.length-2]+"/"+e.transaction),e.exception&&n.sanitizeData(e),"detect data lost"!=e.message&&"[logic error]"!=e.message&&e.breadcrumbs&&(e.breadcrumbs.values=e.breadcrumbs.values.filter(e=>"exeCommand"!=e.fromSource)),e):void 0}catch(e){}return e}),o.setBreadcrumbCallback(function(e){try{return e.fromApp||"sentry"==e.category?(delete e.fromApp,e):!1}catch(e){}}),o.setTagsContext({appVersion:File.option.appVersion,instance:File.option.instance,arch:window.process?process.arch:"x64",lang:File.option.userLocale}),o.setExtraContext({setting:{indentSize:File.option.indentSize,mountFolder:File.mountFolder_,isFocusMode:File.option.isFocusMode,isTypeWriterMode:File.option.isTypeWriterMode,ignoreLineBreak:File.option.ignoreLineBreak,enableAutoSave:File.option.enableAutoSave,enableDiagram:File.option.enableDiagram,enableInlineMath:File.option.enableInlineMath,theme:File.option.curTheme,strictMarkdown:File.option.strictMarkdown,zoomFactor:File.option.zoomFactor,smartQuote:File.option.smartQuote}}),o.setUserContext({id:File.option.uuid}),window.reqnode&&window.debugMode&&(process.traceDeprecation=!0),window.onerror=function(e,t,n,i,r){r?(console.sendError&&console.sendError(r),r.message):console.sendError&&console.sendError(t+":"+n+"\n"+e)},this.initialized=!0,this.record("renderer process start")))},i.prototype.processDom=function(e){try{var t=e.clone();return t.find("[cid]").removeAttr("class").removeAttr("contentediable").filter(function(){return!this.querySelector("[cid]")}).html(function(){return this.getAttribute("cid")}),t.html()}catch(e){i.error(e)}},i.prototype.buildNodeSnip=function(){return File.editor.nodeMap.blocks.map(function t(e){var n;return e.isDeleted()?"[node deleted]":(n=[],e.get("children").sortedForEach(e=>{n.push(t(e))}),{cid:e.cid,type:e.get("type"),children:n})})},new Date),e=(i.prototype.buildExtraDebugInfo=async function(){var e,t,n=this.processDom($("#write"));try{e=this.buildNodeSnip()}catch(e){t=e.stack}if(File.isNode)try{var i=a.process,r=await Promise.all([i.getSystemMemoryInfo(),i.getProcessMemoryInfo(),i.getBlinkMemoryInfo()]),o={system:r[0],process:r[1],blink:r[2]}}catch(e){t=t+"\n"+e.stack}return{htmlSnip:n,nodeSnip:e,memory:o,enableAutoSave:File.option.enableAutoSave,useIME:File.editor.useIMEKeyboard,inBusyMode:File.inBusyMode,timePass:new Date-u,msg:t}},i.prototype.reportLogicError=function(e,t){var n=new Error("[logic error]");n.stack=e+"\t"+n.stack.split("\n").join("\n"),console.sendError("[logic error] "+e,!0),this.buildExtraDebugInfo().then(e=>{e.detail=t,this.error(n,{extra:e})}),File.showDataLostError()},new i);t.Reporter=e,window.Reporter=e;const h="4eeda6df022d46e1ab4d602858fd58e3";function p(){this.pinpoint=null,this.buffers=[],this.loadLib=new Promise(e=>{$.getScript(window.debugMode?"./lib/aws-sdk.js":window.reqnode?"./lib.asar/aws-sdk.min.js":"./lib/aws-sdk.min.js",e)})}var f=new Date,m=(p.prototype.install=function(){l=File.option.uuid,r=File.option.instance,l&&r&&(c=s(),this.loadLib.then(()=>{var e;d()&&(e=new AWS.CognitoIdentityCredentials({IdentityPoolId:"us-west-2:146e5a95-002f-46c1-b09e-05b32fc3280b"}),AWS.config=new AWS.Config({credentials:e,region:"us-west-2"}),this.pinpoint=new AWS.Pinpoint({apiVersion:"2016-12-01"}),this.start(),this.flush())}),File.isMac)&&bridge.registerHandler("Analytics.record",(e,t)=>{this.record(e[0],e[1]),t&&t()})},()=>({Id:c,StartTimestamp:f.toISOString(),Duration:new Date-f})),g=n=>{var i;return n?(i={},Object.keys(n).forEach(e=>{var t=n[e];"string"==typeof t?i[e]=[t]:t instanceof Array&&(i[e]=t)}),i):{}};p.prototype.start=async function(){var e=(File.option.userLocale||File.option.locale||"").replace("-","_"),e=("Base"==e&&(e="en_US"),{AppVersion:File.option.appVersion,Locale:e,Platform:"macOS"}),t=(window.reqnode?(JSBridge.invoke("setting.fetchAnalytics").then(e=>{e=JSON.parse(e);this.flush(e)}),e.Platform=process.platform):bridge.callHandler("setting.fetchAnalytics",{},e=>{this.flush(e)}),e.Make=await async function(e){var n=e,t=window.navigator.userAgent;if("win32"==e)n="Windows",-1<t.indexOf("Windows NT 10")?n=n+" 10 "+("x64"===process.arch?"(64)":"(32)"):-1<t.indexOf("Windows NT 6.3")?n=n+" 8.1 "+("x64"===process.arch?"(64)":"(32)"):-1<t.indexOf("Windows NT 6.2")?n=n+" 8 "+("x64"===process.arch?"(64)":"(32)"):-1<t.indexOf("Windows NT 6.1")&&(n=n+" 7 "+("x64"===process.arch?"(64)":"(32)"));else if("linux"===e)try{let t=reqnode("getos");n=await new Promise(e=>{t(function(e,t){return e?"Linux":t.dist})})}catch(e){n="Linux"}else"macOS"===e&&(n="macOS "+((/Mac OS X (10_[0-9_]+)/.exec(t)||[])[1]||"").replace(/_/,".").replace(/_.+/,""));return n}(e.Platform),new Date),t={theme:File.option.curTheme,lastSeen:t.getUTCFullYear()+""+(t.getMonth()+1),majorVersion:File.option.appVersion.replace(/\.[^.]+$/,"")},n=File.isWin?"win":File.isMac?"mac":"linux";t[n+"Arch"]=File.option.arch,t.releaseType=File.option.devVersion?"dev":"stable",File.option.devVersion?(t[n+"DevHasLicense"]=File.option.hasLicense?"YES":"NO",t[n+"HasLicense"]="undefined",t.StableHasLicense="undefined",t.DevHasLicense=File.option.hasLicense?"YES":"NO"):(t[n+"HasLicense"]=File.option.hasLicense?"YES":"NO",t[n+"DevHasLicense"]="undefined",t.StableHasLicense=File.option.hasLicense?"YES":"NO",t.DevHasLicense="undefined"),t.hasLicense=File.option.hasLicense?"YES":"NO",File.option.devVersion||(File.option.hasLicense?t.upgradePolicy=File.option.enableAutoUpdate?File.option.autoUpdateToDev?"dev":"stable":"off":t.upgradePolicy="none"),File.option.devVersion||File.isLinux||(t.trail=File.option.hasLicense?"ACTIVATED":"TRAIL"),this.updateContext(t,e)},p.prototype.updateContext=function(e,t,n){try{var i;d()&&(this.pinpoint?(i={ApplicationId:h,EndpointId:l,EndpointRequest:((e,t,n)=>{e={Address:l,Attributes:g(e),ChannelType:"APNS",EffectiveDate:(new Date).toISOString(),EndpointStatus:"ACTIVE",OptOut:"ALL",User:{UserAttributes:{},UserId:l}};return n&&(e.Location=n),t&&(e.Demographic=t),e})(e,t,n)},this.pinpoint.updateEndpoint(i,function(e,t){e?console.warn(e,e.stack):window.debugMode})):this.buffers.push(["updateContext",e]))}catch(e){console.warn(e)}},p.prototype.record=function(e,t){try{var n;d()&&(this.pinpoint?((n={ApplicationId:h,EventsRequest:{BatchItem:{}}}).EventsRequest.BatchItem[l]={Endpoint:{}},n.EventsRequest.BatchItem[l].Events=(i=e,r=t,(o={})[s()]={EventType:i,Timestamp:(new Date).toISOString(),Attributes:Object.assign({},r),Session:m()},o),this.pinpoint.putEvents(n,function(e,t){e?console.warn(e,e.stack):window.debugMode})):this.buffers.push([e,t]))}catch(e){console.warn(e)}var i,r,o};var y=1,e=(p.prototype.updateLocation=function(){fetch("https://typora.io/api/endpoint").then(e=>{if(200===e.status)return e.text();throw new Error("wrong response status")}).then(e=>{e&&(e=window.atob(e).split(":"),this.updateContext({},null,{City:e[0],Region:e[1],Country:e[2]}))}).catch(e=>{this.updateContext({},null,{Country:"XX"}),setTimeout(this.updateLocation.bind(this),10*y*1e3),y*=4})},p.prototype.flush=function(e){try{if(d()&&this.pinpoint){for(var t of e||this.buffers)"updateContext"==t[0]?this.updateContext(t[1]):"updateLocation"==t[0]?this.updateLocation():this.record(t[0],t[1]);this.buffers=[]}}catch(t){console.warn(t)}},new p);t.Analytics=e,window.Analytics=e}),$__System.registerDynamic("47",["e","11","1b","13","2b","28","32","4f","48","53","33","54","50","34","52","55","51"],!0,function(e,t,n){"use strict";this||self;function i(){k&&F.editor.brush&&F.editor.brush.timerID&&F.isActiveWindow()&&k&&(k=!1,y.saveToRecover(F.editor.getMarkdown()))}var r,u=e("e"),o=e("11"),h=e("1b"),p=(h.SnapFlag,e("13")),l=(p.Node,p.TYPE,e("2b").safePromise,e("28")),c=e("32"),a=e("4f"),d=e("48"),s=e("53"),f=e("33"),m=e("54"),g=e("50"),y=e("34"),v=(e("52"),c.ChangeCounter),b=(c.ChangeType,e("55"),e("51").Reporter),e=["md","markdown","mmd","mkd","mdwn","mdown","mdx"],w={Markdown:"markdown",TextBundle:"textbundle",TextPack:"textpack"},x={OVERSIZE:"OVERSIZE",UNSUPPORTED:"UNSUPPORTED",OTHER_FILE:"OTHER_FILE",READ_FAIL:"READ_FAIL"},C=["mdtxt","mdtext","apib","rmarkdown","rmd","qmd","txt","text"].concat(e),F={FileSave:s,FileType:w,MarkdownFiles:e,SupportedTextFiles:C,SupportedFiles:C.concat([""]),activeWindow:!0,MAX_FILE_SIZE:2e6,option:a.DEFAULT_OPTIONS,needSaveState:!1,fileHasModified:!1,UNSUPPORTED_REASON:x,bundle:{filePath:null,originalPath:null,untitledId:+new Date,fileName:null,fileEncode:null,removed:!1,useCRLF:!1,unsupported:"",hasModified:!1,modifiedDate:null,lastSnapDate:null,savedContent:null,isLocked:!1,oversize:!1,fileMissingWhenOpen:!1,bundleFile:null,zip:null},draftsRecoverList:[],setDocumentState:function(e){var t=e["currentFilePath"];F.bundle.filePath==t?Object.assign(F.bundle,e):(F.bundle=e,F.bundle.filePath=t,F.isLocked=e.isLocked),delete F.bundle.currentFilePath,F.bundle.oversize?(F.bundle.unsupported=x.OVERSIZE,F.tryEnterOversize(null,!0)):F.exitOversize(),b.record("[File] setDocumentState File.filePath = "+o.hashCode(F.filePath))},readOption:a.readOption,setConvertSmartOnRender:a.setConvertSmartOnRender,setup:a.setup,shouldRemapPunctuation:a.shouldRemapPunctuation,setFinalNewline:a.setFinalNewline,setIndentFirstLine:a.setIndentFirstLine,setHideBrAndLineBreak:a.setHideBrAndLineBreak,setIgnoreLineBreak:a.setIgnoreLineBreak,setIndentSize:a.setIndentSize,setLineEnding:a.setLineEnding,setDefaultExtension:a.setDefaultExtension,getTextFile:f.getTextFile,setEditor:function(e){F.isLocked=F.isMac&&F.bundle.isLocked,F.editor=e,F.isMac||(F.changeCounter=new v)},isTextBundle:function(){return F.bundle.type===w.TextBundle},isTextPack:function(){return F.bundle.type===w.TextPack},onFileOpened:function(){if(F.isNode){try{reqnode("electron").ipcRenderer.send("addBackup",JSON.stringify({path:F.bundle.filePath,type:F.bundle.type,mountFolder:F.mountFolder_,encode:F.bundle.encode}),!1,!0)}catch(e){console.sendError(e)}F.needSaveState=!1}},recoverFromBackup:function(e){var n;return!!F.isNode&&!(!e||!e.content||(F.setLineEnding(e.useCRLF),F.bundle.filePath=e.path,F.bundle.fileEncode=e.encode,F.bundle.hasModified=!0,F.bundle.untitledId=e.untitledId,F.bundle.type=e.type,y.onFilePathUpdated(),F.setMountFolder(e.mountFolder),console.sendLog("recoverFromBackup"),F.editor.reset(e.content),F.editor.writingArea.focus(),F.updateChangeCount(c.ChangeType.NSChangeDone),e.path&&(F.editor.undo.endSnap(!0),(n=h.makeEmptyCommand()).tag="reload",n.redo.push(h.buildAllDoc(F.editor.nodeMap)),F.fs.readFile(e.path,e.encode||"utf8",function(e,t){e||(n.undo.push({type:"initSrc",src:t}),F.changeCounter.doneStack.unshift(c.ChangeType.NSChangeCleared),F.editor.undo.register(n,!0,void 0,!0))})),Analytics.record("newWindow",{type:"recoverBackup"}),0))},stillNeedToLoadFromDiskByNode:function(e,t){return!(!(t&&e&&t.changeCounter&&t.changeCounter.curState)||e==t.content&&(t.fileEncode||"utf8")==(F.bundle.fileEncode||"utf8"))},loadFile:async function(e,a,t){function s(e){var t=F.editor,n=t.selection;n&&n.lockNativeScroll(),F.decideLineEnding(e),t.reset(e),F.bundle.savedContent=e,t.writingArea.focus(),F.option.initAnchor?(t.tryOpenUrl(F.option.initAnchor),F.option.initAnchor=""):(F._scrollTopTimer=setTimeout(()=>{document.querySelector("content").scrollTop=0},1),null!=e&&e.trim().length?n&&(document.querySelector("content").scrollTop=0,n.jumpIntoElemEnd(u("[cid]").last()),document.querySelector("content").scrollTop=0):(u(t.sessionStr+">*:first-child").addClass("md-focus"),n&&n.jumpTop())),(F.isTextBundle()?f:m).recordUnusedAssets()}async function n(e){var{snap:e,filePath:i,backups:t,shouldReadFromDisk:n}=JSON.parse(e);if(!t||!F.recoverFromBackup(t)){Analytics.record("newWindow",{type:i?"openFile":"newFile"}),window._options.initMountFolder&&(F.setMountFolder(window._options.initMountFolder),window._options.initMountFolder=void 0);var r,t=null;try{t=i&&F.fs.statSync(i)||null}catch(e){t=null,"ENOENT"!=e.code||a?o(e):(d.handleFileNotExist(i),o(e,F.bundle.fileMissingWhenOpen=!0))}t?(t.isDirectory()?r=await f.loadFile(i):t.isFile()&&(r=/\.textpack$/.exec(i)?await m.loadFile(i):await async function(){var[e,t,n]=await F.readContentFrom(i);if(e)return F.bundle.fileEncode=n||"utf8",F.bundle.filePath=i,F.bundle.savedContent=t,F.bundle.modifiedDate=new Date,t;o(t)}()),y.onFilePathUpdated()):r="",F.stillNeedToLoadFromDiskByNode(r,e)&&(n=!0),(e||{}).nodeMap?F.restoreEditStateFromData(e,!1,!0,n,r):(s(r),JSBridge.invoke("document.setLastSync",F.bundle.modifiedDate)),F.onFileOpened()}function o(e,t){console.warn("onLoadFail "+F.bundle.filePath),t||(F.option.silentOpenFailure||(t=e.message||"",debugMode||(t=t.splits&&t.splits(/\n/)[0]||t),l.showErrorDialog("Failed to load file",t),F.editor&&F.editor.library&&F.editor.library.isFileTabShown()&&F.editor.library.refreshPanelCommand()),F.option.silentOpenFailure=!1),"ENOENT"==e.code?(y.onFilePathUpdated(),y.onFilePathRemoved()):(F.bundle.filePath&&(JSBridge.invoke("document.switchToUntitled",F.bundle.filePath),F.bundle.filePath=""),y.onFilePathUpdated())}}var i;F.draftsRecoverList=[],F.bundle={filePath:e,untitledId:+new Date},F._onInitParse=!0,F.editor.brush&&F.editor.brush.clearAndPause(),F.editor.library&&(F.editor.library.stopRename=!0),e||("textbundle"===F.option.defaultExtension&&(F.bundle.type="textbundle"),"textpack"===F.option.defaultExtension&&(F.bundle.type="textpack")),t=t||(a?await JSBridge.invoke("document.switchDocument",e):await JSBridge.invoke("document.loadData")),F.changeCounter&&F.changeCounter.reset(),F.editor.undo.reset(),F.editor.nodeMap.reset(!1,!0),editor.fences&&editor.fences.onLeaveDocument(),editor.mathInline&&editor.mathInline.onLeaveDocument(),F.isNode?await n(t):F.isMac?([e,t,i]=e=t,F.setDocumentState(i),y.onFilePathUpdated(),F.bundle.savedContent=e,F.bundle.modifiedDate=new Date,await(t&&t.nodeMap?!F.restoreEditStateFromData(t,!1,!0,t.isOutDated,e):(e.substr(0,100),!s(e)))):(y.onFilePathUpdated(),s("")),a&&(F.bundle.filePath||F.editor.undo.hasUndo()||F.updateChangeCount(c.ChangeType.NSChangeDone),F.inBusyMode||F.recoverPosOrScroll(),F.option.lastExport&&(F.option.lastExportNoOverwrite=!0),window._hasSwitchCallback=!1),F.editor.brush&&F.editor.brush.restart(),F.editor.library&&(F.editor.library.stopRename=!1),F.editor.library&&F.editor.library.markCurrentFile(),F._onInitParse=!1,F.freshMenu()},readContentFrom:async function(e,t){if(console.sendLog("readContentFrom "+e),F.isMac)return new Promise(t=>{bridge.callHandler("document.getContent",function(e){e=F.tryEnterOversize(e||""),t([!0,e])})});if(!F.isNode)return[!0,""];var n,i,r,o,a;try{return e?(r=(i=await Promise.all([F.fs.readFile(e),F.fs.stat(e)]))[0],o=i[1],a=t,F.bundle.modifiedDate=o.mtimeMs,r.length>F.MAX_FILE_SIZE?(F.bundle.unsupported=x.OVERSIZE,n="",F.tryEnterOversize(null,!0)):(F.exitOversize(),a=a||c.getItemInDB("[encode]"+e)||c.detectEncodeByNode(r),n=c.getContentFromBuffer(r,(a||"").replace("-bom",""),()=>{a=(a||"utf8").replace("-bom","")+"-bom"})),[!0,n,a,r]):[!0,""]}catch(e){return[!1,e]}},getContent:async function(e,t){if(!e&&F.isTextBundle())return f.quickGetContent(f.getTextFile());if(!e&&F.isTextPack())throw new Error("not implemented");var e=null==e?F.bundle.filePath:e,[t,n,,i]=await F.readContentFrom(e,t);if(!t)return t=n,n="",F.option.silentOpenFailure||(t=t.message||"",debugMode||(t=t.splits&&t.splits(/\n/)[0]||t),l.showErrorDialog("Failed to load file",t),F.editor&&F.editor.library&&F.editor.library.isFileTabShown()&&F.editor.library.refreshPanelCommand()),F.option.silentOpenFailure=!1,e&&JSBridge.invoke("document.switchToUntitled",e),"";try{y.saveToRecover(i)}catch(e){console.sendError(e,"skip")}return n},setContent:async function(e,t){F.bundle.unsupported||!F.isMac&&!t||await JSBridge.invoke("document.setContent",e)||F.editor.tryEnterBusyMode(e,!0)},getMountFolder:function(){return F.mountFolder_},setMountFolder:function(e,t){e=e&&e.replace(/[\/\\]$/,""),F.mountFolder_=e},sync:function(e,t,n,i){if(!F.bundle.unsupported&&F.editor){var r="";if(F.editor.sourceView&&F.editor.sourceView.inSourceMode)return r=F.editor.sourceView.cm.getValue(F.useCRLF?"\r\n":"\n"),n||F.setContent(r,t),F.isMac&&e&&(e=null==(e=i)?F.isDocumentEdited():e)&&F.editor.sourceView.onSave(),r;F.editor.store(null,!0),isInputComponent(document.activeElement)&&u(document.activeElement).trigger("change").trigger("inline-change");try{F.editor.autoRemoveUnholdable(!0)}catch(e){console.sendError(e,"warning")}i=F.editor.getMarkdown();return n||F.setContent(i,t),i}},isActiveWindow:function(){return F.activeWindow},validateContentForSave:d.validateContentForSave,tryRecoveryFromDom:d.tryRecoveryFromDom,showDataLostError:d.showDataLostError,isFileLoading:function(){return F._onInitParse||F._onFileSwitching||F.editor&&F.editor.library&&F.editor.library._onSwitchDocumentTarget},saveAsUseNode:s.saveAsUseNode,saveUseNode:s.saveUseNode,moveTo:s.moveTo,markSaved:s.markSaved,updateChangeCount:function(e){var t;F.bundle.unsupported||(e!=F.ChangeType.NodeSaveFailed&&(F.needSaveState=!0,F.scheduleBackupWindow()),F.editor.sourceView&&F.editor.sourceView.inSourceMode?F.isMac?e==F.ChangeType.NSChangeAutoSaved||e==F.ChangeType.NSChangeCleared?bridge.callHandler("document.updateChangeCount",e):bridge.callHandler("document.updateChangeCountIfUnedited",F.ChangeType.NSChangeDone):F.changeCounter.updateChangeCount(e):(e!==F.ChangeType.NSChangeAutoSaved&&e!=F.ChangeType.NodeSaveFailed&&F.needsUpdateSnap(),t=null,F.isMac?(bridge.callHandler("document.updateChangeCount",e),t={"Edit→Undo":{enabled:F.editor.undo.hasUndo()},"Edit→Redo":{enabled:F.editor.undo.hasRedo()}}):(F.changeCounter.updateChangeCount(e),k=e!==F.ChangeType.NSChangeAutoSaved||e==F.ChangeType.NodeSaveFailed,F.isNode&&(t={"Edit→Undo":{enabled:F.editor&&F.editor.undo&&F.editor.undo.hasUndo()},"Edit→Redo":{enabled:F.editor&&F.editor.undo&&F.editor.undo.hasRedo()}})),JSBridge.menu.update(t)))},setDefaultImageStorage:a.setDefaultImageStorage,exitOversize:a.exitOversize,doEnterOversize:a.doEnterOversize,tryEnterOversize:a.tryEnterOversize,recoverPosOrScroll:a.recoverPosOrScroll,restoreEditStateFromData:function(e,t,n,i,r){if(!e||!e.undoRedo||!e.nodeMap)return!0;if(0<e.timeStamp&&e.timeStamp==F.bundle.lastSnapDate)return!0;F.bundle.hasModified=!0,F.isNode&&!F.bundle.modifiedDate&&(F.bundle.modifiedDate=e.lastSync),console.sendLog(`do restoreEditStateFromData ${n} `+i);var o=null,a=F.editor,s=a.sourceView&&a.sourceView.inSourceMode,l=(F._onInitParse=!0,F.editor.focusCid=null,F.editor.lastCursor=null,a.nodeMap.restoreFromJson(JSON.parse(e.nodeMap)),a.undo.restoreFromJson(JSON.parse(e.undoRedo)),F.setLineEnding(e.useCRLF),F.finalNewline=e.finalNewline,F._onInitParse=!1,F.bundle.lastSnapDate=e.timeStamp,JSON.parse(e.bundle||"{}")),l=(F.bundle.unusedAssets=l.unusedAssets,F.bundle.deletedAssetsMap=l.deletedAssetsMap,F.bundle.assetsChanges=l.assetsChanges,F.bundle.unzipFolder=l.unzipFolder,JSON.parse(e.cursorPos||"{}"));function c(){if(F.editor.tryEnterBusyMode(),F.editor.writingArea.focus(),F.onMetaDataChanged(),t){if("object"==typeof t)try{a.undo.exeCommand(t)}catch(e){}}else o||(F._scrollTopTimer=setTimeout(()=>{document.querySelector("content").scrollTop=0},1),F.editor.selection.jumpIntoElemEnd(u("[cid]").last()),document.querySelector("content").scrollTop=0)}F.isTextPack()&&(i=!1),s?(t&&(o=a.sourceView.cm.getScrollInfo().top),e.srcHist&&(F.reloadContent(e.srcContent,{skipUndo:!0,skipChangeCount:!0}),a.sourceView.cm.doc.clearHistory(),a.sourceView.cm.doc.setHistory(JSON.parse(e.srcHist))),e.fromSourceMode||F.reloadContent(e.content,{skipChangeCount:n||F.isMac&&!F.isDocumentEdited()}),t&&a.sourceView.cm.scrollTo(0,o)):(t&&(o=u("content").scrollTop()),e.fromSourceMode?(F.reloadContent(e.srcContent,{skipChangeCount:!0,onInit:n}),setTimeout(function(){null!==o&&u("content").scrollTop(o)},0)):i||(!F.inBusyMode&&1e4<a.nodeMap.allNodes.length&&a.tryEnterBusyMode(void 0,void 0,!0),u(a.sessionStr).html(p.NodeCollectionUtils.toHTML(a.nodeMap.blocks,{focus:l.id})),n||(a.focusCid=void 0),setTimeout(function(){a.mathBlock&&a.mathBlock.cleanUpAMS(),a.refresh(),F.option.initAnchor?(a.tryOpenUrl(F.option.initAnchor),F.option.initAnchor=""):o&&u("content").scrollTop(o)},200),c())),F._needsUpdateSnap=!1,F.isNode&&(F.changeCounter.reset(e.changeCounter),F.bundle.hasModified=F.changeCounter.isDocumentEdited(),F.editor.spellChecker)&&F.editor.spellChecker.reset(!0),i?(null!=r?Promise.resolve(r):F.getContent()).then(function(e){F.bundle.savedContent=e,F.bundle.modifiedDate=new Date,F.reloadContent(e,{fromDiskChange:!0,onInit:n}),F.updateChangeCount(F.isMac?F.ChangeType.NSChangeCleared:F.ChangeType.NSChangeAutoSaved),F._needsUpdateSnap=new Date,c()}):((s=F.editor.wordCount)&&s.update(),F.freshMenuWithDelay())},needsUpdateSnap:function(){F.isMac&&bridge.callHandler("document.needsUpdateSnap"),F._needsUpdateSnap=new Date},backupDocumentSnap:async function(){F.editor&&(F.editor.lastCursor=F.editor.selection.buildUndo(),F.isMac?await new Promise(function(e){bridge.callHandler("document.requestBuildSnap",e)}):!F.isNode||F.isFileLoading()||window._onBackup||await F.buildDocumentSnapForNode())},generateSnap:function(e){var t,n;if(!F.bundle.unsupported)return e=null==e?F.sync(!1,!0):e,t=F.editor.sourceView.inSourceMode,delete(n=Object.assign({},F.bundle||{})).zip,e={nodeMap:JSON.stringify(F.editor.nodeMap.storeToJson()),undoRedo:JSON.stringify(F.editor.undo.storeToJson()),timeStamp:+(F._needsUpdateSnap||new Date),cursorPos:JSON.stringify(F.editor.selection.storeToJson()),scrollOffset:t?0:u("content").scrollTop(),useCRLF:F.useCRLF,finalNewline:F.finalNewline,content:e||"",bundle:JSON.stringify(n)},t&&(e.fromSourceMode=!0,e.srcHist=JSON.stringify(F.editor.sourceView.cm.doc.getHistory())),F.isNode&&(e.fileEncode=F.bundle.fileEncode,e.changeCounter=F.changeCounter.clone()),e},buildDocumentSnapForNode:async function(e){if(F.bundle.unsupported||!F.isNode)return Promise.resolve();if(!F._needsUpdateSnap&&!F.isActiveWindow())return Promise.resolve();window._onBackup=!0;var t=F.sync(!1,!0),n=null;F._needsUpdateSnap?(n=F.generateSnap(t),await JSBridge.invoke("document.addSnapAndLastSync",JSON.stringify({snap:n,lastSync:F.bundle.modifiedDate}))):e&&(n=JSON.parse(await JSBridge.invoke("document.getSnap",0)||"null"))&&n.content==t&&(e=F.editor.sourceView.inSourceMode,n.cursorPos=JSON.stringify(F.editor.selection.storeToJson()),n.scrollOffset=e?0:u("content").scrollTop(),await JSBridge.invoke("document.addSnap",JSON.stringify(n||null))),F._needsUpdateSnap=!1,n&&(F.bundle.lastSnapDate=n.timeStamp),window._onBackup=!1},presentedItemChanged:async function(e,t,n){if(F.isActiveWindow()&&!F.bundle.unsupported&&!F._isAskingForContentReload&&!F.isFileLoading()&&!(n&&n!=f.getTextFile()||F.isTextPack()))if(console.sendLog("presentedItemChanged, path is "+o.hashCode(n),!0),e&&clientHandlerOnPresentationMoved(),F.isNode){if(F.bundle.filePath){if(F.inSavingProcess)return;if(F.bundle.modifiedDate&&new Date-F.bundle.modifiedDate<500)return void window.debugMode}else y.onFilePathRemoved();F.bundle.filePath&&(!t||F.bundle.modifiedDate>=t.mtimeMs?console.sendLog("presentedItemChanged ignored",!0):(F.bundle.modifiedDate=t.mtimeMs,F.bundle.filePath&&await i()===F.bundle.savedContent?console.sendLog("presentedItemChanged ignore because content not changed",!0):(console.sendLog("presentedItemChanged did happen"),F.changeCounter.isDocumentEdited()?(F._isAskingForContentReload=!0,l.confirm(u.localize.getString("File content is changed by external applications. Reload content from disk ?")+" "+u.localize.getString("You could undo this operation later via `Edit` → `Undo`."),function(){r(!(F._isAskingForContentReload=!1))},function(){r(F._isAskingForContentReload=!1)})):r(!(F._isAskingForContentReload=!1)))))}else!F.isMac||F.isDocumentEdited()&&!confirm(u.localize.getString("File content is changed by external applications. Reload content from disk ?")+" "+u.localize.getString("You could undo this operation later via `Edit` → `Undo`."))||bridge.callHandler("document.refreshContentFromDisk");function i(){return console.sendLog("getDataFromFile"),new Promise(function(e){F.isMac?bridge.callHandler("document.getDataFromFile",e):F.isNode?(F.isTextBundle()?f.quickGetContent(f.getTextFile(),!0):F.getContent(F.bundle.filePath,F.bundle.fileEncode)).then(e):e("")})}function r(e){console.sendLog("doHandlerPresentedItemChange");var r=u("content").scrollTop();e?i().then(function(e){var t,n,i;F.bundle.unsupported?F.isNode&&(console.sendLog("document.enterOversize"),JSBridge.invoke("document.enterOversize")):(F.reloadContent(e,{fromDiskChange:!0}),F.updateChangeCount(F.ChangeType.NSChangeAutoSaved),(t=F.editor.sourceView).inSourceMode&&(n=t.cm.getScrollInfo().top,i=t.cm.listSelections(),t.setValue(e),t.cm.setSelections(i),t.cm.scrollTo(0,n)),setTimeout(function(){F.setContent(e),u("content").scrollTop(r)},0),F.bundle.savedContent=e,F.bundle.modifiedDate=new Date)}):F.updateChangeCount(F.ChangeType.NSChangeReadOtherContents)}},reloadWithEncoding:function(e){F.isTextBundle()||F.isTextPack()||F.isNode&&F.bundle.filePath&&e!=F.bundle.fileEncode&&(c.setItemInDB("[encode]"+F.bundle.filePath,e),F.bundle.fileEncode=e,F.getContent(F.bundle.filePath,e).then(function(e){F.reloadContent(e),F.updateChangeCount(F.ChangeType.NSChangeCleared)}))},reloadContent:function(e,t){var n,i,r,{skipUndo:o,delayRefresh:a,fromDiskChange:s,skipChangeCount:l,onInit:c,skipStore:d}=t||{};console.sendLog("File.reloadContent, "+JSON.stringify(t)),F.bundle.assetsChanges=null,!F.bundle.unsupported&&F.isMac&&s&&(e=F.tryEnterOversize(e),F.bundle.unsupported)&&(console.sendLog("document.enterOversize"),bridge.callHandler("document.enterOversize")),F.bundle.unsupported||(s&&F.needsUpdateSnap(),F.editor.undo.endSnap(!0),t=h.makeEmptyCommand(),r=F.editor.sourceView&&F.editor.sourceView.inSourceMode,t.tag="reload",F.decideLineEnding(e),r||c||d||(F.editor.store(),t.undo.push(F.editor.selection.buildUndo())),F.editor.focusCid=null,F.editor.lastCursor=null,t.undo.push(h.buildAllDoc(F.editor.nodeMap,s)),r&&(i=F.editor.sourceView.cm.getScrollInfo().top,n=F.editor.sourceView.cm.getCursor(),F.editor.sourceView.setValue(e,!0,s||l?"fromDisk":"begin")),r&&s||(F.editor.nodeMap.reset(),(d=p.Node.parseFrom(e,F.editor.nodeMap,{skips:{old_code:!1}}))[1].map(function(e){e.set("attachTo",F.editor.nodeMap)}),t.redo.push(h.buildAllDoc(F.editor.nodeMap,s)),t.date=new Date,F.editor.tryEnterBusyMode(e),r?(F.editor.sourceView.renderedHTML=d[0],F.editor.undo.register(t,l)):(F.editor.writingArea.innerHTML=d[0],F.editor.runAllScript())),r?((e=F.editor.sourceView.cm.getInputField()).setSelectionRange&&e.setSelectionRange(0,0),F.editor.sourceView.cm.setCursor(n),s&&void 0!==i&&F.editor.sourceView.cm.scrollTo(0,i)):(s&&(r=(d=F.editor.undo.lastRegisteredOperationCommand())&&d.undo.last())&&"reload"==r.type&&r.reloadFromDisk&&d.date>new Date-1e3&&(t.undo=[r],F.editor.undo.removeLastRegisteredOperationCommand()),o||F.editor.undo.register(t,l),!1!==a&&setTimeout(function(){F.editor.mathBlock&&F.editor.mathBlock.cleanUpAMS(),F.editor.refresh()},a?500:0),c||(o?(F.editor.undo.reset(),F.updateChangeCount(F.ChangeType.NSChangeAutoSaved)):window.getSelection().removeAllRanges(),setTimeout(function(){F.editor.selection.scrollAdjust()},a?500:0)),!1===a&&(F.editor.mathBlock&&F.editor.mathBlock.cleanUpAMS(),F.editor.refresh()),c&&(F.option.initAnchor?(F.editor.tryOpenUrl(F.option.initAnchor),F.option.initAnchor=""):(F.editor.selection.jumpIntoElemEnd(u("[cid]").last()),document.querySelector("content").scrollTop=0)),window.Reporter.fullValidate()))},copy:d.copy,delete:d.delete,editActive:d.editActive,deleteActive:d.deleteActive,cut:d.cut,pasteAsPlainText:d.pasteAsPlainText,lock:d.lock,unlock:d.unlock,toggleSourceMode:d.toggleSourceMode,isFocusedOnWriteDiv:function(){return 0<u(document.activeElement).closest("#write").length},getCurBlockType:function(){try{if("write"!==document.activeElement.id&&document.activeElement.hasAttribute&&document.activeElement.hasAttribute("tabindex"))return u(document.activeElement).closest("[mdtype]").attr("mdtype")||"";var e;if(rangy.getSelection().rangeCount)return e=F.editor.selection.getRangy(),u(e.commonAncestorContainer).closest("[mdtype]").attr("mdtype")||""}catch(e){}return""},winShell:c.winShell,freshLock:d.freshLock,setTheme:a.setTheme,getFileName:a.getFileName,getSuggestedFileName:a.getSuggestedFileName,setCanCollapsePinnedOutline:a.setCanCollapsePinnedOutline,refreshImageCopyStatus:function(e,t){e?(S&&clearTimeout(S),S=setTimeout(function(){g.doRefreshImageCopyStatus(t)},500)):g.doRefreshImageCopyStatus(t)},onMetaDataChanged:function(e){S&&clearTimeout(S);var t=()=>{F.isNode&&F.refreshImageCopyStatus(!0);var e=F.editor.localSettingBridge;e&&e.loadFromFile(),S=null};e?t():S=setTimeout(t,100)},isDocumentEdited:function(){return F.isNode?F.changeCounter.isDocumentEdited():F.isMac?bridge.callSync("document.isDocumentEdited"):void 0},trashSelf:function(){F.bundle.filePath&&F.editor.library.doDeleteFile(F.bundle.filePath,null,e=>{e&&F.isNode&&(F.reloadContent(F.editor.warpContentWithOption(""),{fromDiskChange:!0}),y.onFilePathRemoved(),F.editor.selection.jumpTop())})},backupWindow:async function(e){if(r&&(window.cancelSmartSchedule(r),r=null),e&&F.sync(),F.isNode)if(F._onInitParse)F.needSaveState=!1;else try{if(F.needSaveState&&F.editor.brush.timerID&&F.isActiveWindow()){var t,n=F.bundle.hasModified&&F.changeCounter.isDocumentEdited();if(n||!F.changeCounter.isDiscardableUntitled()||F.mountFolder_)return n&&F.option.enableAutoSave&&(await F.saveUseNode(null,!0),n=F.changeCounter.isDocumentEdited(),F.changeCounter.curState),t={path:F.bundle.filePath,untitledId:F.bundle.untitledId||0,type:F.bundle.type||"",encode:F.encode,hasUnsaved:n,scrollPos:u("content").scrollTop(),useCRLF:F.useCRLF,finalNewline:F.finalNewline,syncDate:+new Date,mountFolder:F.mountFolder_,content:null},n&&(F.editor.store(null,!0),t.content=F.editor.getMarkdown()),reqnode("electron").ipcRenderer.send("addBackup",JSON.stringify(t)),F.needSaveState=!1,console.sendLogForDebug("backupWindow sent"),t}}catch(e){console.sendError(e)}},scheduleBackupWindow:function(){F.isNode&&(r&&window.cancelSmartSchedule(r),r=window.requestSmartSchedule(async()=>{console.sendLogForDebug("do BackupWindow"),await F.backupWindow()},1e3,1e4))},decideLineEnding:a.decideLineEnding},S=null,k=!1,e=(F.ChangeType=c.ChangeType,F.isMacLegacy=void 0!==window.app,F.isWK=F.isWk=window.isWk,F.isMac=F.isMacLegacy||F.isWK,F.isNode=void 0!==window.reqnode,F.isMacNode=F.isNode&&"darwin"==window.process.platform,F.isMacOrMacNode=F.isMac||F.isMacNode,F.isNodeHtml=window.isOnWindowHtml,F.isWin=F.isNode&&"win32"==window.process.platform,F.isLinux=F.isNode&&"linux"==window.process.platform,F.isLinuxSnap=F.isNode&&"typora"==window.process.env.SNAP_NAME,F.isUnixNode=F.isLinux||F.isMacNode,F.FileInfoPanel=y,F.backupVersionWorker=i,F.freshMenu=g.freshMenu,F.freshMenuWithDelay=g.freshMenuWithDelay,F.bindMenu=g.bindMenu,F.MenuHelper=g,navigator.userAgent.toLowerCase());F.isSafari=F.isMac||-1<e.indexOf("safari/")&&-1==e.indexOf("chrome"),F.isMac&&JSBridge.invoke("window.loadFinished"),F.startAutoSaveAndBackupService=function(){var e;F.isNode&&((e=F.option.autoSaveTimer)&&Number.isNaN(e),setInterval(i,6e5))},F.saveAndBackup=function(){i()},F.isNode&&(F.fs=reqnode("fs-extra"),F.startAutoSaveAndBackupService(),setInterval(()=>{F.draftsRecoverList=[]},144e5)),window.onPowerChange=function(e){console.sendLog("[powerMonitor] "+e),F.draftsRecoverList=[]},n.exports=F}),$__System.registerDynamic("57",["13","11","1c","15","19","17","32","29","28"],!0,function(e,o,a){"use strict";this||self;var t=e("13"),y=t.Node,n=t.NodeMap,v=t.TYPE,b=e("11"),w=e("1c"),x=e("15"),C=e("19"),F=e("17"),s=e("32"),l=e("29"),d=e("28"),i={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"'":"'","\\":"\\\\"};const S={USE_PROFILES:{mathMl:!0,svg:!0},ALLOW_DATA_ATTR:!1,ADD_ATTR:["id","style"]};var k,E,T="",_="",c={},u=[],h=[];function p(t,n,a,s){var i=t.split(/(\uE040\d+)\uE041/g);if(!i)return n(t);Promise.all(i.map(async function(e){var t,n,i,r,o;return e.charAt(0)==T?(t=+e.substring(1),t=k[t].cid,r=t,r=document.querySelector("[cid='"+r+"'] svg"),o=$(r).closest("[lang='mermaid']").length,(r=await l.saveSVGToTempPath(r,o))&&h.push(r),o=await r,E.delete(t),"latex"==a&&(n=o,o=await((i=s)?new Promise(function(e){var t;File.isNode?(t=reqnode("path").basename(n),reqnode("fs-extra").move(n,i+"/"+t,function(){e(t)})):File.isMac&&bridge.callHandler("path.moveTo",{source:n,folder:i},e)}):Promise.resolve(n))),JSON.stringify(o)):e})).then(function(e){t=e.join(""),n(t)},function(e){t=i.join("").replace(/[\uE040-\uE041]/g,""),n(t)})}function I(){if(File.isNode)for(;h.length;)reqnode("fs").unlink(h.pop(),function(){});else File.isMac&&(bridge.callHandler("path.removeFiles",h),h=[])}function H(e,t,n){try{return'Div ("toc", [], []) [Para ['+e.toc.headers.map(t?function(e){return'Str "'+" ".repeat(e.get("depth")-1)+'", Link ("", [], []) ['+N(e)+`] ("#${n[e.cid]||"header-"+e.cid}","")`}:function(e){return'Str "'+"\\t".repeat(e.get("depth")-1)+'", Link ("", [], []) ['+N(e)+`] ("#${n[e.cid]||"header-"+e.cid}","")`}).join(",LineBreak,")+"]]"}catch(e){return console.warn(e.stack),'Para [Str ""]'}}function U(e,t){function n(e){for(var t,n="";e.length&&(t=a.exec(e));)e=e.substring(t[0].length),t[1]&&(n+='Str "'+A(t[1])+'", '),t[2]?n+=File.option.preLinebreakOnExport?"LineBreak, ":"SoftBreak, ":t[3]&&(n+="Space, ");return n}var i,r,o,a=/^(\S*)(?:(\n)|(\s*))/,s=(e.inner&&(e.inner=e.inner.replace(/, $/,"")),/^file:[\\\/]{0,2}/i);switch(e.type){case v.strong:case v.em:case v.del:case v.subscript:case v.superscript:return m[e.type]+" ["+e.inner+"], ";case v.plain:case v.escape:case v.tab:case v.emptyline:return n(e.text);case v.html_entity:return n(b.decodeHtmlEntity(e.text)||e.text);case v.pants:return n(e.inner);case v.softbreak:return File.option.preLinebreakOnExport?"LineBreak, ":"SoftBreak, ";case v.code:return'Code ("", [], []) "'+A(e.text.trim())+'", ';case v.autolink:case v.url:return'Link ("", [], []) [Str "'+A(e.text)+'"] ("'+A(e.href)+'", ""), ';case v.atag:if(!D(t.target))return'Link ("", [], []) ['+e.inner+'] ("'+A(e.href)+'", "'+A("")+'"), ';case v.imgtag:if(!D(t.target))return o=$($.parseHTML(e.text)),'Image ("",[],[]) [Str "'+A(o.attr("title")||o.attr("alt")||"")+'"] ("'+A(File.editor.imgEdit.getRealSrc(e.href).replace(s,""))+'","fig:"), ';case v.tag:case v.comment:case v.ruby:return'RawInline (Format "html") "'+A(e.text)+'", ';case v.link:return"#"==(e.href||"").trim()[0]&&(e.href=d.normalizeAnchor(e.href,t.anchorList)),'Link ("", [], []) ['+e.inner+'] ("'+A(e.href)+'", "'+A(e.title||"")+'"), ';case v.image:return'Image ("",[],[]) [Str "'+A(e.title||"")+'"] ("'+A(File.editor.imgEdit.getRealSrc(e.href).replace(s,""))+'","fig:"), ';case v.refimg:l="Image";case v.reflink:return c=(o=t.nodeMap.link_list.getNodeByRef(e.ref||e.text))?A(o.get("href").replace(s,"")):"",o=A(o&&o.get("title")||""),"Image"==(l=l||"Link")&&(e.inner='Str "'+A(o||"")+'"'),l+' ("", [], []) ['+e.inner+'] ("'+c+'", "'+o+'"), ';case v.footnote:var l=t.nodeMap.foot_list.getNodeByRef(e.text);return l?"Note [Para ["+N(l)+"]], ":n(e.text);case v.attr:return n(e.text);case v.emoji:return'Str "'+A(e.inner)+'", ';case v.inline_math:if("epub"==t.target){var c=DOMPurify.sanitize(MathJax.tex2mml(e.text.replace(/(^\s*\$+)|(\$+\s*$)|\u200b/g,"").trim(),{display:!1}),S);if(c)return'RawInline (Format "html") '+JSON.stringify(c)+", "}return'Math InlineMath "'+A(e.text.replace(/(^\s*\$+)|(\$+\s*$)|\u200b/g,""))+'", ';case v.br:case v.linebreak:return"LineBreak, ";case v.highlight:if("latex"==t.target)-1==u.indexOf("\\usepackage{color}")&&(u.push("\\usepackage{color}"),u.push("\\usepackage{soulutf8}"));else if("docx"==t.target)return r=O(e),g[t.target].replace("$0",A(b.escape(r)));return((i=g)[t.target]||i.html).replace("$0",e.inner);case v.alert_text:return P(t.target)?n(e.text||""):m[v.strong]+" ["+n(b.capitalize(e.inner)).replace(/,\s*$/,"")+"], LineBreak, ";case v.underline:return t.versionAfter2_10?m[e.type]+" ["+e.inner+"], ":(i=J,"docx"==t.target?(r=O(e),i[t.target].replace("$0",A(b.escape(r)))):(i[t.target]||i.html).replace("$0",e.inner));default:return n(e.text||"")}}var f,r,A=function(e){return C.recoverEscape(e).replace(/["'\\\b\t\n\f\r]/g,function(e){return i[e]}).replace(/\u200b/g,"")},M={left:"AlignLeft",right:"AlignRight",center:"AlignCenter"},L=function(e,t,n,i,r){t=void 0===t?",":t,i=i||c;for(var o,a=[],s=n||e.getFirstChild();s;)(o=B(s,i,r))&&a.push(o),s=s.get("after");return a.join(t)},N=function(e,t){t=t||e.get("text");var n=e.get("parent"),i={};return y.isType(e,v.paragraph)&&!e.get("before")&&y.isType(n,v.blockquote)&&n.get("alert")&&(i.alert=!0),f.output(t,void 0,void 0,i).replace(/, $/,"")||'Str ""'},j=function(e){try{var t=(new DOMParser).parseFromString(e,"text/html");return t.querySelectorAll("mtable").forEach(function(e){e.hasAttribute("columnalign")&&!e.getAttribute("columnalign")&&e.removeAttribute("columnalign")}),t.body.innerHTML}catch(e){}return e},D=function(e){return y.isType(e,"epub","rst","opml","textile","markdown")},P=function(e){return y.isType(e,"gfm","markdown")},q=/([^\\]|^)\\tag{([^}]+)}\s*/,W=/([^\\]|^)\\label{([^}]+)}\s*/,z=/([^\\]|^)\\over[^\w\d]/,V=function(e,t){var n;if(t.number=t.number||1,File.option.autoNumberingForMath&&(n=t.number,t.number++),!z.test(e)){t=q.exec(e);if(e=e.replace(/([^\\]|^)\\eqref{([^}]+)}\s*/g,"$1($2)"),t)return n=t[2],[e=e.replace(/([^\\]|^)\\tag{([^}]+)}\s*/g,"$1")+"\\qquad\\text{("+b.escapeInQuote(n)+")}",n];e=e+("\\qquad\\text{("+b.escapeInQuote(n+""))+")}",(t=W.exec(e))&&(n=t[2])}return[e,n]},B=function(t,r,n){function i(e,t,n,i){return L(e,t,n,r,i)}function o(e,t){if(d=e.get("text").trim().replace(/\u200b/g,""),"epub"==t.target){e=DOMPurify.sanitize(MathJax.tex2mml(d,{display:!0}),S);if(e)return'RawBlock (Format "html") '+JSON.stringify(j(e))+" "}else if("latex"==t.target){if(d.match(/^\\(begin|newcommand|renewcommand|newenvironment|renewenvironment|def|let){/))return'RawBlock (Format "latex") '+JSON.stringify(d)}else if("docx"==t.target)if(d=d.replace(/\n[\\]+\n/g,"\n"),File.option.autoNumberingForMath&&!/\\nonumber\s*$/.exec(d))return e=V(d,t),"Plain ["+['Math DisplayMath "'+A(e[0])+'" '].join(",")+"]";return'Plain [Math DisplayMath "'+A(d)+'"]'}var a=D(r.target),s=r.versionAfter2_10,l='("",[],[])';switch(t.get("type")){case v.paragraph:return"Para ["+(n||"")+(d=N(t))+"]";case v.meta_block:return"";case v.heading:var c=r.anchorMap[t.cid];return"Header "+t.get("depth")+' ("'+b.escapeInQuote(c)+'", [], []) ['+(n||"")+N(t)+"]";case v.blockquote:return d=i(t),!P(r.target)&&y.isType(t.get("alert"),"note","warning","important","tip","caution")?`Div ("", ["${t.get("alert")}", "alert"], []) [${d}]`:"BlockQuote ["+d+"]";case v.list:var c=t.get("style"),d=i(t);return c==y.ListType.ol?"OrderedList (1,Decimal,Period) ["+d+"]":"BulletList ["+d+"]";case v.list_item:let e="";return t.get("parent")&&t.get("style")===y.ListType.task&&(e=t.get("checked")?'Str "\\9746" , Space , ':'Str "\\9744" , Space , '),"["+(d=i(t,void 0,void 0,e))+"]";case v.fences:if(x.isDiagramType(t.get("lang")))if(y.isType(r.target,"epub","docx","odt","latex"))return k.push(t),E.add(t.cid),c=document.querySelector("[cid='"+t.cid+"'] svg").getBoundingClientRect(),'Div ("",[],[("style","text-align:center"), ("align", "center")]) [Para [Image ("",['+JSON.stringify(t.get("lang"))+'],[("width", "'+(c.right-c.left)+'"), ("align", "center")]) [Str ""] ('+(T+(k.length-1)+_)+',"fig:")]] ';if(w.isMathType(t.get("lang")))return o(t,r);var u=C.parsePandocAttr(t.get("lang"));if(Object.keys(u).length){var h,p=[];for(h in u.nativeAttr)p.push('("'+h.replace(/['"]/g,"")+'","'+u.nativeAttr[h].replace(/['"]/g,"")+'")');return'CodeBlock ("'+A(u.id||"")+'",['+(u.class||"").trim().split(/\s+/).map(function(e){return'"'+A(e)+'"'}).join(",")+"],["+p.join(",")+']) "'+A(t.get("text"))+'"'}return'CodeBlock ("",["'+A(getCodeMirrorMode(t.get("lang")||"",!1,!0,!0))+'"],[]) "'+A(t.get("text"))+'"';case v.math_block:return o(t,r);case v.hr:return"HorizontalRule";case v.def_footnote:case v.def_link:return"";case v.toc:return"latex"==r.target?'RawBlock (Format "latex") "\\\\tableofcontents"':"wiki"==r.target?'RawBlock (Format "mediawiki") "__TOC__", RawBlock (Format "mediawiki") ""':"rst"==r.target?'RawBlock (Format "rst") ".. contents::", RawBlock (Format "rst") "\n"':"opml"==r.target?"":"textile"==r.target?'RawBlock (Format "textile") "{toc}", RawBlock (Format "textile") "\n"':"";case v.table:var c=t.getFirstChild(),f=c.get("after"),m="";return s?(g=t.get("align").fill().map(function(e){return`(${M[e]||"AlignDefault"},ColWidthDefault)`}),m=f?`(TableBody ${l} (RowHeadColumns 0) [] [${i(t,",",c.get("after"))}])`:'(TableBody ("",[],[]) (RowHeadColumns 0) [] [])',`Table ${l} (Caption Nothing []) [${g.join(",")}] (TableHead ${l} [${B(c,r)}]) [${m}] (TableFoot ("",[],[])
				[])`):(m=(g=t.get("align").fill().map(function(e){return M[e]||"AlignDefault"})).map(()=>"0.0"),"Table [] ["+g.join(",")+"] ["+m.join(",")+"] ["+i(c)+"] ["+(f?i(t,",",c.get("after")):"[]")+"]");case v.table_row:return s?`Row ${l} [${i(t)}]`:"["+i(t)+"]";case v.table_cell:return s?`Cell ${l} AlignDefault (RowSpan 1) (ColSpan 1) [Plain [${N(t)}]]`:"[Plain ["+N(t)+"]]";case v.html_block:var g=F.buildHTMLForExport(t.get("text"),File.editor,r.target),m="";if(a)return m=F.convertToXHTML(g),'RawBlock (Format "html") "'+A(m.replace(/\r\n/g,""))+'"';try{m=$.parseHTML(g)[0].textContent||""}catch(e){}return'Para [Str "'+A(m)+'"]';default:return""}},m=[],J=(m[v.strong]="Strong",m[v.em]="Emph",m[v.del]="Strikeout",m[v.subscript]="Subscript",m[v.superscript]="Superscript",m[v.underline]="Underline",{html:'RawInline (Format "html") "<u>", $0, RawInline (Format "html") "</u>", ',docx:'RawInline (Format "openxml") "<w:r><w:rPr><w:u w:val=\\"single\\" /></w:rPr><w:t>$0</w:t></w:r>", ',rtf:'RawInline (Format "rtf") "{\\\\ul ", $0, RawInline (Format "rtf") " }", ',latex:'RawInline (Format "latex") "\\\\underline{", $0, RawInline (Format "latex") "}", '}),g={html:'RawInline (Format "html") "<mark>", $0, RawInline (Format "html") "</mark>", ',docx:'RawInline (Format "openxml") "<w:r><w:rPr><w:shd w:val=\\"clear\\" w:fill=\\"ffff00\\" /></w:rPr><w:t>$0</w:t></w:r>", ',rtf:'RawInline (Format "rtf") "{{\\\\colortbl;\\\\red255\\\\green255\\\\blue0;} \\\\cb1 ", $0, RawInline (Format "rtf") "}", ',latex:'RawInline (Format "latex") "\\\\hl{", $0, RawInline (Format "latex") "}", '},R={atag:!1,imgtag:!1,comment:!0},O=function(e){function t(e){return e.inner||e.text||""}r=r||new C.InlineLexer({skipOp:R},t);try{return r.output(e.text,t,!0)}catch(e){return!1}};n.prototype.exportToNative=function(e,t,n,i){File.editor.export.cleanUpTempFiles=I,i=i||{},function(e){var t;c={forExport:!0,target:e,nodeMap:this,skipOp:R,version:window.pandocVersion},u=[],k=[],E=new Set,void 0===File.canvasratio&&(File.canvasratio=1,e=document.createElement("canvas").getContext("2d"),t=window.devicePixelRatio||1,e=e.webkitBackingStorePixelRatio||e.mozBackingStorePixelRatio||e.msBackingStorePixelRatio||e.oBackingStorePixelRatio||e.backingStorePixelRatio||1,File.canvasratio=t/e)}.call(this,e),"epub"==e&&(File.editor.mathBlock.saveMathState(),MathJax.texReset(0)),i=Object.assign({},c,i),f&&f.options.nodeMap===this||(f=new C.InlineLexer(i,U)),i.anchorMap={},i.anchorList=d.fetchAnchorList(i.anchorMap),i.versionAfter2_10=0<=b.compareVersion(i.version,"2.10");var r=L(null,"\n ,",this.getFirst(),i),o=File.editor.docMenu.buildMetaMap()||{},a=null,r=r.replace(/\uE088/g,function(){return a=null===a?H(File.editor.nodeMap,D(e),i.anchorMap):a}),o=("epub"==e&&null==o.title&&(o.title=b.capitalizeEachWord((File.bundle.fileName||"").replace(/\.[^.]+$/,"").replace(/-/g," "))),"Pandoc (Meta {unMeta = fromList ["+function(e){var t,n=[];function i(e,t){return"cover-image"==e&&"string"==typeof t&&/^\.+[\\\/]/.exec(t)&&(t=s.normalizePath((s.getCurrentFileFolderPath()||"")+"/"+(t||""))),`("${A(e)}",${r(t)})`}function r(t){return"string"==typeof t?/^\\[a-zA-Z]/.exec(t)?`${-1<t.indexOf("\n")?"MetaBlocks [ RawBlock":"MetaInlines [ RawInline"} (Format "tex") "${A(t)}"]`:"MetaInlines [ "+(f.output(t).replace(/, $/,"")||'Str ""')+"]":t instanceof Array?"MetaList ["+t.map(r).join(", ")+"]":`MetaMap ( fromList [${Object.keys(t).map(e=>i(e,t[e])).join(", ")}])`}for(t in u.length&&(e["header-includes"]&&"string"==typeof e["header-includes"]?e["header-includes"]=e["header-includes"]+u.join("\n"):e["header-includes"]=u.join("\n")),e)n.push(i(t,e[t]));return n}(o)+"]})\n ["+r+"]");return y.isType(e,"epub","docx","odt","latex")?p(o,t,e,n):t(o),"epub"==e&&File.editor.mathBlock.restoreMathState(),o}}),$__System.registerDynamic("1c",["20","e","13","1b","11","29","26"],!0,function(e,t,n){"use strict";this||self;var s,m=e("20"),g=e("e"),i=e("13"),y=i.Node,l=e("1b"),r=(l.SnapFlag,e("11")),o=e("29"),e=e("26"),v=(e.map,i.TYPE),a=e.map,b=document.querySelector("#md-rawblock-tooltip-templ").innerHTML,w=function(){return!!(window.MathJax&&window.MathJax.config&&MathJax.startup.document)},c=async function(){if(!w())return new Promise(e=>{var t=function(){w()?e():setTimeout(t,50)};setTimeout(t,50)})},d=!1;function u(t){return window.requestIdleCallback?new Promise(e=>requestIdleCallback(e,{timeout:t})):(n=t,new Promise(e=>setTimeout(e,n)));var n}async function h(){function e(){}d||(await c(),MathJax.startup.document.removeRenderAction("addMenu"),MathJax.startup.document.addRenderAction("afterRender",1001,e,(e,t)=>{var n,i,r,o=e.typesetRoot.querySelector("svg");r=i=/^mjx-/i,(n=o).querySelectorAll("[id]").forEach(e=>{r.exec(e.id)||(e.id="mjx-"+e.id)}),n.querySelectorAll("[class]").forEach(e=>{e.setAttribute("class",e.getAttribute("class").split(/\s+/).filter(e=>i.exec(e)).join(" "))}),o.parentElement==e.typesetRoot&&e.typesetRoot.hasAttribute("aria-label")&&o.setAttribute("alt",e.typesetRoot.getAttribute("aria-label"))}),s=MathJax.getMetricsFor(document.querySelector("#write>p")||document.querySelector("#write"),!0),d=!0,File.option.noDisplayLinesInMath)||MathJax.startup.document.addRenderAction("displayLines",1,e,(e,t)=>{var n;e.math="\\u32E"==(e=e.math)[0]?e.substr(1):!/\\(\\|newline)/.exec(e)||(n=/^(?:\s|(?:\s*%[^\n]*\n))*\\([a-z]+)/i.exec(e))&&(/(begin|command|matrix|align|eq)/.exec(n[1])||-1<["def","let","newenvironment","array","displaylines","enclose","gather","gathered","leqalignno","multiline","split"].indexOf(n[1]))?e:`\\displaylines{
${e}
}`})}function x(){return MathJax.startup.document.inputJax[0].parseOptions.tags}function C(e){var t=Array.from(document.querySelectorAll(".md-math-block")),n=null;if(e.hasAttribute("data-tag-before"))return e.dataset.mathTagBefore;if(-1<t.indexOf(e))return(n=t[t.indexOf(e)-1])?n.dataset.mathTagAfter:0;for(const i of t){if(e.compareDocumentPosition(i)!=e.DOCUMENT_POSITION_FOLLOWING)break;n=i}return n?n.dataset.mathTagAfter:0}function F(e,t){t=t||x().allLabels,MathJax.texReset(e),x().allLabels=t}function S(e,t){e.forEach(e=>{delete t[e]})}function k(t,e){var n=[];return e.forEach(e=>{-1==t.indexOf(e)&&n.push(e)}),n}function p(e,t,n,i){t=t||{};var r=x().counter;i&&F(r=t.mathTagBefore);S(JSON.parse(t.mathLabels||"[]"),x().allLabels);var o=Object.keys(x().allLabels);function a(e){var t={};return t.dom=e,t.mathTagBefore=r,t.mathTagAfter=x().counter,t.mathLabels=JSON.stringify(k(o,Object.keys(x().allLabels))),t}try{return n?a(MathJax.tex2svg(e,s)):new Promise(t=>{MathJax.tex2svgPromise(e,s).then(e=>{t(a(e))},()=>{MathJax.tex2svgPromise("",s).then(e=>{t(a(e))})})})}catch(e){}}async function f(e,t,n){for(var i=[],r=0;r<t.length;r++){var o=t[r];if(!document.body.contains(o))return!1;var a=e.getNode(o.getAttribute("cid")).get("text"),a=(r%60==0&&await u(100),await p(a,o.dataset,!1,n));i.push(a)}return t.forEach((e,t)=>{var t=i[t],n=(e.dataset.mathTagBefore=t.mathTagBefore,e.querySelector(".md-math-container, .md-mathjax-preview"));n.innerHTML="",n.appendChild(t.dom),n.classList.remove("math-jax-preprocess"),e.dataset.mathTagAfter=t.mathTagAfter,e.dataset.mathLabels=t.mathLabels}),t.length}class E{constructor(e){this.isMathJaxReady=w,this.getMathJaxTags=x,this.renderTex=p,this.editor=e,this.queue={},this.cache={},this.preview,this.bindEvent(),h()}saveMathState(){this.state={count:x().counter,allLabels:x().allLabels}}restoreMathState(){this.state&&(MathJax.texReset(this.state.count),x().allLabels=this.state.allLabels)}beforeRenderMath(){document.querySelector("#write").classList.add("ty-before-first-render")}cacheUnder(e){e&&e.querySelectorAll&&e.querySelectorAll("mjx-container").forEach(e=>{var t=e.closest(".md-math-block.mathjax-block"),n=t&&this.editor.getNode(t.getAttribute("cid"));n&&!n.isDeleted()&&(n=n.get("text"),this.cache[n]?delete this.cache[n]:this.cache[n]={attr:`data-math-tag-before="${t.dataset.mathTagBefore}" data-math-tag-after="${t.dataset.mathTagAfter}" data-math-labels="${r.escape(t.dataset.mathLabels)}"`,inner:e.outerHTML})})}clearCache(){this.cache={}}bindEvent(){var n=this,t=this.editor;g(this.editor.sessionStr).on("mousedown",".md-math-container",function(e){t.undo.prepCursorSnap()}).on("click startedit",".md-math-container",async function(e){if(void 0===e.which||1==e.which)return e=g(this).closest("[cid]"),await n.startEditing(e,"auto"),t.undo.endSnap(),!1}).on("losefocus",".md-math-block",function(e){n.stopEditing(this.getAttribute("cid")),document.activeElement!=t.writingArea&&t.selection.scrollAdjust()}).on("endfocus",".md-math-block",function(e){n.stopEditing(this.getAttribute("cid"),!1,!0),document.activeElement!=t.writingArea&&t.selection.scrollAdjust()}).on("keydown",".md-math-block",async function(e){var t=e.keyCode||e.which;if("Enter"===a[t])return await n.startEditing(g(this),"auto"),e.stopPropagation(),e.preventDefault()}).on("blur inline-change",".md-math-block .ty-input",function(){var e;n.currentCm&&(e=n.editor.getNode(n.currentCm.cid),n.tryAddTagUndo(e,g(this)))}).on("keydown",".md-math-block .ty-input",function(e){"Enter"==a[e.keyCode||e.which]&&n.editor.selection.moveUpOrDown(!1,e)}).on("click",".md-math-block .md-rawblock-after, .md-math-block .md-rawblock-before",function(e){e.target==this&&this.querySelector(".ty-input").focus()}).on("keydown",".md-math-block .ty-input",function(e){var t,e=e.keyCode||e.which;return"Delete"==a[e]?(t=n.editor.selection.getRangy()).commonAncestorContainer.parentElement==this&&(t.startOffset==t.endOffset&&t.endOffset==this.textContent.length?(n.editor.selection.moveUpOrDown(!1),!1):void 0):"Backspace"==a[e]?(t=n.editor.selection.getRangy()).commonAncestorContainer.parentElement==this&&(t.startOffset==t.endOffset&&0==t.startOffset?(n.editor.selection.moveUpOrDown(!0),!1):void 0):"Return"==a[e]||"Enter"==a[e]?(n.editor.selection.moveUpOrDown(!1),!1):void 0}).on("paste",".md-math-block .ty-input",function(e){setTimeout(function(){e.target.textContent=e.target.textContent.replace(/(^[\n{]+)|([\n}]+$)/g,"").split(/\r?\n/)[0],g(e.target).trigger("change")},0)}).on("click",".md-fences-math .md-fences-adv-panel",function(e){var t=g(this).prevAll(".CodeMirror");t.length&&!t.hasClass("CodeMirror-focused")&&(t=t[0].CodeMirror)&&(t.refresh(),t.focus())})}tryAddTagUndo(e,t){if(!t.hasClass("ty-input"))return!1;e=e||this.editor.getNode(this.currentCm.cid);var n,i=t.hasClass("ty-input-before")?"tagBefore":"tagAfter",r=e.get(i),t=t.text();return r!=t&&((n=l.makeEmptyCommand()).undo.push({id:e.cid,type:"attr",key:i,value:r||""}),e.set(i,t),n.redo.push({id:e.cid,type:"attr",key:i,value:t}),self.editor.undo.register(n),!0)}async renderAfterLabelChanges(n){var e=Array.from(document.querySelectorAll(".md-math-block")),e=(n=n||[],e.filter(e=>{if(!~n.indexOf(e))try{var t=this.editor.getNode(e.getAttribute("cid")).get("text");return!!/\\(eq)?ref\{/.exec(t)}catch(e){}return!1}));return f(this.editor,e,!0)}async renderAfter(e,t){await c();var n=Array.from(document.querySelectorAll(".md-math-block")),i=n.indexOf(e)+1,r=0;if(!i)for(var o in n){var a=n[o];if(!(e.compareDocumentPosition(a)&e.DOCUMENT_POSITION_PRECEDING))break;i=o+1}return i&&!t&&!(r=e.dataset.mathTagAfter)&&n[i-1]&&(r=n[i-1].dataset.mathTagAfter),t||F(r),!(n[i]&&+n[i].dataset.mathTagBefore==x().counter||(t=n.slice(i),0==await f(this.editor,t))||!t.length)&&t}async renderUnder(e,t){await c();var n,i,r,o,a=document.querySelector("#write").classList,s=(a.contains("ty-before-first-render")&&setTimeout(()=>{a.remove("ty-before-first-render")},10),Array.from((e||document).querySelectorAll(".md-math-block")));e&&e.classList&&e.classList.contains("md-math-block")&&(s=[e]),(s=t||s.find(e=>!e.querySelector("mjx-container"))?s:[]).length?(30<s.length&&await u(100),t=this.editor,n=Object.entries(x().allLabels).map(e=>[e[0],e[1].tag]),(r=e&&e.dataset&&e.dataset.needRefresh||!1)&&e.removeAttribute("data-need-refresh"),o=C(s[0]),i=s.last().dataset.mathTagAfter,F(o),!1===await f(t,s)||(r=r||i!=x().counter,o=Object.entries(x().allLabels).map(e=>[e[0],e[1].tag]),(r=r||function(e,t){if(e.length!=t.length)return!0;for(var n of e)if(!t.find(e=>e[0]==n[0]&&e[1]==n[1]))return!0;return!1}(n,o))&&(t=await this.renderAfter(s.last(),!0),await Promise.all([this.renderAfterLabelChanges(t),this.editor.mathInline.renderAll(!0,void 0,!0)])),r||await this.editor.mathInline.renderAll(!1,e),e)||this.editor.tryEnterBusyMode()):await this.editor.mathInline.renderAll(!1,e)}getTex(e){return this.editor.getNode(e).get("text")}getCidAndElem(e){var t=e,n=e;return"string"==typeof e?n=this.editor.findElemById(t):t=n.attr("cid"),[t,n]}syncToNode(e){e="string"==typeof e?this.editor.getNode(e):e;return(this.currentCm||{}).cid===e.cid&&e.set("text",this.currentCm.getValue()),e}remove(e){var e=this.getCidAndElem(e),t=e[0],e=e[1],t=editor.getNode(t),n=editor.undo.UndoManager,i=n.makeEmptyCommand(),r=this.currentCm;this.beforeDeleteFences(t),r&&r.cid===t.cid?i.undo.push({type:"fences-pos",pos:r.getCursor(),id:r.cid}):i.undo.push(this.editor.selection.buildUndo()),i.undo.push(n.buildReplaceUndo(t)),t.set("type",v.paragraph),t.set("text",""),i.redo.push(n.buildReplaceUndo(t)),r=g(g.parseHTML(t.toHTML())[0]),e.replaceWith(r),editor.selection.jumpIntoElemEnd(r),i.redo.push(editor.selection.buildUndo()),editor.undo.register(i),this.currentCm=void 0}beforeDeleteFences(e){var t,n=e.cid,i=e,r=this,e=(n||(i=this.syncToNode(n=e)),this.currentCm=void 0,this.editor.findElemById(n));S(JSON.parse(e.attr("data-math-labels")||"[]"),x().allLabels),this.stopEditing(i.cid,!1,!0),File.option.autoNumberingForMath&&!File.inBusyMode&&(t=e.next(),setTimeout(async()=>{t.length&&t.closest("body")?await r.renderAfter(t[0])&&await r.editor.mathInline.renderAll(!0,void 0,!0):r.forceRefreshSoon()},10))}async stopEditing(e,t,n){var i,r,o,a,s;(this.currentCm&&this.currentCm.cid||e)&&(i=(e=this.getCidAndElem(e||this.currentCm.cid))[0],e=e[1],r=this.editor,s=this.currentCm,e[0]&&s?s.cid==i&&((o=e[0].querySelector(".md-mathjax-preview"))?((a=l.makeEmptyCommand()).undo.push({type:"fences-pos",pos:s.getCursor(),id:s.cid}),s=this.syncToNode(i),o&&(this.currentCm=void 0,e.html(b.replace("{type}",g.localize.getString("Math","Menu"))).removeClass("md-rawblock-on-edit"),o.setAttribute("class","md-rawblock-container md-math-container"),o.setAttribute("tabindex","-1"),e[0].appendChild(o),await this.renderUnder(e[0],!0),t&&r.selection.jumpToNextBlock(s,a),n||r.undo.register(a))):this.currentCm=void 0):this.currentCm=void 0)}async startEditing(e,t){var e=this.getCidAndElem(e),n=e[0],o=e[1],e=this.editor,a=this.editor.getNode(n);if(!File.isLocked&&(this.currentCm&&this.currentCm.cid!=n&&await this.stopEditing(),y.isType(a,v.math_block))){var s,i,r=document.querySelector("content"),l=null,c=(g(document.activeElement).closest(".md-math-block").length&&(l=r.scrollHeight-r.scrollTop-r.clientHeight),null),d=!1,u=null;if(n){if(this.currentCm&&this.currentCm.cid===n){if(e.writingArea.contains(this.currentCm.getWrapperElement()))return this.currentCm.focus(),this.currentCm;this.currentCm=null}this.currentCm&&(await this.stopEditing(this.currentCm.cid),window.getSelection().removeAllRanges()),o.html(b.replace("{type}",g.localize.getString("Math","Menu"))+document.querySelector("#md-mathblock-panel-templ").textContent).addClass("md-rawblock-on-edit"),a.get("tagBefore")&&o.find(".md-rawblock-before .ty-input").text(a.get("tagBefore")),a.get("tagAfter")&&o.find(".md-rawblock-after .ty-input").text(a.get("tagAfter"));var h=o.children(".md-mathblock-panel");if(!h.length)return;this.currentCm=p(this.editor),f(o[0]).then(()=>{File.option.autoNumberingForMath&&!File.inBusyMode&&this.renderAfter(o[0])}),(i=this.currentCm).focus(),t&&("<Empty \\space Math \\space Block>"==i.getValue()?i.execCommand("selectAll"):"end"==t||"auto"==t?i.execCommand("goDocEnd"):"start"==t&&i.execCommand("goDocStart"),e.refocus(n),null===l||100<l?e.selection.scrollAdjust():r.scrollTop=r.scrollHeight-l-r.clientHeight)}return this.currentCm}function p(i){var r=m(h[0].querySelector(".md-rawblock-input"),{styleSelectedText:!0,styleActiveLine:!0,lineWrapping:!File.option.noLineWrapping,mode:"stex",placeholder:g.localize.getString("Input Math TeX here"),theme:" inner null-scroll",autoCloseBrackets:!File.option.noPairingMatch,autoCloseTags:!File.option.noPairingMatch,value:a.get("text").trim(),lineNumbers:File.option.showLineNumbersForFence,resetSelectionOnContextMenu:!0,dragDrop:!1,indentUnit:File.option.codeIndentSize,tabSize:File.option.codeIndentSize,lineWiseCopyCut:File.option.lineWiseCopyCut},i,n);return r.on("changes",function(e,t){var n;i.fences.handleUserReplacement(e,t),i.wordCount.quickUpdate(r.cid),n=o[0],u&&clearTimeout(u),u=setTimeout(async()=>{await f(n),u=null},100),i.selection.clearGlobalColumn(),i.syncChange([{type:"sync",id:a.id,tex:r.getValue()}]),File.isTypeWriterMode&&!File.option.scrollWithCursor&&i.selection.typeWriterScroll(r.cursorCoords(r.getCursor()))}),r.on("cursorActivity",function(){i.fences.handleCursorActivity(r)}),r.on("blur",function(e){setTimeout(function(){document.body.contains(e.getWrapperElement())&&a.set("text",e.getValue())},0)}),r.on("keydown",function(e,t){i.fences.onKeyDown(e,t,i,function(e){if(!e.getValue().length)return i.mathBlock.remove(e.cid),t.preventDefault(),t.codemirrorIgnore},function(e,t){return t.shiftKey?(t.stopPropagation(),!0):(t.ctrlKey||t.metaKey)&&(!(n=(e=e).doc.getCursor())||e.doc.indexFromPos(n)>=e.doc.getValue().length)?(setTimeout(function(){i.UserOp.insertParagraph()},20),t.stopPropagation(),!0):void 0;var n})}),r.focus(),r}async function f(e){if(w()){t=e,c||(t.hasAttribute("data-math-tag-before")?(c=t.dataset.mathTagBefore,s=JSON.parse(t.dataset.mathLabels||"[]")):c=C(t)),c?(F(c),t.dataset.mathTagBefore=c):t.dataset.mathTagBefore=x().counter,S(JSON.parse(t.dataset.mathLabels||"[]"),x().allLabels);var t=Object.keys(x().allLabels),n=e.querySelector(".CodeMirror");if(n=n&&n.CodeMirror){var i=e.querySelector(".md-mathjax-preview");if(i){var n=n.getValue()||"<Empty \\space Math \\space Block>",r=MathJax.getMetricsFor(i,!0);try{var o=await MathJax.tex2svgPromise(n,r);o.querySelector("[data-mml-node='merror']")&&i.children.length?(i.children[1]&&i.children[1].remove(),o.style.marginTop="8px"):i.innerHTML="",i.appendChild(o)}catch(e){}n=e,r=x().counter,n.dataset.mathTagAfter&&+n.dataset.mathTagAfter!=r&&(n.dataset.mathTagAfter=r,d=!0),JSON.stringify(s)!=n.dataset.mathLabels&&(d=!0);i=Object.keys(x().allLabels);e.dataset.mathLabels=JSON.stringify(k(t,i)),d&&(e.dataset.needRefresh=!0)}}}}}copyAsTex(e){var e=(e||document.activeElement||document.body).getAttribute("cid"),t="";e&&(t=this.editor.getNode(e).get("text").trim()),this.editor.UserOp.setClipboard(null,null,t,!0)}copyAsMathML(e,t){var n="",i=this.editor,e=(e||document.activeElement||document.body).getAttribute("cid")||i.focusCid,e=(e&&(n=i.getNode(e).get("text"),File.option.noDisplayLinesInMath||(n="\\u32E"+n)),MathJax.tex2mml(n,{display:!0}));t?i.UserOp.nativeCopyText(e):(n="<pre class='md-fences' lang='xml'>"+r.escape(e)+"</pre>",i.UserOp.setClipboard(n,null,e,!0))}copyAsImage(e){var e=(e&&e.querySelector||document.activeElement).querySelector("svg"),t=this.editor,e=o.SVG2HtmlImg(e);t.UserOp.setClipboard(e,null,e,!0)}forceRefreshSoon(){this.forceRefreshTimer_&&(clearTimeout(this.forceRefreshTimer_),this.forceRefreshTimer_=null);var e=this;this.forceRefreshTimer_=setTimeout(function(){e.forceRefresh(),e.forceRefreshTimer_=null},10)}cleanUpAMS(){window.MathJax&&MathJax.texReset&&MathJax.texReset(0)}async forceRefresh(){this.editor.sourceView&&this.editor.sourceView.inSourceMode||(w()?(await h(),this.editor.brush.clearAndPause(),this.cleanUpAMS(),await this.renderUnder(document,!0),File.option.enableInlineMath&&await File.editor.mathInline.renderAll(!0),this.editor.brush.resume()):setTimeout(this.forceRefresh.bind(this),500))}}E.isMathType=function(e){return File.option.gitlabMath&&"string"==typeof e&&y.isType((e||"").toLowerCase(),"math")},n.exports=E}),$__System.registerDynamic("4a",["13","11","19","30","57","28","17","15","1c","32","29","e","58","59","2b"],!0,function(e,t,n){"use strict";this||self;var i=e("13"),_=i.Node,A=i.TYPE,M=(i.NodeCollectionUtils,e("11")),L=e("19"),d=e("30"),h=(e("57"),e("28")),N=e("17"),D=e("15"),P=e("1c"),f=e("32"),B=e("29"),R=e("e"),r=e("58"),o=e("59");e("2b");async function a(e,t,n,i,r,o){"custom"==(n=n||{}).type&&(e="custom");var a,s,l,c=R.localize.getString(File.isMac?"Reveal in Finder":"Reveal in File Explorer","Front"),d=!1,u=n.saveDialog;n.runCommand&&(u=!0,s=m.processExportVariables(n.runCommandStr||"",{outputPath:t}),a=f.getCurrentFileFolderPath()||window._options.documentsPath||"/",s=await p(s,a),i=s.message||"",0!=s.code)&&(d=!0,r=s.error||""),d||n.showOutput?(s=a="",r&&(a=`<pre style='user-select: text;font-size: .9em;cursor: text;line-height: 1.4;text-align:left;'>${M.escape(r)}</pre>`),!i&&r||(s=`<pre style='user-select: text;font-size: .9em;cursor: text;line-height: 1.4;text-align:left;'>${M.escape(i)||"(empty)"}</pre>`),l=`<pre style='user-select: text;font-size: .9em;cursor: text;line-height: 1.4;text-align:left;'>${M.escape(n.runCommandStr||n.args||n.command)||"(empty)"}</pre>`,h.showDialog({leftAlign:!0,title:R.localize.getString(d?"Run command after export failed":"Export Success!","Panel"),html:`<div>${R.localize.getString("Command Arguments:","Panel")}</div>${l}<div>${R.localize.getString("Console Output:","Panel")}</div>`+a+s,buttons:u?[c,R.localize.getString("Close")]:[R.localize.getString("Close")],callback:function(e){u&&!e&&JSBridge.showInFinder(t)}}),h.hideNotification()):(d=r?"Export operation succeeded with warnings.":"Export operation finished successfully.",d=R.localize.getString(d,"Panel"),"custom"==e?(n.showOutput&&(d=i.trim().split("\n").last()||d),n.saveDialog||(c=void 0)):n.runCommand&&(d=i.trim().split("\n").last()||d),l=[r||"","custom"==e&&o?R.localize.getString("Command Arguments:","Panel")+" "+o.join(""):""].join("\n----------\n").replace(/^\n\-+\n/,""),h.showNotificationWithTitle(d,l,c,function(){JSBridge.showInFinder(t)},{checkFocus:!0})),n.openExportLocation&&(JSBridge.showInFinder(t),r||setTimeout(h.hideNotification,2e3)),n.openExportFile&&(JSBridge.openFile(t),r||setTimeout(h.hideNotification,2e3)),File.isMac&&File.editor.export.cleanUpTempFiles()}function O(e,s,l,c,d){l=l||{};var u=(s=s||{}).outputPath||l.outputPath||"";function h(e){return"string"==typeof e?"unset"==e?"":e.replace(/\n(.|\n\r)+/g,""):e instanceof Array?e.join(", "):null==e?e:e+""}function p(...e){for(var t of e)if(void 0!==t)return t}return e.replace(/\${([^\r\n}]+)}/gi,function(e,t){var n=(t||"").toLowerCase();if("today"==n)return(new Date).toISOString().substring(0,10);if("outputpath"==n)return u;if("outputfolder"==n||"outputfolderpath"==n)return M.pathByDeleteLastComponent(u);if("outputfoldername"==n)return M.getFolder(u);if("outputfilename"==n)return f.getFileNameFromPath(u).replace(/\..+$/,"");if("outputfilefullname"==n)return f.getFileNameFromPath(u);if("currentpath"==n)return File.bundle.filePath||"";if("currentfolder"==n)return f.getCurrentFileFolderPath()||"";if("currentfilename"==n)return f.getFileNameFromPath(File.bundle.filePath||"").replace(/\..+$/,"");if("currentfilefullname"==n)return f.getFileNameFromPath(File.bundle.filePath||"");if("openedFolder"==n)return File.getMountFolder();var i,r,o=File.editor.localSettingBridge,a=h(p(l[t],l[n],o.getSetting(t),o.getSetting(n),s[t],s[n]));if(null==a&&0<n.indexOf(".")){for(r of n.split(/\./))if(!(i=i?i[r]:o.getSetting(r)||o.getSetting(r.toLowerCase())))break;if(null!=i)return n=h(i),c&&/['";&|><\s]/.exec(n)?""+n.replace(/['"]/g,"")+"":n}return p(a,d,"${"+t+"}")}).replace(/(['"])(.*?)\1/g,function(e,t,n){return t+n.replace(/\uE033|\uE034/g,"")+t}).replace(/\uE033(.*?)\uE034/g,function(e,t){return'"'+t+'"'})}var p=function(e,n){return File.isNode?o.runExportCommand(e,n):File.isMac?new Promise(t=>{bridge.callHandler("controller.runCommand",{args:e,cwd:n||""},function(e){t({code:e[0]?0:-1,message:e[1],error:e[2]})})}):void 0};const s=(e,t)=>{if(e&&(e=r.renderHeaderFooterText(e,t,"${pageNo}","${totalPages}")).trim().length)return(t=document.createElement("SPAN")).textContent=e,t.style.color=R("p").css("color"),t.style.fontFamily="-apple-system",t.style.fontSize="6pt",t.outerHTML};class m{constructor(e){this.editor=e,this.processExportVariables=O,this.onExportSuccess=a,this.registerBridge()}recordLastExport(e,t){delete e.overwrite,delete e.path;t=Object.assign({path:t},e);JSBridge.invoke("export.recordLastExport",t),File.option.lastExport=t,File.option.lastExportNoOverwrite=!1}registerBridge(){var i;File.isMac&&(i=this,bridge.registerHandler("export.exportToNative",function(e,n){i.exportToNative(e.target,function(e,t){n({native:e,option:t})},e.folder,e.option)}),bridge.registerHandler("export.onExportSuccess",function(e,t){a(e.type,e.path,e.option,e.message,e.error,e.args),t&&t()}),bridge.registerHandler("export.onExportCanceled",function(e,t){h.hideNotification()}),bridge.registerHandler("export.onExportFailed",function(e,t){var n=document.createElement("DIV");n.innerHTML=R.localize.getString("Failed to export file to <em>{0}</em>","Panel").format(e.path?M.escape(e.path):R.localize.getString("Export Failed","Panel")),h.hideNotification(),h.showErrorDialog(n.textContent,M.escape(e.error)),console.sendError(e.error,"warning"),t&&t()}),bridge.registerHandler("export.dataForExport",async function(t,n){i.showExportNotification(!0),setTimeout(function(){setTimeout(async function(){t.forImage&&(t=Object.assign({fontSize:"24px",width:640},t));var e=R("[cid]").text(),e=!!/[\u4E00-\u9FCC]{4}/.exec(e);n({suggestedFilename:File.getSuggestedFileName()||"",content:await i.exportToHTML(t||{}),pdfHeader:s(t.header,t),pdfFooter:s(t.footer,t),hasNonAlphabet:e})},i.beforeExport(t.forPrint)?1e3:0),i.showExportNotification(!0)},File.isMac?50:0)}),bridge.registerHandler("export.exportToHTML",function(t,n){i.showExportNotification(!0),setTimeout(async function(){File.sync();var e=await i.exportToHTML(t);n(e)},File.isMac?400:0)}),bridge.registerHandler("export.exportWithCommand",async function(e,t){var n=await i.exportWithCommand(e);e.path||(e.path=e.output),t(n)}),bridge.registerHandler("pdf.getFixData",function(e,t){e=e||{};try{e[":headers:"]=i.editor.library.outline.getHeaderMatrix(!0);var n=i.editor.localSettingBridge.getCalculatedSetting();e=Object.assign(e,n)}catch(e){console.sendError(e)}t(e)}),bridge.registerHandler("export.prepare",function(e,t){File.editor.EditHelper.hideNotification(),t(e=File.editor.localSettingBridge.loadExportOption(e))}))}beforeExport(e){return File.editor.sourceView.inSourceMode?(File.editor.sourceView.hide(),File.editor.library.recoverSidebar(),File.isMac&&bridge.callHandler("window.updateUIAfterExitSourceMode")):(File.editor.store(!0),e=!1),File.sync(),File.editor.nodeMap.toc.updateHTML(),File.megaMenu&&File.megaMenu.hide(),document.body.classList.remove("ty-show-notification"),e}showExportNotification(e){h.showProcessingNotification("Exporting in progress...",e)}exportToNative(e,t,n,i){t=t||function(){},i=i||{};var e="pandoc"==e||"native"==e?i.raw||i.targetFormat:e,r=("latex-pdf"==e?e="latex":"mediawiki"==e&&(e="wiki"),Object.assign({cwd:f.getCurrentFileFolderPath()},i,{target:e,folder:n}));return File.isMac&&i.extraArguments&&(r.extraArguments=i.extraArguments.map(e=>File.editor.export.processExportVariables(e,{outputPath:i.path}))),this.editor.nodeMap.exportToNative(e,function(e){t(e,r)},n,Object.assign({},r))}exportToImage(e){r.exportToImage(e)}async exportAndSaveHTML(t){var e,n=await f.showExportDialog("html",t);n&&(this.recordLastExport(t,n),e=await this.exportToHTML(t),File.fs.writeFile(n,e,e=>{e?(h.showDialog({title:R.localize.getString("Error"),html:R.localize.getString("Failed to export file to <em>{0}</em>","Panel").format(M.escape(n))+"<br/>"+M.escape(e.message),backdrop:"static",type:"error"}),console.sendError(e,"warn")):a("html",n,t)}))}exportCollection(e,r,t){var y=t||{},v=y.forPrint,b=y.noStyle,t=y.exportFooter,o=y.exportInline,w=y.forImage,x=y.anchorMap||{},n=y.anchorList||h.fetchAnchorList(x,b),C=(y.anchorList=n,y.anchorMap=x,this.editor.nodeMap),F=this.editor,o=o||new L.InlineLexer({nodeMap:C,count:1,footnoteList:[],appendFootnote:function(e,t){r[t]||(r[t]=[""],e=o.output(e.get("text"),d.decorateAsExport,!1,{parent:e,skipFootnote:t}),r[t][0]="<span class='md-fn-count'>"+t+"</span> "+e);e=r[t].length-1,e=t+(e?"-"+e:"");return r[t].push(" <a name='dfref-footnote-"+e+"' href='#ref-footnote-"+e+"' title='"+R.localize.getString("back to document")+"' class='reversefootnote' >↩</a>"),e},noStyle:b,forPrint:v,forExport:!0,anchorList:n,skipOp:{atag:!0,underline:!0,comment:!0,imgtag:!0}},d.decorateAsExport),i="",S=void 0===y.split||null===y.split?b?"\n":"":y.split,k=this;function E(e,t){var n,i;return"string"==typeof e?o.output(e,d.decorateAsExport):(n=e.get("children"),_.canContainBlock(e.get("type"))?n&&0<n.length?(y.exportFooter=!1,k.exportCollection(n,r,y)):o.output(e.get("text"),d.decorateAsExport):(n=e.get("parent"),i={},_.isType(e,A.paragraph)&&!e.get("before")&&_.isType(n,A.blockquote)&&n.get("alert")&&(i.alert=!0),o.output(e.get("text"),d.decorateAsExport,void 0,i,t)))}y.exportInline=o,r=r||[];var a=null;function s(){if(b)return"<div>[TOC]</div>";if(!a){var e=R(document.querySelector(".md-toc-content")).clone();if(!e[0])return"";e.find("[data-ref]").each(function(){v?this.querySelector("a").setAttribute("href",(File.isMac?"at://":"#header-")+this.getAttribute("data-ref")):this.querySelector("a").setAttribute("href","#"+x[this.getAttribute("data-ref")])}),e.find(".md-meta").remove(),a="<div class='md-toc' mdtype='toc'>"+e[0].outerHTML+"</div>"}return a}function T(i){function e(t){return t?C.toc.headers.findIndex(function(e){return e.cid==t}):-1}var t={cid:i.cid};switch(i.get("type")){case A.paragraph:if(-1==i.get("text").indexOf("\n")){var n=_.parseFrom(i.getText(),null,{noTop:!0,skips:{fromP:!0,old_code:!1}},!0)[1][0];if(_.isType(n,A.heading)&&(n.cid=i.cid,-1==e(n.cid))&&i.isTopBlock()&&(r=F.findElemById(n.cid).prevAll(".md-heading").first().attr("cid"),C.toc.headers.splice(e(r)+1,0,n)),_.isType(n,A.heading,A.def_footnote,A.def_link))return n.cid=i.cid,T(n)}var r=E(i,t);return""==r||t.hasContent?!y.noStyle&&function(e){if(/^\s*<img /.exec(e||""))return 1==(e=DOMPurify.sanitize(e,N.getDomPurifyConfig(N.INLINE_CONFIG))).childNodes.length&&1===e.children.length&&((e=e.children[0]).style.float||e.getAttribute("align"))}(r)?"<p><span class='md-image'>"+r+"</span></p>":"<p>"+(r||"&nbsp;")+"</p>":r;case A.heading:var n="",r=(v&&1==i.get("depth")&&!i.get("parent")&&i.get("before")&&(n=" data-breakpage"),null),o="";return v?(r=document.createElement("a"),o="header-"+i.cid,r.setAttribute("name",o),r.setAttribute("class","md-header-anchor md-print-anchor"),r.setAttribute("href","af://"+i.cid),r.innerText=" "):o=x[i.cid],`<h${i.get("depth")}${n}${r||!o?"":" id='"+M.escapeInQuote(o)+"'"}>${r?r.outerHTML:""}${E(i,t)}</h${i.get("depth")}>`;case A.blockquote:n=i.get("alert");return _.isType(n,"note","warning","important","tip","caution")?`<div class="md-alert md-alert-${n} ${n}">`+E(i,t)+"</div>":"<blockquote>"+E(i,t)+"</blockquote>";case A.list:o=i.get("style"),r=function(){for(var e=i.get("children").toArray(),t=0;t<e.length;t++){var n=e[t].getFirstChild();if(!_.isType(n,A.paragraph)||n.get("after"))return!0}return!1}(),n=(i.set("loose",r),"");return o==_.ListType.ol&&(n=""===i.get("start")?void 0:+i.get("start"),n=Number.isNaN(n)||1==n?"":" start='"+i.get("start")+"' "),"<"+o+n+">"+S+E(i,t)+S+"</"+o+">";case A.list_item:return i.get("style")===_.ListType.task?"<li"+(b?"":" class='md-task-list-item task-list-item task-list-"+(i.get("checked")?"done":"not-done")+"' ")+"><input type='checkbox' "+(i.get("checked")?"checked":"")+"/>"+E(i,t)+"</li>":"<li>"+(r=i,n=t,b&&!1===r.get("parent").get("loose")?E(r.getFirstChild(),n):E(r,n))+"</li>";case A.fences:o=i.get("lang")||"";if(b)return o?"<pre"+L.attrToString(L.parsePandocAttr(o))+"><code class='language-"+(o=M.escapeInQuote(getCodeMirrorMode(o,!1,!0)))+"' lang='"+o+"'>"+M.escape(i.get("text"))+S+"</code></pre>":"<pre><code>"+M.escape(i.get("text"))+S+"</code></pre>";var a,s,l=F.findElemById(i.id).clone();if(D.isDiagramType(o))return a=!1,s=F.findElemById(i.id).find("svg"),y.mermaidSVGs&&y.mermaidSVGs[i.id]&&l.find("svg").replaceWith(y.mermaidSVGs[i.id]),d=l.find("svg"),!s.attr("width")||s.attr("viewBox")||/%/.exec(s.attr("width"))?s.attr("max-width")&&(d.css("width",s.attr("max-width")),d.css("max-width","")):(d.attr("viewBox","0 0 "+s.attr("width")+" "+s.height()),d.css("max-width","100%"),d.css("height","auto")),(s=l.find(".md-diagram-panel").attr("lang",o).html(l.find(".md-diagram-panel-preview").html())[0])?B.processExportedSVG(s.outerHTML,!0):"";if(P.isMathType(i.get("lang")))return k.getSVGForExport(i,w);!1!==a&&(a=13<i.get("text").split(/\n/).length);var c,d=document.querySelector(".md-fences .CodeMirror-linenumber");return!y.fenceLineFontSize&&d&&w&&(y.fenceLineFontSize=window.getComputedStyle(d).fontSize,o=document.querySelector(".md-fences .CodeMirror-line"))&&y.fontSize&&("number"==typeof y.fontSize?o.style.fontSize=y.fontSize+"px":o.style.fontSize=y.fontSize,y.lineNumberLineHeightStyle=window.getComputedStyle(o).lineHeight,y.lineNumberLineHeightStyle=`line-height:${y.lineNumberLineHeightStyle};`,o.style.fontSize=""),l.children(".CodeMirror").length&&(l.removeAttr("cid").removeAttr("contenteditable").removeAttr("mdtype").html(l.children(".CodeMirror")[0].outerHTML).find(".CodeMirror-cursors, .CodeMirror-hscrollbar, .CodeMirror-vscrollbar, .CodeMirror-selected").remove().end().find(".CodeMirror-sizer").css("min-height","").end().find(".CodeMirror-selectedtext").removeClass("CodeMirror-selectedtext").end().find("[cm-zwsp]").text("\n"),y.fenceLineFontSize)&&l.find(".CodeMirror-linenumber").each(function(){y.fenceLineFontSize&&this.setAttribute("style",this.getAttribute("style")+";font-size:"+y.fenceLineFontSize+" !important;"+(y.lineNumberLineHeightStyle||""))}).end().find(".CodeMirror-gutters").css("height","100%"),v&&File.option.noLineWrapping&&l.children(".CodeMirror").addClass("CodeMirror-wrap").find(".CodeMirror-sizer").css("min-width",""),a&&l.css("page-break-inside","unset"),v&&File.isNode&&(c=(c=window.getComputedStyle(File.editor.writingArea).fontFamily||"initial").replace(/'/g,"\\'"),l.find(".CodeMirror-line > span").each(function(){!function t(e,n){var i;e.nodeType==document.TEXT_NODE?(i=(i=e.textContent).split(/(;|-)/).map(function(e){return";"==e||"-"==e?"<span style='font-family:"+n+"'>"+e+"</span>":M.escape(e)}).join(""))!=e.textContent&&(e.innerHTML=i):1==e.nodeType&&e.childNodes.forEach(function(e){t(e,n)})}(this,c)})),l[0].outerHTML.trim();case A.html_block:return N.buildHTMLForExport(i.get("text"),F,v,i);case A.math_block:return y.noStyle&&"latex"==File.option.mathFormatOnCopy?"<div>$$\n%@\n$$</div>".replace("%@",M.escape(i.get("text"))):k.getSVGForExport(i,w,!y.forPrint&&!y.forImage&&!y.noStyle);case A.hr:return"<hr />";case A.def_footnote:case A.def_link:return"";case A.table:for(var u="<figure class='table-figure'><table>"+S,h=i.getFirstChild();h;)h.get("before")?u+=T(h):u+="<thead>"+S+T(h)+"</thead>"+S+"<tbody>",(h=h.get("after"))||(u+="</tbody>"+S);return u+="</table></figure>";case A.table_row:for(var p,u="<tr>",h=i.getFirstChild(),f=i.get("parent").get("align"),m=0,g=i.get("before")?"td":"th";h;)u+="<"+g+((p=f[m])?" style='text-align:"+p+";' ":"")+">"+T(h)+"</"+g+">",h=h.get("after"),m++;return u+="</tr>";case A.table_cell:return E(i,t)||"&nbsp;";case A.meta_block:return"";case A.toc:return"";default:return"<p>"+E(i,t)+"</p>"}}if("string"==typeof e)return E(e);if(e.length)for(var l=e instanceof Array,c=l?e[0]:e.sortedFirst();i+=T(c)+S,(c=c.get("after"))&&(!l||-1<e.indexOf(c)););return(i=i.replaceAll?i.replaceAll("",s):i.replace(/\uE088/g,s))+(t?I(r):"")}getSVGForExport(e,t,n){var i=this.editor,r=i.findElemById(e.refcid||e.id).clone(),o=r.find("svg");return n||r.find("mjx-assistive-mml").remove(),!o.length&&e.refcid&&(e.refcid=void 0,(r=i.findElemById(e.id)).find("svg")),t?(n=r.find("mjx-container").clone())[0]?B.processExportedSVG(n[0].outerHTML,!0):"<p class='md-math-block'>$$"+M.escape(e.get("text"))+"$$</p>":((r=r.clone()).find(".md-rawblock-tooltip, .CodeMirror").remove(),r.length?B.processExportedSVG(((o=r[0]).innerHTML=o.innerHTML.trim(),o.children[0].innerHTML=o.children[0].innerHTML.trim(),o).outerHTML,!0):"<p class='md-math-block'>{math}</p>".replace("{math}","$$\n"+M.escape(e.get("text"))+"\n$$"))}async exportToHTML(u){var h=(u=u||{}).forPrint,e=u.noStyle,t=u.noBackground,n=u.forImage,i=u.extraCss,r="",o=this.editor.nodeMap,a=this.editor,s=[],l=File.editor.docMenu.getValueInMeta("title")||(File.getFileName()||"").replace(/\.(md|mmd|markdown|txt|text|mdwn)$/i,""),p=File.option.enableDiagram&&R(".md-fences[lang='mermaid']").length,f=p||R(".md-fences").length,m="",c=(e||(a.mathBlock.currentCm&&a.mathBlock.currentCm.cid&&await a.mathBlock.stopEditing(a.mathBlock.currentCm.cid),a.fences.decorateAll()),"latex"!=File.option.mathFormatOnCopy&&await a.mathInline.renderAll(!1,a.writingArea,!1,!0),File.option.showLineNumbersForFence&&a.fences.refreshEditor(!0),{forPrint:h,noStyle:e,forImage:n,fontSize:u.fontSize,anchorMap:{}});function d(e,t){return null==e||""===e?t:e}function g(e){if(File.isMac)return bridge.callSync("path.readText",e);if(File.isNode){try{return reqnode("fs").readFileSync(e,"utf-8")}catch(e){}return""}}var y,v,b,w,x=0;function C(e){return"file://"+(File.isNode?window._options.userDataPath+"/themes/"+e:_options.currentThemeFolder+"/"+e)}function F(){return`
<script>(${function(){function e(e,n,i){document.addEventListener(e,function(e){if(!e.defaultPrevented)for(var t=e.target;t&&t!=this;t=t.parentNode)if(t.matches(n)){!1===i.call(t,e)&&(e.preventDefault(),e.stopPropagation());break}},!1)}var t=document.body.parentElement,i=[],r=null,o=document.body.classList.contains("typora-export-collapse-outline");function a(){return t.scrollTop}e("click",".outline-expander",function(e){var t=this.closest(".outline-item-wrapper").classList;return t.contains("outline-item-open")?t.remove("outline-item-open"):t.add("outline-item-open"),u(),!1}),e("click",".outline-item",function(e){var t=this.querySelector(".outline-label");location.hash="#"+t.getAttribute("href"),o&&((t=this.closest(".outline-item-wrapper").classList).contains("outline-item-open")||t.add("outline-item-open"),d(),t.add("outline-item-active"))});function s(){var e=a();r=null;for(var t=0;t<i.length&&i[t][1]-e<60;t++)r=i[t]}function n(){c=setTimeout(function(){var n;i=[],n=a(),document.querySelector("#write").querySelectorAll("h1, h2, h3, h4, h5, h6").forEach(e=>{var t=e.getAttribute("id");i.push([t,n+e.getBoundingClientRect().y])}),s(),u()},300)}var l,c,d=function(){document.querySelectorAll(".outline-item-active").forEach(e=>e.classList.remove("outline-item-active")),document.querySelectorAll(".outline-item-single.outline-item-open").forEach(e=>e.classList.remove("outline-item-open"))},u=function(){if(r&&(d(),t=document.querySelector('.outline-label[href="#'+(CSS.escape?CSS.escape(r[0]):r[0])+'"]')))if(o){var e=t.closest(".outline-item-open>ul>.outline-item-wrapper");if(e)e.classList.add("outline-item-active");else{for(var t,n=(t=t.closest(".outline-item-wrapper")).parentElement.closest(".outline-item-wrapper");n;)n=(t=n).parentElement.closest(".outline-item-wrapper");t.classList.add("outline-item-active")}}else t.closest(".outline-item-wrapper").classList.add("outline-item-active")};window.addEventListener("scroll",function(e){l&&clearTimeout(l),l=setTimeout(function(){s(),u()},300)});window.addEventListener("resize",function(e){c&&clearTimeout(c),n()}),n()}.toString()})();</script>`}function S(t){if(!t)return["",!1];t=t||"";var n=!1;try{t instanceof Array&&(t=t.join("\n"));var e=(new DOMParser).parseFromString(t,"text/html");return e.querySelectorAll("meta").forEach(e=>{e.content=O(e.content,u,void 0,void 0,"")}),e.querySelectorAll("title").forEach(e=>{n=!0,e.innerText=O(e.innerText,u)}),[t=e.head.innerHTML+e.body.innerHTML,n]}catch(e){return[t,n]}}function k(e,n,t){if(!e)return"";n=n||[];var i,r,o=/^\s*@include-when-export\s+(url)?([('"]+)([^\)"']+)([)'"]+)/im;function a(e,t){e&&n.push(E(e,t))}if(!h)try{(r=e.match(/^\s*@include-when-export\s.+$/gim))&&r.map(function(e){a((i=o.exec(e)||[])[3])})}catch(e){}o=/^\s*@import\s+(url)?([('"]+)([^\)"']+)([)'"]+)/im;try{(r=e.match(/^\s*@import\s.+$/gim))&&r.map(function(e){!(i=o.exec(e)||[])[3]||/\.css/.exec(i[3])&&!/^https?:/.exec(i[3])||a(i[3],t)})}catch(e){}return n.map(function(e){return"<link href='"+e+"' rel='stylesheet' type='text/css' />"}).join("\n")}function E(e,t){return e=(e=e.replace(/^typora:\/\/app\/typemark/i,function(){return location.href.replace(/[\\\/]+[^\\\/]+$/g,"")})).replace(/^wkfile:/,"file:"),e=M.getFilePathFromProxy(e),e=/:\/\//.exec(e)?e:"file://"+(e=M.getAbsolutePath(t,e))}function T(){var e,t,n,i,r,o=[];function a(){void 0!==u.splitPages&&(m+="<style type='text/css'>@media print {[data-breakpage]{page-break-before: %@;}#write>[data-breakpage]:first-child {page-break-before: avoid}}</style>".replace("%@",u.splitPages?"always":"avoid"))}if(m="",h)return document.querySelectorAll("link[css-include]").forEach(function(e){m+="<link rel='stylesheet' href='"+M.escapeForPreWrap(E(e.href))+"' type='text/css' />"}),u.exportTheme?[(t=u.exportTheme)+".css","base.user.css",t+".user.css"].map(e=>{"base.user.css"==e&&a(),m+="<link rel='stylesheet' href='"+M.escapeForPreWrap(C(e))+"' type='text/css' />\n"}):["theme_css","base_user_css","theme_user_css"].map(function(e){"base_user_css"==e&&a(),File.isMac?m+="<link rel='stylesheet' href='"+M.escapeForPreWrap(R("#"+e).attr("href").replace(/^wkfile:/,"file:"))+"' type='text/css' />\n":m+="<link rel='stylesheet' href='"+M.escapeForPreWrap(E(R("#"+e).attr("href")))+"' type='text/css' />\n"}),"";s=["(base\\.css)"],(t=["theme_css","base_user_css","theme_user_css"].map(function(e){return i=[],r=(u.exportTheme&&"theme_css"==e?C(u.exportTheme+".css"):u.exportTheme&&"theme_css"==e?C(u.exportTheme+".user.css"):E(R("#"+e).attr("href"))).replace(/^file:\/\//,""),k(n=g(r),i,r),i.forEach(function(e){(/^\/\//.exec(e)||/.+:\/\//.exec(e))&&(m+="<link href='"+e.replace(/^wkfile:/,"file:")+"' rel='stylesheet' type='text/css' />")}),function n(e,i){var r=/^["']/,o=[];function a(e){var t=(e.match(r)||[""])[0];return e=decodeURI(t.length?e.substring(1,e.length-1):e),e=(e=M.getAbsolutePath(i,e)).match(/\.css$/)?(o.push(n(g(e),e)),""):(File.isMac?"file://":"file:///")+e,t+encodeURI(e)+t}return i=E(i).replace(/^file:\/\/?/,""),e=(e||"").replace(/@charset[^;\n]+;?/g,"").replace(/@font\-face\s*{[^}]+}\s*\n/g,"").replace(/(^|;|\n)[\s]*@import([^;\n]+)(;|$|\n)/g,function(e,t){var n=(/['"]([^"']+)['"]/.exec(e)||[])[0];return n?e.replace(n,a(n)):e}).replace(/url\([^:)]+\)/gi,function(e){return"url("+a(e=e.substring(4,e.length-1))+")"}),e=o.join("\n")+e}(n,r)}).join("\n"))||s.push("(theme)"),f&&s.push("(codemirror)"),p&&s.push("(mermaid)");for(var s=new RegExp(s.join("|"),"i"),l=0;l<document.styleSheets.length;l++)if(e=document.styleSheets[l],s.exec(e.href)&&(function e(t){var n,i=[];try{i=t.cssRules}catch(e){t.href}for(n in i){var r=t.cssRules[n];r.styleSheet?r.href.match(/mermaid/i)&&!p||r.href.match(/sourcemode\.dark\.css/i)||e(r.styleSheet):/@font\-face/.exec(r.cssText||"")||o.push((r.cssText||"").replace(/content: ([^;]{1});/g,"content: '$1';"))}}(e),/themes/.exec(e.href)))try{var c=E(e.href),d=decodeURI(c.replace(File.isWin?/^[\w_-]+:[\/]+/:/^[\w_-]+:\/\/?/,""));m+=k(g(d),void 0,d)}catch(e){}return t&&o.push(t),o.join("\n")}return u.exportTheme||(h&&!n&&File.colorBrightness<.5&&(File.isNode&&(u.exportTheme="github"),t)&&File.isMac&&(u.exportTheme="github"),u.exportTheme),e||(r=T()),p&&u.exportTheme&&!e&&((y=r)||[u.exportTheme+".css",u.exportTheme+".user.css"].map(e=>{y+=function t(e){x++;var n,i=g(e);return 10<x||(k(i,n=[],e),n.forEach(function(e){/^file:\/\//.exec(e)&&(i=t(e.replace(/^file:\/\//,""))+i)})),i}(C(e).replace("file://",""))}),c.mermaidSVGs=await a.diagrams.mermaidSvgForExportTheme(y)),t=this.exportCollection(o.blocks,s,c),o=l,s.length&&(t+="<div class='footnotes-area' "+(h?"data-breakpage":"")+" ><hr/>"+I(s)+"</div>"),l=h?"<script> window.setBreakPage = function(b){var node = document.querySelectorAll('[data-breakpage]'); for(var i=0;i<node.length;i++){node[i].style.pageBreakBefore = b ? 'always':'auto' } return node[0] && node[0].style.pageBreakBefore};<\/script>":"",s=h?File.isMac?"is-mac":"is-node":"",(v=u.fontSize||document.body.parentElement.style.fontSize||"")&&("number"==typeof v&&(u.fontSize=v+="px"),v=" style='font-size:"+v+" !important'"),h&&File.isMac&&(l+="<script>("+function(){for(var e=document.querySelectorAll("#write a, #write [id]"),t=/^\s*#(.+)$/,n={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"'":"\\'","\\":"\\\\"},i=function(e){return e.replace(/["\\\b\t\n\f\r]/g,function(e){return n[e]}).replace(/\u200b/g,"")},r=0;r<e.length;r++){var o,a,s=e[r],l=s.getAttribute("name")||s.getAttribute("id"),c=s.getAttribute("href");s.classList.contains("md-print-anchor")||(l&&(o=document.createElement("a"),a=document.createTextNode(" "),o.appendChild(a),o.setAttribute("class","md-print-anchor"),o.setAttribute("href","uaf://"+i(l)),s.parentNode.insertBefore(o,s)),c&&(a=t.exec(c))&&(c=a[1],s.setAttribute("href","uat://"+i(c))))}}.toString()+")();<\/script>"),h&&(l+="<script>("+function(){for(var e=document.querySelectorAll("figure>table"),t=0;t<e.length;t++){var n=e[t],i=n.parentElement,r=i.scrollWidth,o=i.offsetWidth;o<r&&50<r&&(n.style.zoom=o/r,i.style.overflowX="visible")}}.toString()+")();<\/script>"),b=S(u.appendHead),w=S(u.appendHeadExtra),b[0]=b[0]+w[0],b[1]=b[1]||w[1]?"":`<title>${M.escape(o||"")}</title>`,w=S(u.appendBody)[0]+S(u.appendBodyExtra)[0],e?`<!doctype html>
<html>
<head>
<meta charset='UTF-8'><meta name='viewport' content='width=device-width initial-scale=1'>
${b[1]}
${b[0]}</head>
<body>`+t+w+`</body>
</html>`:(o=["typora-export"],n?(o.push("for-image"),r+=" ::-webkit-scrollbar {display: none;} "):h&&(o.push("typora-print"),r+=function(){for(var e=[""],t=1;t<7;t++){var n,i="h"+t,r=document.querySelector("#write "+i);r&&(n=window.getComputedStyle(r),/^0px/.exec(n.border||""))&&/ 0px$/.exec(n.outline||"")&&"none"===n.boxShadow&&"none"===n.backgroundImage&&"rgba(0, 0, 0, 0)"===n.backgroundColor&&("none"!==(n=window.getComputedStyle(r,"after").content)&&n||e.push(`.typora-export ${i}::after {content: "";display: block;height: 100px;margin-bottom: -100px;}`))}return e.join("\n")}()),document.querySelector("mjx-container")&&(r+=MathJax.svgStylesheet().innerHTML,n||(r+=`mjx-container[jax="SVG"] path[data-c], mjx-container[jax="SVG"] use[data-c] {
							stroke-width: 0;
						}`)),File.isMac?r+=" @media print { @page {margin: 0 0 0 0;} body.typora-export {padding-left: 0; padding-right: 0;} #write {padding:0;}}":u["paper.margin"]&&("custom"===u["paper.margin"]?r+=" @media print { @page {margin: $1mm 0 $3mm 0;} body.typora-export {padding-left: $2mm; padding-right: $4mm;} #write {max-width: initial;}}".replace("$1",d(u["paper.marginTop"],"16")).replace("$2",d(u["paper.marginLeft"],"16")).replace("$3",d(u["paper.marginBottom"],"16")).replace("$4",d(u["paper.marginRight"],"16")):o.push("typora-export-margin-"+(u["paper.margin"]||"default"))),File.option.preLinebreakOnExport||(r+=" .typora-export li, .typora-export p, .typora-export,  .footnote-line {white-space: normal;} h1,h2,h3,h4,h5 {white-space:pre-line}"),File.option.indentFirstLine&&(s+=" first-line-indent"),document.body.classList.contains("os-windows")&&(o.push("os-windows"),File.option.monocolorEmoji)&&o.push("monocolor-emoji"),i&&(r+=" "+i),e="",u.sidebar&&(a.library.outline.updateOutlineHtml(a.nodeMap.toc,!0),(e=!(n=R("#outline-content").html())||R("#outline-content").find(".outline-item").length<=1?"":((n=R("<div class='typora-export-sidebar'><div class='outline-content'>"+n+"</div></div>")).find(".outline-label").each(function(){this.classList.contains("outline-active")&&(this.classList.remove("outline-active"),this.parentElement.classList.remove("outline-item-active")),this.setAttribute("href","#"+c.anchorMap[this.getAttribute("data-ref")]),this.removeAttribute("data-ref"),this.outerHTML=this.outerHTML.replace(/^<span/,"<a").replace(/<\/span>$/,"</a>")}),n.find(".outline-item-signle").removeClass("outline-item-signle"),document.body.classList.contains("no-collapse-outline")&&n.find(".outline-item-single").removeClass("outline-item-single"),n[0].outerHTML))&&(o.push("typora-export-show-outline"),document.body.classList.contains("no-collapse-outline")?o.push("typora-export-no-collapse-outline"):o.push("typora-export-collapse-outline")),l+=F()),`<!doctype html>
<html${v}>
<head>
<meta charset='UTF-8'><meta name='viewport' content='width=device-width initial-scale=1'>
${b[0]}
${m}<style type='text/css'>html {overflow-x: initial !important;}${r}
</style>${b[1]}
</head>
<body class='${o.join(" ")}'><div class='typora-export-content'>
${e}<div id='write' ${h?"style='top:auto'":""} class='${s}'>${t}</div></div>
${l}${w}</body>
</html>`)}cleanUpTempFiles(){}async exportWithCommand(e){var t,n="",i=("saveFolder"==e.saveDialog&&(n=await f.showExportDialog(void 0,Object.assign({selectFolder:!0},e))),"saveFile"==e.saveDialog&&(i=((e.extensions||"").trim().split(/\s+/g)||[]).map(e=>e.replace(/^\./,"")),n=await f.showExportDialog(void 0,e,i?[{name:e.label||"Exported File",extensions:i},{name:R.localize.getString("All Files","Panel"),extensions:["*"]}]:void 0)),m.processExportVariables(e.command||"",{outputPath:n}));return!n&&e.saveDialog?(document.body.classList.remove("ty-show-notification"),null):(t=f.getCurrentFileFolderPath()||window._options.documentsPath||"/",File.isNode&&o.customExport(n,i,t,e),this.recordLastExport(e,n),{output:n,args:i||"",cwd:t,option:e})}}function I(e){return e.map(function(e){return"<div class='footnote-line'>"+e.join("")+"</div>"}).join("\n")}m.processExportVariables=O,m.onExportSuccess=a,n.exports=m}),$__System.registerDynamic("58",["28","11","32"],!0,function(e,t,n){"use strict";this||self;var d=e("28"),g=e("11"),u=e("32");const y=1.3281472327365,i=72/25.4,v=1/72,b=30;var c=function(e){for(var t=e.getPages(),n=t.length,i=t[0].getHeight(),r={},o=PDFLib.PDFName.of("Subtype"),a=PDFLib.PDFName.of("Rect"),s=PDFLib.PDFName.of("URI"),l=PDFLib.PDFName.of("A"),c=0;c<n;c++)for(var d=t[c].node.Annots(),u=d?d.size():0,h=0;h<u;h++)try{var p,f,m,g,y=d.lookup(h,PDFLib.PDFDict),v=y.get(o);v&&"/Link"===v.asString()&&(p=y.get(l))&&(f=p.get(s).asString(),m=y.get(a).asRectangle(),g=/^af:\/\/(.+)$/.exec(f||""))&&(r[g[1]]=[c+1,i-m.height-m.y])}catch(e){console.sendLog(e,!0)}return r};const w=(e,t)=>{return"custom"===e["paper.margin"]?void 0===(e=e["paper."+t])||""===e?45:Math.round(+e*i):30};function x(e,t,n,i){return File.editor.export.processExportVariables(e,Object.assign({title:u.getFileNameFromPath(File.bundle.filePath||"").replace(/\..+$/,""),author:""},t),{pageno:n,totalpages:i,pagecount:i})}t.renderHeaderFooterText=x;const h=async function(o,a){var e=o.getPages(),t=Math.min(w(a,"marginTop"),b),n=Math.min(w(a,"marginBottom"),b),s=w(a,"marginLeft")||0,l=w(a,"marginRight")||0,c=(s==l&&(l=s=0),e[0].getWidth());var d,i=a.header,r=a.footer,[u,h]=(r=r,d=e,await[await p(i,t),await p(r,n)]);async function p(e,t){if(!e)return null;for(var n=[],i=0;i<d.length;i++){var r=x(e,a,i+1,d.length);n.push(function(e,t){var{fontFamily:n,color:i}=a.textStyles||{},n=n&&g.escapeForPreWrap(n),t=(t-8)*y;return`<p style="font-size:12px;text-align:center;margin:0;padding:0 ${l}px 0 ${s}px;height:${t}px;line-height:${t}px;page-break-before:avoid;page-break-after:always;font-family:${n||"inherit"};color:${i||"inherit"};"><span style="display: inline-block;vertical-align: middle;">${g.escape(e)}</span></p>`}(r,t))}return async function(e,t){var n=g.tempString()+".html",n=reqnode("path").normalize(File.option.tempPath+"/"+n),[e]=(await reqnode("fs-extra").outputFile(n,e),await JSBridge.invoke("export.printToPDF",n,{printBackground:!1,marginsType:1,margins:{top:0,bottom:0,left:0,right:0},pageSize:{width:c*v,height:t*v}})),n=(await PDFLib.PDFDocument.load(e)).getPages();return o.embedPages(n)}(`<html style="margin:0;padding:0;"><head><meta charset="utf-8"></head><body style="margin:0;padding:0;">${n.join("\n")}</body></html>`,t)}for(var f=0;f<e.length;f++){var m=e[f];u&&m.drawPage(u[f],{x:0,y:m.getHeight()-t}),h&&m.drawPage(h[f],{x:0,y:0})}return C(o,a),o.save()};var p,f,C=function(e,t){e.setTitle(t.title||""),e.setSubject(t.subject||""),e.setAuthor(t.author||""),e.setCreator(t.creator||"Typora"),e.setProducer("Typora, Electron")},m=function(d,e,t){t=t||{};var n=new TPDFAnalyst,u=new TPDFOutLineMaker,h=File.editor.library.outline.getHeaderMatrix(!0);n.LoadFromStream(e);e=t.keywords||t.tags||[],u.Info.Keywords=(e="string"==typeof e?[e]:e).join(", "),t=(new Date).toISOString().replace(/\.\d+Z$/,"").replace(/[-T:]/g,"");return u.Info.CreationDate=t,u.Info.ModDate=t,u.View.PageMode=TPDFPageMode.pmUseOutlines,function e(t,n,i,r){for(var o=7,a=null,s=i;s<r;s++){var l=h[s],c=l[0];if(c<=n)return s;(o=7==o?c:o)<c?s=e(a,o,s,r)-1:(c=d[l[2]])&&(a=t?t.AddChild(l[1],c[0],c[1],"",!1,!1,null):u.OutLine.AddRoot(l[1],c[0],c[1],"",!1,!1,null))}return r}(null,0,0,h.length),u.Save(n)},r=null,l=async e=>{var t=+new Date+"-"+Math.random()+".html",t=reqnode("path").normalize(File.option.tempPath+"/"+t);return await reqnode("fs-extra").outputFile(t,e),t};t.makeTempFile=l,t.print=()=>{File.editor.export.showExportNotification(),File.editor.export.beforeExport(!0),async function(e){e=await File.editor.export.exportToHTML({forPrint:!0,extraCss:e?"body {font-variant-ligatures: no-common-ligatures;}":""}),e=await l(e),e=JSBridge.invoke("export.genPrintView",e,r);return r=null,e}(!0).then(e=>{setTimeout(()=>{JSBridge.invoke("export.print",e,{silent:!1,cleanupAfter:!0}),document.body.classList.remove("ty-show-notification")},300),Analytics.record("print")})};const F=t=>new Promise(e=>{setTimeout(e,t)});t.exportPDF=async function(o){async function e(e){return!(-1<["github","whitey","pixyll","newsprint","gothic"].indexOf(e))&&(e=`<html><head><link rel='stylesheet' href='${g.escapeInQuote((e=e+".css","file://"+(File.isNode?window._options.userDataPath+"/themes/"+e:_options.currentThemeFolder+"/"+e)))}' type='text/css' /></head></html><body><div id="write"><p>test</p></div></body>`,e=await l(e),e=await JSBridge.invoke("export.getPageColor",e),u.getColorBrightness(e)<.5)}o=o||{};var t=File.colorBrightness<.5;if(t=o.exportTheme?await e(o.exportTheme):t){t=(await JSBridge.invoke("dialog.showMessageBox",{type:"warning",title:$.localize.getString("Dark Theme not support","Panel"),message:$.localize.getString('Sorry, current version of Typora won\'t print background color on exported PDF, So dark theme is not yet supported for PDF exporting. \nPlease choose a light theme or click "Print with default theme"',"Panel"),buttons:[$.localize.getString("Print with default theme","Panel"),$.localize.getString("Cancel")],defaultId:0,cancelId:1}))["response"];if(0!==t)return void document.body.classList.remove("ty-show-notification");o.exportTheme="github"}await F(1);var t={forPrint:!0},t=(Object.assign(t,o),await File.editor.export.exportToHTML(t)),n=+new Date+"-"+Math.random()+".html",a=reqnode("path").normalize(File.option.tempPath+"/"+n);function i(e){e?d.showNotificationWithTitle($.localize.getString("Export Failed","Panel"),e,$.localize.getString("Support Document"),function(){var e=File.option.useMirrorInCN?"typoraio.cn":"typora.io";JSBridge.showInBrowser(`https://support.${e}/Export/#trouble-shooting`)}):document.body.classList.remove("ty-show-notification"),r=null}await reqnode("fs-extra").outputFile(a,t);var r=new Promise(async(e,t)=>{File.editor.export.beforeExport(!0)&&await F(1900),File.editor.export.showExportNotification();var n=o.paper||"A4",[n,i,r]=("custom"===n&&(n={width:(o["paper.custom"][0]||210)*(1/25.4),height:(o["paper.custom"][1]||297)*(1/25.4)}),await JSBridge.invoke("export.printToPDF",a,{printBackground:!1,marginsType:0,pageSize:n}));o.textStyles=i?JSON.parse(i):null,n?e(await async function(e,r,o){var t=Buffer.from(r),n={data:r};try{var i=File.editor.localSettingBridge.getCalculatedSetting();o=Object.assign(o,i)}catch(e){console.sendError(e)}function a(e){return n.warning="Failed to add book to exported PDF\n"+(e.message||e.details),d.showNotification(`<span class='typora-pdf-warning'>${$.localize.getString("[Warning] Failed to attach bookmark for PDF file.","Panel")}</span>`,!0),n.data=t,n}if(e)return a(e);try{var s=await PDFLib.PDFDocument.load(r);const l=c(s);return await new Promise((n,t)=>{var i=new FileReader;i.onloadend=async function(){var e=Buffer.from(new Uint8Array(i.result)),t={};try{e=await h(await PDFLib.PDFDocument.load(e),o)||e}catch(e){t.warning="Failed to add header / footer.\n"+(e.message||e.details)}t.data=e,n(t)},i.onerror=i.onabort=e=>{t(e)},i.readAsArrayBuffer(m(l,r,o))})}catch(e){return a(e)}}(null,n,o)):t("Failed to export as PDF. "+r)}),s=await u.showExportDialog("pdf",o);console.sendLog("export PDF to "+s),s?(File.editor.export.recordLastExport(o,s),r.then(function(t){File.fs.writeFile(s,t.data,function(e){e?i(e):$("#md-notification .typora-pdf-warning").length||File.editor.export.onExportSuccess("pdf",s,o,"",t.warning)})},i)):i()};var S,k,E=File.isWin?8e3:960,e=File.isWin?5:40,T=E*e,_=1;function A(e){S=null,f&&(JSBridge.invoke("export.destroyPrintView",f),f=null),p&&(p.postMessage("terminate"),p.terminate(),p=null),e&&document.body.classList.remove("ty-show-notification")}window.releaseCaptureWin_=A,t.exportToImage=async o=>{(o=Object.assign({imageWidth:640,imageFontSize:"24px"},o||{},{forPrint:!0,forImage:!0})).fontSize=o.imageFontSize,o.useThemeFontSize&&(o.fontSize=void 0);var a,s=o.imageWidth,l=0;function c(e){console.sendError(e.stack||e,"warning"),S&&d.showErrorDialog("Export Failed",e.stack||e),null===k&&(k=e.stack||e),A(!0)}A(!0),k=null,File.editor.store(!0),File.editor.export.showExportNotification();var e=await File.editor.export.exportToHTML(o);(p=new Worker((window.debugMode?"lib":"lib.asar")+"/image-worker.js")).onmessage=function(e){e.data.success?(File.editor.export.onExportSuccess("image",S,o),A(!0)):c(e.data.error)};var t=+new Date+"-"+Math.random()+".html",n=reqnode("path").normalize(File.option.tempPath+"/"+t),t=(reqnode("fs-extra").outputFile(n,e).then(()=>{JSBridge.invoke("export.prepareImageCapture",n,{imageWidth:s,quality:+(o.quality||0)}).then(e=>{e?(f=e.winId,a=e.totalHeight,E=e.pageHeight||E,_=e.scale||1,T<a?c("Generated Image too Large"):async function e(t){var n,i,r=a-t;E<r&&(r=E),p&&(null!=(n=await JSBridge.invoke("export.captureImage",f,t,{imageWidth:s,pageHeight:r,quality:+(o.quality||0)}))&&f?({newScrollHeight:n,data:i}=JSON.parse(n),a+100<n&&(p.postMessage({action:"updateTotalHeight",totalHeight:n}),a=n),p.postMessage({action:"addImage",buffer:i,index:l,position:{width:s*_,offset:t*_},totalHeight:a*_,total:Math.ceil(a/E)}),t+r<a&&(l++,e(t+=r))):c(""))}(0)):c("Failed to create image view for web content")}).catch(e=>{A(!0)})}),await u.showExportDialog("png",o,[{name:"PNG",extensions:["png"]},{name:"JPEG",extensions:["jpg","jpeg"]}]));if(!t)return A(!0);File.editor.export.recordLastExport(o,t),S=t,p?p.postMessage({action:"setPath",path:t}):d.showErrorDialog("Export Failed",k)}}),$__System.registerDynamic("5a",["47","e","4a","50","28","32","58","59"],!0,function(e,t,n){"use strict";this||self;var i=e("47"),r=e("e"),o=(e("4a"),e("50")),a=e("28"),s=(e("32"),e("58")),l=e("59"),c={};c.newFile=function(){JSBridge.invoke("app.openFile",null,{mountFolder:i.mountFolder_})},c.newWindow=function(){JSBridge.invoke("document.newWindow")},c.globalSearch=function(){i.editor.library.fileSearch.show(!0)},c.close=function(){i.megaMenu&&i.megaMenu.hide(),JSBridge.invoke("window.close")},c.openWithPath=function(t){JSBridge.invoke("app.openOrSwitch",t,i.bundle.hasModified||i.bundle.filePath).then(e=>{e&&i.editor.library.doSwitchByNode(t)})},c.open=function(e){JSBridge.invoke("dialog.showOpenDialog",{properties:e?["openFile","openDirectory"]:["openFile"],filters:[{name:r.localize.getString("Markdown File"),extensions:i.SupportedFiles},{name:r.localize.getString("All Files"),extensions:["*"]}]}).then(({filePaths:e})=>{e&&e.length&&(c.openWithPath(e[0]),i.megaMenu.hide())})},c.openFolder=function(){JSBridge.invoke("dialog.showOpenDialog",{properties:["openDirectory"]}).then(({filePaths:e})=>{e&&e.length&&(c.openWithPath(e[0]),i.megaMenu.hide())})},c.quickOpen=function(){i.editor.quickOpenPanel.show()},c.import=function(){i.megaMenu.hide(),l.prepImport()},c.validatePandocInstall=function(){return l.validatePandocInstall()},c.doImport=function(e){l.import(e)},c.openFileLocation=function(){i.bundle.filePath&&JSBridge.showInFinder(i.bundle.filePath)},c.showPreferencePanel=function(){i.megaMenu.showPreferencePanel()},c.togglePreferencePanel=function(){i.megaMenu.togglePreferencePanel()},c.save=function(){i.saveUseNode()},c.saveAs=function(){i.saveUseNode(!0)},c.moveTo=function(){i.moveTo()},c.saveAll=function(){c.execForAll("function() {\t\tClientCommand.save();\t}")},c.print=function(){s.print()},c.exportLast=function(e){var t=i.option.lastExport||i.option._lastExport,e=!i.option.lastExportNoOverwrite&&e&&t.path&&i.option.lastExport;c.export(Object.assign({overwrite:e},t))},c.export=function(e){var t=e.type;i.editor.export.beforeExport(),i.editor.export.showExportNotification(),i.editor.localSettingBridge.loadFromFile(),e=i.editor.localSettingBridge.loadExportOption(e),"html"==t?i.editor.export.exportAndSaveHTML(e):"html-plain"==t?(Object.assign(e,{noStyle:!0}),i.editor.export.exportAndSaveHTML(e)):"image"==t?i.editor.export.exportToImage(e):"pdf"==t?s.exportPDF(e):"custom"==t?i.editor.export.exportWithCommand(e):l.export(t,e),/^html/.exec(t)&&document.body.classList.remove("ty-show-notification")},c.selectAll=function(){isInputComponent(document.activeElement)?i.isNode&&(document.activeElement.classList.contains("ty-input")?i.editor.selection.selectAllElem(r(document.activeElement)):JSBridge.invoke("webContents.selectAll")):i.editor.sourceView.inSourceMode?(i.editor.sourceView.cm.focus(),i.editor.sourceView.cm.execCommand("selectAll")):(i.editor.focusAndRestorePos(),i.editor.selection.selectAll(),i.editor.brush.expand())},c.deleteWord=function(){i.isLocked||(i.editor.selection.selectWord(!1,!0),i.editor.UserOp.backspaceHandler(i.editor,null,"delSelection"))},c.deleteScope=function(){i.isLocked||(i.editor.selection.selectPhrase(),i.editor.UserOp.backspaceHandler(i.editor,null,"delSelection"))},c.deleteLine=function(){i.isLocked||i.editor.UserOp.deleteLine(i.editor)},c.deleteBlock=function(){i.isLocked||i.editor.UserOp.deleteBlock(i.editor)};c.undo=function(e){i.isLocked||(i.editor.undo.undo(e),i.freshMenuWithDelay())},c.redo=function(e){i.isLocked||(i.editor.undo.redo(e),i.freshMenuWithDelay())},c.toggleOutline=function(){i.editor.library.togglePanel("outline")},c.toggleFileList=function(){i.editor.library.togglePanel("file-list")},c.toggleFileTree=function(){i.editor.library.togglePanel("file-tree")},c.pinWindow=function(){JSBridge.invoke("window.pin"),document.body.classList.add("always-on-top"),c.refreshViewMenu()},c.execForAll=function(e){var e=e.toString(),n=arguments,e=e.replace(/\$(\d+)/gi,function(e,t){return+t<n.length?n[t]:e});reqnode("electron").ipcRenderer.send("execForAll",e)},c.unpinWindow=function(){JSBridge.invoke("window.unpin"),document.body.classList.remove("always-on-top"),c.refreshViewMenu()},c.toggleStatusBar=function(){var e=document.body.classList.contains("show-footer");c.execForAll(e?function(){document.body.classList.remove("show-footer"),document.body.classList.add("hide-footer")}:function(){document.body.classList.add("show-footer"),document.body.classList.remove("hide-footer")}),JSBridge.putSetting("showStatusBar",!e)},c.toggleWordCount=function(){r("#footer-word-count").trigger("click")};function d(e){"string"==typeof e&&(i._CopyContentFlag=e),JSBridge.invoke("webContents.copy")}function u(e){"string"==typeof e&&(i._PasteContentFlag=e),JSBridge.invoke("webContents.paste")}var h;c.toggleDevTools=function(){i.megaMenu.isPreferencePanelShown()?document.querySelector("#uni-preference-panel-view").openDevTools():JSBridge.invoke("window.toggleDevTools")},c.refreshViewMenu=function(){var e;i.isNode&&((e={})["View→Show Status Bar"]={state:document.body.classList.contains("show-footer")},o.refreshViewMenu(e),JSBridge.menu.update(e),JSBridge.invoke("menu.updateCustomZoom"))};function p(){h&&clearTimeout(h),h=setTimeout(function(){h=null,i.editor&&i.editor.diagrams&&(i.editor.diagrams.loadMermaidTheme(),i.editor.diagrams.refreshDiagram(!0))},500)}c.cut=function(){JSBridge.invoke("webContents.cut")},c.copy=function(){d()},c.copyAsPlainText=function(){d("copyAsPlainText")},c.copyAsMarkdown=function(){d("copyAsMarkdown")},c.copyAsHTMLSource=function(){d("copyAsHTMLSource")},c.copyAsSemanticHTML=function(){d("copyAsSemanticHTML")},c.paste=function(){u(!1)},c.pasteAsPlain=function(){u("pasteAsPlain")},c.setTheme=function(e,t){console.log("set theme: "+e),JSBridge.invoke("setting.setCurTheme",e,t),i.option.curTheme=e,c.execForAll("function(){\t\tFile.setTheme('%@');\t}".replace("%@",e))},c.resetZoom=function(){JSBridge.putSetting("customZoom",!1),JSBridge.putSetting("zoomFactor",1),JSBridge.putSetting("zoomLevel",0),a.showZoomPanel(1),reqnode("electron").webFrame.setZoomFactor(1),i.option.zoomFactor=1,p()},c.zoomIn=function(){var e=reqnode("electron").webFrame.getZoomLevel()+1;c.setZoomLevel(e)},c.zoomOut=function(){var e=reqnode("electron").webFrame.getZoomLevel()-1;c.setZoomLevel(e)},c.setZoomLevel=function(e,t){var n=e;t||(JSBridge.putSetting("customZoom",!0),(t=reqnode("electron").webFrame).setZoomLevel(n),JSBridge.putSetting("zoomLevel",n),e=t.getZoomFactor(),JSBridge.putSetting("zoomFactor",e)),a.showZoomPanel(e),i.option.zoomFactor=e,p()},window.reqnode&&reqnode("electron").ipcRenderer.on("export",function(e,t){c.export(t)}),n.exports=c,window.ClientCommand=c}),$__System.registerDynamic("2c",["2b","11","13","1b","1d","19","50"],!0,function(e,t,n){"use strict";this||self,e("2b");var g=e("11"),i=e("13"),w=e("1b"),p=w.SnapFlag,x=i.Node,C=i.TYPE,F=i.NodeCollectionUtils,y=e("1d"),v=e("19"),o=e("50");function S(e){var t;return e.get("style")==x.ListType.ol?x.ListType.ol:(t=!1,e.get("children").map(function(e){t=t||e.get("style")!==x.ListType.task}),t?x.ListType.ul:x.ListType.task)}function a(e,n,i,t,r){var o=y.createRange();function a(e){var t=(e.attr("md-inline")==n?e:e.find('[md-inline="'+n+'"]')).children(".md-meta:not(.md-content)");i&&(i.end-=t.text().length),t.remove(),e.children(".md-meta").filter(function(){return 0==(this.textContent||"").length}).remove(),e.attr("md-inline")==n&&i&&(i.end=i.start+e.text().length)}if(e[0].hasAttribute("mdtype")&&(e.wrapInner("<span></span>"),e=$(e[0].firstChild)),i?(i.containerNode=e[0],o.moveToBookmark(i)):o.selectNode(e[0]),o.commonAncestorContainer.nodeType==document.ELEMENT_NODE&&o.commonAncestorContainer.getAttribute("md-inline")==n)a($(o.commonAncestorContainer));else{for(var s=document.createElement("SPAN"),l=o.extractContents(),c=0;c<l.childNodes.length;c++)s.appendChild(l.childNodes[c].cloneNode(!0));a($(s)),s.childNodes.length!=s.childElementCount||1!=s.childNodes.length||s.childNodes[0].getAttribute("md-inline")||(s=s.childNodes[0]),o.insertNode(s),o.setStart(s,0),o.setEnd(s,s.childNodes.length)}return r||f.call(this,o,n,e[0],t?i:null),this.editor.brush.addToQueue(e.attr("cid")),o}var l=function(e){var t,n=[],i=0,r=e.commonAncestorContainer;if(!r.childElementCount)return[e];function o(){var e;t!=i&&0!=t&&((e=y.createRange()).setStart(r.children[i],0),e.setEndAfter(r.children[t-1]),n.push(e))}for(t=0;t<r.childElementCount;t++){var a=r.children[t];a.classList&&a.classList.contains("md-softbreak")&&(o(),i=t+1)}return i<t&&(0<i?o():n.push(e)),n},f=function(e,n,i,r){var o,a,s;!x.isType(n,C.link,C.image)&&e.commonAncestorContainer==e.startContainer&&e.startContainer==e.endContainer?(o=l(e),a=1<o.length,s=this,o.forEach(function(e,t){e=c.call(s,e,n,i,t==o.length-1?r:void 0,a);r&&e&&(r instanceof Object?r.end+=e:r+=e)})):c.call(this,e,n,i,r)},c=function(e,t,n,i,r){var o,a=b.SyntaxMap[t];if(i){var s,l=this.editor.getJQueryElem(e.startContainer),c=this.editor.getJQueryElem(e.endContainer);if(l.closest("md-before").length||l.closest("md-content").length?(e.setStartBefore(l.closest("[md-inline]")[0]),s=!0):l.closest("md-meta").length&&(e.setStartAfter(l.closest("[md-inline]")[0]),s=!0),c.closest("md-after").length||l.closest("md-content").length?(e.setEndAfter(l.closest("[md-inline]")[0]),s=!0):c.closest("md-meta").length&&(e.setEndBefore(l.closest("[md-inline]")[0]),s=!0),c=e.toString(),e.collapsed||0===c.trim())return;o=s?o||e.getBookmark(n&&document.body.contains(n)?n:e.commonAncestorContainer):i instanceof Object?i:{start:i,end:i}}else c=e.toString();return l=/^\s+/g.exec(c),s=/\s+$/g.exec(c),l=l?l[0].length:0,s=s?s[0].length:0,(l||s)&&((o=o||e.getBookmark(n&&document.body.contains(n)?n:e.commonAncestorContainer||e.commonAncestorContainer)).start+=l,o.end-=s,e.moveToBookmark(o)),l=a[1],(s=JSBridge.clipboard.readText())&&5e3<s.length&&(s=""),x.isType(t,C.link)?g.isURL(c)?l="]("+c+")":g.isURL(s)&&(l="]("+s.trim()+")"):x.isType(t,C.image)&&(g.isImg(c)?l="]("+c+")":g.isImg(s)&&(l="]("+s+")")),e.insertNodeAtEnd(document.createTextNode(l)),e.insertNode(document.createTextNode(a[0])),i&&(x.isType(t,C.link)?e.moveToBookmark({containerNode:n,start:o.start+1,end:1+o.end}):e.moveToBookmark({containerNode:n,start:o.start+(r?0:a[0].length),end:o.end+a[0].length+(r?a[1].length:0)}),editor.selection.setRange(e,!0)),(a[0]||"").length+(a[1]||"").length};class r{constructor(e){this.editor=e,this.CONST=b,this.putBookmark(null,{block:[]})}removeStyle(e,t,n){e.children(".md-meta").remove()}canContainInline(e){return e.jquery&&(e=e.attr("mdtype")),x.isType(e,C.paragraph,C.def_footnote,C.heading,C.table_cell)}putStyle(e,t,n){this.editor.selection.deRange(e),this.editor.undo.endSnap(!0);var i,r=this.editor.getMarkElem(e.commonAncestorContainer),o=-1<b.InsertInline.indexOf(t);if((r=o?this.editor.getMarkElem(e.startContainer):r).length&&0===r.find("[mdtype]").length&&this.canContainInline(r)){var a=w.makeEmptyCommand(this.editor.selection.buildUndo()),s=this.editor.store(r.attr("cid"));a.undo.push(w.buildReplaceUndo(s)),i=n&&this.hasStyleInRange(t,e,!0),(e=this.putStyleForRange(r,t,e,!0,i)).select(),this.editor.store(r.attr("cid")),a.redo.push(w.buildReplaceUndo(s)),a.redo.push(this.editor.selection.buildUndo()),this.editor.undo.register(a),this.editor.brush.addToQueue(s.id,!0)}else if(!o)return i=n&&this.hasStyleInRange(t,e,!1),function(e,n,i){var r=this.editor;function o(e){var t=e.get("children");return t.length?t.toArray().map(o):r.stylize.canContainInline(e.get("type"))&&r.findElemById(e.id).text().length&&(r.stylize.putStyleInBlock(r.findElemById(e.id),n,void 0,void 0,!0,i),r.store(e),r.brush.addToQueue(e.id)),e}r.undo.endSnap(!0);var t=r.selection.getDetailPos(e.startContainer,e.startOffset),a=r.selection.getDetailPos(e.endContainer,e.endOffset),t=r.getMarkElem(t[0]),a=r.getMarkElem(a[0]),s=r.findNodeByElem(t),l=r.findNodeByElem(a);if(s&&l){var c,d=(c=x.getTreePosition(s,l))[1],u=c[2],h=w.makeEmptyCommand(r.selection.buildUndo()),c=e.cloneRange(),e=e.cloneRange(),p=d;for(h.undo.push(w.buildReplaceUndo(d)),e.setEndAfter(t[0]),this.canContainInline(s)&&e.toString().length&&(this.putStyleInBlock(t,n,e.getBookmark(t[0]),void 0,!0,i),r.store(s,!0)),r.UserOp.decorateOneSide(s,d,"after",o),h.redo.push(w.buildReplaceUndo(d)),r.brush.addToQueue(t.attr("cid")),p=d.get("after");p&&p!==u;)h.undo.push(w.buildReplaceUndo(p)),o(p),h.redo.push(w.buildReplaceUndo(p)),p=p.get("after");l&&l!=d&&(c.setStartBefore(a[0]),c.toString().length)&&(h.undo.push(w.buildReplaceUndo(u)),this.canContainInline(l)&&(this.putStyleInBlock(a,n,c.getBookmark(a[0]),void 0,!0,i),r.store(l,!0)),r.UserOp.decorateOneSide(l,u,"before",o),h.redo.push(w.buildReplaceUndo(u)),r.brush.addToQueue(a.attr("cid"))),h.redo.push(r.selection.buildUndo()),r.undo.register(h),$(".md-expand").removeClass("md-expand")}r.brush.resume(!0)}.call(this,e,t,i)}putStyleInBlock(e,t,n,i,r,o){if(!r||0!=e.text().length){e[0].hasAttribute("mdtype")&&e.addClass("md-expand");try{return a.call(this,e,t,n,i,o)}catch(e){console.error(e)}}}putStyleForRange(e,t,n,i,r){var o=n.getBookmark(e[0]);return e[0].hasAttribute("mdtype")&&n.commonAncestorContainer.nodeType!=document.TEXT_NODE&&e.addClass("md-expand"),a.call(this,e,t,o,i,r)}addStyle(e,t){var n,i=b.SyntaxMap[t],r=document.createElement("SPAN");r.className="md-meta md-expand",r.setAttribute("md-inline",t),"link"!=t&&"image"!=t||(n=(n=JSBridge.clipboard.readText()||"").trim(),"link"==t&&(g.isURL(n)||!/[^.a-z0-9\\\/% _#@]/i.exec(n)&&n.length<256&&(/[\\\/]/.exec(n)&&!/[\\\/.][\s]/.exec(n)||/\.[a-z]+$/.exec(n))?i[1]="]("+n+")":i[1]="]()"),"image"==t&&(g.isImg(n)?i[1]="]("+n+")":i[1]="]()")),r.appendChild(document.createTextNode(i[0]+i[1])),e.insertNode(r),e.moveToBookmark({containerNode:r,start:i[0].length,end:i[0].length}),this.editor.selection.rangy.getSelection().setSingleRange(e)}detach(e,t){return!(!e.collapsed||!$.parseHTML("<div>"+e.toHtml()+"</div>")[0].querySelector('[md-inline="'+t+'"]'))||$(e.commonAncestorContainer).closest('[md-inline="'+t+'"]').length}canToggleStyle(e,t,n,i){i=i||this.CONST.NoInline;var r=function(e){for(var t=0;t<i.length;t++)if(e.hasStyle(i[t]))return!0}(this);return!!this.hasStyle(e)||!(r||/(md-meta|md-content)(\s+|$)/g.exec(t[0].className)&&!n||/md-blockmeta/g.exec(t[0].className)||r)}clearStyle(){if(window.getSelection().rangeCount&&!isInputComponent(document.activeElement)&&!File.isLocked){this.editor.brush.clearAndPause();var e=this.editor.selection.getRangy();if(this.editor.undo.endSnap(!0),e){for(var t,n=w.makeEmptyCommand(editor.selection.buildUndo()),i=editor.selection.getDetailPos(e.startContainer,e.startOffset),e=editor.selection.getDetailPos(e.endContainer,e.endOffset),i=editor.getMarkElem(i[0]),e=editor.getMarkElem(e[0]),i=editor.findNodeByElem(i),e=editor.findNodeByElem(e),i=x.getTreePosition(i,e),e=i[1],r=i[2],o=e,a=[];o&&o!=r.get("after");)o=(t=o).get("after"),this.editor.findElemById(t.id).find(".md-meta, .md-content").each(function(){var e=this.closest("[cid]").getAttribute("cid");-1==a.indexOf(e)&&a.push(e)}).remove();a.forEach(e=>{var t=editor.getNode(e);n.undo.push(w.buildReplaceUndo(t)),this.editor.store(e),this.editor.brush.addToQueue(e),n.redo.push(w.buildReplaceUndo(t))}),this.editor.undo.register(n)}this.editor.brush.resume(),this.editor.brush.expand()}}toggleStyle(e){if(!File.isLocked&&window.getSelection().rangeCount&&"INPUT"!=document.activeElement.tagName&&"TEXTAREA"!=document.activeElement.tagName&&!File.isLocked){var t,n,i,r,o,a=this.editor.selection.getRangy(),s=this.hasStyle(e),l=this.editor.getJQueryElem(a.commonAncestorContainer),c=this.editor.getMarkElem(a.commonAncestorContainer);s||(t=this.editor.getJQueryElem(a.startContainer),"link"==e&&(s=t.closest('[md-inline="reflink"], [md-inline="autolink"]').length),"image"==e&&(s=t.closest('[md-inline="refimg"], .md-url').length)),this.editor.brush.pause();do{if(!this.canToggleStyle(e,l,a.collapsed,this.CONST.NoInlineBlock))break;if(!this.canToggleStyle(e,l,a.collapsed,this.CONST.NoInlineInline)&&!1===function(e,t){if(t&&e){if(0!==e.startOffset)return!1;for(var n=e.startContainer;t.contains(n);){if(n.previousElementSibling)return!1;n=n.parent}if(e.endOffset!==e.endContainer.length)return!1;for(var i=e.endContainer;t.contains(i);){if(i.nextElementSibling)return!1;i=i.parent}return!0}}(a,l.closest("[md-inline]")[0]))break;if(s)i=this.editor,d=c,o=e,h=u=void 0,(h=(r=l).closest('[md-inline="'+o+'"]')).length||"link"!=o||(h=r.closest('[md-inline="reflink"], [md-inline="autolink"]')),"image"==o&&(h.length?u=/!\[([^\]]*)\]/.exec(h.text())[1]:u||((h=r.closest('[md-inline="refimg"]')).length?u=/!\[((?:\[[^\]]*\]|[^\[\]]|\](?=[^\[]*\]))*)\]/.exec(h.text())[1]:(h=r.closest(".md-url").closest("[md-inline]")).length&&(u="!"+h.text()))),o==C.comment&&(u=h.text().replace(/(^<\!--)|(-->)$/g,"")),r=i.findNodeByElem(d),u?(h.text(u),i.selection.selectAllElem(h)):(h.children(".md-meta, .md-content").remove(),i.brush.addToQueue(h.closest("[cid]").attr("cid"),!0)),r&&i.undo.addSnap(r.id,p.REPLACE);else{if(!a.collapsed){this.putStyle(a,e,!0);break}if(!(o=this.editor.findNodeByElem(c)))return;this.editor.undo.addSnap(o.id,p.NONE);var d=a.getBookmark(c[0]).start,u=c.text().substring(d-1,d+1),h="**"==u&&$(a.startContainer).closest("[md-inline='plain']").length;e==C.em&&h?(a.moveToBookmark({containerNode:c[0],start:d-1,end:d+1}),a.extractContents()):(i=a,!(r=u)||i.collapsed&&/^[\(\)\[\]\^&_\-+*#@!~`\\\/\{\}'":;<>,.?%\s]+$/.exec(r)||(c.addClass("md-expand"),h||e==C.image||this.editor.selection.selectWord(!0,!1,a),(a=this.editor.selection.getRangy()).collapsed)?this.addStyle(a,e):f.call(this,a,e,c[0],d)),this.editor.undo.addSnap(o.id,p.REPLACE)}}while(this.editor.brush.addToQueue(c.attr("cid")),e!=C.inline_math||s||(n=this.editor,setTimeout(function(){n.brush.triggerAutoComplete(!0)},100)),0);this.editor.brush.resume(!0),window.Reporter.fullValidate()}}putBookmark(e,t){return this.editor.styleBookmark={cursor:e,style:t}}isAtFootnoteDefSpan(){var e=this.editor.selection.getRangy();return e&&this.editor.getJQueryElem(e.startContainer).closest(".md-def-name").length}buildBookmark(e){if(File.ignoreStyleChange)return File.editor.styleBookmark.style;var t,n,i={inline:[],block:[],state:""},r=this.editor.selection.getRangy(),o=(e=e||this.editor.getJQueryElem(r&&r.commonAncestorContainer||document.activeElement)||$()).closest("[md-inline]"),a=e;if(0==e.length){if(!(e=this.editor.getMarkElem()).length||!x.isType(e.attr("mdtype"),x.TYPE.hr,x.TYPE.toc))return i;a=e}for(;o.length;)n=o.attr("md-inline"),-1<this.CONST.LinkList.indexOf(n)&&(n="link"),i.inline.push(n),o=(a=o).parent().closest("[md-inline]"),x.isType(n,"image","imgtag","refimg")&&(File.isTextBundle()||File.isTextPack())&&/^assets[\/\\]/.exec(o.attr("data-src"))&&i.inline.push("embed-resource");for(o=a.closest("[mdtype], [mdlike]");o.length;)(n=o.attr("mdlike")||o.attr("mdtype"))===C.heading?i.block.push("header"+o[0].tagName.substring(1)):n===C.list?(t=this.editor.findNodeByElem(o))&&i.block.push(S(t)):n===C.list_item?o.hasClass("md-task-list-item")&&!i.state&&(i.state=o.hasClass("task-list-done")?"checked":"unchecked"):(n=n.replace(/^h([1-6])$/,"header$1"),i.block.push(n)),o=o.parent().closest("[mdtype]");return i.canContainInline=-1<b.NoInline.indexOf(i.block[0]),i.textSelected=-1<b.Selectable.indexOf(i.block[0])||r&&!r.collapsed,i.rangeSelected=r&&!r.collapsed,i}hasStyleInRange(e,t,n){t=t.toHtml();return n&&(t="<div>"+t+"</div>"),0==$(t).find("[md-inline='"+e+"']").remove().end().text().trim().length}hasStyle(e){var t=this.editor.styleBookmark.style;if(t)return-1<(t.inline||[]).indexOf(e)||-1<(t.block||[]).indexOf(e)}changeStyleFromMenu(e){File.isLocked||document.body.classList.contains("modal-open")||(e=b.NameMapToStyle[e.toLowerCase()],x.isType(e,"header1","header2","header3","header4","header5","header6",C.paragraph)?this.changeBlock(e):x.isType(e,C.def_footnote,C.def_link,C.hr,C.fences,C.math_block,C.toc)?this.insertBlock(e):x.isType(e,C.table)?File.editor.tableEdit.insertTable():x.isType(e,C.meta_block)?this.insertMetaBlock():x.isType(e,C.blockquote)&&this.toggleIndent(C.blockquote))}changeBetweenCodeMirror(e,t){var n,i,r;x.isType(t,C.math_block,C.fences)&&(n=this.editor,i=w.makeEmptyCommand(n.selection.buildUndo()),n.undo.endSnap(!0),(x.isType(t,C.fences)?(n.fences.syncToNode(t.cid),n.fences):(n.mathBlock.syncToNode(t.cid),n.mathBlock)).beforeDeleteFences(t),i.undo.push(w.buildReplaceUndo(t)),t.set("type",e),e===C.fences&&(r=n.fences.getCodeLangSuggest(!0),t.set("lang",r)),i.redo.push(w.buildReplaceUndo(t)),n.findElemById(t.id).replaceWith(t.toHTML()),e==C.fences?n.fences.getCm(t.id):e==C.math_block&&n.mathBlock.startEditing(t.id),n.selection.jumpIntoElemBegin(n.findElemById(t.id)),i.redo.push(n.selection.buildUndo()),n.undo.register(i),n.refocus(),o.refreshBlockMenu())}toggleFences(){var e,t;File.isLocked||document.body.classList.contains("modal-open")||(e=this.editor.getNode(null,!0,!0),x.isType(e,C.fences)?(t=this.editor.fences.getCodeLangSuggest(!0),this.changeBlock(C.paragraph,e,void 0,{lang:t})):x.isType(e,C.math_block)?this.changeBetweenCodeMirror(C.fences,e):this.insertBlock(C.fences))}toggleMathBlock(){var e;File.isLocked||document.body.classList.contains("modal-open")||(e=this.editor.getNode(null,!0,!0),x.isType(e,C.math_block)?this.changeBlock(C.paragraph,e):x.isType(e,C.fences)?this.changeBetweenCodeMirror(C.math_block,e):this.insertBlock(C.math_block))}changeBlock(e,a,t,n){var i,s,l,r,o,c,d,u,h,p;function f(e,t){r=a.get("text")||"",o=r.split(/\n/)||[],a.set("text",r),o.length&&(o=g.findLine(r,s.lastCursor.start),a.set("text",o.line),0<o.start&&(n=a.addBefore(new x({type:C.paragraph,text:r.substring(0,o.start-1)})),w.addUndoForInsert(l,n)),o.start+o.line.length<r.length&&(i=a.addAfter(new x({type:C.paragraph,text:r.substring(o.start+o.line.length+1)})),w.addUndoForInsert(l,i)),(c=Object.clone(l.undo[0])).start-=o.start,c.end-=o.start);var n,i,r=[n,a,i],o=(m(e,t,!0),(r[0]?r[0].toHTML():"")+r[1].toHTML()+(r[2]?r[2].toHTML():""));return s.findElemById(a.id).replaceWith(o),r[1]}function m(e,t,n){return a.set("type",C.heading),a.set("depth",e),a.set("pattern",t),n||s.findElemById(a.id).replaceWith(a.toHTML()),l.redo.push(w.buildReplaceUndo(a)),a}File.isLocked||document.body.classList.contains("modal-open")||(a=a||this.editor.getNode(null,!0,!0))&&(i=b.getMenuBlockType(a),s=this.editor,r=a.cid,s.undo.endSnap(!0),x.isType(i,C.math_block,C.html_block,C.table)?s.UserOp.insertParagraph():x.isType(a,C.table_row,C.table_cell,C.blockquote,C.list,C.list_item)||(File.option.expandSimpleBlock&&x.isType(i,C.paragraph)&&0<a.get("depth")&&(i="header"+a.get("depth")),s.lastCursor=s.selection.buildUndo(),i==e&&t&&x.isType(a,C.heading)&&(e=C.paragraph),i!=C.paragraph&&!~i.indexOf("head")||e!=C.paragraph&&!~e.indexOf("head")||(c=s.selection.buildUndo()),i!=e&&i&&(x.isType(i,C.fences)&&(s.fences.syncToNode(a.cid),s.fences.beforeDeleteFences(a)),(l=w.makeEmptyCommand(s.lastCursor)).undo.push(w.buildReplaceUndo(a)),x.isType(i,C.def_link)&&a.set("text",(a.get("href")||"")+(a.get("tittle")?' "'+a.get("tittle")+'"':"")),0==e.indexOf("header")?(t=+e.substr(6),o=(o=a.get("pattern"))&&/-|=/.exec(o)?t<=2?o.replace(/-|=/g,1==t?"=":"-"):void 0:o&&o.replace(/#+/g,"#".repeat(t)),x.isType(a,C.paragraph)?File.option.expandSimpleBlock&&a.get("depth")&&/^#/.exec(a.get("text"))?(u=t,(c=Object.clone(l.undo[0])).start+=u-a.get("depth"),c.end+=u-a.get("depth"),a.set("depth",u),p=(p=a.get("text")).replace(/^#+/,"#".repeat(u)).replace(/#+$/,"#".repeat(u)),a.set("text",p),h||(u=v.renderHtmlWithBlockMeta(a,File.editor.brush),s.findElemById(a.id).replaceWith(u)),l.redo.push(w.buildReplaceUndo(a))):a=f(t,o):a=m(t,o)):(x.isType(a,C.paragraph)&&i!==C.paragraph&&a.set("text",a.get("text").replace(/^#+\s*/,"")),a.set("type",e),n&&Object.keys(n).forEach(e=>{void 0!==n[e]&&a.set(e,n[e])}),a.set("pattern",void 0),x.isType(a,C.paragraph)||i!=C.paragraph||a.set("text",a.get("text").replace(/\r?\n/g," ")),x.isType(i,C.meta_block,C.fences)&&x.isType(a,C.paragraph)&&(a.set("type",C.raw_edit),(d=s.simpleParse(a))||a.set("type",C.paragraph)),p=y.createRange(),d?(u=(h=$(d[1]))[0].getAttribute("cid"),t=h.last()[0].getAttribute("cid"),s.findElemById(d[2]).replaceWith(d[1]),d&&w.append(l,d[0]),p.setStartBefore(s.findElemById(u)[0]),p.setEndAfter(s.findElemById(t)[0])):(x.normalizeNode(a),l.redo.push(w.buildReplaceUndo(a)),s.findElemById(a.id).replaceWith(a.toHTML()),s.lastCursor&&s.lastCursor.pos?p.moveToBookmark({containerNode:s.findElemById(a.id)[0],start:s.lastCursor.pos.ch,end:s.lastCursor.pos.ch}):(p.setStartBefore(s.findElemById(a.id)[0]),p.setEndAfter(s.findElemById(a.id)[0]))),p=s.selection.deRange(p,!0),c=c||s.selection.buildUndo(p)),c||((c=Object.clone(l.undo[0])).startId===r&&(c.startId=a.cid),c.endId===r&&(c.endId=a.cid),c.id===r&&(c.id=a.cid)),s.undo.exeCommand(c),l.redo.push(c),s.undo.register(l),s.refocus())))}increaseHeaderLevel(){var e,t;File.isLocked||document.body.classList.contains("modal-open")||(t=(e=this.editor.getMarkElem()).attr("mdtype"))!=C.heading&&t!=C.paragraph||this.editor.stylize.changeHeadingLevel(this.editor.findNodeByElem(e),!0,e.attr("mdlike"))}decreaseHeaderLevel(){var e,t;File.isLocked||document.body.classList.contains("modal-open")||(t=(e=this.editor.getMarkElem()).attr("mdtype"))!=C.heading&&t!=C.paragraph||this.editor.stylize.changeHeadingLevel(this.editor.findNodeByElem(e),!1,e.attr("mdlike"))}insertMetaBlock(e,t){var n,i;if(!File.isLocked&&!document.body.classList.contains("modal-open"))return t=t||"",this.editor.undo.endSnap(!0),n=this.editor.nodeMap.getFirst(),x.isType(n,C.meta_block)?void 0:(this.editor.lastCursor=this.editor.selection.buildUndo(),i=w.makeEmptyCommand(this.editor.lastCursor||this.editor.selection.buildUndo()),t=new x({type:C.meta_block,in:this.editor.nodeMap,attachTo:this.editor.nodeMap,after:n,text:t}),w.addUndoForInsert(i,t),e?{command:i,node:t}:(this.editor.findElemById(n.cid).before(t.toHTML()),this.editor.selection.restoreSelection(this.editor.findElemById(t.cid),0),i.redo.push(this.editor.selection.buildUndo()),this.editor.undo.register(i),this.editor.selection.scrollAdjust(),this.editor.refocus(t.cid),t))}insertAlert(e){var t,n,i,r,o=this.editor.getMarkElem().closest(".md-alert");o.length?(n=(t=this.editor.findNodeByElem(o)).get("children").first(),i=w.makeEmptyCommand(),t.get("alert")==e&&(e=""),i.undo.push(w.buildReplaceUndo(t)),i.undo.push(w.buildReplaceUndo(n)),t.set("alert",e),r=e?n.get("text").replace(/\[\![a-z]+\]/i,`[!${e.toUpperCase()}]`):n.get("text").replace(/\s*\[\![a-z]+\]\s*/i,""),n.set("text",r),i.redo.push(w.buildReplaceUndo(t)),i.redo.push(w.buildReplaceUndo(n)),!r.length&&n.get("after")&&(w.addUndoForRemove(i,n),n.remove()),this.editor.undo.register(i),o.replaceWith(t.toHTML()),this.editor.selection.jumpIntoElemEnd(this.editor.findElemById(t.getVeryFirst(!0).id))):((t=new x({type:C.blockquote,alert:e})).appendChild(new x({type:C.paragraph,text:"[!"+e.toUpperCase()+"]"})),r=new x({type:C.paragraph,text:""}),t.appendChild(r),this.insertBlock(C.blockquote,t),this.editor.selection.jumpIntoElemEnd(this.editor.findElemById(r.id)))}insertBlock(e,t){if(!(File.isLocked||"table"!=e&&document.body.classList.contains("modal-open"))){var n=this.editor,i=n.selection.getRangy(),r="",o=null,a="";if(n.undo.endSnap(!0),!i||i.collapsed||t)o=w.makeEmptyCommand();else{if(r=n.UserOp.prepMarkHtml(i.toHtml(),n).html(),a=i.toString(),o=n.UserOp.backspaceHandler(n,null,"delSelection",!0),!(i=n.selection.getRangy()))return;n.selection.deRange(i,!0),n.refocus(null,!1,!0,!1,!0)}var s=n.getNode(null,!0,!0);if(s){var l=b.getMenuBlockType(s),c=n.findElemById(s.id),i=(n.lastCursor=n.selection.buildUndo(i),t||new x({type:e,text:""}));if(t||e!=C.fences||(d=n.fences.getCodeLangSuggest(!0),i.set("lang",d)),l!=e&&l&&x.isType(s,C.paragraph,C.heading)){o.undo.push(this.editor.lastCursor),o.undo.push(w.buildReplaceUndo(s));var d=x.splitAt(s,(this.editor.lastCursor||{start:0}).start,n,!0);if(!d)return;var l=d.prev,u=d.next,h=(e==C.hr?u:i).id;x.isType(e,C.math_block,C.fences)?i.set("text",r?n.UserOp.getMarkdownSourceFrom(r):""):e==C.def_link&&(a=(a.trim().split(/\n/)||[])[0]||"",/[\/\\]/.exec(a)?i.set("href",a.substr(0,160)):i.set("ref",(a.split(/\s/)[0]||a).substr(0,20))),o.redo.push(n.undo.buildReplaceUndo(s)),w.addUndoForInsertArray(o,d.insertArray),l.addAfter(i),w.addUndoForInsert(o,i),-1<d.insertArray.indexOf(u)&&d.insertArray.splice(d.insertArray.indexOf(u),0,i),t&&p(t,s.get("in")),u&&x.isEmptyBlock(u)&&x.isType(u.get("after"),C.paragraph)&&(w.addUndoForRemove(o,u),u.remove(),u=null),x.isEmptyBlock(l)&&(w.addUndoForRemove(o,l),l.remove(),l=null),r=(s.isDeleted()?"":s.toHTML())+d.insertArray.map(function(e){return e.isDeleted()?"":e.toHTML()}).join(""),c.replaceWith(r),e=this.editor.findElemById(h),this.editor.selection.jumpIntoElemBegin(e)}else(s=s.getClosetBlock(!1)).addAfter(i),t&&p(t,s.get("in")),w.addUndoForInsert(o,i),this.editor.findElemById(s.cid).after(i.toHTML()),this.editor.selection.jumpIntoElemBegin(this.editor.findElemById(i.cid));return this.editor.lastCursor=this.editor.selection.buildUndo(),o.redo.push(this.editor.lastCursor),this.editor.undo.register(o),this.editor.refocus(),this.editor.selection.scrollAdjust(),i}}function p(e,t){e.set("in",t),e.get("children").toArray().map(function(e){p(e,t)})}}toggleTaskStatus(t){var e,n,i,r,o;File.isLocked||document.body.classList.contains("modal-open")||(e=this.editor.selection.getRangy(),o=(n=this.editor.getMarkElem(e&&e.startContainer).closest(".md-task-list-item")).hasClass("task-list-done"),void 0===t&&(t=!o),n.length&&t!==o&&((i=this.editor).undo.endSnap(!0),!e.collapsed&&(r=w.makeEmptyCommand(),o=$.parseHTML(e.toHtml()),$(o).find(t?".task-list-not-done":".task-list-done").addBack(t?".task-list-not-done":".task-list-done").each(function(){var e=i.getNode(this.getAttribute("cid")).attr("checked",t,i,!0);w.append(r,e)}),r.undo.length)?i.undo.register(r):i.getNode(n.attr("cid")).attr("checked",t,i,!1),JSBridge.menu.update({"Paragraph→Task Status→Mark as Complete":{state:t},"Paragraph→Task Status→Mark as Incomplete":{state:!t}})))}toggleIndent(f,m){var g,e,y,s,t,i,n,r,o;function a(e,t,n){e=e.getClosetBlock(),t=t&&t.getClosetBlock();var i,r,o,a=e.get("parent");i=e,r=(r=t)||i,(o=a)&&o.get("type")==C.blockquote&&(y.collapsed||!i.get("before")&&!r.get("after"))?(w.addUndoForUnwrap(n,a),a.unwrap(g)):(s&&(e=t=function e(t){var n=t.get("parent");return!n||t.get("before")||t.get("after")?x.isType(t,C.list_item)?t.getFirstChild():t.isVirtualBlock()?b(t):t:e(n)}(e)),o=new x({type:f}),x.wrap(o,e,t||e,g),w.addUndoForWrap(n,o))}function v(e,t){t!=x.ListType.ol&&t!=x.ListType.ul||(e.set("style",t),e.get("children").map(function(e){e.unset("style"),e.unset("checked")})),t==x.ListType.task&&(e.set("style",x.ListType.ul),e.get("children").map(function(e){e.set("style",x.ListType.task)}))}function b(e){for(;e&&e.isVirtualBlock();)e=e.get("parent");return e}function l(e,t,n,i,r){var o=function(e){var t=e.get("parent");if(y.collapsed){if(!e.get("before")&&t&&x.isType(t.get("parent"),C.list))return t.get("parent")}else if(t&&x.isType(t.getClosetBlock(),C.list))return t.getClosetBlock()}(e),a=o?S(o):void 0;if(m)if("none"==i){if(!o)return;i=a}else if(o&&i==a)return;if(o)a==i?(o.get("children").map(function(e){w.addUndoForUnwrap(n,e),e.toMark(),e.unwrap()}),w.addUndoForUnwrap(n,o),o.unwrap(g)):(n.undo.push(w.buildReplaceUndo(o)),o.set("pattern",void 0),v(o,i),g.findElemById(o.id).replaceWith(o.toHTML()),n.redo.push(w.buildReplaceUndo(o)));else{t=b(t||e);for(var s=e=b(e),l=[],c=t.get("after");s&&s!=c;){var d=s,u=(File.option.ignoreLineBreak||((u=function(e,t,n){if(!x.isType(e,C.paragraph))return e;var i=e.get("text").split(/\n/g)||[];if(i.length<2)return e;void 0===n.startId&&(n.startId=n.id),void 0===n.endId&&(n.endId=n.id),delete n.id;var r=n.startId==e.cid,o=n.endId==e.cid,a=n.start==n.end;if(r&&o){t.undo.push(w.buildReplaceUndo(e));for(var s,l=[],c=e,d=(e.set("text",i[0]),e),u=1;u<i.length;u++){var h=i[u];if(n.start>i[u-1].length+i[u].length&&!a)i[u]=e.get("text")+"\n"+h,e.set("text",i[u]);else if(h=c.addAfter(new x({type:C.paragraph,text:h})),l.push(c=h),r&&n.start>i[u-1].length?(n.startId=h.cid,n.start-=i[u-1].length+1,d=h):r=!1,o&&n.end>i[u-1].length){if(n.endId=h.cid,n.end-=i[u-1].length+1,!a&&u<i.length-1&&n.end<=i[u].length){s=new x({type:C.paragraph,text:i.slice(u+1).join("\n")}),c.addAfter(s),l.push(s);break}}else o=!1}var p=[e].concat(l);return g.findElemById(e.cid).replaceWith(F.toHTML(p)),t.redo.push(w.buildReplaceUndo(e)),w.addUndoForInsertArray(t,l),[d,s]}}(s,n,r))&&u[0]&&(d=s=e=u[0]),u&&u[1]&&(c=u[1])),new x({type:C.list_item})),s=s.get("after");x.wrap(u,d,d,g),l.push(u),w.addUndoForWrap(n,u)}v(o=new x({type:C.list,in:e.get("in")}),i);var a=l[0],h=l.last();if(f==x.ListType.task)for(var p=a;p!=h.get("after");)p.set("style",x.ListType.task),p=p.get("after");x.wrap(o,a,h,g),w.addUndoForWrap(n,o)}}function c(e){return $(e).closest("p")}!File.isLocked&&!document.body.classList.contains("modal-open")&&(g=this.editor,e=w.makeEmptyCommand(g.selection.buildUndo()),y=this.editor.selection.getRangy())&&(g.undo.endSnap(!0),s=y.collapsed,isInputComponent(document.activeElement)&&!this.editor.fences.getFocused()||File.isLocked||(this.editor.store(),t=this.editor.selection.buildUndo(),this.editor.lastCursor=t,(n=y)&&!n.collapsed&&(i=!1,function e(t){var n=c(t.endContainer);n.text().length||n.parent()[0]!=t.commonAncestorContainer||(n=n.prev()[0])&&(i=!0,t.setEndAfter(n),e(t))}(n),function e(t){var n=c(t.startContainer);n.text().length||n.parent()[0]!=t.commonAncestorContainer||(n=n.after()[0])&&(i=!0,t.setStartBefore(n),e(t))}(n),i)&&g.selection.deRange(n),y?(n=g.selection.getDetailPos(y.startContainer,y.startOffset),o=g.selection.getDetailPos(y.endContainer,y.endOffset),n=g.getMarkElem(n[0]),o=g.getMarkElem(o[0]),n=g.findNodeByElem(n),o=g.findNodeByElem(o),n=x.getTreePosition(n,o),o=n,o=(n=y.collapsed&&o[2]===o[1]&&x.isType(o[1],C.line)?[o[0],o[1].getFirstBrother(),o[1].getLastBrother()]:o)[1],r=n[1]===n[2]?null:n[2]):o=this.editor.findNodeByElem(this.editor.getMarkElem()),o&&(this.editor.brush.pause(!0),f==C.blockquote?a(o,r,e):l(o,r,e,f,t),this.editor.quickRefresh(),e.redo.push(t),this.editor.undo.exeCommand(t),this.editor.undo.register(e),this.editor.brush.resume(),this.editor.refocus(),this.editor.selection.scrollAdjust())))}changeHeadingLevel(e,t,n){var i,r=null;e.get("type")==C.paragraph?n&&(n=/h(\d)/.exec(n))?i=+n[1]:t&&(r="header6"):e.get("type")==C.heading&&(i=+e.get("depth")),void 0!==i&&(7==(i-=t?1:-1)?r="paragraph":0<i&&(r="header"+i+"")),r&&this.changeBlock(r)}}var s,i=["hr","fences","def_link","meta_block","raw_edit","math_block","toc","html_block"],e=["code","comment","atag","imgtag"],b={SyntaxMap:{strong:["**","**"],em:["*","*"],code:["`","`"],del:["~~","~~"],underline:["<u>","</u>"],footnote:["[^"," ]"],link:["[","]()"],image:["![","]()"],highlight:["==","=="],superscript:["^","^"],subscript:["~","~"],inline_math:["$","$"],comment:["\x3c!--","--\x3e"]},NormalBlockMap:{line:"Paragraph",paragraph:"Paragraph",header1:"Header 1",header2:"Header 2",header3:"Header 3",header4:"Header 4",header5:"Header 5",header6:"Header 6",def_link:"Link Reference",def_footnote:"Footnotes"},InsertInline:["link","image","footnote","inline_math"],LinkList:["autolink","reflink","link"],NoInlineBlock:i,NoInlineInline:e,NoInline:i.concat(e),Selectable:["hr","math_block","toc","html_block","fences"],InsertBlock:["table","fences","hr"],StyleToNameMap:{paragraph:"Paragraph",header1:"Heading 1",header2:"Heading 2",header3:"Heading 3",header4:"Heading 4",header5:"Heading 5",header6:"Heading 6",def_link:"Link Reference",def_footnote:"Footnotes",table:"Table",fences:"Code Fences",blockquote:"Quote",toc:"Table of Contents",hr:"Horizontal Line",meta_block:"YAML Front Matter",ol:"Ordered List",ul:"Unordered List",tasklist:"Task List",html_block:"HTML Block",strong:"Strong",em:"Emphasis",code:"Code",del:"Strike",highlight:"Highlight",inline_math:"Inline Math",math_block:"Math Block",superscript:"Superscript",subscript:"subscript",image:"Image",footnote:"Superscript",autolink:"Hyperlink",reflink:"Hyperlink",link:"Hyperlink",url:"Hyperlink",underline:"Underline",comment:"Comment"},NameMapToStyle:{}};for(s in b.StyleToNameMap)b.NameMapToStyle[b.StyleToNameMap[s].toLowerCase()]=s;b.InsertQuery='[md-inline="'+b.InsertInline.join('"],[md-inline="')+'"]',b.getMenuBlockType=function(e){var t=e.get("type");switch(t){case C.heading:return"header"+e.get("depth");case C.list:return e.get("style")}return t},r.CONST=b,n.exports=r}),$__System.registerDynamic("5b",["11","13","1b","1d"],!0,function(e,t,n){"use strict";this||self,e("11");var i=e("13"),p=e("1b"),f=i.Node,m=i.TYPE,g=i.NodeCollectionUtils,r=(e("1d"),function(e,t){return e?t(e)?e:(e=e.get("parent"))?r(e,t):null:null});function y(e,t){return e?e.get("after")?t(e.get("after").getVeryFirst()):y(e.get("parent"),t):null}function v(e){File.editor.mathBlock.cacheUnder(e),e.remove()}function b(e){File.editor.mathBlock.cacheUnder(File.editor.findElemById(e)[0])}function w(e,t,n){var i;if(!e)return e;if(!n&&!e.get("parent"))return null;if(f.isType(e.get("before"),m.list))return e;if(!(n=r(e,function(e){return f.isType(e.get("parent"),m.list_item)}))&&t)for(i=t;i;){if(i==e||i.contains(e))return i;i=i.get("after")}return n}function x(e){return e&&r(e,function(e){return f.isType(e.get("parent"),m.list_item)})}function C(e){return r(e,function(e){return f.isType(e.get("parent"),m.blockquote)})}function F(e,t,n){return f.isType(e,m.list)&&f.isType(t,m.list)&&(n||e.get("style")==e.get("style"))}function S(e,t,...n){for(var i=e;i;){var r,o=i.get("after");for(r of n)t&&t.undo.push(p.buildAttrUndo(i,r)),i.unset(r),t&&t.redo.push(p.buildAttrUndo(i,r));i=o}}var o=function(e,t,n){var i=[];function r(e){return document.querySelector(`[cid="${e.cid}"]`)}for(var o,a,s,l,c,d,u,i=function(e,t){for(var n,i=e,r=[];i&&i.get("parent");){var o=null,a=n&&i.get("before")==n;if(f.isType(i,m.list)&&i.contains(t)&&(i=i.getFirstChild().getFirstChild(),a=!0),f.isType(i.get("before"),m.list)||a)r.push(i),o=(n=i).get("after")||y(i.get("parent"),w);else if(f.isType(i.get("parent"),m.list_item))if(n=null,i.get("parent").get("before"))i.get("before")||(r.push(i),f.isType(i.get("after"),m.list)?(o=i.get("after"),n=i):o=y(i.get("parent"),w));else{if(!f.isType(i.closest(m.list).get("before"),m.list)&&!a)break;r.push(i),o=y(i.get("parent"),w)}if(i==t||i.contains(t))break;i=o}return r}(e,t),h=0;h<i.length;h++)o=i[h],a=h,u=d=c=l=s=void 0,o.isDeleted()||(f.isType(o.get("before"),m.list)?(u=o.get("before"),p.addUndoForRemove(n,o),r(s=o.get("before").getLastChild()).append(r(o)),s.appendChild(o),p.addUndoForInsert(n,o),f.isType(u.get("after"),m.list)&&(s=u.get("after"),p.addUndoForRemove(n,s),l=f.genArrFrom(s.getFirstChild()),u.appendChildrenTillEnd(l[0]),v(r(s)),s.remove(),p.addUndoForInsertArray(n,l),$(r(l[0].get("before"))).after(g.toHTML(l)),File.editor.mathBlock.clearCache())):(l=(s=o.get("parent")).get("before"),f.isType(s,m.list_item)&&(l?(p.addUndoForRemove(n,s),v(r(s)),(u=s.get("parent").clone()).unset("start"),s.unset("prespace"),s.unset("userIndent"),u.appendChild(s),d=o.get("after"),f.isType(d,m.list)&&(c=f.genArrFrom(d.getFirstChild()),u.appendChildrenTillEnd(c[0]),s.copyContentFrom(c[0],["pattern","subindent","prespace","markindent","ahead","tail"]),o.copyContentFrom(c[0].getLastChild(),["tail"]),S(s,null,"userIndent"),u.addAfterTillEnd(d.get("after")),k(d))&&(d.remove(),o=i.indexOf(d),d=null,a<o)&&i.splice.apply(i,[o,1].concat(c.map(e=>e.getFirstChild()))),l.appendChildrenTillEnd(u),d&&!f.isType(d,m.list)&&l.appendChildrenTillEnd(d),a=f.genArrFrom(u),p.addUndoForInsertArray(n,a),F(u.get("before"),u,!0)&&(p.addUndoForRemove(n,u),a=f.genArrFrom(u.getFirstChild()),(o=u.get("before")).appendChildrenTillEnd(u.getFirstChild()),u.remove(),S(o.getFirstChild(),null,"userIndent","prespace","markindent"),p.addUndoForInsertArray(n,a)),S(l.get("after"),n,"userIndent"),b(l.cid),$(r(l)).replaceWith(l.toHTML()),File.editor.mathBlock.clearCache()):(d=(c=s.get("parent"))&&c.get("before"),f.isType(d,m.list)&&(l=d.getLastChild(),p.addUndoForRemove(n,s),v(r(s)),(u=c.clone()).appendChild(s),l.appendChild(u),p.addUndoForInsert(n,u),b(l.cid),$(r(l)).replaceWith(l.toHTML()),File.editor.mathBlock.clearCache(),k(c))&&(p.addUndoForRemove(n,c),c.remove(),r(c).remove())))));return n};function a(e,t){for(t=t||1;0<t&&e;)e.unset("tail"),e=e.getLastChild(),t--}function s(e){var t,n,i=e.get("parent"),r=i.clone(),o=(a(r,2),e.get("after"));return o&&((t=o)&&(n=(t=f.genArrFrom(t))[0].get("userIndent"))&&!/^\s*1\./.exec(n)&&t.forEach(function(e){e.unset("userIndent")}),r.appendChildrenTillEnd(o)),i.addAfter(e),a(e,2),e.addAfter(r),[i,r]}function k(e){return 0==e.get("children").length}f.upStream=function(e,t){t=t||p.makeEmptyCommand();var n,i,r,o,a=e.get("parent");if(f.isType(a,m.list_item)&&(e.get("before")?!e.get("after")&&f.isType(e,m.paragraph,m.heading)&&f.isEmptyBlock(e)&&(p.addUndoForRemove(t,e),(o=a.clone()).appendChildrenTillEnd(e),a.addAfter(o),p.addUndoForInsert(t,o),b((o=a.get("parent")).cid),o={oldCid:o.cid,html:o.toHTML()},File.editor.mathBlock.clearCache()):(n=[],[i,r]=(p.addUndoForRemoveArray(t,f.genArrFrom(a)),s(a)),o={oldCid:i.cid},b(i.cid),n=a.unwrap(),k(r)?r.remove():n.push(r),p.addUndoForInsertArray(t,n),k(i)?(p.addUndoForRemove(t,i),i.remove()):(i.getLastChild().unset("tail"),n.unshift(i)),o.html=g.toHTML(n,{mathCount:0}),File.editor.mathBlock.clearCache())),o=f.isType(a,m.blockquote)?(E(e,e,t)||[])[0]:o)return{oldCid:o.oldCid,newHtml:o.html,command:t}};var E=function(e,t,o,a){return a=a||[],function(e,t){for(var n=e,i=[];n&&f.isType(n.get("parent"),m.blockquote)&&(i.push(n),n!=t);)n=y(n,C);return i}(e,t).forEach(function(e){var t,n,i,r;e.isDeleted()||(t={},[n,i]=(p.addUndoForRemoveArray(o,f.genArrFrom(e)),s(e)),r=[],t.oldCid=n.cid,b(t.oldCid),r.push(e),n.addAfter(e),e.addAfter(i),k(i)?i.remove():r.push(i),p.addUndoForInsertArray(o,r),k(n)?(p.addUndoForRemove(o,n),n.remove()):r.unshift(n),t.html=g.toHTML(r,{mathCount:0}),a.push(t),File.editor.mathBlock.clearCache())}),a},T=function(e,t,l,c){function d(e){return s(e)}return c=c||[],function(e,t){for(var n=e,i=[];n&&f.isType(n.get("parent"),m.list_item)&&(i.push(n),!n.get("parent").contains(t));)n=y(n.get("parent"),w);return i}(e,t).forEach(function(e){var t,n,i,r,o,a,s;e.isDeleted()||(t={},i=(n=e.get("parent")).get("parent"),s=[],e.get("before")?(l.undo.push(p.buildReplaceUndo(n)),n.get("after")&&(r=p.addUndoForInsertArray({undo:[],redo:[]},f.genArrFrom(n.get("after"))),l.undo.push(r.redo[0]),l.redo.push(r.undo[0])),[e,o]=((a=n.clone()).appendChildrenTillEnd(e),n.addAfter(a),t.oldCid=i.cid,d(a)),s=a.unwrap(),r=p.addUndoForInsertArray({undo:[],redo:[]},s),l.redo.push(r.undo[0]),k(o)?o.remove():F(o,s.last())?(s.last().appendChildrenTillEnd(o.getFirstChild()),o.remove()):s.push(o),r=p.addUndoForInsertArray({undo:[],redo:[]},s),l.redo.push(r.redo[0]),l.undo.push(r.undo[0]),s.unshift(e)):f.isType(i.get("parent"),m.list_item)?(l.undo.push(p.buildReplaceUndo(i.get("parent"))),i.get("after")&&!n.get("after")&&(l.redo.push({type:"remove",idArray:f.genArrFrom(i.get("after")).map(e=>e.cid)}),i.getLastChild().appendChildrenTillEnd(i.get("after"))),[a,o]=d(n),k(o)?o.remove():n.appendChildrenTillEnd(o),(e=n.get("parent")).addAfter(n),r=p.addUndoForInsert({undo:[],redo:[]},n),l.redo.push(r.undo[0]),l.redo.push(r.redo[0]),l.undo.push(r.undo[0]),t.oldCid=e.cid,k(a)&&(p.addUndoForRemove(l,a),a.remove()),k(e)?(p.addUndoForRemove(l,e),e.remove()):s.push(e),S(n.getFirstBrother(),l,"userIndent","prespace","markindent"),s.push(n)):(l.undo.push(p.buildReplaceUndo(i)),r=p.addUndoForInsertArray({undo:[],redo:[]},f.genArrFrom(n)),l.redo.push(r.undo[0]),t.oldCid=i.cid,[o,a]=d(n),s=n.unwrap(),k(a)?a.remove():s.push(a),r=p.addUndoForInsertArray({undo:[],redo:[]},s),l.redo.push(r.redo[0]),l.undo.push(r.undo[0]),k(o)?(p.addUndoForRemove(l,o),o.remove()):s.unshift(o)),b(t.oldCid),t.html=g.toHTML(s,{mathCount:0}),c.push(t),File.editor.mathBlock.clearCache())}),c};t.moreIndent=function(e){var t,n,i,r=e.selection.getRangy();return!(r&&!File.isLocked)||(f.isType(isInputComponent(document.activeElement))?((t=$(document.activeElement).closest(".CodeMirror")[0])&&t.CodeMirror.execCommand("indentMore"),!0):(t=e.getMarkElem(r.startContainer),t=w(e.findNodeByElem(t)),r=e.getMarkElem(r.endContainer),r=w(e.findNodeByElem(r),t),e.undo.endSnap(!0),e.brush.pause(),t&&!r&&(r=t.closest(m.list).getLastChild().getFirstChild()),t&&r?(n=e.selection.buildUndo(),i=p.makeEmptyCommand(n),(t!=r||!f.isType(t,m.table))&&(o(t,r,i),i.redo.length&&(i.redo.push(n),e.undo.exeCommand(n),e.undo.register(i),e.refresh(),e.selection.scrollAdjust()),window.Reporter.fullValidate(),e.brush.resume(),i.redo.length)):(e.brush.resume(),!1)))},t.lessIndent=function(e){if(!(r=e.selection.getRangy())||File.isLocked)return!0;if(isInputComponent(document.activeElement))return(o=$(r.startContainer).closest(".CodeMirror")[0])&&o.CodeMirror.execCommand("indentLess"),!0;function t(){e.brush.pause(),e.undo.endSnap(!0),n=e.selection.buildUndo(r),i=p.makeEmptyCommand(n)}var n,i,r=e.selection.deRange(r),o=e.getMarkElem(r.startContainer),a=x(e.findNodeByElem(o)),s=e.getMarkElem(r.endContainer),l=x(e.findNodeByElem(s)),c=(a&&!l&&(l=a.closest(m.list).getLastChild().getFirstChild()),!1);if(a&&l){if(a==l&&f.isType(a,m.table))return!1;t(),c=T(a,l,i)}c||(a=C(e.findNodeByElem(o)),l=C(e.findNodeByElem(s)),f.isType(a,m.paragraph,m.def_footnote,m.def_link,m.heading)&&(t(),c=E(a,l,i))),c||(a=e.findNodeByElem(o),l=e.findNodeByElem(s),n=e.selection.buildUndo(r),i=p.makeEmptyCommand(Object.clone(n)),c=[],function e(t,n,i){if(t&&i(t),t&&t!==n&&!t.contains(n)&&!n.contains(t)){for(var r=t.get("after"),o=t;!r;)r=(o=o.get("parent")).get("after");e(r=r&&r.getVeryFirst(),n,i)}}(a,l,function(e){!function(e,t,n){if(f.isType(e,m.paragraph,m.heading)){var i=e.get("text"),r=(/^\u200b*(\t|( {1,2}))/.exec(i)||[])[0];if(r)return i=i.substr(r.length),t.undo.push(p.buildReplaceUndo(e)),e.set("text",i),e.id===(n.startId||n.id)&&(n.start-=r.length),e.id===(n.endId||n.id)&&(n.end-=r.length),t.redo.push(p.buildReplaceUndo(e)),1}}(e,i,n)||c.push({oldCid:e.id,html:e.toHTML()})}),0==c.length&&(c=!1));var d=c;if(d){for(var u=0;u<d.length;u++){e.findElemById(d[u].oldCid).replaceWith(d[u].html);var h=e.findElemById(d[u].oldCid)[0];h&&e.refreshUnder(h,!1,!1)}e.undo.exeCommand(n),i.redo.push(n),e.undo.register(i),window.Reporter.fullValidate()}return e.brush.resume(),e.mathBlock.clearCache(),d&&a!=l},t.tryConvertListItemToUpperParagraph=function(e,t){if(f.isType(t.get("parent"),m.list_item)&&t.get("parent").get("before")&&!t.get("before")){for(var n=p.makeEmptyCommand(e.selection.buildUndo()),i=t.get("parent"),r=i.get("before"),o=r.getLastChild(),a=f.genArrFrom(t),s=(p.addUndoForRemove(n,i),r.appendChildrenTillEnd(t),p.addUndoForInsertArray(n,a),i.remove(),e.findElemById(i.id).remove(),e.findElemById(o.id).after(g.toHTML(a,{mathCount:0})),e.selection.jumpIntoElemBegin(e.findElemById(t.id)),t.closest(m.list));s;)S(s.getFirstChild(),n,"tail"),s=(s=s.get("parent"))&&s.closest(m.list);return n.redo.push(e.selection.buildUndo()),n}}}),$__System.registerDynamic("5c",["11","13","1b","1d","1e"],!0,function(e,t,n){"use strict";this||self,e("11");var i=e("13"),m=e("1b").SnapFlag,g=(i.Node,i.TYPE,e("1d"),e("1e")),y={"(":")","[":"]","{":"}",'"':'"',"'":"'","~":"~","^":"^","=":"=","*":"*","`":"`",$:"$",_:"_"},l=null;var a=null;var v=null;t.handlePair=function(n,i,r,o,a,s){if(!File.option.noPairingMatch){var e;if(/^[\]\)\}'"]$/.exec(i)){if(n.undo.endSnap(),n.undo.addSnap(r.cid,0),e=n.findElemById(r.cid).rawText(),i===e.substring(o.start,o.start+1))return p(),a||!0;if("'"==i||'"'==i){if(""==e)return("'"!=i||!~(File.option.keyboardLayout||"").indexOf("Ukrainian"))&&f();var t,l=(t=e.substring(0,o.start)).slice(-1),c="'"==i;if(g.shouldTriggerReplaceQuote(!0)&&-1=="\"'".indexOf(g.userQuote(c?2:0))&&g.shouldTriggerReplace(n,s)){var d,u=g.userQuote(c?3:1,void 0,!0);if(u==(d=e.substring(o.start,o.start+u.length)))return p(u.length),a||!0;if(g.userQuote(c?2:0)==l)return c=u,u=n.selection.getRangy(),c=document.createTextNode(c),u.insertNode(c),c.parentElement.normalize(),p(),a&&n.undo.register(a),n.undo.addSnap(r.cid,m.REPLACE),!0}if(i!=l&&"\\"!=l&&!/[\w\u0430-\u044fàâäèéêëîïôœùûüÿçÀÂÄÈÉÊËÎÏÔŒÙÛÜŸÇĀ-ɏ]|(^[.?,!:~\)\]])/i.exec(e.substring(Math.max(0,o.start-1),o.start+1))&&!function(e,t){var n=File.option.userQuotesArray||["“","”","‘","’"];function i(e,t){return t&&n[0]==e||n[1]==e?'"':t&&n[2]==e||n[3]==e?"'":e}for(var r,o,a=e.length,s=0;s<a;s++){var l=i(e[s],!0),c=i(e[s],!1),l=l||c;("'"!=l||!r&&/[\w\u0430-\u044fàâäèéêëîïôœùûüÿçÀÂÄÈÉÊËÎÏÔŒÙÛÜŸÇĀ-ɏ]/i.exec(e[s-1]||""))&&'"'!=l||(r?o=r==l?r=null:o?null:l:r=l)}return(t=i(t,!1))==r||t==o}(t,i))return f()}}else if(/^[\[\(\{]$/.exec(i)){if(n.undo.endSnap(),d=(e=n.findElemById(r.cid).rawText()).substring(o.start,o.start+1),!/[^\[\]{}()"'\s`>$]/.exec(d))return f()}else if(File.option.autoPairExtendSymbol&&(v||(u="*`_",File.option.enableInlineMath&&(u+="$"),v=new RegExp("^["+u+"]$")),v.exec(i))){if(n.undo.endSnap(),s&&s.commonAncestorContainer&&s.commonAncestorContainer.parentElement&&("CODE"==s.commonAncestorContainer.parentElement.tagName&&"`"!=i||"SCRIPT"==s.commonAncestorContainer.parentElement.tagName&&"$"!=i))return;if(e=n.findElemById(r.cid).rawText(),File.option.enableInlineMath&&"$"==e.substring(o.start-1,o.start)&&/[*`^_~=]/.exec(i))return;c=(t=t||e.substring(0,o.start))[t.length-1]||"";if("\\"==c)return!1;d=e.substring(o.start,o.start+1);var l=e.substring(o.start+1,o.start+2),h=/[*_]/.exec(i);if(d==i)return h&&!l&&(!(h=$(n.selection.getRangy().commonAncestorContainer)).closest(".md-after").length||!h.parent().parent("[md-inline='strong'], [md-inline='em']").length)&&(t=e.substring(0,o.start),/[*_]$/.exec(t))?f():(p(),!0);l=0==c.trim().length;if(l||!function(e,t){if("`"==t&&/``$/.exec(e))return 1;e.replace(/\\[*`_$]/g,"");for(var n=(e="_"==t?e.replace(/([a-z])_([a-z])/gi,""):e).length,i=!1,r=0;r<n;r++)e[r]==t&&(i=!i);return i}(t,i)){if(l&&!/^[^\s\>\)\]}'";:.,?!~*\/&#=_+-]/.exec(d))return f();if(1<(c+"a").trim().split(/\b/).length)return f()}}return!1}function p(e){e=e||1;var t=n.selection.rangy.createRange();o.end+=e,o.start+=e,t.moveToBookmark(o),t.select(t.isBackward),a&&a.redo.push(n.selection.buildUndo())}function f(){var e,t;if(!a)return t=n.selection.getRangy(),e=document.createTextNode(i+y[i]),t.insertNode(e),t.setStart(e,i.length),t.setEnd(e,i.length),t.select(),n.undo.addSnap(r.cid,m.REPLACE),g.shouldTriggerReplaceQuote(!0)&&/['"]/.exec(i)&&g.shouldTriggerReplace(n,s)&&g.replaceQuote(e),t=2<e.textContent.toString().length,e.parentElement.normalize(),p(),t&&p(),n.undo.addSnap(r.cid,m.REPLACE),!0}},t.surroundPair=function(e,t,n){var i,r,o,a,s;if(e.undo.endSnap(),!File.option.noPairingMatch)return r=$(n.commonAncestorContainer).closest("[cid]"),i=$(n.commonAncestorContainer).closest(".md-def-content:not(.md-def-url)"),(r.length&&!r.find("[cid], .md-def-name").length||i.length)&&(l||(s="\\{\\(\\[\"'",File.option.autoPairExtendSymbol&&(s+="*`~_",File.option.enableInlineMath&&(s+="$"),File.option.enableSuperscript&&(s+="^"),File.option.enableHighlight)&&(s+="="),l=new RegExp("^["+s+"]$")),l.exec(t))?(s=e.findNodeByElem(r),e.undo.addSnap(s.cid,0),r=i.length?i:r,i=n.getBookmark(r[0]),(n=e.selection.rangy.createRange()).moveToBookmark(i),e.selection.deRange(n),r=document.createTextNode(t),o=document.createTextNode(y[t]),n.insertNode(r),i.end++,n.moveToBookmark(i),e.selection.deRange(n),n.insertNodeAtEnd(o),i.start++,n.moveToBookmark(i),n.select(n.isBackward),e.undo.addSnap(s.cid,m.REPLACE),a=g.userQuote('"'==t?0:2,!1,!0),g.shouldTriggerReplaceQuote(!0)&&/['"]/.exec(t)&&!/['"]/.exec(a)&&g.shouldTriggerReplace(e,n)&&(g.replaceQuote(r,o),2==a.length&&(i.start+=1,i.end+=2),n.moveToBookmark(i),n.select(n.isBackward)),e.undo.addSnap(s.cid,m.REPLACE),!0):void 0},t.tryRemovePairStart=function(e,t){var n=t.toString();if(!File.option.noPairingMatch&&((1!=t.endOffset||!$(t.endContainer).closest(".md-after, .md-before").length)&&(a||(i="\\{\\(\\[\"'",File.option.autoPairExtendSymbol&&(i+="*`~_",File.option.enableInlineMath&&(i+="$"),File.option.enableSuperscript)&&(i+="^"),a=new RegExp("["+i+"]")),a.exec(n)||g.userQuote(0,!0)==n||g.userQuote(2,!0)==n))){var i=$(t.commonAncestorContainer).closest("[cid]"),r=i.rawText(),o=t.getBookmark(i[0]),r=r.substring(o.end,o.end+1);if(y[n]==r||g.userQuote(0,!0)==n&&g.userQuote(1,!0)==r||g.userQuote(2,!0)==n&&g.userQuote(3,!0)==r)return o.end++,t.moveToBookmark(o),t}}}),$__System.registerDynamic("5d",["11","13","1b","46","2c","5b","5c"],!0,function(e,t,n){this||self,e("11");var i=e("13"),P=e("1b"),B=P.SnapFlag,R=i.Node,O=i.TYPE,I=(i.NodeCollectionUtils,e("46")),H=e("2c"),U=e("5b"),j=e("5c"),q="skipCommand",W=$("content"),z=function(e,t){var t=t.get("parent"),n=t&&t.get("parent");if(n&&n.get("style")==R.ListType.task&&!t.get("before")&&R.isType(t,O.paragraph))return(t=P.makeEmptyCommand(e.selection.buildUndo())).undo.push(P.buildReplaceUndo(n)),n.unset("style"),n.unset("checked"),e.findElemById(n.cid).replaceWith(n.toHTML()),t.redo.push(P.buildReplaceUndo(n)),e.undo.exeCommand(t.undo[0]),t.redo.push(e.selection.buildUndo()),t},V=function(e,t,n){e.undo.endSnap(!0);var i=R.isType(t.get("parent"),O.blockquote)&&(n||!t.get("before")),n=R.isType(t.get("parent"),O.list_item)&&(n||!t.get("parent").get("before")&&!t.get("before"));if(i||n)return i=P.makeEmptyCommand(e.selection.buildUndo()),n=R.upStream(t,i),e.findElemById(n.oldCid).replaceWith(n.newHtml),e.undo.exeCommand(i.undo[0]),i.redo.push(e.selection.buildUndo()),i},J=function(e,t,n,i){e.undo.endSnap(!0);var r=P.makeEmptyCommand(e.selection.buildUndo());return r.undo.push(P.buildReplaceUndo(t)),t.set("type",O.paragraph),t.clearChildren(),n?t.set("text",""):t.set("text",t.get("text").replace(/\u200B|(\r?\n)/g,"")),r.redo.push(P.buildReplaceUndo(t)),e.findElemById(t.id).replaceWith(t.toHTML()),e.selection.jumpIntoElemBegin(e.findElemById(t.id)),r.redo.push(e.selection.buildUndo()),i||$(e.sessionStr).trigger("cursorChange"),r},K=function(e,t,n,i){var r,o;if(e.undo.endSnap(!0),t&&t.length)return n&&n.preventDefault(),r=e.findNodeByElem(t),o=P.makeEmptyCommand(e.selection.buildUndo()),r?(r.set("text",""),o=P.append(o,J(e,r))):(r=e.findNodeByElem(t.closest("[mdtype]")),o.undo.push(P.buildReplaceUndo(r)),e.selection.moveLeftOrRight(!0,n),t.remove(),e.store(r.id),o.redo.push(P.buildReplaceUndo(r)),o.redo.push(e.selection.buildUndo())),i||e.undo.register(o),o},a=function(i,r,o,t,e){i.needRemoveMathAfterSym&&(i.needRemoveMathAfterSym=!1,$(".math-jax-postprocess>.md-math-after-sym").text(""));var n,a,s,l,c=i.selection.includeTrailMeta(i.selection.getRangy()),d=c&&i.selection.deRange(c.cloneRange()),u=document.activeElement,h=!1,p=c;function f(e,t,n){var i,r=e;if(e==t)return null;for(i=e.get(n);i;)$("[cid='"+i.id+"']").remove(),i.remove(),i=e.get(n);return f(e.get("parent"),t,n),r}function m(e,t,n,i,r){var t=t.cloneRange(),o=e.findElemById(n.id);return o.length?(t.setEndAfter(o[0]),e.selection.deRange(t),o=e.findNodeByElem(e.getMarkElem(t.startContainer)),!r&&$(t.startContainer).closest("table").length?(P.append(i,C(e,t,!0)),o=e.findNodeByElem($(t.startContainer).closest("[mdtype='table']")),n.contains(o)&&(f(o,n,"after"),0===o.getText().length)?(P.append(i,J(e,o)),"abortAndSkipCursor"):"abort"):(i.undo.push(P.buildReplaceUndo(n)),r=$(t.extractContents()),R.isType.apply(null,[n].concat(H.CONST.Selectable))&&P.append(i,J(e,n,!0,!0)),e.store(o,!0),e.findElemById(o.cid).replaceWith(o.toHTML()),t=f(o,n,"after"),!!(r.text().length||r.find("img").length||t)&&(i.redo.push(P.buildReplaceUndo(n)),o))):"abort"}function g(e,t,n,i,r){var o,t=t.cloneRange(),a=e.findElemById(n.id);if(t.setStartBefore(a[0]),e.selection.deRange(t),!r&&$(t.endContainer).closest("table").length)return P.append(i,C(e,t,!0)),o=e.findNodeByElem($(t.endContainer).closest("[mdtype='table']")),"abort";i.undo.push(P.buildReplaceUndo(n)),o=e.findNodeByElem(e.getMarkElem(e.selection.getEndNode(t))),a=$(t.extractContents()),e.store(o,!0);var s=e.findElemById(o.cid),r=f(o,n,"before");if(a.text().length||a.find("img").length||r){for(i.redo.push(P.buildReplaceUndo(n));s.parent().closest(".md-task-list-item").length;)s=s.parent().closest(".md-task-list-item");return s.hasClass("md-task-list-item")?s.replaceWith(e.findNodeByElem(s).toHTML()):s.replaceWith(o.toHTML()),o}return s.replaceWith(o.toHTML()),!1}function y(e,t,n,i,r,o,a){function s(e,t){return e==t||e.get("before")||e.get("after")?e:s(e.get("parent"),t)}var l,c,d=R.isEmptyBlock(i);!d||i==r||R.isEmptyBlock(r)&&!a?(d&&i==r&&r.isBlock()?(r.set("type",O.paragraph),r.set("text",""),r.clearChildren(),e.findElemById(r.id).replaceWith(r.toHTML()),e.selection.jumpIntoElemBegin(e.findElemById(r.id))):(console.assert(t!=n,"Error on spliceStartAndEnd"),t!=n&&(a=n.safeGetStrAttr("text"),d=s(n,r),P.addUndoForRemove(o,d),e.findElemById(d.id).remove(),d.remove(),c=t,c=(R.isType(c,O.math_block,O.fences,O.html_block)?c.get("text"):$(c.toHTML()).rawText()).length,o.undo.push(P.buildReplaceUndo(i)),R.isType(t,O.def_link)?t.safeGetStrAttr("title").length?t.set("title",t.get("title")+a):(l=/["']([^"]*)["']\s*$/g.exec(a),a=a.replace(/"([^"])*"\s*$/,""),l&&t.set("title",l[1]),t.set("href",t.get("href")+a)):t.set("text",t.safeGetStrAttr("text")+a),d!=r&&r!==n&&r.get("before")==i&&R.isType(i,O.list_item)&&(l=r.getFirstChild(),P.addUndoForRemove(o,r),i.appendChildrenTillEnd(l),e.findElemById(r.id).remove(),r.remove()),o.redo.push(P.buildReplaceUndo(i)),e.findElemById(i.id).replaceWith(i.toHTML()),l=e.findElemById(t.id)),((l=e.findElemById(t.id)).hasClass("md-def-link")||l.hasClass("md-def-footnote"))&&l.attr("contenteditable","true"),e.undo.exeCommand({type:"cursor",id:t.id,start:c,end:c})),o.redo.push(e.selection.buildUndo())):(e.findElemById(i.id).remove(),P.addUndoForRemove(o,i),i.remove(),a=s(n,r),e.findElemById(a.id).replaceWith(a.toHTML()),e.selection.jumpIntoElemBegin(e.findElemById(a.id)))}function v(n,e){var t=e.get("before");function i(e){var t=P.makeEmptyCommand(n.selection.buildUndo());return P.addUndoForRemove(t,e),n.findElemById(e.id).remove(),e.remove(),t.redo.push(n.selection.buildUndo()),t}return R.isType(t,O.hr)||t&&!R.isEmptyBlock(e)&&R.isEmptyBlock(t)||!t&&R.isType(e.get("parent"),O.list_item)&&(t=e.get("parent").get("before"))&&1==t.get("children").length&&R.isEmptyBlock(t.get("children").at(0))?i(t):void 0}function b(e,t){var n;if(R.isType(t,O.table_cell))return n=t.get("parent").get("parent"),!r||o||t.get("before")||t.get("parent").get("before")||!e.tableEdit.isTableEmpty(n)?((t=I.getSibling(t,"before"))&&(s=P.makeEmptyCommand(e.selection.buildUndo()),e.selection.jumpIntoElemEnd(e.findElemById(t.id)),s.redo.push(e.selection.buildUndo())),s):e.tableEdit.deleteTable(e.findElemById(n.cid),!0)}function w(e,t){if(R.isType(t,R.backToParagraphBeforeDelete))return e.stylize.changeBlock(O.paragraph,t),q}function x(e,t,n,i,r){for(var o=[b,v,z,V,U.tryConvertListItemToUpperParagraph,w],a=null,s=0;s<o.length;s++)if(a=o[s](e,t))return a;return n=n||t,r=r||n.get("before"),i=i||r&&r.getVeryFirst(!0),!a&&i&&(a=P.makeEmptyCommand(e.selection.buildUndo()),y(e,i,t,r,n,a)),!a&&!i&&R.isType(t,O.paragraph)&&R.isEmptyBlock(t)&&t.get("after")&&(a=P.makeEmptyCommand(e.selection.buildUndo()),r=t.get("after").cid,P.addUndoForRemove(a,t),t.remove(),e.findElemById(t.cid).remove(),e.selection.jumpIntoElemBegin(e.findElemById(r)),a.redo.push(e.selection.buildUndo())),a}function C(e,t,n){var i,r=e.selection.getDetailPos(t.startContainer,t.startOffset),o=e.selection.getDetailPos(t.endContainer,t.endOffset),a=P.makeEmptyCommand(),s=e.getMarkElem(r[0]),l=e.getMarkElem(o[0]),c=l.closest('[mdtype="table"]'),c=e.findNodeByElem(c),d=e.findNodeByElem(s),u=e.findNodeByElem(l);if(n||((i=t.cloneRange()).collapse(!0),i=e.selection.buildUndo(i)),t.setStart(r[0],r[1]),t.setEnd(o[0],o[1]),d==u)t.collapsed||!R.isType(d,O.table_cell)||s[0]!=t.commonAncestorContainer&&!s[0].contains(t.commonAncestorContainer)||(a.undo.push(P.buildReplaceUndo(d)),t.extractContents(),e.store(d,!0),a.redo.push(P.buildReplaceUndo(d)),a.redo.push(e.selection.buildUndo(t)));else{a.undo.push(P.buildReplaceUndo(c));var h,p,l=m(e,t,d,a,!0),r=g(e,t,u,a,!0);for(l&&(l.unset("marginLeft"),l.unset("marginRight")),r&&(r.unset("marginLeft"),r.unset("marginRight")),h=c.contains(d)?e.tableEdit.getSibling(d,"after"):c.getVeryFirst();h&&h!=u;)h.set("text",""),h.unset("marginLeft"),h.unset("marginRight"),p=!0,h=e.tableEdit.getSibling(h,"after");l||r||p?(e.findElemById(c.id).replaceWith(c.toHTML()),a.redo.push(P.buildReplaceUndo(c))):a.undo.pop(),n||(a.redo.push(i),e.undo.exeCommand(i))}return a}function F(){var e=r&&(File.isNodeHtml?r.ctrlKey:r.altKey),t=!1;return"delSelection"==o?i.selection.getRangy():((t=e?t:i.selection.extendCharFromCollapse(d,!o))||(h=!0,File.inBusyMode&&setAttributeOnlyNeeded(i.writingArea,"contenteditable","true"),d=o?(window.getSelection().modify("extend","forward",e?"word":"character"),i.selection.getRangy()):(window.getSelection().modify("extend","backward",e?"word":"character"),e?(/\n/.exec(window.getSelection().toString())?(d.setStart(d.startContainer,0),d.select(d.isBackward)):d=i.selection.getRangy(),d):i.selection.getRangy())),!o&&/^\u200b|\007F$/g.exec(d.toString())&&(i.selection.extendCharFromCollapse(d,!0),S(d))||d)}function S(e){return i.selection.deRange(e),n=i.getMarkElem(e.commonAncestorContainer),a=i.nodeMap.allNodes.get(n.attr("cid")),l=e.getBookmark(n[0]),n.length&&a&&!a.get("children").length&&0==l.start&&!o}function k(){var e,t,n;return a.get("after")?(t=(e=a).get("after").getVeryFirst().cid,n=P.makeEmptyCommand(i.selection.buildUndo()),i.findElemById(e.cid).remove(),P.addUndoForRemove(n,e),e.remove(),i.selection.jumpIntoElemBegin(i.findElemById(t)),n.redo.push(i.selection.buildUndo()),n):R.isType(a,O.paragraph)?null:J(i,a,!0,!0)}function E(){var e=null;if(R.isType(a.get("before"),R.TYPE.hr,R.TYPE.toc)&&(e=a.get("before")),r&&r.preventDefault(),$(".md-tooltip-remove").remove(),n.prev("[cid]").addClass("md-expand"),(s=x(i,a))!==q&&!t)return e&&(i.selection.selectNode(e),s.redo.push(i.selection.buildUndo())),i.undo.register(s),i.refresh(),e||i.findElemById(a.cid).trigger("refocus"),i.refocus(),i.selection.scrollAdjust(),s}var T,_,A,M,L,N,D=$(document.activeElement).closest(".CodeMirror");if(D.length)return(D=D[0].CodeMirror).getValue()?void D.execCommand("delCharBefore"):Y(i,t);if(R.isType(u.getAttribute("mdtype"),R.TYPE.hr,R.TYPE.toc))return D=$(u).closest("[mdtype]"),K(i,D,r,t);if(u.getAttribute("mdtype")==O.math_block)return r&&r.preventDefault(),i.mathBlock.remove(u.getAttribute("cid")),s;if(o&&"Backspace"!=o?!0===o&&(o="Delete"):o=!1,d){if($(d.commonAncestorContainer).closest("[mdtype='table_row']").length&&r&&r.shiftKey&&(File.isMac?r.metaKey:r.ctrlKey))return r.preventDefault(),i.tableEdit.deleteRow(),q;if(d.collapsed){if(o){if("Delete"==o&&(D=d,i.selection.deRange(D),n=i.getMarkElem(D.commonAncestorContainer),a=i.nodeMap.allNodes.get(n.attr("cid")),l=D.getBookmark(n[0]),"Delete"==o)&&!a.get("children").length&&(R.isType(n.attr("mdtype"),O.paragraph,O.heading)?0==n.text().length:R.isType(n.attr("mdtype"),O.def_footnote,O.def_link)&&0==n.text().replace(/[\u200b\u00a0]/g,"").length)&&(s=k()))return t||(i.undo.register(s),i.refocus()),r&&r.preventDefault(),s}else if(S(d))return E();if(!0===(d=F()))return E();if(!o&&j.tryRemovePairStart(i,d)&&(e=!1),"delSelection"==o&&d&&d.collapsed)return r&&r.preventDefault(),P.makeEmptyCommand()}else u=d,i.selection.selectWordTime&&File.isMac&&(o?"Delete"==o&&u.endContainer.nodeType===document.TEXT_NODE&&(T=u.endContainer.textContent.charAt(u.endOffset),/\s/.exec(T))&&(u.endOffset++,p=u.cloneRange()):0<u.startOffset&&u.startContainer.nodeType===document.TEXT_NODE&&(T=u.startContainer.textContent.charAt(u.startOffset-1),/\s/.exec(T))&&(u.startOffset--,p=u.cloneRange()));if((D=d).startContainer.parentElement&&D.startContainer.parentElement.classList.contains("md-pants")&&0==D.startOffset&&D.setStart(D.startContainer.parentElement,0),e&&!(d.commonAncestorContainer.nodeType!=document.TEXT_NODE||0==o&&d.startOffset<=1||"Delete"==o&&d.endOffset>=d.commonAncestorContainer.textContent.length-1)&&(!(File.isNodeHtml&&r&&r.ctrlKey)||r.shiftKey)&&i.selection.getRangy().endContainer==d.endContainer)return null;if(i.selection.selectWordTime=null,i.selection.deRange(d),n=i.getMarkElem(d.commonAncestorContainer),a=i.nodeMap.allNodes.get(n.attr("cid")),h&&(window.getSelection().removeAllRanges(),window.getSelection().addRange(c.nativeRange)),!n.length||a){if(n.length&&!a.get("children").length){if(n.get("type")!==O.fences)return T=i,u=r,D=n,e=t,c=3!==(_=d).commonAncestorContainer.nodeType,L=T.getNode(D.attr("cid")),e||(T.undo.addSnap(L.cid,B.NONE),T.brush.clearAndPause()),p=T.selection.buildUndo(p),(s=P.makeEmptyCommand(p)).undo.push(P.buildReplaceUndo(L)),!c&&p&&p.startId==p.endId&&R.isType(L,O.line)&&(N=(D.text().substring(0,p.start).match(/\u200b/g)||[]).length,A=(D.text().substring(0,p.end).match(/\u200b/g)||[]).length,T.undo.lastSnap&&T.undo.lastSnap.selection.end==p.end&&T.undo.lastSnap.selection.start==p.start?(T.undo.lastSnap.selection.start-=N,T.undo.lastSnap.selection.end-=A):(p.start-=N,p.end-=A)),N=W.scrollTop(),(p=_.commonAncestorContainer).contains(document.querySelector("#write"))?void 0:(p.parentElement.getAttribute("md-inline")&&(A=p.parentElement,1!=D.children().length||D.children()[0]!=A||A.textContent.length!=_.toString().length||A.style.display||(A.style.display="inline-block")),_.toString(),p=_.extractContents(),N!=W.scrollTop()&&T.undo.clearEventTimer(),T.store(L.cid),s.redo.push(P.buildReplaceUndo(L)),R.isType(L,O.def_link,O.def_footnote)?T.selection.deRange(_,!0):L.getText().length||(T.findElemById(L.cid).html($(L.toHTML()).html()),_=T.selection.getRangy(),T.selection.deRange(_,!0)),s.redo.push(T.selection.buildUndo()),p.querySelector("img"),_.collapse(!1),c&&(A=D.attr("cid"),c=T.selection.saveSelection(D,_),_.setStart(D[0],0),M=0,D.find(".md-emoji-control-ch").each(function(){var e=(this.textContent+"").indexOf("​");0==_.comparePoint(this,e+1)&&(M++,this.textContent="")}),M&&(c.start-=M,c.end-=M),T.store(A,!0),e&&(D.replaceWith(T.nodeMap.allNodes.get(A).toHTML()),D=T.findElemById(A)),T.selection.restoreSelection(D,c),T.focusCid=null,T.refocus()),T.brush.addToQueue(D.attr("cid")),e||T.brush.resume(!0),u&&(u.preventDefault(),$("#write").trigger("input")),e||null!=u||T.undo.register(s),s);s=K(i,n,r,t)}else r&&r.preventDefault(),$(".md-tooltip-remove").remove(),s=function(n,e,t){if(!document.contains(e.startContainer)&&!(e=n.selection.getRangy()))return P.makeEmptyCommand();var i=n.selection.getDetailPos(e.startContainer,e.startOffset),r=n.selection.getDetailPos(e.endContainer,e.endOffset),o=n.getMarkElem(i[0]),a=n.getMarkElem(r[0]),s=n.findNodeByElem(o),l=n.findNodeByElem(a);if(!s||!l)return P.makeEmptyCommand();var c=(u=R.getTreePosition(s,l))[1],d=u[2],u=P.makeEmptyCommand(n.selection.buildUndo()),h=e.cloneRange();if(o[0]!=a[0]){if(h.collapse(!0),h=n.selection.buildUndo(h),e.setStart(i[0],i[1]),e.setEnd(r[0],r[1]),$(e.commonAncestorContainer).closest('[mdtype="table"]').length)return P.append(u,C(n,e));var o=m(n,e,c,u),a=g(n,e,d,u),p=c.get("after"),f=[];for(e=n.selection.getRangy(),n.selection.deRange(e,!0);p&&p!=d;)f.push(p),p=p.get("after");if(P.addUndoForRemoveArray(u,f,c,d),f.map(function(e){var t=n.findElemById(e.id);t.attr("mdtype")==O.math_block?n.mathBlock.beforeDeleteFences(t[0].getAttribute("cid")):t.find("[mdtype='math_block']").each(function(){n.mathBlock.beforeDeleteFences(this.getAttribute("cid"))}),t.remove(),e.remove()}),"abort"==o||"abort"==a||"abortAndSkipCursor"==o)"abortAndSkipCursor"!=o&&(e.collapse(!0),u.redo.push(h),n.undo.exeCommand(h)),!1===a&&0==l.getText().length&&(P.addUndoForRemove(u,l),n.findElemById(l.id).remove(),l.remove());else if(o||a||f.length||t)y(n,o||s,a||l,c,d,u,o);else if((u=x(n,l,d,s,c))==q)return P.makeEmptyCommand();u.redo.push(n.selection.buildUndo())}return u}(i,d,o),t||P.isEmptyCommand(s)||(i.undo.register(s),i.refocus(),i.refresh()),i.selection.scrollAdjust();return s}window.Reporter.reportLogicError("node to delete not exists in nodemap",window.Reporter.processDom(n))}},s={"[mdtype='hr']":a,"tr[mdtype='table_row']":I.deleteRow,".md-toc":K},l=function(e,t){if(!R.isType(e,O.list_item))return[];var n,i=!1;if(e.get("before")||e.get("after")||(e=e.get("parent")),!(n=n||e.getClosetBlock(!0).getVeryFirstBrotherIncludeTopBlock(!1,!0))){if(!e.get("before"))return P.append(t,J(File.editor,e,!0,!0)),[e];n=e.get("before").getVeryFirst(!0),i=!0}return editor.findElemById(e.cid).remove(),P.addUndoForRemove(t,e),e.remove(),[n,i]},Y=function(e,t,n){e||File.editor,e.undo.endSnap(!0);var i,r,o=e.getNode(e.focusCid);if(o){if(n=n||P.makeEmptyCommand(e.selection.buildUndo()),o=o.getClosetBlock(!1),R.isType(o,O.paragraph)&&!o.get("before")&&!o.get("after")&&o.get("parent")&&(o.get("parent").isVirtualBlock()?R.isType(o.get("parent"),O.list_item)&&!t&&(o=o.get("parent"),[i,r]=l(o,n)):o=o.get("parent")),!R.isType(o,O.math_block)){if(R.isType(o,O.fences)?File.editor.fences.beforeDeleteFences(o.cid):R.isType(o,O.math_block)&&File.editor.htmlBlock.beforeDeleteFences(o.cid),!i){if((i=o.getClosetBlock(!0).getVeryFirstBrotherIncludeTopBlock(!1))||(i=o.getClosetBlock(!0).getVeryFirstBrotherIncludeTopBlock(!0),r=!0),!i)return P.append(n,J(e,o,!0,!0)),t||e.undo.register(n),n;e.findElemById(o.cid).remove(),P.addUndoForRemove(n,o),o.remove()}return r?e.selection.jumpIntoElemEnd(e.findElemById(i.cid)):e.selection.jumpIntoElemBegin(e.findElemById(i.cid)),n.redo.push(e.selection.buildUndo()),e.refocus(i.cid),t||e.undo.register(n),n}File.editor.mathBlock.remove(o.cid)}};t.backspaceHandler=a,t.deleteSelectable=K,t.deleteLineProcessor=s,t.deleteLine=function(e){e.undo.endSnap(!0);var t=$(document.activeElement).closest(".CodeMirror");if(t.length)t[0].CodeMirror.execCommand("deleteLine");else{var n,i=e.getMarkElem();if(i&&i.length){for(n in s)if(i.closest(n).length)return void s[n](e,i.closest(n));var r,t=e.selection.getRangy().getBookmark(i[0]).start,o=e.findNodeByElem(i);R.isEmptyBlock(o)?Y(e):(o=!!t,r=(t=i).hasClass("md-expand"),t.addClass("md-expand"),o&&window.getSelection().modify("move","backward","sentence"),window.getSelection().modify("extend","forward","sentence"),r&&t.removeClass("md-expand"),a(e,null,"delSelection"))}}},t.deleteBlock=Y,t.backToParagraph=J}),$__System.registerDynamic("5e",["11","13","1b","1d","19","46","52","2c","49","17","32","5d","29"],!0,function(e,t,n){"use strict";this||self;var w=e("11"),i=e("13"),k=e("1b"),E=i.Node,T=i.TYPE,x=i.NodeCollectionUtils,_=(e("1d"),e("19")),A=e("46"),M=e("52"),L=e("2c"),N=(e("49"),e("17")),i=(e("32"),e("5d")),r=e("29"),d=window.reqnode?reqnode("electron"):null,D=i.backspaceHandler,P=function(e){return E.isEmptyBlock(e)||E.isType(e,T.list_item)&&1==e.get("children").length&&E.isEmptyBlock(e.getFirstChild())},B=function(e,t,n,i,r,o){var a,s,l,c,d;(t=t||(d=e.getMarkElem(),e.getNode(d.attr("cid"))))&&(s=e.getJQueryElem(window.getSelection().anchorNode),d=e.findElemById(t.id),"\n"==(n=E.noChangeLine(t)?n.trim().split(/[\n\r]+/gi)[0]:n)&&d.text().length<=i&&(n="\n​"),r&&r.undo.push(k.buildReplaceUndo(t,void 0)),a="",(l=s.closest(".md-def-link, .md-def-footnote").length)&&s.hasClass("md-def-name")?(d=s.closest("[cid]"),e.selection.getRangy().insertNode(document.createTextNode(w.escape(n))),t.set("ref",s.text())):l&&s.hasClass("md-def-url")?(d=s.closest("[cid]"),n=n.replace(/\s/gi,""),e.selection.getRangy().insertNode(document.createTextNode(w.escape(n))),t.set("href",s.text())):l&&s.hasClass("md-def-title")?(d=s.closest("[cid]"),e.selection.getRangy().insertNode(document.createTextNode(w.escape(n))),t.set("title",s.text())):(c=i,s=s.hasClass("md-meta-block")&&0==s.text().length&&"\n​"==n?"\n\n":(s.hasClass("md-meta-block")&&a.length==i&&"\n"==a[i-1]?i--:l&&s.closest(".md-def-content").length?(c-=(t.get("ref")||"").length+1,a=s.closest(".md-def-content").rawText()):(a=d.rawText(),E.isType(t,T.meta_block)&&(a=a.replace(/\n$/,""))),!s.hasClass("md-meta-block")||"\t"!=n||(l=a.substring(0,c))&&!/\n\s*$/.exec(l)||(n=" ".repeat(File.option.indentSize)),void 0!==c?a.substring(0,c)+n+a.substring(c):a.text()+n),t.set("text",s.replace(/\u200B/g,"")),d.html($(_.renderHtmlWithBlockMeta(t,e.brush)).html())),r&&(e.store(t,!0),r.redo.push(k.buildReplaceUndo(t,void 0))),l={id:t.id,type:"cursor",start:i+n.length},d=e.findElemById(t.id),o&&((c=a.match(/\u200b:|:\u200b/))||d.find(".md-emoji-control-ch").text(""),e.undo.exeCommand(l),c||d.find(".md-emoji-control-ch").text("​"),e.brush.addToQueue(t.id),l=e.selection.buildUndo()),r&&r.redo.push(l),e.brush.addToQueue(t.id),o&&d.addClass("md-focus"),d.length)&&e.refreshUnder(d[0])},s=function(e,t,n,i){var r={};w.isDefined(e)&&(r["text/html"]=c(e)[0]),w.isDefined(t)&&(r["text/markhtml"]=t),w.isDefined(n)&&(r["text/plain"]=n),JSBridge.clipboard.writeForMac(r,i)},l=function(e,t,n,i,r){null!=n?r.clipboardData.setData("text/plain",n):i&&r.clipboardData.setData("text/plain",""),null!=e?r.clipboardData.setData("text/html",e):i&&r.clipboardData.setData("text/html",""),null!=t?r.clipboardData.setData("text/markhtml",t):i&&r.clipboardData.setData("text/markhtml","")},u=function(e,t,n,i,r){if(File.isMac)s(e,t,n,i);else if(File.isNode)if(r){if("cut_before"===File._CopyContentFlag||"cut"==r.type&&e){if(!e)return JSBridge.invoke("webContents.copy"),void(File._CopyContentFlag="cut_after");D(File.editor,null,"delSelection"),File._CopyContentFlag=!1}else if("cut_after"===File._CopyContentFlag){File._CopyContentFlag=!1,e=(c(d.clipboard.readHTML())||[])[0];var o=File._CopyContentRange&&editor.selection.buildUndo(File._CopyContentRange),a=D(File.editor,null,"delSelection",!0);File._CopyContentRange&&(a?(a.undo.unshift(o),(o=D(editor,null,!0,!0))&&k.append(a,o)):D(editor,null,!0),File._CopyContentRange=null),editor.undo.register(a)}else if(!e||File._CopyContentFlag){if(!File._CopyContentFlag)return File._CopyContentFlag=!0,void(e||JSBridge.invoke("webContents.copy"));!0!==File._CopyContentFlag||null!==e&&null!=e||(e=(c(d.clipboard.readHTML()||e)||[])[0]||""),!t&&/^markhtml\|/.exec(File._CopyContentFlag+"")&&(t=File._CopyContentFlag.substring("markhtml|".length)),File._CopyContentFlag=!1}l(e,t,n,i,r),r.preventDefault()}else JSBridge.invoke("clipboard.write",JSON.stringify({html:c(e)[0]||n,text:n}),i||!1),t?(File._CopyContentFlag="markhtml|"+t,JSBridge.invoke("webContents.copy")):File._CopyContentFlag=!1},h=function(e,t,n){e=e||File.editor;var i,r,o=document.activeElement,a=e.selection.getRangy();e.sourceView.inSourceMode?u(null,null,File.editor.sourceView.cm.getSelection(),!0,t):"HR"==o.getAttribute("mdtype")?u(null,null,"---",!0,t):o.getAttribute("mdtype")!==T.math_block||a&&!a.collapsed?isInputComponent(o)||void 0!==o.tabindex?u(null,null,o.value||o.textContent,!0,t):window.getSelection().rangeCount&&(r="",r=(i=(i=a.collapsed?(i=$(a.startContainer).closest(".md-table-fig")).length?M.getMarkElemFromCurrentHtml(i[0].outerHTML,e):null:i)||M.getMarkElemFromCurrentHtml(a.toHtml(),e)).html(),u(null,n?null:r,n?g(r).replace(/\u200B/gi,""):y(r),!0,t)):u(null,null,"$$\n"+e.mathBlock.getTex(o.getAttribute("cid"))+"\n$$",!0,t),File._CopyContentFlag=!1};function a(e,t,n){var i,e=M.getMarkElemFromCurrentHtml(e,t),r=R(i=e.html(),void 0,0,0,!0);return[t.export.exportCollection(r,null,{forPrint:!1,noStyle:!0,exportFooter:!0,prettyForRendering:n,split:"\n"}),i,e.find(".md-fences,.md-heading,p,figure").after("\n\n").end().text().replace(/\n\n$/,"")]}var p=function(e,t){h(e,t,!0)},f=function(e,t){e=e||File.editor;var n=document.activeElement,i=e.selection.getRangy();if(e.sourceView.inSourceMode)u(null,null,File.editor.sourceView.cm.getSelection(),!0,t);else if("HR"==n.getAttribute("mdtype"))u(null,null,"<hr/>",!0,t);else if(n.getAttribute("mdtype")!==T.math_block||i&&!i.collapsed)if(isInputComponent(n)||0==n.childElementCount){if(n.classList.contains("md-content")&&i.toString()==n.textContent){var r,o=$(n).closest(".md-image");if(o.length)return r=a(o[0].outerHTML,e)[0],void u(null,"<pre mdtype='fences' lang='HTML'>"+w.escape(r)+"</pre>",r,!0,t)}u(null,null,n.value||n.textContent,!0,t)}else window.getSelection().rangeCount&&(r=a(i.toHtml(),e)[0],u(null,"<pre mdtype='fences' lang='HTML'>"+w.escape(r)+"</pre>",r,!0,t));else u(null,null,"$$\n"+e.mathBlock.getTex(n.getAttribute("cid"))+"\n$$",!0,t)},m=function(e,t){e=e||File.editor;var n,i=document.activeElement,r=e.selection.getRangy();if(e.sourceView.inSourceMode)u(null,null,File.editor.sourceView.cm.getSelection(),!0,t);else if("HR"==i.getAttribute("mdtype")){var o=e.getNode(i.getAttribute("cid"));u("<hr/>",null,o.get("text"),!0,t)}else if(i.getAttribute("mdtype")!==T.math_block||r&&!r.collapsed)if(isInputComponent(i)||0==i.childElementCount){if(i.classList.contains("md-content"))if(r.toString()==i.textContent)if($(i).closest(".md-image").length)return n=a(r.toHtml(),e,!0),void u(n[0],n[1],n[2],!0,t);u(i.value||i.textContent,null,i.value||i.textContent,!0,t)}else window.getSelection().rangeCount&&(n=a(r.toHtml(),e,!0),u(n[0],n[1],n[2],!0,t));else{o=i.getAttribute("cid"),r=e.getNode(o);u(e.export.getSVGForExport(r,!1),"$$\n"+e.mathBlock.getTex(o)+"\n$$","$$\n"+e.mathBlock.getTex(o)+"\n$$",!0,t)}},c=function(e){if(!e)return["",""];File.isMac&&(e.match(/<\/p>/g)||[]).length-(e.match(/<p/g)||[]).length==1&&(e="<p>"+e);var t,n,e=$.parseHTML("<div>"+e+"</div>"),i="<!DOCTYPE html>",r="<!DOCTYPE html>",o=File.option.showLineNumbersForFence?"&nbsp;":"";return e.length?(e=$(e[0]),(t=e.find(".md-emoji")).text(function(e){return $(t[e]).children("[data-emoji]").attr("data-emoji")}),e.find(".md-pants").text(function(){return this.dataset.content}),e.find(".ty-table-edit, .md-meta, .md-content, .md-rawblock-tooltip, .md-tooltip-hide, span p, .md-meta-none, .md-reverse-footnote-area").remove(),e.find("[cid].md-fences").html(function(){var e=$(this),t=(e.children("[cid]").each(function(){e.after(this)}),e[0].style.whiteSpace="pre",this.querySelectorAll("pre.CodeMirror-line"));if(t.length){for(var n=[],i=0;i<t.length;i++)t[i].innerHTML&&n.push(o+t[i].innerHTML);return n.join("<br/>")}return this.innerHTML}),e.find("p, h1, h2, h3, h4, h5, h6, .md-def-link, .md-def-footnoote").css("width",""),e.find(".md-br").text("\n"),e.find(".md-def-name").before("[").after("]   "),e.find(".task-list-item > p").replaceWith(function(){return(this.previousElementSibling&&"INPUT"==this.previousElementSibling.tagName?" ":"")+this.innerHTML+(this.nextSibling?"\n":"")}),e.find(".md-entity").text(function(){return this.dataset.content}),e.find("[contenteditable]").removeAttr("contenteditable"),n=location.href.replace(/[^\/\\]+.html/,""),e.find("a").attr("href",function(e,t){return t&&0==t.indexOf(location.href)?t.substr(location.href.length):t&&0==t.indexOf(n)?t.substr(n.length):t}),e.find("img[data-real-src]").attr("src",function(){return this.dataset.realSrc}),e.find(".mathjax-block").addBack(".mathjax-block").html("$$<br /><span></span><br />$$").find("span").text(function(){try{return File.editor.getNode(this.parentElement.getAttribute("cid")).get("text")}catch(e){return""}}).end().after("<br />"),e.find(".md-inline-math").text(function(){var e=this.getAttribute("id"),e=document.querySelector("#"+e);return e&&(e.querySelector("script")||{}).innerText||""}),i+=e.html(),e.find(".md-toc").remove(),e.find("li p").replaceWith(function(){return this.innerHTML+(this.nextSibling?"\n":"")}),e.find("ul, ol, .md-def-link, .md-toc, .md-def-footnoote, blockquote, .md-fences, .mathjax-block").after("<br/><br/>"),e.find(".md-def-name").before("[").after("]   "),[i,r+=e.html()]):["",""]};function g(e){e=M.getBlocksFromMarkHtml(e,null,!0);return"string"==typeof e?e:M.convertToPlain(e)}function R(e,t,n,i,r){return M.getBlocksFromMarkHtml(e,t,!1,r)}function y(e){e=R(e,void 0,0,0,!0);return"string"==typeof e?e:E.markFromArr(e)}var o,v=function(C,e,i,a){var u,r,o,s,l,c,d,h,p,f="";if(File._PasteContentFlag=!1,C=C||File.editor)return"function"==typeof a&&(F=a),o="string"!=typeof e||i?null:e,s="string"==typeof e&&i?e:null,(l="object"==typeof e?e:null)&&l.commonHtml?(o=l.commonHtml,l=null):l&&l.markhtml&&(r=l.markhtml,l=null),!!("INPUT"==document.activeElement.tagName||document.activeElement.classList&&document.activeElement.classList.contains("ty-input"))||("TEXTAREA"==document.activeElement.tagName?(!l&&s&&(e=$(document.activeElement).closest(".CodeMirror"))&&(e=e[0].CodeMirror).replaceSelection(s),!0):!E.isType(d,T.hr)&&"BODY"!=document.activeElement.tagName&&(c=C.UserOp.backspaceHandler(C,null,"delSelection",!0,!1)||k.makeEmptyCommand(),e=C.getMarkElem(),d=C.findNodeByElem(e),e={markhtml:r,html:o,text:s},void(l?(l.preventDefault(),JSBridge.clipboard.read(l,e).then(t)):e.html||e.text||e.markhtml?t(e):JSBridge.clipboard.read(null,e).then(t))));function v(e){return e.get("attr")&&e.get("attr").trim().length?e.get("attr"):void 0}function m(e,t,n,i){var r=C.tableEdit.TableEdit;function o(e,t,n){var i=e.safeGetStrAttr("text"),n=function n(e){return E.isType(e,E.TYPE.paragraph,E.TYPE.heading,E.TYPE.raw_edit,E.TYPE.fences,E.TYPE.table_cell)?e.get("text"):(!E.isType(e,T.def_footnote)||v(e)&&v(e))&&(!E.isType(e,T.def_link)||v(e)&&v(e))?e.get("children").toArray().reduce(function(e,t){return e+n(t)}," "):v(blocks[0])||v(blocks[0])||v(blocks[0])||v(blocks[0])||""}(n).replace(/\r?\n/g," ");return e.set("text",i.substr(0,t)+n+i.substr(t)),t+n.length}function a(e){for(var t=[],n=e.getFirstChild();n;)t.push(function(e){for(var t=e.getFirstChild(),n=[];t;)n.push(t),t=t.get("after");return n}(n)),n=n.get("after");return t}for(var s,l=e.get("parent").get("parent"),c=e,d=c,u=(i.undo.push(k.buildReplaceUndo(l)),[]),h=[],p=(n.forEach(function(e,t){e.get("type")==T.table?h=h.concat(a(e)):0==h.length?(h=[u],u.push(e)):1==h.length&&u.push(e)}),e.get("parent")),f=r.getColumnIndex(e),m=Math.min(h[0].length,p.get("children").length-f),g=0;g<h.length;g++){for(var u=h[g],y=0;y<u.length&&c;y++)s=o(c,0===g&&0===y?t:0,u[y]),d=c,c=E.isType(u[y],T.table_cell)?r.getSibling(c,!1,!0):r.getNextCellInColumn(c);if(!(p=p.get("after")))break;0==g&&1<h.length&&(f-=Math.max(0,h[1].length-m),f=Math.max(f,0)),c=r.getCellAt(p,f)}C.findElemById(l.id).replaceWith(l.toHTML()),i.redo.push(k.buildReplaceUndo(l)),void 0!==s?C.selection.jumpInto(C.findElemById(d.id),s):C.selection.jumpIntoElemEnd(C.findElemById(d.id)),i.redo.push(C.selection.buildUndo())}function F(e,t,n,i,r){if(!a)try{var o=C.selection.restoreEdge(C.findElemById(e),t);void 0!==i?o=C.selection.restoreEdge(C.findElemById(n),i,!0,o):o.setEndAfter(C.findElemById(n)[0]||C.findElemById(e)[0]),C.imgEdit.tryMoveImageInRange(o,!0),C.stylize.putBookmark(null,C.stylize.buildBookmark(C.findElemById(n))),$(C.sessionStr).trigger("cursorChange",C.styleBookmark)}catch(e){console.error(e)}}function g(e,t,n,i,r,o){n.undo.push(C.selection.buildUndo());var a=r(i,C.nodeMap,C,f,u);if("string"==typeof a)return y(e,t,a||o||"",n,!0);if(1==a.length&&t){r=function e(t){var n=t.get("children").length;return n?1==n?e(t.getFirstChild()):"\n\n\n":t.get("text")||""}(a[0]);if(-1==r.indexOf("\n"))return y(e,t,r,n)}else if(0==a.length)return;if(E.isType(e,T.table_cell))m(e,t,a,n);else if(!E.isType(e,T.table_row,T.table)){E.isType(e.get("parent"),T.list_item)?n.undo.push(C.undo.buildReplaceUndo(e.get("parent"))):n.undo.push(C.undo.buildReplaceUndo(e));var s=e===C.nodeMap.getFirst()&&0===t,l=[],i=(a.map(function(e,t){!E.isType(e,T.meta_block)||0==t&&s||l.push(e)}),l.map(function(e){a.remove(e)}),E.splitAt(e,t,C,!1,!0,!0));if(!i)return void C.undo.register(n);if(S(i.prev,i.next,a,n,i.insertArray,e),i.prev&&a.last())try{var c=i.prev.isDeleted()?a[0]:i.prev,d=a.last();F((c=!i.prev.isDeleted()&&E.isType(i.prev,T.list_item)&&(d.isDeleted()||i.prev.contains(a.last()))?i.prev.getVeryFirst():c).getVeryFirst(!0,!1).cid,t,a.last().cid,void 0)}catch(e){window.Reporter.error(e)}}C.undo.register(n)}function b(e,t,n,i,r){if(e&&!e.isDeleted()&&t&&!t.isDeleted()){var o,a=e.canContainBlock()?e.getLastChild():e,s=t.canContainBlock()?t.getFirstChild():t,l=-1;if(C.stylize.canContainInline(a)&&C.stylize.canContainInline(s)&&!E.isType(a,T.table_cell)&&!E.isType(s,T.table_cell))return l=a.get("text").length,o=a.get("text")+s.get("text"),r&&!l&&a.copyContentFrom(s),a.set("text",o),r=function e(t){var n;if(t&&!t.isDeleted())return!(n=t.get("parent"))||t.get("before")||t.get("after")?t:e(n)}(s),n&&k.addUndoForRemove(n,r),r.remove(),i.remove(r),t.isDeleted()||E.isType(t,T.list_item)&&E.isType(e,T.list_item)&&(n&&n.undo.push(k.buildReplaceUndo(e)),e.getLastChild().addAfterTillEnd(t.getFirstChild()),n&&k.addUndoForRemove(n,t),t.remove(),i.remove(t)),n&&n.redo.push(k.buildReplaceUndo(e)),l}}function y(e,t,n,i,r){n=n.replace(/\u00a0/g," ").replace(/\u200b/g,"");var o,a,s,l,c,d,u,h,p,f,m,g,y,v,b,w,r=(n=r?n:n.replace(/^[\r\n]+/g,"").replace(/[\r\n]+$/g,"")).split(/\r?\n/g);if(1<r.length&&!r[0].trim().length&&r[1].trim().length&&(r=r.slice(1)),E.isType(e,T.table_cell))return o=e,a=t,f=n,(s=i).undo.push(C.selection.buildUndo()),f=f.replace(/^\s*(\r?\n)+/,"").replace(/^\s*(\r?\n)+$/,"").replace(/(^\s*\|)|(\|\s*)/g,"|"),m=null,/\|/.exec(f)&&(m=/\s*\|\s*/),d=o.get("parent"),u="npTable"==d.get("parent").get("style"),h=d.get("children").length,p=o,m?(m=f.split(/\n/).filter(function(e){return e.length}),c=A.getColumnIndex(o),m.map(function(e,n){var i,r;d&&!/^[-\s:|]+$/.exec(e)&&(""==(i=""==(i=_.splitTableCell(e,u,h)||[e])[0]?i.subarray(1):i).last()&&(i=i.subarray(0,i.length-1)),r=d.getNthChild(c),i.map(function(e,t){r&&(s.undo.push(k.buildReplaceUndo(r)),l=0==n&&0==t?(o.set("text",o.get("text").substring(0,a)+e+o.get("text").substring(a)),a+e.length):(t==i.length-1?r.set("text",e+r.get("text")):r.set("text",e),p=r,e.length),s.redo.push(k.buildReplaceUndo(r)),r=r.get("after"))}),C.findElemById(d.id).replaceWith(d.toHTML()),d=d.get("after"))})):(s.undo.push(k.buildReplaceUndo(o)),f=f.replace(/<br\/?>/g,"\n").replace(/\r?\n/g,"<br/>"),o.set("text",o.get("text").substring(0,a)+f+o.get("text").substring(a)),s.redo.push(k.buildReplaceUndo(o)),C.findElemById(o.id).replaceWith(o.toHTML()),l=a+f.length),m=C.findElemById(p.cid),C.selection.jumpInto(m,l),s.redo.push(C.selection.buildUndo()),C.undo.register(s),m.length&&C.refreshUnder(m[0]),void F(o.cid,0,p.cid,p.get("text").length);if((r=E.noChangeLine(e)?[r[0]]:r).length<=1||-1<L.CONST.NoInline.indexOf(e.get("type")))n=r.join("\n"),B(C,e,n,t,i,!0),f=C,m=e,g=n,y=t,x=i,E.isType(m,T.paragraph)&&N.BLOCK_OPEN_REG.exec(g)&&N.BLOCK_OPEN_REG.exec(m.get("text"))&&(w=x.redo.last(),v=m.parseFrom({skips:{old_code:!1,pass_format:!0}}),x.redo.push(k.buildReplaceUndo(m)),k.addUndoForInsertArray(x,v[1].subarray(1)),b=v[1].last().getVeryFirst(!0),w=w.end||g.length+y,f.findElemById(m.id).replaceWith(v[0]),f.selection.jumpInto(f.findElemById(b.cid),w),x.redo.push(f.selection.buildUndo()));else{if(i.undo.push(C.selection.buildUndo()),E.isType(e,T.paragraph)&&E.isType(e.get("parent"),T.list_item)?i.undo.push(k.buildReplaceUndo(e.get("parent"))):i.undo.push(k.buildReplaceUndo(e)),E.isType(e,T.paragraph)&&!E.isType(e.get("parent"),T.list_item))return g=t,y=n,v=i,w=(b=e).get("text"),b.set("text",w.substring(0,g)+y+w.substring(g)),y=b.parseFrom({skips:{old_code:!1,pass_format:!0}}),v.redo.push(k.buildReplaceUndo(b)),k.addUndoForInsertArray(v,y[1].subarray(1)),C.findElemById(b.id).replaceWith(y[0]),y=y[1].last().getVeryFirst(!0),w=Math.max(y.get("text").length-(w.length-g),0),C.selection.jumpInto(C.findElemById(y.cid),w),v.redo.push(C.selection.buildUndo()),C.undo.register(v),C.focusCid=y.cid,C.refresh(),void F(b.cid,0,y.cid,y.get("text").length);var x=E.splitAt(e,t,C);if(!x)return void C.undo.register(i);r=E.parseFrom(r.join("\n"),e.get("in"),{noTop:!x.prev.get("attachTo"),skips:{old_code:!1,pass_format:!0}},!0);E.isType(x.prev,T.list_item)&&i.undo.push(k.buildReplaceUndo(x.prev)),S(x.prev,x.next,r[1],i,x.insertArray,e)}C.undo.register(i),F(e.cid,t,e.cid,t+n.length,i)}function S(e,t,a,s,n,i){var r,o,l,c,d,u=i.id,h=-1;function p(e,t,n){var i,r=e.get("parent");E.isType(a[0],T.list)||(o=r.clone(),E.isType(a[0],T.list_item)?a.forEach(e=>{var t;(E.isType(e,T.list_item)?r:(t=new E({type:T.list_item}),r.appendChild(t),t)).appendChild(e)}):(i=new E({type:T.list_item}),o.appendChild(i),a.forEach(e=>{i.appendChild(e)})),a=[o]),u=e.id,s.undo.push(k.buildAttrUndo(r,"tail")),e.addAfter(a[0]);var o=a.shift().unwrap();n&&!P(e)||null!=b(e,o[0],null,[],n)&&o.splice(0,1),t.isDeleted()||a.length||b(o.last(),t,null,[]),t.isDeleted()||o.push(t),s.redo.push(k.buildReplaceUndo(e)),E.genArrFrom(e);k.addUndoForInsertArray(s,o),C.findElemById(e.cid).replaceWith(x.toHTML([e].concat(o))),m.isDeleted()&&(m=t),a.length&&(r.unset("tail"),(t=t.isDeleted()?(t=o.last())&&t.get("after"):t)?((n=r.clone()).unset("start"),n.unset("ahead"),e=E.genArrFrom(t),k.addUndoForRemoveArray(s,e),n.appendChildrenTillEnd(t),r.addAfter(n),r.addArrayAfter(a),e=a.concat([n]),k.addUndoForInsertArray(s,e),C.findElemById(r.cid).replaceWith(x.toHTML([r].concat(e))),m.isDeleted()&&(m=t)):(r.addArrayAfter(a),k.addUndoForInsertArray(s,a),C.findElemById(r.cid).after(x.toHTML(a))))}d=[],(g=a).map(function(e){E.isType(e,T.list_item)?(o=!0,r||(r=new E({type:r,in:e.get("in")}),d.push(r)),r.appendChild(e)):(r=null,d.push(e))}),o&&(console.log("group list items"),y=g[0].get("before"),f=g.last().get("after"),l=g[0].get("parent"),y?y.addArrayAfter(d,!0):f?f.addArrayBefore(d,!0):d.forEach(l?e=>l.appendChild(e):e=>{c&&c.addAfter(e),c=e}));var f,m=(a=function(e){for(var t=[],n=-2,i=0;i<e.length;i++){var r=e[i];E.isType(r,T.table_cell)?(n!==i-1?(r.set("type",T.paragraph),t.push(r)):(t.last().set("text",t.last().get("text")+"  "+r.get("text")),r.remove()),n=i):t.push(r)}return t}(a=d)).last().getVeryFirst(!0),g=(n=n||[t]).indexOf(t),y=!1;if(P(t)?(n.remove(t),t.remove(),y=!0):E.isType(m,L.CONST.Selectable)&&(m=t),!E.isType(e,T.blockquote,T.list)&&!E.isType(a[0],T.list_item)){E.isType(e,T.list_item)?p(e,t,y):((f=e.getVeryFirst(!0)).addArrayAfter(a),-1<g&&n.splice.apply(n,[g,0].concat(a)),k.addUndoForInsertArray(s,n),g=1<a.length,E.isEmptyBlock(f)?(k.addUndoForRemove(s,f),f.remove(),g=E.isEmptyBlock(a.last())):(g=!1,b(f,a.shift(),s,n)),t.isDeleted()||(E.isEmptyBlock(t)?(k.addUndoForRemove(s,t),t.remove()):h=a.length?b(a.last(),t,s,n,g):b(e,t,s,n)),(m=a.last()||e)&&!m.isDeleted()&&(m=m.getVeryFirst(!0)),i.isDeleted()||s.redo.push(k.buildReplaceUndo(i)),g=(i.isDeleted()?"":i.toHTML())+n.map(function(e){return e.isDeleted()?"":e.toHTML()}).join(""),C.mathBlock.beforeRenderMath(),C.findElemById(u).replaceWith(g)),E.isType(m,L.CONST.Selectable)&&(t&&!t.isDeleted()&&(m=t),h=-1);try{0<=h?C.selection.jumpInto(C.findElemById(m.cid),h):m==t||m.isDeleted()?C.selection.jumpIntoElemBegin(C.findElemById(t.cid)):C.selection.jumpIntoElemEnd(C.findElemById(m.getVeryFirst(!0).cid)),m.isDeleted()||s.redo.push(C.selection.buildUndo())}catch(e){console.warn(e)}C.tryEnterBusyMode(),setTimeout(function(){C.refocus(),C.refresh()},0),setTimeout(function(){C.selection.scrollAdjust()},100)}}function t(e){if(c.undo.push(C.selection.buildUndo()),c=k.append(c,D(C,l,"delSelection",!0)),d=C.findNodeByElem(C.getMarkElem()),h=C.selection.getRangy(),d&&h){p=h.getBookmark(C.findElemById(d.id)[0]).start;var t=C.getJQueryElem(h.startContainer);if(i=i||h.startContainer&&t.closest(".md-def-url, .md-def-name, .md-def-title, pre, code").length,r=e.markhtml,o=e.html,s=e.text,f=e.baseUrlInClipboard||"",u=e.remap,r=r&&r.replace(/[\u0000-\u0008\u000b-\u001f]/g,""),o=o&&o.replace(/[\u0000-\u0008\u000b-\u001f]/g,""),s=s&&s.replace(/[\u0000-\u0008\u000b-\u001f]/g,""),i)w.isDefined(s)||(s=M.parseInlineHTML(o,C,f,u)),y(d,p,s=s||"",c);else if(r){var n=$($.parseHTML("<div>"+r+"</div>")[0]);a=a||(n.find("[data-copy-from-path]").attr("data-copy-from-path")||"-1")===File.bundle.filePath,g(d,p,c,n,R)}else if(o)t.closest(".md-def-content").length?(s=(s=M.parseInlineHTML(o,C,f,u))||e.text||"",y(d,p,s,c)):g(d,p,c,o,M.parseHTML,s);else{if(!(e.files||[]).length)return void JSBridge.clipboard.readImage().then(function(e){e&&e.length?O(C,e,c):y(d,p,s||"",c),C.selection.scrollAdjust(),window.Reporter.fullValidate()});O(C,e.files,c),C.undo.addSnap(d.id,0),C.selection.scrollAdjust()}C.undo.addSnap(d.id,0),C.selection.scrollAdjust(),window.Reporter.fullValidate()}}},O=function(e,t,n){if(n&&e.undo.register(n),File.isMac){if(File.bundle.isLocked)return}else if(File.isLocked)return!1;e.sourceView.inSourceMode||r.insertURLs(t)},b=(window.bridge&&bridge.registerHandler("clipboard.processClipboardHTML",function(e,t){b(File.editor),t(c(e))}),function(e){o&&(document.body.classList.remove("ty-on-copy"),!0!==o)&&e.selection.setRange(o)});t.getMarkdownSourceFrom=y,t.nativeCopyText=function(e){var t=document.createElement("textarea");document.body.appendChild(t),t.value=e,t.focus(),t.select(),document.execCommand("Copy"),t.remove()},t.copyAsMarkdown=h,t.copyAsSemanticHTML=m,t.copyAsHTMLSource=f,t.copyAsPlainText=p,t.copyHandler=function(e,t,n){if("copyAsMarkdown"===File._CopyContentFlag)return h(e,t),!0;if("copyAsHTMLSource"===File._CopyContentFlag)return f(e,t),!0;if("copyAsSemanticHTML"===File._CopyContentFlag)return m(e,t),!0;if("copyAsPlainText"===File._CopyContentFlag)return p(e,t),!0;var i=document.activeElement,r=e.selection.getRangy(),o=$(i).closest("[cid]");if(e.sourceView.inSourceMode)return(a=File.editor.sourceView.cm.getSelection())&&u(null,null,a,!0,t),!0;if(isInputComponent(i))return t||console.sendError("in copyHandler : shouldn't be here"),!0;if("hr"==i.getAttribute("mdtype"))return u(i.outerHTML,null,"---",!0,t),!0;if("toc"==i.getAttribute("mdtype"))return u(i.outerHTML,"<div mdtype='toc'><div>","[toc]",!0,t),!0;if("IMG"==i.tagName)return u(i.outerHTML,null,i.getAttribute("src")||"",!0,t),!0;if(o.attr("mdtype")===T.math_block&&(!r||r.collapsed))return a=e.mathBlock.getTex(o.attr("cid")),u((i.querySelector(".MathJax_Display")||{}).outerHTML||"","<div mdtype='"+T.math_block+"'>"+a+"</div>",a,!0,t),!0;if(o.attr("mdtype")===T.html_block&&(!r||r.collapsed))return a=(i=e.getNode(o.attr("cid"))).get("text"),u(a,"<div mdtype='"+T.html_block+"' data-tag='"+w.escape(i.get("style"))+"'>"+w.escape(a)+"</div>",a,!0,t),!0;if(r){r.startContainer&&r.startContainer.parentElement&&r.startContainer.parentElement.closest(".ty-table-edit")&&(i=o.closest("table").find(".td-span")[0])&&(r.setStart(i,0),e.selection.setRange(r,!0));var a,s,l,c=t&&r.collapsed&&File.option.lineWiseCopyCut;if(!File._CopyContentRange&&c&&(File._CopyContentFlag||(document.querySelector("#no-sel-style").innerHTML=`::selection {
					background: transparent;
					text-shadow: none;
					color: inherit;
				}`,setTimeout(()=>{!File._CopyContentRange||(e.selection.getRangy()||{}).collapsed||(document.querySelector("#no-sel-style").innerHTML="")},1e3)),e.selection.selectLineWrap()),File._CopyContentRange&&setTimeout(()=>{e.selection.setRange(File._CopyContentRange),File._CopyContentRange=null,document.querySelector("#no-sel-style").innerHTML=""},0),!r.collapsed||c)return!File._CopyContentFlag&&File.isNode?(File._CopyContentFlag=!0,c&&(File._CopyContentRange=r),d.clipboard.clear(),JSBridge.invoke("webContents.copy"),!1):"cut_before"===File._CopyContentFlag&&c?void(e.selection.isSameRange(File._CopyContentRange,r)?(File._CopyContentRange=null,File._CopyContentFlag=!1):(File._CopyContentRange=r,JSBridge.invoke("webContents.copy"))):(c&&File.isMac&&(File._CopyContentRange=r,r=e.selection.getRangy()),a="",c||File._CopyContentRange?(o=e.findElemById(e.focusCid)[0],i=r.getBookmark(o||void 0),(r.commonAncestorContainer==o||!r.commonAncestorContainer.contains(o))&&0===i.start&&i.end>=o.textContent.length?(a=o.outerHTML+"<p mdtype='paragraph'></p>",o.previousElementSibling||o.previousElementSibling&&"INPUT"!=o.previousElementSibling.tagName||("LI"==o.parentElement.tagName?a=o.parentElement.outerHTML+"<li mdtype='list_item'></li>":E.isType(o.parentElement.tagName,"BLOCKQUOTE")&&(a=o.parentElement.outerHTML+"<p mdtype='paragraph'></p>"))):a=r.toHtml()+"<br/>"):(e.selection.includeTrailMeta(r),a=r.toHtml()),s=M.getMarkElemFromCurrentHtml(a,e).html(),l=File.option.copyMarkdownByDefault?y(s):g(s).replace(/\u200B/gi,""),t&&File.isMac?setTimeout(function(){u(null,s,l,!1,t),bridge.callHandler("clipboard.postCopy",c?void 0:n),c&&(n&&n(),"copy"==t.type?(e.selection.setRange(File._CopyContentRange),document.querySelector("#no-sel-style").innerHTML=""):setTimeout(function(){document.querySelector("#no-sel-style").innerHTML=""},30),File._CopyContentRange=null)},0):u(null,s,l,!1,t),!1)}},t.insertInlineText=B,t.pasteHandler=v,t.setClipboard=u,t.prepMarkHtml=function(e,t){return M.getMarkElemFromCurrentHtml(e,t)},t.insertParagraph=function(e,t,n){var i,r;File.isNode&&File.isLocked||(t=t||File.editor,n=n||t.getMarkElem(),t.undo.endSnap(!0),i=t.findNodeByElem(n),r=new E({type:T.paragraph,text:""}),n=k.makeEmptyCommand(t.selection.buildUndo(void 0,n)),i&&(i=i.getClosetBlock(),e?(i.addBefore(r),t.findElemById(i.cid).before(r.toHTML())):(i.addAfter(r),t.findElemById(i.cid).after(r.toHTML())),k.addUndoForInsert(n,r),t.selection.jumpIntoElemBegin(t.findElemById(r.cid)),n.redo.push(t.selection.buildUndo()),t.undo.register(n),t.refocus(),window.Reporter.fullValidate()))},t.insertDom=function(e){File.editor.focusAndRestorePos(),v(File.editor,$("<div>").append(e).html(),!1)},t.processClipboardHTML=c,t.beforeCopyStart=function(e){o=null,File.isMac&&(document.body.classList.add("ty-on-copy"),o=!0,setTimeout(()=>{b(e)},1))},t.getSpeechText=function(e){var t,n,i;return(e=File.editor).sourceView.inSourceMode?e.sourceView.cm.getSelection()||e.sourceView.cm.getValue():((i=e.selection.getRangy())&&!i.collapsed||(n=(t=$("#write").children()).last()[0],i=e.selection.createRange(t.first()[0],0,n,n.childNodes.length)),g(M.getMarkElemFromCurrentHtml(i.toHtml(),e).html()))}}),$__System.registerDynamic("2f",["11","13","1b","1d","19","46","32","52","5d","5b","5c","1e","5e"],!0,function(e,t,n){"use strict";this||self;var i=e("11"),r=e("13"),l=e("1b"),c=r.Node,d=r.TYPE,u=(r.NodeCollectionUtils,e("1d"),e("19")),o=(e("46"),e("32")),r=(e("52"),e("5d")),a=e("5b"),s=e("5c"),h=e("1e"),p=e("5e"),f=function(e,t,n,i){var r,o=e;if(e==t)return null;for(r=e.get(n);r;)i(r,o),r=(o=r).get(n);return f(e.get("parent"),t,n,i),o};t.getDisplayText=function(e){e=e.clone();return e.find(".md-meta, .md-blockmeta, .md-content, sub, sup").remove(),e.text().replace(/\u00A0/g," ")},t.decorateOneSide=f,t.simpleExpand=function(e,t){if(File.isLocked)return!1;var n,t=e.getNode(t),i=e.selection.buildUndo();if(!i)return!1;if(!c.isType(t,d.heading,d.def_footnote,d.def_link)||i.startId&&i.startId!=i.endId)return!1;if((n=t.toMark().trim()).match(/\n/))return!1;e.undo.endSnap(!0);var r,o,a,s=l.makeEmptyCommand(e.lastCursor);return!(!s.undo.length||!s.undo[0].id&&s.undo[0].startId!=s.undo[0].endId)&&(s.undo.push(l.buildReplaceUndo(t)),c.isType(t,d.heading)&&(a=t.get("pattern")&&t.get("pattern").replace("{0}","").length||t.get("depth")+1),c.isType(t,d.def_link,d.def_footnote)&&(r=e.selection.getRangy(),o=(r=e.getJQueryElem(r.startContainer)).closest(".md-def-content"),a=c.isType(t,d.def_link)?1:2,o.length&&(a+=3),(o=r.closest(".md-def-title")).length)&&r.text().length&&(a+=5),t.set("text",n),t.set("type",d.paragraph),s.redo.push(l.buildReplaceUndo(t)),(i=e.selection.buildUndo()).start+=a,i.end+=a,i.id=t.cid,i.startId=i.endId=void 0,s.redo.push(i),o=u.renderHtmlWithBlockMeta(t,e.brush),e.findElemById(t.cid).replaceWith(o),e.undo.exeCommand(i,[]),s.incomplete=!0,e.undo.register(s),t.cid)},t.insertFileLink=function(e,t){var n;i.isFullUrl(t)?(n=e.selection.getRangy())&&n.commonAncestorContainer&&$(n.commonAncestorContainer).closest(".md-link").length?p.pasteHandler(e,t,!0,!0):p.pasteHandler(e," "+t+" ",!0,!0):(n=o.getFileNameFromPath(t),File.isTextBundle()?0===t.indexOf(File.bundle.filePath)&&(t=t.substring(File.bundle.filePath.length+1)):t=i.getRelativePath(o.getCurrentFileFolderPath(),t),p.pasteHandler(e," ["+n+"]("+t+") ",!0,!0))},t.backspaceHandler=r.backspaceHandler,t.deleteSelectable=r.deleteSelectable,t.deleteLineProcessor=r.deleteLineProcessor,t.deleteLine=r.deleteLine,t.deleteBlock=r.deleteBlock,t.backToParagraph=r.backToParagraph,t.getMarkdownSourceFrom=p.getMarkdownSourceFrom,t.nativeCopyText=p.nativeCopyText,t.copyAsMarkdown=p.copyAsMarkdown,t.copyAsSemanticHTML=p.copyAsSemanticHTML,t.copyAsHTMLSource=p.copyAsHTMLSource,t.copyAsPlainText=p.copyAsPlainText,t.copyHandler=p.copyHandler,t.getSpeechText=p.getSpeechText,t.insertInlineText=p.insertInlineText,t.insertUrlWithTitle=function(o,e,a){a=a||e,p.pasteHandler(o," ["+a+"]("+e+") ",!0,function(e,t,n,i,r){r&&e===n&&(o.undo.exeCommand({type:"cursor",id:e,start:t+2,end:t+2+a.length}),o.brush.clearAndPause(),r.redo.push(o.selection.buildUndo()),o.brush.restart())})},t.pasteHandler=p.pasteHandler,t.setClipboard=p.setClipboard,t.insertDom=p.insertDom,t.prepMarkHtml=p.prepMarkHtml,t.insertParagraph=p.insertParagraph,t.processClipboardHTML=p.processClipboardHTML,t.beforeCopyStart=p.beforeCopyStart,t.pasteBlocksAt=p.pasteBlocksAt,t.moreIndent=a.moreIndent,t.lessIndent=a.lessIndent,t.handlePair=s.handlePair,t.surroundPair=s.surroundPair,t.PunctuationOp=h}),$__System.registerDynamic("5f",[],!1,function(e,t,n){n=$__System.registry.get("@@global-helpers").prepareGlobal(n.id,null,null);return function(u,h){"use strict";var t;function l(e){this.time=e.time,this.target=e.target,this.rootBounds=e.rootBounds,this.boundingClientRect=e.boundingClientRect,this.intersectionRect=e.intersectionRect||r(),this.isIntersecting=!!e.intersectionRect;var e=this.boundingClientRect,e=e.width*e.height,t=this.intersectionRect,t=t.width*t.height;this.intersectionRatio=e?Number((t/e).toFixed(4)):this.isIntersecting?1:0}function e(e,t){var n,i,r,t=t||{};if("function"!=typeof e)throw new Error("callback must be a function");if(t.root&&1!=t.root.nodeType)throw new Error("root must be an Element");this._checkForIntersections=(n=this._checkForIntersections.bind(this),i=this.THROTTLE_TIMEOUT,r=null,function(){r=r||setTimeout(function(){n(),r=null},i)}),this._callback=e,this._observationTargets=[],this._queuedEntries=[],this._rootMarginValues=this._parseRootMargin(t.rootMargin),this.thresholds=this._initThresholds(t.threshold),this.root=t.root||null,this.rootMargin=this._rootMarginValues.map(function(e){return e.value+e.unit}).join(" ")}function n(e,t,n,i){"function"==typeof e.addEventListener?e.addEventListener(t,n,i||!1):"function"==typeof e.attachEvent&&e.attachEvent("on"+t,n)}function i(e,t,n,i){"function"==typeof e.removeEventListener?e.removeEventListener(t,n,i||!1):"function"==typeof e.detatchEvent&&e.detatchEvent("on"+t,n)}function p(e){var t;try{t=e.getBoundingClientRect()}catch(e){}return t?t.width&&t.height?t:{top:t.top,right:t.right,bottom:t.bottom,left:t.left,width:t.right-t.left,height:t.bottom-t.top}:r()}function r(){return{top:0,bottom:0,left:0,right:0,width:0,height:0}}function o(e,t){for(var n=t;n;){if(n==e)return!0;n=f(n)}return!1}function f(e){e=e.parentNode;return e&&11==e.nodeType&&e.host?e.host:e&&e.assignedSlot?e.assignedSlot.parentNode:e}"IntersectionObserver"in u&&"IntersectionObserverEntry"in u&&"intersectionRatio"in u.IntersectionObserverEntry.prototype?"isIntersecting"in u.IntersectionObserverEntry.prototype||Object.defineProperty(u.IntersectionObserverEntry.prototype,"isIntersecting",{get:function(){return 0<this.intersectionRatio}}):(t=[],e.prototype.THROTTLE_TIMEOUT=100,e.prototype.POLL_INTERVAL=null,e.prototype.USE_MUTATION_OBSERVER=!0,e.prototype.observe=function(t){var e=this._observationTargets.some(function(e){return e.element==t});if(!e){if(!t||1!=t.nodeType)throw new Error("target must be an Element");this._registerInstance(),this._observationTargets.push({element:t,entry:null}),this._monitorIntersections(),this._checkForIntersections()}},e.prototype.unobserve=function(t){this._observationTargets=this._observationTargets.filter(function(e){return e.element!=t}),this._observationTargets.length||(this._unmonitorIntersections(),this._unregisterInstance())},e.prototype.disconnect=function(){this._observationTargets=[],this._unmonitorIntersections(),this._unregisterInstance()},e.prototype.takeRecords=function(){var e=this._queuedEntries.slice();return this._queuedEntries=[],e},e.prototype._initThresholds=function(e){e=e||[0];return(e=Array.isArray(e)?e:[e]).sort().filter(function(e,t,n){if("number"!=typeof e||isNaN(e)||e<0||1<e)throw new Error("threshold must be a number between 0 and 1 inclusively");return e!==n[t-1]})},e.prototype._parseRootMargin=function(e){e=(e||"0px").split(/\s+/).map(function(e){e=/^(-?\d*\.?\d+)(px|%)$/.exec(e);if(e)return{value:parseFloat(e[1]),unit:e[2]};throw new Error("rootMargin must be specified in pixels or percent")});return e[1]=e[1]||e[0],e[2]=e[2]||e[0],e[3]=e[3]||e[1],e},e.prototype._monitorIntersections=function(){this._monitoringIntersections||(this._monitoringIntersections=!0,this.POLL_INTERVAL?this._monitoringInterval=setInterval(this._checkForIntersections,this.POLL_INTERVAL):(n(u,"resize",this._checkForIntersections,!0),n(h,"scroll",this._checkForIntersections,!0),this.USE_MUTATION_OBSERVER&&"MutationObserver"in u&&(this._domObserver=new MutationObserver(this._checkForIntersections),this._domObserver.observe(h,{attributes:!0,childList:!0,characterData:!0,subtree:!0}))))},e.prototype._unmonitorIntersections=function(){this._monitoringIntersections&&(this._monitoringIntersections=!1,clearInterval(this._monitoringInterval),this._monitoringInterval=null,i(u,"resize",this._checkForIntersections,!0),i(h,"scroll",this._checkForIntersections,!0),this._domObserver)&&(this._domObserver.disconnect(),this._domObserver=null)},e.prototype._checkForIntersections=function(){var a=this._rootIsInDom(),s=a?this._getRootRect():r();this._observationTargets.forEach(function(e){var t=e.element,n=p(t),i=this._rootContainsTarget(t),r=e.entry,o=a&&i&&this._computeTargetAndRootIntersection(t,s),e=e.entry=new l({time:u.performance&&performance.now&&performance.now(),target:t,boundingClientRect:n,rootBounds:s,intersectionRect:o});r?a&&i?this._hasCrossedThreshold(r,e)&&this._queuedEntries.push(e):r&&r.isIntersecting&&this._queuedEntries.push(e):this._queuedEntries.push(e)},this),this._queuedEntries.length&&this._callback(this.takeRecords(),this)},e.prototype._computeTargetAndRootIntersection=function(e,t){if("none"!=u.getComputedStyle(e).display){for(var n,i,r,o,a=p(e),s=f(e),l=!1;!l;){var c=null,d=1==s.nodeType?u.getComputedStyle(s):{};if("none"==d.display)return;if(s==this.root||s==h?(l=!0,c=t):s!=h.body&&s!=h.documentElement&&"visible"!=d.overflow&&(c=p(s)),c&&(d=c,c=a,o=r=i=n=void 0,n=Math.max(d.top,c.top),i=Math.min(d.bottom,c.bottom),r=Math.max(d.left,c.left),d=Math.min(d.right,c.right),o=i-n,!(a=0<=(c=d-r)&&0<=o&&{top:n,bottom:i,left:r,right:d,width:c,height:o})))break;s=f(s)}return a}},e.prototype._getRootRect=function(){var e,t;return t=this.root?p(this.root):(t=h.documentElement,e=h.body,{top:0,left:0,right:t.clientWidth||e.clientWidth,width:t.clientWidth||e.clientWidth,bottom:t.clientHeight||e.clientHeight,height:t.clientHeight||e.clientHeight}),this._expandRectByRootMargin(t)},e.prototype._expandRectByRootMargin=function(n){var e=this._rootMarginValues.map(function(e,t){return"px"==e.unit?e.value:e.value*(t%2?n.width:n.height)/100}),e={top:n.top-e[0],right:n.right+e[1],bottom:n.bottom+e[2],left:n.left-e[3]};return e.width=e.right-e.left,e.height=e.bottom-e.top,e},e.prototype._hasCrossedThreshold=function(e,t){var n=e&&e.isIntersecting?e.intersectionRatio||0:-1,i=t.isIntersecting?t.intersectionRatio||0:-1;if(n!==i)for(var r=0;r<this.thresholds.length;r++){var o=this.thresholds[r];if(o==n||o==i||o<n!=o<i)return!0}},e.prototype._rootIsInDom=function(){return!this.root||o(h,this.root)},e.prototype._rootContainsTarget=function(e){return o(this.root||h,e)},e.prototype._registerInstance=function(){t.indexOf(this)<0&&t.push(this)},e.prototype._unregisterInstance=function(){var e=t.indexOf(this);-1!=e&&t.splice(e,1)},u.IntersectionObserver=e,u.IntersectionObserverEntry=l)}(window,document),n()}),$__System.registerDynamic("2b",["e","5f"],!0,function(e,t,n){"use strict";this||self;var i,r,a,o,s=e("e");function l(){var t=setTimeout;function i(){}function o(e){if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");if("function"!=typeof e)throw new TypeError("not a function");this._state=0,this._handled=!1,this._value=void 0,this._deferreds=[],d(e,this)}function r(n,i){for(;3===n._state;)n=n._value;0===n._state?n._deferreds.push(i):(n._handled=!0,o._immediateFn(function(){var e,t=1===n._state?i.onFulfilled:i.onRejected;if(null===t)(1===n._state?a:s)(i.promise,n._value);else{try{e=t(n._value)}catch(e){return void s(i.promise,e)}a(i.promise,e)}}))}function a(t,e){try{if(e===t)throw new TypeError("A promise cannot be resolved with itself.");if(e&&("object"==typeof e||"function"==typeof e)){var n=e.then;if(e instanceof o)return t._state=3,t._value=e,void l(t);if("function"==typeof n)return void d((i=n,r=e,function(){i.apply(r,arguments)}),t)}t._state=1,t._value=e,l(t)}catch(e){s(t,e)}var i,r}function s(e,t){e._state=2,e._value=t,l(e)}function l(e){2===e._state&&0===e._deferreds.length&&o._immediateFn(function(){e._handled||o._unhandledRejectionFn(e._value)});for(var t=0,n=e._deferreds.length;t<n;t++)r(e,e._deferreds[t]);e._deferreds=null}function c(e,t,n){this.onFulfilled="function"==typeof e?e:null,this.onRejected="function"==typeof t?t:null,this.promise=n}function d(e,t){var n=!1;try{e(function(e){n||(n=!0,a(t,e))},function(e){n||(n=!0,s(t,e))})}catch(e){n||(n=!0,s(t,e))}}o.prototype.catch=function(e){return this.then(null,e)},o.prototype.then=function(e,t){var n=new this.constructor(i);return r(this,new c(e,t,n)),n},o.all=function(e){var s=Array.prototype.slice.call(e);return new o(function(r,o){if(0===s.length)return r([]);var a=s.length;for(var e=0;e<s.length;e++)!function t(n,e){try{if(e&&("object"==typeof e||"function"==typeof e)){var i=e.then;if("function"==typeof i)return void i.call(e,function(e){t(n,e)},o)}s[n]=e,0==--a&&r(s)}catch(e){o(e)}}(e,s[e])})},o.resolve=function(t){return t&&"object"==typeof t&&t.constructor===o?t:new o(function(e){e(t)})},o.reject=function(n){return new o(function(e,t){t(n)})},o.race=function(r){return new o(function(e,t){for(var n=0,i=r.length;n<i;n++)r[n].then(e,t)})},o._immediateFn="function"==typeof setImmediate?function(e){setImmediate(e)}:function(e){t(e,0)},o._unhandledRejectionFn=function(e){"undefined"!=typeof console&&console&&console.warn("Possible Unhandled Promise Rejection:",e)},o._setImmediateFn=function(e){o._immediateFn=e},o._setUnhandledRejectionFn=function(e){o._unhandledRejectionFn=e},window.Promise=o}e("5f"),(window.app||window.isWk)&&(window.open=function(e){bridge.callHandler("window.open",e)}),window.reqnode&&(window.open=function(){console.error("window.open not implemeted")}),"performance"in window==0&&(window.performance=window.performance||{offset:Date.now(),now:function(){return Date.now()-this.offset}}),Element.prototype.insertChildAtIndex=function(e,t){(t=t||0)>=this.children.length?this.appendChild(e):this.insertBefore(e,this.children[t])},DocumentFragment.prototype.insertChildAtIndex=function(e,t){(t=t||0)>=this.children.length?this.appendChild(e):this.insertBefore(e,this.children[t])},Number.isNaN||(Number.isNaN=window.isNaN),Number.parseInt||(Number.parseInt=window.parseInt),window.Set||((e=function(){this.set=[]}).prototype.add=function(e){-1==!this.has(e)&&this.set.push(e)},e.prototype.delete=function(e){this.has(e)&&this.set.splice(this.set.indexOf(e))},e.prototype.has=function(e){return-1<this.set.indexOf(e)},window.Set=e),window.Map||((e=function(){this.map={}}).prototype.get=function(e){return this.map[e]},e.prototype.delete=function(e){delete this.map[e]},e.prototype.set=function(e,t){this.map[e]=t},window.Map=e),[].fill||Object.defineProperty(Array.prototype,"fill",{value:function(e){for(var t=Object(this),n=parseInt(t.length),i=parseInt(arguments[1])||0,r=i<0?Math.max(n+i,0):Math.min(i,n),i=arguments[2],i=void 0===i?n:parseInt(i)||0,o=i<0?Math.max(n+i,0):Math.min(i,n);r<o;r++)t[r]=e;return t}}),[].find||Object.defineProperty(Array.prototype,"find",{value:function(e){if(null==this)throw new TypeError('"this" is null or not defined');var t=Object(this),n=t.length>>>0;if("function"!=typeof e)throw new TypeError("predicate must be a function");for(var i=arguments[1],r=0;r<n;){var o=t[r];if(e.call(i,o,r,t))return o;r++}},writable:!0}),Object.defineProperty(Array.prototype,"remove",{value:function(e){e=this.indexOf(e);if(~e)return this.splice(e,1)},writable:!0}),Object.defineProperty(Array.prototype,"removeFirstIf",{value:function(e){for(var t=this.length;t--;)if(e(this[t],t))return void this.splice(t,1)}}),Object.defineProperty(Array.prototype,"removeIf",{value:function(e){for(var t=this.length;t--;)e(this[t],t)&&this.splice(t,1)}}),Object.defineProperty(Array.prototype,"repeat",{value:function(e,t){for(;t;)this[--t]=e;return this}}),Object.defineProperty(Array.prototype,"last",{value:function(){return this.length?this[this.length-1]:void 0},writable:!0}),Object.defineProperty(Array.prototype,"lastDef",{value:function(){for(var e=this.length-1;0<=e;e--)if(null!=this[e])return this[e]}}),Object.defineProperty(Array.prototype,"clone",{value:function(){return this.slice(0)},writable:!0}),Object.defineProperty(Array.prototype,"subarray",{value:function(e,t){return this.slice(e,t)}}),Object.clone=function(e){return e?Object.assign({},e):null},"function"!=typeof Object.assign&&Object.defineProperty(Object,"assign",{value:function(e,t){if(null==e)throw new TypeError("Cannot convert undefined or null to object");for(var n=Object(e),i=1;i<arguments.length;i++){var r=arguments[i];if(null!=r)for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(n[o]=r[o])}return n},writable:!0,configurable:!0}),window.NodeList&&!NodeList.prototype.forEach&&(NodeList.prototype.forEach=function(e,t){t=t||window;for(var n=0;n<this.length;n++)e.call(t,this[n],n,this)}),window.NodeList&&!NodeList.prototype.last&&(NodeList.prototype.last=function(){return 0<this.length?this[this.length-1]:null}),NodeList.prototype.remove=function(){Array.prototype.slice.call(this).forEach(function(e){e.remove()})},Node.prototype.rawText=function(e){var t,n;if(window.File)return t=File.option.convertSmartOnRender&&(File.option.smartDash||File.option.smartQuote),(n=this.cloneNode(!0)).querySelectorAll(".md-emptyline").forEach(function(e){e.textContent=e.textContent.replace(/\n/,"")}),File.option.ignoreLineBreak&&n.querySelectorAll(".md-softbreak").forEach(function(e){e.textContent=e.textContent.replace(/^\u00a0/,"\n")}),n.querySelectorAll(".md-linebreak").forEach(function(e){e.textContent=e.textContent.replace(/\n\n/,"\n")}),n.querySelectorAll(".md-ruby ruby").forEach(function(e){e.textContent=""}),File.option.enableInlineMath&&n.querySelectorAll("mjx-container").forEach(function(e){e.textContent=""}),t&&n.querySelectorAll(".md-pants").forEach(function(e){-1<e.textContent.indexOf(e.dataset.content)&&e.firstElementChild&&e.firstElementChild.remove(),e.classList.contains("md-pants-space-after")?e.textContent=e.textContent.replace(/^ /,'"'):e.classList.contains("md-pants-space-before")?e.textContent=e.textContent.replace(/»/,'"'):e.textContent=e.textContent.replace(e.dataset.content||e.dataset.text,e.dataset.text)}),e&&n.querySelectorAll(".md-math-after-sym, .md-emoji-control-ch").forEach(function(e){e.textContent=e.textContent.replace(/\u200b/g,"")}),void 0===n.textContent?n.innerText:n.textContent},s.fn.visibleText=function(){var n;return 0===this.length?"":1!==this.length||3!==this[0].nodeType&&0!==this[0].childElementCount?(n="",s.each(this.contents(),function(e,t){3===t.nodeType?n+=t.textContent:1===t.nodeType&&t.tagName=="mjx-container".toUpperCase()?n+=(t.nextElementSibling||{}).offsetWidth?t.textContent:1:1===t.nodeType&&(t.offsetHeight||t.offsetWidth)&&(n+=s(t).visibleText())}),n):this.text()},window.console&&(console.stack=function(e){File.isNodeHtml?(new Error).stack:console.trace},console.warn||(console.warn=function(e){console.log(e)}),File.isNode&&(i=reqnode("electron").ipcRenderer),a=console.error,console.sendError=function(e,t,n){var i=n,r=n,n=("string"==typeof n?r={detail:i}:i=void 0,e),o=(e.stack?n=e.stack:e.message&&(n=e.message),!1===t||"warn"===t||"warning"===t),n=n+(i?" {"+i+"}":"");o?console.warn(n):a(n),JSBridge.invoke(o?"logger.warn":"logger.error",n),!window.Reporter||!1===t&&!0===t&&"skip"===t||window.Reporter.error(e,Object.assign({level:t},r))},o=console.log,console.sendLog=function(e,t){o(e),t||Reporter.record(e),File.isMac?bridge.callHandler("logger.info",e):File.isNode&&(i=i||reqnode("electron").ipcRenderer)&&i.send("sendLog",e)},console.sendLogForDebug=function(e){window.debugMode&&console.sendLog(e)},window.debugMode)&&File.isMac&&(r=console.debug,console.debug=function(e){r(e),File.isMac&&bridge.callHandler("logger.debug",e)}),void 0===NodeList.prototype.forEach&&(NodeList.prototype.forEach=Array.prototype.forEach),void 0===HTMLCollection.prototype.forEach&&(HTMLCollection.prototype.forEach=Array.prototype.forEach),window.Promise||l(window),window.reqnode&&(window.alert=function(e){JSBridge.invoke("dialog.showMessageBox",{type:"error",message:s.localize.getString("Error"),detail:e,buttons:[s.localize.getString("OK")]})}),window.debugMode&&!Object.observe&&(Object.observe=function(e,s){return s=s||(()=>{}),new Proxy(e,{set(e,t,n,i){var r,o,a=e[t];a!==n&&(o={name:t,type:r=void 0===a?"add":"update",object:e},"update"==r&&(o.oldValue=a),e[t]=n,s([o]))},deleteProperty(e,t,n){var i;t in e&&(i={name:t,type:"delete",object:e,oldValue:e[t]},delete e[t],s([i]))}})}),window.requestIdleCallback||(window.requestIdleCallback=function(e,t){return window.setTimeout(e,(t||{}).timeout||100)},window.cancelIdleCallback=window.clearTimeout),window.requestSmartSchedule=function(e,t,n){var i=null;return[setTimeout(()=>{i=requestIdleCallback(e,{timeout:n-t})},t),i]},window.cancelSmartSchedule=function(e){e[0]&&clearTimeout(e[0]),e[1]&&cancelIdleCallback(e[1])},t.safePromise=async e=>{try{return await e()}catch(e){return console.warn(e),null}},String.prototype.replaceAll||(String.prototype.replaceAll=function(e,t){return"[object regexp]"===Object.prototype.toString.call(e).toLowerCase()?this.replace(e,t):this.replace(new RegExp(e,"g"),t)})}),$__System.registerDynamic("50",["1b","13","2b"],!0,function(e,t,n){"use strict";this||self,e("1b");var c,a=e("13"),s=a.Node,d=a.TYPE,i=(e("2b"),null),r=60;function l(e,t,n){e&&(e[t]=$.extend(e[t],n))}function u(t){var n=File.editor.styleBookmark.style;["Copy as Plain Text","Copy as Markdown","Copy as HTML Code","Copy without Theme Styling"].map(e=>{t["Edit→"+e]={enabled:!n||n.textSelected||!1}})}function o(t,e){if(c=File.editor.styleBookmark.style,t){t["Format→Inline Math"]={hidden:!File.option.enableInlineMath},t["Format→Highlight"]={hidden:!File.option.enableHighlight},t["Paragraph→Alert"]={hidden:!File.option.enableAlert},t["Format→Subscript"]={hidden:!File.option.enableSubscript},t["Format→Superscript"]={hidden:!File.option.enableSubscript};var n=File.editor.stylize.CONST,e=(e||File.editor.stylize.putBookmark(null,File.editor.stylize.buildBookmark()),File.editor.styleBookmark.style),i=e.cannotContainInline,r=(u(t),i=(i=e.block[0]==d.def_footnote?i||File.editor.stylize.isAtFootnoteDefSpan():i)||-1<e.inline.indexOf(d.inline_math),["Strong","Emphasis","Underline","Code","Strike","Hyperlink","Clear Format","Inline Math","Highlight","Subscript","Superscript","Comment"].map(function(e){t["Format→"+e]=Object.assign({enabled:!File.isLocked&&!i,state:!1},t["Format→"+e])}),["image","strong","em","link"]),o={},a=File.editor.styleBookmark.style.inline;(a||[]).map(function(e){"image"!==e&&(t["Format→"+n.StyleToNameMap[e]]={state:!0}),r.remove(e),o[n.StyleToNameMap[e]]=!0}),-1<a.indexOf("link")||-1<a.indexOf("autolink")||-1<a.indexOf("url")||-1<a.indexOf("reflink")||-1<e.block.indexOf("def_link")?t["Format→Hyperlink Actions"]={enabled:!0}:t["Format→Hyperlink Actions"]={enabled:!1};const s=-1<a.indexOf("image")||-1<a.indexOf("imgtag")||-1<a.indexOf("refimg"),l=s&&File.isTextPack()&&-1<a.indexOf("embed-resource");["Open Image Location…","Upload Image","Copy Image to…","Rename or Move Image to…","Copy Image Content","Zoom Image","Delete Image File","Switch Image Syntax"].forEach(e=>{t["Format→Image→"+e]="Open Image Location…"===e?{enabled:s&&!l}:{enabled:s}}),t["Edit→Copy Image Content"]={hidden:!1,visible:s,enabled:s},-1<a.indexOf("refimg")&&(t["Format→Image→Switch Image Syntax"]={hidden:!0,visible:!1}),t["Format→Image→Switch Image Syntax→Markdown Style"]={state:-1<a.indexOf("image")},t["Format→Image→Switch Image Syntax→HTML Style"]={state:-1<a.indexOf("imgtag")},File.isMac&&(i||r.map(function(e){o[n.StyleToNameMap[e]]=!1}),bridge.callHandler("touchBar.setInlineEnabled",!i),bridge.callHandler("touchBar.setInlineStates",o))}}function h(e,t,n){if(e&&(n&&(e.length||(e=n),t.length||(t=n)),e.length==t.length)){for(var i=0;i<e.length;i++)if(e[i]!=t[i])return;return 1}}function p(n,e){i&&clearTimeout(i);var t=r;c&&-1<c.inline.indexOf(d.inline_math)&&(t=50),File.isMacWK&&(t=30),e&&(c=null),i=setTimeout(function(){var e=(n||File.editor.stylize.putBookmark(null,File.editor.stylize.buildBookmark())).style,t={};c&&h(e.block,c.block)?h(e.inline,c.inline,[d.plain])?e.textSelected!=c.textSelected&&(c=File.editor.styleBookmark.style,u(t)):o(t,!0):(f(t,!0),o(t,!0)),0<Object.keys(t).length&&JSBridge.menu.update(t)},t)}function f(t,e){t=t||{},e||File.editor.stylize.putBookmark(null,File.editor.stylize.buildBookmark());var n=File.editor.styleBookmark.style,i=File.editor.stylize.CONST.NormalBlockMap[n.block[0]],r=(["Heading 1","Heading 2","Heading 3","Heading 4","Heading 5","Heading 6","Paragraph","Decrease Heading Level","Increase Heading Level","Table","Code Fences","Math Block","Quote","Ordered List","Unordered List","Task List","Link Reference","Footnotes","YAML Front Matter","Horizontal Line","Table of Contents"].map(function(e){l(t,"Paragraph→"+e,{enabled:!File.isLocked&&0<n.block.length&&null!=i,state:!1})}),!function(){try{return File.editor.getMarkElem(window.getSelection().getRangeAt(0).startContainer).attr("mdtype")==a.TYPE.meta_block}catch(e){}}()?["Quote","Ordered List","Unordered List","Task List","Code Fences","Math Block","Insert Paragraph Before","Insert Paragraph After"].map(function(e){l(t,"Paragraph→"+e,{enabled:!0})}):l(t,"Paragraph→Paragraph",{enabled:!0}),-1<(File.editor.styleBookmark.style.block||[]).indexOf(d.meta_block)?l(t,"Paragraph→Insert Paragraph Before",{enabled:!1}):l(t,"Paragraph→Insert Paragraph Before",{enabled:!0}),s.isType(n.block[0],d.fences,d.math_block,d.html_block)?(l(t,"Paragraph→Code Tools→Copy Code Content",{enabled:!0}),l(t,"Paragraph→Code Tools→Auto Indent Whole Code",{enabled:!0})):(l(t,"Paragraph→Code Tools→Copy Code Content",{enabled:!1}),l(t,"Paragraph→Code Tools→Auto Indent Whole Code",{enabled:!1})),null),o=!1;(File.editor.styleBookmark.style.block||[]).map(function(e){!r&&s.isType(e,"ol","ul","tasklist")&&(r=e),e==d.blockquote&&(o=!0);e=File.editor.stylize.CONST.StyleToNameMap[e];l(t,"Paragraph→"+e,{state:!0})}),"tasklist"==r?(l(t,"Paragraph→Task Status",{enabled:!0}),e="checked"==File.editor.styleBookmark.style.state,l(t,"Paragraph→Task Status→Mark as Complete",{state:e}),l(t,"Paragraph→Task Status→Mark as Incomplete",{state:!e})):l(t,"Paragraph→Task Status",{enabled:!1}),File.isMac&&($("#md-searchpanel").is(":visible")?bridge.callHandler("touchBar.showFindReplaceTouchBar"):document.body.classList.contains("modal-open")?$("#table-insert-dialog:visible").length?bridge.callHandler("touchBar.showInsertTableTouchBar"):bridge.callHandler("touchBar.showDialogTouchBar"):bridge.callHandler("touchBar.setBlockStyle",{blockStyle:File.editor.stylize.CONST.StyleToNameMap[(e=n.block)[0]==d.table_cell?d.table:e[0]]||"",listType:r,underQuote:o,fallbackOnly:!i}))}function m(e){var t,n,i=!1,r=(e||(e={},i=!0),File.editor&&File.editor.sourceView&&File.editor.sourceView.inSourceMode);e["View→Source Code Mode"]={state:r,enabled:!File.isLocked},JSBridge.invoke("window.updateMenuForIsAlwaysOnTop"),e["View→Focus Mode"]={state:File.isFocusMode,enabled:!0},e["View→Typewriter Mode"]={state:File.isTypeWriterMode,enabled:!0},File.editor&&File.editor.library&&(t=File.editor.library.isSidebarShown(),n=File.editor.library.getActiveTab(),e["View→Outline"]={state:t&&"outline"==n,enabled:!r},e["View→Toggle Word Count Popover"]={enabled:!r},File.isMac&&(e["View→Toggle Outline Popover"]={enabled:!r}),e["View→File Tree"]={state:t&&"file-tree"==n,enabled:!r},e["View→Search"]={state:!(!t||!document.querySelector(".ty-on-search")),enabled:!r},e["View→Toggle Sidebar"]={enabled:!r}),i&&JSBridge.menu.update(e)}var g={doRefreshImageCopyStatus:function(e,t){var n,i;File.editor&&File.editor.imgEdit&&(n=File.editor.imgEdit.getTargetImageStorageFolder(),i=!1,t||(t={},i=!0),l(t,"Format→Image→Use Image Root Path",{state:!!File.editor.docMenu.getLocalRootUrl()}),l(t,"Format→Image→When Insert Local Image→Copy Image File to Folder…",{state:!!n&&"ipic"!==n.toLowerCase()&&"upload"!==n.toLowerCase()}),l(t,"Format→Image→When Insert Local Image→Upload Image",{state:n&&("ipic"==n.toLowerCase()||"upload"==n.toLowerCase())}),void 0!==e&&(l(t,"Format→Image→Use Image Root Path",{enabled:!e}),l(t,"Format→Image→When Insert Local Image→Copy Image File to Folder…",{enabled:!e}),l(t,"Format→Image→When Insert Local Image→Upload Image",{enabled:!e})),i)&&JSBridge.menu.update(t)},refreshViewMenu:m,refreshBlockMenu:f,bindMenu:function(){g.freshMenu(!0),$(File.editor.sessionStr).on("cursorChange",function(e,t){p(t)}),p()},freshMenu:function(n){var i=File.editor&&File.editor.sourceView&&File.editor.sourceView.inSourceMode;function e(){var e,t={};File.isNode||m(t),(File.isMacWK||File.isMacLegacy)&&(t["Format→Image→Upload Local Images via iPic"]={enabled:!File.isLocked&&!i}),t["Format→Image→Insert Local Images…"]={enabled:!File.isLocked},t["Edit→Delete"]={enabled:!File.isLocked},t["Edit→Delete Range"]={enabled:!File.isLocked},t["Edit→Cut"]={enabled:!File.isLocked},t["Edit→Paste"]={enabled:!File.isLocked},u(t),t["Edit→Line Endings"]={enabled:!File.isLocked},t["Edit→Whitespace and Line Breaks"]={enabled:!i},t.Paragraph={enabled:!File.isLocked&&!i},t.Format={enabled:!File.isLocked&&!i},File.setLineEnding(File.useCRLF,!1,!0),g.doRefreshImageCopyStatus(File.isLocked||i,t),i?(e=File.editor.sourceView.cm.doc.historySize(),t["Edit→Undo"]={enabled:!File.isLocked&&0<e.undo},t["Edit→Redo"]={enabled:!File.isLocked&&0<e.redo},File.isNode&&window.ClientCommand.refreshViewMenu()):(t["Edit→Undo"]={enabled:!File.isLocked&&File.editor&&File.editor.undo&&File.editor.undo.hasUndo()},t["Edit→Redo"]={enabled:!File.isLocked&&File.editor&&File.editor.undo&&File.editor.undo.hasRedo()},File.isNode?window.ClientCommand.refreshViewMenu():t["View→Always on Top"]={enabled:!0},File.isLocked||p(void 0,!0)),n&&File.isNode&&(t["File→Open File Location"]={enabled:!!File.bundle.filePath},t["File→Reveal in Sidebar"]={enabled:!!File.bundle.filePath},File.isWin&&(t["File→Properties"]={enabled:!!File.bundle.filePath}),File.isMacNode||(t["File→Reopen with Encoding"]={hidden:!File.bundle.filePath}),t["File→Delete…"]={enabled:!!File.bundle.filePath}),n&&(t["Edit→Whitespace and Line Breaks→Indent first line of paragraphs"]={state:File.option.indentFirstLine,enabled:!i},t["Edit→Whitespace and Line Breaks→Visible <br/>"]={state:!File.option.hideBrAndLineBreak,enabled:!i},t["Edit→Preserve single line break"]={state:File.option.ignoreLineBreak,enabled:!i}),t["Edit→Line Endings→Insert Final New Line On Save"]={state:File.finalNewline},JSBridge.menu.update(t)}if(File.isNode){try{e()}catch(e){console.sendError(e,"warning")}n&&JSBridge.invoke("window.checkAsFocus")}else(File.isMac||File.isMacWK)&&e()}},y=null;g.freshMenuWithDelay=function(){y&&(clearTimeout(y),y=null),y=setTimeout(File.freshMenu,500)},g.forceRefreshMenu=function(){File.isLinux&&JSBridge.sendIPC("forceRefreshMenu")},n.exports=g}),$__System.registerDynamic("46",["e","13","1b","2b","50","26"],!0,function(e,t,n){"use strict";this||self;var _=e("e"),i=e("13"),a=i.TYPE,A=i.Node,M=e("1b"),L=(e("2b"),e("50")),N=e("26").map;class D{constructor(u){var t,h=this;function n(e){var l,t='<div class="popover bottom md-table-resize-popover" style="display:block; bottom:auto; top:20px; margin-left:-10px;" contenteditable="false">\t\t\t\t<div class="arrow" style="left:20px;"></div>\t\t\t\t<div class="md-grid-board-wrap md-reset code-tooltip-content">\t\t\t\t\t<table role="grid" class="md-grid-board md-reset">\t\t\t\t\t\t<tbody>\t\t\t\t\t\t\t<tr class="md-reset" row="1">\t\t\t\t\t\t\t\t<td class="md-reset" col="1"><a href="#"></a></td>\t\t\t\t\t\t\t\t<td class="md-reset" col="2"><a href="#"></a></td>\t\t\t\t\t\t\t\t<td class="md-reset" col="3"><a href="#"></a></td>\t\t\t\t\t\t\t\t<td class="md-reset" col="4"><a href="#"></a></td>\t\t\t\t\t\t\t\t<td class="md-reset" col="5"><a href="#"></a></td>\t\t\t\t\t\t\t\t<td class="md-reset" col="6"><a href="#"></a></td>\t\t\t\t\t\t\t</tr>\t\t\t\t\t\t\t<tr class="md-reset" row="2">\t\t\t\t\t\t\t\t<td class="md-reset" col="1"><a href="#"></a></td>\t\t\t\t\t\t\t\t<td class="md-reset" col="2"><a href="#"></a></td>\t\t\t\t\t\t\t\t<td class="md-reset" col="3"><a href="#"></a></td>\t\t\t\t\t\t\t\t<td class="md-reset" col="4"><a href="#"></a></td>\t\t\t\t\t\t\t\t<td class="md-reset" col="5"><a href="#"></a></td>\t\t\t\t\t\t\t\t<td class="md-reset" col="6"><a href="#"></a></td>\t\t\t\t\t\t\t</tr>\t\t\t\t\t\t\t<tr class="md-reset" row="3">\t\t\t\t\t\t\t\t<td class="md-reset" col="1"><a href="#"></a></td>\t\t\t\t\t\t\t\t<td class="md-reset" col="2"><a href="#"></a></td>\t\t\t\t\t\t\t\t<td class="md-reset" col="3"><a href="#"></a></td>\t\t\t\t\t\t\t\t<td class="md-reset" col="4"><a href="#"></a></td>\t\t\t\t\t\t\t\t<td class="md-reset" col="5"><a href="#"></a></td>\t\t\t\t\t\t\t\t<td class="md-reset" col="6"><a href="#"></a></td>\t\t\t\t\t\t\t</tr>\t\t\t\t\t\t\t<tr class="md-reset" row="4">\t\t\t\t\t\t\t\t<td class="md-reset" col="1"><a href="#"></a></td>\t\t\t\t\t\t\t\t<td class="md-reset" col="2"><a href="#"></a></td>\t\t\t\t\t\t\t\t<td class="md-reset" col="3"><a href="#"></a></td>\t\t\t\t\t\t\t\t<td class="md-reset" col="4"><a href="#"></a></td>\t\t\t\t\t\t\t\t<td class="md-reset" col="5"><a href="#"></a></td>\t\t\t\t\t\t\t\t<td class="md-reset" col="6"><a href="#"></a></td>\t\t\t\t\t\t\t</tr>\t\t\t\t\t\t\t<tr class="md-reset" row="5">\t\t\t\t\t\t\t\t<td class="md-reset" col="1"><a href="#"></a></td>\t\t\t\t\t\t\t\t<td class="md-reset" col="2"><a href="#"></a></td>\t\t\t\t\t\t\t\t<td class="md-reset" col="3"><a href="#"></a></td>\t\t\t\t\t\t\t\t<td class="md-reset" col="4"><a href="#"></a></td>\t\t\t\t\t\t\t\t<td class="md-reset" col="5"><a href="#"></a></td>\t\t\t\t\t\t\t\t<td class="md-reset" col="6"><a href="#"></a></td>\t\t\t\t\t\t\t</tr>\t\t\t\t\t\t\t<tr class="md-reset" row="6">\t\t\t\t\t\t\t\t<td class="md-reset" col="1"><a href="#"></a></td>\t\t\t\t\t\t\t\t<td class="md-reset" col="2"><a href="#"></a></td>\t\t\t\t\t\t\t\t<td class="md-reset" col="3"><a href="#"></a></td>\t\t\t\t\t\t\t\t<td class="md-reset" col="4"><a href="#"></a></td>\t\t\t\t\t\t\t\t<td class="md-reset" col="5"><a href="#"></a></td>\t\t\t\t\t\t\t\t<td class="md-reset" col="6"><a href="#"></a></td>\t\t\t\t\t\t\t</tr>\t\t\t\t\t\t\t<tr class="md-reset" row="7">\t\t\t\t\t\t\t\t<td class="md-reset" col="1"><a href="#"></a></td>\t\t\t\t\t\t\t\t<td class="md-reset" col="2"><a href="#"></a></td>\t\t\t\t\t\t\t\t<td class="md-reset" col="3"><a href="#"></a></td>\t\t\t\t\t\t\t\t<td class="md-reset" col="4"><a href="#"></a></td>\t\t\t\t\t\t\t\t<td class="md-reset" col="5"><a href="#"></a></td>\t\t\t\t\t\t\t\t<td class="md-reset" col="6"><a href="#"></a></td>\t\t\t\t\t\t\t</tr>\t\t\t\t\t\t\t<tr class="md-reset" row="8">\t\t\t\t\t\t\t\t<td class="md-reset" col="1"><a href="#"></a></td>\t\t\t\t\t\t\t\t<td class="md-reset" col="2"><a href="#"></a></td>\t\t\t\t\t\t\t\t<td class="md-reset" col="3"><a href="#"></a></td>\t\t\t\t\t\t\t\t<td class="md-reset" col="4"><a href="#"></a></td>\t\t\t\t\t\t\t\t<td class="md-reset" col="5"><a href="#"></a></td>\t\t\t\t\t\t\t\t<td class="md-reset" col="6"><a href="#"></a></td>\t\t\t\t\t\t\t</tr>\t\t\t\t\t\t\t<tr class="md-reset" row="9">\t\t\t\t\t\t\t\t<td class="md-reset" col="1"><a href="#"></a></td>\t\t\t\t\t\t\t\t<td class="md-reset" col="2"><a href="#"></a></td>\t\t\t\t\t\t\t\t<td class="md-reset" col="3"><a href="#"></a></td>\t\t\t\t\t\t\t\t<td class="md-reset" col="4"><a href="#"></a></td>\t\t\t\t\t\t\t\t<td class="md-reset" col="5"><a href="#"></a></td>\t\t\t\t\t\t\t\t<td class="md-reset" col="6"><a href="#"></a></td>\t\t\t\t\t\t\t</tr>\t\t\t\t\t\t\t<tr class="md-reset" row="10">\t\t\t\t\t\t\t\t<td class="md-reset" col="1"><a href="#"></a></td>\t\t\t\t\t\t\t\t<td class="md-reset" col="2"><a href="#"></a></td>\t\t\t\t\t\t\t\t<td class="md-reset" col="3"><a href="#"></a></td>\t\t\t\t\t\t\t\t<td class="md-reset" col="4"><a href="#"></a></td>\t\t\t\t\t\t\t\t<td class="md-reset" col="5"><a href="#"></a></td>\t\t\t\t\t\t\t\t<td class="md-reset" col="6"><a href="#"></a></td>\t\t\t\t\t\t\t</tr>\t\t\t\t\t\t</tbody>\t\t\t\t\t</table>\t\t\t\t\t<div class="popover-title">\t\t\t\t\t\t<input id="md-grid-width" type="text"  max="20" size="2" min="1" value="0" /> x <input id="md-grid-height" maxlength="2" size="2" min="1" value="0"/><button id="md-resize-grid" class="btn btn-primary btn-xs">'+_.localize.getString("OK")+"</button>\t\t\t\t\t</div>\t\t\t\t</div>\t\t\t</div>",c=e.closest('[mdtype="table"]'),d=u.findNodeByElem(c),n=d.get("align").length,i=c.children("table").children("tbody").children("tr").length+1;function r(){_(this).val().trim().length||_(this).val(2);var e=l.find("#md-grid-width").val(),t=l.find("#md-grid-height").val();l.find("a.md-active").removeClass("md-active"),l.find("tr:nth-child(-n+"+t+")>td:nth-child(-n+"+e+")>a").addClass("md-active")}_(".md-table-resize-popover").remove(),e.append(t),(l=e.find(".md-table-resize-popover")).find("tr:nth-child(-n+"+i+")>td:nth-child(-n+"+n+")").addClass("md-grid-ext"),l.find("#md-grid-width, #md-grid-height").off("keydown keypress").on("keypress",function(e){if(!/\d/.exec(String.fromCharCode(e.which)))return!1}).on("keydown",function(e){e=e.keyCode||e.which;return"Up"===N[e]?(this.value=+this.value+1,this.value=Math.min("md-grid-height"==this.getAttribute("id")?99:40,this.value),!1):"Down"===N[e]?(this.value=this.value-1,this.value=Math.max(1,this.value),!1):void 0}),l.find("#md-grid-width").val(n).off("blur focus").blur(r).focus(function(){l.find("#md-resize-grid").show()}).blur(function(){40<this.value?this.value=40:this.value<1&&(this.value=1)}).on("keydown",function(e){var t=e.keyCode||e.which;if("Tab"===N[t]&&!e.ctrlKey)return l.find("#md-grid-height").focus(),!1;"Enter"===N[t]&&l.find("#md-grid-height").focus()}),l.find("#md-grid-height").val(i).off("blur focus").blur(r).focus(function(){l.find("#md-resize-grid").show()}).blur(function(){99<this.value?this.value=99:this.value<1&&(this.value=1)}).on("keydown",function(e){var t=e.keyCode||e.which;if("Tab"===N[t]&&!e.ctrlKey)return l.find("#md-grid-width").focus(),!1;"Enter"===N[t]&&l.find("#md-resize-grid").click()}),l.find(".md-grid-board a").off("mouseenter mouseleave click").hover(function(){var e=(t=_(this).closest("td")).prevAll().length+1,t=t.closest("tr").prevAll().length+1;l.find("a.md-active").removeClass("md-active"),l.find("tr:nth-child(-n+"+t+")>td:nth-child(-n+"+e+")>a").addClass("md-active"),l.find("#md-grid-width").val(e),l.find("#md-grid-height").val(t),l.find("#md-resize-grid").hide()}).click(function(e){e.stopPropagation(),e.preventDefault(),l.find("#md-resize-grid").click()}),l.find(".md-grid-board").off("mouseleave").on("mouseleave",function(e){_(this).find("a").removeClass("md-active"),_("#md-grid-width").val(n),_("#md-grid-height").val(i)}),l.find("#md-resize-grid").off("click").click(function(e){var t,n=+(l.find("#md-grid-width").val()||0),i=+(l.find("#md-grid-height").val()||0),r=d.getFirstChild(),o=d.get("align").length,a=0,s=u.undo.UndoManager.makeEmptyCommand();for(u.undo.endSnap(!0),s.undo.push(u.undo.buildReplaceUndo(d));r||a<i;)a<i?(r?D.resizeRow(r,n,d):r=D.newEmptyRowAfter(t,n,d),r=(t=r).get("after")):r&&(r=(t=r).get("after"),t.remove()),a++;n<o?d.set("align",d.get("align").slice(0,n)):d.set("align",d.get("align").concat([].repeat(null,n-o))),c.replaceWith(d.toHTML()),u.lastCursor?u.undo.exeCommand(u.lastCursor):window.getSelection().removeAllRanges(),h.showTableEdit(d),s.redo.push(u.undo.buildReplaceUndo(d)),u.undo.register(s)})}this.editor=u,this.TableEdit=D,_(u.sessionStr).on("click",".md-align-gp button",function(e){var t,n=/md-align-\S+/g.exec(this.className)[0].substring(9),i=_(this).closest('[mdtype="table"]'),r=u.findNodeByElem(i),[o,a]=((t=t||u.selection.getRangy())?[(i=_(t.startContainer).closest("td, th")).prevAll().length,((t=_(t.endContainer).closest("td, th")).parent().is(i.parent())?t.prevAll():t.parent().children()).length]:null)||[];if(void 0!==o){for(var s=null,l=o;l<=a;l++){var c=r.get("align")[l],c=r.attr("align_idx",[l,c==n?null:n],u);o<l?(u.undo.removeLastRegisteredOperationCommand(),M.append(s,c)):s=c}o<a&&u.undo.register(s),e.stopPropagation(),u.lastCursor&&u.undo.exeCommand(u.lastCursor)}}).on("click",".md-delete-table",function(){u.tableEdit.deleteTable(_(this).closest("[mdtype='table']"))}).on("click",".md-resize-table",function(e){_(this).next(".md-table-resize-popover").length?(_(".md-table-resize-popover").remove(),u.lastCursor&&u.undo.exeCommand(u.lastCursor)):n(_(this).parent()),e.stopPropagation()}).on("click",".ty-table-edit",function(e){_(e.target).closest(".md-table-resize-popover").length||(_(".md-table-resize-popover").remove(),u.lastCursor&&_(".md-table-resize-popover").length&&u.undo.exeCommand(u.lastCursor)),e.stopPropagation()}).on("mousedown",".ty-table-edit button",function(){File.editor.lastCursor=File.editor.selection.buildUndo()||File.editor.lastCursor}).on("refocus","[mdtype='table']",function(){_(document.activeElement).closest("[md-inline='image']").length||h.showTableEdit(_(this))}).on("mouseup",".ty-table-edit",function(e){e.stopPropagation()}).on("click",".md-table-more",function(){_(File.editor.sessionStr).trigger("cursorChange"),File.editor.lastCursor=File.editor.selection.buildUndo(),File.editor.contextMenu.updateTableVisibility(),File.editor.contextMenu.showExtMenu("#table-menu",_(this)),this.focus()}),(t=_("#table-insert-dialog")).find("#table-insert-col, #table-insert-row").off("keydown keypress keyup change").on("keypress",function(e){if(!/\d/.exec(String.fromCharCode(e.which)))return!1}).on("keydown",function(e){e=e.keyCode||e.which;return"Up"===N[e]?(this.value=+this.value+1,this.value=Math.min("table-insert-row"==this.getAttribute("id")?99:40,this.value),!1):"Down"===N[e]?(this.value=this.value-1,this.value=Math.max(1,this.value),!1):void("ESC"===N[e]&&t.modal("hide"))}).on("keyup",function(){_(this).trigger("change")}).on("change",function(){h.updateInsertTableTouchBar()}),t.find("#table-insert-col").blur(function(){0===_(this).val().trim().length&&_(this).val(2),40<this.value?this.value=40:this.value<1&&(this.value=1)}).on("keydown",function(e){e=e.keyCode||e.which;if("Tab"===N[e]&&!event.ctrlKey||"Enter"===N[e])return t.find("#table-insert-row").focus(),!1}),t.find("#table-insert-row").blur(function(){0===_(this).val().trim().length&&_(this).val(1),99<this.value?this.value=99:this.value<1&&(this.value=1)}).on("keydown",function(e){e=e.keyCode||e.which;"Enter"===N[e]&&t.find(".btn-primary").trigger("click")}),t.find(".btn-primary").click(function(){t.modal("hide"),u.restoreLastCursor(),_(File.editor.sessionStr).trigger("cursorChange");var e=new A({type:A.TYPE.table,in:u.nodeMap});D.verify(e,t.find("#table-insert-col").val(),t.find("#table-insert-row").val()),u.stylize.insertBlock(A.TYPE.table,e)}),t.on("hidden.bs.modal",function(){File.isMac&&setTimeout(function(){L.refreshBlockMenu(null,!0)},100)});var s,l,r,c,d,p,f,m,o,g,y,v,a,b,w=0;function e(e){var t,n,i;if(!File.isLocked)return h.editor.focusCid=null,d=!0,window.getSelection().removeAllRanges(),F(),t=l.children(),_("#typora-table-row-tracker .typora-table-data-area").html((i=l.height(),l.closest("thead").length?"<table class='md-table' style='margin:0 ; padding:0; margin-left:0; height:"+i+"px;'><thead>"+l[0].outerHTML+"</thead></table>":"<table class='md-table' style='margin:0 ; padding:0; margin-left:0; height:"+i+"px;'><tbody>"+l[0].outerHTML+"</tbody></table>")).find("td, th").each(function(e){this.style.width=t[e].offsetWidth+"px"}),y=e.offsetX,v=e.offsetY,m=f=l.closest("thead").length?0:l.prevAll().length+1,g=[],n=s.offset().top,(i=l.closest("table").find("[mdtype='table_row']")).each(function(){g.push(this.offsetTop+n)}),i.length<2||g.push(g.last()+s.find("tbody tr:last-child")[0].offsetHeight),!1}function i(e){var t,n,i;File.isLocked||(h.editor.focusCid=null,p=!0,window.getSelection().removeAllRanges(),n=S(m=f=o),t=_(n[0]).offset(),_("#typora-table-col-tracker .typora-table-data-area").offset(t).html((t=n,n=r[0].offsetWidth,"<table class='md-table' style='margin:0 ; padding:0; height:"+s.height()+"px; width:"+n+"px;'><thead><tr>"+t[0].outerHTML+"</tr></thead><tbody>"+t.toArray().map(function(e,t){return t?"<tr style='width:"+e.offsetWidth+"px; height:"+e.offsetHeight+"px;'>"+e.outerHTML+"</tr>":""}).join("")+"</tbody></table>")),F(!0),y=e.offsetX,v=e.offsetY,w=_("content").offset().left,g=[],i=s.offset().left,s.find("thead:last-of-type th").each(function(){g.push(this.offsetLeft+i)}),g.push(g.last()+s.find("thead [mdtype='table_row'] th:last-child")[0].offsetWidth))}function x(e){if(d){var t,n=e;if(d&&(_("#typora-table-row-tracker").css("top",n.clientY-v-c+document.querySelector("content").scrollTop),0<(i=g.findIndex(function(e,t){return g[t]>n.clientY}))&&--i,-1==i&&(i=g.length-1),f!=i)){var i=f=i;if(i>=g.length-1)(t=s.find("tbody tr:last-child").offset()).top+=s.find("tbody tr:last-child")[0].offsetHeight;else{i=_(s.find("tr[mdtype]")[i]);if(i[0]==l[0]||!i.length)return void C();t=i.offset()}_("#typora-table-row-insert-marker").width(s[0].offsetWidth).show().offset(t)}}else if(p){var r,o,a=e;if(p&&(_("#typora-table-col-tracker").css("left",a.clientX-y-w),r=s.scrollLeft(),0<(i=g.findIndex(function(e,t){return g[t]>a.clientX+r}))&&--i,-1==i&&(i=g.length-1),f!=i)){i=f=i;if(i>=g.length-1)(o=s.offset()).left+=s[0].offsetWidth;else{if(m==i||m+1==i)return void C();o=S(i).offset()}s.find(".ty-table-edit").remove(),_("#typora-table-col-insert-marker").height(s[0].offsetHeight).show().offset(o)}}}function C(){_(".typora-table-insert-marker").hide()}function F(e){_("#write").addClass("no-selection"),(e?(S(o).addClass("typora-on-moving"),_("#typora-table-row-tracker")):(l.addClass("typora-on-moving"),_("#typora-table-col-tracker"))).hide()}function S(e){return s.find("[mdtype='table_row']>*:nth-child("+(e+1)+")")}function k(){_("#write").removeClass("no-selection"),_("content").removeClass("prevent-scroll"),_(".typora-on-moving").removeClass("typora-on-moving"),C()}function E(e){if(d){if(d)d=!1,k(),P(),h.moveTableRow(m,f,s),T()}else if(p)p=!1,k(),P(),h.moveTableCol(m,f,s),h.showAlignCol(s),T()}function T(){p=d=!1,f=m=r=l=s=null}setTimeout(function(){c=_("content").offset().top},200),a=_("#typora-table-row-tracker"),b=_("#typora-table-col-tracker"),_(u.sessionStr).on("mouseenter click","th, td",function(e){var t,n,i;0!=(r=_(this)).children("[mdtype]").length&&(l=r.closest("tr"),s=l.closest("[mdtype='table']"),o=r.prevAll().length,i=l.offset(),t=r.offset(),n=s.offset(),a.show().offset(i).find(".typora-table-drag-area").height(l[0].offsetHeight+1),t.top=n.top,i=s.width(),b.show().offset(t).find(".typora-table-drag-area").width(Math.min(r[0].offsetWidth+1,i-(n.left-t.left)-1)))}),_(document).on("mousedown","#typora-table-row-tracker",e).on("mousedown","#typora-table-col-tracker",i).on("mousemove",x).on("mouseup",E)}updateInsertTableTouchBar(){File.isMac&&bridge.callHandler("touchBar.updateInsertTableTouchBar",[+_("#table-insert-row").val(),+_("#table-insert-col").val()])}moveTableRow(e,t,n){var i,r,o,a,s;e!=t&&e+1!=t&&(n=n||this.editor.getMarkElem().closest("[mdtype='table']"),r=(i=this.editor).selection.buildUndo(),o=M.makeEmptyCommand(r),s=(a=i.findNodeByElem(n)).getNthChild(e),i.undo.endSnap(!0),o.undo.push(M.buildReplaceUndo(a)),A.tryResetTable(a),e<--t&&t--,s.detach(),0<=t?a.getNthChild(t).addAfter(s):a.getFirstChild().addBefore(s),o.redo.push(M.buildReplaceUndo(a)),n.replaceWith(a.toHTML()),r&&(i.undo.exeCommand(r),o.redo.push(i.selection.buildUndo())),i.undo.register(o),this.showTableEdit(a))}moveTableCol(e,t,n){n=n||this.editor.getMarkElem().closest(".md-table");var i=this.editor,r=i.selection.buildUndo(),o=M.makeEmptyCommand(r),a=i.findNodeByElem(n),s=a.getFirstChild();if(i.undo.endSnap(!0),e!=t&&e+1!=t){for(o.undo.push(M.buildReplaceUndo(a)),A.tryResetTable(a),e<--t&&t--;s;){var l=s.getNthChild(e);l.detach(),0<=t?s.getNthChild(t).addAfter(l):s.getFirstChild().addBefore(l),s=s.get("after")}var c=a.get("align").splice(e,1)[0];a.get("align").splice(t+1,0,c),a.get("alignText")&&(c=a.get("alignText").splice(e,1)[0],a.get("alignText").splice(t+1,0,c)),o.redo.push(M.buildReplaceUndo(a)),n.replaceWith(a.toHTML()),r&&(i.undo.exeCommand(r),o.redo.push(i.selection.buildUndo())),i.undo.register(o)}this.showTableEdit(a)}moveRowUpOrDown(e){var t=this.editor.selection.getRangy();if(t&&!File.isLocked){t=_(t.commonAncestorContainer).closest("[mdtype='table_row']").closest("tr");if(0!=t.length){var n=t.closest("thead").length?0:t.prevAll().length+1;if(!(e&&0==n||!e&&n&&0==t.nextAll().length))return this.moveTableRow(n,e?n-1:n+2,t.closest("[mdtype='table']")),!0}}}moveColLeftOrRight(e){var t=this.editor.selection.getRangy();if(t&&!File.isLocked){t=_(t.commonAncestorContainer).closest("[mdtype='table_cell']").closest("td, th");if(0!=t.length){var n=t.prevAll().length;if(!(e&&0==n||!e&&0==t.nextAll().length))return this.moveTableCol(n,e?n-1:n+2,t.closest("[mdtype='table']")),!0}}}insertTable(){File.isLocked||document.body.classList.contains("modal-open")||(this.editor.lastCursor=this.editor.selection.buildUndo(),_("#table-insert-dialog").modal({keyboard:!0}),File.isMac&&bridge.callHandler("touchBar.showInsertTableTouchBar"),setTimeout(function(){_("#table-insert-col").focus()},500))}resizeTableEdit(e){var t=e.parent().children(".ty-table-edit"),e=e.parent()[0].getBoundingClientRect(),n=t.length&&t[0].getBoundingClientRect();t.length&&(t[0].style.marginTop="-"+n.height+"px",t[0].style.width=e.width+10+"px")}showTableEdit(e){var t=e,n=e;function i(){var e=[],t=_.localize.getString("Align Left"),n=_.localize.getString("Align Center"),i=_.localize.getString("Align Right"),r=_.localize.getString("Resize Table"),o=_.localize.getString("Delete Table"),a=_.localize.getString("More Actions","Menu"),t='<span class="btn-group btn-group-xs md-align-gp"><button type="button" class="btn btn-default md-align-left" ty-hint="'+t+'" aria-label="'+t+'"><span class="ty-icon ty-left-alignment"></span></button><button type="button" class="btn btn-default md-align-center" ty-hint="'+n+'" aria-label="'+n+'"><span class="ty-icon ty-justify-align"></span></button><button type="button" class="btn btn-default md-align-right" ty-hint="'+i+'" aria-label="'+i+'"><span class="ty-icon ty-right-alignment"></span></button></span>';return e.push("<div class='ty-table-edit md-table-edit md-tooltip-remove' contenteditable='false'>"),e.push('<span class="md-th-button btn-group-xs md-resize-table-th"><button type="button" class="btn btn-default md-resize-table" ty-hint="'+r+'" aria-label="'+r+'"><span class="ty-icon ty-menu"></span></button></span>'),e.push(t),e.push('<span class="md-th-button right-th-button btn-group-xs"><button type="button" class="btn btn-default md-delete-table" ty-hint="'+o+'" aria-label="'+o+'"><span class="ty-icon ty-delete"></span></button></span>'),e.push('<span class="md-th-button right-th-button"><button type="button" class="btn btn-default md-table-more" aria-label="'+a+'"><span class="md-table-more-label">'+a+'</span><span class="ty-icon ty-dots-v" style="margin-left:8px;"></span></button></span>'),e.push("</div>"),e.join("")}e.jquery?t=this.editor.findNodeByElem(e):n=this.editor.findElemById(t.id),(n=n.children(".md-table").length?n.children(".md-table"):n).prev(".ty-table-edit").length||(_(".ty-table-edit").remove(),i(),n.before(i())),this.resizeTableEdit(n),this.showAlignCol(n)}showAlignCol(e){var t,n=this.editor.selection.getRangy(),n=n&&_(n.commonAncestorContainer).closest("td, th");n&&n.length?(File.isMac||_(".md-table-more").show(),t=this.editor.findNodeByElem(e.closest("[cid]")).get("align"),n=n.prevAll().length,n=t[t=n],(e=e.closest("figure").find(".md-align-gp").show()).find("button").removeClass("active"),e.attr("data-col",t),"left"!==n&&"right"!==n&&"center"!==n||e.find(".md-align-"+n).addClass("active")):_(".md-table-more").hide()}keydownHandler(e){var t,n=e.keyCode||e.which;return"Tab"!==N[n]||e.ctrlKey?"Enter"===N[n]?(n=this.editor.UserOp.backspaceHandler(this.editor,null,"delSelection"),e.shiftKey?this.editor.UserOp.pasteHandler(this.editor,"<br />",!0):(File.isMacOrMacNode?e.metaKey:e.ctrlKey)?(t=this.addRow(!1,-1<this.editor.undo.commandStack.indexOf(n)),M.append(n,t)):this.moveToBelowCell(M.isEmptyCommand(n)),!1):void 0:(this.moveToNextCell(!0,e.shiftKey,void 0,!0),!1)}moveToNextCell(e,t,n,i){try{var r,o,a=this.editor.selection.getRangy(),s=this.editor.getMarkElem(t?a.startContainer:a.endContainer).closest("[mdtype='table_cell']").parent(),l=(t?s.prev():s.next()).children("[mdtype='table_cell']"),c=this.editor.selection;if(n){var d=a.getBookmark(s[0]);if(t&&0<d.start)return e?c.extendToLineEdge(!1,s[0]):c.jumpIntoElemBegin(s),this.editor.refocus(),!0;if(!t&&d.end<s.text().length)return e?c.extendToLineEdge(!0,s[0]):c.jumpIntoElemEnd(s),this.editor.refocus(),!0}return!l.length&&s.length&&(r=s.parent(),(l=(t?r.prev().children(":last"):r.next().children(":first")).children("[mdtype='table_cell']")).length||(t&&"TD"===s[0].tagName?l=r.closest("table").find("thead>tr>th:last>[mdtype='table_cell']"):t||"TH"!==s[0].tagName||(l=r.closest("table").find("tbody>tr:first>td:first>[mdtype='table_cell']")))),l.focus(),l.length?(e?n?(o=this.editor.selection.extendToLineEdge(!t,l[0],!0),t?a.setStart(o.startContainer,o.startOffset):a.setEnd(o.endContainer,o.endOffset),this.editor.selection.setRange(a)):this.editor.selection.selectAllElem(l):t?this.editor.selection.jumpIntoElemEnd(l):this.editor.selection.jumpIntoElemBegin(l),this.editor.refocus(),!0):i?(this.addRow(),!0):void 0}catch(e){}}moveToBelowCell(e,t,n){try{var i=this.editor.getMarkElem(window.getSelection().anchorNode).closest("[mdtype='table_cell']"),r=this.editor.findNodeByElem(i),o=D.getNextCellInColumn(r,t),a=o&&this.editor.findElemById(o.cid);o?a.length&&(e?this.editor.selection.selectAllElem(a):t?this.editor.selection.jumpIntoElemEnd(a):this.editor.selection.jumpIntoElemBegin(a)):this.editor.selection.moveUpOrDown()}catch(e){}}getSibling(e,t,n){return D.getSibling(e,t,n)}unfocusAll(e){e?_(".ty-table-edit").fadeOut(function(){_(".ty-table-edit").remove()}):_(".ty-table-edit").remove(),_(".typora-table-tracker").hide()}deleteRow(){D.deleteRow(this.editor)}addRow(e,t){return D.addRow(this.editor,e,t)}deleteCol(){D.deleteCol(this.editor)}addCol(e){D.addCol(this.editor,e)}copyTable(){var e,t,n=this.editor.getMarkElem(window.getSelection().anchorNode).closest(".md-table-fig");n.length&&((n=n.clone()).find(".md-tooltip-remove").remove(),n.find("td, th").attr("style",function(e,t){return"border: 1px solid rgb(204, 204, 204);min-height:1ch;min-width:4ch;"+(this.style.textAlign?"text-align:"+this.style.textAlign+";":"")}),e=n.html(),n=this.editor.UserOp.prepMarkHtml(n[0].outerHTML,editor),t=this.editor.UserOp.getMarkdownSourceFrom(n.html()),this.editor.UserOp.setClipboard(e,n.html(),t,!0))}deleteTable(e,t){var n,i,r,o;if(P(),_("#ty-tooltip").hide(),(e=e||editor.getMarkElem(window.getSelection().anchorNode).closest("[mdtype='table']")).attr("cid"))return this.editor.undo.endSnap(!0),n=this.editor.getNode(e.attr("cid")),i=editor.undo.UndoManager.makeEmptyCommand(this.editor.selection.buildUndo()),r=n.get("after"),o=n.get("before"),r||o?(M.addUndoForRemove(i,n),n.remove(),e.remove()):(i.undo.push(M.buildReplaceUndo(n)),n.set("type",a.paragraph),n.set("text",""),n.clearChildren(),e.replaceWith(n.toHTML()),i.redo.push(M.buildReplaceUndo(n))),editor.focusCid=null,r?this.editor.selection.jumpIntoElemBegin(this.editor.findElemById(r.id)):this.editor.selection.jumpIntoElemEnd(this.editor.findElemById((o||n).id)),this.editor.lastCursor=null,i.redo.push(this.editor.selection.buildUndo()),t||this.editor.undo.register(i),i}isTableEmpty(e){for(var t=0,n=e.get("children").length;t<n;t++)if(!function(e){for(var t=0,n=e.get("children").length;t<n;t++)if(e.get("children").at(t).get("text"))return;return 1}(e.get("children").at(t)))return!1;return!0}reformatTable(e){if((e=e||editor.getMarkElem(window.getSelection().anchorNode).closest("[mdtype='table']")).length){editor.undo.endSnap(!0);for(var e=this.editor.getNode(e.attr("cid")),t=editor.undo.UndoManager.makeEmptyCommand(this.editor.selection.buildUndo()),n=(t.undo.push(M.buildReplaceUndo(e)),e.set("userText",void 0),e.set("style",void 0),e.set("alignText",void 0),e.getFirstChild());n;){for(var i=n.getFirstChild();i;)i.set("marginRight",void 0),i.set("marginLeft",void 0),i=i.get("after");n=n.get("after")}t.redo.push(M.buildReplaceUndo(e)),t.redo.push(this.editor.selection.buildUndo()),this.editor.undo.register(t)}}}function P(){_("#typora-table-row-tracker, #typora-table-col-tracker").hide().find(".typora-table-data-area").html("")}D.deleteRow=function(e){e.undo.endSnap(!0),_(".md-tooltip-hide").hide();var t,n,i=e.getMarkElem(window.getSelection().anchorNode).closest("td,th"),r=e.getMarkElem(window.getSelection().anchorNode).closest("tr[mdtype='table_row']"),o=r.prevAll().length,r=e.findNodeByElem(r);if(r&&(r.get("before")||r.get("after"))){n=r.get("parent"),(t=e.undo.UndoManager.makeEmptyCommand()).undo.push(e.selection.buildUndo()),t.undo.push(e.undo.UndoManager.buildReplaceUndo(n)),A.tryResetTable(n);var a=!r.get("before");r.get("after")||o--,r.remove(),t.redo.push(e.undo.UndoManager.buildReplaceUndo(n)),e.findElemById(n.id).replaceWith(n.toHTML()),r=document.createRange();try{a||o<0?r.setStart(e.findElemById(n.id).find("thead th:nth-child("+(i.prevAll().length+1)+")>span")[0],0):r.setStart(e.findElemById(n.id).find("tbody>tr:nth-child("+(o+1)+")>td:nth-child("+(i.prevAll().length+1)+")>span")[0],0),window.getSelection().removeAllRanges(),window.getSelection().addRange(r),t.redo.push(e.selection.buildUndo())}catch(e){}e.undo.register(t),e.tableEdit.showTableEdit(n)}},D.addRow=function(e,t,n){e.undo.endSnap(!0),_(".md-tooltip-hide").hide();var i=e.getMarkElem(window.getSelection().anchorNode).closest("tr[mdtype='table_row']"),r="TBODY"==(i.parent()[0]||{}).tagName,o=r?i.prevAll().length+1:0,a=e.undo.UndoManager.makeEmptyCommand(),s=e.findNodeByElem(i);return s&&(s=s.get("parent"),a.undo.push(e.selection.buildUndo()),a.undo.push(e.undo.UndoManager.buildReplaceUndo(s)),A.tryResetTable(s),o=s.getNthChild(o),o=D.newEmptyRowAfter(t?o.get("before"):o,o.get("children").length,s,t?o:o.get("after")),r?i[t?"before":"after"](o.toHTML()):e.findElemById(s.id).replaceWith(s.toHTML()),r=e.findElemById(o.getFirstChild().id),e.selection.jumpIntoElemBegin(r),e.selection.scrollAdjust(),a.redo.push(e.undo.UndoManager.buildReplaceUndo(s)),a.redo.push(e.selection.buildUndo()),n||e.undo.register(a),e.tableEdit.showTableEdit(s)),a},D.addCol=function(e,n){e.undo.endSnap(!0),_(".md-tooltip-hide").hide();var t,i,r,o=e.getMarkElem(window.getSelection().anchorNode).closest("td, th"),a=o.find("[cid]").attr("cid"),s=o.prevAll().length;o.length&&(i=e.findNodeByElem(o.children("[cid]")).get("parent").get("parent"),(r=e.undo.UndoManager.makeEmptyCommand()).undo.push(e.selection.buildUndo()),r.undo.push(e.undo.UndoManager.buildReplaceUndo(i)),A.tryResetTable(i),i.get("children").toArray().map(function(e){var e=e.getNthChild(s),t=new A({type:A.TYPE.table_cell,text:"",marginLeft:e.get("marginLeft"),marginRight:e.get("marginRight")});n?e.addBefore(t):e.addAfter(t)}),i.get("align").splice(n?s:s+1,0,null),i.get("alignText")&&(t=A.adjustAlignText(i,0,null),i.get("align").splice(n?s:s+1,0,t)),e.findElemById(i.id).replaceWith(i.toHTML()),o=e.findElemById(a).closest("th, td"),e.selection.jumpIntoElemBegin(n?o.prev():o.next()),r.redo.push(e.undo.UndoManager.buildReplaceUndo(i)),e.undo.register(r),e.tableEdit.showTableEdit(i))},D.deleteCol=function(e){e.undo.endSnap(!0),_(".md-tooltip-hide").hide();var t=e.getMarkElem(window.getSelection().anchorNode).closest("td, th"),n=t.prevAll().length,i=t.nextAll().length,r=t.closest("tr"),r="TBODY"==r.parent()[0].tagName?r.prevAll().length+1:0;if(n||i){i=e.findNodeByElem(t.children("[cid]")).get("parent").get("parent"),(t=e.undo.UndoManager.makeEmptyCommand()).undo.push(e.selection.buildUndo()),t.undo.push(e.undo.UndoManager.buildReplaceUndo(i)),A.tryResetTable(i),i.get("children").toArray().map(function(e){e.getNthChild(n).remove()}),i.get("align").splice(n,1),i.get("alignText")&&i.get("alignText").splice(n,1),e.findElemById(i.id).replaceWith(i.toHTML());var o=document.createRange();try{r?o.setStart(e.findElemById(i.id).find("tbody>tr:nth-child("+r+")>td:nth-child("+(n+1)+")>span")[0],0):o.setStart(e.findElemById(i.id).find("thead>tr[mdtype]>th:nth-child("+(n+1)+")>span")[0],0),window.getSelection().removeAllRanges(),window.getSelection().addRange(o),t.redo.push(e.selection.buildUndo())}catch(e){}t.redo.push(e.undo.UndoManager.buildReplaceUndo(i)),e.undo.register(t),e.tableEdit.showTableEdit(i)}},D.getSibling=function(e,t,n){var i;if(A.isType(e,A.TYPE.table_cell))return i=e.get(t=t||"after"),e=e.get("parent").get(t),i||!e||n?i:"after"==t?e.getFirstChild():e.getLastChild()},D.getColumnIndex=function(e){return e.get("before")?1+D.getColumnIndex(e.get("before")):0},D.getCellAt=function(e,t){if(A.isType(e,A.TYPE.table_row)){for(var n=e.getFirstChild();0<t;)t--,n=n.get("after");return n}},D.getNextCellInColumn=function(e,t,n){if(A.isType(e,A.TYPE.table_cell))return n=n||D.getColumnIndex(e),t=t||"after",(e=e.get("parent").get(t))?D.getCellAt(e,n):void 0},D.resizeRow=function(e,t){var n,i=e.getFirstChild(),r=0,o=e.get("before"),a=o?o.getFirstChild():null,s=e.get("parent");function l(e){return 1<e.length?e[0]:e}A.tryResetTable(s);for(var c=Math.max(t,e.get("children").length);r<c;)r<t?(i||(i=new A({type:A.TYPE.table_cell,in:e.get("in"),parent:e,before:n}),a&&void 0!==a.get("marginLeft")?(i.set("marginLeft",l(a.get("marginLeft"))),i.set("marginRight",l(a.get("marginRight")))):!o&&n&&void 0!==n.get("marginLeft")&&(i.set("marginLeft",l(n.get("marginLeft"))),i.set("marginRight",l(n.get("marginRight")))),s.get("alignText")&&!s.get("alignText")[r]&&(s.get("alignText")[r]=A.adjustAlignText(s,0,null))),i=(n=i).get("after")):i&&(i=(n=i).get("after"),n.remove()),r++,a=a&&a.get("after")},D.newEmptyRowAfter=function(e,t,n,i){n=new A({type:A.TYPE.table_row,in:n.get("in"),parent:n,before:e,after:e?e.get("after"):i||null});return D.resizeRow(n,t),n},D.verify=function(e,i,t,n){var r;if(t=t||1,void 0===i&&(i=(i=e.get("children").at(0))?i.get("children").length:1),n&&1==e.get("children").length&&1==i){var o=e.get("children").at(0);o.get("children").length?n(e,o.get("children").at(0).get("text")):n(e,o.get("text"))}else{e.get("children").map(function(e){for(var t=e.get("children").length,n=t;n<i;n++)n===t&&(r=e.getLastChild()),r=new A({type:A.TYPE.table_cell,parent:e,in:e.get("in"),before:r,text:""})});for(var a=e.get("children").length;a<t;a++)D.newEmptyRowAfter(e.get("children").at(a-1),i,e);!e.get("align")&&0<i&&e.set("align",Array(+i).fill())}},A.TableEdit=D,n.exports=D}),$__System.registerDynamic("33",["11","32","34"],!0,function(e,t,n){this||self;var r=e("11"),i=e("32"),a=e("34");const o={version:2,type:"net.daringfireball.markdown",transient:!1,creatorIdentifier:"io.appmakes.Typora"};var s={NotMarkdownError:"NotMarkdown",quickGetContent:async function(e,t){var n=reqnode("fs").promises;try{var i=await n.readFile(e);return a.saveToRecover(i,"overwrite"),i.toString("utf8")}catch(e){if(t)throw e;return""}},isFileSync:function(e){try{var t=reqnode("fs").statSync(e);return t.isFile()||t.isDirectory()||/\.textbundle$/.exec(e)}catch(e){return!1}},getTextFile:function(){return File.bundle.filePath?File.isTextBundle()?File.bundle.filePath+(File.isWin?"\\":"/")+File.bundle.textFile:File.bundle.filePath:null},deletedAssetsMap:function(){return File.isTextBundle()?(File.bundle.deletedAssetsMap=File.bundle.deletedAssetsMap||{},File.bundle.deletedAssetsMap):{}},saveAssetsBeforeDelete:async function(e){var t,n,i,r,o;File.isNode&&File.isTextBundle()&&(o=reqnode("fs-extra"),t=s.deletedAssetsMap(),n=File.isWin?"\\":"/",i=File.bundle.filePath+n+"assets",r=await a.textBundleDraftFolder())&&(await o.move(i+n+e,o=r+n+"assets"+n+e,{overwrite:!0}),t[e]=o)},getAllUsedAssets:function(n){var e,i=[];return File.isTextBundle()||File.isTextPack()?((e=document.querySelector("#write")).querySelectorAll("[data-src]").forEach(e=>{var t;n?(t=r.trimPathParam(e.dataset.src),/^assets[\/\\]/.exec(t)&&i.push(t.substring("assets/".length))):(t=r.absolutePathFrom(File.editor.imgEdit.getRealSrc(e.dataset.src)),(/^assets[\/\\]/.exec(e.dataset.src)||s.shouldManageResource(t))&&i.push(t))}),e.querySelectorAll("[src]").forEach(e=>{e.closest("[data-src]")||(e=r.absolutePathFrom(e.src),(e=s.shouldManageResource(e))&&n&&i.push(e))}),e.querySelectorAll("[href]").forEach(e=>{var t,e=e.getAttribute("href");n?/^assets[\/\\]/.exec(e)&&(e=r.trimPathParam(e),i.push(e.substring("assets/".length))):(t=r.ensureAbsolutePath(File.bundle.filePath||File.bundle.originalPath,e,!0),t=r.absolutePathFrom(t),(/^assets[\/\\]/.exec(e)||s.shouldManageResource(t))&&i.push(t))}),new Set(i.map(r.decodeFromEscapedPath))):new Set(i)},findUnusedAssets:async function(){if(!File.isNode||!File.isTextBundle()||!File.bundle.filePath)return[];var t=s.getAllUsedAssets(),e=reqnode("fs").promises,n=new Set,i=File.isWin?"\\":"/",r=File.bundle.filePath+i+"assets";try{(await e.readdir(r)).forEach(e=>{t.has(r+i+e)||n.add(e)})}catch(e){}return n},recordUnusedAssets:async function(){var e=await s.findUnusedAssets();File.bundle.unusedAssets=Array.from(e||[])},removeUnusedAssets:async function(){var e;File.isNode&&File.isTextBundle()&&(e=await s.findUnusedAssets(),await Promise.all(Array.from(e).map(e=>{if(-1==(File.bundle.unusedAssets||[]).indexOf(e))return s.saveAssetsBeforeDelete(e)})))},isEmptyFile:async function(e){if(File.isNode){try{var t=reqnode("fs-extra"),n=await t.stat(e);if(!/\.textbundle$/.exec(e))return 0==n.size;if(n.isDirectory())return 0==(n=await t.stat(e+(File.isWin?"\\":"/")+"text.md")).size}catch(e){console.warn(e)}return!1}},shouldManageResource:function(e){if(e){var t=File.isWin?"\\":"/";if(File.isTextBundle()||File.isTextPack()){t=(File.isTextPack()?File.bundle.unzipFolder:File.bundle.filePath)+t+"assets"+t;if(0===e.indexOf(t)){e=e.substring(t.length);if(!/[\/\\]/.exec(e))return e}}return!1}},findTextFile:async function(e){var t,n=reqnode("fs").promises,i=reqnode("path");try{for(t of await n.readdir(e))if(/^text\./.exec(t)){var r=((r=t.match(/(?:^|\.)([^.]+)$/))[1]||"").toLowerCase();if(~File.SupportedTextFiles.indexOf(r)&&(await n.stat(i.join(e,t))).isFile())return t}return null}catch(e){}},isTextBundle(e){return!!e&&"textbundle"===i.getExtension(e).toLowerCase()},isTextPack(e){return!!e&&"textpack"===i.getExtension(e).toLowerCase()},makeTextBundleSkeleton:async function(e){var t=File.isWin?"\\":"/",n=reqnode("fs-extra");await n.ensureDir(e+t+"assets"),await n.writeFile(e+t+"info.json",JSON.stringify(o),"utf8")},async bundleAssetsIsEmpty(e){var t=File.isWin?"\\":"/",n=reqnode("fs").promises;try{return 0===(await n.readdir(e+t+"assets")).length}catch(e){}return!0},loadFile:async function(t){var n=reqnode("fs").promises,i=reqnode("path");var e,[,r]=await Promise.all([async function(){try{var e=i.join(t,"info.json");return JSON.parse(await n.readFile(e,"utf8"))}catch(e){return{}}}(),s.findTextFile(t)]);if(r)return e=await n.readFile(i.join(t,r),"utf8"),File.bundle={fileEncode:"utf8",filePath:t,savedContent:e,modifiedDate:new Date,type:File.FileType.TextBundle,textFile:r},e;throw new Error(s.NotMarkdownError)}};n.exports=s}),$__System.registerDynamic("30",["11","13","28","32","33","16","17","29"],!0,function(e,t,n){"use strict";this||self;var y=e("11"),i=e("13"),p=e("28"),f=e("32"),m=e("33"),v=e("16"),b=e("17"),g=e("29"),w=(i.Node,i.TYPE),r=(window.failImgCache=[],window.loadedImgCache=[],0),x=(window.removeLastModifyQuery=function(e){return(e||"").replace(/\?lastModify=(.+)$/,"")},function(e){return y.escapeForPreWrap(e)}),C=function(t,e){if(/%[0-9a-f]{2}/i.exec(t))return t.replace(/'/g,"%27").replace(/"/g,"%22");var n=t=(t||"").trim();try{n=decodeURI(t)}catch(e){n=t}try{/^file:/.exec(n)&&(n=n.replace(/\\/g,"/")),n=encodeURI(n).replace(/'/g,"%27").replace(/"/g,"%22")}catch(e){console.sendError("unable to process escapeURL "+t,"warning"),n=(n||"").replace(/\\/g,"/").replace(/'/g,"%27").replace(/"/g,"%22")}return e?(t=(/[#?][^\/\\\.]*$/.exec(n)||[""])[0],n.substr(0,n.length-t.length).replace(/#/g,"%23")+t):n};function F(e){switch(e){case"important":return'<svg viewBox="0 0 16 16" version="1.1" width="1em" height="1em" aria-hidden="true"><path d="M0 1.75C0 .784.784 0 1.75 0h12.5C15.216 0 16 .784 16 1.75v9.5A1.75 1.75 0 0 1 14.25 13H8.06l-2.573 2.573A1.458 1.458 0 0 1 3 14.543V13H1.75A1.75 1.75 0 0 1 0 11.25Zm1.75-.25a.25.25 0 0 0-.25.25v9.5c0 .138.112.25.25.25h2a.75.75 0 0 1 .75.75v2.19l2.72-2.72a.749.749 0 0 1 .53-.22h6.5a.25.25 0 0 0 .25-.25v-9.5a.25.25 0 0 0-.25-.25Zm7 2.25v2.5a.75.75 0 0 1-1.5 0v-2.5a.75.75 0 0 1 1.5 0ZM9 9a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z"></path></svg>';case"warning":return'<svg viewBox="0 0 16 16" version="1.1" width="1em" height="1em" aria-hidden="true"><path d="M6.457 1.047c.659-1.234 2.427-1.234 3.086 0l6.082 11.378A1.75 1.75 0 0 1 14.082 15H1.918a1.75 1.75 0 0 1-1.543-2.575Zm1.763.707a.25.25 0 0 0-.44 0L1.698 13.132a.25.25 0 0 0 .22.368h12.164a.25.25 0 0 0 .22-.368Zm.53 3.996v2.5a.75.75 0 0 1-1.5 0v-2.5a.75.75 0 0 1 1.5 0ZM9 11a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z"></path></svg>';case"tip":return'<svg viewBox="0 0 16 16" version="1.1" width="1em" height="1em" aria-hidden="true"><path d="M8 1.5c-2.363 0-4 1.69-4 3.75 0 .984.424 1.625.984 2.304l.214.253c.223.264.47.556.673.848.284.411.537.896.621 1.49a.75.75 0 0 1-1.484.211c-.04-.282-.163-.547-.37-.847a8.456 8.456 0 0 0-.542-.68c-.084-.1-.173-.205-.268-.32C3.201 7.75 2.5 6.766 2.5 5.25 2.5 2.31 4.863 0 8 0s5.5 2.31 5.5 5.25c0 1.516-.701 2.5-1.328 3.259-.095.115-.184.22-.268.319-.207.245-.383.453-.541.681-.208.3-.33.565-.37.847a.751.751 0 0 1-1.485-.212c.084-.593.337-1.078.621-1.489.203-.292.45-.584.673-.848.075-.088.147-.173.213-.253.561-.679.985-1.32.985-2.304 0-2.06-1.637-3.75-4-3.75ZM5.75 12h4.5a.75.75 0 0 1 0 1.5h-4.5a.75.75 0 0 1 0-1.5ZM6 15.25a.75.75 0 0 1 .75-.75h2.5a.75.75 0 0 1 0 1.5h-2.5a.75.75 0 0 1-.75-.75Z"></path></svg>';case"caution":return'<svg viewBox="0 0 16 16" version="1.1" width="1em" height="1em" aria-hidden="true"><path d="M4.47.22A.749.749 0 0 1 5 0h6c.199 0 .389.079.53.22l4.25 4.25c.141.14.22.331.22.53v6a.749.749 0 0 1-.22.53l-4.25 4.25A.749.749 0 0 1 11 16H5a.749.749 0 0 1-.53-.22L.22 11.53A.749.749 0 0 1 0 11V5c0-.199.079-.389.22-.53Zm.84 1.28L1.5 5.31v5.38l3.81 3.81h5.38l3.81-3.81V5.31L10.69 1.5ZM8 4a.75.75 0 0 1 .75.75v3.5a.75.75 0 0 1-1.5 0v-3.5A.75.75 0 0 1 8 4Zm0 8a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>';default:return'<svg viewBox="0 0 16 16" version="1.1" width="1em" height="1em" aria-hidden="true"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>'}}window.onImageLoadedFunc=function(e){var t,n=e.target;document.body.contains(n)&&!n.dataset.realSrc&&(t=window.removeLastModifyQuery(n.getAttribute("src"))||"").trim()&&(t=t.replace(/^wkfile:/i,"file:"),-1==loadedImgCache.indexOf(t)&&t.trim().length&&loadedImgCache.push(t),setTimeout(function(){n.setAttribute("onload","onLoadedFuncForQuickAction(event)")},10),$(n).closest(".md-image").addClass("md-img-loaded").removeClass("md-img-error"),n.dataset.localRefresh||(n.getAttribute("aftermove")&&(n.style.background="",n.style.width="",n.style.height="",n.removeAttribute("aftermove")),imagePreLoadAfterMove[t]?setTimeout(function(){delete imagePreLoadAfterMove[t]},200):File.editor.imgEdit.afterUserInsertImage(n),File.editor.imgEdit.tryAddImageToBusyLoader(n),File.editor.tryEnterBusyModeWithDelay()))},window.onImageErrorFunc=function(e){var t,e=e.target;document.body.contains(e)&&(t=window.removeLastModifyQuery(e.getAttribute("src"))||"").trim()&&(t=t.replace(/^wkfile:/i,"file:"),-1==(failImgCache=5e3<failImgCache.length?[]:failImgCache).indexOf(t)&&t.trim().length&&failImgCache.push(t),loadedImgCache.remove(t),$(e).closest(".md-image").addClass("md-img-error").removeClass("md-img-loaded"),File.editor.imgEdit.removeUploadingStyle($(e)),window.uploadImageQueue.delete(t),window.moveImageQueue.delete(t),e.setAttribute("onerror",null))},window.onLoadedFuncForQuickAction=function(e){var t,e=e.target;document.body.contains(e)&&!e.dataset.realSrc&&(t=window.removeLastModifyQuery(e.getAttribute("src")),imagePreLoadAfterMove[t]&&setTimeout(function(){delete imagePreLoadAfterMove[t]},200),$(e).closest(".md-image").addClass("md-img-loaded"),File.editor.imgEdit.afterUserInsertImage(e),File.editor.imgEdit.tryAddImageToBusyLoader(e))};var o=function(e){var t=v.sanitize(e.before+""+e.after,b.getDomPurifyConfig(b.INLINE_CONFIG)),e=(t.querySelectorAll("a").forEach(function(e){"#"==(e.getAttribute("href")||"")[0]&&e.classList.add("md-inner-link")}),t.innerHTML.replace("",e.inner));return t.innerHTML=e,""!=(void 0===t.textContent?t.innerText:t.textContent)||t.querySelector("img, svg, video, audio")?[e,e]:[e,""]};function S(e){return e=/^file:/.exec(e)&&!/\?.+/.exec(e)?e+"?lastModify="+window._lastFocusTimeMark:e}function a(e,t,n,i){var r,o,a,s=e.type,l=File.editor,c="",d=-1<t.indexOf("\n")?" md-image-multi-line ":"",u=!1;function h(e){return!u||e.length<100?e:e.substr(0,20)+"<span class='ty-text-ellipsis' data-hidden-text='"+e.substr(20,e.length-80)+"' ></span>"+e.substr(e.length-80)}if(a=(i?(a=0==i[1].trim().length,"<span class='md-image-before-src ty-focusable'>"+y.escape(i[0])+"</span><span class='md-image-src-span ty-focusable'>"+(a?"<span class='md-image-btn ty-focusable-btn md-image-input-src-btn' content='"+$.localize.getString("input image URL","Front")+"'></span><span class='md-image-btn ty-focusable-btn md-image-pick-file-btn' ty-hint='"+$.localize.getString("Select image from local file","Front")+"'></span>":h(y.escape(i[1])))+"</span><span class='md-image-after-src'>"+y.escape(i[2])+"</span>"):h(y.escape(t))).replace(/\u00a0/g," "),s==w.refimg){if(r=l.nodeMap.link_list.getHrefByRef(i=n)||"",c=" data-ref='"+x(i)+"' ",!r)return"<span md-inline='refimg' class='md-image md-no-ref"+d+"' "+c+"><span class='md-meta md-before md-content' contenteditable='true' data-hint='"+$.localize.getString("Please define image reference by \n[{0}]: http://example.png").format(x(i))+"' >"+a+"</span></span>"}else r=n;var i=null,n=(s==w.imgtag?"BODY"==(i=v.sanitize(t,b.getDomPurifyConfig(b.INLINE_CONFIG))).tagName&&(i=i.children[0]||document.createElement("img")):i=document.createElement("img"),i.setAttribute("referrerPolicy","no-referrer"),r=(r||"").trim()," data-src='"+y.escapeForPreWrap(r)+"' "),t=l.imgEdit.getRealSrc(r,void 0,!0,!0),l=y.absolutePathFrom(t),p=/^data:/.exec(t),f=/^file:\/\//i.exec(t||""),m=t,g=imagePreLoadAfterMove[t.replace(/\\/g,"/")];return e.title&&i.setAttribute("title",e.title),e.alt&&i.setAttribute("alt",e.alt),p?n=" data-is-data-src='true' ":f&&(m=m.replace(/\\/g,"/")),t=C(m,!0),f&&(t+="?lastModify="+imgLastModified),!p&&/\.svg([#?][^\/\\]*)*$/i.exec(r)&&i.classList.add("md-svg-img"),y.fromExternalPath(t)&&(t="wk"+t),f=p||-1<loadedImgCache.indexOf(m)||-1<loadedImgCache.indexOf(C(m,!0))?(i.setAttribute("src",t),i.setAttribute("onerror","onImageErrorFunc(event)"),i.setAttribute("onload","onLoadedFuncForQuickAction(event)"),"<span md-inline='"+s+"'"+n+" contenteditable='false' class='md-image md-img-loaded"+d+"' "+c+"><span class='md-meta md-before md-content' contenteditable='true'>"+a+"</span>"+i.outerHTML+"</span>"):-1<failImgCache.indexOf(m)?(i.setAttribute("src",""),"<span md-inline='"+s+"'"+n+" contenteditable='false' class='md-image md-img-error"+d+"' "+c+"><span class='md-meta md-content md-before' contenteditable='true'>"+a+"</span>"+i.outerHTML+"</span>"):(e="",!(i.getAttribute("style")||"").trim().length&&g&&(i.setAttribute("style",i.getAttribute("style")+";"+g.size+";background-image:url('"+C(g.src,!0)+"');"),i.setAttribute("aftermove","true"),e=" md-img-loaded"),e+=d,i.setAttribute("src",t),i.setAttribute("onerror","onImageErrorFunc(event)"),i.setAttribute("onload","onImageLoadedFunc(event)"),"<span md-inline='"+s+"'"+n+" contenteditable='false' class='md-image"+e+"' data-src='"+t+"' "+c+"><span class='md-meta md-before md-content' contenteditable='true'>"+a+"</span>"+i.outerHTML+"</span>"),s==w.image&&-1==failImgCache.indexOf(y.wkfile2file(t))&&(window.uploadImageQueue.has(l)?(k(o=$(f),l,!1),f=o[0].outerHTML):window.moveImageQueue.has(l)&&(k(o=$(f),l,!0),f=o[0].outerHTML)),f}function k(e,t,n,i){function r(){e.addClass(n?"md-img-loaded md-on-moving":"md-img-loaded md-on-uploading"),e.append($("#typora-uploading-image-templ").html().replace(/\s*\n\s*/g,""))}i?setTimeout(function(){(n?moveImageQueue:uploadImageQueue).has(t)&&document.body.contains(e[0])&&r()},1e3):r(),e.attr("data-origin-path",t)}window.addDateQuery=S,t.applyUploadingStyle=k,t.decorateAsExport=function(e,i,t){var n,r,o,a,s;function l(e,t){if(e=(e||"").trim(),t&&!y.isFullUrl(e))return"http://"+e;if(i.forPrint){var n;if(e.match(/^#/))return((t=p.findAnchorElem(e,!0))||[]).length?(File.isMac?"at://":"#header-")+t.attr("cid"):e;if(!y.isFullUrl(e)&&(e=e.trim().replace(/([#?][^.]+)$/,""),File.isNode))return t=reqnode("fs-plus"),n=reqnode("path").resolve(f.getCurrentFileFolderPath()+"/",e),m.isFileSync(n)?"file://"+n:t.isFileSync(n+".md")?"file://"+n+".md":t.isFileSync(n+".markdown")?"file://"+n+".markdown":t.isFileSync(n+".pdf")?"file://"+n+".pdf":"http://"+e}else if(e.match(/^#/))return p.normalizeAnchor(e,i.anchorList,!i.noStyle);return e}switch(e.type){case w.strong:return"<strong>"+e.inner+"</strong>";case w.em:return"<em>"+e.inner+"</em>";case w.plain:return i.noStyle?y.escape(e.text):"<span>"+y.escape(e.text)+"</span>";case w.softbreak:return"\n";case w.code:return n=i.forPrint&&File.isNode?(i.defaultFont||(i.defaultFont=window.getComputedStyle(File.editor.writingArea).fontFamily||"initial"),"<code>"+e.text.trim().split(/([\-;]+)/).map(function(e){return e?y.escape(e,!1,!0):""}).join("")+"</code>"):"<code>"+y.escape(e.text.trim(),!1,!0)+"</code>";case w.del:return"<del>"+e.inner+"</del>";case w.autolink:case w.url:return"<a href='"+x(l(e.href,!0))+"' target='_blank' class='url'>"+e.text+"</a>";case w.tag:if(/^<img/.test(e.text)&&i.forPrint){if(a=(/src\s*=\s*(['"])((.|\n)*?)\1/.exec(e.text)||[])[2])return a=File.editor.imgEdit.getRealSrc(a,void 0,!0,!0).replace(/^file:\/\/\/?/i,"file:///").replace(/\\/g,"/"),e.text.replace(/(\ssrc\s*=\s*)(['"])([^"']*)(\2)/,"$1$2"+a+"$4");if(a=(/src\s*=\s*([^\s'"]+)(\s|$)/.exec(e.text)||[])[1])return a=File.editor.imgEdit.getRealSrc(a,void 0,!0,!0).replace(/^file:\/\/\/?/i,"file:///").replace(/\\/g,"/"),e.text.replace(/src\s*=\s*([^\s'"]+)(\s|$)/,"src='"+a+"' ")}return e.text;case w.br:case w.imgtag:case w.ruby:return b.buildHTMLForExport(e.text,File.editor,i.forPrint);case w.html_inline:return b.buildHTMLForExport(e.before+e.after,File.editor,i.forPrint);case w.link:return"<a href='"+x(l(e.href))+"'"+(e.title?" title='"+x(e.title)+"'":"")+">"+e.inner+"</a>";case w.image:return a=i.forPrint?File.editor.imgEdit.getRealSrc(e.href):e.href,n=i.forPrint&&-1<failImgCache.indexOf(a)?"":(a=i.forPrint?S(C(a,!0)):x(a),d=$("<img src='"+a+"' referrerPolicy='no-referrer' />")[0],e.alt&&d.setAttribute("alt",e.alt),e.title&&d.setAttribute("title",e.title),d.outerHTML),n=!i.noStyle&&e.onlyChild?"<span class='md-image'>"+n+"</span>":n;case w.footnote:return(d=i.nodeMap.foot_list.getNodeByRef(e.text))?(0==(s=i.footnoteList.indexOf(e.text)+1)&&(i.footnoteList.push(e.text),s=i.footnoteList.length),"<sup class='md-footnote'><a href='#dfref-footnote-"+(d=i.appendFootnote(d,s))+"' name='ref-footnote-"+d+"'>"+s+"</a></sup>"):i.noStyle?y.escape(e.text):"<span>[^"+y.escape(e.text)+"]</span>";case w.escape:return i.noStyle?y.escape(e.text):"<span>"+y.escape(e.text)+"</span>";case w.refimg:return o=(r=i.nodeMap.link_list.getNodeByRef(e.ref||e.text))?x(r.get("title")):void 0,void 0!==(a=r?r.get("href"):void 0)?(a=i.forPrint?S(C(File.editor.imgEdit.getRealSrc(a),!0)):x(a),n="<img alt='"+e.text+"' src='"+a+"'"+(o?" title='"+o+"'":"")+" referrerPolicy='no-referrer'></img>",i.noStyle||(n="<span class='md-image'>"+n+"</span>"),i.forPrint&&-1<failImgCache.indexOf(a)?"":n):"!["+e.inner+"]["+y.escape(e.ref)+"]";case w.reflink:return a=(r=i.nodeMap.link_list.getNodeByRef(e.ref||e.text))?x(l(r.get("href"))):void 0,o=r?x(r.get("title")):void 0,void 0!==a?"<a href='"+a+"' target='_blank'"+(o?" title='"+o+"'":"")+">"+e.inner+"</a>":"["+e.inner+"]["+y.escape(e.ref)+"]";case w.attr:return"";case w.emoji:return File.option.monocolorEmoji?"<span class='md-emoji'>"+e.inner+"</span>":e.inner;case w.inline_math:if(i.noStyle&&"latex"==File.option.mathFormatOnCopy)return(e.pattern||"$")+e.text+(e.pattern||"$");else{var c=e.text;var d=t;var u=!i.noStyle&&!i.forPrint&&!i.forImage;c=c.replace(/\u200B/g,"");var h=svgCache[c];h?u||(h=$("<span>"+h+"</span>").find("mjx-assistive-mml").remove().end().html()):d&&d.cid&&document.querySelectorAll("[cid='"+d.cid+"'] .md-inline-math.math-jax-postprocess").forEach(function(e){var t;h||((e.querySelector("script")||{}).innerText||"").replace(/\u200B/g,"").trim()==c&&(t=(e=e.querySelector(".md-inline-math-container").cloneNode(!0)).querySelector("mjx-assistive-mml"),!u&&t&&t.remove(),svgCache[c]=g.processExportedSVG(e.innerHTML,!0),h=svgCache[c])});return h||"<span class='math-in-toc'>$"+y.escapeForPreWrap(c)+"$</span>";return}case w.subscript:return"<sub>"+e.inner+"</sub>";case w.superscript:return"<sup>"+e.inner+"</sup>";case w.underline:return"<u>"+e.inner+"</u>";case w.alert_text:return i.noStyle?`<strong class='md-alert-text md-alert-text-${e.inner}'>${y.capitalize(e.inner)}</strong><br>`:`<span class='md-alert-text md-alert-text-${e.inner}'>${F(e.inner)}${y.capitalize(e.inner)}</span><br>`;case w.tab:return i.noStyle?e.inner:"<span>"+e.inner+"</span>";case w.linebreak:return"<br/>";case w.highlight:return"<mark>"+e.inner+"</mark>";default:return e.inner||e.text||""}},t.decorate=function(e,t){switch(e.type){case"block":return"<span class='md-block-like'>"+e.inner+"</span>";case w.heading:return"<span class='md-block-like'><span class='md-blockmeta'>"+e.meta_before+"</span><span class='md-header-span'>"+e.inner+"</span>"+(e.meta_after?"<span class='md-blockmeta'>"+e.meta_after+"</span>":"")+"</span>";case w.paragraph:return e.inner;case w.blockquote:return"<span class='md-block-like'><span class='md-blockmeta'>"+e.pattern+"</span>"+e.inner+"</span>";case w.fences:return"<span class='md-block-like' mdlike='"+e.type+"'><span class='md-blockmeta'>"+e.pattern+"</span><span class='md-lang'>"+y.escape(e.lang)+"</span></span>";case w.def_footnote:return"<span class='md-block-like' mdlike='"+e.type+"'><span class='md-blockmeta'>[^</span>"+e.ref+"<span class='md-blockmeta'>]:"+e.pattern+"</span><span class='md-def-content'>"+e.inner+"</span></span>";case w.def_link:return"<span class='md-block-like' mdlike='"+e.type+"'><span class='md-blockmeta'>[</span>"+e.ref+"<span class='md-blockmeta'>]:"+e.pattern+"</span><span class='md-def-content'>"+e.inner+"</span></span>";case w.strong:return"<span md-inline='strong' class='md-pair-s "+(e.inner?"":"md-empty")+"'><span class='md-meta md-before'>"+e.pattern+"</span><strong>"+e.inner+"</strong><span class='md-meta md-after'>"+e.pattern+"</span></span>";case w.em:return"<span md-inline='em' class='md-pair-s "+(e.inner?"":"md-empty")+"'><span class='md-meta md-before'>"+e.pattern+"</span><em>"+e.inner+"</em><span class='md-meta md-after'>"+e.pattern+"</span></span>";case w.highlight:return"<span md-inline='highlight' class='md-pair-s'><span class='md-meta md-before'>==</span><mark>"+e.inner+"</mark><span class='md-meta md-after'>==</span></span>";case w.plain:return"<span md-inline='plain' class='md-plain'>"+y.escape(e.text)+"</span>";case w.code:var n=(e.text.match(/^\s+/)||"")[0]||"",i=(e.text.substr(n.length).match(/\s+$/)||"")[0]||"";return`<span md-inline='code' spellcheck='${File.option.spellcheckForCodeAndLink||!1}' class='md-pair-s'><span class='md-meta md-before'>`+e.pattern+n+"</span><code>"+y.escapeForPreWrap(e.text.trim(),!1,!0)+"</code><span class='md-meta md-after'>"+i+e.pattern+"</span></span>";case w.del:return"<span md-inline='del' class='md-pair-s'><span class='md-meta md-before'>"+e.pattern+"</span><del>"+e.inner+"</del><span class='md-meta md-after'>"+e.pattern+"</span></span>";case w.autolink:return`<span md-inline='autolink' class='md-link' spellcheck='${File.option.spellcheckForCodeAndLink||!1}'><span class='md-meta md-before'>&lt;</span><a href='${C(e.href)}' class="md-url">${y.escape(e.text)}</a><span class='md-meta md-after'>&gt;</span></span>`;case w.url:return`<span md-inline='url' class='md-link md-pair-s' spellcheck='${File.option.spellcheckForCodeAndLink||!1}'><a href='${C(e.href)}'>${y.escape(e.text)}</a></span>`;case w.br:return"<span md-inline='br' class='md-br md-tag' spellcheck='false'><span class='md-br-content md-raw-inline'>"+y.escapeForPreWrap(e.text,!1,!0)+"</span></span>";case w.comment:return`<span md-inline='comment' class='md-comment' spellcheck='${File.option.spellcheckForCodeAndLink||!1}'>`+y.escapeForPreWrap(e.text,!1,!0)+"</span>";case w.underline:return"<span md-inline='underline' class='md-pair-s'><span class='md-meta md-before md-raw-inline'>&lt;u&gt;</span><u>"+e.inner+"</u><span class='md-meta md-after md-raw-inline'>&lt;/u&gt;</span></span>";case w.alert_text:return`<span md-inline='alert_text' class='md-alert-text md-alert-text-${e.inner}'>`+`<span class='md-alert-text-container' data-text="${e.inner}">${F(e.inner)}</span>`+"<span class='md-meta md-after md-content' contenteditable='true'>"+e.text+"</span></span>";case w.ruby:return"<span md-inline='ruby' class='md-ruby'><span contenteditable='false' class='md-ruby-container'>"+v.sanitize(e.text,b.getDomPurifyConfig(b.INLINE_CONFIG)).innerHTML+"</span><span class='md-meta md-content md-raw-inline'>"+y.escape(e.text)+"</span></span>";case w.html_inline:n=[""];return(n=e.isMeta?n:o(e))[1]?`<span md-inline='html_inline' class='md-html-inline' spellcheck='${File.option.spellcheckForCodeAndLink||!1}'>`+"<span class='md-meta md-before md-raw-inline'>"+y.escapeForPreWrap(e.before,!1,!0)+"</span>"+n[0]+"<span class='md-meta md-after md-raw-inline'>"+y.escapeForPreWrap(e.after,!1,!0)+"</span></span>":"<span md-inline='html_inline' class='md-html-inline md-raw-inline' spellcheck='false'>"+(n[0]||"")+"<span class='md-raw-inline'>"+y.escapeForPreWrap(e.before,!1,!0)+e.inner+y.escapeForPreWrap(e.after,!1,!0)+"</span></span>";case w.tag:return"<span md-inline='tag' class='md-tag md-raw-inline' spellcheck='false'>"+y.escapeForPreWrap(e.text,!1,!0)+"</span>";case w.atag:return"<span md-inline='atag' class='md-atag'><span class='md-meta md-before md-raw-inline'>"+y.escapeForPreWrap(e.left,!1,!0)+"</span><a href='"+C(e.href)+"' "+("#"==e.href[0]?"class='md-inner-link'":"")+">"+e.inner+"</a><span class='md-meta md-after md-raw-inline'>"+y.escapeForPreWrap(e.right,!1,!0)+"</span></span>";case w.link:i=e.meta.replace(/^\((<?(?:\([^)]*\)|[^()])*?>?)(?:([ \t]+)((['"])((?:.|\n)*?)\4))?([ \t]*)\)/,function(e,t,n,i,r,o,a){return`(</span><span class='md-content md-url' spellcheck='${File.option.spellcheckForCodeAndLink||!1}' >`+y.escape(t)+"</span><span class='md-meta'>"+y.escape(n)+"</span><span class='md-content md-link-title'>"+y.escape(i)+"</span><span class='md-meta md-after'>"+y.escape(a)+")</span>"});return"<span md-inline='link' class='md-meta-i-c "+(e.inner?"":"md-empty-link")+" md-link'><span class='md-meta md-before md-meta-i'>[</span><a "+("#"==e.href[0]?"class='md-inner-link'":"")+" href='"+C(e.href)+"' "+(e.title?"title='"+y.escapeForPreWrap(e.title)+"' ":"")+">"+e.inner+"</a><span class='md-meta md-before'>]"+i+"</span>";case w.imgtag:return a(e,e.text,e.href);case w.refimg:return a(e,e.markdown,e.ref||e.text);case w.image:return a(e,e.markdown,e.href,e.components);case w.footnote:return"<sup md-inline='footnote' class='md-footnote' data-ref='"+y.escape(e.text.trim()).toLowerCase()+"'><span class='md-meta md-before '>[^</span><span class='md-text' spellcheck='false'>"+e.inner+"</span><span class='md-meta md-after'>]</span></sup>";case w.escape:return"<span md-inline='escape'><span class='md-meta md-before'>\\</span>"+y.escape(e.text)+"</span>";case w.reflink:return"<span md-inline='reflink' class='md-link md-meta-i-c'><span class='md-meta md-before md-meta-i'>[</span><a data-ref='"+y.escapeForPreWrap(e.ref||e.text)+"' href='#'>"+e.inner+"</a><span class='md-meta md-after'>]</span><span class='md-meta md-before'>[</span><span class='md-content' spellcheck='false'>"+e.ref+"</span><span class='md-meta md-after'>]</span></span>";case w.attr:return"<span md-inline='attr' class='md-attr'>"+y.escape(e.text)+"</span>";case w.emoji:return"<span md-inline='emoji' data-content='"+e.text+"' class='md-emoji' ><span class='md-emoji-control-ch'>​</span><span data-emoji='"+e.inner+"' class='md-emoji-span'></span><span class='md-meta'>:"+e.text+":</span><span class='md-emoji-control-ch'>​</span></span>";case w.inline_math:return r++,e.text=e.text.replace(/\u200B+/g,""),!/^\$+$/.exec(e.text)&&svgCache[e.text]?`<span class='md-inline-math math-jax-postprocess' md-inline='inline_math' id='ty-mjx-${r}'><span class='md-before md-meta'>${e.pattern}</span><span class='md-inline-math-container'>${svgCache[e.text]}</span><span class='md-after md-meta'>${e.pattern}</span><span class='md-math-after-sym'></span></span>`:((n=document.createElement("script")).textContent=e.text,n.setAttribute("type","math/tex"),`<span class='md-inline-math math-jax-preprocess' md-inline='inline_math' id='ty-mjx-${r}'><span class='md-before md-meta'>`+e.pattern+"</span><span class='md-math-tex md-inline-math-container'>"+$(n.outerHTML)[0].outerHTML+"</span><span class='md-after md-meta'>"+e.pattern+"</span><span class='md-math-after-sym'></span></span>");case w.subscript:return"<sub md-inline='subscript' class='md-pair-s'><span class='md-meta md-before'>~</span>"+e.inner+"<span class='md-meta md-after'>~</span></sub>";case w.superscript:return"<sup md-inline='superscript' class='md-pair-s'><span class='md-meta md-before'>^</span>"+e.inner+"<span class='md-meta md-after'>^</span></sup>";case w.html_entity:return"<span md-inline='html_entity' data-content='"+e.text+"' class='md-entity'><span class='md-meta' spellcheck='false'>"+y.escape(e.text)+"</span></span>";case w.pants:i="",n=e.inner;return/^ /.exec(e.inner)?(e.inner=e.inner.trim(),i="md-pants-space-before"):/ $/.exec(e.inner)&&(e.inner=" ",i="md-pants-space-after"),"<span md-inline='pants' data-text='"+x(e.text)+"' data-content='"+x(n)+"' class='md-pants "+i+"' data-desc='"+e.desc+"'><span class='md-meta-none' contenteditable='false'>"+(e.meta||"")+"</span>"+e.inner+"</span>";case w.tab:return"<span md-inline='tab' class='md-tab'>"+e.inner+"</span>";case w.linebreak:return"<span md-inline='linebreak' class='md-linebreak'>  <span class='md-linebreak-mark'></span>\n"+(e.isLast?"<br/>":"")+"</span>";case w.emptyline:return File.option.ignoreLineBreak?"<span md-inline='softbreak' class='md-softbreak md-softbreak-emptyline'><span contenteditable='false'></span>\n</span>":"&#10;<span md-inline='emptyline' class='md-emptyline'>&#10;</span>";case w.softbreak:return"<span md-inline='softbreak' class='md-softbreak'>"+(File.option.ignoreLineBreak?"<span contenteditable='false'></span>":"")+"\n</span>";default:return console.sendError("unknow type "+e.type),e.text}},t.decorateImage=a}),$__System.registerDynamic("49",["e"],!0,function(e,t,n){"use strict";this||self;var i=e("e");class s{constructor(e){this.editor=e,setTimeout(function(){i.getScript("./appsrc/editor/EmojiSearchMap.js",function(){var e,t=window.EmojiSearchMap;for(e in s.data)t[e]||(t[e]=[e])})},1e3)}autoCompleteOption(){return{search:this.search,render:(e,t)=>"<li class='"+(t?"active":"")+"' data-content='"+e+"' ><span class='ty-emoji-icon'>"+s.data[e.replace(/:/g,"")]+"</span><span class='emoji-meta'>"+e+"</span></li>"}}search(t,e){if(!t)return[];var n=Object.keys(s.data),i=(n.sort(),n.filter(e=>0===e.indexOf(t)));try{var r,o=new RegExp("(^"+t+")|(_"+t+")|(-"+t+")","i"),i=i.concat(n.filter(e=>-1==i.indexOf(e)&&o.exec(e)&&e!==t))}catch(e){}if(s.data[t]&&i.unshift(t),r=(window.EmojiSearchMap||{})[t])for(var a=0;a<r.length;a++)-1==i.indexOf(r[a])&&i.push(r[a]);return i.map(e=>":"+e+":")}}s.data={100:"💯",1234:"🔢",grinning:"😀",smiley:"😃",smile:"😄",grin:"😁",laughing:"😆",satisfied:"😆",sweat_smile:"😅",joy:"😂",rofl:"🤣",relaxed:"☺️",blush:"😊",innocent:"😇",slightly_smiling_face:"🙂",upside_down_face:"🙃",wink:"😉",relieved:"😌",heart_eyes:"😍",kissing_heart:"😘",kissing:"😗",kissing_smiling_eyes:"😙",kissing_closed_eyes:"😚",yum:"😋",stuck_out_tongue_winking_eye:"😜",stuck_out_tongue_closed_eyes:"😝",stuck_out_tongue:"😛",money_mouth_face:"🤑",hugs:"🤗",nerd_face:"🤓",sunglasses:"😎",clown_face:"🤡",cowboy_hat_face:"🤠",smirk:"😏",unamused:"😒",disappointed:"😞",pensive:"😔",worried:"😟",confused:"😕",slightly_frowning_face:"🙁",frowning_face:"☹️",persevere:"😣",confounded:"😖",tired_face:"😫",weary:"😩",triumph:"😤",angry:"😠",rage:"😡",pout:"😡",no_mouth:"😶",neutral_face:"😐",expressionless:"😑",hushed:"😯",frowning:"😦",anguished:"😧",open_mouth:"😮",astonished:"😲",dizzy_face:"😵",flushed:"😳",scream:"😱",fearful:"😨",cold_sweat:"😰",cry:"😢",disappointed_relieved:"😥",drooling_face:"🤤",sob:"😭",sweat:"😓",sleepy:"😪",sleeping:"😴",roll_eyes:"🙄",thinking:"🤔",lying_face:"🤥",grimacing:"😬",zipper_mouth_face:"🤐",nauseated_face:"🤢",sneezing_face:"🤧",mask:"😷",face_with_thermometer:"🤒",face_with_head_bandage:"🤕",smiling_imp:"😈",imp:"👿",japanese_ogre:"👹",japanese_goblin:"👺",hankey:"💩",poop:"💩",shit:"💩",ghost:"👻",skull:"💀",skull_and_crossbones:"☠️",alien:"👽",space_invader:"👾",robot:"🤖",jack_o_lantern:"🎃",smiley_cat:"😺",smile_cat:"😸",joy_cat:"😹",heart_eyes_cat:"😻",smirk_cat:"😼",kissing_cat:"😽",scream_cat:"🙀",crying_cat_face:"😿",pouting_cat:"😾",open_hands:"👐",raised_hands:"🙌",clap:"👏",pray:"🙏",handshake:"🤝","+1":"👍",thumbsup:"👍","-1":"👎",thumbsdown:"👎",fist_oncoming:"👊",facepunch:"👊",punch:"👊",fist_raised:"✊",fist:"✊",fist_left:"🤛",fist_right:"🤜",crossed_fingers:"🤞",v:"✌️",metal:"🤘",ok_hand:"👌",point_left:"👈",point_right:"👉",point_up_2:"👆",point_down:"👇",point_up:"☝️",hand:"✋",raised_hand:"✋",raised_back_of_hand:"🤚",raised_hand_with_fingers_splayed:"🖐",vulcan_salute:"🖖",wave:"👋",call_me_hand:"🤙",muscle:"💪",middle_finger:"🖕",fu:"🖕",writing_hand:"✍️",selfie:"🤳",nail_care:"💅",ring:"💍",lipstick:"💄",kiss:"💋",lips:"👄",tongue:"👅",ear:"👂",nose:"👃",footprints:"👣",eye:"👁",eyes:"👀",speaking_head:"🗣",bust_in_silhouette:"👤",busts_in_silhouette:"👥",baby:"👶",boy:"👦",girl:"👧",man:"👨",woman:"👩",blonde_woman:"👱‍♀",blonde_man:"👱",person_with_blond_hair:"👱",older_man:"👴",older_woman:"👵",man_with_gua_pi_mao:"👲",woman_with_turban:"👳‍♀",man_with_turban:"👳",policewoman:"👮‍♀",policeman:"👮",cop:"👮",construction_worker_woman:"👷‍♀",construction_worker_man:"👷",construction_worker:"👷",guardswoman:"💂‍♀",guardsman:"💂",female_detective:"🕵️‍♀️",male_detective:"🕵",detective:"🕵",woman_health_worker:"👩‍⚕",man_health_worker:"👨‍⚕",woman_farmer:"👩‍🌾",man_farmer:"👨‍🌾",woman_cook:"👩‍🍳",man_cook:"👨‍🍳",woman_student:"👩‍🎓",man_student:"👨‍🎓",woman_singer:"👩‍🎤",man_singer:"👨‍🎤",woman_teacher:"👩‍🏫",man_teacher:"👨‍🏫",woman_factory_worker:"👩‍🏭",man_factory_worker:"👨‍🏭",woman_technologist:"👩‍💻",man_technologist:"👨‍💻",woman_office_worker:"👩‍💼",man_office_worker:"👨‍💼",woman_mechanic:"👩‍🔧",man_mechanic:"👨‍🔧",woman_scientist:"👩‍🔬",man_scientist:"👨‍🔬",woman_artist:"👩‍🎨",man_artist:"👨‍🎨",woman_firefighter:"👩‍🚒",man_firefighter:"👨‍🚒",woman_pilot:"👩‍✈",man_pilot:"👨‍✈",woman_astronaut:"👩‍🚀",man_astronaut:"👨‍🚀",woman_judge:"👩‍⚖",man_judge:"👨‍⚖",mrs_claus:"🤶",santa:"🎅",princess:"👸",prince:"🤴",bride_with_veil:"👰",man_in_tuxedo:"🤵",angel:"👼",pregnant_woman:"🤰",bowing_woman:"🙇‍♀",bowing_man:"🙇",bow:"🙇",tipping_hand_woman:"💁",information_desk_person:"💁",sassy_woman:"💁",tipping_hand_man:"💁‍♂",sassy_man:"💁‍♂",no_good_woman:"🙅",no_good:"🙅",ng_woman:"🙅",no_good_man:"🙅‍♂",ng_man:"🙅‍♂",ok_woman:"🙆",ok_man:"🙆‍♂",raising_hand_woman:"🙋",raising_hand:"🙋",raising_hand_man:"🙋‍♂",woman_facepalming:"🤦‍♀",man_facepalming:"🤦‍♂",woman_shrugging:"🤷‍♀",man_shrugging:"🤷‍♂",pouting_woman:"🙎",person_with_pouting_face:"🙎",pouting_man:"🙎‍♂",frowning_woman:"🙍",person_frowning:"🙍",frowning_man:"🙍‍♂",haircut_woman:"💇",haircut:"💇",haircut_man:"💇‍♂",massage_woman:"💆",massage:"💆",massage_man:"💆‍♂",business_suit_levitating:"🕴",dancer:"💃",man_dancing:"🕺",dancing_women:"👯",dancers:"👯",dancing_men:"👯‍♂",walking_woman:"🚶‍♀",walking_man:"🚶",walking:"🚶",running_woman:"🏃‍♀",running_man:"🏃",runner:"🏃",running:"🏃",couple:"👫",two_women_holding_hands:"👭",two_men_holding_hands:"👬",couple_with_heart_woman_man:"💑",couple_with_heart:"💑",couple_with_heart_woman_woman:"👩‍❤️‍👩",couple_with_heart_man_man:"👨‍❤️‍👨",couplekiss_man_woman:"💏",couplekiss_woman_woman:"👩‍❤️‍💋‍👩",couplekiss_man_man:"👨‍❤️‍💋‍👨",family_man_woman_boy:"👪",family:"👪",family_man_woman_girl:"👨‍👩‍👧",family_man_woman_girl_boy:"👨‍👩‍👧‍👦",family_man_woman_boy_boy:"👨‍👩‍👦‍👦",family_man_woman_girl_girl:"👨‍👩‍👧‍👧",family_woman_woman_boy:"👩‍👩‍👦",family_woman_woman_girl:"👩‍👩‍👧",family_woman_woman_girl_boy:"👩‍👩‍👧‍👦",family_woman_woman_boy_boy:"👩‍👩‍👦‍👦",family_woman_woman_girl_girl:"👩‍👩‍👧‍👧",family_man_man_boy:"👨‍👨‍👦",family_man_man_girl:"👨‍👨‍👧",family_man_man_girl_boy:"👨‍👨‍👧‍👦",family_man_man_boy_boy:"👨‍👨‍👦‍👦",family_man_man_girl_girl:"👨‍👨‍👧‍👧",family_woman_boy:"👩‍👦",family_woman_girl:"👩‍👧",family_woman_girl_boy:"👩‍👧‍👦",family_woman_boy_boy:"👩‍👦‍👦",family_woman_girl_girl:"👩‍👧‍👧",family_man_boy:"👨‍👦",family_man_girl:"👨‍👧",family_man_girl_boy:"👨‍👧‍👦",family_man_boy_boy:"👨‍👦‍👦",family_man_girl_girl:"👨‍👧‍👧",womans_clothes:"👚",shirt:"👕",tshirt:"👕",jeans:"👖",necktie:"👔",dress:"👗",bikini:"👙",kimono:"👘",high_heel:"👠",sandal:"👡",boot:"👢",mans_shoe:"👞",shoe:"👞",athletic_shoe:"👟",womans_hat:"👒",tophat:"🎩",mortar_board:"🎓",crown:"👑",rescue_worker_helmet:"⛑",school_satchel:"🎒",pouch:"👝",purse:"👛",handbag:"👜",briefcase:"💼",eyeglasses:"👓",dark_sunglasses:"🕶",closed_umbrella:"🌂",open_umbrella:"☂️",dog:"🐶",cat:"🐱",mouse:"🐭",hamster:"🐹",rabbit:"🐰",fox_face:"🦊",bear:"🐻",panda_face:"🐼",koala:"🐨",tiger:"🐯",lion:"🦁",cow:"🐮",pig:"🐷",pig_nose:"🐽",frog:"🐸",monkey_face:"🐵",see_no_evil:"🙈",hear_no_evil:"🙉",speak_no_evil:"🙊",monkey:"🐒",chicken:"🐔",penguin:"🐧",bird:"🐦",baby_chick:"🐤",hatching_chick:"🐣",hatched_chick:"🐥",duck:"🦆",eagle:"🦅",owl:"🦉",bat:"🦇",wolf:"🐺",boar:"🐗",horse:"🐴",unicorn:"🦄",bee:"🐝",honeybee:"🐝",bug:"🐛",butterfly:"🦋",snail:"🐌",shell:"🐚",beetle:"🐞",ant:"🐜",spider:"🕷",spider_web:"🕸",turtle:"🐢",snake:"🐍",lizard:"🦎",scorpion:"🦂",crab:"🦀",squid:"🦑",octopus:"🐙",shrimp:"🦐",tropical_fish:"🐠",fish:"🐟",blowfish:"🐡",dolphin:"🐬",flipper:"🐬",shark:"🦈",whale:"🐳",whale2:"🐋",crocodile:"🐊",leopard:"🐆",tiger2:"🐅",water_buffalo:"🐃",ox:"🐂",cow2:"🐄",deer:"🦌",dromedary_camel:"🐪",camel:"🐫",elephant:"🐘",rhinoceros:"🦏",gorilla:"🦍",racehorse:"🐎",pig2:"🐖",goat:"🐐",ram:"🐏",sheep:"🐑",dog2:"🐕",poodle:"🐩",cat2:"🐈",rooster:"🐓",turkey:"🦃",dove:"🕊",rabbit2:"🐇",mouse2:"🐁",rat:"🐀",chipmunk:"🐿",feet:"🐾",paw_prints:"🐾",dragon:"🐉",dragon_face:"🐲",cactus:"🌵",christmas_tree:"🎄",evergreen_tree:"🌲",deciduous_tree:"🌳",palm_tree:"🌴",seedling:"🌱",herb:"🌿",shamrock:"☘️",four_leaf_clover:"🍀",bamboo:"🎍",tanabata_tree:"🎋",leaves:"🍃",fallen_leaf:"🍂",maple_leaf:"🍁",mushroom:"🍄",ear_of_rice:"🌾",bouquet:"💐",tulip:"🌷",rose:"🌹",wilted_flower:"🥀",sunflower:"🌻",blossom:"🌼",cherry_blossom:"🌸",hibiscus:"🌺",earth_americas:"🌎",earth_africa:"🌍",earth_asia:"🌏",full_moon:"🌕",waning_gibbous_moon:"🌖",last_quarter_moon:"🌗",waning_crescent_moon:"🌘",new_moon:"🌑",waxing_crescent_moon:"🌒",first_quarter_moon:"🌓",moon:"🌔",waxing_gibbous_moon:"🌔",new_moon_with_face:"🌚",full_moon_with_face:"🌝",sun_with_face:"🌞",first_quarter_moon_with_face:"🌛",last_quarter_moon_with_face:"🌜",crescent_moon:"🌙",dizzy:"💫",star:"⭐️",star2:"🌟",sparkles:"✨",zap:"⚡️",fire:"🔥",boom:"💥",collision:"💥",comet:"☄",sunny:"☀️",sun_behind_small_cloud:"🌤",partly_sunny:"⛅️",sun_behind_large_cloud:"🌥",sun_behind_rain_cloud:"🌦",rainbow:"🌈",cloud:"☁️",cloud_with_rain:"🌧",cloud_with_lightning_and_rain:"⛈",cloud_with_lightning:"🌩",cloud_with_snow:"🌨",snowman_with_snow:"☃️",snowman:"⛄️",snowflake:"❄️",wind_face:"🌬",dash:"💨",tornado:"🌪",fog:"🌫",ocean:"🌊",droplet:"💧",sweat_drops:"💦",umbrella:"☔️",green_apple:"🍏",apple:"🍎",pear:"🍐",tangerine:"🍊",orange:"🍊",mandarin:"🍊",lemon:"🍋",banana:"🍌",watermelon:"🍉",grapes:"🍇",strawberry:"🍓",melon:"🍈",cherries:"🍒",peach:"🍑",pineapple:"🍍",kiwi_fruit:"🥝",avocado:"🥑",tomato:"🍅",eggplant:"🍆",cucumber:"🥒",carrot:"🥕",corn:"🌽",hot_pepper:"🌶",potato:"🥔",sweet_potato:"🍠",chestnut:"🌰",peanuts:"🥜",honey_pot:"🍯",croissant:"🥐",bread:"🍞",baguette_bread:"🥖",cheese:"🧀",egg:"🥚",fried_egg:"🍳",bacon:"🥓",pancakes:"🥞",fried_shrimp:"🍤",poultry_leg:"🍗",meat_on_bone:"🍖",pizza:"🍕",hotdog:"🌭",hamburger:"🍔",fries:"🍟",stuffed_flatbread:"🥙",taco:"🌮",burrito:"🌯",green_salad:"🥗",shallow_pan_of_food:"🥘",spaghetti:"🍝",ramen:"🍜",stew:"🍲",fish_cake:"🍥",sushi:"🍣",bento:"🍱",curry:"🍛",rice:"🍚",rice_ball:"🍙",rice_cracker:"🍘",oden:"🍢",dango:"🍡",shaved_ice:"🍧",ice_cream:"🍨",icecream:"🍦",cake:"🍰",birthday:"🎂",custard:"🍮",lollipop:"🍭",candy:"🍬",chocolate_bar:"🍫",popcorn:"🍿",doughnut:"🍩",cookie:"🍪",milk_glass:"🥛",baby_bottle:"🍼",coffee:"☕️",tea:"🍵",sake:"🍶",beer:"🍺",beers:"🍻",clinking_glasses:"🥂",wine_glass:"🍷",tumbler_glass:"🥃",cocktail:"🍸",tropical_drink:"🍹",champagne:"🍾",spoon:"🥄",fork_and_knife:"🍴",plate_with_cutlery:"🍽",soccer:"⚽️",basketball:"🏀",football:"🏈",baseball:"⚾️",tennis:"🎾",volleyball:"🏐",rugby_football:"🏉","8ball":"🎱",ping_pong:"🏓",badminton:"🏸",goal_net:"🥅",ice_hockey:"🏒",field_hockey:"🏑",cricket:"🏏",golf:"⛳️",bow_and_arrow:"🏹",fishing_pole_and_fish:"🎣",boxing_glove:"🥊",martial_arts_uniform:"🥋",ice_skate:"⛸",ski:"🎿",skier:"⛷",snowboarder:"🏂",weight_lifting_woman:"🏋️‍♀️",weight_lifting_man:"🏋",person_fencing:"🤺",women_wrestling:"🤼‍♀",men_wrestling:"🤼‍♂",woman_cartwheeling:"🤸‍♀",man_cartwheeling:"🤸‍♂",basketball_woman:"⛹️‍♀️",basketball_man:"⛹",woman_playing_handball:"🤾‍♀",man_playing_handball:"🤾‍♂",golfing_woman:"🏌️‍♀️",golfing_man:"🏌",surfing_woman:"🏄‍♀",surfing_man:"🏄",surfer:"🏄",swimming_woman:"🏊‍♀",swimming_man:"🏊",swimmer:"🏊",woman_playing_water_polo:"🤽‍♀",man_playing_water_polo:"🤽‍♂",rowing_woman:"🚣‍♀",rowing_man:"🚣",rowboat:"🚣",horse_racing:"🏇",biking_woman:"🚴‍♀",biking_man:"🚴",bicyclist:"🚴",mountain_biking_woman:"🚵‍♀",mountain_biking_man:"🚵",mountain_bicyclist:"🚵",running_shirt_with_sash:"🎽",medal_sports:"🏅",medal_military:"🎖","1st_place_medal":"🥇","2nd_place_medal":"🥈","3rd_place_medal":"🥉",trophy:"🏆",rosette:"🏵",reminder_ribbon:"🎗",ticket:"🎫",tickets:"🎟",circus_tent:"🎪",woman_juggling:"🤹‍♀",man_juggling:"🤹‍♂",performing_arts:"🎭",art:"🎨",clapper:"🎬",microphone:"🎤",headphones:"🎧",musical_score:"🎼",musical_keyboard:"🎹",drum:"🥁",saxophone:"🎷",trumpet:"🎺",guitar:"🎸",violin:"🎻",game_die:"🎲",dart:"🎯",bowling:"🎳",video_game:"🎮",slot_machine:"🎰",car:"🚗",red_car:"🚗",taxi:"🚕",blue_car:"🚙",bus:"🚌",trolleybus:"🚎",racing_car:"🏎",police_car:"🚓",ambulance:"🚑",fire_engine:"🚒",minibus:"🚐",truck:"🚚",articulated_lorry:"🚛",tractor:"🚜",kick_scooter:"🛴",bike:"🚲",motor_scooter:"🛵",motorcycle:"🏍",rotating_light:"🚨",oncoming_police_car:"🚔",oncoming_bus:"🚍",oncoming_automobile:"🚘",oncoming_taxi:"🚖",aerial_tramway:"🚡",mountain_cableway:"🚠",suspension_railway:"🚟",railway_car:"🚃",train:"🚋",mountain_railway:"🚞",monorail:"🚝",bullettrain_side:"🚄",bullettrain_front:"🚅",light_rail:"🚈",steam_locomotive:"🚂",train2:"🚆",metro:"🚇",tram:"🚊",station:"🚉",helicopter:"🚁",small_airplane:"🛩",airplane:"✈️",flight_departure:"🛫",flight_arrival:"🛬",rocket:"🚀",artificial_satellite:"🛰",seat:"💺",canoe:"🛶",boat:"⛵️",sailboat:"⛵️",motor_boat:"🛥",speedboat:"🚤",passenger_ship:"🛳",ferry:"⛴",ship:"🚢",anchor:"⚓️",construction:"🚧",fuelpump:"⛽️",busstop:"🚏",vertical_traffic_light:"🚦",traffic_light:"🚥",world_map:"🗺",moyai:"🗿",statue_of_liberty:"🗽",fountain:"⛲️",tokyo_tower:"🗼",european_castle:"🏰",japanese_castle:"🏯",stadium:"🏟",ferris_wheel:"🎡",roller_coaster:"🎢",carousel_horse:"🎠",parasol_on_ground:"⛱",beach_umbrella:"🏖",desert_island:"🏝",mountain:"⛰",mountain_snow:"🏔",mount_fuji:"🗻",volcano:"🌋",desert:"🏜",camping:"🏕",tent:"⛺️",railway_track:"🛤",motorway:"🛣",building_construction:"🏗",factory:"🏭",house:"🏠",house_with_garden:"🏡",houses:"🏘",derelict_house:"🏚",office:"🏢",department_store:"🏬",post_office:"🏣",european_post_office:"🏤",hospital:"🏥",bank:"🏦",hotel:"🏨",convenience_store:"🏪",school:"🏫",love_hotel:"🏩",wedding:"💒",classical_building:"🏛",church:"⛪️",mosque:"🕌",synagogue:"🕍",kaaba:"🕋",shinto_shrine:"⛩",japan:"🗾",rice_scene:"🎑",national_park:"🏞",sunrise:"🌅",sunrise_over_mountains:"🌄",stars:"🌠",sparkler:"🎇",fireworks:"🎆",city_sunrise:"🌇",city_sunset:"🌆",cityscape:"🏙",night_with_stars:"🌃",milky_way:"🌌",bridge_at_night:"🌉",foggy:"🌁",watch:"⌚️",iphone:"📱",calling:"📲",computer:"💻",keyboard:"⌨️",desktop_computer:"🖥",printer:"🖨",computer_mouse:"🖱",trackball:"🖲",joystick:"🕹",clamp:"🗜",minidisc:"💽",floppy_disk:"💾",cd:"💿",dvd:"📀",vhs:"📼",camera:"📷",camera_flash:"📸",video_camera:"📹",movie_camera:"🎥",film_projector:"📽",film_strip:"🎞",telephone_receiver:"📞",phone:"☎️",telephone:"☎️",pager:"📟",fax:"📠",tv:"📺",radio:"📻",studio_microphone:"🎙",level_slider:"🎚",control_knobs:"🎛",stopwatch:"⏱",timer_clock:"⏲",alarm_clock:"⏰",mantelpiece_clock:"🕰",hourglass:"⌛️",hourglass_flowing_sand:"⏳",satellite:"📡",battery:"🔋",electric_plug:"🔌",bulb:"💡",flashlight:"🔦",candle:"🕯",wastebasket:"🗑",oil_drum:"🛢",money_with_wings:"💸",dollar:"💵",yen:"💴",euro:"💶",pound:"💷",moneybag:"💰",credit_card:"💳",gem:"💎",balance_scale:"⚖️",wrench:"🔧",hammer:"🔨",hammer_and_pick:"⚒",hammer_and_wrench:"🛠",pick:"⛏",nut_and_bolt:"🔩",gear:"⚙️",chains:"⛓",gun:"🔫",bomb:"💣",hocho:"🔪",knife:"🔪",dagger:"🗡",crossed_swords:"⚔️",shield:"🛡",smoking:"🚬",coffin:"⚰️",funeral_urn:"⚱️",amphora:"🏺",crystal_ball:"🔮",prayer_beads:"📿",barber:"💈",alembic:"⚗️",telescope:"🔭",microscope:"🔬",hole:"🕳",pill:"💊",syringe:"💉",thermometer:"🌡",toilet:"🚽",potable_water:"🚰",shower:"🚿",bathtub:"🛁",bath:"🛀",bellhop_bell:"🛎",key:"🔑",old_key:"🗝",door:"🚪",couch_and_lamp:"🛋",bed:"🛏",sleeping_bed:"🛌",framed_picture:"🖼",shopping:"🛍",shopping_cart:"🛒",gift:"🎁",balloon:"🎈",flags:"🎏",ribbon:"🎀",confetti_ball:"🎊",tada:"🎉",dolls:"🎎",izakaya_lantern:"🏮",lantern:"🏮",wind_chime:"🎐",email:"✉️",envelope:"✉️",envelope_with_arrow:"📩",incoming_envelope:"📨","e-mail":"📧",love_letter:"💌",inbox_tray:"📥",outbox_tray:"📤",package:"📦",label:"🏷",mailbox_closed:"📪",mailbox:"📫",mailbox_with_mail:"📬",mailbox_with_no_mail:"📭",postbox:"📮",postal_horn:"📯",scroll:"📜",page_with_curl:"📃",page_facing_up:"📄",bookmark_tabs:"📑",bar_chart:"📊",chart_with_upwards_trend:"📈",chart_with_downwards_trend:"📉",spiral_notepad:"🗒",spiral_calendar:"🗓",calendar:"📆",date:"📅",card_index:"📇",card_file_box:"🗃",ballot_box:"🗳",file_cabinet:"🗄",clipboard:"📋",file_folder:"📁",open_file_folder:"📂",card_index_dividers:"🗂",newspaper_roll:"🗞",newspaper:"📰",notebook:"📓",notebook_with_decorative_cover:"📔",ledger:"📒",closed_book:"📕",green_book:"📗",blue_book:"📘",orange_book:"📙",books:"📚",book:"📖",open_book:"📖",bookmark:"🔖",link:"🔗",paperclip:"📎",paperclips:"🖇",triangular_ruler:"📐",straight_ruler:"📏",pushpin:"📌",round_pushpin:"📍",scissors:"✂️",pen:"🖊",fountain_pen:"🖋",black_nib:"✒️",paintbrush:"🖌",crayon:"🖍",memo:"📝",pencil:"📝",pencil2:"✏️",mag:"🔍",mag_right:"🔎",lock_with_ink_pen:"🔏",closed_lock_with_key:"🔐",lock:"🔒",unlock:"🔓",heart:"❤️",yellow_heart:"💛",green_heart:"💚",blue_heart:"💙",purple_heart:"💜",black_heart:"🖤",broken_heart:"💔",heavy_heart_exclamation:"❣️",two_hearts:"💕",revolving_hearts:"💞",heartbeat:"💓",heartpulse:"💗",sparkling_heart:"💖",cupid:"💘",gift_heart:"💝",heart_decoration:"💟",peace_symbol:"☮️",latin_cross:"✝️",star_and_crescent:"☪️",om:"🕉",wheel_of_dharma:"☸️",star_of_david:"✡️",six_pointed_star:"🔯",menorah:"🕎",yin_yang:"☯️",orthodox_cross:"☦️",place_of_worship:"🛐",ophiuchus:"⛎",aries:"♈️",taurus:"♉️",gemini:"♊️",cancer:"♋️",leo:"♌️",virgo:"♍️",libra:"♎️",scorpius:"♏️",sagittarius:"♐️",capricorn:"♑️",aquarius:"♒️",pisces:"♓️",id:"🆔",atom_symbol:"⚛️",accept:"🉑",radioactive:"☢️",biohazard:"☣️",mobile_phone_off:"📴",vibration_mode:"📳",eight_pointed_black_star:"✴️",vs:"🆚",white_flower:"💮",ideograph_advantage:"🉐",secret:"㊙️",congratulations:"㊗️",u6e80:"🈵",a:"🅰️",b:"🅱️",ab:"🆎",cl:"🆑",o2:"🅾️",sos:"🆘",x:"❌",o:"⭕️",stop_sign:"🛑",no_entry:"⛔️",name_badge:"📛",no_entry_sign:"🚫",anger:"💢",hotsprings:"♨️",no_pedestrians:"🚷",do_not_litter:"🚯",no_bicycles:"🚳","non-potable_water":"🚱",underage:"🔞",no_mobile_phones:"📵",no_smoking:"🚭",exclamation:"❗️",heavy_exclamation_mark:"❗️",grey_exclamation:"❕",question:"❓",grey_question:"❔",bangbang:"‼️",interrobang:"⁉️",low_brightness:"🔅",high_brightness:"🔆",part_alternation_mark:"〽️",warning:"⚠️",children_crossing:"🚸",trident:"🔱",fleur_de_lis:"⚜️",beginner:"🔰",recycle:"♻️",white_check_mark:"✅",chart:"💹",sparkle:"❇️",eight_spoked_asterisk:"✳️",negative_squared_cross_mark:"❎",globe_with_meridians:"🌐",diamond_shape_with_a_dot_inside:"💠",m:"Ⓜ️",cyclone:"🌀",zzz:"💤",atm:"🏧",wc:"🚾",wheelchair:"♿️",parking:"🅿️",sa:"🈂️",passport_control:"🛂",customs:"🛃",baggage_claim:"🛄",left_luggage:"🛅",mens:"🚹",womens:"🚺",baby_symbol:"🚼",restroom:"🚻",put_litter_in_its_place:"🚮",cinema:"🎦",signal_strength:"📶",koko:"🈁",symbols:"🔣",information_source:"ℹ️",abc:"🔤",abcd:"🔡",capital_abcd:"🔠",ng:"🆖",ok:"🆗",up:"🆙",cool:"🆒",new:"🆕",free:"🆓",zero:"0️⃣",one:"1️⃣",two:"2️⃣",three:"3️⃣",four:"4️⃣",five:"5️⃣",six:"6️⃣",seven:"7️⃣",eight:"8️⃣",nine:"9️⃣",keycap_ten:"🔟",hash:"#️⃣",asterisk:"*️⃣",arrow_forward:"▶️",pause_button:"⏸",play_or_pause_button:"⏯",stop_button:"⏹",record_button:"⏺",next_track_button:"⏭",previous_track_button:"⏮",fast_forward:"⏩",rewind:"⏪",arrow_double_up:"⏫",arrow_double_down:"⏬",arrow_backward:"◀️",arrow_up_small:"🔼",arrow_down_small:"🔽",arrow_right:"➡️",arrow_left:"⬅️",arrow_up:"⬆️",arrow_down:"⬇️",arrow_upper_right:"↗️",arrow_lower_right:"↘️",arrow_lower_left:"↙️",arrow_upper_left:"↖️",arrow_up_down:"↕️",left_right_arrow:"↔️",arrow_right_hook:"↪️",leftwards_arrow_with_hook:"↩️",arrow_heading_up:"⤴️",arrow_heading_down:"⤵️",twisted_rightwards_arrows:"🔀",repeat:"🔁",repeat_one:"🔂",arrows_counterclockwise:"🔄",arrows_clockwise:"🔃",musical_note:"🎵",notes:"🎶",heavy_plus_sign:"➕",heavy_minus_sign:"➖",heavy_division_sign:"➗",heavy_multiplication_x:"✖️",heavy_dollar_sign:"💲",currency_exchange:"💱",tm:"™️",copyright:"©️",registered:"®️",wavy_dash:"〰️",curly_loop:"➰",loop:"➿",end:"🔚",back:"🔙",on:"🔛",top:"🔝",soon:"🔜",heavy_check_mark:"✔️",ballot_box_with_check:"☑️",radio_button:"🔘",white_circle:"⚪️",black_circle:"⚫️",red_circle:"🔴",large_blue_circle:"🔵",small_red_triangle:"🔺",small_red_triangle_down:"🔻",small_orange_diamond:"🔸",small_blue_diamond:"🔹",large_orange_diamond:"🔶",large_blue_diamond:"🔷",white_square_button:"🔳",black_square_button:"🔲",black_small_square:"▪️",white_small_square:"▫️",black_medium_small_square:"◾️",white_medium_small_square:"◽️",black_medium_square:"◼️",white_medium_square:"◻️",black_large_square:"⬛️",white_large_square:"⬜️",speaker:"🔈",mute:"🔇",sound:"🔉",loud_sound:"🔊",bell:"🔔",no_bell:"🔕",mega:"📣",loudspeaker:"📢",eye_speech_bubble:"👁‍🗨",speech_balloon:"💬",thought_balloon:"💭",right_anger_bubble:"🗯",spades:"♠️",clubs:"♣️",hearts:"♥️",diamonds:"♦️",black_joker:"🃏",flower_playing_cards:"🎴",mahjong:"🀄️",clock1:"🕐",clock2:"🕑",clock3:"🕒",clock4:"🕓",clock5:"🕔",clock6:"🕕",clock7:"🕖",clock8:"🕗",clock9:"🕘",clock10:"🕙",clock11:"🕚",clock12:"🕛",clock130:"🕜",clock230:"🕝",clock330:"🕞",clock430:"🕟",clock530:"🕠",clock630:"🕡",clock730:"🕢",clock830:"🕣",clock930:"🕤",clock1030:"🕥",clock1130:"🕦",clock1230:"🕧",white_flag:"🏳️",black_flag:"🏴",checkered_flag:"🏁",triangular_flag_on_post:"🚩",rainbow_flag:"🏳️‍🌈",afghanistan:"🇦🇫",aland_islands:"🇦🇽",albania:"🇦🇱",algeria:"🇩🇿",american_samoa:"🇦🇸",andorra:"🇦🇩",angola:"🇦🇴",anguilla:"🇦🇮",antarctica:"🇦🇶",antigua_barbuda:"🇦🇬",argentina:"🇦🇷",armenia:"🇦🇲",aruba:"🇦🇼",australia:"🇦🇺",austria:"🇦🇹",azerbaijan:"🇦🇿",bahamas:"🇧🇸",bahrain:"🇧🇭",bangladesh:"🇧🇩",barbados:"🇧🇧",belarus:"🇧🇾",belgium:"🇧🇪",belize:"🇧🇿",benin:"🇧🇯",bermuda:"🇧🇲",bhutan:"🇧🇹",bolivia:"🇧🇴",caribbean_netherlands:"🇧🇶",bosnia_herzegovina:"🇧🇦",botswana:"🇧🇼",brazil:"🇧🇷",british_indian_ocean_territory:"🇮🇴",british_virgin_islands:"🇻🇬",brunei:"🇧🇳",bulgaria:"🇧🇬",burkina_faso:"🇧🇫",burundi:"🇧🇮",cape_verde:"🇨🇻",cambodia:"🇰🇭",cameroon:"🇨🇲",canada:"🇨🇦",canary_islands:"🇮🇨",cayman_islands:"🇰🇾",central_african_republic:"🇨🇫",chad:"🇹🇩",chile:"🇨🇱",cn:"🇨🇳",christmas_island:"🇨🇽",cocos_islands:"🇨🇨",colombia:"🇨🇴",comoros:"🇰🇲",congo_brazzaville:"🇨🇬",congo_kinshasa:"🇨🇩",cook_islands:"🇨🇰",costa_rica:"🇨🇷",cote_divoire:"🇨🇮",croatia:"🇭🇷",cuba:"🇨🇺",curacao:"🇨🇼",cyprus:"🇨🇾",czech_republic:"🇨🇿",denmark:"🇩🇰",djibouti:"🇩🇯",dominica:"🇩🇲",dominican_republic:"🇩🇴",ecuador:"🇪🇨",egypt:"🇪🇬",el_salvador:"🇸🇻",equatorial_guinea:"🇬🇶",eritrea:"🇪🇷",estonia:"🇪🇪",ethiopia:"🇪🇹",eu:"🇪🇺",european_union:"🇪🇺",falkland_islands:"🇫🇰",faroe_islands:"🇫🇴",fiji:"🇫🇯",finland:"🇫🇮",fr:"🇫🇷",french_guiana:"🇬🇫",french_polynesia:"🇵🇫",french_southern_territories:"🇹🇫",gabon:"🇬🇦",gambia:"🇬🇲",georgia:"🇬🇪",de:"🇩🇪",ghana:"🇬🇭",gibraltar:"🇬🇮",greece:"🇬🇷",greenland:"🇬🇱",grenada:"🇬🇩",guadeloupe:"🇬🇵",guam:"🇬🇺",guatemala:"🇬🇹",guernsey:"🇬🇬",guinea:"🇬🇳",guinea_bissau:"🇬🇼",guyana:"🇬🇾",haiti:"🇭🇹",honduras:"🇭🇳",hong_kong:"🇭🇰",hungary:"🇭🇺",iceland:"🇮🇸",india:"🇮🇳",indonesia:"🇮🇩",iran:"🇮🇷",iraq:"🇮🇶",ireland:"🇮🇪",isle_of_man:"🇮🇲",israel:"🇮🇱",it:"🇮🇹",jamaica:"🇯🇲",jp:"🇯🇵",crossed_flags:"🎌",jersey:"🇯🇪",jordan:"🇯🇴",kazakhstan:"🇰🇿",kenya:"🇰🇪",kiribati:"🇰🇮",kosovo:"🇽🇰",kuwait:"🇰🇼",kyrgyzstan:"🇰🇬",laos:"🇱🇦",latvia:"🇱🇻",lebanon:"🇱🇧",lesotho:"🇱🇸",liberia:"🇱🇷",libya:"🇱🇾",liechtenstein:"🇱🇮",lithuania:"🇱🇹",luxembourg:"🇱🇺",macau:"🇲🇴",macedonia:"🇲🇰",madagascar:"🇲🇬",malawi:"🇲🇼",malaysia:"🇲🇾",maldives:"🇲🇻",mali:"🇲🇱",malta:"🇲🇹",marshall_islands:"🇲🇭",martinique:"🇲🇶",mauritania:"🇲🇷",mauritius:"🇲🇺",mayotte:"🇾🇹",mexico:"🇲🇽",micronesia:"🇫🇲",moldova:"🇲🇩",monaco:"🇲🇨",mongolia:"🇲🇳",montenegro:"🇲🇪",montserrat:"🇲🇸",morocco:"🇲🇦",mozambique:"🇲🇿",myanmar:"🇲🇲",namibia:"🇳🇦",nauru:"🇳🇷",nepal:"🇳🇵",netherlands:"🇳🇱",new_caledonia:"🇳🇨",new_zealand:"🇳🇿",nicaragua:"🇳🇮",niger:"🇳🇪",nigeria:"🇳🇬",niue:"🇳🇺",norfolk_island:"🇳🇫",northern_mariana_islands:"🇲🇵",north_korea:"🇰🇵",norway:"🇳🇴",oman:"🇴🇲",pakistan:"🇵🇰",palau:"🇵🇼",palestinian_territories:"🇵🇸",panama:"🇵🇦",papua_new_guinea:"🇵🇬",paraguay:"🇵🇾",peru:"🇵🇪",philippines:"🇵🇭",pitcairn_islands:"🇵🇳",poland:"🇵🇱",portugal:"🇵🇹",puerto_rico:"🇵🇷",qatar:"🇶🇦",reunion:"🇷🇪",romania:"🇷🇴",ru:"🇷🇺",rwanda:"🇷🇼",st_barthelemy:"🇧🇱",st_helena:"🇸🇭",st_kitts_nevis:"🇰🇳",st_lucia:"🇱🇨",st_pierre_miquelon:"🇵🇲",st_vincent_grenadines:"🇻🇨",samoa:"🇼🇸",san_marino:"🇸🇲",sao_tome_principe:"🇸🇹",saudi_arabia:"🇸🇦",senegal:"🇸🇳",serbia:"🇷🇸",seychelles:"🇸🇨",sierra_leone:"🇸🇱",singapore:"🇸🇬",sint_maarten:"🇸🇽",slovakia:"🇸🇰",slovenia:"🇸🇮",solomon_islands:"🇸🇧",somalia:"🇸🇴",south_africa:"🇿🇦",south_georgia_south_sandwich_islands:"🇬🇸",kr:"🇰🇷",south_sudan:"🇸🇸",es:"🇪🇸",sri_lanka:"🇱🇰",sudan:"🇸🇩",suriname:"🇸🇷",swaziland:"🇸🇿",sweden:"🇸🇪",switzerland:"🇨🇭",syria:"🇸🇾",taiwan:"🇹🇼",tajikistan:"🇹🇯",tanzania:"🇹🇿",thailand:"🇹🇭",timor_leste:"🇹🇱",togo:"🇹🇬",tokelau:"🇹🇰",tonga:"🇹🇴",trinidad_tobago:"🇹🇹",tunisia:"🇹🇳",tr:"🇹🇷",turkmenistan:"🇹🇲",turks_caicos_islands:"🇹🇨",tuvalu:"🇹🇻",uganda:"🇺🇬",ukraine:"🇺🇦",united_arab_emirates:"🇦🇪",gb:"🇬🇧",uk:"🇬🇧",us:"🇺🇸",us_virgin_islands:"🇻🇮",uruguay:"🇺🇾",uzbekistan:"🇺🇿",vanuatu:"🇻🇺",vatican_city:"🇻🇦",venezuela:"🇻🇪",vietnam:"🇻🇳",wallis_futuna:"🇼🇫",western_sahara:"🇪🇭",yemen:"🇾🇪",zambia:"🇿🇲",zimbabwe:"🇿🇼"},s.data.happy=s.data.smile,n.exports=s}),$__System.registerDynamic("19",["11","13","30","1b","49","17","1e"],!0,function(e,t,n){"use strict";this||self;function y(e){return(e||"").replace(/\t/g,be).length}var $=e("11"),a=e("13"),F=a.Node,H=a.TYPE,X=e("30"),b=e("1b"),Z=e("49"),U=e("17"),j=e("1e"),S={ul:/^(\s*)(([-+*])\s+)/,ol:/^(\s*)\d+((\.|\)))\s+/,tasklist:/^(\s*)(([-+*])\s*)\[((x|X)| )\]\s+/},D=/^(\s*)([-+*>\[]|\d+(\.|\)))\s+/,P=/^(\s*)[^\s]/,B=null,c={ul:/^(\s*)([-+*])\s+/,ol:/^(\s*)(\d+(\.|\)))\s+/,tasklist:/^(\s*)([-+*]\s*\[((x|X)| )\])\s+/},d={ul:/^(\s{0,3})([-+*])\s+/,ol:/^(\s{0,3})(\d+(\.|\)))\s+/,tasklist:/^(\s{0,3})([-+*]\s*\[((x|X)| )\])\s+/},u=/\r\n|\r|\n|\u2424/,h=/^[ \u00A0]{0,3}$/,k=/^[\s\u00A0]*$/,R=/(^[ \u00A0]{0,3}>\s*)(.*)$/,O=/(^\s*(#{1,6})\s*)([^\n]+?)(\s+#+\s*)*$/,I=/(^\s*(#{1,6})\s+)([^\n]+?)(\s+#+\s*)*$/,ee=/^ *(=|-){2,}[\s\u00A0]*$/,te=/^\s*[-+*_<\[\{|#0-9`~=>$]/,ne=/^( *(`{3,}|~{3,})[ \t\u00A0]*)([^\n`]+)? *$/,p=/^\s*(`{3,}|~{3,})\s*$/,ie=/^\s*\${2}\s*(?:\{(.+)\})?$/,E=/^( {4}|(?: {0,3}\t))(\s*\S.*)$/,f=/^( {4}|(?: {0,3}\t))/,T=/^\s*([-+_*])\s*\1\s*\1(\s|\1)*$/,re=/^\s*\[toc\]\s*$/i,oe=/^\s*\{:toc\}\s*$/i,ae=/^\s*\[\[_TOC_\]\]\s*$/,se=/^\s?\{:\s*toc(\s*|(\s+.*))\}/,le=/^\s*\[([^\]]+)\]:(\s*<?)([^\s>]+)(>?)((\s+)(["'(])([^\n]*)(["')]))?\s*$/,ce=/^\s*\[\^([^\]\n]+)\]:(\s*)([^\n]*)$/,de=/^-{3}$/,ue=/^ *\|([^\|]+\|.+)\|\s*$/,he=/^\s*\|(\s*[-:]+\s*\|[-|\s:]*)$/,pe=/^\s*([-:]+\s*\|[-|\s:]*)$/,_=/\|/,A=U.BLOCK_OPEN_REG,m="\n",fe=/^\s*[-\u2013\u2014+*_<\u3010\[\{|#0-9`~=>$]/,me=/^\s*([-\u2013\u2014])/,ge=/^\s*[\[\u3010]toc[\]\u3011]\s*$/i,ye=/^(-{3}|\u2013[-\u2013\u2014]+|\u2014[-\u2013\u2014]*)$/,g=[/^\s*([-+*]|(\d+[\.\)]))\s/,/^\s*(>|```|---)/,/^\s*#{1,6}/,E,A],ve=[/^\s*([-+*]|(\d+[\.\)]))\s/,/^\s*(>|```|---)/,/^\s*#{1,6}\s+/,E,A],r={},o={},v={},w={},be="  ",we=function(e){if(e.get("style")==F.ListType.ol){for(var t=e.getFirstChild(),n=!1,i=t.get("after");i&&i._numText;){if(t._numText.trim()!=i._numText.trim())return!1;n=!0,i=(t=i).get("after")}return n}},M={NOT_CLOSE:0,CLOSE_EXCLUDE:1,CLOSE_INCLUDE:2,UNKNOWN:-1},xe=U.getHTMLTagReg,L={paragraph:{shouldClose:function(e){return e.match(h)?(this.cur.set("tail",1),M.CLOSE_INCLUDE):M.UNKNOWN},onClose:function(e){1<this.cur._lines.length&&this.cur._lines[0].match(k)&&(this.cur.set("ahead",1),this.cur._lines.shift()),this.cur._lines.length||this.cur._lines.push(""),this.cur.set("text",this.cur._lines.join("\n")),null==this.cur.get("tail")&&!e&&this.cur._lines.last().trim()&&this.cur.set("tail",0),this.cur._lines=void 0},onContinue:function(e){this.cur._lines.push(e)}},html_block:{shouldClose:function(e){var t,n=this.cur.get("depth")||0,i=xe(this.cur.get("style")),r=e;if(!e.trim())return M.CLOSE_EXCLUDE;for(;t=i.exec(r);)r=r.substring(t.index+t[0].length),t[2]?n--:t[1]||n++;return n<=0?(this.cur.set("depth",0),this.cur._lines.push(e),M.CLOSE_INCLUDE):(this.cur.set("depth",n),M.NOT_CLOSE)},onClose:function(){var e=this.cur.get("depth");this.cur.set("text",this.cur._lines.join("\n")),e&&this.skips.enableStartMatch&&(1!=this.cur._lines.length||/>/.exec(this.cur._lines[0])?U.autoCloseTag(this.cur):(this.cur.set("type",H.paragraph),this.cur.unset("style"))),this.cur._lines=void 0},onContinue:function(e){this.cur._lines.push(e)}},blockquote:{shouldClose:function(e){return e.trim().length?e.match(R)||e.match(/\t|( {2,})/)?M.NOT_CLOSE:M.UNKNOWN:(this.cur.set("tail",1),M.CLOSE_INCLUDE)},onClose:function(){new x(this.cur._lines,this.cur,null,null,this.skips),this.cur._lines=void 0,this.cur.unset("text"),(this.skips||{}).pass_format||this.cur.set("userIndent",this.cur._lineIndents),this.cur._lineIndents=void 0},onContinue:function(e){var t=this.cur._indent,n=(r[t]||(r[t]=new RegExp("^((( {0,"+(t+4)+"}|\\t)> {0,"+(t||1)+"})|(\\t| {2})|>(\\t| {0,"+(t||1)+"}))")),r[t].exec(e)||[""]),i=n[0];!n[2]&&0<(n[4]||"").length&&(n[2]="> ".substr(0,i.length),e=n[2]+e.substring(i.length)),this.cur._indentSensitive=this.cur._indentSensitive||/^\s*([-+*>]|\d+(\.|\)))\s/.exec(e.substring(i.length)),n[2]&&t<4&&!this.cur._indentSensitive&&(o[t]||(o[t]=new RegExp("^( {1,"+(4-t)+"}|\\t)>")),o[t].exec(e.substring(i.length))||(i+=(new RegExp("^ {1,"+(4-t)+"}").exec(e.substring(i.length))||[""])[0])),/^\s*>*\s*$/.exec(e)?(this.cur._lineIndents.push(e),this.cur._lines.push("")):(this.cur._lineIndents.push(i),this.cur._lines.push(e.substring(i.length)))}},list:{shouldClose:function(e){var t=this.cur.getLastChild();return v[t._indent]||(v[t._indent]=new RegExp("^( {"+t._indent+",}|\\t)")),e.match(v[t._indent])?(this.cur.unset("tail"),M.NOT_CLOSE):e.match(k)?(this.cur.set("tail",(this.cur.get("tail")||0)+1),1<this.cur.get("tail")?(this.cur.set("tail",1),M.CLOSE_EXCLUDE):M.NOT_CLOSE):e.match(T)?M.CLOSE_EXCLUDE:t._minIndent<t._indent&&(v[t._minIndent]||(v[t._minIndent]=new RegExp("^( {"+t._minIndent+",})")),e.match(v[t._minIndent]))?(this.cur.unset("tail"),t._indent=/^\s+/.exec(e)[0].length,t._indentDecided=!1,M.NOT_CLOSE):(t=S[this.cur.get("style")].exec(e))?t[3]==this.cur._mark?0:1:this.lines[this.ln-1].match(k)?M.CLOSE_EXCLUDE:M.UNKNOWN},onClose:function(){for(var e=this.cur.getLastChild(),t=this.cur.get("tail")||0;0<t&&!e._lines.last().trim().length;)e._lines.pop(),e._lineIndents.pop(),t--;if(new x(e._lines,e,null,null,this.skips),e.unset("text"),(this.skips||{}).pass_format||e.set("userIndent",e._lineIndents),e._lines=void 0,e._indent=void 0,e._minIndent=void 0,e._indentDecided=void 0,e._lineIndents=void 0,this.cur._mark=void 0,this.cur.unset("text"),!(this.skips||{}).pass_format){var n=this.cur;if(n.get("style")==F.ListType.ol){for(var i=we(n),r=n.getFirstChild(),o=r._numText;r;)r._numText=void 0,r=r.get("after");i&&n.set("pattern",o),n.set("isFixed",i)}!this.cur.get("tail")&&this.lines[this.ln]&&this.cur.set("tail",0)}},onContinue:function(e,t,n){var i,r,o,a,s,l=this.cur.getLastChild(),c=y(t),d=File.option.strictMarkdown?c-n:2,u=this.cur.get("style"),h=0,p=/^\s*(\d+)(\.|\))\s+/,f=/^\s*(\d+(\.|\))\s+)/;function m(e){return D.exec(function(e){if(e&&0!=e.length)for(var t=e.length-1;0<=t;t--)if(0<e[t].trim().length)return e[t];return""}(e))}function g(e,t,n){n&&(e._lines=[]),e._lines.push(t),e.set("userIndent",e._lineIndents)}n=n||(l?l.get("prespace"):0)||0,e.match(k)||this.cur.unset("tail"),l?(l._numLength=l._numLength||0,v[l._indent]||(v[l._indent]=new RegExp("^( {"+l._indent+",}|\\t)")),a=e.match(v[l._indent]),o=0,w[l._indent]||(l._indent<2&&(w[l._indent]=new RegExp("^\\t")),w[l._indent]=new RegExp("^( {2,"+l._indent+"}|\\t)")),o=(e.match(w[l._indent])||[""])[0].length,i=(w[l._indent].exec(e)||[""])[0],e=a?e.substring(i.length):e,l.get("style")==F.ListType.task&&!File.option.strictMarkdown&&a&&(i+=(e.match(/^ {4}/)||[""])[0],e=e.replace(/^ {4}/,"")),!a&&(s=B[u].exec(e))?(n=(s[1]||"").length,t=s[0],c=y(t),d=File.option.strictMarkdown?c-n:2,1<l._lines.length&&l._lines.last().match(k)?(l._lines.pop(),l.set("tail",1)):l.set("tail",0),this.cur.unset("tail"),new x(l._lines,l,null,null,this.skips),(this.skips||{}).pass_format||l.set("userIndent",l._lineIndents),l.unset("text"),l._lines=void 0,l._lineIndents=void 0,l._indent=void 0,u==F.ListType.ol&&(h=p.exec(e)[1].length-1),(l=new F({type:H.list_item,prespace:n,markindent:c-h-n}))._numLength=h,l._numText=(f.exec(e)||[])[1],l._minIndent=h+(u==F.ListType.ol?3:2)+n,i=s[0],(r=S[F.ListType.task].exec(e))&&(l.set("checked",!!r[5]),l.set("style",F.ListType.task),i=r[0]),this.cur.appendChild(l),l._indent=d+n,l._lineIndents=[i],g(l,e.substring(i.length),!0)):(l._indentDecided||((s=P.exec(e))&&l._indent&&l._indent-n<4&&(s[1].length?((t=(a=s[1].replace(/\t/,"    ").length)+l._indent)>n+l.get("markindent")&&m(l._lines)?a=l.get("markindent")-l._indent:t>=n+l.get("markindent")+4&&(a=a+l._indent-4-l.get("markindent")),l._indent+=a,this.cur.set("subindent",l._indent-l._numLength),l.set("subindent",l._indent-l._numLength),i+=e.substring(0,a),e=e.substring(a)):l.set("subindent",Math.max(2,o-l._numLength))),l._indentDecided=!!s),l._lineIndents.push(i),g(l,e,!1))):(u==F.ListType.ol&&(h=p.exec(e)[1].length-1),l=new F({type:H.list_item,prespace:n,markindent:c-h-n}),this.cur.appendChild(l),l._indent=d+n,l._minIndent=h+(u==F.ListType.ol?3:2)+n,u==F.ListType.ol&&(l._numText=(f.exec(e)||[])[1],l._numLength=h),i=((r=S[F.ListType.task].exec(e))?(l.set("checked",!!r[5]),l.set("style",F.ListType.task),r):S[u].exec(e))[0],l._lineIndents=[i],g(l,e.substring(i.length),!0))}},fences:{shouldClose:function(e){var t;return(e=p.exec(e))?((t=e[1][0]==this.cur._mark[0]&&e[1].length>=this.cur._mark.length?M.CLOSE_INCLUDE:M.NOT_CLOSE)==M.CLOSE_INCLUDE&&this.cur._mark!=e[1]&&this.cur.set("patternEnd",e[0]),t):M.NOT_CLOSE},onContinue:function(e){this.cur._lines.push(e)},onClose:function(e){var t=this.cur.get("pattern");let n=(/^\s+/.exec(t)||[""])[0];if(n){let e=!0;for(var i of this.cur._lines)if(0!=i.indexOf(n)){e=!1;break}e&&(this.cur._lines=this.cur._lines.map(e=>e.substr(n.length)),this.cur.set("userIndent",n))}this.cur.set("text",this.cur._lines.join("\n")),this.cur.set("empty",!this.cur._lines.length),e&&this.cur.set("noCloseTag",!0),this.cur._mark=void 0,this.cur._lines=void 0;t=this.lines[this.ln+1];void 0!==t&&t.match(k)&&(this.cur.set("tail",1),this.ln++)}},code:{shouldClose:function(e){return!e.match(E)&&(e.trim().length||1<this.cur._lines.length&&!this.cur._lines.last().trim().length)?M.CLOSE_EXCLUDE:M.NOT_CLOSE},onClose:function(){var e=this.lines[this.ln];e&&!e.trim().length&&this.cur._lines.push(e.replace(f,"")),1<this.cur._lines.length&&(this.cur._lines.last().match(k)?(this.cur.set("tail",1),this.cur._lines.pop(),1<this.cur._lines.length&&this.cur._lines.last().match(k)&&(this.cur._lines.pop(),this.ln--)):this.cur.set("tail",0)),this.cur.set("text",this.cur._lines.join("\n")),this.cur.attributes.type=H.fences,this.cur._lines=void 0},onContinue:function(e){this.cur._lines.push(e.replace(f,""))}}};function N(e,t,n){function i(e){return e=((e=(e[0]||"").trim().length?e:e.subarray(1)).last()||"").trim().length?e:e.subarray(0,e.length-1)}var r,o=[],a=[],s=0;for(l of File.option.strictMarkdown?ve:g)if(l.exec(e))return null;if(-1==e.indexOf("|"))for(var l of[T,re,oe,ae,se])if(l.exec(e))return null;if(e=e.replace(/(^|[^\\])((`+)([\s\S]*?[^`])\3(?!`))/g,function(e,t,n){return o.push(n),[t,"",++s-1,""].join("")}),File.option.enableInlineMath&&(s=0,e=e.replace(/\\\$/g,"").replace(/(^|[^\\])((\$+)([\s\S]*?[^$])\3(?!\$))/g,function(e,t,n){return a.push(n.replace(/\uE07D/g,"\\$")),s++,[t.replace(/\uE07D/g,"\\$"),"",s-1,""].join("")})),c=(e=e.replace(/\\\\/g,W.ESCAPE_ESCAPE).replace(/\\\|/g,W.ESCAPE_VLINE).replace(/\\\ /g,W.ESCAPE_SPACE)).split(_)||[e],"|"==e.trim()||!e.trim())return null;for(var c=i(c),s=(c=File.option.enableInlineMath&&(e=e.replace(/\uE071(\d+)\uE072/g,function(e,t){return a[+t]}),c.length<n)&&(r=i(e.split(_))).length==n?r:c).length;s<n;s++)c.push("");return c.map(function(e){return(e=e.replace(/\uE022/g,"\\ ").replace(new RegExp("","g"),"\\$").replace(/\uE071(\d+)\uE072/g,function(e,t){return a[+t]}).replace(/\uE07A(\d+)\uE07B/g,function(e,t){return o[+t]}))&&e.replace(new RegExp(W.ESCAPE_ESCAPE,"g"),"\\\\").replace(new RegExp(W.ESCAPE_VLINE,"g"),"\\|")})}var x=function(e,t,n,i,r){B=File.option.strictMarkdown?d:c;var o,a=e,s=(this.remap=File.shouldRemapPunctuation()&&(r.enableRemap||i&&i.cid==File.editor.focusCid),"string"==typeof e&&(a=e.split(u),e.charCodeAt(e.length-1)===m)&&--s,a.length);for(this.lines=a,e=t,n=n,i=i,r=r,(o=this).parent=e,o.cur=null,o.skips=r,o.ln=0,o.blocks=[],o.oldNode=i,o.nodeMap=e||i,o.nodeMap=(o.nodeMap?o.nodeMap.get("in"):n)||n,be=" ".repeat(File.option.indentSize),this.skips.enableMetaBlock=this.skips.enableMetaBlock&&!t;this.ln<=s;this.ln++)Ce.call(this,a[this.ln],s);for(var l=this.blocks.last();l;)t&&0!=l.get("tail")||l.unset("tail"),l=l.getLastChild();return this};function Ce(d,n){var e,t=this.ln>=n;function p(e){if(F.isType(this.cur,H.paragraph)&&this.cur._lines&&1==this.cur._lines.length&&this.cur._lines[0].match(k))return function(e){this.blocks.remove(e),e.remove()}.call(this,this.cur),this.cur=null,e.set("ahead",1),!0}function f(e){var t=this.lines[this.ln+1];if(void 0!==t&&t.match(k))return this.ln++,e.set("tail",1),!0;void 0!==t&&e.set("tail",0)}function m(e,t){var n,i=e=e||this.cur;this.oldNode&&!this.blocks.length?(this.oldNode!==e&&(n=e.get("userIndent"),this.oldNode.appendChildrenTillEnd(e.getFirstChild()),this.oldNode.copyContentFrom(e),this.oldNode.set("userIndent",n),e._lines&&(this.oldNode._lines=e._lines),e.remove()),this.blocks.push(this.oldNode),i=this.oldNode):(this.parent?this.parent.appendChild(e):this.blocks.length?this.blocks.last().addAfter(e):(console.sendError("parse error","error",e.getText()),e.set("parent",this.parent),e.set("in",this.nodeMap),e.set("attachTo",this.nodeMap)),this.blocks.push(e)),this.cur=t?i:null}function g(e,t){this.cur&&(F.isType(this.cur,H.paragraph)&&!(this.cur._lines||[]).length?this.cur=null:(a.onClose&&a.onClose.call(this,t),(t||this.ln<n-1)&&null==this.cur.get("tail")&&this.cur.set("tail",0),m.call(this,this.cur,e)))}function i(e,t,n){var i=new F({type:H.list,style:e,in:this.nodeMap,pattern:t});e==F.ListType.ol?(i.set("start",n),i._mark=(/[\.\)]/.exec(t)||[])[0]):i._mark=n,p.call(this,i),g.call(this,void 0,!0),this.cur=i}function r(e){var t=e?pe:he;if(n=N(d)){var n,i,r,o=this.ln+1,a=this.lines.length,s=this.lines[o],l=null,c=[d,s];if(o<a&&this.lines[o].match(t))for(l=[],o++;o<a&&(i=N(r=this.lines[o],0,n.length));o++)c.push(r),l.push(i);if(l)return(s=s.replace(/^ *\||\| *$/g,"").split(_)).length==n.length&&(u.call(this,n,s,l,o-1,e,c),!0)}return!1}function o(e){l=new F({type:H.toc,in:this.nodeMap,pattern:e}),p.call(this,l),f.call(this,l),g.call(this,!0),m.call(this,l)}function u(e,t,n,i,r,o){var a,s=(this.skips||{}).pass_format,l=new F({type:H.table,in:this.nodeMap,style:!s&&t&&r?"npTable":void 0}),c=e.length,d=s||function(e,t,n){if(t&&n)for(var i=0;i<e.length;i++){var r=(e[i]||"").length;if(!(40<r)){var o=$.wcswidth(e[i]);if(r!=(t[i]||"").length&&o!=$.wcswidth(t[i]))return!1;for(var a=0;a<n.length;a++){var s=(n[a]||[])[i]||"";if(!(40<s.length)&&(r!==s.length&&o!=$.wcswidth(s)))return!1}}}return!0}(e,t,n);function u(e,t){var n=new F({type:H.table_row,parent:e,in:e.get("in"),header:!a,before:a});for(h=0;h<c;h++)var i=(t[h]||"").match(/^\s*/)[0],r=(t[h]=(t[h]||"").substring(i.length),(t[h]||"").match(/\s*$/)[0]),o=new F({type:H.table_cell,parent:n,in:n.get("in"),before:o,text:(t[h]||"").trim(),marginLeft:d?void 0:i,marginRight:d?void 0:r});return n}l.set("alignText",d?void 0:t.slice(0)),!s&&t&&n&&l.set("userText",o),t=t||Array(e.length).fill(),n=n||[[]];for(var h=0;h<c;h++)t[h]=t[h]||"",t[h].match(/^ *-+: *$/)?t[h]="right":t[h].match(/^ *:-+: *$/)?t[h]="center":t[h].match(/^ *:-+ *$/)?t[h]="left":t[h]=null;l.set("align",t),a=u.call(this,l,e),n.forEach(function(e){a=u.call(this,l,e)},this),p.call(this,l),g.call(this),i&&(this.ln=i),f.call(this,l),m.call(this,l),this.cur=null}if(this.cur){var a=L[this.cur.get("type")],s=!t&&a.shouldClose.call(this,d);if(0<s||t){if(g.call(this,!1,t),2==s)return}else if(!s)return void(a.onContinue&&a.onContinue.call(this,d))}if(!t){if(!this.skips.old_code&&(e=E.exec(d)))return this.skips.fromP?(this.cur||(this.cur=new F({type:H.paragraph,in:this.nodeMap}),this.cur._lines=[]),void this.cur._lines.push(d)):void(F.isType(this.cur,H.code)&&a?a.onContinue&&a.onContinue.call(this,d):F.isType(this.cur,H.paragraph)&&(this.cur._lines.last()||"").trim().length?this.cur._lines.push(d):(l=new F({type:H.code,pattern:e[1],in:this.nodeMap}),p.call(this,l),l._lines=[e[2]],g.call(this),this.cur=l));if((e=ee.exec(d))&&F.isType(this.cur,H.paragraph)&&!$.isNullOrBlank(this.cur._lines.last()))l=new F({type:H.heading,depth:"="==e[1]?1:2,text:this.cur._lines.pop(),pattern:"{0}\n"+d,in:this.nodeMap}),p.call(this,l),g.call(this),f.call(this,l),m.call(this,l);else{var l,s=!0;if(d.match(this.remap?fe:te)){if(e=(File.option.strictMarkdown?I:O).exec(d))return l=new F({type:H.heading,depth:e[2].length,text:e[3],pattern:(this.skips.enableStartMatch?e[1].replace(/#$/,"# "):e[1])+"{0}"+(e[4]||""),in:this.nodeMap}),p.call(this,l),f.call(this,l),g.call(this),void m.call(this,l);if(e=ce.exec(d))return l=new F({type:H.def_footnote,ref:e[1],pattern:e[2],text:e[3],in:this.nodeMap}),p.call(this,l),f.call(this,l),g.call(this,!0),void m.call(this,l);if(e=le.exec(d))return l=new F({type:H.def_link,ref:e[1],href:e[3],title:e[8],in:this.nodeMap,pattern:"[;]:"+e[2]+";"+e[4]+(e[5]?";"+e[6]+";"+e[7]+";"+e[9]:"")}),p.call(this,l),f.call(this,l),g.call(this,!0),void m.call(this,l);if(this.skips.fromP)return this.cur||(this.cur=new F({type:H.paragraph,in:this.nodeMap}),this.cur._lines=[]),void this.cur._lines.push(d);if(this.skips.enableStartMatch&&(e=ue.exec(d))){var t=N(d);if(t&&1<t.length)return void u.call(this,t)}if(e=R.exec(d)){if(!/^(\s*>){10,}/.exec(d))return l=new F({type:H.blockquote,in:this.nodeMap,pattern:e[1]}),p.call(this,l),l._indent=e[1].replace(/^[ \u00A0]*>/,"").length,File.option.enableAlert&&(t=(/^\s*\[\!(note|warning|important|tip|caution)\]\s*/i.exec(e[2])||[])[1]||"")&&l.set("alert",t.toLowerCase()),l._lines=[],l._lineIndents=[],g.call(this),this.cur=l,void L.blockquote.onContinue.call(this,d);console.warn("too deep > level, ignore")}var c=this.remap?ye:de,h=/^\.\.\.$/;if(this.skips.enableMetaBlock&&0==this.ln&&d.match(c)){var y=this.ln+1,v=this.lines.length,b=void 0;if(!(x=this.skips.enableStartMatch||!1))for(;y<v;y++)if(this.lines[y].match(c)||this.lines[y].match(h)){b=(x=y>this.ln+1)?this.lines[y]:void 0;break}if(x)return l=new F({type:H.meta_block,in:this.nodeMap,text:this.lines.slice(this.ln+1,y).join("\n"),patternEnd:b}),p.call(this,l),this.ln=y,f.call(this,l),g.call(this,!0),void m.call(this,l)}if(this.remap&&d.match(me)){t=d.replace(/\u2013/g,"--").replace(/\u2014/g,"---");if(e=T.exec(t))return l=new F({type:H.hr,pattern:t.trim(),in:this.nodeMap}),p.call(this,l),f.call(this,l),g.call(this,!0),void m.call(this,l)}if(e=T.exec(d))return l=new F({type:H.hr,pattern:d.trim(),in:this.nodeMap}),p.call(this,l),f.call(this,l),g.call(this,!0),void m.call(this,l);if(e=S.ul.exec(d))return se.exec(this.lines[this.ln+1]||"")?(o.call(this,d+"\n"+this.lines[this.ln+1]),void this.ln++):(i.call(this,F.ListType.ul,e[2],e[3]),void(a=L[H.list]).onContinue.call(this,d,e[0],e[1].length));if(e=S.ol.exec(d)){t=e[0].match(/\d+/)[0].replace(/^1$/,"");if(!File.option.strictNumberStartOnNewLine||!t||1==+t.trim())return i.call(this,F.ListType.ol,e[0].replace(/\d+/,"{0}"),t),void(a=L[H.list]).onContinue.call(this,d,e[0],e[1].length)}if((e=d.match(ie))&&(s=!1,!this.skips.math_block)){var w,y=this.ln+1,v=this.lines.length,x=this.skips.enableStartMatch||!1,t=e[1];if(!x)for(;y<v;y++)if(e=this.lines[y].match(ie)){w=e[1],x=!0;break}if(x)return l=new F({type:H.math_block,in:this.nodeMap,tagBefore:t,tagAfter:w,text:this.lines.slice(this.ln+1,y).join("\n")}),p.call(this,l),this.ln=y,f.call(this,l),g.call(this,!0),void m.call(this,l)}if(e=ne.exec(d))return(l=new F({type:H.fences,lang:e[3],pattern:e[1]+"{0}",in:this.nodeMap}))._mark=e[2],l._lines=[],p.call(this,l),g.call(this),void(this.cur=l);var C,t=this.remap?ge:re;if(d.match(t))return void o.call(this,d.replace(/[\[\u3010]/,"[").replace(/[\]\u3011]/,"]"));if(d.match(oe))return void o.call(this,d);if(d.match(ae))return void o.call(this,d);if(r.call(this,!1))return;if(File.option.blockHTML&&(e=A.exec(d)))return l=new F({type:H.html_block,in:this.nodeMap,style:(e[1]||"").toLowerCase(),depth:0}),p.call(this,l),g.call(this,!0),(t=this.cur||(this.blocks||[]).last())&&F.isType(t,H.html_block)&&0===t.get("tail")&&!l.get("ahead")?(t!==this.oldNode&&t.detach(),this.blocks.pop(),(this.cur=t)._lines=t.get("text").split(/\n/),C=t.get("displayStyle")||t.get("style"),-1<U.HIDDEN_TYPE.indexOf(C)&&(C=e[1]),t.set("displayStyle",C),t.unset("tail"),t.set("style",e[1]),t.set("depth",0),l.remove(),l=t):(p.call(this,l),this.cur=l,this.cur._lines=[]),a=L[H.html_block],void(L.html_block.shouldClose.call(this,d)==M.CLOSE_INCLUDE?(g.call(this,!0),f.call(this,this.cur),this.cur=null):(this.cur._lines=this.cur._lines||[],this.cur._lines.push(d)))}s&&!this.skips.fromP&&r.call(this,!0)||(this.cur||(this.cur=new F({type:H.paragraph,in:this.nodeMap}),this.cur._lines=[]),F.isType(this.cur,H.paragraph)?this.cur._lines.push(d):a&&a.onContinue&&a.onContinue.call(this,d))}}}F.parseFrom=function(e,t,n,i){return new F({type:H.raw_edit,in:t,attachTo:(n=n||{}).noTop?null:t,text:e}).parseFrom(n,void 0,i)},F.prototype.parseFrom=function(e,t,n){var i,r,o;return e=e||{},F.isType(this.get("parent"),H.table_row)?(this.set("type",H.table_cell),this.set("text",this.safeGetStrAttr("text").replace(/\n|\r/gi,"").replace(/([^\\])\|/gi,"$1|")),[!n&&this.toHTML(),[this]]):F.isType(this,H.paragraph,H.raw_edit,H.html_block,H.list_item)?(i=this,i=(F.isType(i,H.list_item)&&!i.get("children").length?new F({type:H.paragraph,text:"",parent:i,in:i.get("in")}):null)||this,e=e.skips||{},t=t||i.get("text"),File.option.ignoreLineBreak&&(t=t.replace(/\u00a0/g," ")),e.enableMetaBlock=this.get("attachTo")&&!this.get("before"),e.old_code=!1!==e.old_code,this.isBlock(!0)?(r=this.get("before"),o=this.get("after"),(t=new x(t,null,i.get("in"),i,e).blocks).length<=1?[!n&&this.toHTML(),[this]]:(t[0].set("before",r),t.last().set("after",o),[!n&&a.NodeCollectionUtils.toHTML(t),t])):void 0):[!n&&this.toHTML(),[this]]};function Fe(e){if(e=e.last())return e.text||""}var i={escape:/^\\([\\:`*{}\[\]()#+\-.!_>$|<~"'&])/,escape2:/^[\uE013\uE014\uE018\uE020]/,autolink:/^<\uE016?((([^ >]+(@|:)[^ >]+))|(\s*www\.[^ >]+))\uE017?\uE019?>/,url:/^\uE016([^\uE017\uE019]+)(\uE017|(\uE019[-@+.,!\/~?%&=:#\uE006\w;()]*))/i,comment:/^<!--[\s\S]*?-->/,br:/^<w?br[\s/]*>(\s*<\/w?br>)*/i,tag:/^(?:<([A-Za-z][A-Za-z0-9-]*)(?:\s+[a-zA-Z_:][a-zA-Z0-9:._-]*(?:\s*=\s*(?:[^"'=<>`\x00-\x20]+|'[^']*'|"[^"]*"))?)*\s*(\/?)>|<(\/)([A-Za-z][A-Za-z0-9-]*)\s*[>]|[<][?].*?[?][>]|<![A-Z]+\s+[^>]*>|<!\[CDATA\[[\s\S]*?\]\]>)/,underline:/^<u>([^\r]*?\S)<\/u>/i,atag:/^(<a\s.+?>)(.*?)(<\/\s*a>)/i,imgtag:/^<img(\s+[^<]+)(\/?\s*>([^<]*(<\/img>))?)/i,link:/^\[((?:\[[^\]]*\]|[^\[\]])*)\]\(<?((?:\([^)]*\)|[^()])*?)>?(?:[ \t]+((['"])((?:.|\n)*?)\4[ \t]*))?\)/,image:/(^\!\[((?:\[[^\]]*\]|[^\[\]])*)\]\()(<?((?:\([^)]*\)|[^()])*?)>?[ \t]*((['"])((?:.|\n)*?)\6[ \t]*)?)(\)(?:\s*{([^{}\(\)]*)})?)/,reflink:/^(!?)\[(inside)\]\[([^\]]*)\]/,strong:/^(\*\*|__)(?=\S)([^\r]*?\S?[*_]?)\1/,strong_esp:/^\uE031([^\uE031]+)\uE031/,em1:/^(\_)(?=\S)([^\r]*?[^\s_])\1(?!\1)/,em2:/^(\*)(?=\S)([^\r]*?[^\s*])(\1{1}|\1{3})(?!\1)/,highlight:/^(\=\=)(?=\S)([^\r]*?\S)\1/,code:/^(`+)([\s\S]*?[^`])\1(?!`)/,code2:/^\uE023(\d+)\uE023/,del:/^~~(?=\S)([\s\S]*?\S)~~/,tab:/^[\t]+/,text:/^(\s|\S)+?[^\n\t\u200B\uE010-\uE020\uE006\uE023\uE031\\<!\[._*`&{\$\:~\^\="'\-]*/,footnote:/^\[\^([^\]\n]+)\]/,attr:/^{( *([#.][-\w_\uE006]+ *|[-\w_\uE006]+=[-\w_"'\uE006]+ *)+)}/,entity:/^&#?[a-z0-9]+;/i,emoji:/^(\u200B?):([+\-\w\uE006]+):(\u200B?)/,inline_math:/^\$(.|\n)*(?:[^\\])\$/,gitlab_inline_math:/^\$`(.|\n)*(?:[^\\])`\$/,subscript:/^~(([^\s\n]|(\\\s))+?)~/,superscript:/^\^(([^\s\n]|(\\\s))+?)\^/,linebreak:/[ \u00A0]{2}$/,emptyline:/^(\n)(?:\n|$)/,alert:/^\s*\[!(note|warning|important|tip|caution)\]\s*(\n|$)/i};function q(e,t,n){this.options=e||Q({},l.defaults),this.options.decorate=t||X.decorate,this.options.context=n||this,this.rules=i.normal,this.options.gfm?this.options.breaks?this.rules=i.breaks:this.rules=i.gfm:this.options.pedantic&&(this.rules=i.pedantic),File.option.enableHighlight&&(this.rules.escape2=/^[\uE013\uE014\uE015\uE018\uE020]/),File.option.enableSuperscript?File.option.enableHighlight?this.rules.escape=/^\\([\\:`*{}\[\]()#+\-.!_>$|<~"'&^=])/:this.rules.escape=/^\\([\\:`*{}\[\]()#+\-.!_>$|<~"'&^])/:File.option.enableHighlight&&(this.rules.escape=/^\\([\\:`*{}\[\]()#+\-.!_>$|<~"'&=])/)}i.comment_ext=/^<!(--|\u2013|\u2014)[\s\S]*?(--|\u2013|\u2014)>/,i.link_ext=/^[\[\u3010]((?:[\[\u3010][^\]\u3011]*[\u3011\]]|[^\[\]\u3010\u3011])*)[\]\u3011]\(<?((?:\([^)]*\)|[^()])*?)>?[ \t]*((["'])(?:(.|\n)*?)["'][ \t]*)?\)/,i.image_ext=/(^\![\[\u3010]((?:[\[\u3010][^\]\u3011]*[\]\u3011]|[^\[\]\u3010\u3011])*)[\]\u3011][\(\uff08])((.|\n)*)([\)\uff09](?:\s*{([^{}\(\)\uff08\uff09]*)})?)/,i.attr_ext=/^{( *([#.][-\w_\uE006]+ *|[-\w_\uE006]+=[-\w_"'«»‘’‚‛„‟‹›\uE006]+ *)+)}/,i._inside=/(?:\[[^\]]*\]|[^\[\]]|\](?=[^\[]*\]))*/,i._inside_ext=/(?:[\[\u3010][^\]\u3011]*[\]\u3011]|[^\[\]\u3010\u3011]|[\]\u3011](?=[^\[\u3010]*[\]\u3011]))*/,i.tag_ext=/^(?:<([A-Za-z][A-Za-z0-9-]*)(?:\s+[a-zA-Z_:][a-zA-Z0-9:._-]*(?:\s*=\s*(?:[^"'=<>`\x00-\x20]+|[’‚‛'‹›][^'’‚‛]*['’‚‛‹›]|["“«»„‟][^"“«»„‟]*["“«»„‟]))?)*\s*(\/?)>|<(\/)([A-Za-z][A-Za-z0-9-]*)\s*[>]|[<][?].*?[?][>]|<![A-Z]+\s+[^>]*>|<!\[CDATA\[[\s\S]*?\]\]>)/,i.reflink=Te(i.reflink)("inside",i._inside)(),i.normal=Q({},i),i.pedantic=Q({},i.normal,{strong:/^__(?=\S)([\s\S]*?\S)__(?!_)|^\*\*(?=\S)([\s\S]*?\S)\*\*(?!\*)/,em:/^_(?=\S)([\s\S]*?\S)_(?!_)|^\*(?=\S)([\s\S]*?\S)\*(?!\*)/}),i.gfm=i.normal,i.breaks=Q({},i.gfm,{text:Te(i.gfm.text)("{2,}","*")()}),q.rules=i;var W={UNDER_CHAR:"",MATH_CHAR:"",DEF_FOOT_PERFIX_CHAR:"",ESCAPE_SATR:"",ESCAPE_UNDERLINE:"",ESCAPE_EQUAL:"",URL_START:"",URL_END:"",ESCAPE_END_SQUARE_BRACKET:"",URL_MAY_END:"",ESCAPE_ESCAPE:"",ESCAPE_VLINE:"",ESCAPE_SPACE:"",CODE:""},z={"":"[^","":"*","":"_","":"=","":"]","":"\\"},Se={"":"_","":"","":"","":""},ke={"\\\\":W.ESCAPE_ESCAPE,"\\*":W.ESCAPE_SATR,"\\=":W.ESCAPE_EQUAL,"\\_":W.ESCAPE_UNDERLINE,"\\]":W.ESCAPE_END_SQUARE_BRACKET},Ee=/(?:(https?:\/\/(?:[a-z0-9]|\/|\.\.\/|(?:[-@+.,!\/~?%&=:#\uE006_](?![\s.~*-,_]|$)))+)|((?:mailto:\/{0,2})?[a-z0-9][a-z0-9\-_+\.\uE006]*@[a-z0-9](?:[a-z0-9\-_\uE006]{0,15}\.?){0,2}\.(?:com|co|net|org|edu|io|tv|fm|me|info|cc|ca|de|cn|ru|us|jp|au)(?:\.[a-z]+)*)|(www\.[a-z0-9][a-z0-9\-_\uE006]*(?:\.[a-z0-9\-_\uE006]+)+\/?(?:\/|\.\.\/|[a-z0-9]|(?:[-@+.,!\/~?%&=:#\uE006_](?![\s.~*-,_]|$)))*))/gi,V=0,J=new Map;function K(e){return e.replace(/(`+)([\s\S]*?[^`])\1(?!`)/g,function(e){return V++,J.set(V+"",e),W.CODE+V+W.CODE})}function Y(e,i){return e.replace(/\uE023(\d+)\uE023/g,function(e,t){var n=J.get(t)||"";return i||J.delete(t),n})}function G(e,t){return Y(e.replace(/[\uE006-\uE020]/g,function(e){return z[e]?"\\"+z[e]:Se[e]||""}),t).replace(/\uE031/g,"*")}q.skipLink={autolink:1,url:1,link:1,reflink:1};function Te(i,r){return i=i.source,r=r||"",function e(t,n){return t?(n=(n=n.source||n).replace(/(^|[^\[])\^/g,"$1"),i=i.replace(t,n),e):new RegExp(i,r)}}function Q(e){for(var t,n,i=1;i<arguments.length;i++)for(n in t=arguments[i])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}q.prototype.output=function(e,s,t,n,l){s=s||this.options.decorate,e=e||"",(n=Q(n||{},this.options.skipOp)).attr=!1!==n.attr,n.markLinebreak=!0,File.option.enableInlineMath||(n.inline_math=!0),File.option.enableSubscript||(n.subscript=!0),File.option.enableSuperscript||(n.superscript=!0),File.option.enableHighlight||(n.highlight=!0);function i(e,t){f[e]=(f[e]||0)+t}var r,o,a,c,d,u,h,p=(l=l||{cursorDiff:[],openQuote:null,hasContent:!1}).isCur||File.shouldRemapPunctuation(),f=l.cursorDiff||[],m=0,g=[],y=this.options,v=s==X.decorate,R=y.forPrint;function b(e,t){var n=e.last();n&&n.type===H.plain?n.text+=t:e.push({type:H.plain,text:t})}function w(e){for(var t="",n=0;n<e.length;n++){var i=e[n];if(i.type==H.tag){i.name=i.name||"";var r=-1<U.INLINE_TYPE.indexOf(i.name.toLowerCase()),o=-1<U.HIDDEN_TYPE.indexOf(i.name.toLowerCase()),a=R&&-1<U.UNSFAE_TAGS.indexOf(i.name.toLowerCase());if(0<i.pos&&v&&(r||o)||a){o=i.name||"",a=function(e,t,n){for(var i=1,r=t;r<e.length;r++)if(e[r].name==n&&(e[r].pos<0&&i--,0<e[r].pos&&i++,!i))return r;return 0}(e,n+1,o);if(0<a){t+=s({type:H.html_inline,inner:w(e.subarray(n+1,a)),name:o.toLowerCase(),before:i.text,after:e[a].text,isMeta:!r},y,l),n=a;continue}if(R){t+=s({type:H.html_inline,inner:"",name:o.toLowerCase(),before:i.text,after:"",isMeta:!r},y,l);continue}}}t+=s(i,y,l)}return t}for(1e5<e.length&&(t=!0,b(g,e),e=""),t||(e=function(e,t){for(var n,i=/([a-z0-9])_([a-z0-9])/gi;n=i.exec(e);)e=e.substring(0,n.index+1)+W.UNDER_CHAR+e.substring(n.index+2),i.lastIndex&&i.lastIndex--;return e=e.replace(/\\[\*_=\]\\]/gi,function(e){return ke[e]||e}).replace(/([^\\`]|^)(`+)([\s\S]*?[^`])\2(?!`)/g,function(e,t){return V++,J.set(V+"",e.substr(t.length)),t+W.CODE+V+W.CODE}),t&&e.length<2e4&&(Ee.lastIndex=0,e=e.replace(Ee,function(e,t,n,i){return-1<(""+t+i).indexOf("/")?W.URL_START+e+W.URL_MAY_END:W.URL_START+e+W.URL_END})),e}(e,!n.url&&!File.option.noAutoLink));e;)if(n.markLinebreak&&(C=/^\r?\n/.exec(e)))m+=C[0].length,e=e.substring(C[0].length),g.push({type:e||n.emptyline?H.softbreak:H.emptyline,text:"\n",inner:"\n"});else if(C=this.rules.escape2.exec(e))m+=C[0].length,e=e.substring(C[0].length),g.push({type:H.escape,text:z[C[0]]}),l.hasContent=!0;else if(C=this.rules.escape.exec(e))m+=C[0].length,e=e.substring(C[0].length),g.push({type:H.escape,text:C[1]}),l.hasContent=!0;else if(File.option.noAutoLink||n.autolink||!(C=this.rules.autolink.exec(e)))if(!n.url&&(C=this.rules.url.exec(e)))e=e.substring(C[0].length),c=C[0].replace(/[\uE016\uE017\uE019]/g,""),(C=/(&#?[a-z0-9]+;)([?!.,:**_~;]*)$/i.exec(c))?(c=c.substr(0,C.index+C[1].length),e=(C[2]||"")+e):((C=/[?!.,:**_~;]+$/.exec(c))&&(c=c.substr(0,C.index),e=C[0]+e),(C=/\)+$/.exec(c))&&0<(o=(c.match(/\)/g)||[]).length-(c.match(/\(/g)||[]).length)&&(C=new RegExp("\\){"+o+"}$").exec(c))&&(c=c.substr(0,C.index),e=C[0]+e)),m+=c.length,o=c,null===/^\w+:\/\//.exec(c)&&/@/.exec(c)&&(o="mailto:"+o),g.push({type:H.url,href:G(o),text:c}),l.hasContent=!0;else if(C=(p?this.rules.comment_ext:this.rules.comment).exec(e))m+=r=(c=Y(C[0])).length,e=e.substring(C[0].length),p&&(c=c.replace(/[\u2013\u2014]/g,"--"),f[m]=c.length-r),g.push({type:n.comment?H.tag:H.comment,text:c});else if(C=this.rules.br.exec(e))m+=C[0].length,e=e.substring(C[0].length),g.push({type:H.br,text:C[0]});else if(C=(File.shouldRemapPunctuation()?this.rules.tag_ext:this.rules.tag).exec(e))!n.underline&&(a=this.rules.underline.exec(e))?(m+=(c=Y(a[0])).length,e=e.substring(a[0].length),g.push({type:H.underline,inner:this.output((c==a[0]?a:this.rules.underline.exec(c))[1],s,!0,n,l),text:c}),l.hasContent=!0):!n.imgtag&&(a=this.rules.imgtag.exec(e))?(d=c=Y(a[0]),p&&(d=d.replace(/(\w=)[«»“”„‟〝〟]/g,'$1"').replace(/(\w=)[‚‘’‛‹›]/g,"$1'").replace(/[»«”“〞]([\s\/>]|$)/g,'"$1').replace(/[’‛‘›‹＇]([\s\/>]|$)/g,"'$1")),(u=(u=(/src\s*=\s*(['"])((.|\n)*?)\1/.exec(d)||[])[2])||(/src\s*=\s*([^\s'"]+)(\s|$)/.exec(d)||[])[1])?(m+=c.length,e=e.substring(a[0].length),S=(/\sstyle\s*=\s*(['"])(.+?)\1/.exec(d)||[])[2]||"",x=(/(^|[^\w-])width\s*:\s*(.+?)(\s*;|$)/.exec(S)||[])[2],F=(/(^|[^\w-])height*:\s*(.+?)(\s*;|$)/.exec(S)||[])[2],S=(/(^|[^\w-])zoom*:\s*(.+?)(\s*;|$)/.exec(S)||[])[2],k=(/\salign\s*=\s*(['"])(.+?)\1/.exec(d)||/\salign\s*=\s*((.+?))[\s/>]/.exec(d)||[])[2],x||(x=(/\swidth\s*=\s*(['"])(.+?)\1/.exec(d)||/\swidth\s*=\s*((.+?))[\s/>]/.exec(d)||[])[2],/\d\s*$/.exec(x||"")&&(x+="px;")),F||(F=(/\sheight\s*=\s*(['"])(.+?)\1/.exec(d)||/\sheight\s*=\s*((.+?))[\s/>]/.exec(d)||[])[2],/\d\s*$/.exec(F||"")&&(F+="px;")),g.push({type:H.imgtag,text:d,href:$.unescape(G(u)),width:x,height:F,zoom:S,align:k})):(m+=(c=Y(C[0])).length,e=e.substring(C[0].length),c=c.replace(/(\w=)[«»“”„‟〝〟]/g,'$1"').replace(/(\w=)[‚‘’‛‹›]/g,"$1'").replace(/[»«”“〞]([\s\/>]|$)/g,'"$1').replace(/[’‛‘›‹＇]([\s\/>]|$)/g,"'$1"),g.push({type:H.tag,text:G(c)})),l.hasContent=!0):(m+=(c=Y(C[0])).length,e=e.substring(C[0].length),c=c.replace(/(\w=)[«»“”„‟〝〟]/g,'$1"').replace(/(\w=)[‚‘’‛‹›]/g,"$1'").replace(/[»«”“〞]([\s\/>]|$)/g,'"$1').replace(/[’‛‘›‹＇]([\s\/>]|$)/g,"'$1"),"ruby"==(d={type:H.tag,pos:C[1]||C[4]?C[3]?-1:C[2]?0:1:0,name:(C[1]||C[4]||"").toLowerCase()}).name&&0<d.pos&&v&&(C=/<\/ruby>/.exec(e))?(m+=u=C.index+C[0].length,c+=e.substring(0,u),e=e.substring(u),d={type:H.ruby,text:G(c)}):d.text=G(c),g.push(d),l.hasContent=l.hasContent||-1==U.NO_TEXT_BLOCK_TYPE.indexOf(d.name));else if(l.hasContent=!0,n.alert&&(C=this.rules.alert.exec(e)))c=C[0],m+=r=(c=this.options.forExport?c:c.replace(/\n$/,"")).length,e=e.substring(c.length),g.push({type:H.alert_text,text:c,inner:C[1].toLowerCase()});else{if(!n.link&&(C=(p?this.rules.link_ext:this.rules.link).exec(e))){var x=C[0];if(e=e.substring(C[0].length),p&&(x=Y(x="["+C[1]+"]"+x.substring(C[1].length+2)),C=this.rules.link.exec(x)),C){m+=C[0].length,e=x.substr(C[0].length)+e,g.push({type:"link",href:G(C[2],!0),title:C[5],markdown:C[0],text:C[1]||"",inner:C[1]?this.output(C[1],s,!0,q.skipLink,l):"",meta:G(C[0].substring(C[1].length+2))});continue}e=K(x)+e}if(!n.image){if(!p&&(C=this.rules.image.exec(e))){if(m+=(c=Y(C[0])).length,e=e.substring(C[0].length),C=this.rules.image.exec(c)){g.push({type:"image",href:G(C[4]),title:C[7],markdown:C[0],components:[C[1],C[3],C[8]],alt:C[2],onlychild:!e&&!g.length});continue}e=K(c)+e,m-=c.length}if(p&&(C=this.rules.image_ext.exec(e))){r=C[0].length,e=e.substring(C[0].length);var C,F=Y(F=C[1].replace(/^!\u3010/g,"![").replace(/[\u3011\]][\uff08\)]$/g,"](")+C[3]+C[5].replace(/^\uff09/g,")"));if(C=this.rules.image.exec(F)){m+=C[0].length,e=F.substr(C[0].length)+e,g.push({type:"image",href:G(C[4]),title:C[7],markdown:F.substr(0,C[0].length),components:[C[1],C[3],C[8]],alt:C[2],onlychild:!e&&!g.length});continue}e=K(F)+e}}if(!n.footnote&&m&&(C=this.rules.footnote.exec(e))){if(c=Y(C[0]),e=e.substring(C[0].length),C=c!=C[0]?this.rules.footnote.exec(c):C){m+=C[0].length,e=c.substr(C[0].length)+e;var O=(C[2]||C[1]).replace(/\s+/g," ");g.push({type:H.footnote,inner:this.output(C[1],s,!0,q.skipLink,l),text:G(C[1])});continue}e=K(c)+e}if((C=this.rules.reflink.exec(e))&&(!n.reflink||C[1])){if(c=Y(C[0]),e=e.substring(C[0].length),C=c!=C[0]?this.rules.reflink.exec(c):C){m+=C[0].length,e=c.substr(C[0].length)+e;O=(C[3]||"").replace(/\s+/g," ");g.push({type:C[1]?"refimg":"reflink",ref:G(O),inner:this.output(C[2],s,!0,q.skipLink,l),text:G(C[2]),markdown:c,onlychild:!e&&!g.length});continue}e=K(c)+e}if(!n.attr&&(C=(p?this.rules.attr_ext:this.rules.attr).exec(e)))m+=(c=Y(C[0])).length,e=e.substring(C[0].length),g.push({type:H.attr,text:c});else if(C=/^\uE031\uE031([^\uE031]+)\uE031\uE031/.exec(e))m+=(c=Y(C[0],!0)).length,e=e.substring(C[0].length),g.push({type:H.strong,pattern:"**",inner:this.output(C[1],s,!0,n,l),text:c});else if(C=this.rules.strong.exec(e)){var S=/^\*\*\*([^\*]*[^\s*\s])\*\*/;(e=e.substring(C[0].length),S.exec(C[0]))?e=C[0].replace(S,"*$1")+e:(m+=(c=Y(C[0],!0)).length,g.push({type:H.strong,pattern:C[1],inner:this.output(C[2],s,!0,n,l),text:c}))}else if(C=this.rules.em1.exec(e))m+=(c=Y(C[0],!0)).length,e=e.substring(C[0].length),g.push({type:H.em,pattern:C[1],inner:this.output(C[2],s,!0,n,l),text:c});else if(C=this.rules.em2.exec(e)){var k=(C[2]+C[3].substring(1,3)).match(/\s\*(?!\*)/);k?(c=C[0].substr(0,k.index+1),m+=(C=/^\*+/.exec(c))[0].length,e=e.substring(C[0].length),b(g,C[0])):(m+=(c=Y(C[0],!0)).length,e=e.substring(C[0].length),g.push({type:H.em,pattern:C[1],inner:this.output(C[2]+C[3].substring(1,3),s,!0,n,l),text:c}))}else if((C=this.rules.code2.exec(e))&&(e=e.replace(this.rules.code2,function(e,t){var n=J.get(t)||"";return J.delete(t),n})),C=this.rules.code.exec(e))m+=C[0].length,e=e.substring(C[0].length),g.push({type:H.code,pattern:C[1],text:C[2]});else if(C=this.rules.del.exec(e))m+=(c=Y(C[0],!0)).length,e=e.substring(C[0].length),g.push({type:H.del,pattern:"~~",inner:this.output(C[1],s,!0,n,l),text:c});else if((C=this.rules.emoji.exec(e))&&Z.data[C[2]=C[2].replace(/\uE006/g,"_")])e=e.substring(C[0].length),g.push({type:H.emoji,text:C[2],inner:Z.data[C[2]]}),C[1].length||i(m,1),m+=C[0].length,C[3].length||i(m,1);else{if(!n.subscript&&(C=this.rules.subscript.exec(e))){if(c=Y(C[0]),e=e.substring(C[0].length),C=c!=C[0]?this.rules.subscript.exec(c):C){m+=C[0].length,e=c.substr(C[0].length)+e;var E=[];(C=C[1].split(/\\\s/g))[0]&&E.push({type:H.plain,text:C[0]});for(var T=1;T<C.length;T++)E.push({type:H.escape,text:" "}),C[T]&&E.push({type:H.plain,text:C[T]});g.push({type:H.subscript,inner:w(E),text:C[0]});continue}e=K(c)+e}if(!n.superscript&&(C=this.rules.superscript.exec(e))){if(c=Y(C[0]),e=e.substring(C[0].length),C=c!=C[0]?this.rules.superscript.exec(c):C){m+=C[0].length,e=c.substr(C[0].length)+e;E=[];(C=C[1].split(/\\\s/g))[0]&&E.push({type:H.plain,text:C[0]});for(T=1;T<C.length;T++)E.push({type:H.escape,text:" "}),C[T]&&E.push({type:H.plain,text:C[T]});g.push({type:H.superscript,inner:w(E),text:C[0]});continue}e=K(c)+e}if(!n.inline_math&&(C=this.rules.inline_math.exec(e))){var _,A=null,M=0,L="",I=/\$/,N="$";for(N=/^\$\$/.exec(C[0])?(A=/{|}|\$\$/g,"$$"):(A=/{|}|\$/g,"$"),A.exec(C[0]);_=A.exec(C[0]);){if(I.exec(_[0])&&M<=0&&"\\"!=C[0].substring(_.index-1,_.index)){L=C[0].substring(0,_.index+_[0].length);break}"{"===_[0]?"\\"===_.input[_.index-1]&&"\\"!==!_.input[_.index-2]||M++:"}"!==_[0]||"\\"===_.input[_.index-1]&&"\\"!==!_.input[_.index-2]||M--}var D,P=N.length;0<L.length-2*P&&/[^\s$]/.exec(L)?(e=e.substring(L.length),-1<(D=(L=Y(L)).indexOf("​"))&&(f[m+D+1]=-1),m+=L.length,g.push({type:"inline_math",text:G(L.substring(P,L.length-P)),pattern:N})):(m+=(c=Y(C[0])).length,e=e.substring(C[0].length),b(g,c||""))}else if(!n.highlight&&(C=this.rules.highlight.exec(e)))m+=(c=Y(C[0],!0)).length,e=e.substring(C[0].length),g.push({type:H.highlight,inner:this.output(C[2],s,!0,n,l),text:G(C[2],!0)});else if(C=this.rules.entity.exec(e))m+=C[0].length,e=e.substring(C[0].length),$.decodeHtmlEntity(C[0])?g.push({type:H.html_entity,inner:C[0],text:C[0]}):b(g,C[0]||"");else{if(File.option.convertSmartOnRender&&File.option.smartDash){if(C=/^(---)($|[^-])/.exec(e)){m+=C[1].length,e=e.substring(C[1].length),g.push({type:H.pants,inner:"—",desc:"em_dash",meta:"--",text:"---"});continue}if(C=/^--/.exec(e)){e=e.substring(C[0].length),m+=C[0].length,g.push({type:H.pants,inner:File.option.twoHyphensToEm?"—":"–",desc:File.option.twoHyphensToEm?"em_dash":"en_dash",meta:"-",text:"--"});continue}if(C=/^\.{3}/.exec(e)){m+=C[0].length,"."!==(e=e.substring(C[0].length))[4]?g.push({type:H.pants,inner:"…",desc:"ellipsis",meta:"..",text:"..."}):b(g,C[0]);continue}}if(File.option.convertSmartOnRender&&File.option.smartQuote){if('"'==e[0]){if(D=(h=Fe(g)||"")[h.length-1]||"",/([\(\{\[\s\-/\u2018])$/.exec(h)||D==j.userQuote(2)){m++,e=e.substring(1),g.push({type:H.pants,inner:j.userQuote(0,void 0,!0),desc:"open_double",text:'"'});continue}if(C=/^"($|[\)\s/.,;:?!\u2019])/.exec(e)){m++,e=e.substring(1),g.push({type:H.pants,inner:j.userQuote(1,void 0,!0),desc:"close_double",text:'"'});continue}if(function(e){for(var t=e.length-1;0<=t;t--)if(e[t].type==H.pants){if("open_double"==e[t].desc)return!0;if("close_double"==e[t].desc)return!1}return!1}(g)){m++,e=e.substring(1),g.push({type:H.pants,inner:j.userQuote(1,void 0,!0),desc:"close_double",text:'"'});continue}m++,e=e.substring(1),g.push({type:H.pants,inner:j.userQuote(0,void 0,!0),desc:"open_double",text:'"'});continue}if("'"==e[0]){if(l.openQuote&&(C=/^'($|[\)\s".,;:?!-])/.exec(e))){m++,e=e.substring(1),g.push({type:H.pants,inner:j.userQuote(3),desc:"close_single",text:"'"}),l.openQuote.inner=j.userQuote(2),l.openQuote.desc="open_single",l.openQuote=null;continue}if(h=Fe(g)||"",e.length<=1&&/((^|[\s])$)/.exec(h)){m+=e.length,b(g,e),e="";continue}m++,e=e.substring(1),g.push({type:H.pants,inner:"’"==j.userQuote(3)?"’":"'",desc:"close_single",text:"'"}),/(^|[\(\s"-])$/.exec(h)&&(l.openQuote=g.last());continue}}if(C=this.rules.tab.exec(e))m+=C[0].length,e=e.substring(C[0].length),g.push({type:H.tab,inner:C[0],text:C[0]});else if(C=this.rules.text.exec(e))m+=C[0].length,"\n"==(e=e.substring(C[0].length))[0]&&this.rules.linebreak.exec(C[0]||"")?(m++,e=e.substring(1),b(g,C[0].replace(this.rules.linebreak,"")),g.push({type:H.linebreak,text:"  \n",isLast:!e})):b(g,C[0]||"");else if(e)throw new Error("Infinite loop on byte: "+e.charCodeAt(0))}}}else m+=C[0].length,e=e.substring(C[0].length),c=C[1],o="@"!==C[4]||":"===C[1].charAt(6)?c:"mailto:"+C[1],g.push({type:H.autolink,href:G(o),text:c}),l.hasContent=!0;var B=w(g);return B=t?B:G(B,{})};var _e=/^( *)[*+-][ \t\u00A0]+(\[(x|X)\]|\[ \]) +/,Ae=/^( *)[*+-][ \t\u00A0]+/,Me=/^( *)\d+(\.|\))[ \t\u00A0]+/,Le=/^( *)1(\.|\))[ \t\u00A0]+/,Ne=function(){return File.shouldRemapPunctuation()?/^ *[>〉》][^\n]+/:/^ *>[^\n]+/};var De=/^( *#{1,6}\s*)([^\n]+?)(\s+#+ *)*$/m,Pe=/^( *#{1,6}\s+)([^\n]+?)(\s+#+ *)*$/m;function C(e,r,t,o,n,i){var a=[],s="",l={cursorDiff:n};function c(e,t,n){var i=[];return i[0]=e.substr(0,t.index),i[1]=e.substr(t.index,t[0].length),i[2]=e.substr(t.index+t[0].length),i.map(function(e,t){return 1==t?r.options.decorate(n):e?r.options.decorate({type:H.paragraph,inner:r.output(e,null,null,{attr:!F.isType(o,H.heading),emptyline:2!=t},l)}):""}).join("")}for(o&&o.cid==File.editor.focusCid&&(l.isCur=!0);e;){if(!t&&/^\s*[-+*_<\[\{|#0-9`~=>$]/m.exec(e)){if(a=/^ *>[^\n]+/m.exec(e)){s=c(e,a,{type:H.blockquote,pattern:a[0].match(/^( *> ?)+/gm)[0],inner:C(a[0].replace(/^( *> ?)+/gm,""),r,!0,o,n)});break}if(a=(File.option.strictMarkdown?Pe:De).exec(e)){var d="h"+a[0].match(/#/g).length;i.push(d),s=c(e,a,{type:H.heading,meta_before:a[0].substring(0,a[1].length),meta_after:a[3]||"",mdlike:d,inner:r.output(a[2],null,null,{attr:!1},l)});break}if(a=/^( *(`{3,}|~{3,}|·{3,})[ \t\u00A0]*)([^\n`]+)? *$/m.exec(e)){s=c(e,a,{type:H.fences,lang:a[3],pattern:a[1]});break}if(a=/^\s*\[\^([^\]\n]+)\]:(\s*)([^\n]*)$/m.exec(e)){s=c(e,a,{type:H.def_footnote,ref:a[1],pattern:a[2],inner:r.output(a[3]||"",null,null,null,l)});break}if(a=/^\s*\[([^\]\n]+)\]:(\s*)([^\n]*)/m.exec(e)){s=c(e,a,{type:H.def_link,ref:a[1],pattern:a[2],inner:r.output(a[3]||"",null,null,null,l)});break}if(a=/^(\s*)(([-+*]|\d+(\.|\)))[ \t]+)/m.exec(e)){s=c(e,a,{type:"block",inner:r.output(a[0]||"",null,null,null,l)});break}if(a=/^\s*(\$\$|\[toc\])\s*$/im.exec(e)){s=c(e,a,{type:"block",inner:r.output(a[0]||"",null,null,null,l)});break}if(a=/^\s*([-+_*])\s*\1\s*\1(\s|\1)*$/m.exec(e)){s=c(e,a,{type:"block",inner:r.output(a[0]||"",null,null,null,l)});break}if(a=/^ *\|([^\|]+\|.+)\|\s*$/m.exec(e)){s=c(e,a,{type:"block",inner:r.output(a[0]||"",null,null,null,l)});break}}d=o.get("parent");F.isType(o,H.paragraph)&&!o.get("before")&&F.isType(d,H.blockquote)&&d.get("alert")&&(l.alert=!0),s=r.options.decorate({type:H.paragraph,inner:r.output(e,null,null,{attr:!F.isType(o,H.heading),alert:l.alert},l)});break}return s}var s,l={};l.options=l.setOptions=function(e){return Q(l.defaults,e),l},l.defaults={gfm:!0,tables:!0,breaks:!1,pedantic:!1,sanitize:!1,smartLists:!1,silent:!1,highlight:null,langPrefix:"lang-",smartypants:!1,headerPrefix:""},l.parseInline=function(e,t,n){return s||(s=new q,l.defaultInlineLexer=s),s.output(e,null,null,t,{cursorDiff:n})},l.parsePandocAttr=function(e){var n={};return e&&"{"==e[0]&&"}"==e[e.length-1]&&((e=e.replace(/(^{)|(}$)/g,"")).split(/\s+/)||[e]).forEach(function(e){var t;(t=/^#(.+)/.exec(e))?n.id=$.escapeInQuote(t[1]):(t=/^\.(.+)/.exec(e))?n.class=(n.class||"")+" "+$.escapeInQuote(t[1]):(t=/^(.+)=(['"])([^'"]+)\2/.exec(e))&&(n.attr=(n.attr||"")+" "+e,n.nativeAttr=n.nativeAttr||{},n.nativeAttr[t[1]]=t[3])}),n},l.attrToString=function(e){var t="";return e.id&&(t+=" id='"+e.id+"'"),e.class&&(t+=" class='"+e.class.trim()+"'"),e.attr&&(t+=e.attr),t},l.InlineLexer=q,l.quickParse=function s(l,c,d,e,t,o){var n,i,a=0,u=d,r=[];function h(e,t,n){return new F({type:n||H.paragraph,text:e,parent:t,in:t.get("in")})}function p(e,t,n,i){c.editor.undo.endSnap(!0),n.cid==c.editor.focusCid&&c.editor.store(),t.undo.push(b.buildReplaceUndo(n));var r=null;return i&&i.start?(a=a-i.start+e.length,r=new F({type:H.paragraph,text:l.substring(0,i.start-1)}),n.addBefore(r),b.addUndoForInsert(t,r)):a+=e.length,l=l.substring((i?i.start:0)+e.length),r}function f(e,t,n,i,r){return i=i||s(l,c,e,!1,t,o),t.redo.push(b.buildReplaceUndo(n)),{html:(r?r.toHTML():"")+n.toHTML(i.html),offset:a+i.offset,focus:i.focus,blockChanged:!0,command:t}}function m(e,t,n,i){var r,o=File.option.indentSize,a=p(e=e.replace("【","[").replace("】","]"),t,d,i);return d.set("type",H.list),d.set("text",""),d.set("style",n),(r=h("",d,H.list_item)).set("checked",null!=/x|X/g.exec(i.line)),-1<e.indexOf("[")&&r.set("style",F.ListType.task),n==F.ListType.ul&&(File.option.prettyIndent?d.set("pattern",e.replace(/\[[xX\s]\]\s+/,"").trim()+" ".repeat(o-1)):d.set("pattern",e.replace(/\[[xX\s]\]\s+/,"").trim()+" ")),n==F.ListType.ol&&(""!=(i=e.match(/\d+/)[0].replace(/^1$/,""))?d.set("start",i):d.unset("start"),File.option.prettyIndent?d.set("pattern",e.replace(/\d+/,"{0}").trim()+" ".repeat(o-1)):d.set("pattern",e.replace(/\d+/,"{0}").trim()+" ")),e&&File.option.autoPairExtendSymbol&&/\*\s$/.exec(e)&&(l=l.replace(/^\*/,"")),u=h(l,r,H.paragraph),(n=s(l,c,u,!1)).html=r.toHTML(n.html),f(null,t,d,n,a)}if(t=t||!e&&b.makeEmptyCommand(),File.option.strictMarkdown&&(_e=File.shouldRemapPunctuation()?/^( {0,3})[*+-][ \t\u00A0]+([\[【](x|X)[\]】]|[\[【] [\]】]) +/:/^( {0,3})[*+-][ \t\u00A0]+(\[(x|X)\]|\[ \]) +/,Ae=/^( {0,3})[*+-][ \t\u00A0]+/,Me=/^( {0,3})\d+(\.|\))[ \t\u00A0]+/,Le=/^( {0,3})1(\.|\))[ \t\u00A0]+/),o&&void 0===o.endId&&(o.endId=o.id),o&&void 0===o.startId&&(o.startId=o.id),!(e=e||!o||o.endId!=d.cid)){var g=$.findLine(l,o.end);if(Ne().exec(g.line)){if(!/^(\s*>){10,}/.exec(g.line))return n=t,i=p((i=g).line.match(/^ *[>〉》][ \u00A0]?/)[0],n,d,i),d.set("type",H.blockquote),d.set("text",""),u=h(l,d),n.redo.push(b.buildReplaceUndo(d)),f(u,n,d,void 0,i)}else{if(n=_e.exec(g.line))return m(n[0],t,F.ListType.ul,g);if(n=Ae.exec(g.line))return m(n[0],t,F.ListType.ul,g);if(n=(File.option.strictNumberStartOnNewLine&&g.start?Le:Me).exec(g.line))return m(n[0],t,F.ListType.ol,g);if(i=l,v=(g=d).get("parent"),n=F.isType(g,H.paragraph)&&!g.get("before")&&F.isType(v,H.list_item)&&v.get("style")!==F.ListType.task&&v.get("parent").get("style")==F.ListType.ul&&(File.shouldRemapPunctuation()?/(^ *[\[【](x|X)[\]】]( |\t)+)|((^ *[\[【] [\]】]) +)/g:/(^ *\[(x|X)\]( |\t)+)|((^ *\[ \]) +)/g).exec(i))return g=n[0],v=t,y=d.get("parent"),p(g,v,y),y.set("style",F.ListType.task),y.set("checked",null!=/x|X/g.exec(g)),d.set("text",l),(g=s(l,c,u=d,!0,v)).html=void 0,(v=f(null,v,y,g)).replaceCid=y.cid,v;if(g=d,File.option.enableAlert&&F.isType(g.get("parent"),H.blockquote)&&F.isType(g,H.paragraph)&&!g.get("before")){var y=function(e,t){var n,i=d.get("parent"),r=/^\s*\[\!(note|warning|important|tip|caution)\]\s*(\n|$)/gi.exec(e),o=(r||[])[1]||"";if(o.toLowerCase()!=(i.get("alert")||""))return 0===(n=editor.undo.lastRegisteredOperationCommand()).source.indexOf(d.cid+"#")&&(editor.undo.removeLastRegisteredOperationCommand(),b.append(t,n)),p(d.get("text"),t,i),a=0,i.set("alert",o.toLowerCase()),d.set("text",e),n=d.get("after"),o=o&&!r[0].length<=e.length,!n&&o&&(n=new F({type:H.paragraph,text:""}),d.addAfter(n),b.addUndoForInsert(t,n,d)),(r=f(null,t,i,{offset:0,focus:(o?n:d).cid,blockChanged:!0,command:t,cursorDiff:[]})).replaceCid=i.cid,r}(l,t);if(y)return y}}}var v=[],g={innerHtml:C(l,c.inline,e||F.isType(d,H.heading),d,r,v),offset:0,focus:d.cid,blockChanged:!1,command:t,cursorDiff:r,mdlike:v[0]};return g.html=d&&d.toHTML(g.innerHtml,v[0]),g},l.reDefLink=le,l.reDefFootnote=ce,l.reOL=S[F.ListType.ol],l.renderHtmlWithBlockMeta=function e(t,n){var i,r;if(F.isType(t,H.paragraph))return i=[],r=C(t.safeGetStrAttr("text"),n.inline,!1,t,[],i),t.toHTML(r,i[0]);if(t.get("children").length){for(var o=t.getFirstChild(),a=[];o;)a.push(e(o,n)),o=o.get("after");return t.toHTML(a.join(""))}return t.toHTML(void 0,void 0,{mathCount:0})},l.splitTableCell=N,l.recoverEscape=G,l.brushContent=C,n.exports=l}),!function(i){"object"==typeof exports&&void 0!==module?module.exports=i():$__System.registerDynamic("16",[],!1,function(e,t,n){return i.call(this)})}(function(){"use strict";var e=Object.freeze||function(e){return e},ye=e(["a","abbr","acronym","address","area","article","aside","audio","b","bdi","bdo","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","content","data","datalist","dd","decorator","del","details","dfn","dir","div","dl","dt","element","em","fieldset","figcaption","figure","font","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","img","input","ins","kbd","label","legend","li","main","map","mark","marquee","menu","menuitem","meter","nav","nobr","ol","optgroup","option","output","p","pre","progress","q","rp","rt","ruby","s","samp","section","select","shadow","small","source","spacer","span","strike","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","tr","track","tt","u","ul","var","video","wbr"]),ve=e(["svg","a","altglyph","altglyphdef","altglyphitem","animatecolor","animatemotion","animatetransform","audio","canvas","circle","clippath","defs","desc","ellipse","filter","font","g","glyph","glyphref","hkern","image","line","lineargradient","marker","mask","metadata","mpath","path","pattern","polygon","polyline","radialgradient","rect","stop","style","switch","symbol","text","textpath","title","tref","tspan","video","view","vkern"]),be=e(["feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence"]),we=e(["math","menclose","merror","mfenced","mfrac","mglyph","mi","mlabeledtr","mmultiscripts","mn","mo","mover","mpadded","mphantom","mroot","mrow","ms","mspace","msqrt","mstyle","msub","msup","msubsup","mtable","mtd","mtext","mtr","munder","munderover"]),xe=e(["#text"]),e=Object.freeze||function(e){return e},Ce=e(["accept","action","align","alt","autocomplete","background","bgcolor","border","cellpadding","cellspacing","checked","cite","class","clear","color","cols","colspan","controls","coords","crossorigin","datetime","default","dir","disabled","download","enctype","face","for","headers","height","hidden","high","href","hreflang","id","integrity","ismap","label","lang","list","loop","low","max","maxlength","media","method","min","minlength","multiple","name","noshade","novalidate","nowrap","open","optimum","pattern","placeholder","poster","preload","pubdate","radiogroup","readonly","rel","required","rev","reversed","role","rows","rowspan","spellcheck","scope","selected","shape","size","sizes","span","srclang","start","src","srcset","step","style","summary","tabindex","title","type","usemap","valign","value","width","xmlns"]),Fe=e(["accent-height","accumulate","additive","alignment-baseline","ascent","attributename","attributetype","azimuth","basefrequency","baseline-shift","begin","bias","by","class","clip","clip-path","clip-rule","color","color-interpolation","color-interpolation-filters","color-profile","color-rendering","cx","cy","d","dx","dy","diffuseconstant","direction","display","divisor","dur","edgemode","elevation","end","fill","fill-opacity","fill-rule","filter","filterunits","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","fx","fy","g1","g2","glyph-name","glyphref","gradientunits","gradienttransform","height","href","id","image-rendering","in","in2","k","k1","k2","k3","k4","kerning","keypoints","keysplines","keytimes","lang","lengthadjust","letter-spacing","kernelmatrix","kernelunitlength","lighting-color","local","marker-end","marker-mid","marker-start","markerheight","markerunits","markerwidth","maskcontentunits","maskunits","max","mask","media","method","mode","min","name","numoctaves","offset","operator","opacity","order","orient","orientation","origin","overflow","paint-order","path","pathlength","patterncontentunits","patterntransform","patternunits","points","preservealpha","preserveaspectratio","primitiveunits","r","rx","ry","radius","refx","refy","repeatcount","repeatdur","restart","result","rotate","scale","seed","shape-rendering","specularconstant","specularexponent","spreadmethod","stddeviation","stitchtiles","stop-color","stop-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke","stroke-width","style","surfacescale","tabindex","targetx","targety","transform","text-anchor","text-decoration","text-rendering","textlength","type","u1","u2","unicode","values","viewbox","visibility","version","vert-adv-y","vert-origin-x","vert-origin-y","width","word-spacing","wrap","writing-mode","xchannelselector","ychannelselector","x","x1","x2","xmlns","y","y1","y2","z","zoomandpan"]),Se=e(["accent","accentunder","align","bevelled","close","columnsalign","columnlines","columnspan","denomalign","depth","dir","display","displaystyle","encoding","fence","frame","height","href","id","largeop","length","linethickness","lspace","lquote","mathbackground","mathcolor","mathsize","mathvariant","maxsize","minsize","movablelimits","notation","numalign","open","rowalign","rowlines","rowspacing","rowspan","rspace","rquote","scriptlevel","scriptminsize","scriptsizemultiplier","selection","separator","separators","stretchy","subscriptshift","supscriptshift","symmetric","voffset","width","xmlns"]),ke=e(["xlink:href","xml:id","xlink:title","xml:space","xmlns:xlink"]),i=Object.hasOwnProperty,o=Object.setPrototypeOf,e="undefined"!=typeof Reflect&&Reflect;function Ee(e,t){o&&o(e,null);for(var n=t.length;n--;){var i,r=t[n];"string"==typeof r&&(i=r.toLowerCase())!==r&&(Object.isFrozen(t)||(t[n]=i),r=i),e[r]=!0}return e}function Te(e){var t={},n=void 0;for(n in e)r(i,e,[n])&&(t[n]=e[n]);return t}var r=(r=e.apply)||function(e,t,n){return e.apply(t,n)},e=Object.seal||function(e){return e},_e=e(/\{\{[\s\S]*|[\s\S]*\}\}/gm),Ae=e(/<%[\s\S]*|[\s\S]*%>/gm),Me=e(/^data-[\-\w.\u00B7-\uFFFF]/),Le=e(/^aria-[\-\w]+$/),Ne=e(/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|cid|xmpp):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i),De=e(/^(?:\w+script|data):/i),Pe=e(/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205f\u3000]/g),Be="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function Re(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}var Oe=("undefined"!=typeof Reflect&&Reflect).apply,Ie=Array.prototype.slice,$e=Object.freeze,Oe=Oe||function(e,t,n){return e.apply(t,n)};return function R(e){var s=0<arguments.length&&void 0!==e?e:"undefined"==typeof window?null:window,d=function(e){return R(e)};if(d.version="2.0.7",d.removed=[],s&&s.document&&9===s.document.nodeType){var l=s.document,O=!1,I=!1,r=s.document,$=s.DocumentFragment,e=s.HTMLTemplateElement,c=s.Node,t=s.NodeFilter,H=void 0===(n=s.NamedNodeMap)?s.NamedNodeMap||s.MozNamedAttrMap:n,U=s.Text,j=s.Comment,q=s.DOMParser,n=s.TrustedTypes,u=("function"==typeof e&&(e=r.createElement("template")).content&&e.content.ownerDocument&&(r=e.content.ownerDocument),function(e,t){if("object"!==(void 0===e?"undefined":Be(e))||"function"!=typeof e.createPolicy)return null;var n=null,i="data-tt-policy-suffix",t="dompurify"+((n=t.currentScript&&t.currentScript.hasAttribute(i)?t.currentScript.getAttribute(i):n)?"#"+n:"");try{return e.createPolicy(t,{createHTML:function(e){return e}})}catch(e){return console.warn("TrustedTypes policy "+t+" could not be created."),null}}(n,l)),W=u?u.createHTML(""):"",e=r,o=e.implementation,z=e.createNodeIterator,V=e.getElementsByTagName,J=e.createDocumentFragment,K=l.importNode,i={},h=(d.isSupported=o&&void 0!==o.createHTMLDocument&&9!==r.documentMode,_e),p=Ae,Y=Me,G=Le,Q=De,X=Pe,a=Ne,f=null,Z=Ee({},[].concat(Re(ye),Re(ve),Re(be),Re(we),Re(xe))),m=null,ee=Ee({},[].concat(Re(Ce),Re(Fe),Re(Se),Re(ke))),g=null,y=null,te=!0,v=!0,ne=!1,ie=!1,b=!1,w=!1,x=!1,C=!1,F=!1,S=!1,re=!1,k=!1,oe=!0,E=!0,T=!1,_={},ae=Ee({},["annotation-xml","audio","colgroup","desc","foreignobject","head","iframe","math","mi","mn","mo","ms","mtext","noembed","noframes","plaintext","script","style","svg","template","thead","title","video","xmp"]),se=Ee({},["audio","video","img","source","image","iframe"]),A=null,le=Ee({},["alt","class","for","id","label","name","pattern","placeholder","summary","title","value","style","xmlns"]),M=null,ce=r.createElement("form"),L=function(e){M&&M===e||(e&&"object"===(void 0===e?"undefined":Be(e))||(e={}),f="ALLOWED_TAGS"in e?Ee({},e.ALLOWED_TAGS):Z,m="ALLOWED_ATTR"in e?Ee({},e.ALLOWED_ATTR):ee,A="ADD_URI_SAFE_ATTR"in e?Ee(Te(le),e.ADD_URI_SAFE_ATTR):le,g="FORBID_TAGS"in e?Ee({},e.FORBID_TAGS):{},y="FORBID_ATTR"in e?Ee({},e.FORBID_ATTR):{},_="USE_PROFILES"in e&&e.USE_PROFILES,te=!1!==e.ALLOW_ARIA_ATTR,v=!1!==e.ALLOW_DATA_ATTR,ne=e.ALLOW_UNKNOWN_PROTOCOLS||!1,ie=e.SAFE_FOR_JQUERY||!1,b=e.SAFE_FOR_TEMPLATES||!1,w=e.WHOLE_DOCUMENT||!1,F=e.RETURN_DOM||!1,S=e.RETURN_DOM_FRAGMENT||!1,re=e.RETURN_DOM_IMPORT||!1,k=e.RETURN_TRUSTED_TYPE||!1,C=e.FORCE_BODY||!1,oe=!1!==e.SANITIZE_DOM,E=!1!==e.KEEP_CONTENT,T=e.IN_PLACE||!1,a=e.ALLOWED_URI_REGEXP||a,b&&(v=!1),S&&(F=!0),_&&(f=Ee({},[].concat(Re(xe))),m=[],!0===_.html&&(Ee(f,ye),Ee(m,Ce)),!0===_.svg&&(Ee(f,ve),Ee(m,Fe),Ee(m,ke)),!0===_.svgFilters&&(Ee(f,be),Ee(m,Fe),Ee(m,ke)),!0===_.mathMl)&&(Ee(f,we),Ee(m,Se),Ee(m,ke)),e.ADD_TAGS&&Ee(f=f===Z?Te(f):f,e.ADD_TAGS),e.ADD_ATTR&&Ee(m=m===ee?Te(m):m,e.ADD_ATTR),e.ADD_URI_SAFE_ATTR&&Ee(A,e.ADD_URI_SAFE_ATTR),E&&(f["#text"]=!0),w&&Ee(f,["html","head","body"]),f.table&&(Ee(f,["tbody"]),delete g.tbody),$e&&$e(e),M=e)},N=function(t){d.removed.push({element:t});try{t.parentNode.removeChild(t)}catch(e){t.outerHTML=W}},D=function(e,t){try{d.removed.push({attribute:t.getAttributeNode(e),from:t})}catch(e){d.removed.push({attribute:null,from:t})}t.removeAttribute(e)},P=function(e){var t,n=void 0,i=void 0;if(C?e="<remove></remove>"+e:(i=(t=e.match(/^[\s]+/))&&t[0])&&(e=e.slice(i.length)),O)try{n=(new q).parseFromString(e,"text/html")}catch(e){}return I&&Ee(g,["title"]),n&&n.documentElement||((t=(n=o.createHTMLDocument("")).body).parentNode.removeChild(t.parentNode.firstElementChild),t.outerHTML=u?u.createHTML(e):e),e&&i&&n.body.insertBefore(r.createTextNode(i),n.body.childNodes[0]||null),V.call(n,w?"html":"body")[0]};if(d.isSupported){try{P('<svg><p><textarea><img src="</textarea><img src=x abc=1//">').querySelector("svg img")&&(O=!0)}catch(e){}try{var de=P("<x/><title>&lt;/title&gt;&lt;img&gt;");/<\/title/.test(de.querySelector("title").innerHTML)&&(I=!0)}catch(e){}}var ue=function(e){return z.call(e.ownerDocument||e,e,t.SHOW_ELEMENT|t.SHOW_COMMENT|t.SHOW_TEXT,function(){return t.FILTER_ACCEPT},!1)},he=function(e){return"object"===(void 0===c?"undefined":Be(c))?e instanceof c:e&&"object"===(void 0===e?"undefined":Be(e))&&"number"==typeof e.nodeType&&"string"==typeof e.nodeName},B=function(e,t,n){i[e]&&i[e].forEach(function(e){e.call(d,t,n,M)})},pe=function(e){var t=void 0;if(B("beforeSanitizeElements",e,null),(n=e)instanceof U||n instanceof j||"string"==typeof n.nodeName&&"string"==typeof n.textContent&&"function"==typeof n.removeChild&&n.attributes instanceof H&&"function"==typeof n.removeAttribute&&"function"==typeof n.setAttribute&&"string"==typeof n.namespaceURI){var n=e.nodeName.toLowerCase();if(B("uponSanitizeElement",e,{tagName:n,allowedTags:f}),"svg"!==n&&"math"!==n||0===e.querySelectorAll("p, br").length){if(f[n]&&!g[n])return"noscript"===n&&/<\/noscript/i.test(e.innerHTML)||"noembed"===n&&/<\/noembed/i.test(e.innerHTML)?(N(e),!0):(!ie||e.firstElementChild||e.content&&e.content.firstElementChild||!/</g.test(e.textContent)||(d.removed.push({element:e.cloneNode()}),e.innerHTML?e.innerHTML=e.innerHTML.replace(/</g,"&lt;"):e.innerHTML=e.textContent.replace(/</g,"&lt;")),b&&3===e.nodeType&&(t=(t=(t=e.textContent).replace(h," ")).replace(p," "),e.textContent!==t)&&(d.removed.push({element:e.cloneNode()}),e.textContent=t),B("afterSanitizeElements",e,null),!1);if(E&&!ae[n]&&"function"==typeof e.insertAdjacentHTML)try{var i=e.innerHTML;e.insertAdjacentHTML("AfterEnd",u?u.createHTML(i):i)}catch(e){}}}return N(e),!0},fe=function(e,t,n){if(oe&&("id"===t||"name"===t)&&(n in r||n in ce))return!1;if(!(v&&Y.test(t)||te&&G.test(t))){if(!m[t]||y[t])return!1;if(!A[t]&&!a.test(n.replace(X,""))&&("src"!==t&&"xlink:href"!==t&&"href"!==t||"script"===e||0!==n.indexOf("data:")||!se[e])&&(!ne||Q.test(n.replace(X,"")))&&n)return!1}return!0},me=function(e){var t=void 0,n=void 0,i=void 0,r=(B("beforeSanitizeAttributes",e,null),e.attributes);if(r){for(var o={attrName:"",attrValue:"",keepAttr:!0,allowedAttributes:m},i=r.length;i--;){var a=(s=t=r[i]).name,s=s.namespaceURI,n=t.value.trim(),l=a.toLowerCase();if(o.attrName=l,o.attrValue=n,o.keepAttr=!0,B("uponSanitizeAttribute",e,o),n=o.attrValue,"name"===l&&"IMG"===e.nodeName&&r.id)c=r.id,r=Oe(Ie,r,[]),D("id",e),D(a,e),r.indexOf(c)>i&&e.setAttribute("id",c.value);else{if("INPUT"===e.nodeName&&"type"===l&&"file"===n&&o.keepAttr&&(m[l]||!y[l]))continue;"id"===a&&e.setAttribute(a,""),D(a,e)}if(o.keepAttr)if(/svg|math/i.test(e.namespaceURI)&&new RegExp("</("+Object.keys(ae).join("|")+")","i").test(n))D(a,e);else{b&&(n=(n=n.replace(h," ")).replace(p," "));var c=e.nodeName.toLowerCase();if(fe(c,l,n))try{s?e.setAttributeNS(s,a,n):e.setAttribute(a,n),d.removed.pop()}catch(e){}}}B("afterSanitizeAttributes",e,null)}},ge=function e(t){var n,i=ue(t);for(B("beforeSanitizeShadowDOM",t,null);n=i.nextNode();)B("uponSanitizeShadowNode",n,null),pe(n)||(n.content instanceof $&&e(n.content),me(n));B("afterSanitizeShadowDOM",t,null)};d.sanitize=function(e,t){var n,i=void 0,r=void 0,o=void 0;if("string"!=typeof(e=e||"\x3c!--\x3e")&&!he(e)){if("function"!=typeof e.toString)throw new TypeError("toString is not a function");if("string"!=typeof(e=e.toString()))throw new TypeError("dirty is not a string, aborting")}if(!d.isSupported){if("object"===Be(s.toStaticHTML)||"function"==typeof s.toStaticHTML){if("string"==typeof e)return s.toStaticHTML(e);if(he(e))return s.toStaticHTML(e.outerHTML)}return e}if(x||L(t),d.removed=[],!T)if(e instanceof c)1===(t=(i=P("\x3c!--\x3e")).ownerDocument.importNode(e,!0)).nodeType&&"BODY"===t.nodeName||"HTML"===t.nodeName?i=t:i.appendChild(t);else{if(!F&&!b&&!w&&k&&-1===e.indexOf("<"))return u?u.createHTML(e):e;if(!(i=P(e)))return F?null:W}i&&C&&N(i.firstChild);for(var a=ue(T?e:i);n=a.nextNode();)3===n.nodeType&&n===r||pe(n)||(n.content instanceof $&&ge(n.content),me(n),r=n);if(r=null,T)return e;if(F){if(S)for(o=J.call(i.ownerDocument);i.firstChild;)o.appendChild(i.firstChild);else o=i;return o=re?K.call(l,o,!0):o}return t=w?i.outerHTML:i.innerHTML,b&&(t=(t=t.replace(h," ")).replace(p," ")),u&&k?u.createHTML(t):t},d.setConfig=function(e){L(e),x=!0},d.clearConfig=function(){M=null,x=!1},d.isValidAttribute=function(e,t,n){return M||L({}),e=e.toLowerCase(),t=t.toLowerCase(),fe(e,t,n)},d.addHook=function(e,t){"function"==typeof t&&(i[e]=i[e]||[],i[e].push(t))},d.removeHook=function(e){i[e]&&i[e].pop()},d.removeHooks=function(e){i[e]&&(i[e]=[])},d.removeAllHooks=function(){i={}}}else d.isSupported=!1;return d}()}),$__System.registerDynamic("20",[],!0,function(e,t,n){this||self;n.exports=function(){"use strict";var e=navigator.userAgent,s=navigator.platform,p=/gecko\/\d/i.test(e),t=/MSIE \d/.test(e),l=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(e),c=/Edge\/(\d+)/.exec(e),R=t||l||c,O=R&&(t?document.documentMode||6:+(c||l)[1]),I=!c&&/WebKit\//.test(e),t=I&&/Qt\/\d+\.\d+/.test(e),d=!c&&/Chrome\//.test(e),S=/Opera\//.test(e),k=/Apple Computer/.test(navigator.vendor),u=/Mac OS X 1\d\D([8-9]|\d\d)\D/.test(e),A=/PhantomJS/.test(e),f=!c&&/AppleWebKit/.test(e)&&/Mobile\/\w+/.test(e),E=/Android/.test(e),M=f||E||/webOS|BlackBerry|Opera Mini|Opera Mobi|IEMobile/i.test(e),Z=f||/Mac/.test(s),ee=/\bCrOS\b/.test(e),l=/win/i.test(s),c=S&&e.match(/Version\/(\d*\.\d*)/),L=((c=c&&Number(c[1]))&&15<=c&&(I=!(S=!1)),Z&&(t||S&&(null==c||c<12.11))),te=p||R&&9<=O;function N(e){return new RegExp("(^|\\s)"+e+"(?:$|\\s)\\s*")}var D=function(e,t){var n,i=e.className,t=N(t).exec(i);t&&(n=i.slice(t.index+t[0].length),e.className=i.slice(0,t.index)+(n?t[1]+n:""))};function P(e){for(var t=e.childNodes.length;0<t;--t)e.removeChild(e.firstChild);return e}function y(e,t){return P(e).appendChild(t)}function T(e,t,n,i){var r=document.createElement(e);if(n&&(r.className=n),i&&(r.style.cssText=i),"string"==typeof t)r.appendChild(document.createTextNode(t));else if(t)for(var o=0;o<t.length;++o)r.appendChild(t[o]);return r}function B(e,t,n,i){e=T(e,t,n,i);return e.setAttribute("role","presentation"),e}function ne(e,t){if(3==t.nodeType&&(t=t.parentNode),e.contains)return e.contains(t);do{if((t=11==t.nodeType?t.host:t)==e)return!0}while(t=t.parentNode)}function ie(){var t;try{t=document.activeElement}catch(e){t=document.body||null}for(;t&&t.shadowRoot&&t.shadowRoot.activeElement;)t=t.shadowRoot.activeElement;return t}function re(e,t){var n=e.className;N(t).test(n)||(e.className+=(n?" ":"")+t)}function oe(e,t){for(var n=e.split(" "),i=0;i<n.length;i++)n[i]&&!N(n[i]).test(t)&&(t+=" "+n[i]);return t}var ae=document.createRange?function(e,t,n,i){var r=document.createRange();return r.setEnd(i||e,n),r.setStart(e,t),r}:function(e,t,n){var i=document.body.createTextRange();try{i.moveToElementText(e.parentNode)}catch(e){return i}return i.collapse(!0),i.moveEnd("character",n),i.moveStart("character",t),i},se=function(e){e.select()};function le(e){var t=Array.prototype.slice.call(arguments,1);return function(){return e.apply(null,t)}}function ce(e,t,n){for(var i in t=t||{},e)!e.hasOwnProperty(i)||!1===n&&t.hasOwnProperty(i)||(t[i]=e[i]);return t}function $(e,t,n,i,r){null==t&&-1==(t=e.search(/[^\s\u00a0]/))&&(t=e.length);for(var o=i||0,a=r||0;;){var s=e.indexOf("\t",o);if(s<0||t<=s)return a+(t-o);a=(a+=s-o)+(n-a%n),o=s+1}}f?se=function(e){e.selectionStart=0,e.selectionEnd=e.value.length}:R&&(se=function(e){try{e.select()}catch(e){}});function de(){this.id=null}function w(e,t){for(var n=0;n<e.length;++n)if(e[n]==t)return n;return-1}var ue=0,he={toString:function(){return"CodeMirror.Pass"}},pe={scroll:!(de.prototype.set=function(e,t){clearTimeout(this.id),this.id=setTimeout(t,e)})},fe={origin:"*mouse"},me={origin:"+move"};function ge(e,t,n){for(var i=0,r=0;;){var o=e.indexOf("\t",i),a=(o=-1==o?e.length:o)-i;if(o==e.length||t<=r+a)return i+Math.min(a,t-r);if(r+=o-i,i=o+1,t<=(r+=n-r%n))return i}}var ye=[""];function ve(e){for(;ye.length<=e;)ye.push(H(ye)+" ");return ye[e]}function H(e){return e[e.length-1]}function be(e,t){for(var n=[],i=0;i<e.length;i++)n[i]=t(e[i],i);return n}function we(){}function xe(e,t){e=Object.create?Object.create(e):(we.prototype=e,new we);return t&&ce(t,e),e}var Ce=/[\u00df\u0587\u0590-\u05f4\u0600-\u06ff\u3040-\u309f\u30a0-\u30ff\u3400-\u4db5\u4e00-\u9fcc\uac00-\ud7af]/;function Fe(e){return/\w/.test(e)||""<e&&(e.toUpperCase()!=e.toLowerCase()||Ce.test(e))}function Se(e,t){return t?!!(-1<t.source.indexOf("\\w")&&Fe(e))||t.test(e):Fe(e)}function ke(e){for(var t in e)if(e.hasOwnProperty(t)&&e[t])return;return 1}var Ee=/[\u0300-\u036f\u0483-\u0489\u0591-\u05bd\u05bf\u05c1\u05c2\u05c4\u05c5\u05c7\u0610-\u061a\u064b-\u065e\u0670\u06d6-\u06dc\u06de-\u06e4\u06e7\u06e8\u06ea-\u06ed\u0711\u0730-\u074a\u07a6-\u07b0\u07eb-\u07f3\u0816-\u0819\u081b-\u0823\u0825-\u0827\u0829-\u082d\u0900-\u0902\u093c\u0941-\u0948\u094d\u0951-\u0955\u0962\u0963\u0981\u09bc\u09be\u09c1-\u09c4\u09cd\u09d7\u09e2\u09e3\u0a01\u0a02\u0a3c\u0a41\u0a42\u0a47\u0a48\u0a4b-\u0a4d\u0a51\u0a70\u0a71\u0a75\u0a81\u0a82\u0abc\u0ac1-\u0ac5\u0ac7\u0ac8\u0acd\u0ae2\u0ae3\u0b01\u0b3c\u0b3e\u0b3f\u0b41-\u0b44\u0b4d\u0b56\u0b57\u0b62\u0b63\u0b82\u0bbe\u0bc0\u0bcd\u0bd7\u0c3e-\u0c40\u0c46-\u0c48\u0c4a-\u0c4d\u0c55\u0c56\u0c62\u0c63\u0cbc\u0cbf\u0cc2\u0cc6\u0ccc\u0ccd\u0cd5\u0cd6\u0ce2\u0ce3\u0d3e\u0d41-\u0d44\u0d4d\u0d57\u0d62\u0d63\u0dca\u0dcf\u0dd2-\u0dd4\u0dd6\u0ddf\u0e31\u0e34-\u0e3a\u0e47-\u0e4e\u0eb1\u0eb4-\u0eb9\u0ebb\u0ebc\u0ec8-\u0ecd\u0f18\u0f19\u0f35\u0f37\u0f39\u0f71-\u0f7e\u0f80-\u0f84\u0f86\u0f87\u0f90-\u0f97\u0f99-\u0fbc\u0fc6\u102d-\u1030\u1032-\u1037\u1039\u103a\u103d\u103e\u1058\u1059\u105e-\u1060\u1071-\u1074\u1082\u1085\u1086\u108d\u109d\u135f\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17b7-\u17bd\u17c6\u17c9-\u17d3\u17dd\u180b-\u180d\u18a9\u1920-\u1922\u1927\u1928\u1932\u1939-\u193b\u1a17\u1a18\u1a56\u1a58-\u1a5e\u1a60\u1a62\u1a65-\u1a6c\u1a73-\u1a7c\u1a7f\u1b00-\u1b03\u1b34\u1b36-\u1b3a\u1b3c\u1b42\u1b6b-\u1b73\u1b80\u1b81\u1ba2-\u1ba5\u1ba8\u1ba9\u1c2c-\u1c33\u1c36\u1c37\u1cd0-\u1cd2\u1cd4-\u1ce0\u1ce2-\u1ce8\u1ced\u1dc0-\u1de6\u1dfd-\u1dff\u200c\u200d\u20d0-\u20f0\u2cef-\u2cf1\u2de0-\u2dff\u302a-\u302f\u3099\u309a\ua66f-\ua672\ua67c\ua67d\ua6f0\ua6f1\ua802\ua806\ua80b\ua825\ua826\ua8c4\ua8e0-\ua8f1\ua926-\ua92d\ua947-\ua951\ua980-\ua982\ua9b3\ua9b6-\ua9b9\ua9bc\uaa29-\uaa2e\uaa31\uaa32\uaa35\uaa36\uaa43\uaa4c\uaab0\uaab2-\uaab4\uaab7\uaab8\uaabe\uaabf\uaac1\uabe5\uabe8\uabed\udc00-\udfff\ufb1e\ufe00-\ufe0f\ufe20-\ufe26\uff9e\uff9f]/;function Te(e){return 768<=e.charCodeAt(0)&&Ee.test(e)}function _e(e,t,n){for(;(n<0?0<t:t<e.length)&&Te(e.charAt(t));)t+=n;return t}function Ae(e,t,n){for(;;){if(Math.abs(t-n)<=1)return e(t)?t:n;var i=Math.floor((t+n)/2);e(i)?n=i:t=i}}function Me(e,t,n){var i=this,r=(this.input=n,i.scrollbarFiller=T("div",null,"CodeMirror-scrollbar-filler"),i.scrollbarFiller.setAttribute("cm-not-content","true"),i.gutterFiller=T("div",null,"CodeMirror-gutter-filler"),i.gutterFiller.setAttribute("cm-not-content","true"),i.lineDiv=B("div",null,"CodeMirror-code"),i.selectionDiv=T("div",null,null,"position: relative; z-index: 1"),i.cursorDiv=T("div",null,"CodeMirror-cursors"),i.measure=T("div",null,"CodeMirror-measure"),i.lineMeasure=T("div",null,"CodeMirror-measure"),i.lineSpace=B("div",[i.measure,i.lineMeasure,i.selectionDiv,i.cursorDiv,i.lineDiv],null,"position: relative; outline: none"),B("div",[i.lineSpace],"CodeMirror-lines"));i.mover=T("div",[r],null,"position: relative"),i.sizer=T("div",[i.mover],"CodeMirror-sizer"),i.sizerWidth=null,i.heightForcer=T("div",null,null,"position: absolute; height: "+ue+"px; width: 1px;"),i.gutters=T("div",null,"CodeMirror-gutters"),i.lineGutter=null,i.scroller=T("div",[i.sizer,i.heightForcer,i.gutters],"CodeMirror-scroll"),i.scroller.setAttribute("tabIndex","-1"),i.wrapper=T("div",[i.scrollbarFiller,i.gutterFiller,i.scroller],"CodeMirror"),R&&O<8&&(i.gutters.style.zIndex=-1,i.scroller.style.paddingRight=0),I||p&&M||(i.scroller.draggable=!0),e&&(e.appendChild?e.appendChild(i.wrapper):e(i.wrapper)),i.viewFrom=i.viewTo=t.first,i.reportedViewFrom=i.reportedViewTo=t.first,i.view=[],i.renderedView=null,i.externalMeasured=null,i.viewOffset=0,i.lastWrapHeight=i.lastWrapWidth=0,i.updateLineNumbers=null,i.nativeBarWidth=i.barHeight=i.barWidth=0,i.scrollbarsClipped=!1,i.lineNumWidth=i.lineNumInnerWidth=i.lineNumChars=null,i.alignWidgets=!1,i.cachedCharWidth=i.cachedTextHeight=i.cachedPaddingH=null,i.maxLine=null,i.maxLineLength=0,i.maxLineChanged=!1,i.wheelDX=i.wheelDY=i.wheelStartX=i.wheelStartY=null,i.shift=!1,i.selForContextMenu=null,i.activeTouch=null,n.init(i)}function U(e,t){if((t-=e.first)<0||t>=e.size)throw new Error("There is no line "+(t+e.first)+" in the document.");for(var n=e;!n.lines;)for(var i=0;;++i){var r=n.children[i],o=r.chunkSize();if(t<o){n=r;break}t-=o}return n.lines[t]}function Le(e,t,n){var i=[],r=t.line;return e.iter(t.line,n.line+1,function(e){e=e.text;r==n.line&&(e=e.slice(0,n.ch)),r==t.line&&(e=e.slice(t.ch)),i.push(e),++r}),i}function Ne(e,t,n){var i=[];return e.iter(t,n,function(e){i.push(e.text)}),i}function De(e,t){var n=t-e.height;if(n)for(var i=e;i;i=i.parent)i.height+=n}function x(e){if(null==e.parent)return null;for(var t=e.parent,n=w(t.lines,e),i=t.parent;i;i=(t=i).parent)for(var r=0;i.children[r]!=t;++r)n+=i.children[r].chunkSize();return n+t.first}function Pe(e,t){var n=e.first;e:do{for(var i=0;i<e.children.length;++i){var r=e.children[i],o=r.height;if(t<o){e=r;continue e}t-=o,n+=r.chunkSize()}return n}while(!e.lines);for(var a=0;a<e.lines.length;++a){var s=e.lines[a].height;if(t<s)break;t-=s}return n+a}function Be(e,t){return t>=e.first&&t<e.first+e.size}function Re(e,t){return String(e.lineNumberFormatter(t+e.firstLineNumber))}function j(e,t,n){if(void 0===n&&(n=null),!(this instanceof j))return new j(e,t,n);this.line=e,this.ch=t,this.sticky=n}function q(e,t){return e.line-t.line||e.ch-t.ch}function Oe(e,t){return e.sticky==t.sticky&&0==q(e,t)}function Ie(e){return j(e.line,e.ch)}function $e(e,t){return q(e,t)<0?t:e}function He(e,t){return q(e,t)<0?e:t}function Ue(e,t){return Math.max(e.first,Math.min(t,e.first+e.size-1))}function W(e,t){var n;return t.line<e.first?j(e.first,0):(n=e.first+e.size-1,t.line>n?j(n,U(e,n).text.length):(e=U(e,(n=t).line).text.length,null==(t=n.ch)||e<t?j(n.line,e):t<0?j(n.line,0):n))}function je(e,t){for(var n=[],i=0;i<t.length;i++)n[i]=W(e,t[i]);return n}var qe=!1,We=!1;function ze(e,t,n){this.marker=e,this.from=t,this.to=n}function Ve(e,t){if(e)for(var n=0;n<e.length;++n){var i=e[n];if(i.marker==t)return i}}function Je(e,t){if(t.full)return null;var n=Be(e,t.from.line)&&U(e,t.from.line).markedSpans,e=Be(e,t.to.line)&&U(e,t.to.line).markedSpans;if(!n&&!e)return null;var i=t.from.ch,r=t.to.ch,o=0==q(t.from,t.to),a=function(e,t,n){var i;if(e)for(var r=0;r<e.length;++r){var o,a=e[r],s=a.marker;!(null==a.from||(s.inclusiveLeft?a.from<=t:a.from<t))&&(a.from!=t||"bookmark"!=s.type||n&&a.marker.insertLeft)||(o=null==a.to||(s.inclusiveRight?a.to>=t:a.to>t),(i=i||[]).push(new ze(s,a.from,o?null:a.to)))}return i}(n,i,o),s=function(e,t,n){var i;if(e)for(var r=0;r<e.length;++r){var o,a=e[r],s=a.marker;!(null==a.to||(s.inclusiveRight?a.to>=t:a.to>t))&&(a.from!=t||"bookmark"!=s.type||n&&!a.marker.insertLeft)||(o=null==a.from||(s.inclusiveLeft?a.from<=t:a.from<t),(i=i||[]).push(new ze(s,o?null:a.from-t,null==a.to?null:a.to-t)))}return i}(e,r,o),l=1==t.text.length,c=H(t.text).length+(l?i:0);if(a)for(var d=0;d<a.length;++d){var u,h=a[d];null==h.to&&((u=Ve(s,h.marker))?l&&(h.to=null==u.to?null:u.to+c):h.to=i)}if(s)for(var p=0;p<s.length;++p){var f=s[p];null!=f.to&&(f.to+=c),null==f.from?Ve(a,f.marker)||(f.from=c,l&&(a=a||[]).push(f)):(f.from+=c,l&&(a=a||[]).push(f))}a=a&&Ke(a),s&&s!=a&&(s=Ke(s));var m=[a];if(!l){var g,y=t.text.length-2;if(0<y&&a)for(var v=0;v<a.length;++v)null==a[v].to&&(g=g||[]).push(new ze(a[v].marker,null,null));for(var b=0;b<y;++b)m.push(g);m.push(s)}return m}function Ke(e){for(var t=0;t<e.length;++t){var n=e[t];null!=n.from&&n.from==n.to&&!1!==n.marker.clearWhenEmpty&&e.splice(t--,1)}return e.length?e:null}function Ye(e){var t=e.markedSpans;if(t){for(var n=0;n<t.length;++n)t[n].marker.detachLine(e);e.markedSpans=null}}function Ge(e,t){if(t){for(var n=0;n<t.length;++n)t[n].marker.attachLine(e);e.markedSpans=t}}function Qe(e){return e.inclusiveLeft?-1:0}function Xe(e){return e.inclusiveRight?1:0}function Ze(e,t){var n,i,r=e.lines.length-t.lines.length;return 0!=r?r:(r=e.find(),n=t.find(),(i=q(r.from,n.from)||Qe(e)-Qe(t))?-i:q(r.to,n.to)||Xe(e)-Xe(t)||t.id-e.id)}function et(e,t){var n,i=We&&e.markedSpans;if(i)for(var r,o=0;o<i.length;++o)(r=i[o]).marker.collapsed&&null==(t?r.from:r.to)&&(!n||Ze(n,r.marker)<0)&&(n=r.marker);return n}function tt(e){return et(e,!0)}function nt(e){return et(e,!1)}function it(e,t,n,i,r){var e=U(e,t),o=We&&e.markedSpans;if(o)for(var a=0;a<o.length;++a){var s=o[a];if(s.marker.collapsed){var l=s.marker.find(0),c=q(l.from,n)||Qe(s.marker)-Qe(r),d=q(l.to,i)||Xe(s.marker)-Xe(r);if(!(0<=c&&d<=0||c<=0&&0<=d)&&(c<=0&&(s.marker.inclusiveRight&&r.inclusiveLeft?0<=q(l.to,n):0<q(l.to,n))||0<=c&&(s.marker.inclusiveRight&&r.inclusiveLeft?q(l.from,i)<=0:q(l.from,i)<0)))return 1}}}function rt(e){for(var t;t=tt(e);)e=t.find(-1,!0).line;return e}function ot(e,t){var e=U(e,t),n=rt(e);return e==n?t:x(n)}function at(e,t){if(t>e.lastLine())return t;var n,i=U(e,t);if(!st(e,i))return t;for(;n=nt(i);)i=n.find(1,!0).line;return x(i)+1}function st(e,t){var n=We&&t.markedSpans;if(n)for(var i,r=0;r<n.length;++r)if((i=n[r]).marker.collapsed){if(null==i.from)return!0;if(!i.marker.widgetNode&&0==i.from&&i.marker.inclusiveLeft&&function e(t,n,i){{var r;if(null==i.to)return r=i.marker.find(1,!0),e(t,r.line,Ve(r.line.markedSpans,i.marker))}if(i.marker.inclusiveRight&&i.to==n.text.length)return!0;for(var o=void 0,a=0;a<n.markedSpans.length;++a)if((o=n.markedSpans[a]).marker.collapsed&&!o.marker.widgetNode&&o.from==i.to&&(null==o.to||o.to!=i.from)&&(o.marker.inclusiveLeft||i.marker.inclusiveRight)&&e(t,n,o))return!0}(e,t,i))return!0}}function lt(e){for(var t=0,n=(e=rt(e)).parent,i=0;i<n.lines.length;++i){var r=n.lines[i];if(r==e)break;t+=r.height}for(var o=n.parent;o;o=(n=o).parent)for(var a=0;a<o.children.length;++a){var s=o.children[a];if(s==n)break;t+=s.height}return t}function ct(e){if(0==e.height)return 0;for(var t,n=e.text.length,i=e;t=tt(i);){var r=t.find(0,!0),i=r.from.line;n+=r.from.ch-r.to.ch}for(i=e;t=nt(i);)var o=t.find(0,!0),n=(n-=i.text.length-o.from.ch)+((i=o.to.line).text.length-o.to.ch);return n}function dt(e){var n=e.display,e=e.doc;n.maxLine=U(e,e.first),n.maxLineLength=ct(n.maxLine),n.maxLineChanged=!0,e.iter(function(e){var t=ct(e);t>n.maxLineLength&&(n.maxLineLength=t,n.maxLine=e)})}var ut=null;function ht(e,t,n){var i;ut=null;for(var r=0;r<e.length;++r){var o=e[r];if(o.from<t&&o.to>t)return r;o.to==t&&(o.from!=o.to&&"before"==n?i=r:ut=r),o.from==t&&(o.from!=o.to&&"before"!=n?i=r:ut=r)}return null!=i?i:ut}pt=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/,ft=/[stwN]/,mt=/[LRr]/,gt=/[Lb1n]/,yt=/[1n]/;var pt,ft,mt,gt,yt,vt=function(e,t){var n="ltr"==t?"L":"R";if(0==e.length||"ltr"==t&&!pt.test(e))return!1;for(var i,r=e.length,o=[],a=0;a<r;++a)o.push((i=e.charCodeAt(a))<=247?"bbbbbbbbbtstwsbbbbbbbbbbbbbbssstwNN%%%NNNNNN,N,N1111111111NNNNNNNLLLLLLLLLLLLLLLLLLLLLLLLLLNNNNNNLLLLLLLLLLLLLLLLLLLLLLLLLLNNNNbbbbbbsbbbbbbbbbbbbbbbbbbbbbbbbbb,N%%%%NNNNLNNNNN%%11NLNNN1LNNNNNLLLLLLLLLLLLLLLLLLLLLLLNLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLN".charAt(i):1424<=i&&i<=1524?"R":1536<=i&&i<=1785?"nnnnnnNNr%%r,rNNmmmmmmmmmmmrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrmmmmmmmmmmmmmmmmmmmmmnnnnnnnnnn%nnrrrmrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrmmmmmmmnNmmmmmmrrmmNmmmmrr1111111111".charAt(i-1536):1774<=i&&i<=2220?"r":8192<=i&&i<=8203?"w":8204==i?"b":"L");for(var s=0,l=n;s<r;++s){var c=o[s];"m"==c?o[s]=l:l=c}for(var d=0,u=n;d<r;++d){var h=o[d];"1"==h&&"r"==u?o[d]="n":mt.test(h)&&"r"==(u=h)&&(o[d]="R")}for(var p=1,f=o[0];p<r-1;++p){var m=o[p];"+"==m&&"1"==f&&"1"==o[p+1]?o[p]="1":","!=m||f!=o[p+1]||"1"!=f&&"n"!=f||(o[p]=f),f=m}for(var g=0;g<r;++g){var y=o[g];if(","==y)o[g]="N";else if("%"==y){for(var v=void 0,v=g+1;v<r&&"%"==o[v];++v);for(var b=g&&"!"==o[g-1]||v<r&&"1"==o[v]?"1":"N",w=g;w<v;++w)o[w]=b;g=v-1}}for(var x=0,C=n;x<r;++x){var F=o[x];"L"==C&&"1"==F?o[x]="L":mt.test(F)&&(C=F)}for(var S=0;S<r;++S)if(ft.test(o[S])){for(var k=void 0,k=S+1;k<r&&ft.test(o[k]);++k);for(var E="L"==(S?o[S-1]:n),T=E==("L"==(k<r?o[k]:n))?E?"L":"R":n,_=S;_<k;++_)o[_]=T;S=k-1}for(var A,M=[],L=0;L<r;)if(gt.test(o[L])){var N=L;for(++L;L<r&&gt.test(o[L]);++L);M.push(new bt(0,N,L))}else{var D=L,P=M.length;for(++L;L<r&&"L"!=o[L];++L);for(var B=D;B<L;)if(yt.test(o[B])){D<B&&M.splice(P,0,new bt(1,D,B));var R=B;for(++B;B<L&&yt.test(o[B]);++B);M.splice(P,0,new bt(2,R,B)),D=B}else++B;D<L&&M.splice(P,0,new bt(1,D,L))}return 1==M[0].level&&(A=e.match(/^\s+/))&&(M[0].from=A[0].length,M.unshift(new bt(0,0,A[0].length))),1==H(M).level&&(A=e.match(/\s+$/))&&(H(M).to-=A[0].length,M.push(new bt(0,r-A[0].length,r))),"rtl"==t?M.reverse():M};function bt(e,t,n){this.level=e,this.from=t,this.to=n}function wt(e,t){var n=e.order;return n=null==n?e.order=vt(e.text,t):n}function xt(e,t,n){t=_e(e.text,t+n,n);return t<0||t>e.text.length?null:t}function Ct(e,t,n){e=xt(e,t.ch,n);return null==e?null:new j(t.line,e,n<0?"after":"before")}function Ft(e,t,n,i,r){if(e){var o,a,s,l,e=wt(n,t.doc.direction);if(e)return o=r<0==(1==(e=r<0?H(e):e[0]).level)?"after":"before",0<e.level?(a=In(t,n),s=r<0?n.text.length-1:0,l=$n(t,a,s).top,s=Ae(function(e){return $n(t,a,e).top==l},r<0==(1==e.level)?e.from:e.to-1,s),"before"==o&&(s=xt(n,s,1))):s=r<0?e.to:e.from,new j(i,s,o)}return new j(i,r<0?n.text.length:0,r<0?"before":"after")}function St(o,a,s,e){var l=wt(a,o.doc.direction);if(!l)return Ct(a,s,e);s.ch>=a.text.length?(s.ch=a.text.length,s.sticky="before"):s.ch<=0&&(s.ch=0,s.sticky="after");var t=ht(l,s.ch,s.sticky),n=l[t];if("ltr"==o.doc.direction&&n.level%2==0&&(0<e?n.to>s.ch:n.from<s.ch))return Ct(a,s,e);function c(e,t){return xt(a,e instanceof j?e.ch:e,t)}function i(e){if(!o.options.lineWrapping)return{begin:0,end:a.text.length};d=d||In(o,a);var t=o,n=a,i=d,r=e;return r=Kn(t,n,$n(t,i,e),"line").top,ti(t,n,i,r)}var d,r=i("before"==s.sticky?c(s,-1):s.ch);if("rtl"==o.doc.direction||1==n.level){var u=1==n.level==e<0,h=c(s,u?1:-1);if(null!=h&&(u?h<=n.to&&h<=r.end:h>=n.from&&h>=r.begin))return new j(s.line,h,u?"before":"after")}function p(e,t,n){for(var i=function(e,t){return t?new j(s.line,c(e,1),"before"):new j(s.line,e,"after")};0<=e&&e<l.length;e+=t){var r=l[e],o=0<t==(1!=r.level),a=o?n.begin:c(n.end,-1);if(r.from<=a&&a<r.to)return i(a,o);if(a=o?r.from:c(r.to,-1),n.begin<=a&&a<n.end)return i(a,o)}}n=p(t+e,e,r);return n||(null==(h=0<e?r.end:c(r.begin,-1))||0<e&&h==a.text.length||!(n=p(0<e?0:l.length-1,e,i(h)))?null:n)}var kt=[],z=function(e,t,n){var i;e.addEventListener?(i=File.option.passiveEvents&&("scroll"==t||"mousewheel"==t||"DOMMouseScroll"==t),e.addEventListener(t,n,!!i&&{passive:!0,capture:!1})):e.attachEvent?e.attachEvent("on"+t,n):(i=e._handlers||(e._handlers={}))[t]=(i[t]||kt).concat(n)};function Et(e,t){return e._handlers&&e._handlers[t]||kt}function V(e,t,n){var i;e.removeEventListener?e.removeEventListener(t,n,!1):e.detachEvent?e.detachEvent("on"+t,n):(i=(e=e._handlers)&&e[t])&&-1<(n=w(i,n))&&(e[t]=i.slice(0,n).concat(i.slice(n+1)))}function _(e,t){var n=Et(e,t);if(n.length)for(var i=Array.prototype.slice.call(arguments,2),r=0;r<n.length;++r)n[r].apply(null,i)}function J(e,t,n){return"string"==typeof t&&(t={type:t,preventDefault:function(){this.defaultPrevented=!0}}),_(e,n||t.type,e,t),Lt(t)||t.codemirrorIgnore}function Tt(e){var t=e._handlers&&e._handlers.cursorActivity;if(t)for(var n=e.curOp.cursorActivityHandlers||(e.curOp.cursorActivityHandlers=[]),i=0;i<t.length;++i)-1==w(n,t[i])&&n.push(t[i])}function _t(e,t){return 0<Et(e,t).length}function At(e){e.prototype.on=function(e,t){z(this,e,t)},e.prototype.off=function(e,t){V(this,e,t)}}function K(e){e.preventDefault?e.preventDefault():e.returnValue=!1}function Mt(e){e.stopPropagation?e.stopPropagation():e.cancelBubble=!0}function Lt(e){return null!=e.defaultPrevented?e.defaultPrevented:0==e.returnValue}function Nt(e){K(e),Mt(e)}function Dt(e){return e.target||e.srcElement}function Pt(e){var t=e.which;return null==t&&(1&e.button?t=1:2&e.button?t=3:4&e.button&&(t=2)),t=Z&&e.ctrlKey&&1==t?3:t}var Bt,Rt,Ot=!(R&&O<9)&&("draggable"in(s=T("div"))||"dragDrop"in s);var It=3!="\n\nb".split(/\n/).length?function(e){for(var t=0,n=[],i=e.length;t<=i;){var r=e.indexOf("\n",t),o=(-1==r&&(r=e.length),e.slice(t,"\r"==e.charAt(r-1)?r-1:r)),a=o.indexOf("\r");-1!=a?(n.push(o.slice(0,a)),t+=a+1):(n.push(o),t=r+1)}return n}:function(e){return(e||"").split(/\r\n?|\n/)},$t=window.getSelection?function(e){try{return e.selectionStart!=e.selectionEnd}catch(e){return!1}}:function(e){var t;try{t=e.ownerDocument.selection.createRange()}catch(e){}return!(!t||t.parentElement()!=e)&&0!=t.compareEndPoints("StartToEnd",t)},Ht="oncopy"in(e=T("div"))||(e.setAttribute("oncopy","return;"),"function"==typeof e.oncopy),Ut=null;var jt={},qt={};function Wt(e){if("string"==typeof e&&qt.hasOwnProperty(e))e=qt[e];else if(e&&"string"==typeof e.name&&qt.hasOwnProperty(e.name)){var t=qt[e.name];(e=xe(t="string"==typeof t?{name:t}:t,e)).name=t.name}else{if("string"==typeof e&&/^[\w\-]+\/[\w\-]+\+xml$/.test(e))return Wt("application/xml");if("string"==typeof e&&/^[\w\-]+\/[\w\-]+\+json$/.test(e))return Wt("application/json")}return"string"==typeof e?{name:e}:e||{name:"null"}}function zt(e,t){t=Wt(t);var n=jt[t.name];if(!n)return zt(e,"text/plain");var i=n(e,t);if(Vt.hasOwnProperty(t.name)){var r,o=Vt[t.name];for(r in o)o.hasOwnProperty(r)&&(i.hasOwnProperty(r)&&(i["_"+r]=i[r]),i[r]=o[r])}if(i.name=t.name,t.helperType&&(i.helperType=t.helperType),t.modeProps)for(var a in t.modeProps)i[a]=t.modeProps[a];return i}var Vt={};function Jt(e,t){ce(t,Vt.hasOwnProperty(e)?Vt[e]:Vt[e]={})}function Kt(e,t){if(!0===t)return t;if(e.copyState)return e.copyState(t);var n,i={};for(n in t){var r=t[n];r instanceof Array&&(r=r.concat([])),i[n]=r}return i}function Yt(e,t){for(var n;e.innerMode&&(n=e.innerMode(t))&&n.mode&&n.mode!=e;)t=n.state,e=n.mode;return(n=n&&!n.mode?void 0:n)||{mode:e,state:t}}function Gt(e,t,n){return!e.startState||e.startState(t,n)}var m=function(e,t){this.pos=this.start=0,this.string=e,this.tabSize=t||8,this.lastColumnPos=this.lastColumnValue=0,this.lineStart=0};function Qt(t,n,i,e){for(var l=[t.state.modeGen],r={},o=x(n),a=("object"==typeof i&&(i.lineBefore=t.getLine(o-1),i.lineAfter=t.getLine(o+1)),an(t,n.text,t.doc.mode,i,function(e,t){l.push(e,t)},r,e),0);a<t.state.overlays.length;++a)!function(e){var o=t.state.overlays[e],a=1,s=0;an(t,n.text,o.mode,"visiblespace"!==o.mode.name||i,function(e,t){for(var n=a;s<e;){var i=l[a];e<i&&l.splice(a,1,e,l[a+1],i),a+=2,s=Math.min(e,i)}if(t)if(o.opaque)l.splice(n,a-n,e,"overlay "+t),a=n+2;else for(;n<a;n+=2){var r=l[n+1];l[n+1]=(r?r+" ":"")+"overlay "+t}},r)}(a);return{styles:l,classes:r.bgClass||r.textClass?r:null}}function Xt(e,t,n){var i,r;return t.styles&&t.styles[0]==e.state.modeGen||(i=Zt(e,x(t)),r=Qt(e,t,t.text.length>e.options.maxHighlightLength?Kt(e.doc.mode,i):i),t.stateAfter=i,t.styles=r.styles,r.classes?t.styleClasses=r.classes:t.styleClasses&&(t.styleClasses=null),n===e.doc.frontier&&e.doc.frontier++),t.styles}function Zt(n,i,e){var r,o,a=n.doc,s=n.display;return!a.mode.startState||(r=function(e,t,n){for(var i,r,o=e.doc,a=n?-1:t-(e.doc.mode.innerMode?1e3:100),s=t;a<s;--s){if(s<=o.first)return o.first;var l=U(o,s-1);if(l.stateAfter&&(!n||s<=o.frontier))return s;l=$(l.text,null,e.options.tabSize);(null==r||l<i)&&(r=s-1,i=l)}return r}(n,i,e),o=(o=r>a.first&&U(a,r-1).stateAfter)?Kt(a.mode,o):Gt(a.mode),a.iter(r,i,function(e){"object"==typeof o&&(o.lineBefore=n.getLine(i-1),o.lineAfter=n.getLine(i+1)),en(n,e.text,o);var t=r==i-1||r%5==0||r>=s.viewFrom&&r<s.viewTo;e.stateAfter=t?Kt(a.mode,o):null,++r}),e&&(a.frontier=r),o)}function en(e,t,n,i){var r=e.doc.mode,o=new m(t,e.options.tabSize);for(o.start=o.pos=i||0,n.lineBefore=n.lineBefore||"",n.lineAfter=n.lineAfter||"",""==t&&tn(r,n);!o.eol();)nn(r,o,n),o.start=o.pos}function tn(e,t){return e.blankLine?e.blankLine(t):e.innerMode&&(e=Yt(e,t)).mode.blankLine?e.mode.blankLine(e.state):void 0}function nn(e,t,n,i){for(var r=0;r<10;r++){i&&(i[0]=Yt(e,n).mode);var o=e.token(t,n);if(t.pos>t.start)return o}if("gfm"==e.name)return t.pos=t.start+1,null;throw new Error("Mode "+e.name+" failed to advance stream.")}function rn(e,t,n,i){function r(e){return{start:u.start,end:u.pos,string:u.current(),type:o||null,state:e?Kt(s.mode,d):d}}var o,a,s=e.doc,l=s.mode,c=(t=W(s,t),U(s,t.line)),d=Zt(e,t.line,n),u=new m(c.text,e.options.tabSize);for(i&&(a=[]);(i||u.pos<t.ch)&&!u.eol();)u.start=u.pos,o=nn(l,u,d),i&&a.push(r(!0));return i?a:r()}function on(e,t){if(e)for(;;){var n=e.match(/(?:^|\s+)line-(background-)?(\S+)/);if(!n)break;e=e.slice(0,n.index)+e.slice(n.index+n[0].length);var i=n[1]?"bgClass":"textClass";null==t[i]?t[i]=n[2]:new RegExp("(?:^|s)"+n[2]+"(?:$|s)").test(t[i])||(t[i]+=" "+n[2])}return e}function an(e,t,n,i,r,o,a){var s=n.flattenSpans,l=(null==s&&(s=e.options.flattenSpans),0),c=null,d=new m(t,e.options.tabSize),u=e.options.addModeClass&&[null];for(""==t&&on(tn(n,i),o);!d.eol();){var h,p=d.pos>e.options.maxHighlightLength?(s=!1,a&&en(e,t,i,d.pos),d.pos=t.length,null):on(nn(n,d,i,u),o);if(u&&(h=u[0].name)&&(p="m-"+(p?h+" "+p:h)),!s||c!=p){for(;l<d.start;)r(l=Math.min(d.start,l+5e3),c);c=p}d.start=d.pos}for(;l<d.pos;){var f=Math.min(d.pos,l+5e3);r(f,c),l=f}}m.prototype.eol=function(){return this.pos>=this.string.length},m.prototype.sol=function(){return this.pos==this.lineStart},m.prototype.peek=function(){return this.string.charAt(this.pos)||void 0},m.prototype.next=function(){if(this.pos<this.string.length)return this.string.charAt(this.pos++)},m.prototype.eat=function(e){var t=this.string.charAt(this.pos),e="string"==typeof e?t==e:t&&(e.test?e.test(t):e(t));if(e)return++this.pos,t},m.prototype.eatWhile=function(e){for(var t=this.pos;this.eat(e););return this.pos>t},m.prototype.eatSpace=function(){for(var e=this.pos;/[\s\u00a0]/.test(this.string.charAt(this.pos));)++this.pos;return this.pos>e},m.prototype.skipToEnd=function(){this.pos=this.string.length},m.prototype.skipTo=function(e){e=this.string.indexOf(e,this.pos);if(-1<e)return this.pos=e,!0},m.prototype.backUp=function(e){this.pos-=e},m.prototype.column=function(){return this.lastColumnPos<this.start&&(this.lastColumnValue=$(this.string,this.start,this.tabSize,this.lastColumnPos,this.lastColumnValue),this.lastColumnPos=this.start),this.lastColumnValue-(this.lineStart?$(this.string,this.lineStart,this.tabSize):0)},m.prototype.indentation=function(){return $(this.string,null,this.tabSize)-(this.lineStart?$(this.string,this.lineStart,this.tabSize):0)},m.prototype.match=function(e,t,n){var i;return"string"!=typeof e?(i=this.string.slice(this.pos).match(e))&&0<i.index?null:(i&&!1!==t&&(this.pos+=i[0].length),i):(i=function(e){return n?e.toLowerCase():e})(this.string.substr(this.pos,e.length))==i(e)?(!1!==t&&(this.pos+=e.length),!0):void 0},m.prototype.current=function(){return this.string.slice(this.start,this.pos)},m.prototype.hideFirstChars=function(e,t){this.lineStart+=e;try{return t()}finally{this.lineStart-=e}};var sn=function(e,t,n){this.text=e,Ge(this,t),this.height=n?n(this):1};sn.prototype.lineNo=function(){return x(this)},At(sn);var ln={},cn={};function dn(e,t){return!e||/^\s*$/.test(e)?null:(t=t.addModeClass?cn:ln)[e]||(t[e]=e.replace(/\S+/g,"cm-$&"))}function un(e,t){var n=B("span",null,null,I?"padding-right: .1px":null),i={pre:B("pre",[n],"CodeMirror-line"),content:n,col:0,pos:0,cm:e,trailingSpace:!1,splitSpaces:(R||I)&&e.getOption("lineWrapping")};t.measure={};for(var r,o,a=0;a<=(t.rest?t.rest.length:0);a++){var s=a?t.rest[a-1]:t.line,l=void 0,c=(i.pos=0,i.addToken=pn,c=e.display.measure,o=r=void 0,(null!=Rt?Rt:(o=y(c,document.createTextNode("AخA")),r=ae(o,0,1).getBoundingClientRect(),o=ae(o,1,2).getBoundingClientRect(),P(c),r&&r.left!=r.right&&(Rt=o.right-r.right<3)))&&(l=wt(s,e.doc.direction))&&(i.addToken=function(u,h){return function(e,t,n,i,r,o,a){n=n?n+" cm-force-border":"cm-force-border";for(var s=e.pos,l=s+t.length;;){for(var c=void 0,d=0;d<h.length&&!((c=h[d]).to>s&&c.from<=s);d++);if(c.to>=l)return u(e,t,n,i,r,o,a);u(e,t.slice(0,c.to-s),n,i,null,o,a),i=null,t=t.slice(c.to-s),s=c.to}}}(i.addToken,l)),i.map=[],t!=e.display.externalMeasured&&x(s));!function(e,t,n){var i=e.markedSpans,r=e.text,o=0;if(i)for(var a,s,l,c,d,u,h,p=r.length,f=0,m=1,g="",y=0;;){if(y==f){l=c=d=u=s="",h=null,y=1/0;for(var v=[],b=void 0,w=0;w<i.length;++w){var x=i[w],C=x.marker;"bookmark"==C.type&&x.from==f&&C.widgetNode?v.push(C):x.from<=f&&(null==x.to||x.to>f||C.collapsed&&x.to==f&&x.from==f)?(null!=x.to&&x.to!=f&&y>x.to&&(y=x.to,c=""),C.className&&(l+=" "+C.className),C.css&&(s=(s?s+";":"")+C.css),C.startStyle&&x.from==f&&(d+=" "+C.startStyle),C.endStyle&&x.to==y&&(b=b||[]).push(C.endStyle,x.to),C.title&&!u&&(u=C.title),C.collapsed&&(!h||Ze(h.marker,C)<0)&&(h=x)):x.from>f&&y>x.from&&(y=x.from)}if(b)for(var F=0;F<b.length;F+=2)b[F+1]==y&&(c+=" "+b[F]);if(!h||h.from==f)for(var S=0;S<v.length;++S)fn(t,0,v[S]);if(h&&(h.from||0)==f){if(fn(t,(null==h.to?p+1:h.to)-f,h.marker,null==h.from),null==h.to)return;h.to==f&&(h=!1)}}if(p<=f)break;for(var k=Math.min(p,y);;){if(g){var E,T=f+g.length;if(h||(E=k<T?g.slice(0,k-f):g,t.addToken(t,E,a?a+l:l,d,f+E.length==y?c:"",u,s)),k<=T){g=g.slice(k-f),f=k;break}f=T,d=""}g=r.slice(o,o=n[m++]),a=dn(n[m++],t.cm.options)}}else for(var _=1;_<n.length;_+=2)t.addToken(t,r.slice(o,o=n[_]),dn(n[_+1],t.cm.options))}(s,i,Xt(e,s,c)),s.styleClasses&&(s.styleClasses.bgClass&&(i.bgClass=oe(s.styleClasses.bgClass,i.bgClass||"")),s.styleClasses.textClass)&&(i.textClass=oe(s.styleClasses.textClass,i.textClass||"")),0==i.map.length&&i.map.push(0,0,i.content.appendChild((o=e.display.measure,r=void 0,(o=(Bt=null==Bt&&(r=T("span","​"),y(o,T("span",[r,document.createTextNode("x")])),0!=o.firstChild.offsetHeight)?r.offsetWidth<=1&&2<r.offsetHeight&&!(R&&O<8):Bt)?T("span","​"):T("span"," ",null,"display: inline-block; width: 1px; margin-right: -1px")).setAttribute("cm-text",""),o.setAttribute("cm-zwsp",""),o))),0==a?(t.measure.map=i.map,t.measure.cache={}):((t.measure.maps||(t.measure.maps=[])).push(i.map),(t.measure.caches||(t.measure.caches=[])).push({}))}return I&&(n=i.content.lastChild,/\bcm-tab\b/.test(n.className)||n.querySelector&&n.querySelector(".cm-tab"))&&(i.content.className="cm-tab-wrap-hack"),_(e,"renderLine",e,t.line,i.pre),i.pre.className&&(i.textClass=oe(i.pre.className,i.textClass||"")),i}function hn(e){var t=T("span","•","cm-invalidchar");return t.title="\\u"+e.charCodeAt(0).toString(16),t.setAttribute("aria-label",t.title),t}function pn(e,t,n,i,r,o,a){if(t){var s=e.splitSpaces?function(e,t){if(1<e.length&&!/  /.test(e))return e;for(var n=t,i="",r=0;r<e.length;r++){var o=e.charAt(r);" "!=o||!n||r!=e.length-1&&32!=e.charCodeAt(r+1)||(o=" "),i+=o,n=" "==o}return i}(t,e.trailingSpace):t,l=e.cm.state.specialChars,c=!1;if(l.test(t))for(var d=document.createDocumentFragment(),u=0;;){l.lastIndex=u;var h=l.exec(t),p=h?h.index-u:t.length-u;if(p&&(f=document.createTextNode(s.slice(u,u+p)),R&&O<9?d.appendChild(T("span",[f])):d.appendChild(f),e.map.push(e.pos,e.pos+p,f),e.col+=p,e.pos+=p),!h)break;u+=1+p;var f=void 0;"\t"==h[0]?(p=(p=e.cm.options.tabSize)-e.col%p,(f=d.appendChild(T("span",ve(p),"cm-tab"))).setAttribute("role","presentation"),f.setAttribute("cm-text","\t"),e.col+=p):("\r"==h[0]||"\n"==h[0]?(f=d.appendChild(T("span","\r"==h[0]?"␍":"␤","cm-invalidchar"))).setAttribute("cm-text",h[0]):((f=e.cm.options.specialCharPlaceholder(h[0])).setAttribute("cm-text",h[0]),R&&O<9?d.appendChild(T("span",[f])):d.appendChild(f)),e.col+=1),e.map.push(e.pos,e.pos+1,f),e.pos++}else e.col+=t.length,d=document.createTextNode(s),e.map.push(e.pos,e.pos+t.length,d),R&&O<9&&(c=!0),e.pos+=t.length;if(e.trailingSpace=32==s.charCodeAt(t.length-1),n||i||r||c||a)return c=n||"",i&&(c+=i),r&&(c+=r),n=T("span",[d],c,a),o&&(n.title=o),e.content.appendChild(n);e.content.appendChild(d)}}function fn(e,t,n,i){var r=!i&&n.widgetNode;r&&e.map.push(e.pos,e.pos+t,r),!i&&e.cm.display.input.needsContentAttribute&&(r=r||e.content.appendChild(document.createElement("span"))).setAttribute("cm-marker",n.id),r&&(e.cm.display.input.setUneditable(r),e.content.appendChild(r)),e.pos+=t,e.trailingSpace=!1}function mn(e,t,n){this.line=t,this.rest=function(e){for(var t,n;t=nt(e);)e=t.find(1,!0).line,(n=n||[]).push(e);return n}(t),this.size=this.rest?x(H(this.rest))-n+1:1,this.node=this.text=null,this.hidden=st(e,t)}function gn(e,t,n){for(var i=[],r=t;r<n;r=a){var o=new mn(e.doc,U(e.doc,r),r),a=r+o.size;i.push(o)}return i}var yn=null;var vn=null;function v(e,t){var n=Et(e,t);if(n.length)for(var i,r=Array.prototype.slice.call(arguments,2),o=(yn?i=yn.delayedCallbacks:vn?i=vn:(i=vn=[],setTimeout(bn,0)),0);o<n.length;++o)!function(e){i.push(function(){return n[e].apply(null,r)})}(o)}function bn(){var e=vn;vn=null;for(var t=0;t<e.length;++t)e[t]()}function wn(e,t,n,i){for(var r=0;r<t.changes.length;r++){var o=t.changes[r];if("text"==o){c=l=s=a=void 0;var a=e,s=t,l=s.text.className,c=Cn(a,s);s.text==s.node&&(s.node=c.pre),s.text.parentNode.replaceChild(c.pre,s.text),s.text=c.pre,c.bgClass!=s.bgClass||c.textClass!=s.textClass?(s.bgClass=c.bgClass,s.textClass=c.textClass,Fn(a,s)):l&&(s.text.className=l)}else if("gutter"==o)Sn(e,t,n,i);else if("class"==o)Fn(e,t);else if("widget"==o){h=u=a=d=c=void 0;var c=e,d=t,a=i;d.alignable&&(d.alignable=null);for(var u=d.node.firstChild,h=void 0;u;u=h)h=u.nextSibling,"CodeMirror-linewidget"==u.className&&d.node.removeChild(u);kn(c,d,a)}}t.changes=null}function xn(e){return e.node==e.text&&(e.node=T("div",null,null,"position: relative"),e.text.parentNode&&e.text.parentNode.replaceChild(e.node,e.text),e.node.appendChild(e.text),R)&&O<8&&(e.node.style.zIndex=2),e.node}function Cn(e,t){var n=e.display.externalMeasured;return n&&n.line==t.line?(e.display.externalMeasured=null,t.measure=n.measure,n.built):un(e,t)}function Fn(e,t){e=e,(r=(n=t).bgClass?n.bgClass+" "+(n.line.bgClass||""):n.line.bgClass)&&(r+=" CodeMirror-linebackground"),n.background?r?n.background.className=r:(n.background.parentNode.removeChild(n.background),n.background=null):r&&(i=xn(n),n.background=i.insertBefore(T("div",null,r),i.firstChild),e.display.input.setUneditable(n.background)),t.line.wrapClass?xn(t).className=t.line.wrapClass:t.node!=t.text&&(t.node.className="");var n,i,r=t.textClass?t.textClass+" "+(t.line.textClass||""):t.line.textClass;t.text.className=r||""}function Sn(e,t,n,i){t.gutter&&(t.node.removeChild(t.gutter),t.gutter=null),t.gutterBackground&&(t.node.removeChild(t.gutterBackground),t.gutterBackground=null),t.line.gutterClass&&(o=xn(t),t.gutterBackground=T("div",null,"CodeMirror-gutter-background "+t.line.gutterClass,"left: "+(e.options.fixedGutter?i.fixedPos:-i.gutterTotalWidth)+"px; width: "+i.gutterTotalWidth+"px"),e.display.input.setUneditable(t.gutterBackground),o.insertBefore(t.gutterBackground,t.text));var r=t.line.gutterMarkers;if(e.options.lineNumbers||r){var o=0===n||n===e.lineCount()-1||(n+1)%10==0?" CodeMirror-linenumber-show":"",a=xn(t),s=t.gutter=T("div",null,"CodeMirror-gutter-wrapper","left: "+(e.options.fixedGutter?i.fixedPos:-i.gutterTotalWidth)+"px");if(e.display.input.setUneditable(s),a.insertBefore(s,t.text),t.line.gutterClass&&(s.className+=" "+t.line.gutterClass),!e.options.lineNumbers||r&&r["CodeMirror-linenumbers"]||(t.lineNumber=s.appendChild(T("div",Re(e.options,n),"CodeMirror-linenumber CodeMirror-gutter-elt"+o,"left: "+i.gutterLeft["CodeMirror-linenumbers"]+"px; width: "+e.display.lineNumInnerWidth+"px"))),r)for(var l=0;l<e.options.gutters.length;++l){var c=e.options.gutters[l],d=r.hasOwnProperty(c)&&r[c];d&&s.appendChild(T("div",[d],"CodeMirror-gutter-elt","left: "+i.gutterLeft[c]+"px; width: "+i.gutterWidth[c]+"px"))}}}function kn(e,t,n){if(En(e,t.line,t,n,!0),t.rest)for(var i=0;i<t.rest.length;i++)En(e,t.rest[i],t,n,!1)}function En(e,t,n,i,r){if(t.widgets)for(var o=xn(n),a=0,s=t.widgets;a<s.length;++a){var l=s[a],c=T("div",[l.node],"CodeMirror-linewidget"),d=(l.handleMouseEvents||c.setAttribute("cm-ignore-events","true"),p=h=u=d=void 0,l),u=c,h=n,p=i;d.noHScroll&&((h.alignable||(h.alignable=[])).push(u),h=p.wrapperWidth,u.style.left=p.fixedPos+"px",d.coverGutter||(h-=p.gutterTotalWidth,u.style.paddingLeft=p.gutterTotalWidth+"px"),u.style.width=h+"px"),d.coverGutter&&(u.style.zIndex=5,u.style.position="relative",d.noHScroll||(u.style.marginLeft=-p.gutterTotalWidth+"px")),e.display.input.setUneditable(c),r&&l.above?o.insertBefore(c,n.gutter||n.text):o.appendChild(c),v(l,"redraw")}}function Tn(e){var t,n;return null!=e.height?e.height:(t=e.doc.cm)?(ne(document.body,e.node)||(n="position: relative;",e.coverGutter&&(n+="margin-left: -"+t.display.gutters.offsetWidth+"px;"),e.noHScroll&&(n+="width: "+t.display.wrapper.clientWidth+"px;"),y(t.display.measure,T("div",[e.node],null,n))),e.height=e.node.parentNode.offsetHeight):0}function _n(e,t,n){for(var i=Dt(t);i!=e.wrapper;i=i.parentNode){if(n&&i==t.target&&i==e.scroller&&e.scroller.scrollWidth>e.scroller.clientWidth&&e.scroller.getBoundingClientRect().bottom<t.clientY+20)return 1;if(!i||1==i.nodeType&&"true"==i.getAttribute("cm-ignore-events")||i.parentNode==e.sizer&&i!=e.mover)return 1}}function An(e){return e.lineSpace.offsetTop}function Mn(e){return e.mover.offsetHeight-e.lineSpace.offsetHeight}function Ln(e){var t;return e.cachedPaddingH||(t=y(e.measure,T("pre","x")),t=window.getComputedStyle?window.getComputedStyle(t):t.currentStyle,t={left:parseInt(t.paddingLeft),right:parseInt(t.paddingRight)},isNaN(t.left)||isNaN(t.right)||(e.cachedPaddingH=t),t)}function Nn(e){return ue-e.display.nativeBarWidth}function Dn(e){return e.display.scroller.clientWidth-Nn(e)-e.display.barWidth}function Pn(e){return e.display.scroller.clientHeight-Nn(e)-e.display.barHeight}function Bn(e,t,n){if(e.line==t)return{map:e.measure.map,cache:e.measure.cache};for(var i=0;i<e.rest.length;i++)if(e.rest[i]==t)return{map:e.measure.maps[i],cache:e.measure.caches[i]};for(var r=0;r<e.rest.length;r++)if(x(e.rest[r])>n)return{map:e.measure.maps[r],cache:e.measure.caches[r],before:!0}}function Rn(e,t,n,i){return $n(e,In(e,t),n,i)}function On(e,t){return t>=e.display.viewFrom&&t<e.display.viewTo?e.display.view[ci(e,t)]:(e=e.display.externalMeasured)&&t>=e.lineN&&t<e.lineN+e.size?e:void 0}function In(e,t){var n,i,r=x(t),o=On(e,r),e=(o&&!o.text?o=null:o&&o.changes&&(wn(e,o,r,ri(e)),e.curOp.forceUpdate=!0),o||(e=e,i=x(n=rt(n=t)),(n=e.display.externalMeasured=new mn(e.doc,n,i)).lineN=i,i=n.built=un(e,n),n.text=i.pre,y(e.display.lineMeasure,i.pre),o=n),Bn(o,t,r));return{line:t,view:o,rect:null,map:e.map,cache:e.cache,before:e.before,hasHeights:!1}}function $n(e,t,n,i,r){var o,a=(n=t.before?-1:n)+(i||"");if(t.cache.hasOwnProperty(a))o=t.cache[a];else{if(t.rect||(t.rect=t.view.text.getBoundingClientRect()),!t.hasHeights){var s=e,l=t.view,c=t.rect,d=s.options.lineWrapping,s=d&&Dn(s);if(!l.measure.heights||d&&l.measure.width!=s){var u=l.measure.heights=[];if(d){l.measure.width=s;for(var h=l.text.firstChild.getClientRects(),p=0;p<h.length-1;p++){var f=h[p],m=h[p+1];2<Math.abs(f.bottom-m.bottom)&&u.push((f.bottom+m.top)/2-c.top)}}u.push(c.bottom-c.top)}t.hasHeights=!0}(o=function(e,t,n,i){var r,o=jn(t.map,n,i),a=o.node,s=o.start,l=o.end,c=o.collapse;if(3==a.nodeType){for(var d=0;d<4;d++){for(;s&&Te(t.line.text.charAt(o.coverStart+s));)--s;for(;o.coverStart+l<o.coverEnd&&Te(t.line.text.charAt(o.coverStart+l));)++l;if((r=R&&O<9&&0==s&&l==o.coverEnd-o.coverStart?a.parentNode.getBoundingClientRect():function(e,t){var n=Un;if("left"==t)for(var i=0;i<e.length&&(n=e[i]).left==n.right;i++);else for(var r=e.length-1;0<=r&&(n=e[r]).left==n.right;r--);return n}(ae(a,s,l).getClientRects(),i)).left||r.right||0==s)break;l=s,s-=1,c="right"}R&&O<11&&(r=function(e,t){var n;return window.screen&&null!=screen.logicalXDPI&&screen.logicalXDPI!=screen.deviceXDPI&&function(e){var t;return null!=Ut?Ut:(t=(e=y(e,T("span","x"))).getBoundingClientRect(),e=ae(e,0,1).getBoundingClientRect(),Ut=1<Math.abs(t.left-e.left))}(e)?(e=screen.logicalXDPI/screen.deviceXDPI,n=screen.logicalYDPI/screen.deviceYDPI,{left:t.left*e,right:t.right*e,top:t.top*n,bottom:t.bottom*n}):t}(e.display.measure,r))}else 0<s&&(c=i="right"),r=e.options.lineWrapping&&1<(n=a.getClientRects()).length?n["right"==i?n.length-1:0]:a.getBoundingClientRect();!(R&&O<9)||s||r&&(r.left||r.right)||(n=a.parentNode.getClientRects()[0],r=n?{left:n.left,right:n.left+ii(e.display),top:n.top,bottom:n.bottom}:Un);for(var n=r.top-t.rect.top,u=r.bottom-t.rect.top,h=(n+u)/2,p=t.view.measure.heights,f=0;f<p.length-1&&!(h<p[f]);f++);var m=f?p[f-1]:0,g=p[f],m={left:("right"==c?r.right:r.left)-t.rect.left,right:("left"==c?r.left:r.right)-t.rect.left,top:m,bottom:g};r.left||r.right||(m.bogus=!0);e.options.singleCursorHeightPerLine||(m.rtop=n,m.rbottom=u);return m}(e,t,n,i)).bogus||(t.cache[a]=o)}return{left:o.left,right:o.right,top:r?o.rtop:o.top,bottom:r?o.rbottom:o.bottom}}var Hn,Un={left:0,right:0,top:0,bottom:0};function jn(e,t,n){for(var i,r,o,a,s,l,c=0;c<e.length;c+=3)if(s=e[c],l=e[c+1],t<s?(r=0,o=1,a="left"):t<l?o=(r=t-s)+1:(c==e.length-3||t==l&&e[c+3]>t)&&(r=(o=l-s)-1,l<=t)&&(a="right"),null!=r){if(i=e[c+2],s==l&&n==(i.insertLeft?"left":"right")&&(a=n),"left"==n&&0==r)for(;c&&e[c-2]==e[c-3]&&e[c-1].insertLeft;)i=e[2+(c-=3)],a="left";if("right"==n&&r==l-s)for(;c<e.length-3&&e[c+3]==e[c+4]&&!e[c+5].insertLeft;)i=e[(c+=3)+2],a="right";break}return{node:i,start:r,end:o,collapse:a,coverStart:s,coverEnd:l}}function qn(e){if(e.measure&&(e.measure.cache={},e.measure.heights=null,e.rest))for(var t=0;t<e.rest.length;t++)e.measure.caches[t]={}}function Wn(e){e.display.externalMeasure=null,P(e.display.lineMeasure);for(var t=0;t<e.display.view.length;t++)qn(e.display.view[t])}function zn(e){Wn(e),e.display.cachedCharWidth=e.display.cachedTextHeight=e.display.cachedPaddingH=null,e.options.lineWrapping||(e.display.maxLineChanged=!0),e.display.lineNumChars=null}function Vn(){return d&&E?-(document.body.getBoundingClientRect().left-parseInt(getComputedStyle(document.body).marginLeft)):window.pageXOffset||(document.documentElement||document.body).scrollLeft}function Jn(){return d&&E?-(document.body.getBoundingClientRect().top-parseInt(getComputedStyle(document.body).marginTop)):window.pageYOffset||(document.documentElement||document.body).scrollTop}function Kn(e,t,n,i,r){if(!r&&t.widgets)for(var o,a=0;a<t.widgets.length;++a)t.widgets[a].above&&(o=Tn(t.widgets[a]),n.top+=o,n.bottom+=o);return"line"!=i&&(i=i||"local",r=lt(t),"local"==i?r+=An(e.display):r-=e.display.viewOffset,"page"!=i&&"window"!=i||(r+=(e=e.display.lineSpace.getBoundingClientRect()).top+("window"==i?0:Jn()),e=e.left+("window"==i?0:Vn()),n.left+=e,n.right+=e),n.top+=r,n.bottom+=r),n}function Yn(e,t,n){var i;return"div"==n?t:(i=t.left,t=t.top,"page"==n?(i-=Vn(),t-=Jn()):"local"!=n&&n||(i+=(n=e.display.sizer.getBoundingClientRect()).left,t+=n.top),{left:i-(n=e.display.lineSpace.getBoundingClientRect()).left,top:t-n.top})}function Gn(e,t,n,i,r){return Kn(e,i=i||U(e.doc,t.line),Rn(e,i,t.ch,r),n)}function Qn(n,e,i,r,o,a){function s(e,t){e=$n(n,o,e,t?"right":"left",a);return t?e.left=e.right:e.right=e.left,Kn(n,r,e,i)}r=r||U(n.doc,e.line),o=o||In(n,r);var t,l,c=wt(r,n.doc.direction),d=e.ch,e=e.sticky;return d>=r.text.length?(d=r.text.length,e="before"):d<=0&&(d=0,e="after"),c?(l=ht(c,d,e),t=ut,l=u(d,l,"before"==e),null!=t&&(l.other=u(d,t,"before"!=e)),l):s("before"==e?d-1:d,"before"==e);function u(e,t,n){return s(n?e-1:e,c[t].level%2!=0!=n)}}function Xn(e,t){var n=0,t=(t=W(e.doc,t),e.options.lineWrapping||(n=ii(e.display)*t.ch),U(e.doc,t.line)),e=lt(t)+An(e.display);return{left:n,right:n,top:e,bottom:e+t.height}}function Zn(e,t,n,i,r){e=j(e,t,n);return e.xRel=r,i&&(e.outside=!0),e}function ei(e,t,n){var i=e.doc;if((n+=e.display.viewOffset)<0)return Zn(i.first,0,null,!0,-1);var r=Pe(i,n),o=i.first+i.size-1;if(o<r)return Zn(i.first+i.size-1,U(i,o).text.length,null,!0,1);t<0&&(t=0);for(var a=U(i,r);;){var s=function(n,i,e,r,o){o-=lt(i);var t,a=0,s=i.text.length,l=In(n,i);if(wt(i,n.doc.direction)){n.options.lineWrapping&&(u=ti(n,i,l,o),a=u.begin,s=u.end),t=new j(e,a);var c,d,u=Qn(n,t,"line",i,l).left,h=u<r?1:-1,p=u-r;do{if(c=p,null==(t=St(n,i,d=t,h))||t.ch<a||s<=("before"==t.sticky?t.ch-1:t.ch)){t=d;break}}while(p=Qn(n,t,"line",i,l).left-r,h<0!=p<0&&Math.abs(p)<=Math.abs(c));if(Math.abs(p)>Math.abs(c)){if(p<0==c<0)throw new Error("Broke out of infinite loop in coordsCharInner");t=d}}else{u=Ae(function(e){var t=Kn(n,i,$n(n,l,e),"line");return t.top>o?(s=Math.min(e,s),1):!(t.bottom<=o)&&(t.left>r||!(t.right<r)&&r-t.left<t.right-r)},a,s);u=_e(i.text,u,1),t=new j(e,u,u==s?"before":"after")}e=Qn(n,t,"line",i,l);(o<e.top||e.bottom<o)&&(t.outside=!0);return t.xRel=r<e.left?-1:r>e.right?1:0,t}(e,a,r,t,n),l=nt(a),c=l&&l.find(0,!0);if(!l||!(s.ch>c.from.ch||s.ch==c.from.ch&&0<s.xRel))return s;r=x(a=c.to.line)}}function ti(t,n,i,r){function o(e){return Kn(t,n,$n(t,i,e),"line")}var e=n.text.length,a=Ae(function(e){return o(e-1).bottom<=r},e,0);return{begin:a,end:Ae(function(e){return o(e).top>r},a,e)}}function ni(e){if(null!=e.cachedTextHeight)return e.cachedTextHeight;if(null==Hn){Hn=T("pre");for(var t=0;t<49;++t)Hn.appendChild(document.createTextNode("x")),Hn.appendChild(T("br"));Hn.appendChild(document.createTextNode("x"))}y(e.measure,Hn);var n=Hn.offsetHeight/50;return 3<n&&(e.cachedTextHeight=n),P(e.measure),n||1}function ii(e){var t,n;return null!=e.cachedCharWidth?e.cachedCharWidth:(n=T("span","xxxxxxxxxx"),t=T("pre",[n]),y(e.measure,t),2<(n=((t=n.getBoundingClientRect()).right-t.left)/10)&&(e.cachedCharWidth=n),n||10)}function ri(e){for(var t=e.display,n={},i={},r=t.gutters.clientLeft,o=t.gutters.firstChild,a=0;o;o=o.nextSibling,++a)n[e.options.gutters[a]]=o.offsetLeft+o.clientLeft+r,i[e.options.gutters[a]]=o.clientWidth;return{fixedPos:oi(t),gutterTotalWidth:t.gutters.offsetWidth,gutterLeft:n,gutterWidth:i,wrapperWidth:t.wrapper.clientWidth}}function oi(e){return e.scroller.getBoundingClientRect().left-e.sizer.getBoundingClientRect().left}function ai(i){var r=ni(i.display),o=i.options.lineWrapping,a=o&&Math.max(5,i.display.scroller.clientWidth/ii(i.display)-3);return function(e){if(st(i.doc,e))return 0;var t=0;if(e.widgets)for(var n=0;n<e.widgets.length;n++)e.widgets[n].height&&(t+=e.widgets[n].height);return o?t+(Math.ceil(e.text.length/a)||1)*r:t+r}}function si(e){var t=e.doc,n=ai(e);t.iter(function(e){var t=n(e);t!=e.height&&De(e,t)})}function li(e,t,n,i){var r=e.display;if(!n&&"true"==Dt(t).getAttribute("cm-not-content"))return null;var o,n=r.lineSpace.getBoundingClientRect();try{o=t.clientX-n.left,a=t.clientY-n.top}catch(t){return null}var a,r=ei(e,o,a);return i&&1==r.xRel&&(n=U(e.doc,r.line).text).length==r.ch&&(a=$(n,n.length,e.options.tabSize)-n.length,r=j(r.line,Math.max(0,Math.round((o-Ln(e.display).left)/ii(e.display))-a))),r}function ci(e,t){if(t>=e.display.viewTo)return null;if((t-=e.display.viewFrom)<0)return null;for(var n=e.display.view,i=0;i<n.length;i++)if((t-=n[i].size)<0)return i}function di(e){e.display.input.showSelection(e.display.input.prepareSelection())}function ui(e,t){for(var n,i,r=e.doc,o={},a=o.cursors=document.createDocumentFragment(),s=o.selection=document.createDocumentFragment(),l=0;l<r.sel.ranges.length;l++)!1===t&&l==r.sel.primIndex||(n=r.sel.ranges[l]).from().line>=e.display.viewTo||n.to().line<e.display.viewFrom||(((i=n.empty())||e.options.showCursorWhenSelecting)&&hi(e,n.head,a),i)||!function(r,e,t){var n=r.display,o=r.doc,a=document.createDocumentFragment(),i=Ln(r.display),p=i.left,f=Math.max(n.sizerWidth,r.display.lineDiv.clientWidth-n.sizer.offsetLeft)-i.right;function m(e,t,n,i){t<0&&(t=0),t=Math.round(t),i=Math.round(i),a.appendChild(T("div",null,"CodeMirror-selected","position: absolute; left: "+e+"px;\n                             top: "+t+"px; width: "+(null==n?f-e:n)+"px;\n                             height: "+(i-t)+"px"))}function s(n,s,l){var c,d,i=U(o,n),u=i.text.length;function h(e,t){return Gn(r,j(n,e),"div",i,t)}return function(e,t,n,i){if(!e)return i(t,n,"ltr");for(var r=!1,o=0;o<e.length;++o){var a=e[o];(a.from<n&&a.to>t||t==n&&a.to==t)&&(i(Math.max(a.from,t),Math.min(a.to,n),1==a.level?"rtl":"ltr"),r=!0)}r||i(t,n,"ltr")}(wt(i,o.direction),s||0,null==l?u:l,function(e,t,n){var i,r,o,a=h(e,"left");e==t?i=r=(o=a).left:(o=h(t-1,"right"),"rtl"==n&&(n=a,a=o,o=n),i=a.left,r=o.right),null==s&&0==e&&(i=p),3<o.top-a.top&&(m(i,a.top,null,a.bottom),i=p,a.bottom<o.top)&&m(i,a.bottom,null,o.top),null==l&&t==u&&(r=f),(!c||a.top<c.top||a.top==c.top&&a.left<c.left)&&(c=a),(!d||o.bottom>d.bottom||o.bottom==d.bottom&&o.right>d.right)&&(d=o),m(i=i<p+1?p:i,o.top,r-i,o.bottom)}),{start:c,end:d}}n=e.from(),i=e.to();{var l;n.line==i.line?s(n.line,n.ch,i.ch):(e=U(o,n.line),l=U(o,i.line),l=rt(e)==rt(l),n=s(n.line,n.ch,l?e.text.length+1:null).end,e=s(i.line,l?0:null,i.ch).start,l&&(n.top<e.top-2?(m(n.right,n.top,null,n.bottom),m(p,e.top,e.left,e.bottom)):m(n.right,n.top,e.left-n.right,n.bottom)),n.bottom<e.top&&m(p,n.bottom,null,e.top))}t.appendChild(a)}(e,n,s);return o}function hi(e,t,n){var t=Qn(e,t,"div",null,null,!e.options.singleCursorHeightPerLine),i=n.appendChild(T("div"," ","CodeMirror-cursor"));i.style.left=t.left+"px",i.style.top=t.top+"px",i.style.height=Math.max(0,t.bottom-t.top)*e.options.cursorHeight+"px",t.other&&((i=n.appendChild(T("div"," ","CodeMirror-cursor CodeMirror-secondarycursor"))).style.display="",i.style.left=t.other.left+"px",i.style.top=t.other.top+"px",i.style.height=.85*(t.other.bottom-t.other.top)+"px")}function pi(e){var t,n;e.state.focused&&(t=e.display,clearInterval(t.blinker),n=!0,t.cursorDiv.style.visibility="",0<e.options.cursorBlinkRate?t.blinker=setInterval(function(){return t.cursorDiv.style.visibility=(n=!n)?"":"hidden"},e.options.cursorBlinkRate):e.options.cursorBlinkRate<0&&(t.cursorDiv.style.visibility="hidden"))}function fi(e){e.state.focused||(e.display.input.focus(),gi(e))}function mi(e){e.state.delayingBlurEvent=!0,setTimeout(function(){e.state.delayingBlurEvent&&(e.state.delayingBlurEvent=!1,yi(e))},100)}function gi(e,t){e.state.delayingBlurEvent&&(e.state.delayingBlurEvent=!1),"nocursor"!=e.options.readOnly&&(e.state.focused||(_(e,"focus",e,t),e.state.focused=!0,re(e.display.wrapper,"CodeMirror-focused"),e.curOp||e.display.selForContextMenu==e.doc.sel||(e.display.input.reset(),I&&setTimeout(function(){return e.display.input.reset(!0)},20)),e.display.input.receivedFocus()),pi(e))}function yi(e,t){e.state.delayingBlurEvent||(e.state.focused&&(_(e,"blur",e,t),e.state.focused=!1,D(e.display.wrapper,"CodeMirror-focused")),clearInterval(e.display.blinker),setTimeout(function(){e.state.focused||(e.display.shift=!1)},150))}function vi(e){for(var t=e.display,n=t.lineDiv.offsetTop,i=0;i<t.view.length;i++){var r=t.view[i],o=void 0;if(!r.hidden){R&&O<8?(o=(a=r.node.offsetTop+r.node.offsetHeight)-n,n=a):o=(a=r.node.getBoundingClientRect()).bottom-a.top;var a,s=r.line.height-o;if(o<2&&(o=ni(t)),(.001<s||s<-.001)&&(De(r.line,o),bi(r.line),r.rest))for(var l=0;l<r.rest.length;l++)bi(r.rest[l])}}}function bi(e){if(e.widgets)for(var t=0;t<e.widgets.length;++t)e.widgets[t].height=e.widgets[t].node.parentNode.offsetHeight}function wi(e,t,n){var i,r=n&&null!=n.top?Math.max(0,n.top):e.scroller.scrollTop,r=Math.floor(r-An(e)),o=n&&null!=n.bottom?n.bottom:r+e.wrapper.clientHeight,r=Pe(t,r),o=Pe(t,o);return n&&n.ensure&&(i=n.ensure.from.line,n=n.ensure.to.line,i<r?o=Pe(t,lt(U(t,r=i))+e.wrapper.clientHeight):Math.min(n,t.lastLine())>=o&&(r=Pe(t,lt(U(t,n))-e.wrapper.clientHeight),o=n)),{from:r,to:Math.max(o,r+1)}}function xi(e){var t=e.display,n=t.view;if(t.alignWidgets||t.gutters.firstChild&&e.options.fixedGutter){for(var i=oi(t)-t.scroller.scrollLeft+e.doc.scrollLeft,r=t.gutters.offsetWidth,o=i+"px",a=0;a<n.length;a++)if(!n[a].hidden){e.options.fixedGutter&&(n[a].gutter&&(n[a].gutter.style.left=o),n[a].gutterBackground)&&(n[a].gutterBackground.style.left=o);var s=n[a].alignable;if(s)for(var l=0;l<s.length;l++)s[l].style.left=o}e.options.fixedGutter&&(t.gutters.style.left=Math.max(0,i+r)+"px")}}function Ci(e){var t,n,i,r;if(e.options.lineNumbers)return t=e.doc,t=Re(e.options,t.first+t.size-1),n=e.display,t.length!=n.lineNumChars?(i=(r=n.measure.appendChild(T("div",[T("div",t)],"CodeMirror-linenumber CodeMirror-gutter-elt"))).firstChild.offsetWidth,r=r.offsetWidth-i,n.lineGutter.style.width="",n.lineNumInnerWidth=Math.max(i,n.lineGutter.offsetWidth-r)+r+2,n.lineNumWidth=n.lineNumInnerWidth+r,n.lineNumChars=n.lineNumInnerWidth?t.length:-1,n.lineGutter.style.width=n.lineNumWidth+"px",Xi(e),1):void 0}function Fi(e,t){var n=e.display,i=ni(e.display),r=(t.top<0&&(t.top=0),(e.curOp&&null!=e.curOp.scrollTop?e.curOp:n.scroller).scrollTop),o=Pn(e),a={},s=(t.bottom-t.top>o&&(t.bottom=t.top+o),e.doc.height+Mn(n)),l=t.top<i,i=t.bottom>s-i,i=(t.top<r?a.scrollTop=l?0:t.top:t.bottom>r+o&&(l=Math.min(t.top,(i?s:t.bottom)-o))!=r&&(a.scrollTop=l),(e.curOp&&null!=e.curOp.scrollLeft?e.curOp:n.scroller).scrollLeft),s=Dn(e)-(e.options.fixedGutter?n.gutters.offsetWidth:0),o=t.right-t.left>s;return o&&(t.right=t.left+s),t.left<10?a.scrollLeft=0:t.left<i?a.scrollLeft=Math.max(0,t.left-(o?0:10)):t.right>s+i-3&&(a.scrollLeft=t.right+(o?0:10)-s),a}function Si(e,t){null!=t&&(Ti(e),e.curOp.scrollTop=(null==e.curOp.scrollTop?e.doc:e.curOp).scrollTop+t)}function ki(e){Ti(e);var t=e.getCursor(),n=t,i=t;e.options.lineWrapping||(n=t.ch?j(t.line,t.ch-1):t,i=j(t.line,t.ch+1)),e.curOp.scrollToPos={from:n,to:i,margin:e.options.cursorScrollMargin}}function Ei(e,t,n){null==t&&null==n||Ti(e),null!=t&&(e.curOp.scrollLeft=t),null!=n&&(e.curOp.scrollTop=n)}function Ti(e){var t=e.curOp.scrollToPos;t&&(e.curOp.scrollToPos=null,_i(e,Xn(e,t.from),Xn(e,t.to),t.margin))}function _i(e,t,n,i){t=Fi(e,{left:Math.min(t.left,n.left),top:Math.min(t.top,n.top)-i,right:Math.max(t.right,n.right),bottom:Math.max(t.bottom,n.bottom)+i});Ei(e,t.scrollLeft,t.scrollTop)}function Ai(e,t){Math.abs(e.doc.scrollTop-t)<2||(p||Qi(e,{top:t}),Mi(e,t,!0),p&&Qi(e),Vi(e,100))}function Mi(e,t,n){t=Math.min(e.display.scroller.scrollHeight-e.display.scroller.clientHeight,t),e.display.scroller.scrollTop==t&&!n||(e.doc.scrollTop=t,e.display.scrollbars.setScrollTop(t),e.display.scroller.scrollTop==t)||(e.display.scroller.scrollTop=t)}function Li(e,t,n,i){t=Math.min(t,e.display.scroller.scrollWidth-e.display.scroller.clientWidth),(n?t==e.doc.scrollLeft:Math.abs(e.doc.scrollLeft-t)<2)&&!i||(e.doc.scrollLeft=t,xi(e),e.display.scroller.scrollLeft!=t&&(e.display.scroller.scrollLeft=t),e.display.scrollbars.setScrollLeft(t))}function Ni(e){var t=e.display,n=t.gutters.offsetWidth,i=Math.round(e.doc.height+Mn(e.display));return{clientHeight:t.scroller.clientHeight,viewHeight:t.wrapper.clientHeight,scrollWidth:t.scroller.scrollWidth,clientWidth:t.scroller.clientWidth,viewWidth:t.wrapper.clientWidth,barLeft:e.options.fixedGutter?n:0,docHeight:i,scrollHeight:i+Nn(e)+t.barHeight,nativeBarWidth:t.nativeBarWidth,gutterWidth:n}}C.posFromMouse=li;function Di(e,t,n){this.cm=n;var i=this.vert=T("div",[T("div",null,null,"min-width: 1px")],"CodeMirror-vscrollbar"),r=this.horiz=T("div",[T("div",null,null,"height: 100%; min-height: 1px")],"CodeMirror-hscrollbar");e(i),e(r),z(i,"scroll",function(){i.clientHeight&&t(i.scrollTop,"vertical")}),z(r,"scroll",function(){r.clientWidth&&t(r.scrollLeft,"horizontal")}),this.checkedZeroWidth=!1,R&&O<8&&(this.horiz.style.minHeight=this.vert.style.minWidth="18px")}function Pi(){}Di.prototype.update=function(e){var t,n=e.scrollWidth>e.clientWidth+1,i=e.scrollHeight>e.clientHeight+1,r=e.nativeBarWidth;return this.vert.style.display="",this.vert.firstChild.style.height="0",n?(this.horiz.style.display="block",this.horiz.style.right=i?r+"px":"0",this.horiz.style.left=e.barLeft+"px",t=e.viewWidth-e.barLeft-(i?r:0),this.horiz.firstChild.style.width=Math.max(0,e.scrollWidth-e.clientWidth+t)+"px"):(this.horiz.style.display="",this.horiz.firstChild.style.width="0"),!this.checkedZeroWidth&&0<e.clientHeight&&(0==r&&this.zeroWidthHack(),this.checkedZeroWidth=!0),{right:i?r:0,bottom:n?r:0}},Di.prototype.setScrollLeft=function(e){this.horiz.scrollLeft!=e&&(this.horiz.scrollLeft=e),this.disableHoriz&&this.enableZeroWidthBar(this.horiz,this.disableHoriz,"horiz")},Di.prototype.setScrollTop=function(e){this.vert.scrollTop!=e&&(this.vert.scrollTop=e),this.disableVert&&this.enableZeroWidthBar(this.vert,this.disableVert,"vert")},Di.prototype.zeroWidthHack=function(){this.horiz.style.height=this.vert.style.width=Z&&!u?"12px":"18px",this.horiz.style.pointerEvents=this.vert.style.pointerEvents="none",this.disableHoriz=new de,this.disableVert=new de},Di.prototype.enableZeroWidthBar=function(n,i,r){n.style.pointerEvents="auto",i.set(1e3,function e(){var t=n.getBoundingClientRect();("vert"==r?document.elementFromPoint(t.right-1,(t.top+t.bottom)/2):document.elementFromPoint((t.right+t.left)/2,t.bottom-1))!=n?n.style.pointerEvents="none":i.set(1e3,e)})},Di.prototype.clear=function(){var e=this.horiz.parentNode;e.removeChild(this.horiz),e.removeChild(this.vert)};function Bi(e,t){t=t||Ni(e);var n=e.display.barWidth,i=e.display.barHeight;Ri(e,t);for(var r=0;r<4&&n!=e.display.barWidth||i!=e.display.barHeight;r++)n!=e.display.barWidth&&e.options.lineWrapping&&vi(e),Ri(e,Ni(e)),n=e.display.barWidth,i=e.display.barHeight}function Ri(e,t){var n=e.display,i=n.scrollbars.update(t);n.sizer.style.paddingRight=(n.barWidth=i.right)+"px",n.sizer.style.paddingBottom=(n.barHeight=i.bottom)+"px",n.heightForcer.style.borderBottom=i.bottom+"px solid transparent",i.right&&i.bottom?(n.scrollbarFiller.style.display="block",n.scrollbarFiller.style.height=i.bottom+"px",n.scrollbarFiller.style.width=i.right+"px"):n.scrollbarFiller.style.display="",i.bottom&&e.options.coverGutterNextToScrollbar&&e.options.fixedGutter?(n.gutterFiller.style.display="block",n.gutterFiller.style.height=i.bottom+"px",n.gutterFiller.style.width=t.gutterWidth+"px"):n.gutterFiller.style.display=""}Pi.prototype.update=function(){return{bottom:0,right:0}},Pi.prototype.setScrollLeft=function(){},Pi.prototype.setScrollTop=function(){},Pi.prototype.clear=function(){};var Oi={native:Di,null:Pi};function Ii(n){n.display.scrollbars&&(n.display.scrollbars.clear(),n.display.scrollbars.addClass)&&D(n.display.wrapper,n.display.scrollbars.addClass),n.display.scrollbars=new Oi[n.options.scrollbarStyle](function(e){n.display.wrapper.insertBefore(e,n.display.scrollbarFiller),z(e,"mousedown",function(){n.state.focused&&setTimeout(function(){return n.display.input.focus()},0)}),e.setAttribute("cm-not-content","true")},function(e,t){("horizontal"==t?Li:Ai)(n,e)},n),n.display.scrollbars.addClass&&re(n.display.wrapper,n.display.scrollbars.addClass)}var $i=0;function Hi(e){e.curOp={cm:e,viewChanged:!1,startHeight:e.doc.height,forceUpdate:!1,updateInput:null,typing:!1,changeObjs:null,cursorActivityHandlers:null,cursorActivityCalled:0,selectionChanged:!1,updateMaxLine:!1,scrollLeft:null,scrollTop:null,scrollToPos:null,focus:!1,id:++$i},e=e.curOp,yn?yn.ops.push(e):e.ownsGroup=yn={ops:[e],delayedCallbacks:[]}}function Ui(e){var e=e.curOp,t=function(e){for(var t=0;t<e.ops.length;t++)e.ops[t].cm.curOp=null;for(var n=e.ops,i=0;i<n.length;i++){a=o=r=void 0;var r=n[i],o=r.cm,a=o.display;(function(e){var t=e.display;!t.scrollbarsClipped&&t.scroller.offsetWidth&&(t.nativeBarWidth=t.scroller.offsetWidth-t.scroller.clientWidth,t.heightForcer.style.height=Nn(e)+"px",t.sizer.style.marginBottom=-t.nativeBarWidth+"px",t.sizer.style.borderRightWidth=Nn(e)+"px",t.scrollbarsClipped=!0)})(o),r.updateMaxLine&&dt(o),r.mustUpdate=r.viewChanged||r.forceUpdate||null!=r.scrollTop||r.scrollToPos&&(r.scrollToPos.from.line<a.viewFrom||r.scrollToPos.to.line>=a.viewTo)||a.maxLineChanged&&o.options.lineWrapping,r.update=r.mustUpdate&&new Ki(o,r.mustUpdate&&{top:r.scrollTop,ensure:r.scrollToPos},r.forceUpdate)}for(var s=0;s<n.length;s++){l=void 0;var l=n[s];l.updatedDisplay=l.mustUpdate&&Yi(l.cm,l.update)}for(var c=0;c<n.length;c++){d=void 0;u=void 0;h=void 0;var d=n[c];var u=d.cm,h=u.display;d.updatedDisplay&&vi(u);d.barMeasure=Ni(u),h.maxLineChanged&&!u.options.lineWrapping&&(d.adjustWidthTo=Rn(u,h.maxLine,h.maxLine.text.length).left+3,u.display.sizerWidth=d.adjustWidthTo,d.barMeasure.scrollWidth=Math.max(h.scroller.clientWidth,h.sizer.offsetLeft+d.adjustWidthTo+Nn(u)+u.display.barWidth),d.maxScrollLeft=Math.max(0,h.sizer.offsetLeft+d.adjustWidthTo-Dn(u)));(d.updatedDisplay||d.selectionChanged)&&(d.preparedSelection=h.input.prepareSelection(d.focus))}for(var p=0;p<n.length;p++){f=void 0;m=void 0;g=void 0;var f=n[p];var m=f.cm;null!=f.adjustWidthTo&&(m.display.sizer.style.minWidth=f.adjustWidthTo+"px",f.maxScrollLeft<m.doc.scrollLeft&&Li(m,Math.min(m.display.scroller.scrollLeft,f.maxScrollLeft),!0),m.display.maxLineChanged=!1);var g=f.focus&&f.focus==ie()&&(!document.hasFocus||document.hasFocus());f.preparedSelection&&m.display.input.showSelection(f.preparedSelection,g);!f.updatedDisplay&&f.startHeight==m.doc.height||Bi(m,f.barMeasure);f.updatedDisplay&&Zi(m,f.barMeasure);f.selectionChanged&&pi(m);m.state.focused&&f.updateInput&&m.display.input.reset(f.typing);g&&fi(f.cm)}for(var y,v=0;v<n.length;v++){b=void 0;w=void 0;x=void 0;C=void 0;y=void 0;F=void 0;S=void 0;k=void 0;E=void 0;var b=n[v];var w=b.cm,x=w.display,C=w.doc;b.updatedDisplay&&Gi(w,b.update);null==x.wheelStartX||null==b.scrollTop&&null==b.scrollLeft&&!b.scrollToPos||(x.wheelStartX=x.wheelStartY=null);null!=b.scrollTop&&Mi(w,b.scrollTop,b.forceScroll);null!=b.scrollLeft&&Li(w,b.scrollLeft,!0,!0);b.scrollToPos&&(y=function(e,t,n,i){null==i&&(i=0);for(var r=0;r<5;r++){var o,a=!1,s=Qn(e,t),l=n&&n!=t?Qn(e,n):s,s=Fi(e,o={left:Math.min(s.left,l.left),top:Math.min(s.top,l.top)-i,right:Math.max(s.left,l.left),bottom:Math.max(s.bottom,l.bottom)+i}),l=e.doc.scrollTop,c=e.doc.scrollLeft;if(null!=s.scrollTop&&(Ai(e,s.scrollTop),1<Math.abs(e.doc.scrollTop-l))&&(a=!0),!(a=null!=s.scrollLeft&&(Li(e,s.scrollLeft),1<Math.abs(e.doc.scrollLeft-c))?!0:a))break}return o}(w,W(C,b.scrollToPos.from),W(C,b.scrollToPos.to),b.scrollToPos.margin),function(e,t){var n,i,r,o;J(e,"scrollCursorIntoView")||(o=(n=e.display).sizer.getBoundingClientRect(),i=null,r=File.editor.sourceView&&File.editor.sourceView.inSourceMode?0:16,t.top+o.top<0?i=!0:(t.bottom+o.top>(window.innerHeight||document.documentElement.clientHeight)-r||(o=n.sizer.closest(".md-diagram, .md-math-block"))&&o.getBoundingClientRect().bottom>(window.innerHeight||document.documentElement.clientHeight)-r)&&(i=!1),null==i)||A||(o=T("div","​",null,"position: absolute;\n                         top: "+(t.top-n.viewOffset-An(e.display))+"px;\n                         height: "+(t.bottom-t.top+Nn(e)+n.barHeight)+"px;\n                         left: "+t.left+"px; width: "+Math.max(2,t.right-t.left)+"px;"),e.display.lineSpace.appendChild(o),File.editor.sourceView&&File.editor.sourceView.inSourceMode?o.scrollIntoView(i):File.editor.fences&&!File.editor.fences.isMousePressed?File.editor.selection.scrollAdjust(o):o.scrollIntoViewIfNeeded?o.scrollIntoViewIfNeeded(!1):o.scrollIntoView(i),e.display.lineSpace.removeChild(o))}(w,y));var F=b.maybeHiddenMarkers,S=b.maybeUnhiddenMarkers;if(F)for(var k=0;k<F.length;++k)F[k].lines.length||_(F[k],"hide");if(S)for(var E=0;E<S.length;++E)S[E].lines.length&&_(S[E],"unhide");x.wrapper.offsetHeight&&(C.scrollTop=w.display.scroller.scrollTop);b.changeObjs&&_(w,"changes",w,b.changeObjs);b.update&&b.update.finish()}};if(e=e.ownsGroup)try{var n=e,i=n.delayedCallbacks,r=0;do{for(;r<i.length;r++)i[r].call(null);for(var o=0;o<n.ops.length;o++){var a=n.ops[o];if(a.cursorActivityHandlers)for(;a.cursorActivityCalled<a.cursorActivityHandlers.length;)a.cursorActivityHandlers[a.cursorActivityCalled++].call(null,a.cm)}}while(r<i.length)}finally{yn=null,t(e)}}function h(e,t){if(e.curOp)return t();Hi(e);try{return t()}finally{Ui(e)}}function Y(e,t){return function(){if(e.curOp)return t.apply(e,arguments);Hi(e);try{return t.apply(e,arguments)}finally{Ui(e)}}}function n(e){return function(){if(this.curOp)return e.apply(this,arguments);Hi(this);try{return e.apply(this,arguments)}finally{Ui(this)}}}function i(t){return function(){var e=this.cm;if(!e||e.curOp)return t.apply(this,arguments);Hi(e);try{return t.apply(this,arguments)}finally{Ui(e)}}}function b(e,t,n,i){null==t&&(t=e.doc.first),null==n&&(n=e.doc.first+e.doc.size);var r,o=e.display,a=((i=i||0)&&n<o.viewTo&&(null==o.updateLineNumbers||o.updateLineNumbers>t)&&(o.updateLineNumbers=t),e.curOp.viewChanged=!0,t>=o.viewTo?We&&ot(e.doc,t)<o.viewTo&&qi(e):n<=o.viewFrom?We&&at(e.doc,n+i)>o.viewFrom?qi(e):(o.viewFrom+=i,o.viewTo+=i):t<=o.viewFrom&&n>=o.viewTo?qi(e):t<=o.viewFrom?(a=Wi(e,n,n+i,1))?(o.view=o.view.slice(a.index),o.viewFrom=a.lineN,o.viewTo+=i):qi(e):n>=o.viewTo?(a=Wi(e,t,t,-1))?(o.view=o.view.slice(0,a.index),o.viewTo=a.lineN):qi(e):(a=Wi(e,t,t,-1),r=Wi(e,n,n+i,1),a&&r?(o.view=o.view.slice(0,a.index).concat(gn(e,a.lineN,r.lineN)).concat(o.view.slice(r.index)),o.viewTo+=i):qi(e)),o.externalMeasured);a&&(n<a.lineN?a.lineN+=i:t<a.lineN+a.size&&(o.externalMeasured=null))}function ji(e,t,n){e.curOp.viewChanged=!0;var i=e.display,r=e.display.externalMeasured;r&&t>=r.lineN&&t<r.lineN+r.size&&(i.externalMeasured=null),t<i.viewFrom||t>=i.viewTo||null!=(r=i.view[ci(e,t)]).node&&-1==w(i=r.changes||(r.changes=[]),n)&&i.push(n)}function qi(e){e.display.viewFrom=e.display.viewTo=e.doc.first,e.display.view=[],e.display.viewOffset=0}function Wi(e,t,n,i){var r,o=ci(e,t),a=e.display.view;if(We&&n!=e.doc.first+e.doc.size){for(var s=e.display.viewFrom,l=0;l<o;l++)s+=a[l].size;if(s!=t){if(0<i){if(o==a.length-1)return null;r=s+a[o].size-t,o++}else r=s-t;t+=r,n+=r}for(;ot(e.doc,n)!=n;){if(o==(i<0?0:a.length-1))return null;n+=i*a[o-(i<0?1:0)].size,o+=i}}return{index:o,lineN:n}}function zi(e){for(var t=e.display.view,n=0,i=0;i<t.length;i++){var r=t[i];r.hidden||r.node&&!r.changes||++n}return n}function Vi(e,t){e.doc.mode.startState&&e.doc.frontier<e.display.viewTo&&e.state.highlight.set(t,le(Ji,e))}function Ji(s){var l,c,d,u=s.doc;u.frontier<u.first&&(u.frontier=u.first),u.frontier>=s.display.viewTo||(l=+new Date+s.options.workTime,c=Kt(u.mode,Zt(s,u.frontier)),d=[],u.iter(u.frontier,Math.min(u.first+u.size,s.display.viewTo+500),function(e){if(u.frontier>=s.display.viewFrom){for(var t=e.styles,n=e.text.length>s.options.maxHighlightLength,i=Qt(s,e,n?Kt(u.mode,c):c,!0),r=(e.styles=i.styles,e.styleClasses),i=i.classes,o=(i?e.styleClasses=i:r&&(e.styleClasses=null),!t||t.length!=e.styles.length||r!=i&&(!r||!i||r.bgClass!=i.bgClass||r.textClass!=i.textClass)),a=0;!o&&a<t.length;++a)o=t[a]!=e.styles[a];o&&d.push(u.frontier),e.stateAfter=n?c:Kt(u.mode,c)}else e.text.length<=s.options.maxHighlightLength&&en(s,e.text,c),e.stateAfter=u.frontier%5==0?Kt(u.mode,c):null;if(++u.frontier,+new Date>l)return Vi(s,s.options.workDelay),!0}),d.length&&h(s,function(){for(var e=0;e<d.length;e++)ji(s,d[e],"text")}))}var Ki=function(e,t,n){var i=e.display;this.viewport=t,this.visible=wi(i,e.doc,t),this.editorIsHidden=!i.wrapper.offsetWidth,this.wrapperHeight=i.wrapper.clientHeight,this.wrapperWidth=i.wrapper.clientWidth,this.oldDisplayWidth=Dn(e),this.force=n,this.dims=ri(e),this.events=[]};function Yi(e,t){var n=e.display,i=e.doc;if(t.editorIsHidden)return qi(e),!1;if(!t.force&&t.visible.from>=n.viewFrom&&t.visible.to<=n.viewTo&&(null==n.updateLineNumbers||n.updateLineNumbers>=n.viewTo)&&n.renderedView==n.view&&0==zi(e))return!1;Ci(e)&&(qi(e),t.dims=ri(e));var r=i.first+i.size,o=Math.max(t.visible.from-e.options.viewportMargin,i.first),a=Math.min(r,t.visible.to+e.options.viewportMargin),i=(n.viewFrom<o&&o-n.viewFrom<20&&(o=Math.max(i.first,n.viewFrom)),n.viewTo>a&&n.viewTo-a<20&&(a=Math.min(r,n.viewTo)),We&&(o=ot(e.doc,o),a=at(e.doc,a)),o!=n.viewFrom||a!=n.viewTo||n.lastWrapHeight!=t.wrapperHeight||n.lastWrapWidth!=t.wrapperWidth),r=(r=o,o=a,0==(s=(a=e).display).view.length||r>=s.viewTo||o<=s.viewFrom?(s.view=gn(a,r,o),s.viewFrom=r):(s.viewFrom>r?s.view=gn(a,r,s.viewFrom).concat(s.view):s.viewFrom<r&&(s.view=s.view.slice(ci(a,r))),s.viewFrom=r,s.viewTo<o?s.view=s.view.concat(gn(a,s.viewTo,o)):s.viewTo>o&&(s.view=s.view.slice(0,ci(a,o)))),s.viewTo=o,n.viewOffset=lt(U(e.doc,n.viewFrom)),e.display.mover.style.top=n.viewOffset+"px",zi(e));if(!i&&0==r&&!t.force&&n.renderedView==n.view&&(null==n.updateLineNumbers||n.updateLineNumbers>=n.viewTo))return!1;var s,a=!(a=e).hasFocus()&&(s=ie())&&ne(a.display.lineDiv,s)?(s={activeElt:s},window.getSelection&&(o=window.getSelection()).anchorNode&&o.extend&&ne(a.display.lineDiv,o.anchorNode)&&(s.anchorNode=o.anchorNode,s.anchorOffset=o.anchorOffset,s.focusNode=o.focusNode,s.focusOffset=o.focusOffset),s):null,l=(4<r&&(n.lineDiv.style.display="none"),e),c=n.updateLineNumbers,d=t.dims,o=l.display,u=l.options.lineNumbers,h=o.lineDiv,p=h.firstChild;function f(e){var t=e.nextSibling;return I&&Z&&l.display.currentWheelTarget==e?e.style.display="none":e.parentNode.removeChild(e),t}for(var m=o.view,g=o.viewFrom,y=0;y<m.length;y++){var v=m[y];if(!v.hidden)if(v.node&&v.node.parentNode==h){for(;p!=v.node;)p=f(p);var b=u&&null!=c&&c<=g&&v.lineNumber;v.changes&&(-1<w(v.changes,"gutter")&&(b=!1),wn(l,v,g,d)),b&&(P(v.lineNumber),v.lineNumber.appendChild(document.createTextNode(Re(l.options,g)))),p=v.node.nextSibling}else{b=function(e,t,n,i){var r=Cn(e,t);return t.text=t.node=r.pre,r.bgClass&&(t.bgClass=r.bgClass),r.textClass&&(t.textClass=r.textClass),Fn(e,t),Sn(e,t,n,i),kn(e,t,i),t.node}(l,v,g,d);h.insertBefore(b,p)}g+=v.size}for(;p;)p=f(p);return 4<r&&(n.lineDiv.style.display=""),n.renderedView=n.view,(s=a)&&s.activeElt&&s.activeElt!=ie()&&(s.activeElt.focus(),s.anchorNode)&&ne(document.body,s.anchorNode)&&ne(document.body,s.focusNode)&&(o=window.getSelection(),(r=document.createRange()).setEnd(s.anchorNode,s.anchorOffset),r.collapse(!1),o.removeAllRanges(),o.addRange(r),o.extend(s.focusNode,s.focusOffset)),P(n.cursorDiv),P(n.selectionDiv),n.gutters.style.height=n.sizer.style.minHeight=0,i&&(n.lastWrapHeight=t.wrapperHeight,n.lastWrapWidth=t.wrapperWidth,Vi(e,400)),!(n.updateLineNumbers=null)}function Gi(e,t){for(var n=t.viewport,i=!0;(i&&e.options.lineWrapping&&t.oldDisplayWidth!=Dn(e)||(n&&null!=n.top&&(n={top:Math.min(e.doc.height+Mn(e.display)-Pn(e),n.top)}),t.visible=wi(e.display,e.doc,n),!(t.visible.from>=e.display.viewFrom))||!(t.visible.to<=e.display.viewTo))&&Yi(e,t);i=!1){vi(e);var r=Ni(e);di(e),Bi(e,r),Zi(e,r)}t.signal(e,"update",e),e.display.viewFrom==e.display.reportedViewFrom&&e.display.viewTo==e.display.reportedViewTo||(t.signal(e,"viewportChange",e,e.display.viewFrom,e.display.viewTo),e.display.reportedViewFrom=e.display.viewFrom,e.display.reportedViewTo=e.display.viewTo)}function Qi(e,t){var n,t=new Ki(e,t);Yi(e,t)&&(vi(e),Gi(e,t),n=Ni(e),di(e),Bi(e,n),Zi(e,n),t.finish())}function Xi(e){var t=e.display.gutters.offsetWidth;e.display.sizer.style.marginLeft=t+"px"}function Zi(e,t){e.display.sizer.style.minHeight=t.docHeight+"px",e.display.heightForcer.style.top=t.docHeight+"px",e.display.gutters.style.height=t.docHeight+e.display.barHeight+Nn(e)+"px"}function er(e){for(var t=e.display.gutters,n=e.options.gutters,i=(P(t),0);i<n.length;++i){var r=n[i],o=t.appendChild(T("div",null,"CodeMirror-gutter "+r));"CodeMirror-linenumbers"==r&&((e.display.lineGutter=o).style.width=(e.display.lineNumWidth||1)+"px")}t.style.display=i?"":"none",Xi(e)}function tr(e){var t=w(e.gutters,"CodeMirror-linenumbers");-1==t&&e.lineNumbers?e.gutters=e.gutters.concat(["CodeMirror-linenumbers"]):-1<t&&!e.lineNumbers&&(e.gutters=e.gutters.slice(0),e.gutters.splice(t,1))}Ki.prototype.signal=function(e,t){_t(e,t)&&this.events.push(arguments)},Ki.prototype.finish=function(){for(var e=0;e<this.events.length;e++)_.apply(null,this.events[e])};var nr=0,ir=null;function rr(e){var t=e.wheelDeltaX,n=e.wheelDeltaY;return null==t&&e.detail&&e.axis==e.HORIZONTAL_AXIS&&(t=e.detail),null==n&&e.detail&&e.axis==e.VERTICAL_AXIS?n=e.detail:null==n&&(n=e.wheelDelta),{x:t,y:n}}function or(e){e=rr(e);return e.x*=ir,e.y*=ir,e}function ar(e,t){var n,i,r=rr(t),o=r.x,r=r.y,a=e.display,s=a.scroller,l=s.scrollWidth>s.clientWidth;if(o&&l){if(r&&Z&&I)e:for(var c=t.target,d=a.view;c!=s;c=c.parentNode)for(var u=0;u<d.length;u++)if(d[u].node==c){e.display.currentWheelTarget=c;break e}!o||p||S||null==ir?(r&&null!=ir&&(l=r*ir,i=(n=e.doc.scrollTop)+a.wrapper.clientHeight,l<0?n=Math.max(0,n+l-50):i=Math.min(e.doc.height,i+l+50),Qi(e,{top:n,bottom:i})),nr<20&&(null==a.wheelStartX?(a.wheelStartX=s.scrollLeft,a.wheelStartY=s.scrollTop,a.wheelDX=o,a.wheelDY=r,setTimeout(function(){var e,t;null!=a.wheelStartX&&(e=s.scrollLeft-a.wheelStartX,t=(t=s.scrollTop-a.wheelStartY)&&a.wheelDY&&t/a.wheelDY||e&&a.wheelDX&&e/a.wheelDX,a.wheelStartX=a.wheelStartY=null,t)&&(ir=(ir*nr+t)/(nr+1),++nr)},200)):(a.wheelDX+=o,a.wheelDY+=r))):(o&&Li(e,Math.max(0,s.scrollLeft+o*ir)),a.wheelStartX=null)}}R?ir=-.53:p?ir=15:d?ir=-.7:k&&(ir=-1/3);var G=function(e,t){this.ranges=e,this.primIndex=t},Q=(G.prototype.primary=function(){return this.ranges[this.primIndex]},G.prototype.equals=function(e){if(e!=this){if(e.primIndex!=this.primIndex||e.ranges.length!=this.ranges.length)return!1;for(var t=0;t<this.ranges.length;t++){var n=this.ranges[t],i=e.ranges[t];if(!Oe(n.anchor,i.anchor)||!Oe(n.head,i.head))return!1}}return!0},G.prototype.deepCopy=function(){for(var e=[],t=0;t<this.ranges.length;t++)e[t]=new Q(Ie(this.ranges[t].anchor),Ie(this.ranges[t].head));return new G(e,this.primIndex)},G.prototype.somethingSelected=function(){for(var e=0;e<this.ranges.length;e++)if(!this.ranges[e].empty())return!0;return!1},G.prototype.contains=function(e,t){t=t||e;for(var n=0;n<this.ranges.length;n++){var i=this.ranges[n];if(0<=q(t,i.from())&&q(e,i.to())<=0)return n}return-1},function(e,t){this.anchor=e,this.head=t});function sr(e,t){var n=e[t];e.sort(function(e,t){return q(e.from(),t.from())}),t=w(e,n);for(var i=1;i<e.length;i++){var r,o,a=e[i],s=e[i-1];0<=q(s.to(),a.from())&&(r=He(s.from(),a.from()),o=$e(s.to(),a.to()),a=s.empty()?a.from()==a.head:s.from()==s.head,i<=t&&--t,e.splice(--i,2,new Q(a?o:r,a?r:o)))}return new G(e,t)}function lr(e,t){return new G([new Q(e,t||e)],0)}function cr(e){return e.text?j(e.from.line+e.text.length-1,H(e.text).length+(1==e.text.length?e.from.ch:0)):e.to}function dr(e,t){var n,i;return q(e,t.from)<0?e:q(e,t.to)<=0?cr(t):(n=e.line+t.text.length-(t.to.line-t.from.line)-1,i=e.ch,e.line==t.to.line&&(i+=cr(t).ch-t.to.ch),j(n,i))}function ur(e,t){for(var n=[],i=0;i<e.sel.ranges.length;i++){var r=e.sel.ranges[i],r=new Q(dr(r.anchor,t),dr(r.head,t));t.redoSel&&(r.anchor=t.from,"select"==t.redoSel)&&(r.head.line=t.from.line,r.head.ch=t.from.ch+(t.text[0]||"").length),n.push(r)}return sr(n,e.sel.primIndex)}function hr(e,t,n){return e.line==t.line?j(n.line,e.ch-t.ch+n.ch):j(n.line+(e.line-t.line),e.ch)}function pr(e){e.doc.mode=zt(e.options,e.doc.modeOption),fr(e)}function fr(e){e.doc.iter(function(e){e.stateAfter&&(e.stateAfter=null),e.styles&&(e.styles=null)}),e.doc.frontier=e.doc.first,Vi(e,100),e.state.modeGen++,e.curOp&&b(e)}function mr(e,t){return 0==t.from.ch&&0==t.to.ch&&""==H(t.text)&&(!e.cm||e.cm.options.wholeLineUpdateBefore)}function gr(e,o,t,a){function r(e){return t?t[e]:null}function n(e,t,n){var i,r;t=t,n=n,r=a,(i=e).text=t,i.stateAfter&&(i.stateAfter=null),i.styles&&(i.styles=null),null!=i.order&&(i.order=null),Ye(i),Ge(i,n),(t=r?r(i):1)!=i.height&&De(i,t),v(e,"change",e,o)}function i(e,t){for(var n=[],i=e;i<t;++i)n.push(new sn(d[i],r(i),a));return n}var s,l=o.from,c=o.to,d=o.text,u=U(e,l.line),h=U(e,c.line),p=H(d),f=r(d.length-1),m=c.line-l.line;o.full?(e.insert(0,i(0,d.length)),e.remove(d.length,e.size-d.length)):mr(e,o)?(s=i(0,d.length-1),n(h,h.text,f),m&&e.remove(l.line,m),s.length&&e.insert(l.line,s)):u==h?1==d.length?n(u,u.text.slice(0,l.ch)+p+u.text.slice(c.ch),f):((s=i(1,d.length-1)).push(new sn(p+u.text.slice(c.ch),f,a)),n(u,u.text.slice(0,l.ch)+d[0],r(0)),e.insert(l.line+1,s)):1==d.length?(n(u,u.text.slice(0,l.ch)+d[0]+h.text.slice(c.ch),r(0)),e.remove(l.line+1,m)):(n(u,u.text.slice(0,l.ch)+d[0],r(0)),n(h,p+h.text.slice(c.ch),f),s=i(1,d.length-1),1<m&&e.remove(l.line+1,m-1),e.insert(l.line+1,s)),v(e,"change",e,o)}function yr(e,s,l){!function e(t,n,i){if(t.linked)for(var r=0;r<t.linked.length;++r){var o,a=t.linked[r];a.doc!=n&&(o=i&&a.sharedHist,!l||o)&&(s(a.doc,o),e(a.doc,t,o))}}(e,null,!0)}function vr(e,t){if(t.cm)throw new Error("This document is already in use.");si((e.doc=t).cm=e),pr(e),br(e),e.options.lineWrapping||dt(e),e.options.mode=t.modeOption,b(e)}function br(e){("rtl"==e.doc.direction?re:D)(e.display.lineDiv,"CodeMirror-rtl")}function wr(e){this.done=[],this.undone=[],this.undoDepth=1/0,this.lastModTime=this.lastSelTime=0,this.lastOp=this.lastSelOp=null,this.lastOrigin=this.lastSelOrigin=null,this.generation=this.maxGeneration=e||1}function xr(e,t){var n={from:Ie(t.from),to:cr(t),text:Le(e,t.from,t.to)};return _r(e,n,t.from.line,t.to.line+1),yr(e,function(e){return _r(e,n,t.from.line,t.to.line+1)},!0),n}function Cr(e){for(;e.length;){if(!H(e).ranges)break;e.pop()}}function Fr(e,t){return t?{from:t.from,to:t.to,text:t.text,redoSel:!!t["spans_"+e.id],origin:t.origin}:null}function Sr(e,t){var n=Fr(e,t),i=Fr(e,xr(e,t));return n.origin="undo",i.origin="undo","+findReplace"==t.origin&&(n.redoSel="select",i.redoSel="select"),{undo:[{type:"fences",change:i,id:e.cm.cid}],redo:[{type:"fences",change:n,id:e.cm.cid}]}}function kr(e,t,n,i){if(t&&"undo"==t.origin)e.clearHistory();else{var r,o,a,s=e.history,l=(s.undone.length=0,+new Date),c=1<(t.text||[]).length,c=(t.origin=t.origin||"",!c&&(s.lastOp==i||s.lastOrigin==t.origin&&t.origin&&("+"==t.origin.charAt(0)&&e.cm&&s.lastModTime>l-e.cm.options.historyEventDelay||"*"==t.origin.charAt(0))));if(e.cm.editor.sourceView.inSourceMode||!e.cm.cid)if(c=c&&(a=(a=s).lastOp==i?(Cr(a.done),H(a.done)):a.done.length&&!H(a.done).ranges?H(a.done):1<a.done.length&&!a.done[a.done.length-2].ranges?(a.done.pop(),H(a.done)):void 0))r=H(a.changes),0==q(t.from,t.to)&&0==q(t.from,r.to)?r.to=cr(t):a.changes.push(xr(e,t));else{var d=H(s.done);for(d&&d.ranges||Tr(e.sel,s.done),a={changes:[xr(e,t)],generation:s.generation},s.done.push(a);s.done.length>s.undoDepth;)s.done.shift(),s.done[0].ranges||s.done.shift()}else if(c&&(r=(d=e.cm.editor.undo.lastRegisteredOperationCommand())&&(d.undo.last()||{}).change,File.isNode&&File.changeCounter.withdrawAutoSaved()&&(c=!1),u=d&&(d.redo.last()||{}).change,r&&u?0==q(t.from,t.to)&&0==q(t.from,r.to)&&1==r.text.length?(r.to=cr(t),o=t.text[0],u.text[u.text.length-1]=u.text[u.text.length-1]+(o||""),u.text=u.text.concat(t.text.slice(1))):s.lastOp==i||1==r.text.length&&d.undo.length<8?(o=Sr(e,t),d.undo.push(o.undo[0]),d.redo.push(o.redo[0])):c=!1:c=!1),!c&&"setValue"!=t.origin&&e.cm.cid){var u=Sr(e,t);if("cut-line"==t.origin){d=e.cm.editor.undo.lastRegisteredOperationCommand();if(d&&"fences-pos"==(d.undo[0]||{}).type)return d.undo=d.undo.concat(u.undo),void(d.redo=u.redo)}e.cm.editor.undo.register(u)}s.done.push(n),s.generation=++s.maxGeneration,s.lastModTime=s.lastSelTime=l,s.lastOp=s.lastSelOp=i,s.lastOrigin=s.lastSelOrigin=t.origin,r||_(e,"historyAdded")}}function Er(e,t,n,i){var r,o,a,s=e.history,l=i&&i.origin;n==s.lastSelOp||l&&s.lastSelOrigin==l&&(s.lastModTime==s.lastSelTime&&s.lastOrigin==l||(e=e,r=l,o=H(s.done),a=t,"*"==(r=r.charAt(0)))||"+"==r&&o.ranges.length==a.ranges.length&&o.somethingSelected()==a.somethingSelected()&&new Date-e.history.lastSelTime<=(e.cm?e.cm.options.historyEventDelay:500))?s.done[s.done.length-1]=t:Tr(t,s.done),s.lastSelTime=+new Date,s.lastSelOrigin=l,s.lastSelOp=n,i&&!1!==i.clearRedo&&Cr(s.undone)}function Tr(e,t){var n=H(t);n&&n.ranges&&n.equals(e)||t.push(e)}function _r(t,n,e,i){var r=n["spans_"+t.id],o=0;t.iter(Math.max(t.first,e),Math.min(t.first+t.size,i),function(e){e.markedSpans&&((r=r||(n["spans_"+t.id]={}))[o]=e.markedSpans),++o})}function Ar(e,t){var n=t["spans_"+e.id];if(!n)return null;for(var i=[],r=0;r<t.text.length;++r)i.push(function(e){if(!e)return null;for(var t,n=0;n<e.length;++n)e[n].marker.explicitlyCleared?t=t||e.slice(0,n):t&&t.push(e[n]);return t?t.length?t:null:e}(n[r]));return i}function Mr(e,t){var n=Ar(e,t),i=Je(e,t);if(!n)return i;if(i)for(var r=0;r<n.length;++r){var o=n[r],a=i[r];if(o&&a)e:for(var s=0;s<a.length;++s){for(var l=a[s],c=0;c<o.length;++c)if(o[c].marker==l.marker)continue e;o.push(l)}else a&&(n[r]=a)}return n}function Lr(e,t,n){for(var i=[],r=0;r<e.length;++r){var o=e[r];if(o.ranges)i.push(n?G.prototype.deepCopy.call(o):o);else{var a=o.changes,s=[];i.push({changes:s});for(var l=0;l<a.length;++l){var c,d=a[l];if(s.push({from:d.from,to:d.to,text:d.text}),t)for(var u in d)(c=u.match(/^spans_(\d+)$/))&&-1<w(t,Number(c[1]))&&(H(s)[u]=d[u],delete d[u])}}}return i}function Nr(e,t,n,i){return e.cm&&e.cm.display.shift||e.extend?(e=t.anchor,i&&((t=q(n,e)<0)!=q(i,e)<0?(e=n,n=i):t!=q(n,i)<0&&(n=i)),new Q(e,n)):new Q(i||n,n)}function Dr(e,t,n,i){X(e,new G([Nr(e,e.sel.primary(),t,n)],0),i)}function Pr(e,t,n){for(var i=[],r=0;r<e.sel.ranges.length;r++)i[r]=Nr(e,e.sel.ranges[r],t[r],null);X(e,sr(i,e.sel.primIndex),n)}function Br(e,t,n,i){var r=e.sel.ranges.slice(0);r[t]=n,X(e,sr(r,e.sel.primIndex),i)}function Rr(e,t,n,i){X(e,lr(t,n),i)}function Or(e,t,n){var i=e.history.done,r=H(i);r&&r.ranges?Ir(e,i[i.length-1]=t,n):X(e,t,n)}function X(e,t,n){Ir(e,t,n),Er(e,e.sel,e.cm?e.cm.curOp.id:NaN,n)}function Ir(e,t,n){(_t(e,"beforeSelectionChange")||e.cm&&_t(e.cm,"beforeSelectionChange"))&&(i=e,o=n,o={ranges:(r=t).ranges,update:function(e){this.ranges=[];for(var t=0;t<e.length;t++)this.ranges[t]=new Q(W(i,e[t].anchor),W(i,e[t].head))},origin:o&&o.origin},_(i,"beforeSelectionChange",i,o),i.cm&&_(i.cm,"beforeSelectionChange",i.cm,o),t=o.ranges!=r.ranges?sr(o.ranges,o.ranges.length-1):r);var i,r,o=n&&n.bias||(q(t.primary().head,e.sel.primary().head)<0?-1:1);$r(e,Ur(e,t,o,!0)),n&&!1===n.scroll||!e.cm||ki(e.cm)}function $r(e,t){t.equals(e.sel)||(e.sel=t,e.cm&&(e.cm.curOp.updateInput=e.cm.curOp.selectionChanged=!0,Tt(e.cm)),v(e,"cursorActivity",e))}function Hr(e){$r(e,Ur(e,e.sel,null,!1))}function Ur(e,t,n,i){for(var r,o=0;o<t.ranges.length;o++){var a=t.ranges[o],s=t.ranges.length==e.sel.ranges.length&&e.sel.ranges[o],l=qr(e,a.anchor,s&&s.anchor,n,i),s=qr(e,a.head,s&&s.head,n,i);!r&&l==a.anchor&&s==a.head||((r=r||t.ranges.slice(0,o))[o]=new Q(l,s))}return r?sr(r,t.primIndex):t}function jr(e,t,n,i,r){var o=U(e,t.line);if(o.markedSpans)for(var a=0;a<o.markedSpans.length;++a){var s=o.markedSpans[a],l=s.marker;if((null==s.from||(l.inclusiveLeft?s.from<=t.ch:s.from<t.ch))&&(null==s.to||(l.inclusiveRight?s.to>=t.ch:s.to>t.ch))){if(r&&(_(l,"beforeCursorEnter"),l.explicitlyCleared)){if(o.markedSpans){--a;continue}break}if(l.atomic){if(n){var s=l.find(i<0?1:-1),c=void 0;if((s=(i<0?l.inclusiveRight:l.inclusiveLeft)?Wr(e,s,-i,s&&s.line==t.line?o:null):s)&&s.line==t.line&&(c=q(s,n))&&(i<0?c<0:0<c))return jr(e,s,t,i,r)}c=l.find(i<0?-1:1);return(c=(i<0?l.inclusiveLeft:l.inclusiveRight)?Wr(e,c,i,c.line==t.line?o:null):c)?jr(e,c,t,i,r):null}}}return t}function qr(e,t,n,i,r){i=i||1,r=jr(e,t,n,i,r)||!r&&jr(e,t,n,i,!0)||jr(e,t,n,-i,r)||!r&&jr(e,t,n,-i,!0);return r||(e.cantEdit=!0,j(e.first,0))}function Wr(e,t,n,i){return n<0&&0==t.ch?t.line>e.first?W(e,j(t.line-1)):null:0<n&&t.ch==(i||U(e,t.line)).text.length?t.line<e.first+e.size-1?j(t.line+1,0):null:new j(t.line,t.ch+n)}function zr(e){e.setSelection(j(e.firstLine(),0),j(e.lastLine()),pe)}function Vr(r,e,t){var o={canceled:!1,from:e.from,to:e.to,text:e.text,origin:e.origin,cancel:function(){return o.canceled=!0}};return t&&(o.update=function(e,t,n,i){e&&(o.from=W(r,e)),t&&(o.to=W(r,t)),n&&(o.text=n),void 0!==i&&(o.origin=i)}),_(r,"beforeChange",r,o),r.cm&&_(r.cm,"beforeChange",r.cm,o),o.canceled?null:{from:o.from,to:o.to,text:o.text,origin:o.origin}}function Jr(e,t,n){if(e.cm){if(!e.cm.curOp)return Y(e.cm,Jr)(e,t,n);if(e.cm.state.suppressEdits)return}if(!(_t(e,"beforeChange")||e.cm&&_t(e.cm,"beforeChange"))||(t=Vr(e,t,!0))){var i=qe&&!n&&function(e,t,n){var i=null;if(e.iter(t.line,n.line+1,function(e){if(e.markedSpans)for(var t=0;t<e.markedSpans.length;++t){var n=e.markedSpans[t].marker;!n.readOnly||i&&-1!=w(i,n)||(i=i||[]).push(n)}}),!i)return null;for(var r=[{from:t,to:n}],o=0;o<i.length;++o)for(var a=i[o],s=a.find(0),l=0;l<r.length;++l){var c,d,u,h=r[l];q(h.to,s.from)<0||0<q(h.from,s.to)||(c=[l,1],d=q(h.from,s.from),u=q(h.to,s.to),(d<0||!a.inclusiveLeft&&!d)&&c.push({from:h.from,to:s.from}),(0<u||!a.inclusiveRight&&!u)&&c.push({from:s.to,to:h.to}),r.splice.apply(r,c),l+=c.length-3)}return r}(e,t.from,t.to);if(i)for(var r=i.length-1;0<=r;--r)Kr(e,{from:i[r].from,to:i[r].to,text:r?[""]:t.text});else Kr(e,t)}}function Kr(e,n){var t,i;1==n.text.length&&""==n.text[0]&&0==q(n.from,n.to)||(t=ur(e,n),kr(e,n,t,e.cm?e.cm.curOp.id:NaN),Qr(e,n,t,Je(e,n)),i=[],yr(e,function(e,t){t||-1!=w(i,e.history)||(to(e.history,n),i.push(e.history)),Qr(e,n,null,Je(e,n))}))}function Yr(r,o,e){if(!r.cm||!r.cm.state.suppressEdits||e){for(var a,t=r.history,n=r.sel,s="undo"==o?t.done:t.undone,i="undo"==o?t.undone:t.done,l=0;l<s.length&&(a=s[l],e?!a.ranges||a.equals(r.sel):a.ranges);l++);if(l!=s.length){for(t.lastOrigin=t.lastSelOrigin=null;(a=s.pop()).ranges;){if(Tr(a,i),e&&!a.equals(r.sel))return void X(r,a,{clearRedo:!1});n=a}for(var c=[],d=(Tr(n,i),i.push({changes:c,generation:t.generation}),t.generation=a.generation||++t.maxGeneration,_t(r,"beforeChange")||r.cm&&_t(r.cm,"beforeChange")),u=a.changes.length-1;0<=u;--u){var h=function(e){var n=a.changes[e];if(n.origin=o,d&&!Vr(r,n,!1))return s.length=0,{};c.push(xr(r,n));var t=e?ur(r,n):H(s),i=(Qr(r,n,t,Mr(r,n)),!e&&r.cm&&r.cm.scrollIntoView({from:n.from,to:cr(n)}),[]);yr(r,function(e,t){t||-1!=w(i,e.history)||(to(e.history,n),i.push(e.history)),Qr(e,n,null,Mr(e,n))})}(u);if(h)return h.v}}}}function Gr(e,t){if(0!=t&&(e.first+=t,e.sel=new G(be(e.sel.ranges,function(e){return new Q(j(e.anchor.line+t,e.anchor.ch),j(e.head.line+t,e.head.ch))}),e.sel.primIndex),e.cm)){b(e.cm,e.first,e.first-t,t);for(var n=e.cm.display,i=n.viewFrom;i<n.viewTo;i++)ji(e.cm,i,"gutter")}}function Qr(e,t,n,i){if(e.cm&&!e.cm.curOp)return Y(e.cm,Qr)(e,t,n,i);var r,o,a,s,l,c,d,u,h;t.to.line<e.first?Gr(e,t.text.length-1-(t.to.line-t.from.line)):t.from.line>e.lastLine()||(t.from.line<e.first&&(Gr(e,r=t.text.length-1-(e.first-t.from.line)),t={from:j(e.first,0),to:j(t.to.line+r,t.to.ch),text:[H(t.text)],origin:t.origin}),r=e.lastLine(),(t=t.to.line>r?{from:t.from,to:j(r,U(e,r).text.length),text:[t.text[0]],origin:t.origin}:t).removed=Le(e,t.from,t.to),n=n||ur(e,t),e.cm?(r=e.cm,o=t,a=i,s=r.doc,l=r.display,c=o.from,d=o.to,u=!1,h=c.line,r.options.lineWrapping||(h=x(rt(U(s,c.line))),s.iter(h,d.line+1,function(e){if(e==l.maxLine)return u=!0})),-1<s.sel.contains(o.from,o.to)&&Tt(r),gr(s,o,a,ai(r)),r.options.lineWrapping||(s.iter(h,c.line+o.text.length,function(e){var t=ct(e);t>l.maxLineLength&&(l.maxLine=e,l.maxLineLength=t,l.maxLineChanged=!0,u=!1)}),u&&(r.curOp.updateMaxLine=!0)),s.frontier=Math.min(s.frontier,c.line-1),Vi(r,400),a=o.text.length-(d.line-c.line)-1,o.full?b(r):c.line!=d.line||1!=o.text.length||mr(r.doc,o)?b(r,c.line,d.line+1,a):ji(r,c.line,"text"),h=_t(r,"changes"),((s=_t(r,"change"))||h)&&(a={from:c,to:d,text:o.text,removed:o.removed,origin:o.origin},s&&v(r,"change",r,a),h)&&(r.curOp.changeObjs||(r.curOp.changeObjs=[])).push(a),r.display.selForContextMenu=null):gr(e,t,i),Ir(e,n,pe))}function Xr(e,t,n,i,r){var o;q(i=i||n,n)<0&&(o=i,i=n,n=o),"string"==typeof t&&(t=e.splitLines(t)),Jr(e,{from:n,to:i,text:t,origin:r})}function Zr(e,t,n,i){n<e.line?e.line+=i:t<e.line&&(e.line=t,e.ch=0)}function eo(e,t,n,i){for(var r=0;r<e.length;++r){var o=e[r],a=!0;if(o.ranges){o.copied||((o=e[r]=o.deepCopy()).copied=!0);for(var s=0;s<o.ranges.length;s++)Zr(o.ranges[s].anchor,t,n,i),Zr(o.ranges[s].head,t,n,i)}else{for(var l=0;l<o.changes.length;++l){var c=o.changes[l];if(n<c.from.line)c.from=j(c.from.line+i,c.from.ch),c.to=j(c.to.line+i,c.to.ch);else if(t<=c.to.line){a=!1;break}}a||(e.splice(0,r+1),r=0)}}}function to(e,t){var n=t.from.line,i=t.to.line,t=t.text.length-(i-n)-1;eo(e.done,n,i,t),eo(e.undone,n,i,t)}function no(e,t,n,i){var r=t,o=t;return"number"==typeof t?o=U(e,Ue(e,t)):r=x(t),null==r?null:(i(o,r)&&e.cm&&ji(e.cm,r,n),o)}Q.prototype.from=function(){return He(this.anchor,this.head)},Q.prototype.to=function(){return $e(this.anchor,this.head)},Q.prototype.empty=function(){return this.head.line==this.anchor.line&&this.head.ch==this.anchor.ch};function io(e){this.lines=e,this.parent=null;for(var t=0,n=0;n<e.length;++n)e[n].parent=this,t+=e[n].height;this.height=t}function ro(e){this.children=e;for(var t=0,n=0,i=0;i<e.length;++i){var r=e[i];t+=r.chunkSize(),n+=r.height,r.parent=this}this.size=t,this.height=n,this.parent=null}function oo(e,t,n){if(n)for(var i in n)n.hasOwnProperty(i)&&(this[i]=n[i]);this.doc=e,this.node=t}io.prototype.chunkSize=function(){return this.lines.length},io.prototype.removeInner=function(e,t){for(var n,i=e,r=e+t;i<r;++i){var o=this.lines[i];this.height-=o.height,(n=o).parent=null,Ye(n),v(o,"delete")}this.lines.splice(e,t)},io.prototype.collapse=function(e){e.push.apply(e,this.lines)},io.prototype.insertInner=function(e,t,n){this.height+=n,this.lines=this.lines.slice(0,e).concat(t).concat(this.lines.slice(e));for(var i=0;i<t.length;++i)t[i].parent=this},io.prototype.iterN=function(e,t,n){for(var i=e+t;e<i;++e)if(n(this.lines[e]))return!0},ro.prototype.chunkSize=function(){return this.size},ro.prototype.removeInner=function(e,t){this.size-=t;for(var n,i=0;i<this.children.length;++i){var r=this.children[i],o=r.chunkSize();if(e<o){var a=Math.min(t,o-e),s=r.height;if(r.removeInner(e,a),this.height-=s-r.height,o==a&&(this.children.splice(i--,1),r.parent=null),0==(t-=a))break;e=0}else e-=o}this.size-t<25&&(1<this.children.length||!(this.children[0]instanceof io))&&(this.collapse(n=[]),this.children=[new io(n)],this.children[0].parent=this)},ro.prototype.collapse=function(e){for(var t=0;t<this.children.length;++t)this.children[t].collapse(e)},ro.prototype.insertInner=function(e,t,n){this.size+=t.length,this.height+=n;for(var i=0;i<this.children.length;++i){var r=this.children[i],o=r.chunkSize();if(e<=o){if(r.insertInner(e,t,n),r.lines&&50<r.lines.length){for(var a=r.lines.length%25+25,s=a;s<r.lines.length;){var l=new io(r.lines.slice(s,s+=25));r.height-=l.height,this.children.splice(++i,0,l),l.parent=this}r.lines=r.lines.slice(0,a),this.maybeSpill()}break}e-=o}},ro.prototype.maybeSpill=function(){if(!(this.children.length<=10)){var e=this;do{var t,n=e.children.splice(e.children.length-5,5),n=new ro(n)}while(e.parent?(e.size-=n.size,e.height-=n.height,t=w(e.parent.children,e),e.parent.children.splice(t+1,0,n)):(((t=new ro(e.children)).parent=e).children=[t,n],e=t),n.parent=e.parent,10<e.children.length);e.parent.maybeSpill()}},ro.prototype.iterN=function(e,t,n){for(var i=0;i<this.children.length;++i){var r=this.children[i],o=r.chunkSize();if(e<o){var a=Math.min(t,o-e);if(r.iterN(e,a,n))return!0;if(0==(t-=a))break;e=0}else e-=o}};function ao(e,t,n){lt(t)<(e.curOp&&e.curOp.scrollTop||e.doc.scrollTop)&&Si(e,n)}oo.prototype.clear=function(){var e=this.doc.cm,t=this.line.widgets,n=this.line,i=x(n);if(null!=i&&t){for(var r=0;r<t.length;++r)t[r]==this&&t.splice(r--,1);t.length||(n.widgets=null);var o=Tn(this);De(n,Math.max(0,n.height-o)),e&&(h(e,function(){ao(e,n,-o),ji(e,i,"widget")}),v(e,"lineWidgetCleared",e,this,i))}},oo.prototype.changed=function(){var e=this,t=this.height,n=this.doc.cm,i=this.line,r=(this.height=null,Tn(this)-t);r&&(De(i,i.height+r),n)&&h(n,function(){n.curOp.forceUpdate=!0,ao(n,i,r),v(n,"lineWidgetChanged",n,e,x(i))})},At(oo);function so(e,t){this.lines=[],this.type=t,this.doc=e,this.id=++lo}var lo=0;function co(t,n,i,e,r){if(e&&e.shared)return p=t,o=n,a=i,l=r,(s=ce(s=e)).shared=!1,c=[co(p,o,a,s,l)],d=c[0],u=s.widgetNode,yr(p,function(e){u&&(s.widgetNode=u.cloneNode(!0)),c.push(co(e,W(e,o),W(e,a),s,l));for(var t=0;t<e.linked.length;++t)if(e.linked[t].isParent)return;d=H(c)}),new uo(c,d);var o,a,s,l,c,d,u;if(t.cm&&!t.cm.curOp)return Y(t.cm,co)(t,n,i,e,r);var h=new so(t,r),p=q(n,i);if(e&&ce(e,h,!1),!(0<p||0==p&&!1!==h.clearWhenEmpty)){if(h.replacedWith&&(h.collapsed=!0,h.widgetNode=B("span",[h.replacedWith],"CodeMirror-widget"),e.handleMouseEvents||h.widgetNode.setAttribute("cm-ignore-events","true"),e.insertLeft)&&(h.widgetNode.insertLeft=!0),h.collapsed){if(it(t,n.line,n,i,h)||n.line!=i.line&&it(t,i.line,n,i,h))throw new Error("Inserting collapsed marker partially overlapping an existing one");We=!0}h.addToHistory&&kr(t,{from:n,to:i,origin:"markText"},t.sel,NaN);var f,m=n.line,g=t.cm;if(t.iter(m,i.line+1,function(e){var t;g&&h.collapsed&&!g.options.lineWrapping&&rt(e)==g.display.maxLine&&(f=!0),h.collapsed&&m!=n.line&&De(e,0),e=e,t=new ze(h,m==n.line?n.ch:null,m==i.line?i.ch:null),e.markedSpans=e.markedSpans?e.markedSpans.concat([t]):[t],t.marker.attachLine(e),++m}),h.collapsed&&t.iter(n.line,i.line+1,function(e){st(t,e)&&De(e,0)}),h.clearOnEnter&&z(h,"beforeCursorEnter",function(){return h.clear()}),h.readOnly&&(qe=!0,t.history.done.length||t.history.undone.length)&&t.clearHistory(),h.collapsed&&(h.id=++lo,h.atomic=!0),g){if(f&&(g.curOp.updateMaxLine=!0),h.collapsed)b(g,n.line,i.line+1);else if(h.className||h.title||h.startStyle||h.endStyle||h.css)for(var y=n.line;y<=i.line;y++)ji(g,y,"text");h.atomic&&Hr(g.doc),v(g,"markerAdded",g,h)}}return h}so.prototype.clear=function(){if(!this.explicitlyCleared){for(var e,t=this.doc.cm,n=t&&!t.curOp,i=(n&&Hi(t),_t(this,"clear")&&(e=this.find())&&v(this,"clear",e.from,e.to),null),r=null,o=0;o<this.lines.length;++o){var a=this.lines[o],s=Ve(a.markedSpans,this);t&&!this.collapsed?ji(t,x(a),"text"):t&&(null!=s.to&&(r=x(a)),null!=s.from)&&(i=x(a)),a.markedSpans=function(e,t){for(var n,i=0;i<e.length;++i)e[i]!=t&&(n=n||[]).push(e[i]);return n}(a.markedSpans,s),null==s.from&&this.collapsed&&!st(this.doc,a)&&t&&De(a,ni(t.display))}if(t&&this.collapsed&&!t.options.lineWrapping)for(var l=0;l<this.lines.length;++l){var c=rt(this.lines[l]),d=ct(c);d>t.display.maxLineLength&&(t.display.maxLine=c,t.display.maxLineLength=d,t.display.maxLineChanged=!0)}null!=i&&t&&this.collapsed&&b(t,i,r+1),this.lines.length=0,this.explicitlyCleared=!0,this.atomic&&this.doc.cantEdit&&(this.doc.cantEdit=!1,t)&&Hr(t.doc),t&&v(t,"markerCleared",t,this,i,r),n&&Ui(t),this.parent&&this.parent.clear()}},so.prototype.find=function(e,t){var n,i;null==e&&"bookmark"==this.type&&(e=1);for(var r=0;r<this.lines.length;++r){var o=this.lines[r],a=Ve(o.markedSpans,this);if(null!=a.from&&(n=j(t?o:x(o),a.from),-1==e))return n;if(null!=a.to&&(i=j(t?o:x(o),a.to),1==e))return i}return n&&{from:n,to:i}},so.prototype.changed=function(){var n=this,i=this.find(-1,!0),r=this,o=this.doc.cm;i&&o&&h(o,function(){var e=i.line,t=x(i.line),t=On(o,t);t&&(qn(t),o.curOp.selectionChanged=o.curOp.forceUpdate=!0),o.curOp.updateMaxLine=!0,!st(r.doc,e)&&null!=r.height&&(t=r.height,r.height=null,t=Tn(r)-t)&&De(e,e.height+t),v(o,"markerChanged",o,n)})},so.prototype.attachLine=function(e){var t;this.lines.length||!this.doc.cm||(t=this.doc.cm.curOp).maybeHiddenMarkers&&-1!=w(t.maybeHiddenMarkers,this)||(t.maybeUnhiddenMarkers||(t.maybeUnhiddenMarkers=[])).push(this),this.lines.push(e)},so.prototype.detachLine=function(e){this.lines.splice(w(this.lines,e),1),!this.lines.length&&this.doc.cm&&((e=this.doc.cm.curOp).maybeHiddenMarkers||(e.maybeHiddenMarkers=[])).push(this)},At(so);var uo=function(e,t){this.markers=e,this.primary=t;for(var n=0;n<e.length;++n)e[n].parent=this};function ho(e){return e.findMarks(j(e.first,0),e.clipPos(j(e.lastLine())),function(e){return e.parent})}function po(o){for(var e=0;e<o.length;e++)!function(e){var t=o[e],n=[t.primary.doc];yr(t.primary.doc,function(e){return n.push(e)});for(var i=0;i<t.markers.length;i++){var r=t.markers[i];-1==w(n,r.doc)&&(r.parent=null,t.markers.splice(i--,1))}}(e)}uo.prototype.clear=function(){if(!this.explicitlyCleared){this.explicitlyCleared=!0;for(var e=0;e<this.markers.length;++e)this.markers[e].clear();v(this,"clear")}},uo.prototype.find=function(e,t){return this.primary.find(e,t)},At(uo);var fo=0,g=function(e,t,n,i,r){if(!(this instanceof g))return new g(e,t,n,i,r);null==n&&(n=0),ro.call(this,[new io([new sn("",null)])]),this.first=n,this.scrollTop=this.scrollLeft=0,this.cantEdit=!1,this.cleanGeneration=1;n=j(this.frontier=n,0);this.sel=lr(n),this.history=new wr(null),this.id=++fo,this.modeOption=t,this.lineSep=i,this.direction="rtl"==r?"rtl":"ltr",this.extend=!1,"string"==typeof e&&(e=this.splitLines(e)),gr(this,{from:n,to:n,text:e}),X(this,lr(n),pe)},mo=(g.prototype=xe(ro.prototype,{constructor:g,iter:function(e,t,n){n?this.iterN(e-this.first,t-e,n):this.iterN(this.first,this.first+this.size,e)},insert:function(e,t){for(var n=0,i=0;i<t.length;++i)n+=t[i].height;this.insertInner(e-this.first,t,n)},remove:function(e,t){this.removeInner(e-this.first,t)},getValue:function(e){var t=Ne(this,this.first,this.first+this.size);return!1===e?t:t.join(e||this.lineSeparator())},setValue:i(function(e,t){var n=j(this.first,0),i=this.first+this.size-1;Jr(this,{from:n,to:j(i,U(this,i).text.length),text:this.splitLines(e),origin:t||"setValue",full:!0},!0),this.cm&&Ei(this.cm,0,0),X(this,lr(n),pe)}),replaceRange:function(e,t,n,i){Xr(this,e,t=W(this,t),n=n?W(this,n):t,i)},getRange:function(e,t,n){e=Le(this,W(this,e),W(this,t));return!1===n?e:e.join(n||this.lineSeparator())},getLine:function(e){e=this.getLineHandle(e);return e&&e.text},getLineHandle:function(e){if(Be(this,e))return U(this,e)},getLineNumber:x,getLineHandleVisualStart:function(e){return rt(e="number"==typeof e?U(this,e):e)},lineCount:function(){return this.size},firstLine:function(){return this.first},lastLine:function(){return this.first+this.size-1},clipPos:function(e){return W(this,e)},getCursor:function(e){var t=this.sel.primary(),e=null==e||"head"==e?t.head:"anchor"==e?t.anchor:"end"==e||"to"==e||!1===e?t.to():t.from();return e},listSelections:function(){return this.sel.ranges},somethingSelected:function(){return this.sel.somethingSelected()},setCursor:i(function(e,t,n){Rr(this,W(this,"number"==typeof e?j(e,t||0):e),null,n)}),setSelection:i(function(e,t,n){Rr(this,W(this,e),W(this,t||e),n)}),extendSelection:i(function(e,t,n){Dr(this,W(this,e),t&&W(this,t),n)}),extendSelections:i(function(e,t){Pr(this,je(this,e),t)}),extendSelectionsBy:i(function(e,t){Pr(this,je(this,be(this.sel.ranges,e)),t)}),setSelections:i(function(e,t,n){if(e.length){for(var i=[],r=0;r<e.length;r++)i[r]=new Q(W(this,e[r].anchor),W(this,e[r].head));X(this,sr(i,t=null==t?Math.min(e.length-1,this.sel.primIndex):t),n)}}),addSelection:i(function(e,t,n){var i=this.sel.ranges.slice(0);i.push(new Q(W(this,e),W(this,t||e))),X(this,sr(i,i.length-1),n)}),getSelection:function(e){for(var t=this.sel.ranges,n=0;n<t.length;n++)var i=Le(this,t[n].from(),t[n].to()),r=r?r.concat(i):i;return!1===e?r:r.join(e||this.lineSeparator())},getSelections:function(e){for(var t=[],n=this.sel.ranges,i=0;i<n.length;i++){var r=Le(this,n[i].from(),n[i].to());!1!==e&&(r=r.join(e||this.lineSeparator())),t[i]=r}return t},replaceSelection:function(e,t,n){for(var i=[],r=0;r<this.sel.ranges.length;r++)i[r]=e;this.replaceSelections(i,t,n||"+input")},replaceSelections:i(function(e,t,n){for(var i=[],r=this.sel,o=0;o<r.ranges.length;o++){var a=r.ranges[o];i[o]={from:a.from(),to:a.to(),text:this.splitLines(e[o]),origin:n}}for(var t=t&&"end"!=t&&function(e,t,n){for(var i=[],r=c=j(e.first,0),o=0;o<t.length;o++){var a=t[o],s=hr(a.from,c,r),l=hr(cr(a),c,r),c=a.to,r=l;"around"==n?(a=q((a=e.sel.ranges[o]).head,a.anchor)<0,i[o]=new Q(a?l:s,a?s:l)):i[o]=new Q(s,s)}return new G(i,e.sel.primIndex)}(this,i,t),s=i.length-1;0<=s;s--)Jr(this,i[s]);t?Or(this,t):this.cm&&ki(this.cm)}),makeChange:i(function(e){Jr(this,e)}),undo:i(function(){Yr(this,"undo")}),redo:i(function(){Yr(this,"redo")}),undoSelection:i(function(){Yr(this,"undo",!0)}),redoSelection:i(function(){Yr(this,"redo",!0)}),setExtending:function(e){this.extend=e},getExtending:function(){return this.extend},historySize:function(){for(var e=this.history,t=0,n=0,i=0;i<e.done.length;i++)e.done[i].ranges||++t;for(var r=0;r<e.undone.length;r++)e.undone[r].ranges||++n;return{undo:t,redo:n}},clearHistory:function(){this.history=new wr(this.history.maxGeneration)},markClean:function(){this.cleanGeneration=this.changeGeneration(!0)},changeGeneration:function(e){return e&&(this.history.lastOp=this.history.lastSelOp=this.history.lastOrigin=null),this.history.generation},isClean:function(e){return this.history.generation==(e||this.cleanGeneration)},getHistory:function(){return{done:Lr(this.history.done),undone:Lr(this.history.undone)}},setHistory:function(e){var t=this.history=new wr(this.history.maxGeneration);t.done=Lr(e.done.slice(0),null,!0),t.undone=Lr(e.undone.slice(0),null,!0)},setGutterMarker:i(function(e,n,i){return no(this,e,"gutter",function(e){var t=e.gutterMarkers||(e.gutterMarkers={});return!(t[n]=i)&&ke(t)&&(e.gutterMarkers=null),1})}),clearGutter:i(function(t){var n=this;this.iter(function(e){e.gutterMarkers&&e.gutterMarkers[t]&&no(n,e,"gutter",function(){return e.gutterMarkers[t]=null,ke(e.gutterMarkers)&&(e.gutterMarkers=null),1})})}),lineInfo:function(e){var t;if("number"==typeof e){if(!Be(this,e))return null;if(!(e=U(this,t=e)))return null}else if(null==(t=x(e)))return null;return{line:t,handle:e,text:e.text,gutterMarkers:e.gutterMarkers,textClass:e.textClass,bgClass:e.bgClass,wrapClass:e.wrapClass,widgets:e.widgets}},addLineClass:i(function(e,n,i){return no(this,e,"gutter"==n?"gutter":"class",function(e){var t="text"==n?"textClass":"background"==n?"bgClass":"gutter"==n?"gutterClass":"wrapClass";if(e[t]){if(N(i).test(e[t]))return;e[t]+=" "+i}else e[t]=i;return 1})}),removeLineClass:i(function(e,o,a){return no(this,e,"gutter"==o?"gutter":"class",function(e){var t="text"==o?"textClass":"background"==o?"bgClass":"gutter"==o?"gutterClass":"wrapClass",n=e[t];if(n){if(null==a)e[t]=null;else{var i=n.match(N(a));if(!i)return;var r=i.index+i[0].length;e[t]=n.slice(0,i.index)+(i.index&&r!=n.length?" ":"")+n.slice(r)||null}return 1}})}),addLineWidget:i(function(e,t,n){return e=e,r=new oo(i=this,t,n),(o=i.cm)&&r.noHScroll&&(o.display.alignWidgets=!0),no(i,e,"widget",function(e){var t=e.widgets||(e.widgets=[]);return null==r.insertAt?t.push(r):t.splice(Math.min(t.length-1,Math.max(0,r.insertAt)),0,r),r.line=e,o&&!st(i,e)&&(t=lt(e)<i.scrollTop,De(e,e.height+Tn(r)),t&&Si(o,r.height),o.curOp.forceUpdate=!0),1}),v(o,"lineWidgetAdded",o,r,"number"==typeof e?e:x(e)),r;var i,r,o}),removeLineWidget:function(e){e.clear()},markText:function(e,t,n){return co(this,W(this,e),W(this,t),n,n&&n.type||"range")},setBookmark:function(e,t){t={replacedWith:t&&(null==t.nodeType?t.widget:t),insertLeft:t&&t.insertLeft,clearWhenEmpty:!1,shared:t&&t.shared,handleMouseEvents:t&&t.handleMouseEvents};return co(this,e=W(this,e),e,t,"bookmark")},findMarksAt:function(e){var t=[],n=U(this,(e=W(this,e)).line).markedSpans;if(n)for(var i=0;i<n.length;++i){var r=n[i];(null==r.from||r.from<=e.ch)&&(null==r.to||r.to>=e.ch)&&t.push(r.marker.parent||r.marker)}return t},findMarks:function(r,o,a){r=W(this,r),o=W(this,o);var s=[],l=r.line;return this.iter(r.line,o.line+1,function(e){var t=e.markedSpans;if(t)for(var n=0;n<t.length;n++){var i=t[n];null!=i.to&&l==r.line&&r.ch>=i.to||null==i.from&&l!=r.line||null!=i.from&&l==o.line&&i.from>=o.ch||a&&!a(i.marker)||s.push(i.marker.parent||i.marker)}++l}),s},getAllMarks:function(){var i=[];return this.iter(function(e){var t=e.markedSpans;if(t)for(var n=0;n<t.length;++n)null!=t[n].from&&i.push(t[n].marker)}),i},posFromIndex:function(t){var n,i=this.first,r=this.lineSeparator().length;return this.iter(function(e){e=e.text.length+r;if(t<e)return n=t,!0;t-=e,++i}),W(this,j(i,n))},indexFromPos:function(e){var t,n=(e=W(this,e)).ch;return e.line<this.first||e.ch<0?0:(t=this.lineSeparator().length,this.iter(this.first,e.line,function(e){n+=e.text.length+t}),n)},copy:function(e){var t=new g(Ne(this,this.first,this.first+this.size),this.modeOption,this.first,this.lineSep,this.direction);return t.scrollTop=this.scrollTop,t.scrollLeft=this.scrollLeft,t.sel=this.sel,t.extend=!1,e&&(t.history.undoDepth=this.history.undoDepth,t.setHistory(this.getHistory())),t},linkedDoc:function(e){for(var t=this.first,n=this.first+this.size,n=(null!=(e=e||{}).from&&e.from>t&&(t=e.from),null!=e.to&&e.to<n&&(n=e.to),new g(Ne(this,t,n),e.mode||this.modeOption,t,this.lineSep,this.direction)),i=(e.sharedHist&&(n.history=this.history),(this.linked||(this.linked=[])).push({doc:n,sharedHist:e.sharedHist}),n.linked=[{doc:this,isParent:!0,sharedHist:e.sharedHist}],n),r=ho(this),o=0;o<r.length;o++){var a=r[o],s=a.find(),l=i.clipPos(s.from),s=i.clipPos(s.to);q(l,s)&&(l=co(i,l,s,a.primary,a.primary.type),a.markers.push(l),l.parent=a)}return n},unlinkDoc:function(e){var t;if(e instanceof C&&(e=e.doc),this.linked)for(var n=0;n<this.linked.length;++n){var i=this.linked[n];if(i.doc==e){this.linked.splice(n,1),e.unlinkDoc(this),po(ho(this));break}}e.history==this.history&&(t=[e.id],yr(e,function(e){return t.push(e.id)},!0),e.history=new wr(null),e.history.done=Lr(this.history.done,t),e.history.undone=Lr(this.history.undone,t))},iterLinkedDocs:function(e){yr(this,e)},getMode:function(){return this.mode},getEditor:function(){return this.cm},splitLines:function(e){return this.lineSep?e.split(this.lineSep):It(e)},lineSeparator:function(){return File.useCRLF?"\r\n":"\n"},setDirection:i(function(e){var t;(e="rtl"!=e?"ltr":e)!=this.direction&&(this.direction=e,this.iter(function(e){return e.order=null}),this.cm)&&h(t=this.cm,function(){br(t),b(t)})})}),g.prototype.eachLine=g.prototype.iter,0);function go(e){var i=this;if(yo(i),!J(i,e)&&!_n(i.display,e)){K(e),R&&(mo=+new Date);var r=li(i,e,!0),t=e.dataTransfer.files;if(r&&!i.isReadOnly())if(t&&t.length&&window.FileReader&&window.File)for(var o=t.length,a=Array(o),s=0,n=0;n<o;++n)!function(e,t){var n;i.options.allowDropFileTypes&&-1==w(i.options.allowDropFileTypes,e.type)||((n=new FileReader).onload=Y(i,function(){var e=n.result;/[\x00-\x08\x0e-\x1f]{2}/.test(e)&&(e=""),a[t]=e,++s==o&&(e={from:r=W(i.doc,r),to:r,text:i.doc.splitLines(a.join(i.doc.lineSeparator())),origin:"paste"},Jr(i.doc,e),Or(i.doc,lr(r,cr(e))))}),n.readAsText(e))}(t[n],n);else if(i.state.draggingText&&-1<i.doc.sel.contains(r))i.state.draggingText(e),setTimeout(function(){return i.display.input.focus()},20);else try{var l,c=e.dataTransfer.getData("Text");if(c){if(i.state.draggingText&&!i.state.draggingText.copy&&(l=i.listSelections()),Ir(i.doc,lr(r,r)),l)for(var d=0;d<l.length;++d)Xr(i.doc,"",l[d].anchor,l[d].head,"drag");i.replaceSelection(c,"around","paste"),i.display.input.focus()}}catch(e){}}}function yo(e){e.display.dragCursor&&(e.display.lineSpace.removeChild(e.display.dragCursor),e.display.dragCursor=null)}function vo(e){if(document.body.getElementsByClassName)for(var t=document.body.getElementsByClassName("CodeMirror"),n=0;n<t.length;n++){var i=t[n].CodeMirror;i&&e(i)}}var bo=!1;function wo(){var e;bo||(z(window,"resize",function(){null==e&&(e=setTimeout(function(){e=null,vo(xo)},500))}),z(window,"blur",function(){return vo(yi)}),bo=!0)}function xo(e){var t=e.display;t.lastWrapHeight==t.wrapper.clientHeight&&t.lastWrapWidth==t.wrapper.clientWidth||(t.cachedCharWidth=t.cachedTextHeight=t.cachedPaddingH=null,t.scrollbarsClipped=!1,e.setSize())}for(var Co={3:"Enter",8:"Backspace",9:"Tab",13:"Enter",16:"Shift",17:"Ctrl",18:"Alt",19:"Pause",20:"CapsLock",27:"Esc",32:"Space",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"Left",38:"Up",39:"Right",40:"Down",44:"PrintScrn",45:"Insert",46:"Delete",59:";",61:"=",91:"Mod",92:"Mod",93:"Mod",106:"*",107:"=",109:"-",110:".",111:"/",127:"Delete",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'",63232:"Up",63233:"Down",63234:"Left",63235:"Right",63272:"Delete",63273:"Home",63275:"End",63276:"PageUp",63277:"PageDown",63302:"Insert"},Fo=0;Fo<10;Fo++)Co[Fo+48]=Co[Fo+96]=String(Fo);for(var So=65;So<=90;So++)Co[So]=String.fromCharCode(So);for(var ko=1;ko<=12;ko++)Co[ko+111]=Co[ko+63235]="F"+ko;var Eo={};function To(e){var t,n,i,r,o=e.split(/-(?!$)/);e=o[o.length-1];for(var a=0;a<o.length-1;a++){var s=o[a];if(/^(cmd|meta|m)$/i.test(s))r=!0;else if(/^a(lt)?$/i.test(s))t=!0;else if(/^(c|ctrl|control)$/i.test(s))n=!0;else{if(!/^s(hift)?$/i.test(s))throw new Error("Unrecognized modifier name: "+s);i=!0}}return t&&(e="Alt-"+e),n&&(e="Ctrl-"+e),r&&(e="Cmd-"+e),e=i?"Shift-"+e:e}function _o(e){var t,n,i={};for(t in e)if(e.hasOwnProperty(t)){var r=e[t];if(!/^(name|fallthrough|(de|at)tach)$/.test(t)){if("..."!=r)for(var o=be(t.split(" "),To),a=0;a<o.length;a++){var s=void 0,l=void 0,s=a==o.length-1?(l=o.join(" "),r):(l=o.slice(0,a+1).join(" "),"..."),c=i[l];if(c){if(c!=s)throw new Error("Inconsistent bindings for "+l)}else i[l]=s}delete e[t]}}for(n in i)e[n]=i[n];return e}function Ao(e,t,n,i){var r=(t=No(t)).call?t.call(e,i):t[e];if(!1===r)return"nothing";if("..."===r)return"multi";if(null!=r&&n(r))return"handled";if(t.fallthrough){if("[object Array]"!=Object.prototype.toString.call(t.fallthrough))return Ao(e,t.fallthrough,n,i);for(var o=0;o<t.fallthrough.length;o++){var a=Ao(e,t.fallthrough[o],n,i);if(a)return a}}}function Mo(e){e="string"==typeof e?e:Co[e.keyCode];return"Ctrl"==e||"Alt"==e||"Shift"==e||"Mod"==e}function Lo(e,t){var n,i;return!(S&&34==e.keyCode&&e.char||null==(i=n=Co[e.keyCode])||e.altGraphKey)&&(e.altKey&&"Alt"!=n&&(i="Alt-"+i),(L?e.metaKey:e.ctrlKey)&&"Ctrl"!=n&&(i="Ctrl-"+i),(L?e.ctrlKey:e.metaKey)&&"Cmd"!=n&&(i="Cmd-"+i),!t&&e.shiftKey&&"Shift"!=n?"Shift-"+i:i)}function No(e){return"string"==typeof e?Eo[e]:e}function Do(t,e){for(var n=t.doc.sel.ranges,i=[],r=0;r<n.length;r++){for(var o=e(n[r]);i.length&&q(o.from,H(i).to)<=0;){var a=i.pop();if(q(a.from,o.from)<0){o.from=a.from;break}}i.push(o)}h(t,function(){for(var e=i.length-1;0<=e;e--)Xr(t.doc,"",i[e].from,i[e].to,"+delete");ki(t)})}Eo.basic={Left:"goCharLeft",Right:"goCharRight",Up:"goLineUp",Down:"goLineDown",End:"goLineEnd",Home:"goLineStartSmart",PageUp:"goPageUp",PageDown:"goPageDown",Delete:"delCharAfter",Backspace:"delCharBefore","Shift-Backspace":"delCharBefore",Tab:"defaultTab","Shift-Tab":"indentAuto",Enter:"newlineAndIndent",Insert:"toggleOverwrite",Esc:"singleSelection"},Eo.pcDefault={"Ctrl-A":"selectAll","Ctrl-Up":"goDocStart","Ctrl-Down":"goDocEnd","Ctrl-Left":"goGroupLeft","Ctrl-Right":"goGroupRight","Alt-Left":"goLineStart","Alt-Right":"goLineEnd","Ctrl-Backspace":"delGroupBefore","Ctrl-Delete":"delGroupAfter","Ctrl-[":"indentLess","Ctrl-]":"indentMore","Ctrl-U":"undoSelection","Shift-Ctrl-U":"redoSelection","Alt-U":"redoSelection",fallthrough:"basic"},Eo.emacsy={"Ctrl-F":"goCharRight","Ctrl-B":"goCharLeft","Ctrl-P":"goLineUp","Ctrl-N":"goLineDown","Alt-F":"goWordRight","Alt-B":"goWordLeft","Ctrl-A":"goLineStart","Ctrl-E":"goLineEnd","Ctrl-V":"goPageDown","Shift-Ctrl-V":"goPageUp","Ctrl-D":"delCharAfter","Ctrl-H":"delCharBefore","Alt-D":"delWordAfter","Alt-Backspace":"delWordBefore","Ctrl-K":"killLine","Ctrl-T":"transposeChars","Ctrl-O":"openLine"},Eo.macDefault={"Cmd-A":"selectAll","Cmd-Up":"goDocStart","Cmd-Down":"goDocEnd","Alt-Left":"goGroupLeft","Alt-Right":"goGroupRight","Cmd-Left":"goLineLeft","Cmd-Right":"goLineRight","Alt-Backspace":"delGroupBefore","Ctrl-Alt-Backspace":"delGroupAfter","Alt-Delete":"delGroupAfter","Cmd-[":"indentLess","Cmd-]":"indentMore","Cmd-Backspace":"delWrappedLineLeft","Cmd-Delete":"delWrappedLineRight","Cmd-U":"undoSelection","Shift-Cmd-U":"redoSelection","Ctrl-Up":"goDocStart","Ctrl-Down":"goDocEnd",fallthrough:["basic","emacsy"]},Eo.default=Z?Eo.macDefault:Eo.pcDefault;var Po={selectAll:zr,singleSelection:function(e){return e.setSelection(e.getCursor("anchor"),e.getCursor("head"),pe)},killLine:function(n){return Do(n,function(e){var t;return e.empty()?(t=U(n.doc,e.head.line).text.length,e.head.ch==t&&e.head.line<n.lastLine()?{from:e.head,to:j(e.head.line+1,0)}:{from:e.head,to:j(e.head.line,t)}):{from:e.from(),to:e.to()}})},deleteLine:function(t){return Do(t,function(e){return{from:j(e.from().line,0),to:W(t.doc,j(e.to().line+1,0))}})},delLineLeft:function(e){return Do(e,function(e){return{from:j(e.from().line,0),to:e.from()}})},delWrappedLineLeft:function(n){return Do(n,function(e){var t=n.charCoords(e.from(),"div").top+5;return{from:n.coordsChar({left:0,top:t},"div"),to:e.to()}})},delWrappedLineRight:function(n){return Do(n,function(e){var t=n.charCoords(e.to(),"div").top+5,t=n.coordsChar({left:n.display.lineDiv.offsetWidth+100,top:t},"div");return{from:e.from(),to:t}})},undo:function(e){return e.undo()},redo:function(e){return e.redo()},undoSelection:function(e){return e.undoSelection()},redoSelection:function(e){return e.redoSelection()},goDocStart:function(e){return e.extendSelection(j(e.firstLine(),0))},goDocEnd:function(e){return e.extendSelection(j(e.lastLine()))},goLineStart:function(t){return t.extendSelectionsBy(function(e){return Bo(t,e.head.line)},{origin:"+move",bias:1})},goLineStartSmart:function(t){return t.extendSelectionsBy(function(e){return Ro(t,e.head)},{origin:"+move",bias:1})},goLineEnd:function(r){return r.extendSelectionsBy(function(e){var t=r,e=e.head.line,n=U(t.doc,e),i=function(e){for(var t;t=nt(e);)e=t.find(1,!0).line;return e}(n);return i!=n&&(e=x(i)),Ft(!0,t,n,e,-1)},{origin:"+move",bias:-1})},goLineRight:function(t){return t.extendSelectionsBy(function(e){e=t.charCoords(e.head,"div").top+5;return t.coordsChar({left:t.display.lineDiv.offsetWidth+100,top:e},"div")},me)},goLineLeft:function(t){return t.extendSelectionsBy(function(e){e=t.charCoords(e.head,"div").top+5;return t.coordsChar({left:0,top:e},"div")},me)},goLineLeftSmart:function(n){return n.extendSelectionsBy(function(e){var t=n.charCoords(e.head,"div").top+5,t=n.coordsChar({left:0,top:t},"div");return t.ch<n.getLine(t.line).search(/\S/)?Ro(n,e.head):t},me)},goLineUp:function(e){return e.moveV(-1,"line")},goLineDown:function(e){return e.moveV(1,"line")},goPageUp:function(e){return e.moveV(-1,"page")},goPageDown:function(e){return e.moveV(1,"page")},goCharLeft:function(e){return e.moveH(-1,"char")},goCharRight:function(e){return e.moveH(1,"char")},goColumnLeft:function(e){return e.moveH(-1,"column")},goColumnRight:function(e){return e.moveH(1,"column")},goWordLeft:function(e){return e.moveH(-1,"word")},goGroupRight:function(e){return e.moveH(1,"group")},goGroupLeft:function(e){return e.moveH(-1,"group")},goWordRight:function(e){return e.moveH(1,"word")},delCharBefore:function(e){return e.deleteH(-1,"char")},delCharAfter:function(e){return e.deleteH(1,"char")},delWordBefore:function(e){return e.deleteH(-1,"word")},delWordAfter:function(e){return e.deleteH(1,"word")},delGroupBefore:function(e){return e.deleteH(-1,"group")},delGroupAfter:function(e){return e.deleteH(1,"group")},indentAuto:function(e){return e.indentSelection("smart")},indentMore:function(e){return e.indentSelection("add")},indentLess:function(e){return e.indentSelection("subtract")},insertTab:function(e){return e.replaceSelection("\t")},insertSoftTab:function(e){for(var t=[],n=e.listSelections(),i=e.options.tabSize,r=0;r<n.length;r++){var o=n[r].from(),o=$(e.getLine(o.line),o.ch,i);t.push(ve(i-o%i))}e.replaceSelections(t)},defaultTab:function(e){e.somethingSelected()?e.indentSelection("add"):e.execCommand("insertTab")},transposeChars:function(a){return h(a,function(){for(var e,t,n,i=a.listSelections(),r=[],o=0;o<i.length;o++)i[o].empty()&&(e=i[o].head,(t=U(a.doc,e.line).text)&&(0<(e=e.ch==t.length?new j(e.line,e.ch-1):e).ch?(e=new j(e.line,e.ch+1),a.replaceRange(t.charAt(e.ch-1)+t.charAt(e.ch-2),j(e.line,e.ch-2),e,"+transpose")):e.line>a.doc.first&&(n=U(a.doc,e.line-1).text)&&(e=new j(e.line,1),a.replaceRange(t.charAt(0)+a.doc.lineSeparator()+n.charAt(n.length-1),j(e.line-1,n.length-1),e,"+transpose"))),r.push(new Q(e,e)));a.setSelections(r)})},newlineAndIndent:function(i){return h(i,function(){for(var e=(t=i.listSelections()).length-1;0<=e;e--)i.replaceRange(i.doc.lineSeparator(),t[e].anchor,t[e].head,"+input");for(var t=i.listSelections(),n=0;n<t.length;n++)i.indentLine(t[n].from().line,null,!0);ki(i)})},openLine:function(e){return e.replaceSelection("\n","start")},toggleOverwrite:function(e){return e.toggleOverwrite()}};function Bo(e,t){var n=U(e.doc,t),i=rt(n);return Ft(!0,e,i,t=i!=n?x(i):t,1)}function Ro(e,t){var n=Bo(e,t.line),i=U(e.doc,n.line),e=wt(i,e.doc.direction);return e&&0!=e[0].level?n:(e=Math.max(0,i.text.search(/\S/)),i=t.line==n.line&&t.ch<=e&&t.ch,j(n.line,i?0:e,n.sticky))}function Oo(e,t,n){if("string"==typeof t&&!(t=Po[t]))return!1;e.display.input.ensurePolled();var i=e.display.shift,r=!1;try{e.isReadOnly()&&(e.state.suppressEdits=!0),n&&(e.display.shift=!1),r=t(e)!=he}finally{e.display.shift=i,e.state.suppressEdits=!1}return r}var Io=new de;function $o(e,t,n,i){var r=e.state.keySeq;if(r){if(Mo(t))return"handled";Io.set(50,function(){e.state.keySeq==r&&(e.state.keySeq=null,e.display.input.reset())}),t=r+" "+t}i=function(e,t,n){for(var i=0;i<e.state.keyMaps.length;i++){var r=Ao(t,e.state.keyMaps[i],n,e);if(r)return r}return e.options.extraKeys&&Ao(t,e.options.extraKeys,n,e)||Ao(t,e.options.keyMap,n,e)}(e,t,i);return"multi"==i&&(e.state.keySeq=t),"handled"==i&&v(e,"keyHandled",e,t,n),"handled"!=i&&"multi"!=i||(K(n),pi(e)),r&&!i&&/\'$/.test(t)?(K(n),!0):!!i}function Ho(t,e){var n=Lo(e,!0);return!!n&&(e.shiftKey&&!t.state.keySeq?$o(t,"Shift-"+n,e,function(e){return Oo(t,e,!0)})||$o(t,n,e,function(e){if("string"==typeof e?/^go[A-Z]/.test(e):e.motion)return Oo(t,e)}):$o(t,n,e,function(e){return Oo(t,e)}))}var Uo,jo,qo=null;function Wo(e){var t,n,i;function r(e){18!=e.keyCode&&e.altKey||(D(i,"CodeMirror-crosshair"),V(document,"keyup",r),V(document,"mouseover",r))}this.curOp.focus=ie(),37==e.keyCode&&e.shiftKey,J(this,e)||(R&&O<11&&27==e.keyCode&&(e.returnValue=!1),t=e.keyCode,this.display.shift=16==t||e.shiftKey,n=Ho(this,e),S&&(qo=n?t:null,!n)&&88==t&&!Ht&&(Z?e.metaKey:e.ctrlKey)&&this.replaceSelection("",null,"cut"),18!=t)||/\bCodeMirror-crosshair\b/.test(this.display.lineDiv.className)||(re(i=this.display.lineDiv,"CodeMirror-crosshair"),z(document,"keyup",r),z(document,"mouseover",r))}function zo(e){16==e.keyCode&&(this.doc.sel.shift=!1),J(this,e)}function Vo(e){var t,n,i;_n(this.display,e)||J(this,e)||e.ctrlKey&&!e.altKey||Z&&e.metaKey||(n=e.keyCode,t=e.charCode,S&&n==qo?(qo=null,K(e)):S&&(!e.which||e.which<10)&&Ho(this,e)||"\b"==(n=String.fromCharCode(null==t?n:t))||$o(i=this,"'"+n+"'",e,function(e){return Oo(i,e,!0)})||this.display.input.onKeyPress(e))}function Jo(e){var t=this,n=t.display;if(!(J(t,e)||n.activeTouch&&n.input.supportsTouch()))if(n.input.ensurePolled(),n.shift=e.shiftKey,_n(n,e,0==t.options.lineWrapping))I||(n.scroller.draggable=!1,setTimeout(function(){return n.scroller.draggable=!0},100));else if(!Yo(t,e)){var i,r,o,a,s=li(t,e);switch(window.focus(),Pt(e)){case 1:if(t.state.selectingText)t.state.selectingText(e);else if(s)if(_=t,i=e,r=s,R?setTimeout(le(fi,_),0):_.curOp.focus=ie(),v=+new Date,jo&&jo.time>v-400&&0==q(jo.pos,r)?o="triple":Uo&&Uo.time>v-400&&0==q(Uo.pos,r)?(o="double",jo={time:v,pos:r}):(o="single",Uo={time:v,pos:r}),v=_.doc.sel,a=Z?i.metaKey:i.ctrlKey,_.options.dragDrop&&Ot&&!_.isReadOnly()&&"single"==o&&-1<(x=v.contains(r))&&(q((x=v.ranges[x]).from(),r)<0||0<r.xRel)&&(0<q(x.to(),r)||r.xRel<0)){var l=_,c=i,d=r,u=a,h=l.display,p=!1,f=Y(l,function(e){I&&(h.scroller.draggable=!1),l.state.draggingText=!1,V(document,"mouseup",f),V(document,"mousemove",m),V(h.scroller,"dragstart",g),V(h.scroller,"drop",f),p||(K(e),u||Dr(l.doc,d),I||R&&9==O?setTimeout(function(){document.body.focus(),h.input.focus()},20):h.input.focus())}),m=function(e){p=p||10<=Math.abs(c.clientX-e.clientX)+Math.abs(c.clientY-e.clientY)},g=function(){return p=!0};I&&(h.scroller.draggable=!0),(l.state.draggingText=f).copy=Z?c.altKey:c.ctrlKey,h.scroller.dragDrop&&h.scroller.dragDrop(),z(document,"mouseup",f),z(document,"mousemove",m),z(h.scroller,"dragstart",g),z(h.scroller,"drop",f),mi(l),setTimeout(function(){return h.input.focus()},20)}else{var y=_,v=i,b=r,w=o,x=a,C=y.display,F=y.doc;K(v);var S,k,E,T=F.sel,_=T.ranges,A=(x&&!v.shiftKey?(k=F.sel.contains(b),S=-1<k?_[k]:new Q(b,b)):(S=F.sel.primary(),k=F.sel.primIndex),(ee?v.shiftKey&&v.metaKey:v.altKey)?(w="rect",x||(S=new Q(b,b)),b=li(y,v,!0,!0),k=-1):S="double"==w?(E=y.findWordAt(b),y.display.shift||F.extend?Nr(F,S,E.anchor,E.head):E):"triple"==w?(E=new Q(j(b.line,0),W(F,j(b.line+1,0))),y.display.shift||F.extend?Nr(F,S,E.anchor,E.head):E):Nr(F,S,b),x?-1==k?(k=_.length,X(F,sr(_.concat([S]),k),{scroll:!1,origin:"*mouse"})):1<_.length&&_[k].empty()&&"single"==w&&!v.shiftKey?(X(F,sr(_.slice(0,k).concat(_.slice(k+1)),0),{scroll:!1,origin:"*mouse"}),T=F.sel):Br(F,k,S,fe):(X(F,new G([S],k=0),fe),T=F.sel),b),M=C.wrapper.getBoundingClientRect(),L=0;function N(e){var t=++L,n=li(y,e,!0,"rect"==w);if(n)if(0!=q(n,A)){y.curOp.focus=ie();var i=n;if(0!=q(A,i))if(A=i,"rect"==w){for(var r=[],o=y.options.tabSize,a=$(U(F,b.line).text,b.ch,o),s=$(U(F,i.line).text,i.ch,o),l=Math.min(a,s),c=Math.max(a,s),d=Math.min(b.line,i.line),u=Math.min(y.lastLine(),Math.max(b.line,i.line));d<=u;d++){var h=U(F,d).text,p=ge(h,l,o);l==c?r.push(new Q(j(d,p),j(d,p))):h.length>p&&r.push(new Q(j(d,p),j(d,ge(h,c,o))))}r.length||r.push(new Q(b,b)),X(F,sr(T.ranges.slice(0,k).concat(r),k),{origin:"*mouse",scroll:!1}),y.scrollIntoView(i)}else{var a=S,s=a.anchor,f=i,a=("single"!=w&&(s=0<q((i="double"==w?y.findWordAt(i):new Q(j(i.line,0),W(F,j(i.line+1,0)))).anchor,s)?(f=i.head,He(a.from(),i.anchor)):(f=i.anchor,$e(a.to(),i.head))),T.ranges.slice(0));a[k]=new Q(W(F,s),f),X(F,sr(a,k),fe)}i=wi(C,F);(n.line>=i.to||n.line<i.from)&&setTimeout(Y(y,function(){L==t&&N(e)}),150)}else{var m=e.clientY<M.top?-20:e.clientY>M.bottom?20:0;m&&setTimeout(Y(y,function(){L==t&&(C.scroller.scrollTop+=m,N(e))}),50)}}function D(e){y.state.selectingText=!1,L=1/0,K(e),C.input.focus(),V(document,"mousemove",P),V(document,"mouseup",B),F.history||(F.history=new wr(null)),F.history.lastSelOrigin=null}var P=Y(y,function(e){(Pt(e)?N:D)(e)}),B=Y(y,D);y.state.selectingText=B,z(document,"mousemove",P),z(document,"mouseup",B)}else Dt(e)==n.scroller&&K(e);break;case 2:I&&(t.state.lastMiddleDown=+new Date),s&&Dr(t.doc,s),setTimeout(function(){return n.input.focus()},20),K(e);break;case 3:te?Go(t,e):mi(t)}}}function Ko(e,t,n,i){var r,o;try{r=t.clientX,o=t.clientY}catch(t){return!1}if(r>=Math.floor(e.display.gutters.getBoundingClientRect().right))return!1;i&&K(t);var a=e.display,i=a.lineDiv.getBoundingClientRect();if(o>i.bottom||!_t(e,n))return Lt(t);o-=i.top-a.viewOffset;for(var s=0;s<e.options.gutters.length;++s){var l=a.gutters.childNodes[s];if(l&&l.getBoundingClientRect().right>=r)return _(e,n,e,Pe(e.doc,o),e.options.gutters[s],t),Lt(t)}}function Yo(e,t){return Ko(e,t,"gutterClick",!0)}function Go(e,t){var n,i;_n(e.display,t)||(i=t,_t(n=e,"gutterContextMenu")&&Ko(n,i,"gutterContextMenu",!1))||(J(e,t,"contextmenu")||e.display.input.onContextMenu(t))}function Qo(e){e.display.wrapper.className=e.display.wrapper.className.replace(/\s*cm-s-\S+/g,"")+e.options.theme.replace(/(^|\s)\s*/g," cm-s-"),zn(e)}var Xo={toString:function(){return"CodeMirror.Init"}},Zo={},ea={};function ta(e){er(e),b(e),xi(e)}function na(e,t,n){!t!=!(n&&n!=Xo)&&(n=e.display.dragFunctions,(t=t?z:V)(e.display.scroller,"dragstart",n.start),t(e.display.scroller,"dragenter",n.enter),t(e.display.scroller,"dragover",n.over),t(e.display.scroller,"dragleave",n.leave),t(e.display.scroller,"drop",n.drop))}function ia(e){e.options.lineWrapping?(re(e.display.wrapper,"CodeMirror-wrap"),e.display.sizer.style.minWidth="",e.display.sizerWidth=null):(D(e.display.wrapper,"CodeMirror-wrap"),dt(e)),si(e),b(e),zn(e),setTimeout(function(){return Bi(e)},100)}function C(e,t,n,i){var r=this;if(!(this instanceof C))return new C(e,t,n,i);this.options=t=t?ce(t):{},ce(Zo,t,!1),tr(t);var o,a=t.value,s=("string"==typeof a&&(a=new g(a,t.mode,null,t.lineSeparator,t.direction)),this.doc=a,new C.inputStyles[t.inputStyle](this)),e=this.display=new Me(e,a,s),l=(er(e.wrapper.CodeMirror=this),Qo(this),t.lineWrapping&&(this.display.wrapper.className+=" CodeMirror-wrap"),Ii(this),this.state={keyMaps:[],overlays:[],modeGen:0,overwrite:!1,delayingBlurEvent:!1,focused:!1,suppressEdits:!1,pasteIncoming:!1,cutIncoming:!1,selectingText:!1,draggingText:!1,highlight:new de,keySeq:null,specialChars:null},t.autofocus&&!M&&e.input.focus(),R&&O<11&&setTimeout(function(){return r.display.input.reset(!0)},20),this),c=l.display;z(c.scroller,"mousedown",Y(l,Jo)),z(c.scroller,"dblclick",R&&O<11?Y(l,function(e){var t;J(l,e)||!(t=li(l,e))||Yo(l,e)||_n(l.display,e)||(K(e),e=l.findWordAt(t),Dr(l.doc,e.anchor,e.head))}):function(e){return J(l,e)||K(e)}),te||z(c.scroller,"contextmenu",function(e){return Go(l,e)});var d,u={end:0};function h(){c.activeTouch&&(d=setTimeout(function(){return c.activeTouch=null},1e3),(u=c.activeTouch).end=+new Date)}function p(e,t){var n;return null==t.left||400<(n=t.left-e.left)*n+(n=t.top-e.top)*n}z(c.scroller,"touchstart",function(e){var t;J(l,e)||function(e){if(1==e.touches.length)return(e=e.touches[0]).radiusX<=1&&e.radiusY<=1}(e)||(c.input.ensurePolled(),clearTimeout(d),t=+new Date,c.activeTouch={start:t,moved:!1,prev:t-u.end<=300?u:null},1==e.touches.length&&(c.activeTouch.left=e.touches[0].pageX,c.activeTouch.top=e.touches[0].pageY))}),z(c.scroller,"touchmove",function(){c.activeTouch&&(c.activeTouch.moved=!0)}),z(c.scroller,"touchend",function(e){var t,n=c.activeTouch;n&&!_n(c,e)&&null!=n.left&&!n.moved&&new Date-n.start<300&&(t=l.coordsChar(c.activeTouch,"page"),n=!n.prev||p(n,n.prev)?new Q(t,t):!n.prev.prev||p(n,n.prev.prev)?l.findWordAt(t):new Q(j(t.line,0),W(l.doc,j(t.line+1,0))),l.setSelection(n.anchor,n.head),l.focus(),K(e)),h()}),z(c.scroller,"touchcancel",h),z(c.scroller,"scroll",function(){c.scroller.clientHeight&&(Ai(l,c.scroller.scrollTop),Li(l,c.scroller.scrollLeft,!0),_(l,"scroll",l))}),z(c.scroller,"mousewheel",function(e){return ar(l,e)}),z(c.scroller,"DOMMouseScroll",function(e){return ar(l,e)}),z(c.wrapper,"scroll",function(){return c.wrapper.scrollTop=c.wrapper.scrollLeft=0}),c.dragFunctions={enter:function(e){J(l,e)||Nt(e)},over:function(e){var t,n;J(l,e)||((n=li(t=l,n=e))&&(hi(t,n,n=document.createDocumentFragment()),t.display.dragCursor||(t.display.dragCursor=T("div",null,"CodeMirror-cursors CodeMirror-dragcursors"),t.display.lineSpace.insertBefore(t.display.dragCursor,t.display.cursorDiv)),y(t.display.dragCursor,n)),Nt(e))},start:function(e){var t,n;t=l,e=e,R&&(!t.state.draggingText||+new Date-mo<100)?Nt(e):J(t,e)||_n(t.display,e)||(e.dataTransfer.setData("Text",t.getSelection()),e.dataTransfer.effectAllowed="copyMove",e.dataTransfer.setDragImage&&!k&&((n=T("img",null,null,"position: fixed; left: 0; top: 0;")).src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==",S&&(n.width=n.height=1,t.display.wrapper.appendChild(n),n._top=n.offsetTop),e.dataTransfer.setDragImage(n,0,0),S)&&n.parentNode.removeChild(n))},drop:Y(l,go),leave:function(e){J(l,e)||yo(l)}};s=c.input.getField();for(o in z(s,"keyup",function(e){return zo.call(l,e)}),z(s,"keydown",Y(l,Wo)),z(s,"keypress",Y(l,Vo)),z(s,"focus",function(e){return gi(l,e)}),z(s,"blur",function(e){return yi(l,e)}),wo(),Hi(this),this.curOp.forceUpdate=!0,vr(this,a),t.autofocus&&!M||this.hasFocus()?setTimeout(le(gi,this),20):yi(this),ea)ea.hasOwnProperty(o)&&ea[o](r,t[o],Xo);Ci(this),t.finishInit&&t.finishInit(this);for(var f=0;f<ra.length;++f)ra[f](r);Ui(this),I&&t.lineWrapping&&"optimizelegibility"==getComputedStyle(e.lineDiv).textRendering&&(e.lineDiv.style.textRendering="auto"),this.editor=n,this.cid=i}C.defaults=Zo,C.optionHandlers=ea;var ra=[];function oa(e,t,n,i){var r,o,a=e.doc,s=("smart"==(n=null==n?"add":n)&&(a.mode.indent?r=Zt(e,t):n="prev"),e.options.tabSize),l=U(a,t),c=$(l.text,null,s),d=(l.stateAfter&&(l.stateAfter=null),l.text.match(/^\s*/)[0]);if(i||/\S/.test(l.text)){if("smart"==n&&((o=a.mode.indent(r,l.text.slice(d.length),l.text))==he||150<o)){if(!i)return;n="prev"}}else o=0,n="not";var u="",h=0;if("prev"==n?t>a.first?(o=$(u=U(a,t-1).text,null,s),u=d?"":u.match(/^\s*/)[0]):o=0:"add"==n?o=c+e.options.indentUnit:"subtract"==n?o=c-e.options.indentUnit:"number"==typeof n&&(o=c+n),o=Math.max(0,o),!u||d){if(u="",e.options.indentWithTabs)for(var p=Math.floor(o/s);p;--p)h+=s,u+="\t";h<o&&(u+=ve(o-h))}if(u!=d)return Xr(a,u,j(t,0),j(t,d.length),"+input"),!(l.stateAfter=null);for(var f=0;f<a.sel.ranges.length;f++){var m=a.sel.ranges[f];if(m.head.line==t&&m.head.ch<d.length){m=j(t,d.length);Br(a,f,new Q(m,m));break}}}C.defineInitHook=function(e){return ra.push(e)};var F=null;function aa(e){F=e}function sa(e,t,n,i,r){var o,a=e.doc,s=(e.display.shift=!1,i=i||a.sel,e.state.pasteIncoming||"paste"==r),l=It(t),c=null;if(s&&1<i.ranges.length)if(F&&F.text.join("\n")==t){if(i.ranges.length%F.text.length==0)for(var c=[],d=0;d<F.text.length;d++)c.push(a.splitLines(F.text[d]))}else l.length==i.ranges.length&&(c=be(l,function(e){return[e]}));for(var u=i.ranges.length-1;0<=u;u--){var h=i.ranges[u],p=h.from(),f=h.to(),h=(h.empty()&&(n&&0<n?p=j(p.line,p.ch-n):e.state.overwrite&&!s?f=j(f.line,Math.min(U(a,f.line).text.length,f.ch+H(l).length)):F&&F.lineWise&&F.text.join("\n")==t&&(p=f=j(p.line,0))),o=e.curOp.updateInput,{from:p,to:f,text:c?c[u%c.length]:l,origin:r||(s?"paste":e.state.cutIncoming?"cut":"+input")});Jr(e.doc,h),v(e,"inputRead",e,h)}t&&!s&&ca(e,t),ki(e),e.curOp.updateInput=o,e.curOp.typing=!0,e.state.pasteIncoming=e.state.cutIncoming=!1}function la(e,t){var n=e.clipboardData&&e.clipboardData.getData("Text");return n&&(e.preventDefault(),t.isReadOnly()||t.options.disableInput||h(t,function(){return sa(t,n,0,null,"paste")}),1)}function ca(e,t){if(e.options.electricChars&&e.options.smartIndent)for(var n=e.doc.sel,i=n.ranges.length-1;0<=i;i--){var r=n.ranges[i];if(!(100<r.head.ch||i&&n.ranges[i-1].head.line==r.head.line)){var o=e.getModeAt(r.head),a=!1;if(o.electricChars){for(var s=0;s<o.electricChars.length;s++)if(-1<t.indexOf(o.electricChars.charAt(s))){a=oa(e,r.head.line,"smart");break}}else o.electricInput&&o.electricInput.test(U(e.doc,r.head.line).text.slice(0,r.head.ch))&&(a=oa(e,r.head.line,"smart"));a&&v(e,"electricInput",e,r.head.line)}}}function da(e){for(var t=[],n=[],i=0;i<e.doc.sel.ranges.length;i++){var r=e.doc.sel.ranges[i].head.line,r={anchor:j(r,0),head:j(r+1,0)};n.push(r),t.push(e.getRange(r.anchor,r.head))}return{text:t,ranges:n}}function ua(e,t){e.setAttribute("autocorrect","off"),e.setAttribute("autocapitalize","off"),e.setAttribute("spellcheck",!!t)}function ha(){var e=T("textarea",null,null,"position: absolute; bottom: -1em; padding: 0; width: 1px; height: 1em; outline: none"),t=T("div",[e],null,"overflow: hidden; position: relative; width: 3px; height: 0px;");return I?e.style.width="1000px":e.setAttribute("wrap","off"),f&&(e.style.border="1px solid black"),ua(e),t}function pa(n,i,r,e,o){var t=i,a=r,s=U(n,i.line);function l(e){var t=o?St(n.cm,s,i,r):Ct(s,i,r);if(null==t){if(e||(e=i.line+r)<n.first||e>=n.first+n.size||(i=new j(e,i.ch,i.sticky),!(s=U(n,e))))return;i=Ft(o,n.cm,s,i.line,r)}else i=t;return 1}if("char"==e)l();else if("column"==e)l(!0);else if("word"==e||"group"==e)for(var c=null,d="group"==e,u=n.cm&&n.cm.getHelper(i,"wordChars"),h=!0;!(r<0)||l(!h);h=!1){var p=s.text.charAt(i.ch)||"\n",p=Se(p,u)?"w":d&&"\n"==p?"n":!d||/\s/.test(p)?null:"p";if(d&&!h&&(p=p||"s"),c&&c!=p){r<0&&(r=1,l(),i.sticky="after");break}if(p&&(c=p),0<r&&!l(!h))break}e=qr(n,i,t,a,!0);return Oe(t,e)&&(e.hitSide=!0),e}function fa(e,t,n,i){var r,o,a,s=e.doc,l=t.left;for("page"==i?(r=Math.min(e.display.wrapper.clientHeight,window.innerHeight||document.documentElement.clientHeight),r=Math.max(r-.5*ni(e.display),3),o=(0<n?t.bottom:t.top)+n*r):"line"==i&&(o=0<n?t.bottom+3:t.top-3);(a=ei(e,l,o)).outside;){if(n<0?o<=0:o>=s.height){a.hitSide=!0;break}o+=5*n}return a}function r(e){this.cm=e,this.lastAnchorNode=this.lastAnchorOffset=this.lastFocusNode=this.lastFocusOffset=null,this.polling=new de,this.composing=null,this.gracePeriod=!1,this.readDOMTimeout=null}function ma(e,t){var n,i,r=On(e,t.line);return!r||r.hidden?null:(n=Bn(r,r=U(e.doc,t.line),t.line),i="left",(r=wt(r,e.doc.direction))&&(i=ht(r,t.ch)%2?"right":"left"),(e=jn(n.map,t.ch,i)).offset="right"==e.collapse?e.end:e.start,e)}function ga(e,t){return t&&(e.bad=!0),e}function ya(e,t,n){var i;if(t==e.display.lineDiv){if(!(i=e.display.lineDiv.childNodes[n]))return ga(e.clipPos(j(e.display.viewTo-1)),!0);t=null,n=0}else for(i=t;;i=i.parentNode){if(!i||i==e.display.lineDiv)return null;if(i.parentNode&&i.parentNode==e.display.lineDiv)break}for(var r=0;r<e.display.view.length;r++){var o=e.display.view[r];if(o.node==i){var c=o,o=t,a=n,s=c.text.firstChild,l=!1;if(!o||!ne(s,o))return ga(j(x(c.line),0),!0);if(o==s)if(l=!0,o=s.childNodes[a],a=0,!o)return ga(j(x(d=c.rest?H(c.rest):c.line),d.text.length),l);var d=3==o.nodeType?o:null,u=o;for(d||1!=o.childNodes.length||3!=o.firstChild.nodeType||(d=o.firstChild,a=a&&d.nodeValue.length);u.parentNode!=s;)u=u.parentNode;var h=c.measure,p=h.maps;function f(e,t,n){for(var i=-1;i<(p?p.length:0);i++)for(var r=i<0?h.map:p[i],o=0;o<r.length;o+=3){var a,s,l=r[o+2];if(l==e||l==t)return a=x(i<0?c.line:c.rest[i]),s=r[o]+n,j(a,s=n<0||l!=e?r[o+(n?1:0)]:s)}}var m=f(d,u,a);if(m)return ga(m,l);for(var g=u.nextSibling,y=d?d.nodeValue.length-a:0;g;g=g.nextSibling){if(m=f(g,g.firstChild,0))return ga(j(m.line,m.ch-y),l);y+=g.textContent.length}for(var v=u.previousSibling,b=a;v;v=v.previousSibling){if(m=f(v,v.firstChild,-1))return ga(j(m.line,m.ch+b),l);b+=v.textContent.length}return}}}r.prototype.init=function(e){var t=this,o=this,a=o.cm,s=o.div=e.lineDiv;function n(e){if(!J(a,e)){if(a.somethingSelected())aa({lineWise:!1,text:a.getSelections()}),"cut"==e.type&&a.replaceSelection("",null,"cut");else{if(!a.options.lineWiseCopyCut)return;var t=da(a);aa({lineWise:!0,text:t.text}),"cut"==e.type&&a.operation(function(){a.setSelections(t.ranges,0,pe),a.replaceSelection("",null,"cut")})}if(e.clipboardData){e.clipboardData.clearData();var n=F.text.join("\n");if(e.clipboardData.setData("Text",n),e.clipboardData.getData("Text")==n)return void e.preventDefault()}var i=ha(),n=i.firstChild,r=(a.display.lineSpace.insertBefore(i,a.display.lineSpace.firstChild),n.value=F.text.join("\n"),document.activeElement);se(n),setTimeout(function(){a.display.lineSpace.removeChild(i),r.focus(),r==s&&o.showPrimarySelection()},50)}}ua(s,a.options.spellcheck),z(s,"paste",function(e){J(a,e)||la(e,a)||O<=11&&setTimeout(Y(a,function(){return t.updateFromDOM()}),20)}),z(s,"compositionstart",function(e){t.composing={data:e.data,done:!1}}),z(s,"compositionupdate",function(e){t.composing||(t.composing={data:e.data,done:!1})}),z(s,"compositionend",function(e){t.composing&&(e.data!=t.composing.data&&t.readFromDOMSoon(),t.composing.done=!0)}),z(s,"touchstart",function(){return o.forceCompositionEnd()}),z(s,"input",function(){t.composing||t.readFromDOMSoon()}),z(s,"copy",n),z(s,"cut",n)},r.prototype.prepareSelection=function(){var e=ui(this.cm,!1);return e.focus=this.cm.state.focused,e},r.prototype.showSelection=function(e,t){e&&this.cm.display.view.length&&((e.focus||t)&&this.showPrimarySelection(),this.showMultipleSelections(e))},r.prototype.showPrimarySelection=function(){var e=window.getSelection(),t=this.cm,n=t.doc.sel.primary(),i=n.from(),n=n.to();if(t.display.viewTo==t.display.viewFrom||i.line>=t.display.viewTo||n.line<t.display.viewFrom)e.removeAllRanges();else{var r=ya(t,e.anchorNode,e.anchorOffset),o=ya(t,e.focusNode,e.focusOffset);if(!r||r.bad||!o||o.bad||0!=q(He(r,o),i)||0!=q($e(r,o),n)){var r=t.display.view,o=i.line>=t.display.viewFrom&&ma(t,i)||{node:r[0].measure.map[2],offset:0},i=n.line<t.display.viewTo&&ma(t,n);if(i||(i={node:(r=(n=r[r.length-1].measure).maps?n.maps[n.maps.length-1]:n.map)[r.length-1],offset:r[r.length-2]-r[r.length-3]}),o&&i){var a,n=e.rangeCount&&e.getRangeAt(0);try{a=ae(o.node,o.offset,i.offset,i.node)}catch(e){}a&&(!p&&t.state.focused&&(e.collapse(o.node,o.offset),a.collapsed)||(e.removeAllRanges(),e.addRange(a)),n&&null==e.anchorNode?e.addRange(n):p&&this.startGracePeriod()),this.rememberSelection()}else e.removeAllRanges()}}},r.prototype.startGracePeriod=function(){var e=this;clearTimeout(this.gracePeriod),this.gracePeriod=setTimeout(function(){e.gracePeriod=!1,e.selectionChanged()&&e.cm.operation(function(){return e.cm.curOp.selectionChanged=!0})},20)},r.prototype.showMultipleSelections=function(e){y(this.cm.display.cursorDiv,e.cursors),y(this.cm.display.selectionDiv,e.selection)},r.prototype.rememberSelection=function(){var e=window.getSelection();this.lastAnchorNode=e.anchorNode,this.lastAnchorOffset=e.anchorOffset,this.lastFocusNode=e.focusNode,this.lastFocusOffset=e.focusOffset},r.prototype.selectionInEditor=function(){var e=window.getSelection();return!!e.rangeCount&&(e=e.getRangeAt(0).commonAncestorContainer,ne(this.div,e))},r.prototype.focus=function(){"nocursor"!=this.cm.options.readOnly&&(this.selectionInEditor()||this.showSelection(this.prepareSelection(),!0),this.div.focus())},r.prototype.blur=function(){this.div.blur()},r.prototype.getField=function(){return this.div},r.prototype.supportsTouch=function(){return!0},r.prototype.receivedFocus=function(){var t=this;this.selectionInEditor()?this.pollSelection():h(this.cm,function(){return t.cm.curOp.selectionChanged=!0}),this.polling.set(this.cm.options.pollInterval,function e(){t.cm.state.focused&&(t.pollSelection(),t.polling.set(t.cm.options.pollInterval,e))})},r.prototype.selectionChanged=function(){var e=window.getSelection();return e.anchorNode!=this.lastAnchorNode||e.anchorOffset!=this.lastAnchorOffset||e.focusNode!=this.lastFocusNode||e.focusOffset!=this.lastFocusOffset},r.prototype.pollSelection=function(){var e,t,n,i;null==this.readDOMTimeout&&!this.gracePeriod&&this.selectionChanged()&&(e=window.getSelection(),t=this.cm,E&&d&&this.cm.options.gutters.length&&function(e){for(var t=e;t;t=t.parentNode)if(/CodeMirror-gutter-wrapper/.test(t.className))return 1;return}(e.anchorNode)?(this.cm.triggerOnKeyDown({type:"keydown",keyCode:8,preventDefault:Math.abs}),this.blur(),this.focus()):this.composing||(this.rememberSelection(),n=ya(t,e.anchorNode,e.anchorOffset),i=ya(t,e.focusNode,e.focusOffset),n&&i&&h(t,function(){X(t.doc,lr(n,i),pe),(n.bad||i.bad)&&(t.curOp.selectionChanged=!0)})))},r.prototype.pollContent=function(){null!=this.readDOMTimeout&&(clearTimeout(this.readDOMTimeout),this.readDOMTimeout=null);var e,t=this.cm,n=t.display,i=t.doc.sel.primary(),r=i.from(),i=i.to();if(0==r.ch&&r.line>t.firstLine()&&(r=j(r.line-1,U(t.doc,r.line-1).length)),i.ch==U(t.doc,i.line).text.length&&i.line<t.lastLine()&&(i=j(i.line+1,0)),r.line<n.viewFrom||i.line>n.viewTo-1)return!1;var o,a=r.line==n.viewFrom||0==(a=ci(t,r.line))?(e=x(n.view[0].line),n.view[0].node):(e=x(n.view[a].line),n.view[a-1].node.nextSibling),i=ci(t,i.line),n=i==n.view.length-1?(o=n.viewTo-1,n.lineDiv.lastChild):(o=x(n.view[i+1].line)-1,n.view[i+1].node.previousSibling);if(!a)return!1;for(var s=t.doc.splitLines(function(o,e,t,a,s){var n="",l=!1,c=o.doc.lineSeparator();function d(){l&&(n+=c,l=!1)}function u(e){e&&(d(),n+=e)}for(;!function e(t){if(1==t.nodeType){var n=t.getAttribute("cm-text");if(null!=n)u(n||t.textContent.replace(/\u200b/g,""));else if(n=t.getAttribute("cm-marker"))(n=o.findMarks(j(a,0),j(s+1,0),(r=+n,function(e){return e.id==r}))).length&&(n=n[0].find())&&u(Le(o.doc,n.from,n.to).join(c));else if("false"!=t.getAttribute("contenteditable")){(n=/^(pre|div|p)$/i.test(t.nodeName))&&d();for(var i=0;i<t.childNodes.length;i++)e(t.childNodes[i]);n&&(l=!0)}}else 3==t.nodeType&&u(t.nodeValue);var r}(e),e!=t;)e=e.nextSibling;return n}(t,a,n,e,o)),l=Le(t.doc,j(e,0),j(o,U(t.doc,o).text.length));1<s.length&&1<l.length;)if(H(s)==H(l))s.pop(),l.pop(),o--;else{if(s[0]!=l[0])break;s.shift(),l.shift(),e++}for(var c=0,d=0,u=s[0],h=l[0],p=Math.min(u.length,h.length);c<p&&u.charCodeAt(c)==h.charCodeAt(c);)++c;for(var f=H(s),m=H(l),g=Math.min(f.length-(1==s.length?c:0),m.length-(1==l.length?c:0));d<g&&f.charCodeAt(f.length-d-1)==m.charCodeAt(m.length-d-1);)++d;if(1==s.length&&1==l.length&&e==r.line)for(;c&&c>r.ch&&f.charCodeAt(f.length-d-1)==m.charCodeAt(m.length-d-1);)c--,d++;s[s.length-1]=f.slice(0,f.length-d).replace(/^\u200b+/,""),s[0]=s[0].slice(c).replace(/\u200b+$/,"");i=j(e,c),a=j(o,l.length?H(l).length-d:0);return 1<s.length||s[0]||q(i,a)?(Xr(t.doc,s,i,a,"+input"),!0):void 0},r.prototype.ensurePolled=function(){this.forceCompositionEnd()},r.prototype.reset=function(){this.forceCompositionEnd()},r.prototype.forceCompositionEnd=function(){this.composing&&(clearTimeout(this.readDOMTimeout),this.composing=null,this.updateFromDOM(),this.div.blur(),this.div.focus())},r.prototype.readFromDOMSoon=function(){var e=this;null==this.readDOMTimeout&&(this.readDOMTimeout=setTimeout(function(){if(e.readDOMTimeout=null,e.composing){if(!e.composing.done)return;e.composing=null}e.updateFromDOM()},80))},r.prototype.updateFromDOM=function(){var e=this;!this.cm.isReadOnly()&&this.pollContent()||h(this.cm,function(){return b(e.cm)})},r.prototype.setUneditable=function(e){e.contentEditable="false"},r.prototype.onKeyPress=function(e){0==e.charCode||(e.preventDefault(),this.cm.isReadOnly())||Y(this.cm,sa)(this.cm,String.fromCharCode(null==e.charCode?e.keyCode:e.charCode),0)},r.prototype.readOnlyChanged=function(e){this.div.contentEditable=String("nocursor"!=e)},r.prototype.onContextMenu=function(){},r.prototype.resetPosition=function(){},r.prototype.needsContentAttribute=!0;function o(e){this.cm=e,this.prevInput="",this.pollingFast=!1,this.polling=new de,this.inaccurateSelection=!1,this.hasSelection=!1,this.composing=null}var va,ba,wa,xa,Ca;function a(e,t,i,n){va.defaults[e]=t,i&&(ba[e]=n?function(e,t,n){n!=Xo&&i(e,t,n)}:i)}o.prototype.init=function(t){var e=this,r=this,o=this.cm,n=this.wrapper=ha(),a=this.textarea=n.firstChild;function i(e){if(!J(o,e)){if(o.somethingSelected())aa({lineWise:!1,text:o.getSelections()}),r.inaccurateSelection&&(r.prevInput="",r.inaccurateSelection=!1,a.value=F.text.join("\n"),se(a));else{if(!o.options.lineWiseCopyCut)return;var t=o.getCursor(),n=da(o);if(aa({lineWise:!0,text:n.text}),"cut"==e.type){if(e.clipboardData){e.clipboardData.clearData();var i=F.text.join("\n");if(e.clipboardData.setData("Text",i),e.clipboardData.getData("Text")==i)return e.preventDefault(),o.cid&&o.editor.undo.register({undo:[{type:"fences-pos",id:o.cid,pos:t}],redo:[]}),void o.replaceRange("",n.ranges[0].anchor,n.ranges[0].head,"cut-line")}o.setSelections(n.ranges,null,pe)}else r.prevInput="",a.value=n.text.join("\n"),se(a)}"cut"==e.type&&(o.state.cutIncoming=!0)}}t.wrapper.insertBefore(n,t.wrapper.firstChild),f&&(a.style.width="0px"),z(a,"input",function(){R&&9<=O&&e.hasSelection&&(e.hasSelection=null),r.poll()}),z(a,"paste",function(e){J(o,e)||la(e,o)||(o.state.pasteIncoming=!0,r.fastPoll())}),z(a,"cut",i),z(a,"copy",i),z(t.scroller,"paste",function(e){_n(t,e)||J(o,e)||(o.state.pasteIncoming=!0,r.focus())}),z(t.lineSpace,"selectstart",function(e){_n(t,e)||K(e)}),z(a,"compositionstart",function(){var e;1<o.getSelections().length||(e=o.getCursor("from"),r.composing&&r.composing.range.clear(),r.composing={start:e,range:o.markText(e,o.getCursor("to"),{className:"CodeMirror-composing"})})}),z(a,"compositionend",function(){r.composing&&(r.poll(),r.composing.range.clear(),r.composing=null)})},o.prototype.prepareSelection=function(){var e,t=this.cm,n=t.display,i=t.doc,r=ui(t);return t.options.moveInputWithCursor&&(t=Qn(t,i.sel.primary().head,"div"),i=n.wrapper.getBoundingClientRect(),e=n.lineDiv.getBoundingClientRect(),r.teTop=Math.max(0,Math.min(n.wrapper.clientHeight-10,(t.bottom+t.top)/2-2+e.top-i.top)),r.teLeft=Math.max(0,Math.min(n.wrapper.clientWidth-10,t.left+e.left-i.left))),r},o.prototype.showSelection=function(e){var t=this.cm.display;y(t.cursorDiv,e.cursors),y(t.selectionDiv,e.selection),null!=e.teTop&&(this.wrapper.style.top=e.teTop+"px",this.wrapper.style.left=e.teLeft+"px")},o.prototype.reset=function(e){var t,n,i,r;this.contextMenuPending||this.composing||(r=(n=this.cm).doc,n.somethingSelected()?(this.prevInput="",r=r.sel.primary(),r=(i=Ht&&(100<r.to().line-r.from().line||1e3<(t=n.getSelection()).length))?"-":t||n.getSelection(),this.textarea.value=r,n.state.focused&&se(this.textarea),R&&9<=O&&(this.hasSelection=r)):e||(this.prevInput=this.textarea.value="",R&&9<=O&&(this.hasSelection=null)),this.inaccurateSelection=i)},o.prototype.getField=function(){return this.textarea},o.prototype.supportsTouch=function(){return!1},o.prototype.focus=function(){if("nocursor"!=this.cm.options.readOnly&&(!M||ie()!=this.textarea))try{this.textarea.focus()}catch(e){}},o.prototype.blur=function(){this.textarea.blur()},o.prototype.resetPosition=function(){this.wrapper.style.top=this.wrapper.style.left=0},o.prototype.receivedFocus=function(){this.slowPoll()},o.prototype.slowPoll=function(){var e=this;this.pollingFast||this.polling.set(this.cm.options.pollInterval,function(){e.poll(),e.cm.state.focused&&e.slowPoll()})},o.prototype.fastPoll=function(){var t=!1,n=this;n.pollingFast=!0,n.polling.set(20,function e(){n.poll()||t?(n.pollingFast=!1,n.slowPoll()):(t=!0,n.polling.set(60,e))})},o.prototype.poll=function(){var e=this,t=this.cm,n=this.textarea,i=this.prevInput;if(this.contextMenuPending||!t.state.focused||$t(n)&&!i&&!this.composing||t.isReadOnly()||t.options.disableInput||t.state.keySeq)return!1;var r=n.value;if(r==i&&!t.somethingSelected())return!1;if(R&&9<=O&&this.hasSelection===r||Z&&/[\uf700-\uf7ff]/.test(r))return t.display.input.reset(),!1;if(t.doc.sel==t.display.selForContextMenu){var o=r.charCodeAt(0);if(8203==o&&(i=i||"​"),8666==o)return this.reset(),this.cm.execCommand("undo")}for(var a=0,s=Math.min(i.length,r.length);a<s&&i.charCodeAt(a)==r.charCodeAt(a);)++a;return h(t,function(){sa(t,r.slice(a),i.length-a,null,e.composing?"*compose":null),1e3<r.length||-1<r.indexOf("\n")?n.value=e.prevInput="":e.prevInput=r,e.composing&&(e.composing.range.clear(),e.composing.range=t.markText(e.composing.start,t.getCursor("to"),{className:"CodeMirror-composing"}))}),!0},o.prototype.ensurePolled=function(){this.pollingFast&&this.poll()&&(this.pollingFast=!1)},o.prototype.onKeyPress=function(){R&&9<=O&&(this.hasSelection=null),this.fastPoll()},o.prototype.onContextMenu=function(e){var t,n,i,r,o,a,s=this,l=s.cm,c=l.display,d=s.textarea,u=li(l,e),h=c.scroller.scrollTop;function p(){var e,t;null!=d.selectionStart&&(t="​"+((e=l.somethingSelected())?d.value:""),d.value="⇚",d.value=t,s.prevInput=e?"":"​",d.selectionStart=1,d.selectionEnd=t.length,c.selForContextMenu=l.doc.sel)}function f(){var e,t;s.contextMenuPending=!1,s.wrapper.style.cssText=r,d.style.cssText=i,R&&O<9&&c.scrollbars.setScrollTop(c.scroller.scrollTop=h),null!=d.selectionStart&&((!R||O<9)&&p(),e=0,t=function(){c.selForContextMenu==l.doc.sel&&0==d.selectionStart&&0<d.selectionEnd&&"​"==s.prevInput?Y(l,zr)(l):e++<10?c.detectingSelectAll=setTimeout(t,500):(c.selForContextMenu=null,c.input.reset())},c.detectingSelectAll=setTimeout(t,200))}u&&!S&&(n=document.querySelector("content"),I&&(t=n?n.scrollTop:window.scrollY),l.options.resetSelectionOnContextMenu&&-1==l.doc.sel.contains(u)&&(File.isMac?(o=l.findWordAt(u),Y(l,X)(l.doc,lr(o.anchor,o.head),pe)):Y(l,X)(l.doc,lr(u),pe)),i=d.style.cssText,r=s.wrapper.style.cssText,s.wrapper.style.cssText="position: absolute",o=s.wrapper.getBoundingClientRect(),d.style.cssText="position: absolute; width: 30px; height: 30px;\n      top: "+(e.clientY-o.top-5)+"px; left: "+(e.clientX-o.left-5)+"px;\n      z-index: 1000; background: "+(R?"rgba(255, 255, 255, .05)":"transparent")+";\n      outline: none; border-width: 0; outline: none; overflow: hidden; opacity: .05; filter: alpha(opacity=5);",c.input.focus(),I&&setTimeout(()=>{(n||window).scrollTop=t},0),c.input.reset(),l.somethingSelected()||(d.value=s.prevInput=" "),s.contextMenuPending=!0,c.selForContextMenu=l.doc.sel,clearTimeout(c.detectingSelectAll),R&&9<=O&&p(),te?(Nt(e),a=function(){V(window,"mouseup",a),setTimeout(f,20)},z(window,"mouseup",a)):setTimeout(f,50))},o.prototype.readOnlyChanged=function(e){e||this.reset()},o.prototype.setUneditable=function(){},o.prototype.needsContentAttribute=!1,ba=(va=C).optionHandlers,va.defineOption=a,va.Init=Xo,a("value","",function(e,t){return e.setValue(t)},!0),a("mode",null,function(e,t){e.doc.modeOption=t,pr(e)},!0),a("indentUnit",2,pr,!0),a("indentWithTabs",!1),a("smartIndent",!0),a("tabSize",4,function(e){fr(e),zn(e),b(e)},!0),a("lineSeparator",null,function(e,i){if(e.doc.lineSep=i){var r=[],o=e.doc.first;e.doc.iter(function(e){for(var t=0;;){var n=e.text.indexOf(i,t);if(-1==n)break;t=n+i.length,r.push(j(o,n))}o++});for(var t=r.length-1;0<=t;t--)Xr(e.doc,i,r[t],j(r[t].line,r[t].ch+i.length))}}),a("specialChars",/[\u0000-\u001f\u007f-\u009f\u00ad\u061c\u200b-\u200f\u2028\u2029\ufeff]/g,function(e,t,n){e.state.specialChars=new RegExp(t.source+(t.test("\t")?"":"|\t"),"g"),n!=Xo&&e.refresh()}),a("specialCharPlaceholder",hn,function(e){return e.refresh()},!0),a("electricChars",!0),a("inputStyle",M?"contenteditable":"textarea",function(){throw new Error("inputStyle can not (yet) be changed in a running editor")},!0),a("spellcheck",!1,function(e,t){return e.getInputField().spellcheck=t},!0),a("rtlMoveVisually",!l),a("wholeLineUpdateBefore",!0),a("theme","default",function(e){Qo(e),ta(e)},!0),a("keyMap","default",function(e,t,n){t=No(t),n=n!=Xo&&No(n);n&&n.detach&&n.detach(e,t),t.attach&&t.attach(e,n||null)}),a("extraKeys",null),a("lineWrapping",!1,ia,!0),a("gutters",[],function(e){tr(e.options),ta(e)},!0),a("fixedGutter",!0,function(e,t){e.display.gutters.style.left=t?oi(e.display)+"px":"0",e.refresh()},!0),a("coverGutterNextToScrollbar",!1,function(e){return Bi(e)},!0),a("scrollbarStyle","native",function(e){Ii(e),Bi(e),e.display.scrollbars.setScrollTop(e.doc.scrollTop),e.display.scrollbars.setScrollLeft(e.doc.scrollLeft)},!0),a("lineNumbers",!1,function(e){tr(e.options),ta(e)},!0),a("firstLineNumber",1,ta,!0),a("lineNumberFormatter",function(e){return e},ta,!0),a("showCursorWhenSelecting",!1,di,!0),a("resetSelectionOnContextMenu",!0),a("lineWiseCopyCut",!0),a("readOnly",!1,function(e,t){"nocursor"==t?(yi(e),e.display.input.blur(),e.display.disabled=!0):e.display.disabled=!1,e.display.input.readOnlyChanged(t)}),a("disableInput",!1,function(e,t){t||e.display.input.reset()},!0),a("dragDrop",!0,na),a("allowDropFileTypes",null),a("cursorBlinkRate",530),a("cursorScrollMargin",0),a("cursorHeight",1,di,!0),a("singleCursorHeightPerLine",!0,di,!0),a("workTime",100),a("workDelay",100),a("flattenSpans",!0,fr,!0),a("addModeClass",!1,fr,!0),a("pollInterval",100),a("undoDepth",200,function(e,t){return e.doc.history.undoDepth=t}),a("historyEventDelay",1250),a("viewportMargin",10,function(e){return e.refresh()},!0),a("maxHighlightLength",1e4,fr,!0),a("moveInputWithCursor",!0,function(e,t){t||e.display.input.resetPosition()}),a("tabindex",null,function(e,t){return e.display.input.getField().tabIndex=t||""}),a("autofocus",null),a("direction","ltr",function(e,t){return e.doc.setDirection(t)},!0),xa=(wa=C).optionHandlers,Ca=wa.helpers={},wa.prototype={constructor:wa,focus:function(){window.focus(),this.display.input.focus()},setOption:function(e,t){var n=this.options,i=n[e];n[e]==t&&"mode"!=e||(n[e]=t,xa.hasOwnProperty(e)&&Y(this,xa[e])(this,t,i),_(this,"optionChange",this,e))},getOption:function(e){return this.options[e]},getDoc:function(){return this.doc},addKeyMap:function(e,t){this.state.keyMaps[t?"push":"unshift"](No(e))},removeKeyMap:function(e){for(var t=this.state.keyMaps,n=0;n<t.length;++n)if(t[n]==e||t[n].name==e)return t.splice(n,1),!0},addOverlay:n(function(e,t){var n=e.token?e:wa.getMode(this.options,e);if(n.startState)throw new Error("Overlays may not be stateful.");for(var i=this.state.overlays,n={mode:n,modeSpec:e,opaque:t&&t.opaque,priority:t&&t.priority||0},r=function(e){return e.priority},o=0,a=r(n);o<i.length&&r(i[o])<=a;)o++;i.splice(o,0,n),this.state.modeGen++,b(this)}),removeOverlay:n(function(e){for(var t=this.state.overlays,n=0;n<t.length;++n){var i=t[n].modeSpec;if(i==e||"string"==typeof e&&i.name==e)return t.splice(n,1),this.state.modeGen++,void b(this)}}),indentLine:n(function(e,t,n){"string"!=typeof t&&"number"!=typeof t&&(t=null==t?this.options.smartIndent?"smart":"prev":t?"add":"subtract"),Be(this.doc,e)&&oa(this,e,t,n)}),indentSelection:n(function(e){for(var t=this.doc.sel.ranges,n=-1,i=0;i<t.length;i++){var r=t[i];if(r.empty())r.head.line>n&&(oa(this,r.head.line,e,!0),n=r.head.line,i==this.doc.sel.primIndex)&&ki(this);else{for(var o=r.from(),r=r.to(),a=Math.max(n,o.line),n=Math.min(this.lastLine(),r.line-(r.ch?0:1))+1,s=a;s<n;++s)oa(this,s,e);r=this.doc.sel.ranges;0==o.ch&&t.length==r.length&&0<r[i].from().ch&&Br(this.doc,i,new Q(o,r[i].to()),pe)}}}),getTokenAt:function(e,t){return rn(this,e,t)},getLineTokens:function(e,t){return rn(this,j(e),t,!0)},getTokenTypeAt:function(e){e=W(this.doc,e);var t,n=Xt(this,U(this.doc,e.line)),i=0,r=(n.length-1)/2,o=e.ch;if(0==o)t=n[2];else for(;;){var a=i+r>>1;if((a?n[2*a-1]:0)>=o)r=a;else{if(!(n[2*a+1]<o)){t=n[2*a+2];break}i=1+a}}e=t?t.indexOf("overlay "):-1;return e<0?t:0==e?null:t.slice(0,e-1)},getModeAt:function(e){var t=this.doc.mode;return t.innerMode?wa.innerMode(t,this.getTokenAt(e).state).mode:t},getHelper:function(e,t){return this.getHelpers(e,t)[0]},getHelpers:function(e,t){var n=[];if(Ca.hasOwnProperty(t)){var i=Ca[t],r=this.getModeAt(e);if("string"==typeof r[t])i[r[t]]&&n.push(i[r[t]]);else if(r[t])for(var o=0;o<r[t].length;o++){var a=i[r[t][o]];a&&n.push(a)}else r.helperType&&i[r.helperType]?n.push(i[r.helperType]):i[r.name]&&n.push(i[r.name]);for(var s=0;s<i._global.length;s++){var l=i._global[s];l.pred(r,this)&&-1==w(n,l.val)&&n.push(l.val)}}return n},getStateAfter:function(e,t){var n=this.doc;return Zt(this,(e=Ue(n,null==e?n.first+n.size-1:e))+1,t)},cursorCoords:function(e,t){var n=this.doc.sel.primary(),e=null==e?n.head:"object"==typeof e?W(this.doc,e):e?n.from():n.to();return Qn(this,e,t||"page")},charCoords:function(e,t){return Gn(this,W(this.doc,e),t||"page")},coordsChar:function(e,t){return ei(this,(e=Yn(this,e,t||"page")).left,e.top)},lineAtHeight:function(e,t){return e=Yn(this,{top:e,left:0},t||"page").top,Pe(this.doc,e+this.display.viewOffset)},heightAtLine:function(e,t,n){var i=!1,r="number"==typeof e?(r=this.doc.first+this.doc.size-1,e<this.doc.first?e=this.doc.first:r<e&&(e=r,i=!0),U(this.doc,e)):e;return Kn(this,r,{top:0,left:0},t||"page",n||i).top+(i?this.doc.height-lt(r):0)},defaultTextHeight:function(){return ni(this.display)},defaultCharWidth:function(){return ii(this.display)},getViewport:function(){return{from:this.display.viewFrom,to:this.display.viewTo}},addWidget:function(e,t,n,i,r){var o,a,s=this.display,l=(e=Qn(this,W(this.doc,e))).bottom,c=e.left;t.style.position="absolute",t.setAttribute("cm-ignore-events","true"),this.display.input.setUneditable(t),s.sizer.appendChild(t),"over"==i?l=e.top:"above"!=i&&"near"!=i||(a=Math.max(s.wrapper.clientHeight,this.doc.height),o=Math.max(s.sizer.clientWidth,s.lineSpace.clientWidth),("above"==i||e.bottom+t.offsetHeight>a)&&e.top>t.offsetHeight?l=e.top-t.offsetHeight:e.bottom+t.offsetHeight<=a&&(l=e.bottom),c+t.offsetWidth>o&&(c=o-t.offsetWidth)),t.style.top=l+"px",t.style.left=t.style.right="","right"==r?(c=s.sizer.clientWidth-t.offsetWidth,t.style.right="0px"):("left"==r?c=0:"middle"==r&&(c=(s.sizer.clientWidth-t.offsetWidth)/2),t.style.left=c+"px"),n&&(i=this,a={left:c,top:l,right:c+t.offsetWidth,bottom:l+t.offsetHeight},null!=(a=Fi(i,a)).scrollTop&&Ai(i,a.scrollTop),null!=a.scrollLeft)&&Li(i,a.scrollLeft)},triggerOnKeyDown:n(Wo),triggerOnKeyPress:n(Vo),triggerOnKeyUp:zo,execCommand:function(e){if(Po.hasOwnProperty(e))return Po[e].call(null,this)},triggerElectric:n(function(e){ca(this,e)}),findPosH:function(e,t,n,i){for(var r=1,o=(t<0&&(r=-1,t=-t),W(this.doc,e)),a=0;a<t&&!(o=pa(this.doc,o,r,n,i)).hitSide;++a);return o},moveH:n(function(t,n){var i=this;this.extendSelectionsBy(function(e){return i.display.shift||i.doc.extend||e.empty()?pa(i.doc,e.head,t,n,i.options.rtlMoveVisually):t<0?e.from():e.to()},me)}),deleteH:n(function(n,i){var e=this.doc.sel,r=this.doc;e.somethingSelected()?r.replaceSelection("",null,"+delete"):Do(this,function(e){var t=pa(r,e.head,n,i,!1);return n<0?{from:t,to:e.head}:{from:e.head,to:t}})}),findPosV:function(e,t,n,i){for(var r=1,o=i,a=(t<0&&(r=-1,t=-t),W(this.doc,e)),s=0;s<t;++s){var l=Qn(this,a,"div");if(null==o?o=l.left:l.left=o,(a=fa(this,l,r,n)).hitSide)break}return a},moveV:n(function(i,r){var o=this,a=this.doc,s=[],l=!this.display.shift&&!a.extend&&a.sel.somethingSelected();if(a.extendSelectionsBy(function(e){var t,n;return l?i<0?e.from():e.to():(t=Qn(o,e.head,"div"),null!=e.goalColumn&&(t.left=e.goalColumn),s.push(t.left),n=fa(o,t,i,r),"page"==r&&e==a.sel.primary()&&Si(o,Gn(o,n,"div").top-t.top),n)},me),s.length)for(var e=0;e<a.sel.ranges.length;e++)a.sel.ranges[e].goalColumn=s[e]}),findWordAt:function(e){var t=U(this.doc,e.line).text,n=e.ch,i=e.ch;if(t){for(var r=this.getHelper(e,"wordChars"),o=("before"!=e.sticky&&i!=t.length||!n?++i:--n,t.charAt(n)),a=Se(o,r)?function(e){return Se(e,r)}:/\s/.test(o)?function(e){return/\s/.test(e)}:function(e){return!/\s/.test(e)&&!Se(e)};0<n&&a(t.charAt(n-1));)--n;for(;i<t.length&&a(t.charAt(i));)++i}return new Q(j(e.line,n),j(e.line,i))},toggleOverwrite:function(e){null!=e&&e==this.state.overwrite||(((this.state.overwrite=!this.state.overwrite)?re:D)(this.display.cursorDiv,"CodeMirror-overwrite"),_(this,"overwriteToggle",this,this.state.overwrite))},hasFocus:function(){return this.display.input.getField()==ie()},isReadOnly:function(){return!(!this.options.readOnly&&!this.doc.cantEdit)},scrollTo:n(function(e,t){Ei(this,e,t)}),getScrollInfo:function(){var e=this.display.scroller;return{left:e.scrollLeft,top:e.scrollTop,height:e.scrollHeight-Nn(this)-this.display.barHeight,width:e.scrollWidth-Nn(this)-this.display.barWidth,clientHeight:Pn(this),clientWidth:Dn(this)}},scrollIntoView:n(function(e,t){var n;null==e?(e={from:this.doc.sel.primary().head,to:null},null==t&&(t=this.options.cursorScrollMargin)):"number"==typeof e?e={from:j(e,0),to:null}:null==e.from&&(e={from:e,to:null}),e.to||(e.to=e.from),e.margin=t||0,null!=e.from.line?(t=e,Ti(n=this),n.curOp.scrollToPos=t):_i(this,e.from,e.to,e.margin)}),setSize:n(function(e,t){function n(e){return"number"==typeof e||/^\d+$/.test(String(e))?e+"px":e}var i=this,r=(null!=e&&(this.display.wrapper.style.width=n(e)),null!=t&&(this.display.wrapper.style.height=n(t)),this.options.lineWrapping&&Wn(this),this.display.viewFrom);this.doc.iter(r,this.display.viewTo,function(e){if(e.widgets)for(var t=0;t<e.widgets.length;t++)if(e.widgets[t].noHScroll){ji(i,r,"widget");break}++r}),this.curOp.forceUpdate=!0,_(this,"refresh",this)}),operation:function(e){return h(this,e)},refresh:n(function(){var e=this.display.cachedTextHeight;b(this),this.curOp.forceUpdate=!0,zn(this),Ei(this,this.doc.scrollLeft,this.doc.scrollTop),Xi(this),(null==e||.5<Math.abs(e-ni(this.display)))&&si(this),_(this,"refresh",this)}),swapDoc:n(function(e){var t=this.doc;return t.cm=null,vr(this,e),zn(this),this.display.input.reset(),Ei(this,e.scrollLeft,e.scrollTop),this.curOp.forceScroll=!0,v(this,"swapDoc",this,t),t}),getInputField:function(){return this.display.input.getField()},getWrapperElement:function(){return this.display.wrapper},getScrollerElement:function(){return this.display.scroller},getGutterElement:function(){return this.display.gutters}},At(wa),wa.registerHelper=function(e,t,n){Ca.hasOwnProperty(e)||(Ca[e]=wa[e]={_global:[]}),Ca[e][t]=n},wa.registerGlobalHelper=function(e,t,n,i){wa.registerHelper(e,t,i),Ca[e]._global.push({pred:n,val:i})};var Fa,Sa="iter insert remove copy getEditor constructor".split(" ");for(Fa in g.prototype)g.prototype.hasOwnProperty(Fa)&&w(Sa,Fa)<0&&(C.prototype[Fa]=function(e){return function(){return e.apply(this.doc,arguments)}}(g.prototype[Fa]));return At(g),C.inputStyles={textarea:o,contenteditable:r},C.defineMode=function(e){C.defaults.mode||"null"==e||(C.defaults.mode=e),function(e,t){2<arguments.length&&(t.dependencies=Array.prototype.slice.call(arguments,2)),jt[e]=t}.apply(this,arguments)},C.defineMIME=function(e,t){qt[e]=t},C.defineMode("null",function(){return{token:function(e){return e.skipToEnd()}}}),C.defineMIME("text/plain","null"),C.defineExtension=function(e,t){C.prototype[e]=t},C.defineDocExtension=function(e,t){g.prototype[e]=t},C.fromTextArea=function(t,e,n,i){var r;function o(){t.value=c.getValue()}if((e=e?ce(e):{}).value=t.value,!e.tabindex&&t.tabIndex&&(e.tabindex=t.tabIndex),!e.placeholder&&t.placeholder&&(e.placeholder=t.placeholder),null==e.autofocus&&(r=ie(),e.autofocus=r==t||null!=t.getAttribute("autofocus")&&r==document.body),t.form&&(z(t.form,"submit",o),!e.leaveSubmitMethodAlone)){var a=t.form,s=a.submit;try{var l=a.submit=function(){o(),a.submit=s,a.submit(),a.submit=l}}catch(e){}}e.finishInit=function(e){e.save=o,e.getTextArea=function(){return t},e.toTextArea=function(){e.toTextArea=isNaN,o(),t.parentNode.removeChild(e.getWrapperElement()),t.style.display="",t.form&&(V(t.form,"submit",o),"function"==typeof t.form.submit)&&(t.form.submit=s)}},t.style.display="none";var c=C(function(e){return t.parentNode.insertBefore(e,t.nextSibling)},e,n,i);return c},(t=C).off=V,t.on=z,t.wheelEventPixels=or,t.Doc=g,t.splitLines=It,t.countColumn=$,t.findColumn=ge,t.isWordChar=Fe,t.Pass=he,t.signal=_,t.Line=sn,t.changeEnd=cr,t.scrollbarModel=Oi,t.Pos=j,t.cmpPos=q,t.modes=jt,t.mimeModes=qt,t.resolveMode=Wt,t.getMode=zt,t.modeExtensions=Vt,t.extendMode=Jt,t.copyState=Kt,t.startState=Gt,t.innerMode=Yt,t.commands=Po,t.keyMap=Eo,t.keyName=Lo,t.isModifierKey=Mo,t.lookupKey=Ao,t.normalizeKeyMap=_o,t.StringStream=m,t.SharedTextMarker=uo,t.TextMarker=so,t.LineWidget=oo,t.e_preventDefault=K,t.e_stopPropagation=Mt,t.e_stop=Nt,t.addClass=re,t.contains=ne,t.rmClass=D,t.keyNames=Co,C.version="5.26.0",C}()}),$__System.registerDynamic("15",["20","11","e","13","26"],!0,function(e,t,n){"use strict";this||self;var p,l,c,f=e("20"),m=(e("11"),e("e")),i=e("13"),g=(e("26").map,i.TYPE,i.Node),y={},v={},b=0;function d(e){function t(e,t){return((t=t||window.getComputedStyle(document.body)).getPropertyValue(e)||"").replace(/(^[\s\'\"]+)|([\s\'\"]+$)/g,"").toLowerCase()}var n=e?void 0:window.getComputedStyle(document.body),i=(e=e||t("--mermaid-theme"),c=e,"on"==t("--mermaid-sequence-numbers")),r=t("--mermaid-flowchart-curve"),o=(-1==["linear","basis","step","natural"].indexOf(r)&&(r=void 0),t("--mermaid--gantt-left-padding")||75);try{o=parseFloat(o),isNaN(o)&&(o=75)}catch(e){o=75}var a,s,l={};return"night"==e?((s=n)&&s.getPropertyValue("--text-color").trim(),l={darkMode:!1,fontFamily:(s?s.getPropertyValue("--mermaid-font-family").trim():void 0)||'"trebuchet ms", verdana, arial, sans-serif'},e="dark"):-1<["base","default","dark","forest","neutral"].indexOf(e)||(n?(n=(s=n).getPropertyValue("--node-fill").trim(),a=File.colorBrightness<.5,a={darkMode:a=n&&/#/.exec(n)?(299*parseInt(n.substr(1,2),16)+587*parseInt(n.substr(3,2),16)+114*parseInt(n.substr(4,2),16))/1e3<40:a,fontFamily:s.getPropertyValue("--mermaid-font-family").trim()||'"trebuchet ms", verdana, arial, sans-serif',noteTextColor:s.getPropertyValue("--text-color").trim(),primaryColor:n,background:s.getPropertyValue("--mermaid-background").trim()||s.getPropertyValue("--bg-color").trim(),noteBkgColor:s.getPropertyValue("--cluster-fill").trim(),textColor:s.getPropertyValue("--node-text-color").trim()||s.getPropertyValue("--text-color").trim()},"#ECECFF"!==n||a.darkMode||(a.secondaryColor="#f4f4f4"),l=a):c=e="default"),{securityLevel:"loose",theme:e||"base",themeVariables:l,darkMode:"night"==e||"dark"==e,altFontFamily:"sans-serif",fontFamily:"sans-serif",startOnLoad:!1,flowchart:{htmlLabels:!0,useMaxWidth:!0,curve:r},sequence:{showSequenceNumbers:i,useMaxWidth:!1,diagramMarginX:8,diagramMarginY:8,boxMargin:8},gantt:{leftPadding:o,rightPadding:20}}}var r;function o(){r&&clearTimeout(r),r=setTimeout(function(){r=null,File.editor&&File.editor.diagrams&&(File.editor.diagrams.loadMermaidTheme(),File.editor.diagrams.refreshDiagram(!0))},500)}class a{constructor(e){this.editor=e;var n=this;m(e.sessionStr).on("refocus",".md-diagram",function(){var e=this.getAttribute("cid"),t=(n.startPreview(e),(this.querySelector(".CodeMirror")||{}).CodeMirror);(t=t||n.editor.fences.getCm(e)).hasFocus()||t.refresh()}),this.refreshMermaidAfterZoom=o}cancelDiagram(e){var t=this.editor.fences.getCm(e);this.editor.findElemById(e).find(".md-diagram-panel").remove().end()[0].style.marginBottom="",y[e]&&clearTimeout(y[e]),y[e]=void 0,v[e]=void 0,t.state.lint&&f.clearMarks(t),t.getWrapperElement().offsetHeight||t.refresh()}refreshDiagram(t,e){var n=this;(e=e||document.querySelector("#write")).querySelectorAll(".md-fences-advanced.md-diagram").forEach(function(e){!t&&e.querySelector("svg")||(n.editor.fences.getCm(e.getAttribute("cid")),n.updateDiagram(e.getAttribute("cid"),!0))})}loadMermaidTheme(){if(File.option.enableDiagram&&window.mermaidAPI){l=d();try{window.mermaidAPI.initialize(l)}catch(e){window.Reporter.captureException(e,{level:"warning",currentMermaidOptions:JSON.stringify(l)}),l=d("default");try{window.mermaidAPI.initialize(l)}catch(e){window.Reporter.captureException(e)}}}}getCurrentMermaidOptions(){return l}lazyload(){var e,t,n;function i(){e.modeLoaded=!0,window.mermaidAPI=mermaid.mermaidAPI,e.loadMermaidTheme(),m(t.sessionStr).on("click",".md-diagram-panel",function(e){e=m(e.target).closest("a");if(e.length)return t.tryOpenLink(e),!1;var e=m(this).prevAll(".CodeMirror");e.length&&!e.hasClass("CodeMirror-focused")&&(e=e[0].CodeMirror)&&(e.refresh(),e.focus())}).addClass("enable-diagrams"),e.refreshDiagram()}File.option.enableDiagram&&(t=(e=this).editor,window.debugMode?Promise.all([System.import("diagram/lodash.core.js"),System.import("diagram/mermaid.js"),System.import("diagram/raphael.js")]).then(function(){Promise.all([System.import("diagram/mermaid-zenuml.js"),System.import("diagram/sequence-diagram.js"),System.import("diagram/flowchart.js")]).then(function(){window.mermaid.registerExternalDiagrams([window["mermaid-zenuml"]]),i()})}):(n=File.isNode?"./lib.asar":"./lib",m.getScript(n+"/diagram/diagram.min.js",function(){m.getScript(n+"/diagram/mermaid.min.js",function(){m.getScript(n+"/diagram/mermaid-zenuml.min.js",function(){window.mermaid.registerExternalDiagrams([window["mermaid-zenuml"]]),i()})})})))}async startPreview(e){var t,n=this.editor.getNode(e).get("lang"),i=this.editor.fences.getCm(e);a.isDiagramType(n)&&((t=(n=this.editor.findElemById(e)).find(".md-diagram-panel")).length||(t=m("#componenet .md-diagram-panel").clone(),n.append(t),await this.updateDiagram(e),i.setOption("lint",{getAnnotations:function(){return[]},lintOnChange:!1})),n[0].style.marginBottom=n[0].classList.contains("md-focus")?t.height()+50+"px":"")}async updateDiagram(n,i,e){var r,o=this.editor,a=this.editor.findElemById(n),s=this.editor.fences.getCm(n),l=a.find(".md-diagram-panel");if(a[0].removeAttribute("mermaid-type"),!l.length)return o.diagrams.startPreview(n);function c(e){l.find(".md-diagram-panel-error")[0].innerHTML="",s.state.lint&&f.clearMarks(s),e&&(v[s.cid]=null)}function d(e,t){try{e.message="ERROR: ["+t+"] "+e.message}catch(e){}(document.querySelector("[cid='"+n+"'] .md-diagram-panel-error")||{}).textContent=e.message,e.loc&&(v[n]=e,i||(1<s.doc.lineCount()&&e.loc.first_line-1==(s.getCursor()||{}).line?c():o.diagrams.attachError(s,e)))}var u="#fff";async function h(){c(!0);function e(e){i.innerHTML=e||"",(e=i.querySelector("svg"))&&(e.style.margin="auto")}var t=[s.getValue(),0],n=t[1],i=l.find(".md-diagram-panel-preview")[0],t=t[0],r=(t.match(/\s*([^\s]+)/)||["",""])[1];a[0].setAttribute("mermaid-type",r);try{if(p=null,e(""),0==t.trim().length?e("<text>"+m.localize.getString("Empty Diagram")+"</text>"):window.mermaidAPI&&e((await mermaidAPI.render("mermaidChart"+b++,t,i)||{}).svg),p)throw p}catch(e){return e.hash&&(e.loc=e.hash.loc,e.line=e.hash.line,e.loc?(e.loc.first_line+=n,e.loc.last_line+=n,e.message=e.message.replace(/^[^\n]*(\d)/,function(e,t){return"Parse error on line "+(+t+n)})):e.loc={first_line:e.line+1,last_line:e.line+1}),void d(e,"Mermaid")}c(!0)}async function t(){if(l.length){if(g.isType(s.options.mode,"sequence"))!function(){try{r=Diagram.parse(s.getValue()||"title: Empty Diagram"),v[n]=null}catch(e){return d(e,"Sequence")}c(!0),l.find(".md-diagram-panel-preview")[0].innerHTML="";var e=(window.getComputedStyle(document.body).getPropertyValue("--sequence-theme")||"").replace(/(^[\s\'\"]+)|([\s\'\"]+$)/g,"").toLowerCase(),e=(r.drawSVG(l.find(".md-diagram-panel-preview")[0],{theme:"hand"===e?"hand":"simple"}),l.find("svg")[0]),t=l.width()/+e.getAttribute("width").replace("px","");t<1&&(e.style.zoom=t)}();else if(g.isType(s.options.mode,"flow"))try{c(!0),r=flowchart.parse(s.getValue().replace(/\r/g,"")||"st=>start: Empty Diagram\ne=>end\nst->e"),l.find(".md-diagram-panel-preview")[0].innerHTML="",r.drawSVG(l.find(".md-diagram-panel-preview")[0],{y:0,"font-color":"currentColor","line-color":"currentColor","element-color":"currentColor",fill:u})}catch(e){d(e,"Flowchart")}else{if(!g.isType(s.options.mode,"mermaid"))return;await h()}var e=l.height(),t=l.closest("[cid]")[0];t.style.marginBottom=t.classList.contains("md-focus")?e+40+"px":"",y[n]=null}}window.CSS&&window.CSS.supports&&window.CSS.supports("(--foo: red)")&&(u="var(--bg-color)"),y[n]&&clearTimeout(y[n]),e?await t():y[n]=setTimeout(t,200)}attachError(e,t){try{var n;t=t||v[e.cid],e.state.lint&&f.clearMarks(e),t&&t.loc&&(n={from:f.Pos(t.loc.first_line-1,t.loc.first_column),to:f.Pos(t.loc.last_line-1,t.loc.last_column||e.doc.getLine(t.loc.last_line-1).length),message:t.message},(document.querySelector("[cid='"+e.cid+"'] .md-diagram-panel-error")||{}).textContent=t.message,f.updateLinting(e,[n]))}catch(t){}}async mermaidSvgForExportTheme(e){var t=l,n=c,r=this.editor,i=this;var o,a,s=-1==(s=(e=e).lastIndexOf("--mermaid-theme"))?"default":(e=e.substr(s),((/--mermaid-theme\s*:\s*([^\s;]+)/.exec(e)||[])[1]||"default").replace(/['"]/g,""));return s==c?null:(e=d(s),s=e,window.mermaidAPI.initialize(s),s=document.querySelectorAll(".md-diagram[lang='mermaid']"),(o=document.querySelector("#mermaid-canvas")).innerHTML="",a={},await Promise.all(Array.from(s).map(e=>{return e=e,n=r.getNode(e.getAttribute("cid")),i=n.get("text"),(e=document.createElement("div")).setAttribute("id","export-mermaid-"+n.cid),o.appendChild(e),new Promise(t=>{try{mermaidAPI.render("export-mermaid-"+n.cid,i).then(function(e){e=(e||{}).svg||"";a[n.cid]=e,t(e)})}catch(e){console.error(e),a[n.cid]="",t("")}});var n,i})),l=t,c=n,o.innerHTML="",i.loadMermaidTheme(),a)}}a.isDiagramType=function(e){return File.option.enableDiagram&&"string"==typeof e&&g.isType((e||"").toLowerCase().trim(),"sequence","flow","mermaid")},a.MODES=["sequence","flow","mermaid"],a.getMermaidOptions=d,n.exports=a}),$__System.registerDynamic("17",["20","11","e","16","13","26","15","1b"],!0,function(e,R,t){"use strict";this||self;var c,n,d=e("20"),a=e("11"),u=e("e"),r=e("16"),i=e("13"),o=e("26"),s=(e("15"),e("1b")),l=s.SnapFlag,h=(o.map,i.Node),e=(i.TYPE,["em","strong","small","big","s","strike","cite","q","dfn","abbr","data","time","code","var","samp","kbd","sub","sup","i","b","mark","ruby","span","ins","del","button","font","acronym","tt","progress","meter","svg","a"]),o=["script","style","meta","noscript","input","template","head","canvas","link"],i=e.concat(["img","a","br","wbr"]),p=["div","p","h1","h2","h3","h4","h5","h6","table","figure","details","left","right","center","footer","header","nav","ol","ul","article","address","dl","applet","map","aside","audio","bdo","blockquote","form","select","dialog","picture","embed","object","iframe","main","pre","section","svg","textarea","video","template","head","canvas","hr"],f=i.concat(p).concat(o),m=/^\s*<(\!DOCTYPE|div|p|h[1-6]|table|figure|details|left|right|center|footer|header|nav|ol|ul|article|address|dl|applet|map|aside|audio|bdo|blockquote|form|select|dialog|picture|embed|object|iframe|main|pre|section|svg|textarea|video|template|head|canvas|base|datalist|meta|script|style|noscript|title|menu|hr)(?:(\/)|>|\s|$)/i,g=["br","hr","embed"],y={},v=function(e){return y[e]||(y[e]=new RegExp("(?:<"+e+"(?:\\s+[a-zA-Z_:][a-zA-Z0-9:._-]*(?:\\s*=\\s*(?:[^\"'=<>`\\\0-\\ ]+|'[^']*'|\"[^\"]*\"))?)*\\s*(\\/?)>?|<(\\/)"+e+"\\s*[>])","i")),y[e]},b=!1;class w{constructor(e){this.editor=e,this.bindEvent_(),this.listenMessage(),this.currentCm=null}bindEvent_(e){var n,i,r=this,o=this.editor;u("#write").on("mousedown",".md-htmlblock-container",function(e){i=o.selection.getRangy(),n=i&&i.collapsed?[e.offsetX,e.offsetY]:null}).on("click",".md-htmlblock-container",function(e){var t=(e.originalEvent.path||[])[0]||e.target;if(o.undo.prepCursorSnap(i),u(t).closest("a[href]").length||!e.ctrlKey&&!e.metaKey){if(u(t).closest("a, summary, audio, video[controls]:not(.md-video-load-failed), area[href]").length)return;n&&Math.pow(n[0]-e.offsetX,2)+Math.pow(n[1]-e.offsetY,2)<16&&r.startEditing(u(this).parent(),"auto")}else r.startEditing(u(this).parent(),"auto");o.undo.endSnap()}).on("startedit",".md-htmlblock-container",function(e){r.startEditing(u(this).parent(),"auto")}).on("losefocus",".md-htmlblock",function(e){r.stopEditing(this.getAttribute("cid")),document.activeElement==o.writingArea||document.activeElement&&document.activeElement.closest&&document.activeElement.closest(".md-htmlblock")||o.selection.scrollAdjust()}).on("endfocus",".md-htmlblock",function(e){r.dropEditing()}).on("mouseenter","video",function(e){var t=this;t.error&&t.error.message&&-1<t.error.message.indexOf("ERR_CACHE_OPERATION_NOT_SUPPORTED")&&(t.previousElementSibling&&t.parentElement.removeChild(t.previousElementSibling),t.classList.remove("md-video-load-failed"),t.load()),t.error||t.setAttribute("controls","controls")}).on("mouseleave","video",function(e){this.error||this.removeAttribute("controls")}).on("click",".md-rawblock-tooltip-edit-btn",function(e){u(e.target).closest(".md-rawblock").find(".md-rawblock-container").trigger("startedit"),u(".ty-tooltip").removeClass("shown")}).on("mouseenter",".md-htmlblock-container",function(e){File.isWK&&(e=o.contextMenu.getMenuItemsForMac(e.target,!0),window.bridge.callHandler("contextMenu.setItems",e))}).on("mouseleave",".md-htmlblock-container",function(e){File.isWK&&window.bridge.callHandler("contextMenu.setItems",[])}).on("click",".md-rawblock-tooltip-ok-btn",o.finishRawBlockEdit.bind(o)),File.isMac&&u("#write").on("mouseenter",".md-rawblock-tooltip",function(){u(this).closest(".md-rawblock").addClass("ty-hover")}).on("mouseleave",".md-rawblock-tooltip",function(){var e=u(this).closest(".md-rawblock");setTimeout(function(){e.removeClass("ty-hover")},100)})}resetVideoDom(e){e.classList.remove("md-video-load-failed"),u(e).prev(".md-htmlblock-panel-placeholder").remove()}getCidAndElem(e){var t=e,n=e;return"string"==typeof e?n=this.editor.findElemById(t):t=n.attr("cid"),[t,n]}beforeDeleteFences(e){this.syncToNode(e),this.dropEditing(),this.currentCm=void 0}syncToNode(e){e="string"==typeof e?this.editor.getNode(e):e;return(this.currentCm||{}).cid===e.cid&&e.set("text",this.currentCm.getValue()),e}dropEditing(){var e,t;this.currentCm&&(e=this.editor.findElemById(this.currentCm.cid),t=this.editor.getNode(this.currentCm.cid),e.find(".md-htmlblock-panel").html("").hide(),e.replaceWith(t.toHTML()),this.currentCm=void 0)}stopEditing(e,t){var n,i,r,o,a;this.currentCm&&(e=e||this.currentCm.cid,this.currentCm.cid===e)&&((e=this.editor.getNode(this.currentCm.cid))?(n=this.editor.findElemById(e.cid),i=this.editor,o=this.currentCm,n.removeClass("md-rawblock-on-edit"),b?((r=s.makeEmptyCommand()).undo.push({type:"fences-pos",pos:o.getCursor(),id:o.cid}),r.undo.push(s.buildReplaceUndo(e)),this.syncToNode(e),a=(o=e.parseFrom({noTop:!e.get("attachTo"),skips:{old_code:!1,pass_format:!0}}))[1],r.redo.push(s.buildReplaceUndo(e)),1<a.length&&(a=a.slice(1),s.addUndoForInsertArray(r,a,e)),this.currentCm=null,n.replaceWith(o[0]),this.refreshUnder(e.cid),t&&i.selection.jumpToNextBlock(e,r),i.undo.register(r),setTimeout(function(){r.redo.push(i.selection.buildUndo())},100)):(this.currentCm=null,this.syncToNode(e),n.find(".md-htmlblock-panel").hide().html(""),n.find(".md-rawblock-container").show(),this.refreshUnder(n[0]))):this.currentCm=void 0)}refreshUnder(e){(e=(e?"string"==typeof e?this.editor.findElemById(e)[0]:e:document).querySelectorAll("iframe.md-html-iframe")).length&&e.forEach(function(e){e.contentWindow.postMessage("syncHeight","*")})}startEditing(e,t){if(!File.isLocked){var n,i,e=this.getCidAndElem(e),r=e[0],e=e[1],o=this.editor,a=this.editor.getNode(r),s=function(e){var t=o.getNode(e.cid),n=o.undo.UndoManager,i=n.makeEmptyCommand();o.htmlBlock.beforeDeleteFences(e.cid),i.undo.push({type:"fences-pos",pos:e.getCursor(),id:e.cid}),n.append(i,o.UserOp.backToParagraph(o,t,!1)),o.undo.register(i)};if(r){if(this.currentCm&&this.currentCm.cid===r){if(o.writingArea.contains(this.currentCm.getWrapperElement()))return this.currentCm.focus(),this.currentCm;this.currentCm=null}return this.currentCm&&(this.stopEditing(this.currentCm.cid),window.getSelection().removeAllRanges()),e.find(".md-htmlblock-panel").show().html('<div class="md-rawblock-input md-rawblock-control" contenteditable="false"></div>'),e.find(".md-rawblock-container").hide(),e.addClass("md-rawblock-on-edit"),this.currentCm=(n=this.editor,b=!1,c=a.get("text"),(i=d(e.find(".md-rawblock-input")[0],{styleSelectedText:!0,styleActiveLine:!0,lineWrapping:!File.option.noLineWrapping,maxHighlightLength:1/0,viewportMargin:1/0,mode:"htmlmixed",placeholder:u.localize.getString("Input HTML here"),theme:" inner null-scroll",autoCloseBrackets:!0,autoCloseTags:!0,value:c,lineNumbers:!1,resetSelectionOnContextMenu:!0,dragDrop:!1,indentUnit:File.option.codeIndentSize,tabSize:File.option.codeIndentSize,lineWiseCopyCut:File.option.lineWiseCopyCut},n,r)).on("blur",function(e){setTimeout(function(){document.body.contains(e.getWrapperElement())&&a.set("text",e.getValue())},0)}),i.on("focus",function(e){n.refocus(i.cid)}),i.on("changes",function(e,t){n.fences.handleUserReplacement(e,t),n.wordCount.quickUpdate(i.cid),n.selection.clearGlobalColumn(),b=!0,File.isTypeWriterMode&&!File.option.scrollWithCursor&&n.selection.typeWriterScroll(i.cursorCoords(i.getCursor()))}),i.on("cursorActivity",function(){n.fences.handleCursorActivity(i)}),i.on("keydown",function(e,t){n.fences.onKeyDown(e,t,n,s,l)}),i),(e=this.currentCm).focus(),e.execCommand("goDocEnd"),o.selection.scrollAdjust(),t&&("start"==t?this.currentCm.execCommand("goDocStart"):"end"==t?this.currentCm.execCommand("goDocEnd"):"auto"==t&&this.findPos(this.currentCm),this.editor.refocus(a.id)),this.currentCm}}function l(e,t){if((!(i=(n=e).doc.getCursor())||n.doc.indexFromPos(i)>=n.doc.getValue().length)&&(t.ctrlKey||t.metaKey||!t.shiftKey&&function(e){for(var t,n,i=0;e;){if(!t){if(!(t=((n=m.exec(e))||[])[1])||-1<g.indexOf(t.toLowerCase()))break;i=0}if(!(n=v(t).exec(e)))break;e=e.substring(n[0].length),n[2]?i--:n[1]||i++}return i<=0}(e.getValue())))return setTimeout(function(){o.UserOp.insertParagraph()},20),t.preventDefault(),t.stopPropagation(),!0;var n,i}}findPos(e){var t=e.lineCount();3<=t?e.setCursor(t-2,e.getLine(t-2).length):2==t?e.setCursor(t-1,0):e.setCursor(t-1,e.getLine(t-1).length)}listenMessage(){var n=this.editor;window.addEventListener("message",function(e){var e=e.data,t=n.findElemById(e.cid).find("iframe")[0];"changeHeight"==e.msg&&(t.height=e.height),"startEditing"==e.msg&&u(t).closest(".md-rawblock-container").trigger("startedit"),"contextmenu"==e.msg&&File.isNode&&C(t,e.event),"mousedown"==e.msg&&File.isNode&&File.editor.contextMenu.hide()},!1)}}w.allowWhiteList=function(){var e;return void 0===n&&(e=document.createElement("iframe"),n=void 0!==e.srcdoc,e.remove()),n};var x={FORBID_ATTR:[],ADD_ATTR:["async","srcdoc","class","alt","for","title","charset"],FORBID_TAGS:[],ADD_TAGS:["iframe","dialog","footer","style","template","svg"],ALLOW_DATA_ATTR:!0,ALLOW_UNKNOWN_PROTOCOLS:!0,forHTMLBlock:!0,forPrint:!0},C=(window.reqnode&&(x.ADD_TAGS.remove("iframe"),x.FORBID_TAGS.push("iframe")),w.INLINE_CONFIG={ADD_TAGS:[],FORBID_TAGS:["iframe","dialog","embed","footer","object"],ALLOW_UNKNOWN_PROTOCOLS:!0,ADD_ATTR:["controls","allowfullscreen","ty-id","ty-class"]},w.getDomPurifyConfig=function(e){return Object.assign({FORBID_ATTR:["class","contenteditable","cid","id","loop","autoplay","preload"],ADD_ATTR:["allowfullscreen","async","charset","srcdoc","controls"],ADD_TAGS:["iframe","dialog","footer"],FORBID_TAGS:["head","style"],ALLOW_DATA_ATTR:!1,RETURN_DOM:!0,ALLOW_UNKNOWN_PROTOCOLS:!0,USE_PROFILES:{html:!0,svg:!0,svgFilters:!0,mathMl:!0}},e)},function(e,t){var n=u(e),i=n.offset(),e=new u.Event("contextmenu",{target:e,currentTarget:e,clientY:i.top+t.clientY,clientX:i.left+t.clientX});n.trigger(e)}),F=(window.loadedWebview=function(n){function t(){n.previousElementSibling&&n.previousElementSibling.classList.contains("md-htmlblock-panel-placeholder")&&n.parentElement.removeChild(n.previousElementSibling)}n._eventBind||(t(),n.addEventListener("did-start-loading",function(){t();var e=document.createElement("div");e.setAttribute("class","md-htmlblock-panel-placeholder"),e.innerHTML='<div class="ty-lds-spinner"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div>',n.parentElement.insertBefore(e,n)}),n.addEventListener("did-stop-loading",t),n.addEventListener("console-message",function(e){3===e.level&&console.error(e.sourceId+e.line,e.message)}),n.addEventListener("did-fail-load",function(e){n.previousElementSibling.textContent=e.errorDescription+"  "+e.validatedURL}),n.addEventListener("context-menu",function(e){var t=u(n),e=new u.Event("contextmenu",{target:n,currentTarget:n,clientY:e.params.y,clientX:e.params.x});t.trigger(e)}),n._eventBind=!0)},window.remoteOnLoad=function(t){function n(t){var e,n,i=(i=t).src&&/\.pdf/i.exec(new URL(i.src).pathname);D(t)&&(t.contentDocument.documentElement.oncontextmenu=function(e){C(t,e)},t.contentDocument.documentElement.addEventListener("mousedown",function(e){File.editor.contextMenu.hide()}),""==t.height)&&t.contentDocument&&t.contentDocument.body&&(e=t.contentWindow.innerHeight,(n=t.contentDocument.body.scrollHeight)!=e||i&&4<t.contentDocument.body.childElementCount?t.height=Math.min(n,600):(t.height=24,t.height=t.contentDocument.body.scrollHeight),t.dataset.userHeight=t.height)}t.classList.contains("md-html-iframe")||t.previousElementSibling&&(t.previousElementSibling.classList.contains("md-htmlblock-panel-placeholder")&&t.parentElement.removeChild(t.previousElementSibling),File.isNode&&t.contentDocument?t.contentDocument.body?n(t):t.contentDocument.addEventListener("DOMContentLoaded",function(e){n(t)}):t.removeAttribute("guest-id"),P(t))},document.querySelector("#md-htmlblock-panel-novideo-templ").text),S=document.querySelector("#md-htmlblock-panel-nohtml-templ").text;function k(e,t){var n=e.previousElementSibling;t=t.replace("http://typora-app","Typora.app").replace(/^typora:.+/,"")||"blank",n||((n=document.createElement("div")).classList.add("md-htmlblock-panel-placeholder"),e.parentElement.insertBefore(n,e)),n.innerHTML=S,n.querySelector(".md-resouce-error-message").textContent=t,e.height=Math.max(+(e.height||0),48)}window.videoOnError=function(e){var t=document.createElement("div");t.setAttribute("class","md-htmlblock-panel-placeholder"),t.innerHTML=F,t.querySelector(".md-resouce-error-message").textContent=e.src.replace("http://typora-app","Typora.app").replace(/^wkfile:/,"file:").replace(/^typora:.+/,"")||"blank",e.parentElement.insertBefore(t,e),e.classList.add("md-video-load-failed")};var E=function(e){var t;return!!w.allowWhiteList()&&1==(t=e.querySelectorAll("script")).length&&t[0].parentElement==e&&A(t[0].getAttribute("src"))},T=(w.checkIsWhiteList=function(e){if(!w.allowWhiteList())return!1;if("script"==e.get("style")){e=e.get("text"),(t=document.createElement("template")).innerHTML=e;e=t.content;if(1==e.childElementCount)return"SCRIPT"==(t=e.firstElementChild).tagName&&A(t.getAttribute("src"))}var t},{gist:/^https:\/\/gist\.github\.com\/.*\.js/,jsfiddle:/^https:\/\/jsfiddle\.net\/[a-z0-9]+\/[a-z0-9]+\/embed\/$/i}),_=["https://platform.twitter.com/widgets.js","https://static.codepen.io/assets/embed/ei.js","https://cssdeck.com/assets/js/embed.js","https://www.instagram.com/embed.js","https://s.imgur.com/min/embed.js","https://speakerdeck.com/assets/embed.js"];function A(e){e=/^\/\//.exec(e=e||"")?"https:"+e:e.replace(/^http:/,"https:");try{e=new URL(e).href}catch(e){}return-1<_.indexOf(e)||!!T.gist.exec(e)}var M=new DOMParser;function L(e,t,n){var i=(M.parseFromString("<body>"+e+"</body>","text/html")||{}).body;return i||((i=document.createElement("body")).innerHTML=e),t&&E(i)?(t.whitelistMode=!0,t.ADD_TAGS?t.ADD_TAGS.push("script"):t.ADD_TAGS=["script"],t.FORBID_ATTR=["contenteditable"],t.ALLOW_DATA_ATTR=!0,i.classList.add("md-preview-body")):n||(i.querySelectorAll("[role='wrapper']").forEach(function(e){e.removeAttribute("role")}),i.querySelectorAll("iframe, video").forEach(function(e){var t=document.createElement("div");t.setAttribute("role","wrapper"),e.parentElement.replaceChild(t,e),t.appendChild(e)})),i}var N=2;r.addHook("beforeSanitizeElements",function(e){return e.id&&e.setAttribute("ty-id",e.id),e}),r.addHook("afterSanitizeAttributes",function(e,t,n){var i,r,o=e&&e.nodeType==e.ELEMENT_NODE&&e.style;if(o&&(i=e.getAttribute("src"),/^\/\//.exec(i||"")&&e.setAttribute("src","https:"+i),r=e.getAttribute("href"),/^\/\//.exec(r||""))&&e.setAttribute("href","https:"+r),!n.whitelistMode&&(o&&(n.forHTMLBlock?e.parentElement&&"BODY"==e.parentElement.tagName&&"none"==e.style.display&&(e.style.display=""):h.isType(e.style.display,"inline","inline-block")||(e.style.display=""),n.forHTMLBlock&&!h.isType(e.style.position,"fixed","sticky","absolute")||(e.style.position="")),n.forHTMLBlock)){if(o){if(h.isType(e.tagName.toLowerCase(),"iframe")){if(n.forPrint||e.setAttribute("guest-id",++N),(i=e.getAttribute("src"))&&e.setAttribute("src",i.replace(/^\/\//,"https://")),"iframe"==e.tagName.toLowerCase()){if(e.setAttribute("allow-top-navigation","false"),e.setAttribute("allow-forms","false"),e.setAttribute("allowfullscreen","true"),e.setAttribute("allow-popups","false"),e.srcdoc)return void e.setAttribute("sandbox","");/^data:/.exec(i)&&File.isMac?e.setAttribute("sandbox","allow-scripts allow-same-origin"):/^(https?)?:[\\\/]/.exec(i)?File.isMac||/^https?:/.exec(i)?e.setAttribute("sandbox","allow-scripts allow-same-origin allow-popups"):e.setAttribute("sandbox","allow-scripts"):e.setAttribute("sandbox","allow-same-origin"),/^typora/.exec(i)&&(e.src=i="about:blank"),n.forPrint||e.setAttribute("onLoad","window.remoteOnLoad && window.remoteOnLoad(this)"),i=e.getAttribute("src"),File.editor.imgEdit&&!/[a-z]+:/.exec(i)&&(e.src=File.editor.imgEdit.getAbsolutePath(i,!0))}n.forPrint||"wrapper"!=e.parentElement.getAttribute("role")||((r=document.createElement("div")).setAttribute("class","md-htmlblock-panel-placeholder"),r.innerHTML='<div class="ty-lds-spinner"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div>',e.parentElement.insertBefore(r,e))}h.isType(e.tagName.toLowerCase(),"video","audio","img","source")&&(i=e.getAttribute("src"))&&(r=(o=e).getAttribute("src"),o.dataset.src=r,File.editor.imgEdit)&&(r=File.editor.imgEdit.getAbsolutePath(r,!0),a.fromExternalPath(r)&&(r=a.file2wkfile(r)),o.src=r),h.isType(e.tagName.toLowerCase(),"video")&&(n.forPrint||(e.setAttribute("controlsList","nodownload"),e.setAttribute("onError","window.videoOnError(this)")),e.getAttribute("poster"))&&e.setAttribute("poster",editor.imgEdit.getAbsolutePath(e.getAttribute("poster"),!0)),!n.forPrint&&h.isType(e.tagName.toLowerCase(),"audio")&&(e.setAttribute("controlsList","nodownload"),e.setAttribute("controls",""))}return e}}),document.querySelector("#ty-resize-temp");function D(e){if(File.isNode)return e.contentDocument;try{return e.contentDocument}catch(e){}return null}function P(e){e&&!e.srcdoc&&e&&(D(e)||{}).body&&(0!==e.src.indexOf(e.contentWindow.location.protocol)&&("about:blank"==e.contentWindow.location.href&&k(e,e.src),e.contentDocument.body.childNodes.length+e.contentDocument.head.childNodes.length==0)&&k(e,e.src),e.removeAttribute("guest-id"))}window.turnOnIframeRefreshTimer=function(e,t){setTimeout(function(){P(document.querySelector("iframe[guest-id='"+e+"']"))},2e3)},w.UNSFAE_TAGS=["script","video","audio","iframe","img","source","form","object","embed","applet","body","frameset","input","link"],w.convertToXHTML=function(e){try{var t=(new DOMParser).parseFromString(e,"text/html");return(new XMLSerializer).serializeToString(t)}catch(e){}return e},w.buildHTMLForExport=function(e,a,s,l){var t,n;return s?/\s*^<(div)[^>]*\/>\s*$/.exec(e)?e.replace(/\/>\s*/,"></div>"):/^(<\/?(div|p)[^>]*>\s*)+$/.exec(e)?e:(n=L(e,t=w.getDomPurifyConfig(x),!0)).firstChild?((n=r.sanitize(n,t)).querySelectorAll("iframe, video, audio, img").forEach(function(e){var t=e.getAttribute("src");if(/^\/\//.exec(t)?e.src="https:"+t:s&&t&&(e.src=window.addDateQuery(a.imgEdit.getAbsolutePath(t,!0)),"iframe"!=e.tagName.toLowerCase())&&e.setAttribute("onError","this.style.display = 'none';"),s&&"iframe"==e.tagName.toLowerCase()&&(e.setAttribute("sandbox",""),e.setAttribute("allow-popups","false"),/^https?:/.exec(e.src))&&e.setAttribute("sandbox","allow-scripts"),"video"==e.tagName.toLowerCase())if(!0===s&&l){t=a.findElemById(l.cid).find("video");if(1===t.length&&t[0].videoHeight){t=a.imgEdit.getAbsolutePath(t[0].getAttribute("poster"),!0)||w.getVideoScreenshot(t[0]);if(!(9e4<t.length)){var n=e.attributes,i=e.parentElement,r=Array.prototype.indexOf.call(i.childNodes,e);e.outerHTML="<img />",e=i.children[r];for(var o=n.length-1;0<=o;o--)e.setAttribute(n[o].name,n[o].value);e.src=t}}}else"epub"===s&&(e.removeAttribute("controls"),e.removeAttribute("controllist"))}),n.innerHTML):"":e},w.buildHTML=function(a){var e,t,n=w.getDomPurifyConfig({forHTMLBlock:!0}),i=L(a.get("text"),n);return i.firstChild?(i=r.sanitize(i,n)).classList.contains("md-preview-body")?(n=document.createElement("iframe"),e=i.innerHTML,t=a.cid,n.classList.add("md-html-iframe"),n.sandbox="allow-same-origin allow-scripts allow-popups",n.setAttribute("seamless","seamless"),n.setAttribute("allow-top-navigation","false"),n.setAttribute("allow-forms","false"),n.setAttribute("allowfullscreen","true"),n.height=20,n.srcdoc="<html><head><script>window.reqnode = undefined;window.require = undefined;<\/script><style type='text/css'>iframe {margin: auto;}</style></head><body>"+e+"<script>"+B.replace(/\s*\n\s*/g,"")+"\niframePreloadScript('"+t+"');<\/script></body></html>",e=n.outerHTML,n.remove(),e):(i.querySelectorAll("iframe").forEach(function(e){var t=+e.getAttribute("guest-id");if(File.isNode){var n,i=document.createElement("webview");for(n in i.setAttribute("partition","iframe"),e.replaceWith(i),i.src=e.src,e.attributes){var r=e.attributes.item(n);i.setAttribute(r.name,r.value)}var o=document.createElement("script");o.innerHTML=`var w = document.querySelector("[guest-id='${t}']");loadedWebview(w);`,i.parentElement.appendChild(o),e.height&&(i.style.height=e.height+"px"),i.setAttribute("webpreferences","webViewGuestId="+t+", webviewTag=no,disableDialogs=true"),i.setAttribute("autosize","autosize"),i.setAttribute("nodeintegration",!1)}else(t=+e.getAttribute("guest-id"))&&!isNaN(t)&&((o=document.createElement("SCRIPT")).setAttribute("data-run","true"),o.type="text/javascript",o.text="turnOnIframeRefreshTimer("+t+", '"+a.cid+"')",e.parentElement.appendChild(o))}),i.innerHTML):""},w.getVideoScreenshot=function(e){var t=document.querySelector("#video-canvas"),n=t.getContext("2d");t.width=e.videoWidth,t.height=e.videoHeight;try{return n.drawImage(e,0,0,e.videoWidth,e.videoHeight),t.toDataURL()}catch(e){console.warn(e)}return""};var B=document.querySelector("#md-html-iframe-preload-temp").innerHTML;w.autoCloseTagWhenInput=function(n,e,i,r,o,a){function t(e){o&&n.undo.register(o);var t=document.createTextNode("/"+e+">");return a.insertNode(t),t.parentElement.normalize(),t=e.length+2,e=n.selection.rangy.createRange(),r.end+=t,r.start+=t,e.moveToBookmark(r),e.select(e.isBackward),o&&o.redo.push(n.selection.buildUndo()),n.undo.addSnap(i.cid,l.REPLACE),!0}return 0!=("/"===e&&a.startContainer.nodeType===document.TEXT_NODE&&"<"===a.startContainer.nodeValue.substring(a.startOffset-1,a.startOffset)&&void 0)&&(e=function(){var e=u(a.startContainer.parentElement).prev("[md-inline='tag']").text();if(e&&!/\/>/.exec(e))return e=(/<([A-Za-z1-9]+)/.exec(e)||[])[1],-1<f.indexOf(e)?e:void 0}())?t(e):void 0},w.prototype.autoCloseTagWhenInput=w.autoCloseTagWhenInput,w.BLOCK_OPEN_REG=m,w.INLINE_TYPE=e,w.ALL_INLINE_TYPE=i,w.HIDDEN_TYPE=o,w.NO_TEXT_BLOCK_TYPE=["html","body","script","style","meta","noscript","template","head","canvas","link"],w.BLOCK_TYPE=p,w.autoCloseTag=function(e){var t=e.get("text"),n=(/^[ \t]+/.exec(t)||[""])[0],i=e.get("style"),r=e.get("depth");if(!(-1<g.indexOf(i))){for(r&&(t+="\n"+n+" ".repeat(File.option.codeIndentSize));r;)r--,t+="\n"+n+"</"+i+">";e.set("text",t),e.set("depth",0)}},w.getHTMLTagReg=v,window.DOMPurify=r,t.exports=w}),$__System.registerDynamic("52",["11","13","46","19","17","e"],!0,function(e,t,n){"use strict";this||self;var u=e("11"),i=e("13"),P=i.Node,B=i.TYPE,R=(i.NodeCollectionUtils,e("46")),h=e("19"),O=e("17"),I=e("e"),$=["CONTENT","HEADER","FOOTER","ARTICLE","SECTION","DIV","P","BLOCKQUOTE","PRE","UL","OL","TABLE","HR","H1","H2","H3","H4","H5","H6","DL","DT","DD","TBODY","THEAD","TFOOT","ASID","LI","HTML","BODY","IFRAME","STYLE","SCRIPT","FIGURE","VIDEO","AUDIO"],H=["TITLE","SELECT","TEXTAREA","INPUT","BUTTON","SELECT","SCRIPT","CANVAS","META","PROGRESS","HEAD","EMBED","STYLE","TEMPLATE","LINK","NOSCRIPT","MENU","EMBED","OBJECT"],U=function(e){var t,e=e.find(".gist-file>.gist-data .blob-wrapper");return e.length?(t=e.find(".blob-code.blob-code-inner").map(function(){return this.textContent}).toArray().join("\n"),e=/\stype-([^\s]+)/.exec(e.attr("class")||["",""])[1],{type:B.fences,text:t,lang:e="text"==e?"":e}):null},r=/^\s*<(iframe|div|p|table|details|figure|img|a|video|audio|script|style|meta|svg|pre|code)(\s|\/?>)/,o=/(\S.*\|.*)\n *([-:]+ *\|[-| :]*)\n((?:.*\|.*(?:\n|$))*)/,a=/\|(.+)\n *\|( *[-:]+[-| :]*)\n((?: *\|.*(?:\n|$))*)/,s={NORMAL:"normal",HTML:"html"},j=function(e,t,a,s,l){function c(e){var t=["",e,""],n=/^(\s*)/.exec(e);return n&&(e=e.substring(n[0].length),t[0]=n[0]),(n=/(\s*)$/.exec(e))&&(e=e.substring(0,e.length-n[0].length),t[2]=n[0]),t[1]=e,t}a=a||File.editor,function e(t){var n,i,r,o;t.find("img").each(function(){var e;(n=I(this)).text("!["+(n.attr("alt")||n.attr("title")||"img").replace(/\r?\n/gi," ")+"]("+(e=n.attr("src")||"",File.isMac&&(0==e.indexOf("file:///")&&-1==e.substring("file:///".length).indexOf("/")?(e=e.substring("file:///".length),(e=u.getAbsoluteURL(s,e))&&l&&l[e]&&(e=l[e])):0!=e.indexOf("webkit-fake-url:")||File.isMacWK||(e=bridge.callSync("images.convertFakeUrl",e))),e=-1==e.indexOf(":/")&&a&&a.imgEdit?a.imgEdit.resolveImagePath(e):e)+")"),n.replaceWith(n[0].childNodes[0])}),t.find("strong, b").each(function(){n=I(this),"normal"!==this.style.fontWeight&&(e(n),(o=c(n.text()))[1]=o[1]?"**"+o[1].replace(/([^\\])\*/g,"$1\\*")+"**":"",n.replaceWith(o.join("").replace(/</g,"&lt;").replace(/>/g,"&gt;")))}),t.find("em, i").each(function(){e(n=I(this)),(o=c(n.text()))[1]=o[1]?"*"+o[1].replace(/([^\\*])\*([^*])/g,"$1\\*$2")+"*":"",n.replaceWith(o.join("").replace(/</g,"&lt;").replace(/>/g,"&gt;"))}),t.find("code, pre, tt").each(function(){(n=I(this)).replaceWith("`"+n.text().replace(/</g,"&lt;").replace(/>/g,"&gt;")+"`")}),t.find("del, strike").each(function(){e(n=I(this)),n.replaceWith("~~"+n.text()+"~~")}),t.find("span").each(function(){n=I(this),0!=(this.style.fontWeight||"").indexOf("bold")&&700!=this.style.fontWeight&&900!=this.style.fontWeight||(e(n),(o=c(n.text()))[1]=o[1]?"**"+o[1].replace(/([^\\])\*/g,"$1\\*")+"**":"",n.replaceWith(o.join("").replace(/</g,"&lt;").replace(/>/g,"&gt;"))),"italic"==this.style.fontStyle&&(e(n),(o=c(n.text()))[1]=o[1]?"*"+o[1].replace(/([^\\*])\*([^*])/g,"$1\\*$2")+"*":"",n.replaceWith(o.join("").replace(/</g,"&lt;").replace(/>/g,"&gt;")))}),t.find("br").each(function(){(n=I(this)).replaceWith("")}),t.find("a[href]:not(:empty)").each(function(){e(n=I(this)),i=u.getAbsoluteURL(s,u.decodeFromEscapedPath(n.attr("href"))),0==(r=n.text()).length?n.replaceWith(""):i==r&&/^(https?|mailto):/.exec(i)?n.replaceWith(i.replace(/</g,encodeURI("<")).replace(/>/g,encodeURI(">"))):n.replaceWith("["+r.replace(/([^\\])]([^(]|$)/,"$1\\]$2").replace(/\r?\n/gi," ")+"]("+i+")")}),File.option.highlight&&t.find("mark").each(function(){e(n=I(this)),n.replaceWith("=="+n.text().replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/([^\\])\=/,"\\=")+"==")})}(e);e=(e[0].innerText||e[0].textContent||"").replace(/(^[\r\n]+)|([\r\n]+$)/g,"").replace(/([\r\n]|\u00a0)\s?/gi," ");return t?e.split(/\uE033/g):e.replace(/\uE033/g," ")},l=(t.parseInlineHTML=function(e,t,n,i){var r=I(I.parseHTML("<div>"+e+"</div>")[0]);r.find("head, meta, script, css, .gutter, style, title, template, wbr, menu").remove(),r[0].normalize&&r[0].normalize();for(var o=0;o<r[0].childNodes.length;o++){var a=r[0].childNodes[o];a.nodeType==a.TEXT_NODE?/^[\s\r\n]*$/.exec(a.textContent)&&(a.remove(),o--):a.nodeType!==a.ELEMENT_NODE&&(a.remove(),o--)}return j(r,void 0,t,n,i)},new i.NodeMap);t.getMarkElemFromCurrentHtml=function(e,t,n){/^\<(tbody|thead)/.exec(e)&&(e="<table mdtype='table'>"+e+"</table>"),/^\<tr\s/.exec(e)&&/\<\/tr\>\s*$/.exec(e)&&(e="<table mdtype='table'>"+e+"</table>");var i,r,o,a,e=I(I.parseHTML("<div>"+e+"</div>"));return e=e,r=n,i=(i=t)||File.editor,e.find(".md-header-span").replaceWith(function(){var e,t=I(this).prev();if(t.length)return e=t.text().trim().length,t.remove(),t.next().remove(),"<h"+e+" mdtype='heading'>"+this.innerHTML+"</h"+e+">"}),e.find(".math-jax-postprocess svg").remove(),e.find(".md-fences").toArray().map(function(e){o=e.getAttribute("cid"),(a=I(e)).attr("lang",a.attr("lang")||""),o&&a.text(i.fences.getValue(o))}),void 0===(r=r||{}).root&&(r.root=File.editor.imgEdit.getLocalRootUrlForInsert()||""),r&&r.skipEmoji||e.find(".md-emoji").toArray().map(function(e){(a=I(e)).text(":"+a.attr("data-content")+":")}),e.find("[md-inline='image'], [md-inline='imgtag']").toArray().map(function(e,t){e.setAttribute("data-root",r.root||File.bundle.filePath||""),t||e.setAttribute("data-copy-from-path",File.bundle.filePath||"")}),e.find("img[data-real-src]").attr("src",function(){return this.dataset.realSrc}),e.find("[mdtype='math_block']").toArray().map(function(e){o=e.getAttribute("cid"),(a=I(e)).text(i.mathBlock.getTex(o))}),e.find("[mdtype='html_block']").toArray().map(function(e){o=e.getAttribute("cid");var t=i.getNode(o);(a=I(e)).text(t&&t.get("text"))}),e.find(".md-math-after-sym").remove(),(n=e.children("li[cid]")).length&&((t=I(document.querySelector("[cid='"+n[0].getAttribute("cid")+"']").parentElement).clone()).empty().append(n).wrap("div"),e=t.parent()),e.find("[cid]").each(function(){var t=i.getNode(this.getAttribute("cid")),n=this;["pattern","patternEnd","prespace","markindent","isFixed","ahead","tail"].forEach(function(e){t&&t.get(e)&&n.setAttribute(e,t.get(e))})}),e.children("br").replaceWith("\n"),e},t.getBlocksFromMarkHtml=function(e,t,n,i){t||(l.reset(!0),t=l);var r,o=e,a=(o.jquery?o.html():o=I(I.parseHTML("<div>"+e+"</div>")[0]),[]),e=o.children("[mdtype]");return e.length?(e.each(function(e){r=P.reverse(I(this),t,n,i),a.length?a.last().addAfter(r):r.unset("ahead"),a.push(r)}),r&&r.unset("tail"),a):n?(o.find("[data-emoji]").text(function(){return this.getAttribute("data-emoji")}),o.find(".md-meta, .md-content").remove(),o.find("sup, sub").text(function(){return" ("+this.textContent+")"}),File.option.convertSmartOnRender&&o.find("[md-inline='pants']").text(function(){return this.getAttribute("data-text")||this.textContent}),o.text()):o.rawText()},t.convertToPlain=function(e,t){function S(e,t){for(var n=(e instanceof Array?e[0]:e.sortedFirst()).getFirstBrother(),i=[],r=0;r<e.length;r++)i=i.concat(function e(t,n){var i,r=[],o=t.get("type");function a(e){return n?[e]:[e,""]}switch(o){case B.fences:r=t.get("text").replace(/\u200B/g,"").split("\n");for(var s=0;s<r.length;s++)r[s]="    "+r[s];return n||r.push(""),r;case B.list:var l=t.get("style"),c=Number.isNaN(Number.parseInt(t.get("start")))?0:Number.parseInt(t.get("start"))-1,d=t.get("children").length;if(d)for(var u=t.getFirstChild(),h=u,s=0;h;){var p=e(h,!0),f=P.getIndentPrefix(l,s+c,h,void 0,(d+"").length);p.map(function(e,t){p[t]=(t?" ".repeat(f.length):f)+p[t],r.push(p[t])}),s++,h=h.get("after")}return n||r.push(""),r;case B.table:for(var m,g,y,v,b,w=[],x=[],C=0,F=t.getFirstChild();F;){for(m=F.getFirstChild(),x[C]=[],g=0;m;)x[C][g]=m.toMark().trim(),m=m.get("after"),0===C&&(w[g]=4),w[g]=Math.max(x[C][g].length,w[g]),w[g]=Math.min(w[g],40),g++;F=F.get("after"),C++}for(C=0;C<x.length;C++){for(y="  ",g=0;g<w.length;g++)x[C][g]=x[C][g]||"",v=Math.max(w[g]-x[C][g].length,0),b=t.get("align")[g],y=y+("right"==b?" ".repeat(v)+x[C][g]:"center"==b?" ".repeat(b=~~(v/2))+x[C][g]+" ".repeat(v-b):x[C][g]+" ".repeat(v))+"\t";r.push(y.replace(/\s$/,""))}return n||r.push(""),r;case B.hr:return a("---");case B.def_link:return i="["+t.get("ref")+"]: "+t.safeGetStrAttr("href")+(t.safeGetStrAttr("title").length?'\t"'+t.get("title")+'"':""),P.isType(t.get("after"),B.def_link)?[i]:a(i);case B.def_footnote:return i="["+t.get("ref")+"]: "+t.get("text"),P.isType(t.get("after"),B.def_footnote)?[i]:a(i);default:return t.get("children")&&0<t.get("children").length?S(t.get("children"),n):a(t.get("text"))}}(n,t)),n=n.get("after");return i}return S(e).join("\n")},t.parseHTML=function(e,S,k,E,T){var t=e,e=(t.jquery?t.html():t=I(I.parseHTML("<div>"+e+"</div>")[0]),[]);function _(e){var t=!1;2e3<(e=e||"").length&&(e=e.substring(0,2e3));try{t=(t=3<(e.match(/\n\s*(\!?\[|#{1,5}|>|```|([-+*]\s)|(\d+(\.|\))\s))/gm)||"").length||e.match(a)||e.match(o))?s.NORMAL:null}catch(e){}return t=(t=t||((t=r.exec(e))?s.HTML:null))||((t=6<(e.match(/(\/\w*>)|(\n\s+<)/g)||[]).length)?s.HTML:null)}function A(e,t,n){e.in=S,e&&e.text&&(e.text=e.text.replace(/\u200b/g,"").replace(/\u00a0/g," "));e=new P(e);return n.length?n.last().addAfter(e):t&&t.appendChild(e),n.push(e),e}function M(e,t,n){var i=[];if(t)for(var r=0;r<e[0].childNodes.length;r++)D(I(e[0].childNodes[r]),n,i);else P.isType(n,B.blockquote,B.list_item)?L(e,n,i):n.set("text",j(e,void 0,k,E,T))}function i(e,t,n){for(var i,r,o,a=[],s=null,l=0;l<e.length;l++){var c,d=e[l];(a=h.reDefLink.exec(d))?(s=null,A({type:B.def_link,ref:a[1],href:a[3],title:a[8]},t,n)):(a=h.reDefFootnote.exec(d))?(s=null,A({type:B.def_footnote,ref:a[1],text:(a[3]||"").trim()},t,n)):(a=h.reOL.exec(d))?(s=new P({type:B.paragraph,text:d,in:S}),h.quickParse(d,k.brush,s,!1,null,{id:s.cid,start:0,end:0}),(c=n.last())&&(i=c,r=s,o=void 0,P.isType(i,B.list))&&P.isType(r,B.list)&&(o||i.get("style")==i.get("style"))?(c.appendChildrenTillEnd(s.getFirstChild()),s.remove()):(n.length?n.last().addAfter(s):t&&t.appendChild(s),n.push(s)),s=null):null==s?s=A({type:B.paragraph,text:u.escapeHead(d)},t,n):d?s.set("text",s.get("text")+"\n"+u.escapeHead(d)):s=null}}function L(e,t,n){e.find("br").length?i(j(e,!0,k.baseURL,T),t,n):3==e[0].nodeType&&!e.text().trim().length||1==e[0].nodeType&&"BR"==e[0].tagName||i([j(e,void 0,k,E,T)],t,n)}var N={center:"center",left:"left",right:"right"};function D(e,r,o,i){var t,n,a,s,l=!(!(l=e)[0]||!l[0].tagName)&&(-1!=$.indexOf(l[0].tagName.toUpperCase())&&(t=!1,l.children().each(function(){t=t||this.tagName&&(-1<$.indexOf(this.tagName.toUpperCase())||"BLOCK"==this.style.display)}),t)||l[0].querySelector("video, div, p, tr, pre")),c=e[0].tagName;function d(e){var t=A({type:B.paragraph,text:e},r,o),n=(t.parseFrom(void 0,void 0,!0)||[])[1];n&&n.length&&(i&&1==n.length&&!o.length&&n[0].get("type")==B.html_block?i.push(e):(o.remove(t),o.splice.apply(o,[o.length,0].concat(n))))}if(!(e.data("skip")||-1<H.indexOf(c)||e[0].nodeType===document.COMMENT_NODE)){if(i&&i.length)i.push(("P"==c?"\n":"")+e.text());else if("BLOCKQUOTE"===c)M(e,l,f=A({type:B.blockquote},r,o));else if("LI"===c&&P.isType(r,B.list))M(e,l,f=A({type:B.list_item},r,o));else if("UL"===c||"OL"===c){var u=e[0];if(!u.children.length)return;if(1===u.children.length&&"LI"!==u.children[0].tagName&&("UL"===u.children[0].tagName||"OL"===u.children[0].tagName))return void D(I(u.children[0]),r,o,i);var h=[];u.children.forEach(e=>{if("UL"===e.tagName||"OL"===e.tagName){var t=e.previousElementSibling;if(t&&"LI"===t.tagName)return t.querySelector("ul, ol, div, p")||(t.innerHTML="<div>"+t.innerHTML+"</div>"),t.innerHTML+=e.outerHTML,void(h[h.length-1]=t.outerHTML)}"LI"!==e.tagName?((t=document.createElement("li")).innerHTML=e.innerHTML,h.push(t.outerHTML)):h.push(e.outerHTML)}),u.innerHTML=h.join(""),M(e,l,f=A({type:B.list,style:c.toLowerCase()},r,o))}else if("DL"===c)for(var p,f=A({type:B.list,style:"ul"},r,o),m=e.children(),g=f,y=[],v=0;v<m.length;v++)"DT"==m[v].tagName&&((p=A({type:B.list_item},g,y)).itemList=[],A({type:B.paragraph,text:j(I(m[v]),void 0,k,E,T)},p,p.itemList)),"DD"==m[v].tagName&&p&&A({type:B.paragraph,text:j(I(m[v]),void 0,k,E,T)},p,p.itemList);else if("TABLE"===c)(C=e.children().children("tr").add(e.children("tr"))).length&&(f=A({type:B.table},r,o),o=[],f.cols=1,f.set("align",Array(+f.cols).fill()),C.toArray().map(function(e){D(I(e),f,o)}),R.verify(f,f.cols,2,function(e,t){var n=t.split(/(\r|\n)+/);e.set("type",B.paragraph),e.clearChildren(),e.set("text",n[0]);for(var i=1;i<n.length;i++)n[i].trim().length&&A({type:B.paragraph,text:n[i]},r,o)}));else if("THEAD"===c||"TBODY"===c||"TFOOT"===c){for(var b=[e],w=e.next();w.length&&P.isType(w[0].tagName,"THEAD","TBODY","TFOOT");)b.push(w),w.data("skip",!0);e.wrap("<table></table>"),D(e.parent(),r,o)}else if("TR"===c&&P.isType(r,B.table)){var u=(C=e.children("th")).length;C=C.add(e.children("td")),r.cols=C.length>r.cols?C.length:r.cols,f=A({type:B.table_row,isHeader:u},r,o),o=[],C.toArray().map(function(e){D(I(e),f,o)})}else if("TD"!==c&&"TH"!==c||!P.isType(r,B.table_row))if("HR"===c)A({type:B.hr},r,o);else if(/H[1-6]/g.exec(c))A({type:B.heading,text:j(e,void 0,k,E,T),depth:e[0].tagName[1]},r,o);else if(e.hasClass("CodeMirror"))x=Array.from(e.find(".CodeMirror-line").map(function(){return this.textContent})).join("\n"),A({type:B.fences,text:x},r,o);else if("CODE"===c||"PRE"===c&&0==e.find("pre").length||"FIGURE"==c&&e.hasClass("highlight")){var x="",u=e.attr("class")+" "+e.children("code").attr("class"),C=e.attr("lang")||(/lang(?:uage)?\-([^\s]+)/.exec(u)||[])[1],u=e.find("tr");1<u.length?x=u.map(function(){return this.innerText}).toArray().join("\n"):(e.find("div, prev").each(function(){I(this).before("<br/>")}),x=e[0].innerText.replace(/(^\s*\n+)|([\r\n]+$)/g,""),/\n/.exec(x)||(e.find("br").each(function(){I(this).before("\n")}),x=e[0].innerText.replace(/(^\s*\n+)|([\r\n]+$)/g,""))),A({type:B.fences,text:x,lang:C},r,o)}else{if(P.isType((c||"").toUpperCase(),"VIDEO","AUDIO","IFRAME","DETAILS","SVG"))return e[0].style.position="",e[0].style.float="",x=e[0].outerHTML,A({type:B.html_block,text:x},r,o),x;if("SCRIPT"==c)return"";if("P"!=c&&l){if(l){if("DIV"==c)if(e.is(".gist")){if(u=U(e))return void A(u,r,o)}else if(!r&&/monospace/.exec(e[0].style.fontFamily)&&/pre/.exec(e[0].style.whiteSpace)){var l=!(C=e[0])||(s=!(a=[]),C.children.forEach(e=>{"DIV"==e.tagName?a.push(e.textContent):"BR"==e.tagName?a.push(""):e.nodeType==e.ELEMENT_NODE&&(s=!0)}),s)?null:a.join("\n");if(l&&_(l))return void d(l)}var F=[];if(Array.from(e[0].childNodes).forEach(function(e,t){e.nodeType==e.TEXT_NODE&&!e.nodeValue.trim().length||(e.nodeType==e.TEXT_NODE||-1<O.ALL_INLINE_TYPE.indexOf((e.tagName||"").toLowerCase())&&!e.querySelector("p, div, h1, h2, h3, h4, h5, table")?n?n.append(I(e)):"BR"!==e.tagName&&(n=I(e).wrap("<p></p>").parent()):e.nodeType==e.ELEMENT_NODE&&(n&&(D(n,r,o,F),n=null),"DIV"!=e.tagName||e.textContent||e.querySelector("img, video, audio, svg, iframe"))&&(D(I(e),r,o,F),0))}),F.length)return u=F.join("\n"),l=P.parseFrom(u,S,void 0,!0)[1],o.splice.apply(o,[o.length,0].concat(l)),u;n&&(D(n,r,o),n=null)}}else{x=e[0].innerText||e[0].textContent||"",e[0].style&&"pre"!==e[0].style.whiteSpace&&"line"!==e[0].style.whiteSpace&&(x=x.replace(/(^[\r\n]+)|([\r\n]+$)/g,"").replace(/[\r\n]/g," "));l=!r&&_(x);if(x=x.replace(/^[\r\n]+\s*/,"").replace(/\s*[\r\n]+$/,""),l?d(x):L(e,r,o),l)return x}}else f=A({type:B.table_cell,text:j(e,void 0,k,E,T)},r,o),"TH"===c&&(u=f,"TH"===(l=e)[0].tagName)&&(c=l.attr("style")||"",e=null,e=(c=/text\-align:([^;]+)($|;)/.exec(c))?N[c[1].replace(/;/g,"").trim()]||null:e)&&(c=l.prevAll("th").length,(u.get("parent").get("parent").get("align")||[])[c]=e);return null}}t.find("head, meta, css, .gutter, style, title, template, wbr, menu").remove(),t[0].normalize&&t[0].normalize();t=D(t,null,e);return t||(e.length&&(function e(t,n,i,r){var o,a=n,s=[];if(n&&n!==i){for(;a&&a!==i&&P.isType(a,B.paragraph)&&P.isEmptyBlock(a);)a=(o=a).get("after"),o.remove(),r&&r.splice(r.indexOf(o),1);for(n=a.get("before")||a,a=i;a&&a!==n&&P.isType(a,B.paragraph)&&P.isEmptyBlock(a);)a=(o=a).get("before"),o.remove(),r&&r.splice(r.indexOf(o),1)}for(a=n;a;){var l=null;if(P.isType(a,B.blockquote,B.list_item))e(0,a.getFirstChild(),a.getLastChild());else if(P.isType(a,B.fences)&&P.isType(a.get("before"),B.fences))s.push(a),a.head=a.get("before").head||a.get("before"),a.head.set("text",a.head.get("text")+"\n"+a.get("text"));else if(P.isType(a,B.list)&&0===a.get("children").length)a.set("type",B.paragraph);else if(P.isType(a,B.paragraph)&&(l=/^(`+)([\s\S]*?[^`])\1(?!`)\s*$/g.exec(a.get("text")))){a.set("type",B.fences),a.set("text",l[2]);continue}a=a.get("after")}s.map(function(e){r&&r.splice(r.indexOf(e),1),e.remove()})}(0,e[0],e.last(),e),1===e.length)&&P.isType(e[0],B.paragraph)?e[0].get("text"):e)}}),$__System.registerDynamic("26",[],!0,function(e,t,n){"use strict";this||self;for(var l={},c={16:!1,18:!1,17:!1,91:!1},i="all",d={"⇧":16,shift:16,"⌥":18,alt:18,option:18,"⌃":17,ctrl:17,control:17,"⌘":91,command:91},r={backspace:8,tab:9,clear:12,enter:13,return:13,esc:27,escape:27,space:32,left:37,up:38,right:39,down:40,del:46,delete:46,home:36,end:35,pageup:33,pagedown:34,",":188,".":190,"/":191,"`":192,"-":189,"=":187,";":186,"'":222,"[":219,"]":221,"\\":220},u=function(e){return r[e]||e.toUpperCase().charCodeAt(0)},h=[],p=1;p<20;p++)r["f"+p]=111+p;function f(e,t){for(var n=e.length;n--;)if(e[n]===t)return n;return-1}var m={16:"shiftKey",18:"altKey",17:"ctrlKey",91:"metaKey"};function o(e){var t,n,i,r,o,a=e.keyCode;if(-1==f(h,a)&&h.push(a),(a=93!=a&&224!=a?a:91)in c)for(n in c[a]=!0,d)d[n]==a&&(g[n]=!0);else{var s=e;for(p in c)c[p]=s[m[p]];if(g.filter.call(this,e)&&a in l)for(o=y(),i=0;i<l[a].length;i++)if((t=l[a][i]).scope==o||"all"==t.scope){for(n in r=0<t.mods.length,c)(!c[n]&&-1<f(t.mods,+n)||c[n]&&-1==f(t.mods,+n))&&(r=!1);(0!=t.mods.length||c[16]||c[18]||c[17]||c[91])&&!r||!1===t.method(e,t)&&(e.preventDefault?e.preventDefault():e.returnValue=!1,e.stopPropagation&&e.stopPropagation(),e.cancelBubble)&&(e.cancelBubble=!0)}}}function g(e,t,n){var i,r=v(e);void 0===n&&(n=t,t="all");for(var o=0;o<r.length;o++)i=[],1<(e=r[o].split("+")).length&&(i=b(e),e=[e[e.length-1]]),e=e[0],(e=u(e))in l||(l[e]=[]),l[e].push({shortcut:r[o],scope:t,method:n,key:r[o],mods:i})}for(p in d)g[p]=!1;function y(){return i||"all"}function v(e){return""==(e=(e=e.replace(/\s/g,"")).split(","))[e.length-1]&&(e[e.length-2]+=","),e}function b(e){for(var t=e.slice(0,e.length-1),n=0;n<t.length;n++)t[n]=d[t[n]];return t}function a(e,t,n){e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent&&e.attachEvent("on"+t,function(){n(window.event)})}a(document,"keydown",function(e){o(e)}),a(document,"keyup",function(e){var t,n=e.keyCode;if(0<=(e=f(h,n))&&h.splice(e,1),(n=93!=n&&224!=n?n:91)in c)for(t in c[n]=!1,d)d[t]==n&&(g[t]=!1)}),a(window,"focus",function(){for(p in c)c[p]=!1;for(p in d)g[p]=!1});var s=g;(n.exports=s).setScope=function(e){i=e||"all"},s.getScope=y,s.deleteScope=function(e){var t,n,i;for(t in l)for(n=l[t],i=0;i<n.length;)n[i].scope===e?n.splice(i,1):i++},s.filter=function(e){return!("SELECT"==(e.target||e.srcElement).tagName)},s.isPressed=function(e){return"string"==typeof e&&(e=u(e)),-1!=f(h,e)},s.getPressedKeyCodes=function(){return h.slice(0)},s.unbind=function(e,t){for(var n,i,r,o=[],a=v(e),s=0;s<a.length;s++){if(1<(n=a[s].split("+")).length&&(o=b(n),e=n[n.length-1]),e=u(e),void 0===t&&(t=y()),!l[e])return;for(i in l[e])(r=l[e][i]).scope===t&&function(e,t){if(e.length==t.length){for(var n=0;n<e.length;n++)if(e[n]!==t[n])return;return 1}}(r.mods,o)&&(l[e][i]={})}},void 0!==n&&(n.exports=s);s.map={3:"Enter",8:"Backspace",9:"Tab",13:"Enter",16:"Shift",17:"Ctrl",18:"Alt",19:"Pause",20:"CapsLock",27:"Esc",32:"Space",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"Left",38:"Up",39:"Right",40:"Down",44:"PrintScrn",45:"Insert",46:"Delete",59:";",91:"Command",107:"=",109:"-",127:"Delete",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'",63232:"Up",63233:"Down",63234:"Left",63235:"Right",63272:"Delete",63273:"Home",63275:"End",63276:"PageUp",63277:"PageDown",63302:"Insert"},s.functionKey=["Command","Ctrl","Shift","Alt","Home","End","PageUp","PageDown","CapsLock","Esc","PrintScrn","Insert","Pause"],s.isCommand=function(e){return 0<String.fromCharCode(e.which).length&&(e.ctrlKey||e.metaKey)}}),$__System.registerDynamic("29",["e","13","11","33","34","2f","52","26"],!0,function(e,t,n){"use strict";this||self;var s=e("e"),l=(e("13").Node,e("11")),c=e("33"),i=e("34"),d=e("2f"),r=e("52");e("26").map;function u(e,t,n){var i,r=e.cloneNode(!0),o=window.getComputedStyle(e);return e.querySelector("[*|href='#raphael-marker-block']")&&!e.querySelector("#raphael-marker-block")&&r.querySelector("defs").appendChild(document.querySelector("path#raphael-marker-block").cloneNode()),t&&function n(e,t){function i(e){for(var t=[],n=e.length,i=0;i<n;i++)t.push(e[i]);return t}var r=window.getComputedStyle(e),o=(["backgroundColor","color","fill","stroke","strokeWidth","opacity","stroke-dasharray","fontSize","fontFamily","textAnchor","textSize","padding","margin"].forEach(function(e){t.style[e]=r[e]}),i(t.children||[]));o.length&&i(e.children||[]).forEach(function(e,t){n(e,o[t])})}(e,r),e.parentElement&&"MJX-CONTAINER"==e.parentElement.tagName&&(t=e.getBoundingClientRect(),r.style.textAlign="center",r.setAttribute("height",t.height+8),r.setAttribute("width",t.width+8)),r.style.color||(r.style.color=o.color),o.getPropertyValue&&(i=window.getComputedStyle(document.body).backgroundColor),r.style.background||(r.style.background=o.backgroundColor,(i="rgba(0, 0, 0, 0)"!==o.backgroundColor?r.style.background:i)&&(e=i.match(/\d+/gi)).length&&((299*e[0]+587*e[1]+114*e[2])/256e3<.5?(r.style.background=i,s(r).find("[fill='var(--bg-color)']").attr("fill",i||"none")):n?(r.style.background="white",s(r).find("[fill='var(--bg-color)']").attr("fill","white")):(r.style.background="",s(r).find("[fill='var(--bg-color)']").attr("fill","none")))),r}function o(e,t,n,i){var r=e.getBoundingClientRect(),i=u(e,t,i),e=(e.parentElement&&"MJX-CONTAINER"==e.parentElement.tagName?(i.setAttribute("height",2*(r.height+8)),i.setAttribute("width",2*(r.width+8))):i.setAttribute("height",r.bottom-r.top),p(i.outerHTML,!1));return t||(e=h(e)),n?e:"data:image/svg+xml;charset=utf-8,"+encodeURIComponent(e)}function h(e){var t,n=window.getComputedStyle(document.documentElement);return e=l.replaceAll(e,"var(--text-color)",e=>t=t||n.getPropertyValue("--text-color"))}function p(e,t){return e=e.replace(/xmlns:NS\d+/gi,"xmlns:xlink").replace(/NS\d+:href/gi,"xlink:href").replace(/NS\d+:space/gi,"xml:space").replace(/NS\d+:/gi,"").replace(/<br([^>]*)>/g,"<br/>").replace(/<img([^>]*)>/g,(e,t)=>`<img ${t} />`),e=t?e:e.replace(/xlink:/g,"")}var a=0;function f(e,t){var n="<html style='margin:0;padding:0;'><head><meta charset='UTF-8'><style>"+function(){var e,t="";for(e of document.styleSheets)try{if(e.href&&-1<e.href.indexOf("mermaid.css")&&e.cssRules)for(var n of e.cssRules)t+=n.cssText||""}catch(e){}return t}()+"</style></head><body style='margin:0;padding:0;'>$1</body></html>",i=(r=e.getBoundingClientRect()).width,r={x:0,y:0,width:i=e.querySelector("[data-v-app]")?e.querySelector("[data-v-app]").getBoundingClientRect().width+32:i,height:r.height},n=n.replace("$1",o(e,!0,!0));return JSBridge.invoke("controller.screenshotHTML",{html:n,rect:r,extension:t||"png"})}function m(t,n,l,c){return new Promise(s=>{var e=o(t,n,!1,"jpeg"==l),r=new Image;r.onerror=function(e){s("")},r.onload=function(){var a=document.createElement("canvas"),e=a.getContext("2d"),t=File.canvasratio,n=r.width,i=r.height;a.width=n,a.height=i,1.1<t&&(a.width=n*t,a.height=i*t,e.scale(t,t)),a.style.width=n+"px",a.style.height=i+"px",e.drawImage(r,0,0),setTimeout(function(){var e,t,n,i,r,o="";try{o=a.toDataURL("image/"+l).replace(`data:image/${l};base64,`,"")}catch(e){console.warn(e)}o=o,e=l,n=s,"clipboard"===(t=c)?(r="data:image/png;base64,"+(r=o),File.isNode?(i=reqnode("electron").nativeImage.createFromDataURL(r),reqnode("electron").clipboard.writeImage(i)):bridge.callHandler("clipboard.writeImage",{path:r},function(){callback()}),n()):File.isNode?(i=o,reqnode("fs").writeFile(t,i,"base64",function(e){e?(n(""),console.sendError(e)):n(t)})):File.isMac&&(o=`data:image/${e};base64,`+o,bridge.callHandler("images.savePNG",o,async function(e){e&&t&&await JSBridge.invoke("path.moveFile",{from:e,to:t})?n(t):n("")}))},100)},r.src=e})}async function g(e,a){async function t(e){var t=a||await(File.isNode?JSBridge.invoke("dialog.showSaveDialog",{properties:["saveFile","showOverwriteConfirmation"],title:s.localize.getString("Save","Menu"),filters:[{name:"All Image Types",extensions:["svg","png","jpg","jpeg"]},{name:"SVG",extensions:["svg"]},{name:"PNG",extensions:["png"]},{name:"JPEG",extensions:["jpg","jpeg"]}]}).then(({filePath:e})=>e):File.isMac?JSBridge.invoke("image.saveSVGDialog"):void 0);if(t){a&&(t="clipboard");var n=e.closest("[lang='mermaid']"),i=e.closest("mjx-container");if(/\.svg$/.exec(t)){var r=h(p((e=u(e,n,!1)).outerHTML,!1));if(File.isNode)return new Promise(e=>{reqnode("fs").writeFile(t,r,"utf8",e)});if(File.isMac)return JSBridge.invoke("image.saveSVG",{path:t,content:r})}var o=a||/\.png$/.exec(t)?"png":"jpeg";return File.isNode||i?m(e,n,o,t):File.isMac?(i=await f(e,o),a?(await JSBridge.invoke("clipboard.writeImage",{path:i}),""):await JSBridge.invoke("path.moveFile",{from:i,to:t})?t:""):void 0}}var n;if(e)return"svg"==e.tagName?t(e):void((e=e).src&&(File.isMac&&/^(wk)?file:/.exec(e.src)?(n=l.absolutePathFrom(e.src),JSBridge.invoke("shell.showSaveImage",n)):JSBridge.invoke("shell.showDownload",e.src)))}t.copyAsHtml=function(e){var t=e.closest("[lang='mermaid']"),n=e.closest("[cid]"),t=h(p((e=u(e,t,!1)).outerHTML,!1)),e=r.getMarkElemFromCurrentHtml(n.outerHTML,File.editor).html();d.setClipboard(null,e,t)};const y=31457280;async function v(e){var t=File.editor;e=/^(wk)*file:(\/\/)*/.exec(e)?l.absolutePathFrom(e):e;var i=l.VIDEO_REG.exec(e),r=l.AUDIO_REG.exec(e),o=l.getFileName(e),n=File.isWin?"\\":"/",a=File.bundle.filePath+n+"assets"+n;n=await((File.isTextBundle()||File.isTextPack())&&/(^[\\\/])|(^[a-zA-Z]:)/.exec(e)&&!c.shouldManageResource(e)&&File.isNode&&(await reqnode("fs-extra").stat(e)).size<y?async function(e){var t=reqnode("fs-extra"),n=a+o;try{await t.access(n,t.F_OK),n=File.editor.imgEdit.uniqueFilePathOnNode(n)}catch(e){}return i||r?await t.copy(e,n):t.copy(e,n),n}(e):e);i?(e=n,e=t.imgEdit.resolveImagePath(e),e='<video src="{url}"></video>'.replace("{url}",e),d.pasteHandler(t,e,!1)):r?(e=n,e=t.imgEdit.resolveImagePath(e),e='<audio src="{url}"></audio>'.replace("{url}",e),d.pasteHandler(t,e,!1)):d.insertFileLink(t,n)}function b(e){e&&(l.IMG_REG.exec(e)?File.editor.imgEdit.insertImageFromURL(e):v(e))}t.onSaveDiscard=async function(){File.bundle.assetsChanges&&0<File.bundle.assetsChanges.add.length+File.bundle.assetsChanges.remove.length&&(await function(e){var t,n=reqnode("fs-extra"),i=File.isWin?"\\":"/",r=[];for(t of e){var[o,a]=t,a=File.bundle.filePath+i+"assets"+i+a;r.push(n.move(o,a,{overwrite:!1}),function(){})}return Promise.all(r)}(File.bundle.assetsChanges.remove),await i.backupAssets(File.bundle.assetsChanges.add,!0))},t.recordMediaMoves=function(e,t){File.bundle.assetsChanges=File.bundle.assetsChanges||{add:[],remove:[]};let n;(n=c.shouldManageResource(e))&&File.bundle.assetsChanges.add.push(n),t&&(n=c.shouldManageResource(t[1]))&&File.bundle.assetsChanges.remove.push([t[0],n])},t.insertURL=b,t.insertURLs=function(e){var n=File.editor;e.forEach(function(e,t){0<t&&n.UserOp.insertParagraph(!1,n),b(e)})},t.SVG2HtmlImg=function(e){var t,n,i;return e?(t=o(e,!0),n=document.createElement("img"),i=e.getBoundingClientRect(),e.parentElement&&"MJX-CONTAINER"==e.parentElement.tagName?(e.setAttribute("height",i.height+8),e.setAttribute("width",i.width+8),i.height+=8,i.width+=8):i=e.getBoundingClientRect(),n.width=i.width,n.height=i.height,n.setAttribute("src","data:image/svg+xml;base64,"+btoa(t)),n.outerHTML):""},t.processExportedSVG=p,t.downloadAs=g,t.copyImage=function(e){return g(e,!0)},t.saveSVGToTempPath=async function(e,t){return File.isMac?f(e,"png"):m(e,t,"png",(e=await reqnode("electron").ipcRenderer.invoke("getPath","temp"),a++,await(e=e.replace(/[/\\]$/,"")+(File.isWin?"\\\\":"/")+Number(new Date)+a+".png")))}}),$__System.registerDynamic("32",["11","33","29","28"],!0,function(e,t,n){"use strict";this||self;function i(){this.doneStack=[],this.undoneStack=[],this.curState=[s.NSChangeAutoSaved,+new Date],this.lastSaved=this.curState[1]}var r=e("11"),a=e("33"),o=e("29"),c=e("28"),s={NSChangeDone:0,NSChangeUndone:1,NSChangeCleared:2,NSChangeReadOtherContents:3,NSChangeAutoSaved:4,NSChangeRedone:5,NodeSaveFailed:-1},l=(i.prototype.isDocumentEdited=function(){return!this.curState},i.prototype.withdrawAutoSaved=function(){if(this.curState){if(this.curState[0]!=s.NSChangeAutoSaved)return!0;this.curState=null}return!1},i.prototype.clone=function(){return{doneStack:this.doneStack.clone(),undoneStack:this.undoneStack.clone(),curState:this.curState,lastSaved:this.lastSaved}},i.prototype.reset=function(e){this.doneStack=e?e.doneStack:[],this.undoneStack=e?e.undoneStack:[],this.curState=e?e.curState:[s.NSChangeAutoSaved,+new Date];var t=this.lastSaved;this.lastSaved=e?e.lastSaved:this.curState[1],t!=this.lastSaved&&l()},i.prototype.isDiscardableUntitled=function(){return!(File.isDocumentEdited()||File.bundle.filePath)},i.prototype.updateChangeCount=function(e){var t,n=this.curState;switch(File.bundle.hasModified=File.bundle.filePath||!0,e){case s.NSChangeDone:this.curState&&this.curState[0]===s.NSChangeAutoSaved&&(this.doneStack.push(this.curState),this.curState=null),this.doneStack.push([e]),200<this.doneStack.length&&this.doneStack.splice(0,this.doneStack.length-200),this.undoneStack=[];break;case s.NSChangeUndone:for(this.curState&&this.curState[0]===s.NSChangeAutoSaved&&(this.undoneStack.push(this.curState),this.curState=null),this.doneStack.pop(),this.undoneStack.push([e]);(t=this.doneStack.last())&&t[0]===s.NSChangeAutoSaved;)this.doneStack.pop(),this.lastSaved===t[1]&&(this.curState=t);break;case s.NSChangeRedone:for(this.curState&&this.curState[0]===s.NSChangeAutoSaved&&(this.doneStack.push(this.curState),this.curState=null),this.undoneStack.pop(),this.doneStack.push([e]);(t=this.undoneStack.last())&&t[0]===s.NSChangeAutoSaved;)this.undoneStack.pop(),this.lastSaved===t[1]&&(this.curState=t);break;case s.NSChangeCleared:this.doneStack=[],this.undoneStack=[],this.curState=[s.NSChangeAutoSaved,+new Date],this.lastSaved=this.curState[1];break;case s.NodeSaveFailed:this.curState&&(this.lastSaved=null,this.curState=null);break;case s.NSChangeAutoSaved:if(this.curState)return;this.curState=[s.NSChangeAutoSaved,+new Date],this.lastSaved=this.curState[1];break;case s.NSChangeReadOtherContents:for(var i=[],r=[],o=0;o<this.doneStack.length;o++)this.doneStack[o][0]!==s.NSChangeAutoSaved&&i.push(this.doneStack[o]);for(o=0;o<this.undoneStack.length;o++)this.undoneStack[o][0]!==s.NSChangeAutoSaved&&r.push(this.undoneStack[o]);this.doneStack=i,this.undoneStack=r,this.curState=null}n!==this.curState&&File.isNodeHtml&&l()},function(){var e=!File.bundle.filePath&&(File.bundle.fileName||File.bundle.originalPath);File.changeCounter&&(e||!File.changeCounter.curState||File.inSavingProcess?File.bundle.filePath&&File.option.enableAutoSave&&File.changeCounter.lastSaved||(document.querySelector("#title-text").classList.add("title-modified"),File.isNode&&JSBridge.invoke("window.setTitle",void 0,!0),document.querySelector("#m-saved").parentElement.classList.remove("saved")):((File.bundle.filePath||File.bundle.fileName)&&File.isNode&&JSBridge.invoke("window.setTitle",void 0,!1),document.querySelector("#title-text").classList.remove("title-modified"),document.querySelector("#m-saved").parentElement.classList.add("saved")))}),d=(t.showExportDialog=async function(a,s,l){var e;return(s=s||{}).path&&s.overwrite?File.option.noWarningForExportOverwrite?s.path:0!=(e=await c.showWarningDialog($.localize.getString('"Export and Overwrite with Previous" will overwrite file at %@, would you continue?',"Panel").replace("%@",s.path),!0)).response?null:(e.checkboxChecked&&(JSBridge.execForAll("window.File && File.option && (File.option.noWarningForExportOverwrite = true)"),JSBridge.putSetting("noWarningForExportOverwrite",!0)),s.path):new Promise(e=>{var t,n,i,r,o;t=a,n=e,e=l,o=[],(i=(i=s)||{}).selectFolder||(o=e||[{name:t.toUpperCase(),extensions:[t]},{name:$.localize.getString("All Files","Panel"),extensions:["*"]}]),e=File.isLinuxSnap?"":d(t,i,e=>{r=e}),File.isNode&&JSBridge.invoke(i.selectFolder?"dialog.showOpenDialog":"dialog.showSaveDialog",{properties:i.selectFolder?["saveFile","createDirectory"]:["openDirectory"],title:$.localize.getString("Save","Menu"),defaultPath:e,filters:o}).then(({filePath:e})=>{e&&(File.option.lastSaveLocation=reqnode("path").dirname(e),Analytics.record("export",{format:t})),n(e)}),File.isMac&&(i.selectFolder?bridge.callHandler("path.selectFolderOrFile",{forExport:!0,dir:!0,defaultPath:e},e=>{Analytics.record("export",{format:t}),n(e)}):bridge.callHandler("path.showSaveDialog",{defaultPath:r?"":e,filters:o?o[0].extensions:null},e=>{Analytics.record("export",{format:t}),n(e)}))})},function(e,t,n){var i=File.isWin?"\\":"/",e=(e=null==e?File.option.defaultExtension||"md":e)?File.getSuggestedFileName()+"."+e:File.getSuggestedFileName();return(t=t||{}).path?!File.option.lastExport||File.option.lastExportNoOverwrite?r.pathByDeleteLastComponent(t.path)+i+e:t.path:File.option.lastSaveLocation?File.option.lastSaveLocation+i+e:"same"===t.exportFolder?u()+i+e:"custom"===t.exportFolder?(t.customExportPath=t.customExportPath||window._options.documentsPath,t.customExportPath+i+e):File.mountFolder_?File.mountFolder_+i+e:(n&&n(e),e)}),u=function(){return File.isMac?File.bundle.currentFolderPath:File.isNode&&File.bundle.filePath?reqnode("path").dirname(File.bundle.filePath||File.bundle.originalPath):""},h=function(){return File.bundle.filePath||""},p=function(e){for(var t=e.split("/"),n=[],i=0;i<t.length;i++)"."!=t[i]&&(".."==t[i]?n.pop():n.push(t[i]));return n.join("/").replace(/[\/]{1,}/g,"/")};const f=t=>new Promise(e=>{setTimeout(e,t)});var m=async(e,t)=>{if(File.editor.searchPanel.closePanel(!0,!0),File.inSavingProcess)if(t=t||1,await f(100*t),File.inSavingProcess){if(!(5<t))return void await m(e,t+1);File.inSavingProcess=!1,File.updateChangeCount(File.ChangeType.NodeSaveFailed)}else await m(e);else if(!File.bundle.unsupported&&(File.bundle.hasModified||1!=File.draftsRecoverList.length||reqnode("fs").unlink(File.draftsRecoverList[0],()=>{}),File.bundle.hasModified)&&File.changeCounter.isDocumentEdited()&&await JSBridge.invoke("document.noOtherWindow")){if(!(e&&(File.option.enableAutoSave||File.option.saveFileOnSwitch)&&File.bundle.filePath&&reqnode("fs").existsSync(File.bundle.filePath)))return await File.backupWindow(!0),new Promise((n,i)=>{c.showDialog({title:$.localize.getString("Save","Menu"),html:$.localize.getString("Do you want to save the changes made to this document ?<br> Your changes will be lost if you don't save them.","Panel"),buttons:[$.localize.getString("Save","Menu"),$.localize.getString(File.bundle.filePath?"Discard Changes":"Discard","Panel"),$.localize.getString("Cancel")],backdrop:!1,keyboard:!0,callback:async function(e){if(0==e){File._needsUpdateSnap=new Date;var t=await File.saveUseNode(!1,!1,!0);if(t)try{File.updateChangeCount(File.ChangeType.NSChangeAutoSaved),await File.buildDocumentSnapForNode(!0)}catch(e){console.sendError(e),File.updateChangeCount(File.ChangeType.NodeSaveFailed),t=!1}t?n():i(null)}else 1==e?(File.buildDocumentSnapForNode(),JSBridge.invoke("document.setLastSync",-1),await o.onSaveDiscard(),n(),File._needsUpdateSnap=!1):(JSBridge.invoke("app.cancelQuit"),File._onFileSwitching=!1,i(null))}})});try{await File.buildDocumentSnapForNode(!0)}catch(e){console.sendError(e),File.updateChangeCount(File.ChangeType.NodeSaveFailed)}if(!1===await File.saveUseNode(!1,!1,!0))throw new Error("save failed")}},g=(t.tryLeaveDocument=function(t,e){m(e).then(t).catch(e=>{null!=e&&t(e.message||e)})},function(e,t){return!(!e||"."==e[0])&&((e=y(e).toLowerCase())?~File.SupportedFiles.indexOf(e):!t)}),y=function(e){return(e.split(/[\/\\]/).last().match(/\.([^.]+)$/)||[])[1]||""};function v(){File.option.copyMarkdownByDefault=!0,window.ClientCommand.selectAll(),setTimeout(function(){window.ClientCommand.copy(),setTimeout(function(){File.editor.EditHelper.showNotification("Context copied to clipboard.")},500)},500)}$("#save-error-banner").on("click",".btn",v).on("click","#trigger-save-error-dialog",function(){let e=$.localize.getString("Save content failed for some reason.<br/>You could copy the content into a new Typora window, and then save it. <br/>Learn more about:<ul><li><a href='https://support.typora.io/Report-Bugs/'>Report bugs to us</a></li><li><a href='https://support.typora.io/Version-Control/'>Recover lost contents</a></li></ul>","Panel");File.option.useMirrorInCN&&(e=e.replace(/\.io\//g,"io.cn/")),c.showDialog({title:$.localize.getString("Something is Wrong…","Panel"),html:e,buttons:[$.localize.getString("Copy Content","Panel"),$.localize.getString("Close","Panel")],callback:function(e){File._onFileSwitching=!1,0==e&&(v(),$("#save-error-banner").show())}}),$("#save-error-banner").hide()});const b=function(){return reqnode(`../../${window._options.mainPath||"launch/app"}/main.node`)};t.winShell=b;var w,x=!1,C=[],F=null;function S(){var e=document.caretRangeFromPoint(window.innerWidth/2,40);C=e&&e.startContainer.parentElement.closest("[cid]")?[e,e?e.getBoundingClientRect():null]:[]}function k(){var e,t;C&&(t=C[0],e=C[1],t)&&(t=t.getBoundingClientRect().top-e.top,w.scrollTop+=t)}$(document).ready(function(){function e(){F&&clearTimeout(F),F=setTimeout(function(){C=null},500)}var t,n,i,r;w=document.querySelector("content"),window.addEventListener("beforeResize",function(){File&&File.editor&&!File._onInitParse&&S()}),window.addEventListener("resize",function(){File&&File.editor&&!File._onInitParse&&!C&&(S(),e())}),t="resize",n="optimizedResize",i=i||window,r=!1,i.addEventListener(t,function(){r||(r=!0,requestAnimationFrame(function(){i.dispatchEvent(new CustomEvent(n)),r=!1}))}),window.addEventListener("optimizedResize",function(){File&&File.editor&&!File._onInitParse&&C&&(setTimeout(k,0),e())})}),t.setItemInDB=function(t,n){try{localStorage.setItem(t+"",n+"")}catch(e){localStorage.clear(),localStorage.setItem(t,n)}},t.removeItemInDB=function(e){try{localStorage.removeItem(e)}catch(e){localStorage.clear()}},t.getItemInDB=function(e){return localStorage.getItem(e)},t.getColorBrightness=function(e){e=(e.match(/[\d.]+/gi)||[]).map(function(e){return+e});return void 0!==e[3]&&null!==e[3]||(e[3]=1),0==e[3]?1:(299*e[0]+587*e[1]+114*e[2])/256e3},t.getFileNameFromPath=function(e,t){try{e=e&&decodeURI(e)}catch(e){}return e=e&&(e=(e=e.replace(/\\/g,"/").replace(/\/$/,"")).substring(e.lastIndexOf("/")+1),t)?e.replace(/#[^\/]+$/,"").replace(/\?[^\/]+$/,""):e},t.normalizePath=function(e,t){return!t&&/^([a-z][a-z0-9+\-]+):\/\//gi.exec(e)?e:File.isNode?reqnode("path").normalize(e):p(e)},t.getCurrentFilePath=h,t.getCurrentFileFolderPath=u,t.getExtension=y,t.ChangeType=s,t.ChangeCounter=i,t.refreshTitlebarText=l,t.isSupportedFile=g,t.detectEncodeByNode=function(e){var t,n=!1;return 2<e.length&&239===e[0]&&187===e[1]&&191===e[2]&&(n=!0),r.isUTF8(e)?n?"utf8-bom":"utf8":(n=reqnode("jschardet"),t=reqnode("iconv-lite"),n.Constants.MINIMUM_THRESHOLD=.3,"ascii"==(n=n.detect(e).encoding||"utf8").toLowerCase()&&(n="utf8"),t.encodingExists(n)||(n=n.replace(/-/g,"_")),t.encodingExists(n)?n:"utf8")},t.getContentFromBuffer=function(e,t,n){if("utf8"==t||"uft16le"==t){if(239!=e[0])return e.toString(t);var i;if(239==e[0]&&187==e[1]&&191==e[2]&&239==e[0])return i=e.toString(t).replace(/^\uFEFF+/,""),"function"==typeof n&&n(),i}return reqnode("iconv-lite").decode(e,t,{stripBOM:n})},t.statWrapper=function(e,t){!async function(t){var e={},n=reqnode("path").basename(t),i=t===File.getMountFolder();if(!i&&n&&"."==n[0])e.shouldIgnore=!i;else{if(e.name=n,File.isWin){var r=await new Promise(function(e){reqnode("fswin").getAttributes(t,e)});if(!r)return null;e.shouldIgnore=r.IS_HIDDEN||r.IS_SYSTEM||r.IS_TEMPORARY,e.isDir=r.IS_DIRECTORY,e.isFile=!e.isDir,e.mtime=r.LAST_WRITE_TIME,e.birthtime=r.CREATION_TIME,e.size=r.SIZE/1e3}else{var r=reqnode("util");try{var o=await reqnode("fs-extra").stat(t);e.isDir=o.isDirectory(),e.isFile=o.isFile(),e.mtime=new Date(r.inspect(o.mtime)),e.birthtime=new Date(r.inspect(o.birthtime)),e.size=Number(o.size)/1e3}catch(e){return null}}e.isDir?e.shouldIgnore="node_modules"==n:e.isFile&&(e.shouldIgnore=e.shouldIgnore||!g(n),File.isWin||(e.shouldIgnore=e.shouldIgnore||1e3*e.size>1e3*File.MAX_FILE_SIZE)),i&&(e.shouldIgnore=!1),!e.shouldIgnore&&File.option.supportTextBundle&&/\.textbundle$/i.exec(n)&&(e.isDir||(e.shouldIgnore=!0),e.isBundle=!0,e.isDir=!1,e.isFile=!0,e.shouldIgnore=!1,(r=await a.findTextFile(t))?e.textFile=t+(File.isWin?"\\":"/")+r:e.shouldIgnore=!0)}return e}(e).then(t)},t.bindOversizePlaceholder=function(){File.isLinux||x||(File.isMac?$("#ty-oversize-file-quick-look").css("display","inline-block").on("click",function(){bridge.callHandler("window.previewFile",h())}):File.isWin&&$("#ty-oversize-file-open-in").css("display","inline-block").on("click",function(){b().openAs(File.bundle.filePath)}),x=!0)},t.getDefaultPathOrName=d}),!function(e,t){"use strict";"object"==typeof module&&"object"==typeof module.exports?module.exports=e.document?t(e,!0):function(e){if(e.document)return t(e);throw new Error("jQuery requires a window with a document")}:t(e)}("undefined"!=typeof window?window:this,function(x,R){"use strict";function v(e){return"function"==typeof e&&"number"!=typeof e.nodeType}function m(e){return null!=e&&e===e.window}var e=[],C=x.document,O=Object.getPrototypeOf,s=e.slice,I=e.concat,$=e.push,H=e.indexOf,U={},j=U.toString,q=U.hasOwnProperty,W=q.toString,z=W.call(Object),g={},V={type:!0,src:!0,noModule:!0};function J(e,t,n){var i,r=(t=t||C).createElement("script");if(r.text=e,n)for(i in V)n[i]&&(r[i]=n[i]);t.head.appendChild(r).parentNode.removeChild(r)}function f(e){return null==e?e+"":"object"==typeof e||"function"==typeof e?U[j.call(e)]||"object":typeof e}var F=function(e,t){return new F.fn.init(e,t)},K=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g;function Y(e){var t=!!e&&"length"in e&&e.length,n=f(e);return!v(e)&&!m(e)&&("array"===n||0===t||"number"==typeof t&&0<t&&t-1 in e)}F.fn=F.prototype={jquery:"3.3.1",constructor:F,length:0,toArray:function(){return s.call(this)},get:function(e){return null==e?s.call(this):e<0?this[e+this.length]:this[e]},pushStack:function(e){e=F.merge(this.constructor(),e);return e.prevObject=this,e},each:function(e){return F.each(this,e)},map:function(n){return this.pushStack(F.map(this,function(e,t){return n.call(e,t,e)}))},slice:function(){return this.pushStack(s.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(e){var t=this.length,e=+e+(e<0?t:0);return this.pushStack(0<=e&&e<t?[this[e]]:[])},end:function(){return this.prevObject||this.constructor()},push:$,sort:e.sort,splice:e.splice},F.extend=F.fn.extend=function(){var e,t,n,i,r,o=arguments[0]||{},a=1,s=arguments.length,l=!1;for("boolean"==typeof o&&(l=o,o=arguments[a]||{},a++),"object"==typeof o||v(o)||(o={}),a===s&&(o=this,a--);a<s;a++)if(null!=(e=arguments[a]))for(t in e)r=o[t],o!==(n=e[t])&&(l&&n&&(F.isPlainObject(n)||(i=Array.isArray(n)))?(r=i?(i=!1,r&&Array.isArray(r)?r:[]):r&&F.isPlainObject(r)?r:{},o[t]=F.extend(l,r,n)):void 0!==n&&(o[t]=n));return o},F.extend({expando:"jQuery"+("3.3.1"+Math.random()).replace(/\D/g,""),isReady:!0,error:function(e){throw new Error(e)},noop:function(){},isPlainObject:function(e){return!(!e||"[object Object]"!==j.call(e)||(e=O(e))&&("function"!=typeof(e=q.call(e,"constructor")&&e.constructor)||W.call(e)!==z))},isEmptyObject:function(e){for(var t in e)return!1;return!0},globalEval:function(e){J(e)},each:function(e,t){var n,i=0;if(Y(e))for(n=e.length;i<n&&!1!==t.call(e[i],i,e[i]);i++);else for(i in e)if(!1===t.call(e[i],i,e[i]))break;return e},trim:function(e){return null==e?"":(e+"").replace(K,"")},makeArray:function(e,t){t=t||[];return null!=e&&(Y(Object(e))?F.merge(t,"string"==typeof e?[e]:e):$.call(t,e)),t},inArray:function(e,t,n){return null==t?-1:H.call(t,e,n)},merge:function(e,t){for(var n=+t.length,i=0,r=e.length;i<n;i++)e[r++]=t[i];return e.length=r,e},grep:function(e,t,n){for(var i=[],r=0,o=e.length,a=!n;r<o;r++)!t(e[r],r)!=a&&i.push(e[r]);return i},map:function(e,t,n){var i,r,o=0,a=[];if(Y(e))for(i=e.length;o<i;o++)null!=(r=t(e[o],o,n))&&a.push(r);else for(o in e)null!=(r=t(e[o],o,n))&&a.push(r);return I.apply([],a)},guid:1,support:g}),"function"==typeof Symbol&&(F.fn[Symbol.iterator]=e[Symbol.iterator]),F.each("Boolean Number String Function Array Date RegExp Object Error Symbol".split(" "),function(e,t){U["[object "+t+"]"]=t.toLowerCase()});function i(e,t,n){for(var i=[],r=void 0!==n;(e=e[t])&&9!==e.nodeType;)if(1===e.nodeType){if(r&&F(e).is(n))break;i.push(e)}return i}function G(e,t){for(var n=[];e;e=e.nextSibling)1===e.nodeType&&e!==t&&n.push(e);return n}var e=function(n){function u(e,t,n){var i="0x"+t-65536;return i!=i||n?t:i<0?String.fromCharCode(65536+i):String.fromCharCode(i>>10|55296,1023&i|56320)}function R(e,t){return t?"\0"===e?"�":e.slice(0,-1)+"\\"+e.charCodeAt(e.length-1).toString(16)+" ":"\\"+e}function O(){C()}var e,p,w,o,I,f,$,H,x,l,c,C,F,i,S,m,r,a,g,k="sizzle"+ +new Date,y=n.document,E=0,U=0,j=de(),q=de(),v=de(),W=function(e,t){return e===t&&(c=!0),0},z={}.hasOwnProperty,t=[],V=t.pop,J=t.push,T=t.push,K=t.slice,b=function(e,t){for(var n=0,i=e.length;n<i;n++)if(e[n]===t)return n;return-1},Y="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",s="[\\x20\\t\\r\\n\\f]",d="(?:\\\\.|[\\w-]|[^\0-\\xa0])+",G="\\["+s+"*("+d+")(?:"+s+"*([*^$|!~]?=)"+s+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+d+"))|)"+s+"*\\]",Q=":("+d+")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|"+G+")*)|.*)\\)|)",X=new RegExp(s+"+","g"),_=new RegExp("^"+s+"+|((?:^|[^\\\\])(?:\\\\.)*)"+s+"+$","g"),Z=new RegExp("^"+s+"*,"+s+"*"),ee=new RegExp("^"+s+"*([>+~]|"+s+")"+s+"*"),te=new RegExp("="+s+"*([^\\]'\"]*?)"+s+"*\\]","g"),ne=new RegExp(Q),ie=new RegExp("^"+d+"$"),h={ID:new RegExp("^#("+d+")"),CLASS:new RegExp("^\\.("+d+")"),TAG:new RegExp("^("+d+"|[*])"),ATTR:new RegExp("^"+G),PSEUDO:new RegExp("^"+Q),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+s+"*(even|odd|(([+-]|)(\\d*)n|)"+s+"*(?:([+-]|)"+s+"*(\\d+)|))"+s+"*\\)|)","i"),bool:new RegExp("^(?:"+Y+")$","i"),needsContext:new RegExp("^"+s+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+s+"*((?:-\\d)?\\d*)"+s+"*\\)|)(?=[^-]|$)","i")},re=/^(?:input|select|textarea|button)$/i,oe=/^h\d$/i,A=/^[^{]+\{\s*\[native \w/,ae=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,se=/[+~]/,M=new RegExp("\\\\([\\da-f]{1,6}"+s+"?|("+s+")|.)","ig"),le=/([\0-\x1f\x7f]|^-?\d)|^-$|[^\0-\x1f\x7f-\uFFFF\w-]/g,ce=ge(function(e){return!0===e.disabled&&("form"in e||"label"in e)},{dir:"parentNode",next:"legend"});try{T.apply(t=K.call(y.childNodes),y.childNodes),t[y.childNodes.length].nodeType}catch(n){T={apply:t.length?function(e,t){J.apply(e,K.call(t))}:function(e,t){for(var n=e.length,i=0;e[n++]=t[i++];);e.length=n-1}}}function L(e,t,n,i){var r,o,a,s,l,c,d,u=t&&t.ownerDocument,h=t?t.nodeType:9;if(n=n||[],"string"!=typeof e||!e||1!==h&&9!==h&&11!==h)return n;if(!i&&((t?t.ownerDocument||t:y)!==F&&C(t),t=t||F,S)){if(11!==h&&(l=ae.exec(e)))if(r=l[1]){if(9===h){if(!(a=t.getElementById(r)))return n;if(a.id===r)return n.push(a),n}else if(u&&(a=u.getElementById(r))&&g(t,a)&&a.id===r)return n.push(a),n}else{if(l[2])return T.apply(n,t.getElementsByTagName(e)),n;if((r=l[3])&&p.getElementsByClassName&&t.getElementsByClassName)return T.apply(n,t.getElementsByClassName(r)),n}if(p.qsa&&!v[e+" "]&&(!m||!m.test(e))){if(1!==h)u=t,d=e;else if("object"!==t.nodeName.toLowerCase()){for((s=t.getAttribute("id"))?s=s.replace(le,R):t.setAttribute("id",s=k),o=(c=f(e)).length;o--;)c[o]="#"+s+" "+B(c[o]);d=c.join(","),u=se.test(e)&&fe(t.parentNode)||t}if(d)try{return T.apply(n,u.querySelectorAll(d)),n}catch(e){}finally{s===k&&t.removeAttribute("id")}}}return H(e.replace(_,"$1"),t,n,i)}function de(){var n=[];function i(e,t){return n.push(e+" ")>w.cacheLength&&delete i[n.shift()],i[e+" "]=t}return i}function N(e){return e[k]=!0,e}function D(e){var t=F.createElement("fieldset");try{return!!e(t)}catch(e){return!1}finally{t.parentNode&&t.parentNode.removeChild(t)}}function ue(e,t){for(var n=e.split("|"),i=n.length;i--;)w.attrHandle[n[i]]=t}function he(e,t){var n=t&&e,i=n&&1===e.nodeType&&1===t.nodeType&&e.sourceIndex-t.sourceIndex;if(i)return i;if(n)for(;n=n.nextSibling;)if(n===t)return-1;return e?1:-1}function pe(t){return function(e){return"form"in e?e.parentNode&&!1===e.disabled?"label"in e?"label"in e.parentNode?e.parentNode.disabled===t:e.disabled===t:e.isDisabled===t||e.isDisabled!==!t&&ce(e)===t:e.disabled===t:"label"in e&&e.disabled===t}}function P(a){return N(function(o){return o=+o,N(function(e,t){for(var n,i=a([],e.length,o),r=i.length;r--;)e[n=i[r]]&&(e[n]=!(t[n]=e[n]))})})}function fe(e){return e&&void 0!==e.getElementsByTagName&&e}for(e in p=L.support={},I=L.isXML=function(e){e=e&&(e.ownerDocument||e).documentElement;return!!e&&"HTML"!==e.nodeName},C=L.setDocument=function(e){var e=e?e.ownerDocument||e:y;return e!==F&&9===e.nodeType&&e.documentElement&&(i=(F=e).documentElement,S=!I(F),y!==F&&(e=F.defaultView)&&e.top!==e&&(e.addEventListener?e.addEventListener("unload",O,!1):e.attachEvent&&e.attachEvent("onunload",O)),p.attributes=D(function(e){return e.className="i",!e.getAttribute("className")}),p.getElementsByTagName=D(function(e){return e.appendChild(F.createComment("")),!e.getElementsByTagName("*").length}),p.getElementsByClassName=A.test(F.getElementsByClassName),p.getById=D(function(e){return i.appendChild(e).id=k,!F.getElementsByName||!F.getElementsByName(k).length}),p.getById?(w.filter.ID=function(e){var t=e.replace(M,u);return function(e){return e.getAttribute("id")===t}},w.find.ID=function(e,t){if(void 0!==t.getElementById&&S)return(t=t.getElementById(e))?[t]:[]}):(w.filter.ID=function(e){var t=e.replace(M,u);return function(e){e=void 0!==e.getAttributeNode&&e.getAttributeNode("id");return e&&e.value===t}},w.find.ID=function(e,t){if(void 0!==t.getElementById&&S){var n,i,r,o=t.getElementById(e);if(o){if((n=o.getAttributeNode("id"))&&n.value===e)return[o];for(r=t.getElementsByName(e),i=0;o=r[i++];)if((n=o.getAttributeNode("id"))&&n.value===e)return[o]}return[]}}),w.find.TAG=p.getElementsByTagName?function(e,t){return void 0!==t.getElementsByTagName?t.getElementsByTagName(e):p.qsa?t.querySelectorAll(e):void 0}:function(e,t){var n,i=[],r=0,o=t.getElementsByTagName(e);if("*"!==e)return o;for(;n=o[r++];)1===n.nodeType&&i.push(n);return i},w.find.CLASS=p.getElementsByClassName&&function(e,t){if(void 0!==t.getElementsByClassName&&S)return t.getElementsByClassName(e)},r=[],m=[],(p.qsa=A.test(F.querySelectorAll))&&(D(function(e){i.appendChild(e).innerHTML="<a id='"+k+"'></a><select id='"+k+"-\r\\' msallowcapture=''><option selected=''></option></select>",e.querySelectorAll("[msallowcapture^='']").length&&m.push("[*^$]="+s+"*(?:''|\"\")"),e.querySelectorAll("[selected]").length||m.push("\\["+s+"*(?:value|"+Y+")"),e.querySelectorAll("[id~="+k+"-]").length||m.push("~="),e.querySelectorAll(":checked").length||m.push(":checked"),e.querySelectorAll("a#"+k+"+*").length||m.push(".#.+[+~]")}),D(function(e){e.innerHTML="<a href='' disabled='disabled'></a><select disabled='disabled'><option/></select>";var t=F.createElement("input");t.setAttribute("type","hidden"),e.appendChild(t).setAttribute("name","D"),e.querySelectorAll("[name=d]").length&&m.push("name"+s+"*[*^$|!~]?="),2!==e.querySelectorAll(":enabled").length&&m.push(":enabled",":disabled"),i.appendChild(e).disabled=!0,2!==e.querySelectorAll(":disabled").length&&m.push(":enabled",":disabled"),e.querySelectorAll("*,:x"),m.push(",.*:")})),(p.matchesSelector=A.test(a=i.matches||i.webkitMatchesSelector||i.mozMatchesSelector||i.oMatchesSelector||i.msMatchesSelector))&&D(function(e){p.disconnectedMatch=a.call(e,"*"),a.call(e,"[s!='']:x"),r.push("!=",Q)}),m=m.length&&new RegExp(m.join("|")),r=r.length&&new RegExp(r.join("|")),e=A.test(i.compareDocumentPosition),g=e||A.test(i.contains)?function(e,t){var n=9===e.nodeType?e.documentElement:e,t=t&&t.parentNode;return e===t||!(!t||1!==t.nodeType||!(n.contains?n.contains(t):e.compareDocumentPosition&&16&e.compareDocumentPosition(t)))}:function(e,t){if(t)for(;t=t.parentNode;)if(t===e)return!0;return!1},W=e?function(e,t){var n;return e===t?(c=!0,0):!e.compareDocumentPosition-!t.compareDocumentPosition||(1&(n=(e.ownerDocument||e)===(t.ownerDocument||t)?e.compareDocumentPosition(t):1)||!p.sortDetached&&t.compareDocumentPosition(e)===n?e===F||e.ownerDocument===y&&g(y,e)?-1:t===F||t.ownerDocument===y&&g(y,t)?1:l?b(l,e)-b(l,t):0:4&n?-1:1)}:function(e,t){if(e===t)return c=!0,0;var n,i=0,r=e.parentNode,o=t.parentNode,a=[e],s=[t];if(!r||!o)return e===F?-1:t===F?1:r?-1:o?1:l?b(l,e)-b(l,t):0;if(r===o)return he(e,t);for(n=e;n=n.parentNode;)a.unshift(n);for(n=t;n=n.parentNode;)s.unshift(n);for(;a[i]===s[i];)i++;return i?he(a[i],s[i]):a[i]===y?-1:s[i]===y?1:0}),F},L.matches=function(e,t){return L(e,null,null,t)},L.matchesSelector=function(e,t){if((e.ownerDocument||e)!==F&&C(e),t=t.replace(te,"='$1']"),p.matchesSelector&&S&&!v[t+" "]&&(!r||!r.test(t))&&(!m||!m.test(t)))try{var n=a.call(e,t);if(n||p.disconnectedMatch||e.document&&11!==e.document.nodeType)return n}catch(e){}return 0<L(t,F,null,[e]).length},L.contains=function(e,t){return(e.ownerDocument||e)!==F&&C(e),g(e,t)},L.attr=function(e,t){(e.ownerDocument||e)!==F&&C(e);var n=w.attrHandle[t.toLowerCase()],n=n&&z.call(w.attrHandle,t.toLowerCase())?n(e,t,!S):void 0;return void 0!==n?n:p.attributes||!S?e.getAttribute(t):(n=e.getAttributeNode(t))&&n.specified?n.value:null},L.escape=function(e){return(e+"").replace(le,R)},L.error=function(e){throw new Error("Syntax error, unrecognized expression: "+e)},L.uniqueSort=function(e){var t,n=[],i=0,r=0;if(c=!p.detectDuplicates,l=!p.sortStable&&e.slice(0),e.sort(W),c){for(;t=e[r++];)t===e[r]&&(i=n.push(r));for(;i--;)e.splice(n[i],1)}return l=null,e},o=L.getText=function(e){var t,n="",i=0,r=e.nodeType;if(r){if(1===r||9===r||11===r){if("string"==typeof e.textContent)return e.textContent;for(e=e.firstChild;e;e=e.nextSibling)n+=o(e)}else if(3===r||4===r)return e.nodeValue}else for(;t=e[i++];)n+=o(t);return n},(w=L.selectors={cacheLength:50,createPseudo:N,match:h,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(e){return e[1]=e[1].replace(M,u),e[3]=(e[3]||e[4]||e[5]||"").replace(M,u),"~="===e[2]&&(e[3]=" "+e[3]+" "),e.slice(0,4)},CHILD:function(e){return e[1]=e[1].toLowerCase(),"nth"===e[1].slice(0,3)?(e[3]||L.error(e[0]),e[4]=+(e[4]?e[5]+(e[6]||1):2*("even"===e[3]||"odd"===e[3])),e[5]=+(e[7]+e[8]||"odd"===e[3])):e[3]&&L.error(e[0]),e},PSEUDO:function(e){var t,n=!e[6]&&e[2];return h.CHILD.test(e[0])?null:(e[3]?e[2]=e[4]||e[5]||"":n&&ne.test(n)&&(t=(t=f(n,!0))&&n.indexOf(")",n.length-t)-n.length)&&(e[0]=e[0].slice(0,t),e[2]=n.slice(0,t)),e.slice(0,3))}},filter:{TAG:function(e){var t=e.replace(M,u).toLowerCase();return"*"===e?function(){return!0}:function(e){return e.nodeName&&e.nodeName.toLowerCase()===t}},CLASS:function(e){var t=j[e+" "];return t||(t=new RegExp("(^|"+s+")"+e+"("+s+"|$)"))&&j(e,function(e){return t.test("string"==typeof e.className&&e.className||void 0!==e.getAttribute&&e.getAttribute("class")||"")})},ATTR:function(t,n,i){return function(e){e=L.attr(e,t);return null==e?"!="===n:!n||(e+="","="===n?e===i:"!="===n?e!==i:"^="===n?i&&0===e.indexOf(i):"*="===n?i&&-1<e.indexOf(i):"$="===n?i&&e.slice(-i.length)===i:"~="===n?-1<(" "+e.replace(X," ")+" ").indexOf(i):"|="===n&&(e===i||e.slice(0,i.length+1)===i+"-"))}},CHILD:function(f,e,t,m,g){var y="nth"!==f.slice(0,3),v="last"!==f.slice(-4),b="of-type"===e;return 1===m&&0===g?function(e){return!!e.parentNode}:function(e,t,n){var i,r,o,a,s,l,c=y!=v?"nextSibling":"previousSibling",d=e.parentNode,u=b&&e.nodeName.toLowerCase(),h=!n&&!b,p=!1;if(d){if(y){for(;c;){for(a=e;a=a[c];)if(b?a.nodeName.toLowerCase()===u:1===a.nodeType)return!1;l=c="only"===f&&!l&&"nextSibling"}return!0}if(l=[v?d.firstChild:d.lastChild],v&&h){for(p=(s=(i=(r=(o=(a=d)[k]||(a[k]={}))[a.uniqueID]||(o[a.uniqueID]={}))[f]||[])[0]===E&&i[1])&&i[2],a=s&&d.childNodes[s];a=++s&&a&&a[c]||(p=s=0,l.pop());)if(1===a.nodeType&&++p&&a===e){r[f]=[E,s,p];break}}else if(!1===(p=h?s=(i=(r=(o=(a=e)[k]||(a[k]={}))[a.uniqueID]||(o[a.uniqueID]={}))[f]||[])[0]===E&&i[1]:p))for(;(a=++s&&a&&a[c]||(p=s=0,l.pop()))&&((b?a.nodeName.toLowerCase()!==u:1!==a.nodeType)||!++p||(h&&((r=(o=a[k]||(a[k]={}))[a.uniqueID]||(o[a.uniqueID]={}))[f]=[E,p]),a!==e)););return(p-=g)===m||p%m==0&&0<=p/m}}},PSEUDO:function(e,o){var t,a=w.pseudos[e]||w.setFilters[e.toLowerCase()]||L.error("unsupported pseudo: "+e);return a[k]?a(o):1<a.length?(t=[e,e,"",o],w.setFilters.hasOwnProperty(e.toLowerCase())?N(function(e,t){for(var n,i=a(e,o),r=i.length;r--;)e[n=b(e,i[r])]=!(t[n]=i[r])}):function(e){return a(e,0,t)}):a}},pseudos:{not:N(function(e){var i=[],r=[],s=$(e.replace(_,"$1"));return s[k]?N(function(e,t,n,i){for(var r,o=s(e,null,i,[]),a=e.length;a--;)(r=o[a])&&(e[a]=!(t[a]=r))}):function(e,t,n){return i[0]=e,s(i,null,n,r),i[0]=null,!r.pop()}}),has:N(function(t){return function(e){return 0<L(t,e).length}}),contains:N(function(t){return t=t.replace(M,u),function(e){return-1<(e.textContent||e.innerText||o(e)).indexOf(t)}}),lang:N(function(n){return ie.test(n||"")||L.error("unsupported lang: "+n),n=n.replace(M,u).toLowerCase(),function(e){var t;do{if(t=S?e.lang:e.getAttribute("xml:lang")||e.getAttribute("lang"))return(t=t.toLowerCase())===n||0===t.indexOf(n+"-")}while((e=e.parentNode)&&1===e.nodeType);return!1}}),target:function(e){var t=n.location&&n.location.hash;return t&&t.slice(1)===e.id},root:function(e){return e===i},focus:function(e){return e===F.activeElement&&(!F.hasFocus||F.hasFocus())&&!!(e.type||e.href||~e.tabIndex)},enabled:pe(!1),disabled:pe(!0),checked:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&!!e.checked||"option"===t&&!!e.selected},selected:function(e){return e.parentNode&&e.parentNode.selectedIndex,!0===e.selected},empty:function(e){for(e=e.firstChild;e;e=e.nextSibling)if(e.nodeType<6)return!1;return!0},parent:function(e){return!w.pseudos.empty(e)},header:function(e){return oe.test(e.nodeName)},input:function(e){return re.test(e.nodeName)},button:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&"button"===e.type||"button"===t},text:function(e){return"input"===e.nodeName.toLowerCase()&&"text"===e.type&&(null==(e=e.getAttribute("type"))||"text"===e.toLowerCase())},first:P(function(){return[0]}),last:P(function(e,t){return[t-1]}),eq:P(function(e,t,n){return[n<0?n+t:n]}),even:P(function(e,t){for(var n=0;n<t;n+=2)e.push(n);return e}),odd:P(function(e,t){for(var n=1;n<t;n+=2)e.push(n);return e}),lt:P(function(e,t,n){for(var i=n<0?n+t:n;0<=--i;)e.push(i);return e}),gt:P(function(e,t,n){for(var i=n<0?n+t:n;++i<t;)e.push(i);return e})}}).pseudos.nth=w.pseudos.eq,{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})w.pseudos[e]=function(t){return function(e){return"input"===e.nodeName.toLowerCase()&&e.type===t}}(e);for(e in{submit:!0,reset:!0})w.pseudos[e]=function(n){return function(e){var t=e.nodeName.toLowerCase();return("input"===t||"button"===t)&&e.type===n}}(e);function me(){}function B(e){for(var t=0,n=e.length,i="";t<n;t++)i+=e[t].value;return i}function ge(a,e,t){var s=e.dir,l=e.next,c=l||s,d=t&&"parentNode"===c,u=U++;return e.first?function(e,t,n){for(;e=e[s];)if(1===e.nodeType||d)return a(e,t,n);return!1}:function(e,t,n){var i,r,o=[E,u];if(n){for(;e=e[s];)if((1===e.nodeType||d)&&a(e,t,n))return!0}else for(;e=e[s];)if(1===e.nodeType||d)if(r=(r=e[k]||(e[k]={}))[e.uniqueID]||(r[e.uniqueID]={}),l&&l===e.nodeName.toLowerCase())e=e[s]||e;else{if((i=r[c])&&i[0]===E&&i[1]===u)return o[2]=i[2];if((r[c]=o)[2]=a(e,t,n))return!0}return!1}}function ye(r){return 1<r.length?function(e,t,n){for(var i=r.length;i--;)if(!r[i](e,t,n))return!1;return!0}:r[0]}function ve(e,t,n,i,r){for(var o,a=[],s=0,l=e.length,c=null!=t;s<l;s++)!(o=e[s])||n&&!n(o,i,r)||(a.push(o),c&&t.push(s));return a}function be(p,f,m,g,y,e){return g&&!g[k]&&(g=be(g)),y&&!y[k]&&(y=be(y,e)),N(function(e,t,n,i){var r,o,a,s=[],l=[],c=t.length,d=e||function(e,t,n){for(var i=0,r=t.length;i<r;i++)L(e,t[i],n);return n}(f||"*",n.nodeType?[n]:n,[]),u=!p||!e&&f?d:ve(d,s,p,n,i),h=m?y||(e?p:c||g)?[]:t:u;if(m&&m(u,h,n,i),g)for(r=ve(h,l),g(r,[],n,i),o=r.length;o--;)(a=r[o])&&(h[l[o]]=!(u[l[o]]=a));if(e){if(y||p){if(y){for(r=[],o=h.length;o--;)(a=h[o])&&r.push(u[o]=a);y(null,h=[],r,i)}for(o=h.length;o--;)(a=h[o])&&-1<(r=y?b(e,a):s[o])&&(e[r]=!(t[r]=a))}}else h=ve(h===t?h.splice(c,h.length):h),y?y(null,t,h,i):T.apply(t,h)})}function we(g,y){function e(e,t,n,i,r){var o,a,s,l=0,c="0",d=e&&[],u=[],h=x,p=e||b&&w.find.TAG("*",r),f=E+=null==h?1:Math.random()||.1,m=p.length;for(r&&(x=t===F||t||r);c!==m&&null!=(o=p[c]);c++){if(b&&o){for(a=0,t||o.ownerDocument===F||(C(o),n=!S);s=g[a++];)if(s(o,t||F,n)){i.push(o);break}r&&(E=f)}v&&((o=!s&&o)&&l--,e)&&d.push(o)}if(l+=c,v&&c!==l){for(a=0;s=y[a++];)s(d,u,t,n);if(e){if(0<l)for(;c--;)d[c]||u[c]||(u[c]=V.call(i));u=ve(u)}T.apply(i,u),r&&!e&&0<u.length&&1<l+y.length&&L.uniqueSort(i)}return r&&(E=f,x=h),d}var v=0<y.length,b=0<g.length;return v?N(e):e}return me.prototype=w.filters=w.pseudos,w.setFilters=new me,f=L.tokenize=function(e,t){var n,i,r,o,a,s,l,c=q[e+" "];if(c)return t?0:c.slice(0);for(a=e,s=[],l=w.preFilter;a;){for(o in n&&!(i=Z.exec(a))||(i&&(a=a.slice(i[0].length)||a),s.push(r=[])),n=!1,(i=ee.exec(a))&&(n=i.shift(),r.push({value:n,type:i[0].replace(_," ")}),a=a.slice(n.length)),w.filter)!(i=h[o].exec(a))||l[o]&&!(i=l[o](i))||(n=i.shift(),r.push({value:n,type:o,matches:i}),a=a.slice(n.length));if(!n)break}return t?a.length:a?L.error(e):q(e,s).slice(0)},$=L.compile=function(e,t){var n,i=[],r=[],o=v[e+" "];if(!o){for(n=(t=t||f(e)).length;n--;)((o=function e(t){for(var i,n,r,o=t.length,a=w.relative[t[0].type],s=a||w.relative[" "],l=a?1:0,c=ge(function(e){return e===i},s,!0),d=ge(function(e){return-1<b(i,e)},s,!0),u=[function(e,t,n){return e=!a&&(n||t!==x)||((i=t).nodeType?c:d)(e,t,n),i=null,e}];l<o;l++)if(n=w.relative[t[l].type])u=[ge(ye(u),n)];else{if((n=w.filter[t[l].type].apply(null,t[l].matches))[k]){for(r=++l;r<o&&!w.relative[t[r].type];r++);return be(1<l&&ye(u),1<l&&B(t.slice(0,l-1).concat({value:" "===t[l-2].type?"*":""})).replace(_,"$1"),n,l<r&&e(t.slice(l,r)),r<o&&e(t=t.slice(r)),r<o&&B(t))}u.push(n)}return ye(u)}(t[n]))[k]?i:r).push(o);(o=v(e,we(r,i))).selector=e}return o},H=L.select=function(e,t,n,i){var r,o,a,s,l,c="function"==typeof e&&e,d=!i&&f(e=c.selector||e);if(n=n||[],1===d.length){if(2<(o=d[0]=d[0].slice(0)).length&&"ID"===(a=o[0]).type&&9===t.nodeType&&S&&w.relative[o[1].type]){if(!(t=(w.find.ID(a.matches[0].replace(M,u),t)||[])[0]))return n;c&&(t=t.parentNode),e=e.slice(o.shift().value.length)}for(r=h.needsContext.test(e)?0:o.length;r--&&(a=o[r],!w.relative[s=a.type]);)if((l=w.find[s])&&(i=l(a.matches[0].replace(M,u),se.test(o[0].type)&&fe(t.parentNode)||t))){if(o.splice(r,1),e=i.length&&B(o))break;return T.apply(n,i),n}}return(c||$(e,d))(i,t,!S,n,!t||se.test(e)&&fe(t.parentNode)||t),n},p.sortStable=k.split("").sort(W).join("")===k,p.detectDuplicates=!!c,C(),p.sortDetached=D(function(e){return 1&e.compareDocumentPosition(F.createElement("fieldset"))}),D(function(e){return e.innerHTML="<a href='#'></a>","#"===e.firstChild.getAttribute("href")})||ue("type|href|height|width",function(e,t,n){if(!n)return e.getAttribute(t,"type"===t.toLowerCase()?1:2)}),p.attributes&&D(function(e){return e.innerHTML="<input/>",e.firstChild.setAttribute("value",""),""===e.firstChild.getAttribute("value")})||ue("value",function(e,t,n){if(!n&&"input"===e.nodeName.toLowerCase())return e.defaultValue}),D(function(e){return null==e.getAttribute("disabled")})||ue(Y,function(e,t,n){if(!n)return!0===e[t]?t.toLowerCase():(n=e.getAttributeNode(t))&&n.specified?n.value:null}),L}(x),Q=(F.find=e,F.expr=e.selectors,F.expr[":"]=F.expr.pseudos,F.uniqueSort=F.unique=e.uniqueSort,F.text=e.getText,F.isXMLDoc=e.isXML,F.contains=e.contains,F.escapeSelector=e.escape,F.expr.match.needsContext);function l(e,t){return e.nodeName&&e.nodeName.toLowerCase()===t.toLowerCase()}var X=/^<([a-z][^\/\0>:\x20\t\r\n\f]*)[\x20\t\r\n\f]*\/?>(?:<\/\1>|)$/i;function Z(e,n,i){return v(n)?F.grep(e,function(e,t){return!!n.call(e,t,e)!==i}):n.nodeType?F.grep(e,function(e){return e===n!==i}):"string"!=typeof n?F.grep(e,function(e){return-1<H.call(n,e)!==i}):F.filter(n,e,i)}F.filter=function(e,t,n){var i=t[0];return n&&(e=":not("+e+")"),1===t.length&&1===i.nodeType?F.find.matchesSelector(i,e)?[i]:[]:F.find.matches(e,F.grep(t,function(e){return 1===e.nodeType}))},F.fn.extend({find:function(e){var t,n,i=this.length,r=this;if("string"!=typeof e)return this.pushStack(F(e).filter(function(){for(t=0;t<i;t++)if(F.contains(r[t],this))return!0}));for(n=this.pushStack([]),t=0;t<i;t++)F.find(e,r[t],n);return 1<i?F.uniqueSort(n):n},filter:function(e){return this.pushStack(Z(this,e||[],!1))},not:function(e){return this.pushStack(Z(this,e||[],!0))},is:function(e){return!!Z(this,"string"==typeof e&&Q.test(e)?F(e):e||[],!1).length}});var ee,te=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]+))$/,ne=((F.fn.init=function(e,t,n){if(e){if(n=n||ee,"string"!=typeof e)return e.nodeType?(this[0]=e,this.length=1,this):v(e)?void 0!==n.ready?n.ready(e):e(F):F.makeArray(e,this);if(!(i="<"===e[0]&&">"===e[e.length-1]&&3<=e.length?[null,e,null]:te.exec(e))||!i[1]&&t)return(!t||t.jquery?t||n:this.constructor(t)).find(e);if(i[1]){if(t=t instanceof F?t[0]:t,F.merge(this,F.parseHTML(i[1],t&&t.nodeType?t.ownerDocument||t:C,!0)),X.test(i[1])&&F.isPlainObject(t))for(var i in t)v(this[i])?this[i](t[i]):this.attr(i,t[i])}else(n=C.getElementById(i[2]))&&(this[0]=n,this.length=1)}return this}).prototype=F.fn,ee=F(C),/^(?:parents|prev(?:Until|All))/),ie={children:!0,contents:!0,next:!0,prev:!0};function re(e,t){for(;(e=e[t])&&1!==e.nodeType;);return e}F.fn.extend({has:function(e){var t=F(e,this),n=t.length;return this.filter(function(){for(var e=0;e<n;e++)if(F.contains(this,t[e]))return!0})},closest:function(e,t){var n,i=0,r=this.length,o=[],a="string"!=typeof e&&F(e);if(!Q.test(e))for(;i<r;i++)for(n=this[i];n&&n!==t;n=n.parentNode)if(n.nodeType<11&&(a?-1<a.index(n):1===n.nodeType&&F.find.matchesSelector(n,e))){o.push(n);break}return this.pushStack(1<o.length?F.uniqueSort(o):o)},index:function(e){return e?"string"==typeof e?H.call(F(e),this[0]):H.call(this,e.jquery?e[0]:e):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(e,t){return this.pushStack(F.uniqueSort(F.merge(this.get(),F(e,t))))},addBack:function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}}),F.each({parent:function(e){e=e.parentNode;return e&&11!==e.nodeType?e:null},parents:function(e){return i(e,"parentNode")},parentsUntil:function(e,t,n){return i(e,"parentNode",n)},next:function(e){return re(e,"nextSibling")},prev:function(e){return re(e,"previousSibling")},nextAll:function(e){return i(e,"nextSibling")},prevAll:function(e){return i(e,"previousSibling")},nextUntil:function(e,t,n){return i(e,"nextSibling",n)},prevUntil:function(e,t,n){return i(e,"previousSibling",n)},siblings:function(e){return G((e.parentNode||{}).firstChild,e)},children:function(e){return G(e.firstChild)},contents:function(e){return l(e,"iframe")?e.contentDocument:(l(e,"template")&&(e=e.content||e),F.merge([],e.childNodes))}},function(i,r){F.fn[i]=function(e,t){var n=F.map(this,r,e);return(t="Until"!==i.slice(-5)?e:t)&&"string"==typeof t&&(n=F.filter(t,n)),1<this.length&&(ie[i]||F.uniqueSort(n),ne.test(i))&&n.reverse(),this.pushStack(n)}});var S=/[^\x20\t\r\n\f]+/g;function d(e){return e}function oe(e){throw e}function ae(e,t,n,i){var r;try{e&&v(r=e.promise)?r.call(e).done(t).fail(n):e&&v(r=e.then)?r.call(e,t,n):t.apply(void 0,[e].slice(i))}catch(e){n.apply(void 0,[e])}}F.Callbacks=function(i){var e,n;i="string"==typeof i?(e=i,n={},F.each(e.match(S)||[],function(e,t){n[t]=!0}),n):F.extend({},i);function r(){for(s=s||i.once,a=o=!0;c.length;d=-1)for(t=c.shift();++d<l.length;)!1===l[d].apply(t[0],t[1])&&i.stopOnFalse&&(d=l.length,t=!1);i.memory||(t=!1),o=!1,s&&(l=t?[]:"")}var o,t,a,s,l=[],c=[],d=-1,u={add:function(){return l&&(t&&!o&&(d=l.length-1,c.push(t)),function n(e){F.each(e,function(e,t){v(t)?i.unique&&u.has(t)||l.push(t):t&&t.length&&"string"!==f(t)&&n(t)})}(arguments),t)&&!o&&r(),this},remove:function(){return F.each(arguments,function(e,t){for(var n;-1<(n=F.inArray(t,l,n));)l.splice(n,1),n<=d&&d--}),this},has:function(e){return e?-1<F.inArray(e,l):0<l.length},empty:function(){return l=l&&[],this},disable:function(){return s=c=[],l=t="",this},disabled:function(){return!l},lock:function(){return s=c=[],t||o||(l=t=""),this},locked:function(){return!!s},fireWith:function(e,t){return s||(t=[e,(t=t||[]).slice?t.slice():t],c.push(t),o)||r(),this},fire:function(){return u.fireWith(this,arguments),this},fired:function(){return!!a}};return u},F.extend({Deferred:function(e){var o=[["notify","progress",F.Callbacks("memory"),F.Callbacks("memory"),2],["resolve","done",F.Callbacks("once memory"),F.Callbacks("once memory"),0,"resolved"],["reject","fail",F.Callbacks("once memory"),F.Callbacks("once memory"),1,"rejected"]],r="pending",a={state:function(){return r},always:function(){return s.done(arguments).fail(arguments),this},catch:function(e){return a.then(null,e)},pipe:function(){var r=arguments;return F.Deferred(function(i){F.each(o,function(e,t){var n=v(r[t[4]])&&r[t[4]];s[t[1]](function(){var e=n&&n.apply(this,arguments);e&&v(e.promise)?e.promise().progress(i.notify).done(i.resolve).fail(i.reject):i[t[0]+"With"](this,n?[e]:arguments)})}),r=null}).promise()},then:function(t,n,i){var l=0;function c(r,o,a,s){return function(){function e(){var e,t;if(!(r<l)){if((e=a.apply(n,i))===o.promise())throw new TypeError("Thenable self-resolution");t=e&&("object"==typeof e||"function"==typeof e)&&e.then,v(t)?s?t.call(e,c(l,o,d,s),c(l,o,oe,s)):(l++,t.call(e,c(l,o,d,s),c(l,o,oe,s),c(l,o,d,o.notifyWith))):(a!==d&&(n=void 0,i=[e]),(s||o.resolveWith)(n,i))}}var n=this,i=arguments,t=s?e:function(){try{e()}catch(e){F.Deferred.exceptionHook&&F.Deferred.exceptionHook(e,t.stackTrace),l<=r+1&&(a!==oe&&(n=void 0,i=[e]),o.rejectWith(n,i))}};r?t():(F.Deferred.getStackHook&&(t.stackTrace=F.Deferred.getStackHook()),x.setTimeout(t))}}return F.Deferred(function(e){o[0][3].add(c(0,e,v(i)?i:d,e.notifyWith)),o[1][3].add(c(0,e,v(t)?t:d)),o[2][3].add(c(0,e,v(n)?n:oe))}).promise()},promise:function(e){return null!=e?F.extend(e,a):a}},s={};return F.each(o,function(e,t){var n=t[2],i=t[5];a[t[1]]=n.add,i&&n.add(function(){r=i},o[3-e][2].disable,o[3-e][3].disable,o[0][2].lock,o[0][3].lock),n.add(t[3].fire),s[t[0]]=function(){return s[t[0]+"With"](this===s?void 0:this,arguments),this},s[t[0]+"With"]=n.fireWith}),a.promise(s),e&&e.call(s,s),s},when:function(e){function t(t){return function(e){r[t]=this,o[t]=1<arguments.length?s.call(arguments):e,--n||a.resolveWith(r,o)}}var n=arguments.length,i=n,r=Array(i),o=s.call(arguments),a=F.Deferred();if(n<=1&&(ae(e,a.done(t(i)).resolve,a.reject,!n),"pending"===a.state()||v(o[i]&&o[i].then)))return a.then();for(;i--;)ae(o[i],t(i),a.reject);return a.promise()}});var se=/^(Eval|Internal|Range|Reference|Syntax|Type|URI)Error$/,le=(F.Deferred.exceptionHook=function(e,t){x.console&&x.console.warn&&e&&se.test(e.name)&&x.console.warn("jQuery.Deferred exception: "+e.message,e.stack,t)},F.readyException=function(e){x.setTimeout(function(){throw e})},F.Deferred());function ce(){C.removeEventListener("DOMContentLoaded",ce),x.removeEventListener("load",ce),F.ready()}F.fn.ready=function(e){return le.then(e).catch(function(e){F.readyException(e)}),this},F.extend({isReady:!1,readyWait:1,ready:function(e){(!0===e?--F.readyWait:F.isReady)||(F.isReady=!0)!==e&&0<--F.readyWait||le.resolveWith(C,[F])}}),F.ready.then=le.then,"complete"===C.readyState||"loading"!==C.readyState&&!C.documentElement.doScroll?x.setTimeout(F.ready):(C.addEventListener("DOMContentLoaded",ce),x.addEventListener("load",ce));function u(e,t,n,i,r,o,a){var s=0,l=e.length,c=null==n;if("object"===f(n))for(s in r=!0,n)u(e,t,s,n[s],!0,o,a);else if(void 0!==i&&(r=!0,v(i)||(a=!0),t=c?a?(t.call(e,i),null):(c=t,function(e,t,n){return c.call(F(e),n)}):t))for(;s<l;s++)t(e[s],n,a?i:i.call(e[s],s,t(e[s],n)));return r?e:c?t.call(e):l?t(e[0],n):o}var de=/^-ms-/,ue=/-([a-z])/g;function he(e,t){return t.toUpperCase()}function b(e){return e.replace(de,"ms-").replace(ue,he)}function pe(e){return 1===e.nodeType||9===e.nodeType||!+e.nodeType}function t(){this.expando=F.expando+t.uid++}t.uid=1,t.prototype={cache:function(e){var t=e[this.expando];return t||(t={},pe(e)&&(e.nodeType?e[this.expando]=t:Object.defineProperty(e,this.expando,{value:t,configurable:!0}))),t},set:function(e,t,n){var i,r=this.cache(e);if("string"==typeof t)r[b(t)]=n;else for(i in t)r[b(i)]=t[i];return r},get:function(e,t){return void 0===t?this.cache(e):e[this.expando]&&e[this.expando][b(t)]},access:function(e,t,n){return void 0===t||t&&"string"==typeof t&&void 0===n?this.get(e,t):(this.set(e,t,n),void 0!==n?n:t)},remove:function(e,t){var n,i=e[this.expando];if(void 0!==i){if(void 0!==t){n=(t=Array.isArray(t)?t.map(b):(t=b(t))in i?[t]:t.match(S)||[]).length;for(;n--;)delete i[t[n]]}void 0!==t&&!F.isEmptyObject(i)||(e.nodeType?e[this.expando]=void 0:delete e[this.expando])}},hasData:function(e){e=e[this.expando];return void 0!==e&&!F.isEmptyObject(e)}};var y=new t,c=new t,fe=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,me=/[A-Z]/g;function ge(e,t,n){var i,r;if(void 0===n&&1===e.nodeType)if(i="data-"+t.replace(me,"-$&").toLowerCase(),"string"==typeof(n=e.getAttribute(i))){try{n="true"===(r=n)||"false"!==r&&("null"===r?null:r===+r+""?+r:fe.test(r)?JSON.parse(r):r)}catch(e){}c.set(e,t,n)}else n=void 0;return n}F.extend({hasData:function(e){return c.hasData(e)||y.hasData(e)},data:function(e,t,n){return c.access(e,t,n)},removeData:function(e,t){c.remove(e,t)},_data:function(e,t,n){return y.access(e,t,n)},_removeData:function(e,t){y.remove(e,t)}}),F.fn.extend({data:function(n,e){var t,i,r,o=this[0],a=o&&o.attributes;if(void 0!==n)return"object"==typeof n?this.each(function(){c.set(this,n)}):u(this,function(e){var t;if(o&&void 0===e)return void 0!==(t=c.get(o,n))||void 0!==(t=ge(o,n))?t:void 0;this.each(function(){c.set(this,n,e)})},null,e,1<arguments.length,null,!0);if(this.length&&(r=c.get(o),1===o.nodeType)&&!y.get(o,"hasDataAttrs")){for(t=a.length;t--;)a[t]&&0===(i=a[t].name).indexOf("data-")&&(i=b(i.slice(5)),ge(o,i,r[i]));y.set(o,"hasDataAttrs",!0)}return r},removeData:function(e){return this.each(function(){c.remove(this,e)})}}),F.extend({queue:function(e,t,n){var i;if(e)return i=y.get(e,t=(t||"fx")+"queue"),n&&(!i||Array.isArray(n)?i=y.access(e,t,F.makeArray(n)):i.push(n)),i||[]},dequeue:function(e,t){t=t||"fx";var n=F.queue(e,t),i=n.length,r=n.shift(),o=F._queueHooks(e,t);"inprogress"===r&&(r=n.shift(),i--),r&&("fx"===t&&n.unshift("inprogress"),delete o.stop,r.call(e,function(){F.dequeue(e,t)},o)),!i&&o&&o.empty.fire()},_queueHooks:function(e,t){var n=t+"queueHooks";return y.get(e,n)||y.access(e,n,{empty:F.Callbacks("once memory").add(function(){y.remove(e,[t+"queue",n])})})}}),F.fn.extend({queue:function(t,n){var e=2;return"string"!=typeof t&&(n=t,t="fx",e--),arguments.length<e?F.queue(this[0],t):void 0===n?this:this.each(function(){var e=F.queue(this,t,n);F._queueHooks(this,t),"fx"===t&&"inprogress"!==e[0]&&F.dequeue(this,t)})},dequeue:function(e){return this.each(function(){F.dequeue(this,e)})},clearQueue:function(e){return this.queue(e||"fx",[])},promise:function(e,t){function n(){--r||o.resolveWith(a,[a])}var i,r=1,o=F.Deferred(),a=this,s=this.length;for("string"!=typeof e&&(t=e,e=void 0),e=e||"fx";s--;)(i=y.get(a[s],e+"queueHooks"))&&i.empty&&(r++,i.empty.add(n));return n(),o.promise(t)}});function ye(e,t){return"none"===(e=t||e).style.display||""===e.style.display&&F.contains(e.ownerDocument,e)&&"none"===F.css(e,"display")}function ve(e,t,n,i){var r,o={};for(r in t)o[r]=e.style[r],e.style[r]=t[r];for(r in n=n.apply(e,i||[]),t)e.style[r]=o[r];return n}var e=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,h=new RegExp("^(?:([+-])=|)("+e+")([a-z%]*)$","i"),p=["Top","Right","Bottom","Left"];function be(e,t,n,i){var r,o,a=20,s=i?function(){return i.cur()}:function(){return F.css(e,t,"")},l=s(),c=n&&n[3]||(F.cssNumber[t]?"":"px"),d=(F.cssNumber[t]||"px"!==c&&+l)&&h.exec(F.css(e,t));if(d&&d[3]!==c){for(c=c||d[3],d=+(l/=2)||1;a--;)F.style(e,t,d+c),(1-o)*(1-(o=s()/l||.5))<=0&&(a=0),d/=o;F.style(e,t,(d*=2)+c),n=n||[]}return n&&(d=+d||+l||0,r=n[1]?d+(n[1]+1)*n[2]:+n[2],i)&&(i.unit=c,i.start=d,i.end=r),r}var we={};function w(e,t){for(var n,i,r,o,a,s=[],l=0,c=e.length;l<c;l++)(i=e[l]).style&&(n=i.style.display,t?("none"===n&&(s[l]=y.get(i,"display")||null,s[l]||(i.style.display="")),""===i.style.display&&ye(i)&&(s[l]=(a=o=void 0,o=(r=i).ownerDocument,r=r.nodeName,(a=we[r])||(o=o.body.appendChild(o.createElement(r)),a=F.css(o,"display"),o.parentNode.removeChild(o),we[r]=a="none"===a?"block":a)))):"none"!==n&&(s[l]="none",y.set(i,"display",n)));for(l=0;l<c;l++)null!=s[l]&&(e[l].style.display=s[l]);return e}F.fn.extend({show:function(){return w(this,!0)},hide:function(){return w(this)},toggle:function(e){return"boolean"==typeof e?e?this.show():this.hide():this.each(function(){ye(this)?F(this).show():F(this).hide()})}});var xe=/^(?:checkbox|radio)$/i,Ce=/<([a-z][^\/\0>\x20\t\r\n\f]+)/i,Fe=/^$|^module$|\/(?:java|ecma)script/i,k={option:[1,"<select multiple='multiple'>","</select>"],thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};function E(e,t){var n=void 0!==e.getElementsByTagName?e.getElementsByTagName(t||"*"):void 0!==e.querySelectorAll?e.querySelectorAll(t||"*"):[];return void 0===t||t&&l(e,t)?F.merge([e],n):n}function Se(e,t){for(var n=0,i=e.length;n<i;n++)y.set(e[n],"globalEval",!t||y.get(t[n],"globalEval"))}k.optgroup=k.option,k.tbody=k.tfoot=k.colgroup=k.caption=k.thead,k.th=k.td;var ke=/<|&#?\w+;/;function Ee(e,t,n,i,r){for(var o,a,s,l,c,d=t.createDocumentFragment(),u=[],h=0,p=e.length;h<p;h++)if((o=e[h])||0===o)if("object"===f(o))F.merge(u,o.nodeType?[o]:o);else if(ke.test(o)){for(a=a||d.appendChild(t.createElement("div")),s=(Ce.exec(o)||["",""])[1].toLowerCase(),s=k[s]||k._default,a.innerHTML=s[1]+F.htmlPrefilter(o)+s[2],c=s[0];c--;)a=a.lastChild;F.merge(u,a.childNodes),(a=d.firstChild).textContent=""}else u.push(t.createTextNode(o));for(d.textContent="",h=0;o=u[h++];)if(i&&-1<F.inArray(o,i))r&&r.push(o);else if(l=F.contains(o.ownerDocument,o),a=E(d.appendChild(o),"script"),l&&Se(a),n)for(c=0;o=a[c++];)Fe.test(o.type||"")&&n.push(o);return d}L=C.createDocumentFragment().appendChild(C.createElement("div")),(a=C.createElement("input")).setAttribute("type","radio"),a.setAttribute("checked","checked"),a.setAttribute("name","t"),L.appendChild(a),g.checkClone=L.cloneNode(!0).cloneNode(!0).lastChild.checked,L.innerHTML="<textarea>x</textarea>",g.noCloneChecked=!!L.cloneNode(!0).lastChild.defaultValue;var Te=C.documentElement,_e=/^key/,Ae=/^(?:mouse|pointer|contextmenu|drag|drop)|click/,Me=/^([^.]*)(?:\.(.+)|)/;function Le(){return!0}function T(){return!1}function Ne(){try{return C.activeElement}catch(e){}}function De(e,t,n,i,r,o){var a,s;if("object"==typeof t){for(s in"string"!=typeof n&&(i=i||n,n=void 0),t)De(e,s,n,i,t[s],o);return e}if(null==i&&null==r?(r=n,i=n=void 0):null==r&&("string"==typeof n?(r=i,i=void 0):(r=i,i=n,n=void 0)),!1===r)r=T;else if(!r)return e;return 1===o&&(a=r,(r=function(e){return F().off(e),a.apply(this,arguments)}).guid=a.guid||(a.guid=F.guid++)),e.each(function(){F.event.add(this,t,r,i,n)})}F.event={global:{},add:function(t,e,n,i,r){var o,a,s,l,c,d,u,h,p,f=y.get(t);if(f)for(n.handler&&(n=(o=n).handler,r=o.selector),r&&F.find.matchesSelector(Te,r),n.guid||(n.guid=F.guid++),s=(s=f.events)||(f.events={}),a=(a=f.handle)||(f.handle=function(e){return void 0!==F&&F.event.triggered!==e.type?F.event.dispatch.apply(t,arguments):void 0}),l=(e=(e||"").match(S)||[""]).length;l--;)u=p=(h=Me.exec(e[l])||[])[1],h=(h[2]||"").split(".").sort(),u&&(c=F.event.special[u]||{},u=(r?c.delegateType:c.bindType)||u,c=F.event.special[u]||{},p=F.extend({type:u,origType:p,data:i,handler:n,guid:n.guid,selector:r,needsContext:r&&F.expr.match.needsContext.test(r),namespace:h.join(".")},o),(d=s[u])||((d=s[u]=[]).delegateCount=0,c.setup&&!1!==c.setup.call(t,i,h,a))||t.addEventListener&&t.addEventListener(u,a),c.add&&(c.add.call(t,p),p.handler.guid||(p.handler.guid=n.guid)),r?d.splice(d.delegateCount++,0,p):d.push(p),F.event.global[u]=!0)},remove:function(e,t,n,i,r){var o,a,s,l,c,d,u,h,p,f,m,g=y.hasData(e)&&y.get(e);if(g&&(l=g.events)){for(c=(t=(t||"").match(S)||[""]).length;c--;)if(p=m=(s=Me.exec(t[c])||[])[1],f=(s[2]||"").split(".").sort(),p){for(u=F.event.special[p]||{},h=l[p=(i?u.delegateType:u.bindType)||p]||[],s=s[2]&&new RegExp("(^|\\.)"+f.join("\\.(?:.*\\.|)")+"(\\.|$)"),a=o=h.length;o--;)d=h[o],!r&&m!==d.origType||n&&n.guid!==d.guid||s&&!s.test(d.namespace)||i&&i!==d.selector&&("**"!==i||!d.selector)||(h.splice(o,1),d.selector&&h.delegateCount--,u.remove&&u.remove.call(e,d));a&&!h.length&&(u.teardown&&!1!==u.teardown.call(e,f,g.handle)||F.removeEvent(e,p,g.handle),delete l[p])}else for(p in l)F.event.remove(e,p+t[c],n,i,!0);F.isEmptyObject(l)&&y.remove(e,"handle events")}},dispatch:function(e){var t,n,i,r,o,a=F.event.fix(e),s=new Array(arguments.length),e=(y.get(this,"events")||{})[a.type]||[],l=F.event.special[a.type]||{};for(s[0]=a,t=1;t<arguments.length;t++)s[t]=arguments[t];if(a.delegateTarget=this,!l.preDispatch||!1!==l.preDispatch.call(this,a)){for(o=F.event.handlers.call(this,a,e),t=0;(i=o[t++])&&!a.isPropagationStopped();)for(a.currentTarget=i.elem,n=0;(r=i.handlers[n++])&&!a.isImmediatePropagationStopped();)a.rnamespace&&!a.rnamespace.test(r.namespace)||(a.handleObj=r,a.data=r.data,void 0!==(r=((F.event.special[r.origType]||{}).handle||r.handler).apply(i.elem,s))&&!1===(a.result=r)&&(a.preventDefault(),a.stopPropagation()));return l.postDispatch&&l.postDispatch.call(this,a),a.result}},handlers:function(e,t){var n,i,r,o,a,s=[],l=t.delegateCount,c=e.target;if(l&&c.nodeType&&!("click"===e.type&&1<=e.button))for(;c!==this;c=c.parentNode||this)if(1===c.nodeType&&("click"!==e.type||!0!==c.disabled)){for(o=[],a={},n=0;n<l;n++)void 0===a[r=(i=t[n]).selector+" "]&&(a[r]=i.needsContext?-1<F(r,this).index(c):F.find(r,this,null,[c]).length),a[r]&&o.push(i);o.length&&s.push({elem:c,handlers:o})}return c=this,l<t.length&&s.push({elem:c,handlers:t.slice(l)}),s},addProp:function(t,e){Object.defineProperty(F.Event.prototype,t,{enumerable:!0,configurable:!0,get:v(e)?function(){if(this.originalEvent)return e(this.originalEvent)}:function(){if(this.originalEvent)return this.originalEvent[t]},set:function(e){Object.defineProperty(this,t,{enumerable:!0,configurable:!0,writable:!0,value:e})}})},fix:function(e){return e[F.expando]?e:new F.Event(e)},special:{load:{noBubble:!0},focus:{trigger:function(){if(this!==Ne()&&this.focus)return this.focus(),!1},delegateType:"focusin"},blur:{trigger:function(){if(this===Ne()&&this.blur)return this.blur(),!1},delegateType:"focusout"},click:{trigger:function(){if("checkbox"===this.type&&this.click&&l(this,"input"))return this.click(),!1},_default:function(e){return l(e.target,"a")}},beforeunload:{postDispatch:function(e){void 0!==e.result&&e.originalEvent&&(e.originalEvent.returnValue=e.result)}}}},F.removeEvent=function(e,t,n){e.removeEventListener&&e.removeEventListener(t,n)},F.Event=function(e,t){if(!(this instanceof F.Event))return new F.Event(e,t);e&&e.type?(this.originalEvent=e,this.type=e.type,this.isDefaultPrevented=e.defaultPrevented||void 0===e.defaultPrevented&&!1===e.returnValue?Le:T,this.target=e.target&&3===e.target.nodeType?e.target.parentNode:e.target,this.currentTarget=e.currentTarget,this.relatedTarget=e.relatedTarget):this.type=e,t&&F.extend(this,t),this.timeStamp=e&&e.timeStamp||Date.now(),this[F.expando]=!0},F.Event.prototype={constructor:F.Event,isDefaultPrevented:T,isPropagationStopped:T,isImmediatePropagationStopped:T,isSimulated:!1,preventDefault:function(){var e=this.originalEvent;this.isDefaultPrevented=Le,e&&!this.isSimulated&&e.preventDefault()},stopPropagation:function(){var e=this.originalEvent;this.isPropagationStopped=Le,e&&!this.isSimulated&&e.stopPropagation()},stopImmediatePropagation:function(){var e=this.originalEvent;this.isImmediatePropagationStopped=Le,e&&!this.isSimulated&&e.stopImmediatePropagation(),this.stopPropagation()}},F.each({altKey:!0,bubbles:!0,cancelable:!0,changedTouches:!0,ctrlKey:!0,detail:!0,eventPhase:!0,metaKey:!0,pageX:!0,pageY:!0,shiftKey:!0,view:!0,char:!0,charCode:!0,key:!0,keyCode:!0,button:!0,buttons:!0,clientX:!0,clientY:!0,offsetX:!0,offsetY:!0,pointerId:!0,pointerType:!0,screenX:!0,screenY:!0,targetTouches:!0,toElement:!0,touches:!0,which:function(e){var t=e.button;return null==e.which&&_e.test(e.type)?null!=e.charCode?e.charCode:e.keyCode:!e.which&&void 0!==t&&Ae.test(e.type)?1&t?1:2&t?3:4&t?2:0:e.which}},F.event.addProp),F.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},function(e,r){F.event.special[e]={delegateType:r,bindType:r,handle:function(e){var t,n=e.relatedTarget,i=e.handleObj;return n&&(n===this||F.contains(this,n))||(e.type=i.origType,t=i.handler.apply(this,arguments),e.type=r),t}}}),F.fn.extend({on:function(e,t,n,i){return De(this,e,t,n,i)},one:function(e,t,n,i){return De(this,e,t,n,i,1)},off:function(e,t,n){var i,r;if(e&&e.preventDefault&&e.handleObj)i=e.handleObj,F(e.delegateTarget).off(i.namespace?i.origType+"."+i.namespace:i.origType,i.selector,i.handler);else{if("object"!=typeof e)return!1!==t&&"function"!=typeof t||(n=t,t=void 0),!1===n&&(n=T),this.each(function(){F.event.remove(this,e,n,t)});for(r in e)this.off(r,t,e[r])}return this}});var Pe=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([a-z][^\/\0>\x20\t\r\n\f]*)[^>]*)\/>/gi,Be=/<script|<style|<link/i,Re=/checked\s*(?:[^=]|=\s*.checked.)/i,Oe=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g;function Ie(e,t){return l(e,"table")&&l(11!==t.nodeType?t:t.firstChild,"tr")&&F(e).children("tbody")[0]||e}function $e(e){return e.type=(null!==e.getAttribute("type"))+"/"+e.type,e}function He(e){return"true/"===(e.type||"").slice(0,5)?e.type=e.type.slice(5):e.removeAttribute("type"),e}function Ue(e,t){var n,i,r,o,a,s;if(1===t.nodeType){if(y.hasData(e)&&(o=y.access(e),a=y.set(t,o),s=o.events))for(r in delete a.handle,a.events={},s)for(n=0,i=s[r].length;n<i;n++)F.event.add(t,r,s[r][n]);c.hasData(e)&&(o=c.access(e),a=F.extend({},o),c.set(t,a))}}function _(n,i,r,o){i=I.apply([],i);var e,t,a,s,l,c,d=0,u=n.length,h=u-1,p=i[0],f=v(p);if(f||1<u&&"string"==typeof p&&!g.checkClone&&Re.test(p))return n.each(function(e){var t=n.eq(e);f&&(i[0]=p.call(this,e,t.html())),_(t,i,r,o)});if(u&&(t=(e=Ee(i,n[0].ownerDocument,!1,n,o)).firstChild,1===e.childNodes.length&&(e=t),t||o)){for(s=(a=F.map(E(e,"script"),$e)).length;d<u;d++)l=e,d!==h&&(l=F.clone(l,!0,!0),s)&&F.merge(a,E(l,"script")),r.call(n[d],l,d);if(s)for(c=a[a.length-1].ownerDocument,F.map(a,He),d=0;d<s;d++)l=a[d],Fe.test(l.type||"")&&!y.access(l,"globalEval")&&F.contains(c,l)&&(l.src&&"module"!==(l.type||"").toLowerCase()?F._evalUrl&&F._evalUrl(l.src):J(l.textContent.replace(Oe,""),c,l))}return n}function je(e,t,n){for(var i,r=t?F.filter(t,e):e,o=0;null!=(i=r[o]);o++)n||1!==i.nodeType||F.cleanData(E(i)),i.parentNode&&(n&&F.contains(i.ownerDocument,i)&&Se(E(i,"script")),i.parentNode.removeChild(i));return e}F.extend({htmlPrefilter:function(e){return e.replace(Pe,"<$1></$2>")},clone:function(e,t,n){var i,r,o,a,s,l,c,d=e.cloneNode(!0),u=F.contains(e.ownerDocument,e);if(!(g.noCloneChecked||1!==e.nodeType&&11!==e.nodeType||F.isXMLDoc(e)))for(a=E(d),i=0,r=(o=E(e)).length;i<r;i++)s=o[i],l=a[i],c=void 0,"input"===(c=l.nodeName.toLowerCase())&&xe.test(s.type)?l.checked=s.checked:"input"!==c&&"textarea"!==c||(l.defaultValue=s.defaultValue);if(t)if(n)for(o=o||E(e),a=a||E(d),i=0,r=o.length;i<r;i++)Ue(o[i],a[i]);else Ue(e,d);return 0<(a=E(d,"script")).length&&Se(a,!u&&E(e,"script")),d},cleanData:function(e){for(var t,n,i,r=F.event.special,o=0;void 0!==(n=e[o]);o++)if(pe(n)){if(t=n[y.expando]){if(t.events)for(i in t.events)r[i]?F.event.remove(n,i):F.removeEvent(n,i,t.handle);n[y.expando]=void 0}n[c.expando]&&(n[c.expando]=void 0)}}}),F.fn.extend({detach:function(e){return je(this,e,!0)},remove:function(e){return je(this,e)},text:function(e){return u(this,function(e){return void 0===e?F.text(this):this.empty().each(function(){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||(this.textContent=e)})},null,e,arguments.length)},append:function(){return _(this,arguments,function(e){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||Ie(this,e).appendChild(e)})},prepend:function(){return _(this,arguments,function(e){var t;1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||(t=Ie(this,e)).insertBefore(e,t.firstChild)})},before:function(){return _(this,arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this)})},after:function(){return _(this,arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this.nextSibling)})},empty:function(){for(var e,t=0;null!=(e=this[t]);t++)1===e.nodeType&&(F.cleanData(E(e,!1)),e.textContent="");return this},clone:function(e,t){return e=null!=e&&e,t=null==t?e:t,this.map(function(){return F.clone(this,e,t)})},html:function(e){return u(this,function(e){var t=this[0]||{},n=0,i=this.length;if(void 0===e&&1===t.nodeType)return t.innerHTML;if("string"==typeof e&&!Be.test(e)&&!k[(Ce.exec(e)||["",""])[1].toLowerCase()]){e=F.htmlPrefilter(e);try{for(;n<i;n++)1===(t=this[n]||{}).nodeType&&(F.cleanData(E(t,!1)),t.innerHTML=e);t=0}catch(e){}}t&&this.empty().append(e)},null,e,arguments.length)},replaceWith:function(){var n=[];return _(this,arguments,function(e){var t=this.parentNode;F.inArray(this,n)<0&&(F.cleanData(E(this)),t)&&t.replaceChild(e,this)},n)}}),F.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(e,a){F.fn[e]=function(e){for(var t,n=[],i=F(e),r=i.length-1,o=0;o<=r;o++)t=o===r?this:this.clone(!0),F(i[o])[a](t),$.apply(n,t.get());return this.pushStack(n)}});function qe(e){var t=e.ownerDocument.defaultView;return(t=t&&t.opener?t:x).getComputedStyle(e)}var We,ze,Ve,Je,Ke,Ye,n,Ge=new RegExp("^("+e+")(?!px)[a-z%]+$","i"),Qe=new RegExp(p.join("|"),"i");function r(){var e;n&&(Ye.style.cssText="position:absolute;left:-11111px;width:60px;margin-top:1px;padding:0;border:0",n.style.cssText="position:relative;display:block;box-sizing:border-box;overflow:scroll;margin:auto;border:1px;padding:1px;width:60%;top:1%",Te.appendChild(Ye).appendChild(n),e=x.getComputedStyle(n),We="1%"!==e.top,Ke=12===Xe(e.marginLeft),n.style.right="60%",Je=36===Xe(e.right),ze=36===Xe(e.width),n.style.position="absolute",Ve=36===n.offsetWidth||"absolute",Te.removeChild(Ye),n=null)}function Xe(e){return Math.round(parseFloat(e))}function A(e,t,n){var i,r,o=e.style;return(n=n||qe(e))&&(""!==(r=n.getPropertyValue(t)||n[t])||F.contains(e.ownerDocument,e)||(r=F.style(e,t)),!g.pixelBoxStyles())&&Ge.test(r)&&Qe.test(t)&&(e=o.width,t=o.minWidth,i=o.maxWidth,o.minWidth=o.maxWidth=o.width=r,r=n.width,o.width=e,o.minWidth=t,o.maxWidth=i),void 0!==r?r+"":r}function Ze(e,t){return{get:function(){if(!e())return(this.get=t).apply(this,arguments);delete this.get}}}Ye=C.createElement("div"),(n=C.createElement("div")).style&&(n.style.backgroundClip="content-box",n.cloneNode(!0).style.backgroundClip="",g.clearCloneStyle="content-box"===n.style.backgroundClip,F.extend(g,{boxSizingReliable:function(){return r(),ze},pixelBoxStyles:function(){return r(),Je},pixelPosition:function(){return r(),We},reliableMarginLeft:function(){return r(),Ke},scrollboxSize:function(){return r(),Ve}}));var et=/^(none|table(?!-c[ea]).+)/,tt=/^--/,nt={position:"absolute",visibility:"hidden",display:"block"},it={letterSpacing:"0",fontWeight:"400"},rt=["Webkit","Moz","ms"],ot=C.createElement("div").style;function at(e){return F.cssProps[e]||(F.cssProps[e]=function(e){if(e in ot)return e;for(var t=e[0].toUpperCase()+e.slice(1),n=rt.length;n--;)if((e=rt[n]+t)in ot)return e}(e)||e)}function st(e,t,n){var i=h.exec(t);return i?Math.max(0,i[2]-(n||0))+(i[3]||"px"):t}function lt(e,t,n,i,r,o){var a="width"===t?1:0,s=0,l=0;if(n===(i?"border":"content"))return 0;for(;a<4;a+=2)"margin"===n&&(l+=F.css(e,n+p[a],!0,r)),i?("content"===n&&(l-=F.css(e,"padding"+p[a],!0,r)),"margin"!==n&&(l-=F.css(e,"border"+p[a]+"Width",!0,r))):(l+=F.css(e,"padding"+p[a],!0,r),"padding"!==n?l+=F.css(e,"border"+p[a]+"Width",!0,r):s+=F.css(e,"border"+p[a]+"Width",!0,r));return!i&&0<=o&&(l+=Math.max(0,Math.ceil(e["offset"+t[0].toUpperCase()+t.slice(1)]-o-l-s-.5))),l}function ct(e,t,n){var i=qe(e),r=A(e,t,i),o="border-box"===F.css(e,"boxSizing",!1,i),a=o;if(Ge.test(r)){if(!n)return r;r="auto"}return a=a&&(g.boxSizingReliable()||r===e.style[t]),"auto"!==r&&(parseFloat(r)||"inline"!==F.css(e,"display",!1,i))||(r=e["offset"+t[0].toUpperCase()+t.slice(1)],a=!0),(r=parseFloat(r)||0)+lt(e,t,n||(o?"border":"content"),a,i,r)+"px"}function o(e,t,n,i,r){return new o.prototype.init(e,t,n,i,r)}F.extend({cssHooks:{opacity:{get:function(e,t){if(t)return""===(t=A(e,"opacity"))?"1":t}}},cssNumber:{animationIterationCount:!0,columnCount:!0,fillOpacity:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{},style:function(e,t,n,i){if(e&&3!==e.nodeType&&8!==e.nodeType&&e.style){var r,o,a,s=b(t),l=tt.test(t),c=e.style;if(l||(t=at(s)),a=F.cssHooks[t]||F.cssHooks[s],void 0===n)return a&&"get"in a&&void 0!==(r=a.get(e,!1,i))?r:c[t];"string"==(o=typeof n)&&(r=h.exec(n))&&r[1]&&(n=be(e,t,r),o="number"),null!=n&&n==n&&("number"===o&&(n+=r&&r[3]||(F.cssNumber[s]?"":"px")),g.clearCloneStyle||""!==n||0!==t.indexOf("background")||(c[t]="inherit"),a&&"set"in a&&void 0===(n=a.set(e,n,i))||(l?c.setProperty(t,n):c[t]=n))}},css:function(e,t,n,i){var r,o=b(t);return tt.test(t)||(t=at(o)),"normal"===(r=void 0===(r=(o=F.cssHooks[t]||F.cssHooks[o])&&"get"in o?o.get(e,!0,n):r)?A(e,t,i):r)&&t in it&&(r=it[t]),(""===n||n)&&(o=parseFloat(r),!0===n||isFinite(o))?o||0:r}}),F.each(["height","width"],function(e,o){F.cssHooks[o]={get:function(e,t,n){if(t)return!et.test(F.css(e,"display"))||e.getClientRects().length&&e.getBoundingClientRect().width?ct(e,o,n):ve(e,nt,function(){return ct(e,o,n)})},set:function(e,t,n){var i=qe(e),r="border-box"===F.css(e,"boxSizing",!1,i),n=n&&lt(e,o,n,r,i);return r&&g.scrollboxSize()===i.position&&(n-=Math.ceil(e["offset"+o[0].toUpperCase()+o.slice(1)]-parseFloat(i[o])-lt(e,o,"border",!1,i)-.5)),n&&(r=h.exec(t))&&"px"!==(r[3]||"px")&&(e.style[o]=t,t=F.css(e,o)),st(0,t,n)}}}),F.cssHooks.marginLeft=Ze(g.reliableMarginLeft,function(e,t){if(t)return(parseFloat(A(e,"marginLeft"))||e.getBoundingClientRect().left-ve(e,{marginLeft:0},function(){return e.getBoundingClientRect().left}))+"px"}),F.each({margin:"",padding:"",border:"Width"},function(r,o){F.cssHooks[r+o]={expand:function(e){for(var t=0,n={},i="string"==typeof e?e.split(" "):[e];t<4;t++)n[r+p[t]+o]=i[t]||i[t-2]||i[0];return n}},"margin"!==r&&(F.cssHooks[r+o].set=st)}),F.fn.extend({css:function(e,t){return u(this,function(e,t,n){var i,r,o={},a=0;if(Array.isArray(t)){for(i=qe(e),r=t.length;a<r;a++)o[t[a]]=F.css(e,t[a],!1,i);return o}return void 0!==n?F.style(e,t,n):F.css(e,t)},e,t,1<arguments.length)}}),((F.Tween=o).prototype={constructor:o,init:function(e,t,n,i,r,o){this.elem=e,this.prop=n,this.easing=r||F.easing._default,this.options=t,this.start=this.now=this.cur(),this.end=i,this.unit=o||(F.cssNumber[n]?"":"px")},cur:function(){var e=o.propHooks[this.prop];return(e&&e.get?e:o.propHooks._default).get(this)},run:function(e){var t,n=o.propHooks[this.prop];return this.options.duration?this.pos=t=F.easing[this.easing](e,this.options.duration*e,0,1,this.options.duration):this.pos=t=e,this.now=(this.end-this.start)*t+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),(n&&n.set?n:o.propHooks._default).set(this),this}}).init.prototype=o.prototype,(o.propHooks={_default:{get:function(e){return 1!==e.elem.nodeType||null!=e.elem[e.prop]&&null==e.elem.style[e.prop]?e.elem[e.prop]:(e=F.css(e.elem,e.prop,""))&&"auto"!==e?e:0},set:function(e){F.fx.step[e.prop]?F.fx.step[e.prop](e):1!==e.elem.nodeType||null==e.elem.style[F.cssProps[e.prop]]&&!F.cssHooks[e.prop]?e.elem[e.prop]=e.now:F.style(e.elem,e.prop,e.now+e.unit)}}}).scrollTop=o.propHooks.scrollLeft={set:function(e){e.elem.nodeType&&e.elem.parentNode&&(e.elem[e.prop]=e.now)}},F.easing={linear:function(e){return e},swing:function(e){return.5-Math.cos(e*Math.PI)/2},_default:"swing"},F.fx=o.prototype.init,F.fx.step={};var M,dt,a,L,ut=/^(?:toggle|show|hide)$/,ht=/queueHooks$/;function pt(){dt&&(!1===C.hidden&&x.requestAnimationFrame?x.requestAnimationFrame(pt):x.setTimeout(pt,F.fx.interval),F.fx.tick())}function ft(){return x.setTimeout(function(){M=void 0}),M=Date.now()}function mt(e,t){var n,i=0,r={height:e};for(t=t?1:0;i<4;i+=2-t)r["margin"+(n=p[i])]=r["padding"+n]=e;return t&&(r.opacity=r.width=e),r}function gt(e,t,n){for(var i,r=(N.tweeners[t]||[]).concat(N.tweeners["*"]),o=0,a=r.length;o<a;o++)if(i=r[o].call(n,t,e))return i}function N(r,e,t){var n,o,i,a,s,l,c,d=0,u=N.prefilters.length,h=F.Deferred().always(function(){delete p.elem}),p=function(){if(o)return!1;for(var e=M||ft(),e=Math.max(0,f.startTime+f.duration-e),t=1-(e/f.duration||0),n=0,i=f.tweens.length;n<i;n++)f.tweens[n].run(t);return h.notifyWith(r,[f,t,e]),t<1&&i?e:(i||h.notifyWith(r,[f,1,0]),h.resolveWith(r,[f]),!1)},f=h.promise({elem:r,props:F.extend({},e),opts:F.extend(!0,{specialEasing:{},easing:F.easing._default},t),originalProperties:e,originalOptions:t,startTime:M||ft(),duration:t.duration,tweens:[],createTween:function(e,t){t=F.Tween(r,f.opts,e,t,f.opts.specialEasing[e]||f.opts.easing);return f.tweens.push(t),t},stop:function(e){var t=0,n=e?f.tweens.length:0;if(!o){for(o=!0;t<n;t++)f.tweens[t].run(1);e?(h.notifyWith(r,[f,1,0]),h.resolveWith(r,[f,e])):h.rejectWith(r,[f,e])}return this}}),m=f.props,g=m,y=f.opts.specialEasing;for(i in g)if(a=b(i),s=y[a],l=g[i],Array.isArray(l)&&(s=l[1],l=g[i]=l[0]),i!==a&&(g[a]=l,delete g[i]),(c=F.cssHooks[a])&&"expand"in c)for(i in l=c.expand(l),delete g[a],l)i in g||(g[i]=l[i],y[i]=s);else y[a]=s;for(;d<u;d++)if(n=N.prefilters[d].call(f,r,m,f.opts))return v(n.stop)&&(F._queueHooks(f.elem,f.opts.queue).stop=n.stop.bind(n)),n;return F.map(m,gt,f),v(f.opts.start)&&f.opts.start.call(r,f),f.progress(f.opts.progress).done(f.opts.done,f.opts.complete).fail(f.opts.fail).always(f.opts.always),F.fx.timer(F.extend(p,{elem:r,anim:f,queue:f.opts.queue})),f}F.Animation=F.extend(N,{tweeners:{"*":[function(e,t){var n=this.createTween(e,t);return be(n.elem,e,h.exec(t),n),n}]},tweener:function(e,t){for(var n,i=0,r=(e=v(e)?(t=e,["*"]):e.match(S)).length;i<r;i++)n=e[i],N.tweeners[n]=N.tweeners[n]||[],N.tweeners[n].unshift(t)},prefilters:[function(e,t,n){var i,r,o,a,s,l,c,d="width"in t||"height"in t,u=this,h={},p=e.style,f=e.nodeType&&ye(e),m=y.get(e,"fxshow");for(i in n.queue||(null==(a=F._queueHooks(e,"fx")).unqueued&&(a.unqueued=0,s=a.empty.fire,a.empty.fire=function(){a.unqueued||s()}),a.unqueued++,u.always(function(){u.always(function(){a.unqueued--,F.queue(e,"fx").length||a.empty.fire()})})),t)if(r=t[i],ut.test(r)){if(delete t[i],o=o||"toggle"===r,r===(f?"hide":"show")){if("show"!==r||!m||void 0===m[i])continue;f=!0}h[i]=m&&m[i]||F.style(e,i)}if((l=!F.isEmptyObject(t))||!F.isEmptyObject(h))for(i in d&&1===e.nodeType&&(n.overflow=[p.overflow,p.overflowX,p.overflowY],null==(c=m&&m.display)&&(c=y.get(e,"display")),"none"===(d=F.css(e,"display"))&&(c?d=c:(w([e],!0),c=e.style.display||c,d=F.css(e,"display"),w([e]))),"inline"===d||"inline-block"===d&&null!=c)&&"none"===F.css(e,"float")&&(l||(u.done(function(){p.display=c}),null==c&&(d=p.display,c="none"===d?"":d)),p.display="inline-block"),n.overflow&&(p.overflow="hidden",u.always(function(){p.overflow=n.overflow[0],p.overflowX=n.overflow[1],p.overflowY=n.overflow[2]})),l=!1,h)l||(m?"hidden"in m&&(f=m.hidden):m=y.access(e,"fxshow",{display:c}),o&&(m.hidden=!f),f&&w([e],!0),u.done(function(){for(i in f||w([e]),y.remove(e,"fxshow"),h)F.style(e,i,h[i])})),l=gt(f?m[i]:0,i,u),i in m||(m[i]=l.start,f&&(l.end=l.start,l.start=0))}],prefilter:function(e,t){t?N.prefilters.unshift(e):N.prefilters.push(e)}}),F.speed=function(e,t,n){var i=e&&"object"==typeof e?F.extend({},e):{complete:n||!n&&t||v(e)&&e,duration:e,easing:n&&t||t&&!v(t)&&t};return F.fx.off?i.duration=0:"number"!=typeof i.duration&&(i.duration in F.fx.speeds?i.duration=F.fx.speeds[i.duration]:i.duration=F.fx.speeds._default),null!=i.queue&&!0!==i.queue||(i.queue="fx"),i.old=i.complete,i.complete=function(){v(i.old)&&i.old.call(this),i.queue&&F.dequeue(this,i.queue)},i},F.fn.extend({fadeTo:function(e,t,n,i){return this.filter(ye).css("opacity",0).show().end().animate({opacity:t},e,n,i)},animate:function(t,e,n,i){function r(){var e=N(this,F.extend({},t),a);(o||y.get(this,"finish"))&&e.stop(!0)}var o=F.isEmptyObject(t),a=F.speed(e,n,i);return r.finish=r,o||!1===a.queue?this.each(r):this.queue(a.queue,r)},stop:function(r,e,o){function a(e){var t=e.stop;delete e.stop,t(o)}return"string"!=typeof r&&(o=e,e=r,r=void 0),e&&!1!==r&&this.queue(r||"fx",[]),this.each(function(){var e=!0,t=null!=r&&r+"queueHooks",n=F.timers,i=y.get(this);if(t)i[t]&&i[t].stop&&a(i[t]);else for(t in i)i[t]&&i[t].stop&&ht.test(t)&&a(i[t]);for(t=n.length;t--;)n[t].elem!==this||null!=r&&n[t].queue!==r||(n[t].anim.stop(o),e=!1,n.splice(t,1));!e&&o||F.dequeue(this,r)})},finish:function(a){return!1!==a&&(a=a||"fx"),this.each(function(){var e,t=y.get(this),n=t[a+"queue"],i=t[a+"queueHooks"],r=F.timers,o=n?n.length:0;for(t.finish=!0,F.queue(this,a,[]),i&&i.stop&&i.stop.call(this,!0),e=r.length;e--;)r[e].elem===this&&r[e].queue===a&&(r[e].anim.stop(!0),r.splice(e,1));for(e=0;e<o;e++)n[e]&&n[e].finish&&n[e].finish.call(this);delete t.finish})}}),F.each(["toggle","show","hide"],function(e,i){var r=F.fn[i];F.fn[i]=function(e,t,n){return null==e||"boolean"==typeof e?r.apply(this,arguments):this.animate(mt(i,!0),e,t,n)}}),F.each({slideDown:mt("show"),slideUp:mt("hide"),slideToggle:mt("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(e,i){F.fn[e]=function(e,t,n){return this.animate(i,e,t,n)}}),F.timers=[],F.fx.tick=function(){var e,t=0,n=F.timers;for(M=Date.now();t<n.length;t++)(e=n[t])()||n[t]!==e||n.splice(t--,1);n.length||F.fx.stop(),M=void 0},F.fx.timer=function(e){F.timers.push(e),F.fx.start()},F.fx.interval=13,F.fx.start=function(){dt||(dt=!0,pt())},F.fx.stop=function(){dt=null},F.fx.speeds={slow:600,fast:200,_default:400},F.fn.delay=function(i,e){return i=F.fx&&F.fx.speeds[i]||i,this.queue(e=e||"fx",function(e,t){var n=x.setTimeout(e,i);t.stop=function(){x.clearTimeout(n)}})},a=C.createElement("input"),L=C.createElement("select").appendChild(C.createElement("option")),a.type="checkbox",g.checkOn=""!==a.value,g.optSelected=L.selected,(a=C.createElement("input")).value="t",a.type="radio",g.radioValue="t"===a.value;var yt,D=F.expr.attrHandle,vt=(F.fn.extend({attr:function(e,t){return u(this,F.attr,e,t,1<arguments.length)},removeAttr:function(e){return this.each(function(){F.removeAttr(this,e)})}}),F.extend({attr:function(e,t,n){var i,r,o=e.nodeType;if(3!==o&&8!==o&&2!==o)return void 0===e.getAttribute?F.prop(e,t,n):(1===o&&F.isXMLDoc(e)||(r=F.attrHooks[t.toLowerCase()]||(F.expr.match.bool.test(t)?yt:void 0)),void 0!==n?null===n?void F.removeAttr(e,t):r&&"set"in r&&void 0!==(i=r.set(e,n,t))?i:(e.setAttribute(t,n+""),n):!(r&&"get"in r&&null!==(i=r.get(e,t)))&&null==(i=F.find.attr(e,t))?void 0:i)},attrHooks:{type:{set:function(e,t){var n;if(!g.radioValue&&"radio"===t&&l(e,"input"))return n=e.value,e.setAttribute("type",t),n&&(e.value=n),t}}},removeAttr:function(e,t){var n,i=0,r=t&&t.match(S);if(r&&1===e.nodeType)for(;n=r[i++];)e.removeAttribute(n)}}),yt={set:function(e,t,n){return!1===t?F.removeAttr(e,n):e.setAttribute(n,n),n}},F.each(F.expr.match.bool.source.match(/\w+/g),function(e,t){var a=D[t]||F.find.attr;D[t]=function(e,t,n){var i,r,o=t.toLowerCase();return n||(r=D[o],D[o]=i,i=null!=a(e,t,n)?o:null,D[o]=r),i}}),/^(?:input|select|textarea|button)$/i),bt=/^(?:a|area)$/i;function P(e){return(e.match(S)||[]).join(" ")}function B(e){return e.getAttribute&&e.getAttribute("class")||""}function wt(e){return Array.isArray(e)?e:"string"==typeof e&&e.match(S)||[]}F.fn.extend({prop:function(e,t){return u(this,F.prop,e,t,1<arguments.length)},removeProp:function(e){return this.each(function(){delete this[F.propFix[e]||e]})}}),F.extend({prop:function(e,t,n){var i,r,o=e.nodeType;if(3!==o&&8!==o&&2!==o)return 1===o&&F.isXMLDoc(e)||(t=F.propFix[t]||t,r=F.propHooks[t]),void 0!==n?r&&"set"in r&&void 0!==(i=r.set(e,n,t))?i:e[t]=n:r&&"get"in r&&null!==(i=r.get(e,t))?i:e[t]},propHooks:{tabIndex:{get:function(e){var t=F.find.attr(e,"tabindex");return t?parseInt(t,10):vt.test(e.nodeName)||bt.test(e.nodeName)&&e.href?0:-1}}},propFix:{for:"htmlFor",class:"className"}}),g.optSelected||(F.propHooks.selected={get:function(e){e=e.parentNode;return e&&e.parentNode&&e.parentNode.selectedIndex,null},set:function(e){e=e.parentNode;e&&(e.selectedIndex,e.parentNode)&&e.parentNode.selectedIndex}}),F.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){F.propFix[this.toLowerCase()]=this}),F.fn.extend({addClass:function(t){var e,n,i,r,o,a,s=0;if(v(t))return this.each(function(e){F(this).addClass(t.call(this,e,B(this)))});if((e=wt(t)).length)for(;n=this[s++];)if(a=B(n),i=1===n.nodeType&&" "+P(a)+" "){for(o=0;r=e[o++];)i.indexOf(" "+r+" ")<0&&(i+=r+" ");a!==(a=P(i))&&n.setAttribute("class",a)}return this},removeClass:function(t){var e,n,i,r,o,a,s=0;if(v(t))return this.each(function(e){F(this).removeClass(t.call(this,e,B(this)))});if(!arguments.length)return this.attr("class","");if((e=wt(t)).length)for(;n=this[s++];)if(a=B(n),i=1===n.nodeType&&" "+P(a)+" "){for(o=0;r=e[o++];)for(;-1<i.indexOf(" "+r+" ");)i=i.replace(" "+r+" "," ");a!==(a=P(i))&&n.setAttribute("class",a)}return this},toggleClass:function(r,t){var o=typeof r,a="string"==o||Array.isArray(r);return"boolean"==typeof t&&a?t?this.addClass(r):this.removeClass(r):v(r)?this.each(function(e){F(this).toggleClass(r.call(this,e,B(this),t),t)}):this.each(function(){var e,t,n,i;if(a)for(t=0,n=F(this),i=wt(r);e=i[t++];)n.hasClass(e)?n.removeClass(e):n.addClass(e);else void 0!==r&&"boolean"!=o||((e=B(this))&&y.set(this,"__className__",e),this.setAttribute&&this.setAttribute("class",!e&&!1!==r&&y.get(this,"__className__")||""))})},hasClass:function(e){for(var t,n=0,i=" "+e+" ";t=this[n++];)if(1===t.nodeType&&-1<(" "+P(B(t))+" ").indexOf(i))return!0;return!1}});function xt(e){e.stopPropagation()}var Ct=/\r/g,Ft=(F.fn.extend({val:function(t){var n,e,i,r=this[0];return arguments.length?(i=v(t),this.each(function(e){1===this.nodeType&&(null==(e=i?t.call(this,e,F(this).val()):t)?e="":"number"==typeof e?e+="":Array.isArray(e)&&(e=F.map(e,function(e){return null==e?"":e+""})),(n=F.valHooks[this.type]||F.valHooks[this.nodeName.toLowerCase()])&&"set"in n&&void 0!==n.set(this,e,"value")||(this.value=e))})):r?(n=F.valHooks[r.type]||F.valHooks[r.nodeName.toLowerCase()])&&"get"in n&&void 0!==(e=n.get(r,"value"))?e:"string"==typeof(e=r.value)?e.replace(Ct,""):null==e?"":e:void 0}}),F.extend({valHooks:{option:{get:function(e){var t=F.find.attr(e,"value");return null!=t?t:P(F.text(e))}},select:{get:function(e){for(var t,n=e.options,i=e.selectedIndex,r="select-one"===e.type,o=r?null:[],a=r?i+1:n.length,s=i<0?a:r?i:0;s<a;s++)if(((t=n[s]).selected||s===i)&&!t.disabled&&(!t.parentNode.disabled||!l(t.parentNode,"optgroup"))){if(t=F(t).val(),r)return t;o.push(t)}return o},set:function(e,t){for(var n,i,r=e.options,o=F.makeArray(t),a=r.length;a--;)((i=r[a]).selected=-1<F.inArray(F.valHooks.option.get(i),o))&&(n=!0);return n||(e.selectedIndex=-1),o}}}}),F.each(["radio","checkbox"],function(){F.valHooks[this]={set:function(e,t){if(Array.isArray(t))return e.checked=-1<F.inArray(F(e).val(),t)}},g.checkOn||(F.valHooks[this].get=function(e){return null===e.getAttribute("value")?"on":e.value})}),g.focusin="onfocusin"in x,/^(?:focusinfocus|focusoutblur)$/),St=(F.extend(F.event,{trigger:function(e,t,n,i){var r,o,a,s,l,c,d,u=[n||C],h=q.call(e,"type")?e.type:e,p=q.call(e,"namespace")?e.namespace.split("."):[],f=d=o=n=n||C;if(3!==n.nodeType&&8!==n.nodeType&&!Ft.test(h+F.event.triggered)&&(-1<h.indexOf(".")&&(h=(p=h.split(".")).shift(),p.sort()),s=h.indexOf(":")<0&&"on"+h,(e=e[F.expando]?e:new F.Event(h,"object"==typeof e&&e)).isTrigger=i?2:3,e.namespace=p.join("."),e.rnamespace=e.namespace?new RegExp("(^|\\.)"+p.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,e.result=void 0,e.target||(e.target=n),t=null==t?[e]:F.makeArray(t,[e]),c=F.event.special[h]||{},i||!c.trigger||!1!==c.trigger.apply(n,t))){if(!i&&!c.noBubble&&!m(n)){for(a=c.delegateType||h,Ft.test(a+h)||(f=f.parentNode);f;f=f.parentNode)u.push(f),o=f;o===(n.ownerDocument||C)&&u.push(o.defaultView||o.parentWindow||x)}for(r=0;(f=u[r++])&&!e.isPropagationStopped();)d=f,e.type=1<r?a:c.bindType||h,(l=(y.get(f,"events")||{})[e.type]&&y.get(f,"handle"))&&l.apply(f,t),(l=s&&f[s])&&l.apply&&pe(f)&&(e.result=l.apply(f,t),!1===e.result)&&e.preventDefault();return e.type=h,i||e.isDefaultPrevented()||c._default&&!1!==c._default.apply(u.pop(),t)||!pe(n)||s&&v(n[h])&&!m(n)&&((o=n[s])&&(n[s]=null),F.event.triggered=h,e.isPropagationStopped()&&d.addEventListener(h,xt),n[h](),e.isPropagationStopped()&&d.removeEventListener(h,xt),F.event.triggered=void 0,o)&&(n[s]=o),e.result}},simulate:function(e,t,n){n=F.extend(new F.Event,n,{type:e,isSimulated:!0});F.event.trigger(n,null,t)}}),F.fn.extend({trigger:function(e,t){return this.each(function(){F.event.trigger(e,t,this)})},triggerHandler:function(e,t){var n=this[0];if(n)return F.event.trigger(e,t,n,!0)}}),g.focusin||F.each({focus:"focusin",blur:"focusout"},function(n,i){function r(e){F.event.simulate(i,e.target,F.event.fix(e))}F.event.special[i]={setup:function(){var e=this.ownerDocument||this,t=y.access(e,i);t||e.addEventListener(n,r,!0),y.access(e,i,(t||0)+1)},teardown:function(){var e=this.ownerDocument||this,t=y.access(e,i)-1;t?y.access(e,i,t):(e.removeEventListener(n,r,!0),y.remove(e,i))}}}),x.location),kt=Date.now(),Et=/\?/,Tt=(F.parseXML=function(e){var t;if(!e||"string"!=typeof e)return null;try{t=(new x.DOMParser).parseFromString(e,"text/xml")}catch(e){t=void 0}return t&&!t.getElementsByTagName("parsererror").length||F.error("Invalid XML: "+e),t},/\[\]$/),_t=/\r?\n/g,At=/^(?:submit|button|image|reset|file)$/i,Mt=/^(?:input|select|textarea|keygen)/i;F.param=function(e,t){function n(e,t){t=v(t)?t():t,r[r.length]=encodeURIComponent(e)+"="+encodeURIComponent(null==t?"":t)}var i,r=[];if(Array.isArray(e)||e.jquery&&!F.isPlainObject(e))F.each(e,function(){n(this.name,this.value)});else for(i in e)!function n(i,e,r,o){if(Array.isArray(e))F.each(e,function(e,t){r||Tt.test(i)?o(i,t):n(i+"["+("object"==typeof t&&null!=t?e:"")+"]",t,r,o)});else if(r||"object"!==f(e))o(i,e);else for(var t in e)n(i+"["+t+"]",e[t],r,o)}(i,e[i],t,n);return r.join("&")},F.fn.extend({serialize:function(){return F.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var e=F.prop(this,"elements");return e?F.makeArray(e):this}).filter(function(){var e=this.type;return this.name&&!F(this).is(":disabled")&&Mt.test(this.nodeName)&&!At.test(e)&&(this.checked||!xe.test(e))}).map(function(e,t){var n=F(this).val();return null==n?null:Array.isArray(n)?F.map(n,function(e){return{name:t.name,value:e.replace(_t,"\r\n")}}):{name:t.name,value:n.replace(_t,"\r\n")}}).get()}});var Lt=/%20/g,Nt=/#.*$/,Dt=/([?&])_=[^&]*/,Pt=/^(.*?):[ \t]*([^\r\n]*)$/gm,Bt=/^(?:GET|HEAD)$/,Rt=/^\/\//,Ot={},It={},$t="*/".concat("*"),Ht=C.createElement("a");function Ut(o){return function(e,t){"string"!=typeof e&&(t=e,e="*");var n,i=0,r=e.toLowerCase().match(S)||[];if(v(t))for(;n=r[i++];)"+"===n[0]?(n=n.slice(1)||"*",(o[n]=o[n]||[]).unshift(t)):(o[n]=o[n]||[]).push(t)}}function jt(t,i,r,o){var a={},s=t===It;function l(e){var n;return a[e]=!0,F.each(t[e]||[],function(e,t){t=t(i,r,o);return"string"!=typeof t||s||a[t]?s?!(n=t):void 0:(i.dataTypes.unshift(t),l(t),!1)}),n}return l(i.dataTypes[0])||!a["*"]&&l("*")}function qt(e,t){var n,i,r=F.ajaxSettings.flatOptions||{};for(n in t)void 0!==t[n]&&((r[n]?e:i=i||{})[n]=t[n]);return i&&F.extend(!0,e,i),e}Ht.href=St.href,F.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:St.href,type:"GET",isLocal:/^(?:about|app|app-storage|.+-extension|file|res|widget):$/.test(St.protocol),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":$t,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/\bxml\b/,html:/\bhtml/,json:/\bjson\b/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":JSON.parse,"text xml":F.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(e,t){return t?qt(qt(e,F.ajaxSettings),t):qt(F.ajaxSettings,e)},ajaxPrefilter:Ut(Ot),ajaxTransport:Ut(It),ajax:function(e,t){"object"==typeof e&&(t=e,e=void 0);var l,c,d,n,u,h,p,i,f=F.ajaxSetup({},t=t||{}),m=f.context||f,g=f.context&&(m.nodeType||m.jquery)?F(m):F.event,y=F.Deferred(),v=F.Callbacks("once memory"),b=f.statusCode||{},r={},o={},a="canceled",w={readyState:0,getResponseHeader:function(e){var t;if(h){if(!n)for(n={};t=Pt.exec(d);)n[t[1].toLowerCase()]=t[2];t=n[e.toLowerCase()]}return null==t?null:t},getAllResponseHeaders:function(){return h?d:null},setRequestHeader:function(e,t){return null==h&&(e=o[e.toLowerCase()]=o[e.toLowerCase()]||e,r[e]=t),this},overrideMimeType:function(e){return null==h&&(f.mimeType=e),this},statusCode:function(e){if(e)if(h)w.always(e[w.status]);else for(var t in e)b[t]=[b[t],e[t]];return this},abort:function(e){e=e||a;return l&&l.abort(e),s(0,e),this}};if(y.promise(w),f.url=((e||f.url||St.href)+"").replace(Rt,St.protocol+"//"),f.type=t.method||t.type||f.method||f.type,f.dataTypes=(f.dataType||"*").toLowerCase().match(S)||[""],null==f.crossDomain){e=C.createElement("a");try{e.href=f.url,e.href=e.href,f.crossDomain=Ht.protocol+"//"+Ht.host!=e.protocol+"//"+e.host}catch(e){f.crossDomain=!0}}if(f.data&&f.processData&&"string"!=typeof f.data&&(f.data=F.param(f.data,f.traditional)),jt(Ot,f,t,w),!h){for(i in(p=F.event&&f.global)&&0==F.active++&&F.event.trigger("ajaxStart"),f.type=f.type.toUpperCase(),f.hasContent=!Bt.test(f.type),c=f.url.replace(Nt,""),f.hasContent?f.data&&f.processData&&0===(f.contentType||"").indexOf("application/x-www-form-urlencoded")&&(f.data=f.data.replace(Lt,"+")):(e=f.url.slice(c.length),f.data&&(f.processData||"string"==typeof f.data)&&(c+=(Et.test(c)?"&":"?")+f.data,delete f.data),!1===f.cache&&(c=c.replace(Dt,"$1"),e=(Et.test(c)?"&":"?")+"_="+kt+++e),f.url=c+e),f.ifModified&&(F.lastModified[c]&&w.setRequestHeader("If-Modified-Since",F.lastModified[c]),F.etag[c])&&w.setRequestHeader("If-None-Match",F.etag[c]),(f.data&&f.hasContent&&!1!==f.contentType||t.contentType)&&w.setRequestHeader("Content-Type",f.contentType),w.setRequestHeader("Accept",f.dataTypes[0]&&f.accepts[f.dataTypes[0]]?f.accepts[f.dataTypes[0]]+("*"!==f.dataTypes[0]?", "+$t+"; q=0.01":""):f.accepts["*"]),f.headers)w.setRequestHeader(i,f.headers[i]);if(f.beforeSend&&(!1===f.beforeSend.call(m,w,f)||h))return w.abort();if(a="abort",v.add(f.complete),w.done(f.success),w.fail(f.error),l=jt(It,f,t,w)){if(w.readyState=1,p&&g.trigger("ajaxSend",[w,f]),h)return w;f.async&&0<f.timeout&&(u=x.setTimeout(function(){w.abort("timeout")},f.timeout));try{h=!1,l.send(r,s)}catch(e){if(h)throw e;s(-1,e)}}else s(-1,"No Transport")}return w;function s(e,t,n,i){var r,o,a,s=t;h||(h=!0,u&&x.clearTimeout(u),l=void 0,d=i||"",w.readyState=0<e?4:0,i=200<=e&&e<300||304===e,n&&(a=function(e,t,n){for(var i,r,o,a,s=e.contents,l=e.dataTypes;"*"===l[0];)l.shift(),void 0===i&&(i=e.mimeType||t.getResponseHeader("Content-Type"));if(i)for(r in s)if(s[r]&&s[r].test(i)){l.unshift(r);break}if(l[0]in n)o=l[0];else{for(r in n){if(!l[0]||e.converters[r+" "+l[0]]){o=r;break}a=a||r}o=o||a}if(o)return o!==l[0]&&l.unshift(o),n[o]}(f,w,n)),a=function(e,t,n,i){var r,o,a,s,l,c={},d=e.dataTypes.slice();if(d[1])for(a in e.converters)c[a.toLowerCase()]=e.converters[a];for(o=d.shift();o;)if(e.responseFields[o]&&(n[e.responseFields[o]]=t),!l&&i&&e.dataFilter&&(t=e.dataFilter(t,e.dataType)),l=o,o=d.shift())if("*"===o)o=l;else if("*"!==l&&l!==o){if(!(a=c[l+" "+o]||c["* "+o]))for(r in c)if((s=r.split(" "))[1]===o&&(a=c[l+" "+s[0]]||c["* "+s[0]])){!0===a?a=c[r]:!0!==c[r]&&(o=s[0],d.unshift(s[1]));break}if(!0!==a)if(a&&e.throws)t=a(t);else try{t=a(t)}catch(e){return{state:"parsererror",error:a?e:"No conversion from "+l+" to "+o}}}return{state:"success",data:t}}(f,a,w,i),i?(f.ifModified&&((n=w.getResponseHeader("Last-Modified"))&&(F.lastModified[c]=n),n=w.getResponseHeader("etag"))&&(F.etag[c]=n),204===e||"HEAD"===f.type?s="nocontent":304===e?s="notmodified":(s=a.state,r=a.data,i=!(o=a.error))):(o=s,!e&&s||(s="error",e<0&&(e=0))),w.status=e,w.statusText=(t||s)+"",i?y.resolveWith(m,[r,s,w]):y.rejectWith(m,[w,s,o]),w.statusCode(b),b=void 0,p&&g.trigger(i?"ajaxSuccess":"ajaxError",[w,f,i?r:o]),v.fireWith(m,[w,s]),p&&(g.trigger("ajaxComplete",[w,f]),--F.active||F.event.trigger("ajaxStop")))}},getJSON:function(e,t,n){return F.get(e,t,n,"json")},getScript:function(e,t){return F.get(e,void 0,t,"script")}}),F.each(["get","post"],function(e,r){F[r]=function(e,t,n,i){return v(t)&&(i=i||n,n=t,t=void 0),F.ajax(F.extend({url:e,type:r,dataType:i,data:t,success:n},F.isPlainObject(e)&&e))}}),F._evalUrl=function(e){return F.ajax({url:e,type:"GET",dataType:"script",cache:!0,async:!1,global:!1,throws:!0})},F.fn.extend({wrapAll:function(e){return this[0]&&(v(e)&&(e=e.call(this[0])),e=F(e,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&e.insertBefore(this[0]),e.map(function(){for(var e=this;e.firstElementChild;)e=e.firstElementChild;return e}).append(this)),this},wrapInner:function(n){return v(n)?this.each(function(e){F(this).wrapInner(n.call(this,e))}):this.each(function(){var e=F(this),t=e.contents();t.length?t.wrapAll(n):e.append(n)})},wrap:function(t){var n=v(t);return this.each(function(e){F(this).wrapAll(n?t.call(this,e):t)})},unwrap:function(e){return this.parent(e).not("body").each(function(){F(this).replaceWith(this.childNodes)}),this}}),F.expr.pseudos.hidden=function(e){return!F.expr.pseudos.visible(e)},F.expr.pseudos.visible=function(e){return!!(e.offsetWidth||e.offsetHeight||e.getClientRects().length)},F.ajaxSettings.xhr=function(){try{return new x.XMLHttpRequest}catch(e){}};var Wt={0:200,1223:204},zt=F.ajaxSettings.xhr(),Vt=(g.cors=!!zt&&"withCredentials"in zt,g.ajax=zt=!!zt,F.ajaxTransport(function(r){var o,a;if(g.cors||zt&&!r.crossDomain)return{send:function(e,t){var n,i=r.xhr();if(i.open(r.type,r.url,r.async,r.username,r.password),r.xhrFields)for(n in r.xhrFields)i[n]=r.xhrFields[n];for(n in r.mimeType&&i.overrideMimeType&&i.overrideMimeType(r.mimeType),r.crossDomain||e["X-Requested-With"]||(e["X-Requested-With"]="XMLHttpRequest"),e)i.setRequestHeader(n,e[n]);o=function(e){return function(){o&&(o=a=i.onload=i.onerror=i.onabort=i.ontimeout=i.onreadystatechange=null,"abort"===e?i.abort():"error"===e?"number"!=typeof i.status?t(0,"error"):t(i.status,i.statusText):t(Wt[i.status]||i.status,i.statusText,"text"!==(i.responseType||"text")||"string"!=typeof i.responseText?{binary:i.response}:{text:i.responseText},i.getAllResponseHeaders()))}},i.onload=o(),a=i.onerror=i.ontimeout=o("error"),void 0!==i.onabort?i.onabort=a:i.onreadystatechange=function(){4===i.readyState&&x.setTimeout(function(){o&&a()})},o=o("abort");try{i.send(r.hasContent&&r.data||null)}catch(e){if(o)throw e}},abort:function(){o&&o()}}}),F.ajaxPrefilter(function(e){e.crossDomain&&(e.contents.script=!1)}),F.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/\b(?:java|ecma)script\b/},converters:{"text script":function(e){return F.globalEval(e),e}}}),F.ajaxPrefilter("script",function(e){void 0===e.cache&&(e.cache=!1),e.crossDomain&&(e.type="GET")}),F.ajaxTransport("script",function(n){var i,r;if(n.crossDomain)return{send:function(e,t){i=F("<script>").prop({charset:n.scriptCharset,src:n.url}).on("load error",r=function(e){i.remove(),r=null,e&&t("error"===e.type?404:200,e.type)}),C.head.appendChild(i[0])},abort:function(){r&&r()}}}),[]),Jt=/(=)\?(?=&|$)|\?\?/,Kt=(F.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var e=Vt.pop()||F.expando+"_"+kt++;return this[e]=!0,e}}),F.ajaxPrefilter("json jsonp",function(e,t,n){var i,r,o,a=!1!==e.jsonp&&(Jt.test(e.url)?"url":"string"==typeof e.data&&0===(e.contentType||"").indexOf("application/x-www-form-urlencoded")&&Jt.test(e.data)&&"data");if(a||"jsonp"===e.dataTypes[0])return i=e.jsonpCallback=v(e.jsonpCallback)?e.jsonpCallback():e.jsonpCallback,a?e[a]=e[a].replace(Jt,"$1"+i):!1!==e.jsonp&&(e.url+=(Et.test(e.url)?"&":"?")+e.jsonp+"="+i),e.converters["script json"]=function(){return o||F.error(i+" was not called"),o[0]},e.dataTypes[0]="json",r=x[i],x[i]=function(){o=arguments},n.always(function(){void 0===r?F(x).removeProp(i):x[i]=r,e[i]&&(e.jsonpCallback=t.jsonpCallback,Vt.push(i)),o&&v(r)&&r(o[0]),o=r=void 0}),"script"}),g.createHTMLDocument=((e=C.implementation.createHTMLDocument("").body).innerHTML="<form></form><form></form>",2===e.childNodes.length),F.parseHTML=function(e,t,n){var i;return"string"!=typeof e?[]:("boolean"==typeof t&&(n=t,t=!1),t||(g.createHTMLDocument?((i=(t=C.implementation.createHTMLDocument("")).createElement("base")).href=C.location.href,t.head.appendChild(i)):t=C),i=!n&&[],(n=X.exec(e))?[t.createElement(n[1])]:(n=Ee([e],t,i),i&&i.length&&F(i).remove(),F.merge([],n.childNodes)))},F.fn.load=function(e,t,n){var i,r,o,a=this,s=e.indexOf(" ");return-1<s&&(i=P(e.slice(s)),e=e.slice(0,s)),v(t)?(n=t,t=void 0):t&&"object"==typeof t&&(r="POST"),0<a.length&&F.ajax({url:e,type:r||"GET",dataType:"html",data:t}).done(function(e){o=arguments,a.html(i?F("<div>").append(F.parseHTML(e)).find(i):e)}).always(n&&function(e,t){a.each(function(){n.apply(this,o||[e.responseText,t,e])})}),this},F.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(e,t){F.fn[t]=function(e){return this.on(t,e)}}),F.expr.pseudos.animated=function(t){return F.grep(F.timers,function(e){return t===e.elem}).length},F.offset={setOffset:function(e,t,n){var i,r,o,a,s=F.css(e,"position"),l=F(e),c={};"static"===s&&(e.style.position="relative"),o=l.offset(),i=F.css(e,"top"),a=F.css(e,"left"),s=("absolute"===s||"fixed"===s)&&-1<(i+a).indexOf("auto")?(r=(s=l.position()).top,s.left):(r=parseFloat(i)||0,parseFloat(a)||0),null!=(t=v(t)?t.call(e,n,F.extend({},o)):t).top&&(c.top=t.top-o.top+r),null!=t.left&&(c.left=t.left-o.left+s),"using"in t?t.using.call(e,c):l.css(c)}},F.fn.extend({offset:function(t){var e,n;return arguments.length?void 0===t?this:this.each(function(e){F.offset.setOffset(this,t,e)}):(n=this[0])?n.getClientRects().length?(e=n.getBoundingClientRect(),n=n.ownerDocument.defaultView,{top:e.top+n.pageYOffset,left:e.left+n.pageXOffset}):{top:0,left:0}:void 0},position:function(){if(this[0]){var e,t,n,i=this[0],r={top:0,left:0};if("fixed"===F.css(i,"position"))t=i.getBoundingClientRect();else{for(t=this.offset(),n=i.ownerDocument,e=i.offsetParent||n.documentElement;e&&(e===n.body||e===n.documentElement)&&"static"===F.css(e,"position");)e=e.parentNode;e&&e!==i&&1===e.nodeType&&((r=F(e).offset()).top+=F.css(e,"borderTopWidth",!0),r.left+=F.css(e,"borderLeftWidth",!0))}return{top:t.top-r.top-F.css(i,"marginTop",!0),left:t.left-r.left-F.css(i,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){for(var e=this.offsetParent;e&&"static"===F.css(e,"position");)e=e.offsetParent;return e||Te})}}),F.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(t,r){var o="pageYOffset"===r;F.fn[t]=function(e){return u(this,function(e,t,n){var i;if(m(e)?i=e:9===e.nodeType&&(i=e.defaultView),void 0===n)return i?i[r]:e[t];i?i.scrollTo(o?i.pageXOffset:n,o?n:i.pageYOffset):e[t]=n},t,e,arguments.length)}}),F.each(["top","left"],function(e,n){F.cssHooks[n]=Ze(g.pixelPosition,function(e,t){if(t)return t=A(e,n),Ge.test(t)?F(e).position()[n]+"px":t})}),F.each({Height:"height",Width:"width"},function(a,s){F.each({padding:"inner"+a,content:s,"":"outer"+a},function(i,o){F.fn[o]=function(e,t){var n=arguments.length&&(i||"boolean"!=typeof e),r=i||(!0===e||!0===t?"margin":"border");return u(this,function(e,t,n){var i;return m(e)?0===o.indexOf("outer")?e["inner"+a]:e.document.documentElement["client"+a]:9===e.nodeType?(i=e.documentElement,Math.max(e.body["scroll"+a],i["scroll"+a],e.body["offset"+a],i["offset"+a],i["client"+a])):void 0===n?F.css(e,t,r):F.style(e,t,n,r)},s,n?e:void 0,n)}})}),F.each("blur focus focusin focusout resize scroll click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup contextmenu".split(" "),function(e,n){F.fn[n]=function(e,t){return 0<arguments.length?this.on(n,null,e,t):this.trigger(n)}}),F.fn.extend({hover:function(e,t){return this.mouseenter(e).mouseleave(t||e)}}),F.fn.extend({bind:function(e,t,n){return this.on(e,null,t,n)},unbind:function(e,t){return this.off(e,null,t)},delegate:function(e,t,n,i){return this.on(t,e,n,i)},undelegate:function(e,t,n){return 1===arguments.length?this.off(e,"**"):this.off(t,e||"**",n)}}),F.proxy=function(e,t){var n,i;if("string"==typeof t&&(i=e[t],t=e,e=i),v(e))return n=s.call(arguments,2),(i=function(){return e.apply(t||this,n.concat(s.call(arguments)))}).guid=e.guid=e.guid||F.guid++,i},F.holdReady=function(e){e?F.readyWait++:F.ready(!0)},F.isArray=Array.isArray,F.parseJSON=JSON.parse,F.nodeName=l,F.isFunction=v,F.isWindow=m,F.camelCase=b,F.type=f,F.now=Date.now,F.isNumeric=function(e){var t=F.type(e);return("number"===t||"string"===t)&&!isNaN(e-parseFloat(e))},$__System.registerDynamic("e",[],!1,function(e,t,n){return function(){return F}.call(this)}),x.jQuery),Yt=x.$;return F.noConflict=function(e){return x.$===F&&(x.$=Yt),e&&x.jQuery===F&&(x.jQuery=Kt),F},R||(x.jQuery=x.$=F),F}),$__System.registerDynamic("28",["e","13","11"],!0,function(e,t,n){"use strict";this||self;var d=e("e"),s=(e("13").Node,e("11"));var u=!1;function o(e,t){if(e.match(/^#/)){if(!t){t=d("#write [name='@'],[ty-id='@'],mjx-container g[id='@']".replace(/@/g,s.escapeSelector(e.substr(1))));if(t.length)return[t,void 0]}t=s.titleToAnchor(e.substr(1)||""),e=t,(n=/-(\d+)$/.exec(t))&&(n=n[1],e=t.substr(0,t.length-1-n.length),n=+n);var i,[r,o,t]=[t,e,n],a=t||1,e=d("#write").find("h1, h2, h3, h4, h5, h6").filter(function(){var e=this.textContent,t=this.innerText,n=s.titleToAnchor(e);return n!=o&&n!=s.decodeFromEscapedPath(o)&&(e==t||(t=s.titleToAnchor(t))!=o&&t!=s.decodeFromEscapedPath(o))?(n!=r&&n!=s.decodeFromEscapedPath(r)&&(e==t||(t=s.titleToAnchor(t))!=r&&t!=s.decodeFromEscapedPath(r))||(i=d(this)),!1):!--a});return(i||[]).length?[i,0]:[e,1<t?t:0]}var n;return[void 0,void 0]}var a,l=d("#ty-tooltip");d("body").on("mouseenter","[ty-hint]",function(){var e,t,n,i=d(this),r=d.Event("before-show-ty-hint",{cancel:!1});i.trigger(r),r.cancel||(l.text(this.getAttribute("ty-hint")).addClass("shown").attr("style",""),this.getAttribute("ty-hint-html")&&l.html(this.getAttribute("ty-hint")),e={left:(r=this.getBoundingClientRect()).left,top:r.top},t=l[0].clientWidth,n=e.left+this.clientWidth/2,"right"==i.attr("ty-hint-pos")?e.left+=this.clientWidth+4:"left"==i.attr("ty-hint-pos")?e.left-=this.clientWidth+4:(e.top>window.innerHeight/2?e.top=e.top-l[0].clientHeight-6:e.top+=r.height+1,t/2+n>window.innerWidth?e.left=window.innerWidth-t-4:(e.left=n-t/2-2,e.left=Math.max(2,e.left))),l.offset(e),new Date-a<2e3||this.getAttribute("ty-hint-instant")?l.addClass("instant"):l.removeClass("instant"))}).on("mouseleave click","[ty-hint]",function(){a=new Date,l.removeClass("shown")});var c,h=!1;function i(e,t,n){r({key:e,title:d.localize.getString("<strong>%@</strong> has been turned on.","Front").replace("%@",d.localize.getString(t,"Menu")),body:d.localize.getString("You could turn it off from `View` menu.","Front"),focus:n})}function r(e){var t,n,{key:e,title:i,body:r,focus:o,checked:a}=e;if(!File.option[e])return File.option[e],t=document.querySelector("#ty-enter-mode-warning-temp").innerText,(n=d("#md-notification")).html(t).find(".ty-enter-mode-warning-header").html(i).end().find(".ty-enter-mode-warning-body").html(r||"&nbsp;").end().find("[data-lg='Front']").localize("Front",d.localize.localeOption).end().find("[data-lg='Panel']").localize("Panel",d.localize.localeOption).end(),document.body.classList.add("ty-show-notification"),o&&n.focus(),(c=e)?(h||(h=!0,d("#md-notification").on("change","#ty-suppress-mode-warning-input",function(){var e=d(this).prop("checked");JSBridge.putSetting(c,e),JSBridge.execForAll("File.option."+c+"="+e+";")}).on("click","#ty-suppress-mode-warning-close-btn",function(){document.body.classList.remove("ty-show-notification")})),a?d("#ty-suppress-mode-warning-input").prop("checked",!0).trigger("change"):d("#ty-suppress-mode-warning-input").prop("checked",!1)):(n.find("label").remove(),n.one("click","#ty-suppress-mode-warning-close-btn",function(){document.body.classList.remove("ty-show-notification")})),n}function p(){this.$dialog=d("#common-dialog"),this.isShown_=!1,this.callback_=null,this.checkBoxState=null,this.init()}function f(e){F&&S(),d("#zoom-hint-current").text((100*e+"").replace(/\..+/,"")+"%"),g&&clearTimeout(g),d("#zoom-hint").show(),document.body.classList.add("on-zoom"),g=setTimeout(function(){g=null,d("#zoom-hint").hide(),document.body.classList.remove("on-zoom")},3e3)}p.prototype.isShown=function(){return this.isShown_},p.prototype.init=function(){var e=this;this.$dialog.on("change","#common-dialog-checkbox",function(){return e.checkBoxState=d(this).prop("checked"),!1}).on("click",".modal-footer button",function(){if(e.callback_){if(e.callback_(d(this).prevAll("button").length,e.checkBoxState),this.classList.contains("btn-light"))return!1;e.callback_=null}}).on("hidden.bs.modal",function(){e.callback_&&e.callback_(null)})},p.prototype.show=function(e){this.isShown_&&this.hide(),this.callback_=e.callback||function(){},this.render_(e),this.$dialog.modal(e)},p.prototype.render_=function(e){var i,r,t=this.$dialog;t.removeClass("error-dialog"),t.attr("data-tag",e.tag),"error"==e.type&&t.addClass("error-dialog"),e.title?(t.removeClass("ty-dialog-no-title"),t.find(".modal-title").text(e.title)):t.addClass("ty-dialog-no-title"),(e.html?t.find("#common-dialog-message").html(e.html):t.find("#common-dialog-message").text(e.message||"")).css("text-align",e.leftAlign?"left":""),e.checkbox?(t.addClass("ty-dialog-show-checkbox"),t.find("#common-dialog-checkbox").prop("checked",e.checkbox.state||!1),t.find("#common-dialog-checkbox-label").text(e.checkbox.label)):t.removeClass("ty-dialog-show-checkbox"),e.buttons=e.buttons||[d.localize.getString("Close")],e.helperButtons=e.helperButtons||[],i=d('<button type="button" data-dismiss="modal" class="btn"></button>'),r=t.find(".modal-footer").html(""),3==e.buttons.length?t.addClass("ty-three-way-buttons"):t.removeClass("ty-three-way-buttons"),e.helperButtons.forEach(function(e,t){var n=i.clone();n.text(e),n.addClass("btn-light"),n[0].removeAttribute("data-dismiss"),r.append(n)}),e.buttons.forEach(function(e,t){var n=i.clone();n.text(e),0==t?n.addClass("btn-primary"):n.addClass("btn-default"),r.append(n)})},p.prototype.hide=function(){this.isShown_=!1};var m,g,y=function(){m&&clearTimeout(m),m=null,document.body.classList.remove("ty-show-notification")},v=function(e,t,n,i,r){m&&clearTimeout(m),m=null;n=n||[],n&&"string"==typeof n&&(n=[n]),t=d("#md-notification").html(`<div class="md-notification-content"><p style='padding-right: 0;overflow-wrap: anywhere;max-height: 60vh;overflow-y: auto;'>${t?e:s.escape(e)}</p>`+(n.length?n.map((e,t)=>`<span data-index='${t}' class='btn-default btn-xs btn'>${e}</span>`).join(" "):"")+`<span class='${n.length?"":"btn-default"} btn-xs btn ok-btn'>${d.localize.getString("Close")}</span></div>`);return document.body.classList.add("ty-show-notification"),n.length&&d(".btn-default").one("click",function(){y(),i&&i(+this.dataset.index)}),!r||r.checkFocus&&!document.hasFocus()||(m=setTimeout(y,r.timeout||1e4)),t},b=function(e,t){return e&&e.length===t},w=function(e){var t,n;return e&&(t=function(e){return e.childNodes&&0==e.childNodes.length?e:t(e.childNodes[0])},null==(n=e.nextSibling)?w(e.parentElement):t(n))},x=function(t){for(var e,n=t.childNodes.length,i=[],r=0;r<n;r++){var o=t.childNodes[r];o.tagName?!e||e.tagName!=o.tagName||o.childElementCount||e.childElementCount||e.getAttribute("class")!=o.getAttribute("class")?e=o:(i.push(o),e.textContent=e.textContent+o.textContent):e=null}i.forEach(function(e){t.removeChild(e)})},C=function(e,t,n){window.reqnode?JSBridge.invoke("dialog.showMessageBox",{title:d.localize.getString("Confirm"),message:e,type:"question",defaultId:0,cancelId:1,buttons:[d.localize.getString("OK"),d.localize.getString("Cancel")]}).then(({response:e})=>{0==e?t():n&&n()}):window.confirm(e)?t():n&&n()},F=!0,S=function(){F=!1,d("#zoom-hint").on("click","#zoom-hint-in",function(){JSBridge.zoom.zoomOut()}).on("click","#zoom-hint-out",function(){JSBridge.zoom.zoomIn()}).on("click","#zoom-hint-reset",function(){JSBridge.zoom.resetZoom()})},k=new p,E=k.show.bind(k);t.dialog=k,t.showDialog=E,window.showDialog=E,t.showNativeDialog=function(t){File.isMac?window.bridge.callHandler("window.showDialog",{message:t.message,checkbox:t.checkbox||"",buttons:t.buttons||[]},function(e){t.callback(e[0],e[1])}):(t.checkbox&&(t.checkbox={label:t.checkbox}),k.show(t))},t.showErrorDialog=function(e,t){window.reqnode?JSBridge.invoke("dialog.showMessageBox",{type:"error",title:d.localize.getString("Error"),message:d.localize.getString(e,"Panel"),detail:d.localize.getString(t,"Panel"),buttons:[d.localize.getString("OK")]}):alert(d.localize.getString(e,"Panel")+"\n"+d.localize.getString(t,"Panel"))},t.showWarningDialog=function(e,t){var n=t?d.localize.getString("Do not show this again","Panel"):"";return window.reqnode?JSBridge.invoke("dialog.showMessageBox",{type:"question",message:e,defaultId:0,cancelId:1,buttons:[d.localize.getString("OK"),d.localize.getString("Cancel")],checkboxLabel:n}):File.isMac?new Promise(t=>{window.bridge.callHandler("window.showDialog",{message:e,checkbox:n,buttons:[d.localize.getString("OK"),d.localize.getString("Cancel")]},function(e){t({response:e[0],checkboxChecked:e[1]})})}):void 0},t.showNotificationWithTitle=function(e,t,n,i,r){var o=(t=(t=t||"").trim?t:t.message||"")&&`<br/><span class='md-notification-detail'>${s.escape(t.trim().replace(/\n[\s\S]*/,""))}</span>`,e=t?"<strong>"+s.escape(e)+"</strong>":s.escape(e),e=v(e+o,!0,n,i,r).find(".md-notification-detail");e.length&&((e[0].scrollWidth>e[0].offsetWidth||-1<t.trim().indexOf("\n"))&&e.after("<a id='md-notification-more-btn' class='btn-xs btn'>{label}</a>".replace("{label}",d.localize.getString("View More","Panel"))),d("#md-notification-more-btn").off("click").on("click",function(){E({message:t,tag:"detail",helperButtons:[d.localize.getString("Copy","Menu")],callback:function(e){0==e&&File.editor.UserOp.setClipboard(null,null,t,!0)}})}))},t.showNotification=v,window.showNotification=v,t.showProcessingNotification=function(e,t){d("#md-notification").html(["<p>"+d.localize.getString(e,"Panel"),`
<div class="typora-search-spinner typora-export-spinner" style="margin-right:16px;top:8px">`,'<div class="rect1"></div>','<div class="rect2"></div>','<div class="rect3"></div>','<div class="rect4"></div>','<div class="rect5"></div>',"</div></p>"].join("")),document.body.classList.add("ty-show-notification"),t?document.body.classList.add("ty-notification-no-animation"):document.body.classList.remove("ty-notification-no-animation")},t.hideNotification=y,t.confirm=C,t.confirmWithPromise=function(t){return new Promise(e=>{C(t,()=>{e(!0)},()=>{e(!1)})})},t.showZoomPanel=f,t.replaceTag=function(e,t){var n=e[0].outerHTML,i=new RegExp("<"+e[0].tagName,"i"),n=n.replace(i,"<"+t),i=new RegExp("</"+e[0].tagName+">$","i"),n=n.replace(i,"</"+t+">"),i=d(n);return e.replaceWith(i),i},t.getEditParent=function(e,t){return t.getClosetBlock(!0)},t.fixPopoverPosition=function(i,e,t){var n,r=i.offset(),o=d(editor.sessionStr).offset().left+10,a=d(editor.sessionStr).width(),s=i.find(".md-arrow");return(e=e||".code-tooltip.md-hover-tip").jquery?s=(n=e).find(".md-arrow"):n=i.find(e),i.length?(n.css("max-width",a-60),r.top+=i.height()*(t?1:1.5)+(t?0:4),r.left+=(i.width()-n.width())/2,r.left+n.width()>window.innerWidth-10?r.left=window.innerWidth-10-n.width():r.left<o&&(r.left=o),n.css("position","absolute").offset(r),t||s.offset(function(e,t){var n={};return n.left=i.offset().left+i.width()/2,n.top=t.top,n}),n):(console.sendError("cannot fixPopoverPosition on empty $parent"),n.hide())},t.resetClick=function(e){var t,n,i,r,o,a,s,l,c=File.editor;if(u)return!(u=!1);e.target&&("CONTENT"==e.target.tagName||"HTML"==e.target.tagName)&&(t=e.clientX,n=e.clientY,c=document.querySelector(c.sessionStr),i=d(c).offset())&&(r=document.createEvent("MouseEvents"),o=i.left,a=i.left+c.clientWidth,s=i.top,l=i.top+c.clientHeight,o<=t&&t<=a||s<=n&&n<=l||(u=!0,t=t<i.left?i.left+1:i.left+c.clientWidth-1,n=n<i.top?i.top+1:i.top+c.clientHeight-1,e.stopPropagation(),r=document.createEvent("MouseEvents"),(c=document.elementFromPoint(t,n))&&(r.initMouseEvent("click",!0,!0,c.ownerDocument.defaultView,1,e.screenX+(t-e.clientX),e.screenY+(n-e.clientY),t,n,e.ctrlKey,e.altKey,e.shiftKey,e.metaKey,e.button),c.dispatchEvent(r))))},t.getWordCount=function(e){var t;return 0===e.trim().length?0:(t=0,e=["d",e.replace(/[\u3040-\uABFF\uD7A4-\uFAFF]/gi,function(e){return t++," "}).replace(/(^|\s+)[(\u3000-\u303F)!-\/:-@\[-`{-~]+(\s+|$)/gm," "),"d"].join(" ").split(/[(\u3000-\u303F)\s!-,\.\\:-@\[-`{-~]+/g).length,t+e-2)},t.findAnchorElem=function(e,t){return o(e,t)[0]},t.normalizeAnchor=function(t,e,n){var[i,r]=o(t,!0),t=i.length?"#"+s.titleToAnchor(i.text()):t;return 0===r?(e&&1<e.filter(e=>e==t).length||n&&"write"==t)&&(r=1):i||(r=void 0),t+(r?"-"+r:"")},t.fetchAnchorList=function(i,r){var o=[];return Array.prototype.slice.call(document.querySelectorAll(".md-html-inline a[name], .md-htmlblock-container a[name]")).map(function(e){e=s.decodeFromEscapedPath((e.getAttribute("name")||"").substring(1));o.push(e)}),Array.prototype.slice.call(document.querySelectorAll(".md-heading[cid]")).map(function(e){var t,n=e.getAttribute("cid");i[n]||(t=function(e){for(var t=0,n=0;n<o.length;n++)o[n].toLowerCase()==e&&t++;return t}(e=s.titleToAnchor(e.innerText)),o.push(e),t?i[n]=e+"-"+(t+1):(r||"write"!=e||(e+="-1"),i[n]=e))}),o},t.keyOnControl=function(e,t,n){var i,r,o;function a(e){var t=d(".modal-dialog:visible");if(!t.length){if(e){e=document.querySelector("#write");if(e==document.activeElement||e.contains(document.activeElement))return t;t=d(".ty-show-notification #md-notification")}t=d(".ty-show-notification #md-notification")}return t}if("Tab"==e){if((i=a(n)).length&&(o=(r=i.find("button, input:not(#common-dialog-checkbox), .ty-dialog-show-checkbox #common-dialog-checkbox")).index(document.activeElement),r.length))return t.shiftKey?o--:o++,o=o>=r.length?0:o,o=Math.max(0,o),r.eq(o).focus(),!0}else if("Esc"==e)(i=a(!0))&&i.hasClass("modal-dialog")?1==i.find("button").length&&1==i.find(".btn-primary").length||i.parent().modal("hide"):document.body.classList.contains("ty-show-notification")&&document.body.classList.remove("ty-show-notification");else if("Enter"==e&&document.activeElement){if(document.activeElement==document.body||"DIV"==document.activeElement.tagName){if((i=a()).length)return i.find("button.btn-primary").eq(0).focus().trigger("click").length}else if("BUTTON"==document.activeElement.tagName)return d(document.activeElement).focus().trigger("click"),!0}else if(("Left"==e||"Right"==e)&&(i=a()).length&&document.activeElement&&"BUTTON"==document.activeElement.tagName&&-1<(o=(r=i.find("button")).index(document.activeElement)))return"Left"===e?o--:o++,o=o>=r.length?0:o,o=Math.max(0,o),r.eq(o).focus(),!0},t.showTypeWriterModeWarning=function(){i("noWarnigForTypeWriterMode","Typewriter Mode")},t.showFocusModeWarning=function(){i("noWarnigForFocusMode","Focus Mode")},t.markRange=function(e,t){var n=document.createElement("span"),t=(n.classList.add(t),b(e.startContainer,e.startOffset)&&e.setStart(w(e.startContainer),0),e.endContainer&&e.endContainer.parentElement&&e.endContainer.parentElement.closest(".md-entity"));return n.appendChild(e.extractContents()),e.insertNode(n),!t||t.innerText||t.contains(n)||t.remove(),n},t.unmarkSpan=function(e){var t=e.parentElement;if(t){for(;e.firstChild;)t.insertBefore(e.firstChild,e);t.removeChild(e),t.getAttribute("md-inline")&&x(t),t.normalize()}},t.mergeSameChildren=x,t.showHintOrWarning=r,window._options&&window._options.zoomFactor&&1!=_options.zoomFactor&&(window._options.onFirstLaunch?f(_options.zoomFactor):document.body.classList.remove("on-zoom"))}),$__System.registerDynamic("34",["11","32","28"],!0,function(e,t,n){"use strict";this||self;var s,r,l=e("11"),c=e("32"),d=e("28"),i=null,o=null,u=function(e){var t=new Date;return s=l.formateDateOnly(new Date)+" "+(e||"untitled").replace(/\.[^.]*$/,"")+" "+l.formateTimeOnly(t,!0).replace(/:/g,"")+".md"};function a(n){var i;try{var e=reqnode("fs");o&&e.unwatchFile(o),o=n,e.watchFile(n,function(e,t){new Date-File.bundle.modifiedDate<900||e&&e.mtime==t.mtime||(i&&clearTimeout(i),i=setTimeout(function(){e?File.presentedItemChanged(void 0,e,n):f(),i=null},200))})}catch(e){console.log(e)}}function h(n,i){var e=reqnode("fs");File.editor.library.isSuppressOnChange()||(e.stat(n,function(e,t){if(File.isTextBundle()){if(0!=n.indexOf(File.bundle.filePath||":")&&n.indexOf(File.bundle.originalPath||":"))return}else if(n!==File.bundle.filePath&&n!==File.bundle.originalPath)return;e||!t?(p(null),window.clientHandlerOnPresentationMoved()):(File.presentedItemChanged(void 0,t,n),i&&p(n))}),r=null)}function p(n){if(reqnode&&!File.isTextPack()){var e=reqnode("fs");if(i&&(i.removeAllListeners(),i.close(),i._handle=null,i=null),r&&clearTimeout(r),r=null,o&&e.unwatchFile(o),n)try{(i=e.watch(n,{persistent:!1}))._start=new Date,i.on("change",function(e,t){new Date-i._start<100||("rename"==e?File.inSavingProcess?p(n):(e=reqnode("path")).join(e.dirname(n),t)==n&&h(n,!0):new Date-File.bundle.modifiedDate<900||(r&&clearTimeout(r),r=setTimeout(function(){h(n)},500)))}),i.on("error",function(e){i.close(),i._handle=null,i=null,a(n)})}catch(e){i&&"ENOENT"==e.code?(i.close(),i._handle=null,i=null):a(n)}}}var f=function(){JSBridge.invoke("document.switchToUntitled",File.bundle.filePath),Reporter.record("current file is moved/deleted")},m=(window.clientHandlerOnPresentationMoved=function(){File.isNode&&File.isActiveWindow()&&File.updateChangeCount(File.ChangeType.NSChangeReadOtherContents),v()},function(e){e&&window.debugMode&&console.warn(e)}),g=async function(n,e){if(s&&n){var i=await S(!0);e&&(i=i+(File.isWin?"\\":"/")+e);try{var r=reqnode("fs"),o=reqnode("path"),t=File.isWin?"\\":"/",a=o.resolve(i,s);if(e)return File.draftsRecoverList.push(i+t+s),void y();r.stat(a,function(e,t){e||(e=o.resolve(i,u(n)),r.rename(a,e,m),File.draftsRecoverList.push(e),y())})}catch(e){console.sendError(e)}}},y=function(){if(!(File.draftsRecoverList.length<(File.isTextBundle()?6:10))){for(var e=20<File.draftsRecoverList.length?1e3:500,n=[],i=[File.draftsRecoverList[0]],t=/(\d+)\.md$/,r=+t.exec(File.draftsRecoverList[0])[1],o=2;o<File.draftsRecoverList.length;o++){var a=File.draftsRecoverList[o],s=+t.exec(File.draftsRecoverList[o])[1];0<s-r&&s-r<e?n.push(a):(i.push(a),r=s)}var l=i,c=(40<i.length&&(l=[],i.forEach((e,t)=>{(t%2==0||t==i.length-1?l:n).push(e)})),File.draftsRecoverList=l,reqnode("fs"));n.forEach(e=>{c.unlink(e,e=>{})})}},v=function(e){console.log("onFilePathRemoved"),File.bundle.filePath&&(File.bundle.originalPath=File.bundle.filePath,File.bundle.filePath="",x(File.bundle.fileName))},b=function(e,t){File.isTextBundle()||File.editor.imgEdit.onFileMoved(e,t)},w=async function(e){var t=File.isWin?"\\":"/",n=S(!0),e=C(e),i=C();try{await reqnode("fs-extra").move(n+t+e,n+t+i)}catch(e){console.info(e)}},x=function(t,e,n){var i,r=File.bundle.filePath,o=(/bundle\//.exec(r),t=t||c.getFileNameFromPath(r||File.bundle.originalPath),File.bundle.fileName=t,{"File→Open File Location":{enabled:!!r},"File→Reveal in Sidebar":{enabled:!!r},"File→Delete…":{enabled:!!r}}),o=(File.isNode&&!File.isMacNode&&(o["File→Reopen with Encoding"]={hidden:!r}),File.isWin?o["File→Properties"]={enabled:!!r}:File.isMac&&(o["File→Get Info"]={enabled:!!r}),JSBridge.menu.update(o),console.log("onFilePathUpdated "+r),window.Reporter.record("File.bundle.filePath = "+l.hashCode(r)),File.bundle.assetsChanges=null,File.editor&&File.editor.imgEdit),a=File.editor&&File.editor.library;o&&(o.cachedFileImageStorage=void 0),File.setDefaultImageStorage(File.option.defaultImageStorage),File.onMetaDataChanged(),a&&File.editor.library.markCurrentFile(),e&&b(e,n),File.isTextBundle()&&w(e||""),File.isNode&&(i=$("#title-text"),r?(JSBridge.invoke("document.hasDuplicateName",t).then(e=>{e?(i.text(r),JSBridge.invoke("window.setTitle",r+" - Typora")):(i.text(t),JSBridge.invoke("window.setTitle",t+" - Typora")),c.refreshTitlebarText()}),g(t),File.editor.library&&(File.editor.library.markCurrentFile(),!File.mountFolder_||-1==(o=reqnode("path").normalize)(r).indexOf(o(File.mountFolder_.replace(/[\/\\]$/,"")+(File.isWin?"\\":"/"))))&&(File.setMountFolder(reqnode("path").dirname(r)),File.editor.library.onRootChanged(File.mountFolder_,!0))):t?(i.text(t),JSBridge.invoke("window.setTitle",t+"• - Typora")):(i.text($.localize.getString("Untitled")),JSBridge.invoke("window.setTitle",$.localize.getString("Untitled")+(File.changeCounter&&!File.changeCounter.curState?"• - Typora":" - Typora"))),p(File.getTextFile()||null),/draftsRecover/.exec(File.bundle.filePath||""))&&(a=reqnode("path"),n=a.join(File.option.userDataPath,"draftsRecover"),0==a.normalize(File.bundle.filePath).indexOf(n+a.sep))&&d.showHintOrWarning({key:"",title:"<strong>"+$.localize.getString("You are not supposed to edit or save this file.","Front")+"</strong>",body:$.localize.getString("Files in this location (%@) are managed by Typora, and may be deleted automatically.<br/>Please copy content to a new file for further editing.","Front").replace("%@","draftsRecover")})};var C=function(e){var t;return File.isTextBundle()||File.isTextPack()?File.bundle.unzipFolder?l.getFileName(File.bundle.unzipFolder):(t=(e=void 0!==e?e:File.bundle.filePath||File.bundle.originalPath)?function(n){let i=0;for(let e=0,t=n.length;e<t;e++){var r=n.charCodeAt(e);i=(i<<5)-i+r,i|=0}return i}(e):File.bundle.untitledId,e=e+(File.isWin?"\\":"/")+File.bundle.bundleFile,(c.getFileNameFromPath(e)||"untitled").replace(/\.textbundle$/,"")+"-"+t):null},F=async function(e,t){var n=File.isWin?"\\":"/",i=C(),r=await S(!0);if(0!=(File.bundle.filePath||"").indexOf(r)){var r=r+n+i,o=reqnode("fs-extra");await o.ensureDir(r),u("text");try{await o.writeFile(r+n+s,e),g(s,i)}catch(e){console.sendError(e,"skip")}if("skip"!==t)try{await o.copy(File.bundle.filePath+n+"assets",r+n+"assets",{overwrite:"overwrite"===t})}catch(e){"ENOENT"==!e.code&&console.sendError(e,"skip")}}},S=function(e){var t=window._options.userDataPath+(File.isWin?"\\":"/")+"draftsRecover";return e?t:new Promise(e=>{reqnode("fs-extra").ensureDir(t).then(()=>{e(t)},()=>{e("")})})},k=function(e,t){try{u(File.getFileName()),reqnode("fs").writeFile(t+"/"+s,e,function(e){e?m(e):g(File.getFileName(!0))})}catch(e){console.sendError(e,"skip")}};t.textBundleDraftFolder=async function(){if(File.bundle.unzipFolder)return File.bundle.unzipFolder;if(e=await S()){var e,t=File.isWin?"\\":"/";if(0!=(File.bundle.filePath||"").indexOf(e))return e=e+t+C(),File.bundle.unzipFolder=e}},t.saveFileToRecover=async function(e){if(File.bundle.filePath&&(n=await S())){var t=File.isWin?"\\":"/";if(0!=(File.bundle.filePath||"").indexOf(n)){if(File.isTextBundle()){u("text");var n=n+t+C();if(e)try{return void await reqnode("fs-extra").copy(File.bundle.fileName,n,{overwrite:!1})}catch(e){console.sendError(e,"skip")}}else u(File.getFileName());try{await reqnode("fs-extra").copy(File.getTextFile(),n+(File.isWin?"\\":"/")+s),g(File.getFileName(!0),C())}catch(e){console.sendError(e,"skip")}}}},t.backupAssets=async function(e,t){if(File.bundle.filePath){var n,i=reqnode("fs-extra"),r=await F(),o=File.isWin?"\\":"/",a=r+o+File.getFileName()+o+"assets",s=(await i.ensureDir(a),[]);for(n of e){var l=File.bundle.filePath+o+"assets"+o+n;s.push(t?i.move(l,a+o+n,{overwrite:!1}):i.copy(l,a+o+n,{overwrite:!1,errorOnExist:!1}))}return Promise.all(s)}},t.watchFileChange=p,t.onPresentationMoved=f,t.onFilePathUpdated=x,t.onFilePathRemoved=v,t.saveToRecover=async function(e,t){var n;e&&("string"!=typeof e||e.trim().length)&&(n=await S())&&(File.isTextBundle()?await F(e,t):k(e,n))},t.prepareInfoPanel=function(){function e(e){$(".info-panel-tab.active").removeClass("active"),"file"==e?File.editor.library.switch("files",!0):File.editor.library.switch("outline")}document.querySelector("#file-library").style.display="",document.querySelector("#file-info-content").style.display="none",$("#info-panel-tab-file").on("click",function(){e("file")}),$("#info-panel-tab-outline").on("click",function(){e("outline")})},t.assetsParentForUntitled=function(){var e=File.isWin?"\\":"/",t=C();return S(!0)+e+t}}),$__System.registerDynamic("59",["11","28","32","34"],!0,function(e,t,n){"use strict";this||self;var s,a,l,c,d,u,h,p,i,f,r,o,m,g,y,v,b,w,x,C=void 0;window.reqnode&&(s=reqnode("child_process").spawn,a=e("11"),l=e("28"),c=e("32"),e("34"),d=null,u=()=>File.option.pandocPath||"pandoc",h=function(e,i,r,t){p(),(t||{}).cwd||(n=c.getCurrentFileFolderPath())&&(t=Object.assign({cwd:n},t)),e.join(" "),d=s(u(),e,t);var n,o=[],a=[];return d.on("close",function(e){var t=Buffer.concat(o),n=Buffer.concat(a).toString();i(r,t,n,e),d=null}),d.stdout.on("data",function(e){o.push(e)}),d.stderr.on("data",function(e){a.push(e)}),d},p=function(){d&&d.kill&&(d.removeAllListeners("close"),d.kill()),d=null},i=(...o)=>new Promise(function(t,n){var i="",r="",e=s.apply(null,o);e.stdout.on("data",function(e){i+=e}),e.stderr.on("data",function(e){r+=e}),e.on("error",n).on("close",function(e){0===e?t(i):n(r)})}),r=!(f=async function(e){var t=await JSBridge.invoke("pandoc.version"),n=void 0===n?void 0:n&&n+""!="false";if(!e||void 0===n){if(n)return window.pandocVersion=t,!0;try{n=!0,t=(((await i(u(),["--version"],{windowsHide:!0})).toString("utf8").split(/\r|\n|\r\n/)||[])[0].match(/[\d.]{2,}/)||[])[0];n=0<=a.compareVersion(t,"2.0"),window.pandocVersion=t}catch(e){n=!1,console.sendError(e,!1)}n||e||l.showDialog({title:$.localize.getString("Require Pandoc to Continue...","Panel"),html:$.localize.getString("Import or some export features requires <a href='http://pandoc.org/' target='_blank'>Pandoc</a> (≥ v2.0) to be installed.","Panel"),buttons:[$.localize.getString("Follow Instructions to Install/Update Pandoc","Panel"),$.localize.getString("Set Pandoc Path","Panel"),$.localize.getString("Cancel","Panel")],tag:"pandoc-warning",backdrop:!1,callback:function(e){document.body.classList.remove("ty-show-notification"),0==e&&JSBridge.invoke("app.openFile",window.dirname+"/Docs/Install and Use Pandoc.md",{forceCreateWindow:!0}),1==e&&(l.dialog.hide(),setTimeout(o,10))}}),JSBridge.invoke("pandoc.setVersion",n?t:"false")}return n}),m=!(o=function(){l.showDialog({title:$.localize.getString("Pandoc Path","Panel"),html:`<div class='input-group ty-pandoc-path-select-row'><input id='ty-pandoc-path-input' type='text' value='${File.option.pandocPath||""}' placeholder='(auto detect)'/><button id='ty-pandoc-path-select' type='button' class='btn' ty-hint='${$.localize.getString("Select","Panel")}'><i class='fa fa-folder' aria-hidden='true'/></button><button id='ty-pandoc-path-reset' type='button' class='btn'><i class='fa fa-times-circle' aria-hidden='true' ty-hint='${$.localize.getString("Reset","Panel")}'></i></button></div>`,buttons:[$.localize.getString("OK","Panel"),$.localize.getString("Cancel","Panel")],backdrop:!1,callback:function(e){0==e&&(JSBridge.invoke("pandoc.setVersion",void 0),File.option.pandocPath=$("#ty-pandoc-path-input").val().trim(),JSBridge.putSetting("pandocPath",File.option.pandocPath),JSBridge.execForAll("File.option.pandocPath="+JSON.stringify(File.option.pandocPath)))}}),r||(r=!0,l.dialog.$dialog.on("click","#ty-pandoc-path-select",function(){JSBridge.selectFile(File.option.pandocPath||"",[{name:"Executable",extensions:[File.isWin?"exe":""]}],e=>{$("#ty-pandoc-path-input").val(e||"")})}).on("click","#ty-pandoc-path-reset",function(){$("#ty-pandoc-path-input").val("")}))}),y=function(e,t,n,i,r,o){g&&g.modal("hide"),document.body.classList.remove("ty-show-notification"),File.blockUI=!1,0!==i?(i=n,l.showDialog({title:$.localize.getString("Export Failed","Panel"),html:(e?$.localize.getString("Failed to export file to <em>{0}</em>").format(a.escape(e)):"")+"<br />"+(r?`${$.localize.getString("Command Arguments:","Panel")}<pre style="user-select: all;">${r.map(e=>1<r.length&&/[\s'"]/.exec(e)&&!/^['"-]/.exec(e)?JSON.stringify(e):e).join(" ")}</pre>`:"")+`Error:<pre style='white-space: pre-line;' >${a.escape(i.substring(0,500))}</pre>`,type:"error",backdrop:"static"}),console.sendError(i)):File.editor.export.onExportSuccess("pandoc",e,o,t,n,r&&r.map(e=>1<r.length&&/[\s'"]/.exec(e)&&!/^['"-]/.exec(e)?JSON.stringify(e):e)),File.editor.export.cleanUpTempFiles()},v=function(e,t,n,i){g.modal("hide"),File.unlock(),File.blockUI=!1,t&&0!=t.length?File.reloadContent(t.toString(),{skipUndo:!0}):l.showDialog({title:$.localize.getString("Import Failed","Panel"),html:$.localize.getString("Failed to import file from <em>{0}</em>","Panel").format(a.escape(e))+"<br />"+a.escape(n),type:"error",backdrop:"static"}),File.updateChangeCount(File.ChangeType.NSChangeDone),p()},b=function(e,t){var n=[e];return"latex"==e?n=["tex","latex","txt"]:"wiki"==e?n=["wiki","txt"]:"rst"==e?n=["rst","text","rest","reStructuredText"]:"opml"==e?n=["opml","xml"]:"textile"==e?n=["textile","txt","text"]:"latex-pdf"==e?n=["pdf"]:"pandoc"==e?n=t.extensions||[]:"markdown"==e&&(n=["md","markdown","mmd","mkd","mkdown","rmd","qmd","rmarkdown","text","txt"],"markdown_mmd"==t.variants)&&(n=["mmd","md","markdown","mkd","mkdown","rmd","qmd","rmarkdown","text","txt"]),n},w=function(e,t,n,i){e=e[t];return!(!e||!e.trim().length||(i?(n.push("--"+t),n.push(e)):n.push(`--${t}=`+(/\d+/.exec(e)?e:JSON.stringify(e))),0))},x=function(e,t,n){var t=["-f","native","-s","-o",t,"-t",e],i=!1,e=("wiki"==e&&(t.pop(),t.push("mediawiki")),"latex-pdf"==e&&(t.pop(),t.push("pdf")),"pandoc"==e&&(i=!0,t.pop(),n.targetFormat?t.push(n.targetFormat):t.pop()),"markdown"==e&&(i=!0,t.pop(),t.push(n.variants||"markdown"),n.hardLineWrap&&t.push("--columns="+(n.columns||130)),n.eol&&t.push("--eol="+(n.eol||"native")),"tab"==n.tab?t.push("--preserve-tabs"):n.tab&&t.push("--tab-stop="+(n.tab||4)),n.ascii&&t.push("--ascii"),n["reference-links"]&&t.push("--reference-links"),n["reference-location"]&&t.push("--reference-location="+(n["--reference-location"]||"document")),n["markdown-headings"]&&t.push("--markdown-headings="+(n["--markdown-headings"]||"atx")),n.webtex)&&t.push(`--webtex=https://latex.codecogs.com/${n["webtex-format"]||"png"}.latex`),t.length);return n.extraArguments&&(t=t.concat(n.extraArguments)),w(n,"reference-doc",t,!0),w(n,"template",t,!0),w(n,"css",t,!0),w(n,"epub-chapter-level",t),w(n,"toc",t)&&t.pop(),w(n,"pdf-engine",t),[t,i||e!==t.length]},(C={prepImport:async function(){m=!1,await f()&&(m=File.changeCounter.isDiscardableUntitled(),JSBridge.invoke("pandoc.import",m))},import:function(e){File.lock(),File.blockUI=!0,g=$("#import-process-dialog"),d=h([e,"--quiet","--wrap=none","-t","gfm-smart+tex_math_dollars-fenced_divs-bracketed_spans-raw_html"],v,e),setTimeout(function(){d&&(g.modal({backdrop:"static",keyboard:!1}),g.find(".btn").one("click",function(){p(),m||JSBridge.invoke("window.close")}))},200)},runExportCommand:function(e,t){return p(),e?new Promise(i=>{var r,o,a;(0,reqnode("child_process").exec)(e,{cwd:t},(e,t,n)=>{e?(console.log("error: "+e.message),i({code:-1,error:e.message})):(n&&console.log("stderr: "+n),r=n,o=t,void 0!==a&&i({code:a,error:r,message:o}))}).on("exit",function(e){a=e,void 0===r&&void 0===o||i({code:a,error:r,message:o})})}):{code:-1,error:"command is empty"}},customExport:async function(e,t,n,i){n=await C.runExportCommand(t,n);y(e||"",n.message||"",n.error||"",n.code,[t],i)},export:async function(e,t){var n,o,a,i,r,s;await f()&&(t=t||{},r="pandoc"==e?((t.extensions||"").trim().split(/\s+/g)||[]).map(e=>e.replace(/^\./,"")):"native"==e?[""]:b(e,t),(n=await c.showExportDialog(r[0],t,[{name:"pandoc"==e?t.targetFormat:e,extensions:r},{name:$.localize.getString("All Files","Panel"),extensions:[""]}]))?(File.editor.export.recordLastExport(t,n),File.blockUI=!0,r="pandoc"==e||"native"==e,s=x(e,n,t),o=s[0],a=r||s[1],o.join(", "),i=new Date,r="native"==e?function(e){reqnode("fs").writeFile(n,e,function(e){y(n,"",e,e?-1:0,a?o:null,t)})}:function(e,r){o=o.map(e=>File.editor.export.processExportVariables(e,{outputPath:n})),(d=h(o,(e,t,n,i)=>{y(e,t,n,i,a?o:null,r)},n,{stdio:"pipe",cwd:r.cwd})).stdin.end(e,"utf8"),g=$("#export-process-dialog");e=Math.max(500-new Date+i,0);setTimeout(function(){d&&(g.modal({backdrop:"static",keyboard:!1}),g.find(".btn").one("click",function(){File.blockUI=!1,p(),g.modal("hide")}))},e)},s=reqnode("path").dirname(n),File.editor.export.exportToNative(e,r,s,t)):document.body.classList.remove("ty-show-notification"))}}).silentQuit=p,C.validatePandocInstall=f),n.exports=C}),$__System.registerDynamic("60",[],!1,function(B,R,e){var e=$__System.registry.get("@@global-helpers").prepareGlobal(e.id,null,null),t=this;t.nfkc=P,t.nfc=D,t.nfkd=N,t.nfd=L,t.fromCpFilter=A,t.fromRuleBasedJamo=_,t.fromCpOnly=T,t.fromData=E,t.fromCache=k;for(var n=t.root,r=t.DEFAULT_FEATURE,o=t.CACHE_THRESHOLD,s=t.SBase,l=t.LBase,c=t.VBase,d=t.TBase,u=t.LCount,h=t.VCount,p=t.TCount,f=t.NCount,m=t.SCount,g=t.UChar,a=t.cache,y=t.cacheCounter,i=t.i,v=t.strategies,b=t.UCharIterator,w=t.RecursDecompIterator,x=t.DecompIterator,C=t.CompIterator,F=(t.createIterator,t.normalize),S=t.unorm,n=window,r=[null,0,{}],o=10,s=44032,l=4352,c=4449,d=4519,m=(u=19)*(f=(h=21)*(p=28)),g=function(e,t){this.codepoint=e,this.feature=t},a={},y=[],i=0;i<=255;++i)y[i]=0;function k(e,t,n){var i=a[t];return i||(i=e(t,n)).feature&&++y[t>>8&255]>o&&(a[t]=i),i}function E(e,t,n){var i=(g.udata[65280&t]||{})[t];return new g(t,i||r)}function T(e,t,n){return n?e(t,n):new g(t,null)}function _(e,t,n){if(t<l||l+u<=t&&t<s||s+m<t)return e(t,n);if(l<=t&&t<l+u){for(var i={},r=(t-l)*h,o=0;o<h;++o)i[c+o]=s+p*(o+r);return new g(t,[,,i])}var e=t-s,n=e%p,a=[];if(0!=n)a[0]=[s+e-n,d+n];else for(a[0]=[l+Math.floor(e/f),c+Math.floor(e%f/p)],a[2]={},o=1;o<p;++o)a[2][d+o]=t+o;return new g(t,a)}function A(e,t,n){return t<60||13311<t&&t<42607?new g(t,r):e(t,n)}function M(e,t){switch(e){case"NFD":return new x(new w(new b(t),!0));case"NFKD":return new x(new w(new b(t),!1));case"NFC":return new C(new x(new w(new b(t),!0)));case"NFKC":return new C(new x(new w(new b(t),!1)))}throw e+" is invalid"}function L(e){return F("NFD",e)}function N(e){return F("NFKD",e)}function D(e){return F("NFC",e)}function P(e){return F("NFKC",e)}return v=[A,k,T,_,E],g.fromCharCode=v.reduceRight(function(n,i){return function(e,t){return i(n,e,t)}},null),g.isHighSurrogate=function(e){return 55296<=e&&e<=56319},g.isLowSurrogate=function(e){return 56320<=e&&e<=57343},g.prototype.prepFeature=function(){this.feature||(this.feature=g.fromCharCode(this.codepoint,!0).feature)},g.prototype.toString=function(){var e;return this.codepoint<65536?String.fromCharCode(this.codepoint):(e=this.codepoint-65536,String.fromCharCode(Math.floor(e/1024)+55296,e%1024+56320))},g.prototype.getDecomp=function(){return this.prepFeature(),this.feature[0]||null},g.prototype.isCompatibility=function(){return this.prepFeature(),!!this.feature[1]&&256&this.feature[1]},g.prototype.isExclude=function(){return this.prepFeature(),!!this.feature[1]&&512&this.feature[1]},g.prototype.getCanonicalClass=function(){return this.prepFeature(),this.feature[1]?255&this.feature[1]:0},g.prototype.getComposite=function(e){return this.prepFeature(),this.feature[2]&&(e=this.feature[2][e.codepoint])?g.fromCharCode(e):null},(b=function(e){this.str=e,this.cursor=0}).prototype.next=function(){var e,t;return this.str&&this.cursor<this.str.length?(e=this.str.charCodeAt(this.cursor++),g.isHighSurrogate(e)&&this.cursor<this.str.length&&g.isLowSurrogate(t=this.str.charCodeAt(this.cursor))&&(e=1024*(e-55296)+(t-56320)+65536,++this.cursor),g.fromCharCode(e)):this.str=null},(w=function(e,t){this.it=e,this.canonical=t,this.resBuf=[]}).prototype.next=function(){if(0===this.resBuf.length){var e=this.it.next();if(!e)return null;this.resBuf=function e(t,n){var i=n.getDecomp();if(!i||t&&n.isCompatibility())return[n];for(var r=[],o=0;o<i.length;++o)var a=e(t,g.fromCharCode(i[o])),r=r.concat(a);return r}(this.canonical,e)}return this.resBuf.shift()},(x=function(e){this.it=e,this.resBuf=[]}).prototype.next=function(){if(0===this.resBuf.length)do{var e=this.it.next();if(!e)break;var t=e.getCanonicalClass(),n=this.resBuf.length;if(0!==t)for(;0<n;--n)if(this.resBuf[n-1].getCanonicalClass()<=t)break}while(this.resBuf.splice(n,0,e),0!==t);return this.resBuf.shift()},(C=function(e){this.it=e,this.procBuf=[],this.resBuf=[],this.lastClass=null}).prototype.next=function(){for(;0===this.resBuf.length;){var e,t,n=this.it.next();if(!n){this.resBuf=this.procBuf,this.procBuf=[];break}0===this.procBuf.length?(this.lastClass=n.getCanonicalClass(),this.procBuf.push(n)):(e=this.procBuf[0].getComposite(n),t=n.getCanonicalClass(),e&&(this.lastClass<t||0===this.lastClass)?this.procBuf[0]=e:(0===t&&(this.resBuf=this.procBuf,this.procBuf=[]),this.lastClass=t,this.procBuf.push(n)))}return this.resBuf.shift()},F=function(e,t){for(var n,i=M(e,t),r="";n=i.next();)r+=n.toString();return r},g.udata={0:{60:[,,{824:8814}],61:[,,{824:8800}],62:[,,{824:8815}],65:[,,{768:192,769:193,770:194,771:195,772:256,774:258,775:550,776:196,777:7842,778:197,780:461,783:512,785:514,803:7840,805:7680,808:260}],66:[,,{775:7682,803:7684,817:7686}],67:[,,{769:262,770:264,775:266,780:268,807:199}],68:[,,{775:7690,780:270,803:7692,807:7696,813:7698,817:7694}],69:[,,{768:200,769:201,770:202,771:7868,772:274,774:276,775:278,776:203,777:7866,780:282,783:516,785:518,803:7864,807:552,808:280,813:7704,816:7706}],70:[,,{775:7710}],71:[,,{769:500,770:284,772:7712,774:286,775:288,780:486,807:290}],72:[,,{770:292,775:7714,776:7718,780:542,803:7716,807:7720,814:7722}],73:[,,{768:204,769:205,770:206,771:296,772:298,774:300,775:304,776:207,777:7880,780:463,783:520,785:522,803:7882,808:302,816:7724}],74:[,,{770:308}],75:[,,{769:7728,780:488,803:7730,807:310,817:7732}],76:[,,{769:313,780:317,803:7734,807:315,813:7740,817:7738}],77:[,,{769:7742,775:7744,803:7746}],78:[,,{768:504,769:323,771:209,775:7748,780:327,803:7750,807:325,813:7754,817:7752}],79:[,,{768:210,769:211,770:212,771:213,772:332,774:334,775:558,776:214,777:7886,779:336,780:465,783:524,785:526,795:416,803:7884,808:490}],80:[,,{769:7764,775:7766}],82:[,,{769:340,775:7768,780:344,783:528,785:530,803:7770,807:342,817:7774}],83:[,,{769:346,770:348,775:7776,780:352,803:7778,806:536,807:350}],84:[,,{775:7786,780:356,803:7788,806:538,807:354,813:7792,817:7790}],85:[,,{768:217,769:218,770:219,771:360,772:362,774:364,776:220,777:7910,778:366,779:368,780:467,783:532,785:534,795:431,803:7908,804:7794,808:370,813:7798,816:7796}],86:[,,{771:7804,803:7806}],87:[,,{768:7808,769:7810,770:372,775:7814,776:7812,803:7816}],88:[,,{775:7818,776:7820}],89:[,,{768:7922,769:221,770:374,771:7928,772:562,775:7822,776:376,777:7926,803:7924}],90:[,,{769:377,770:7824,775:379,780:381,803:7826,817:7828}],97:[,,{768:224,769:225,770:226,771:227,772:257,774:259,775:551,776:228,777:7843,778:229,780:462,783:513,785:515,803:7841,805:7681,808:261}],98:[,,{775:7683,803:7685,817:7687}],99:[,,{769:263,770:265,775:267,780:269,807:231}],100:[,,{775:7691,780:271,803:7693,807:7697,813:7699,817:7695}],101:[,,{768:232,769:233,770:234,771:7869,772:275,774:277,775:279,776:235,777:7867,780:283,783:517,785:519,803:7865,807:553,808:281,813:7705,816:7707}],102:[,,{775:7711}],103:[,,{769:501,770:285,772:7713,774:287,775:289,780:487,807:291}],104:[,,{770:293,775:7715,776:7719,780:543,803:7717,807:7721,814:7723,817:7830}],105:[,,{768:236,769:237,770:238,771:297,772:299,774:301,776:239,777:7881,780:464,783:521,785:523,803:7883,808:303,816:7725}],106:[,,{770:309,780:496}],107:[,,{769:7729,780:489,803:7731,807:311,817:7733}],108:[,,{769:314,780:318,803:7735,807:316,813:7741,817:7739}],109:[,,{769:7743,775:7745,803:7747}],110:[,,{768:505,769:324,771:241,775:7749,780:328,803:7751,807:326,813:7755,817:7753}],111:[,,{768:242,769:243,770:244,771:245,772:333,774:335,775:559,776:246,777:7887,779:337,780:466,783:525,785:527,795:417,803:7885,808:491}],112:[,,{769:7765,775:7767}],114:[,,{769:341,775:7769,780:345,783:529,785:531,803:7771,807:343,817:7775}],115:[,,{769:347,770:349,775:7777,780:353,803:7779,806:537,807:351}],116:[,,{775:7787,776:7831,780:357,803:7789,806:539,807:355,813:7793,817:7791}],117:[,,{768:249,769:250,770:251,771:361,772:363,774:365,776:252,777:7911,778:367,779:369,780:468,783:533,785:535,795:432,803:7909,804:7795,808:371,813:7799,816:7797}],118:[,,{771:7805,803:7807}],119:[,,{768:7809,769:7811,770:373,775:7815,776:7813,778:7832,803:7817}],120:[,,{775:7819,776:7821}],121:[,,{768:7923,769:253,770:375,771:7929,772:563,775:7823,776:255,777:7927,778:7833,803:7925}],122:[,,{769:378,770:7825,775:380,780:382,803:7827,817:7829}],160:[[32],256],168:[[32,776],256,{768:8173,769:901,834:8129}],170:[[97],256],175:[[32,772],256],178:[[50],256],179:[[51],256],180:[[32,769],256],181:[[956],256],184:[[32,807],256],185:[[49],256],186:[[111],256],188:[[49,8260,52],256],189:[[49,8260,50],256],190:[[51,8260,52],256],192:[[65,768]],193:[[65,769]],194:[[65,770],,{768:7846,769:7844,771:7850,777:7848}],195:[[65,771]],196:[[65,776],,{772:478}],197:[[65,778],,{769:506}],198:[,,{769:508,772:482}],199:[[67,807],,{769:7688}],200:[[69,768]],201:[[69,769]],202:[[69,770],,{768:7872,769:7870,771:7876,777:7874}],203:[[69,776]],204:[[73,768]],205:[[73,769]],206:[[73,770]],207:[[73,776],,{769:7726}],209:[[78,771]],210:[[79,768]],211:[[79,769]],212:[[79,770],,{768:7890,769:7888,771:7894,777:7892}],213:[[79,771],,{769:7756,772:556,776:7758}],214:[[79,776],,{772:554}],216:[,,{769:510}],217:[[85,768]],218:[[85,769]],219:[[85,770]],220:[[85,776],,{768:475,769:471,772:469,780:473}],221:[[89,769]],224:[[97,768]],225:[[97,769]],226:[[97,770],,{768:7847,769:7845,771:7851,777:7849}],227:[[97,771]],228:[[97,776],,{772:479}],229:[[97,778],,{769:507}],230:[,,{769:509,772:483}],231:[[99,807],,{769:7689}],232:[[101,768]],233:[[101,769]],234:[[101,770],,{768:7873,769:7871,771:7877,777:7875}],235:[[101,776]],236:[[105,768]],237:[[105,769]],238:[[105,770]],239:[[105,776],,{769:7727}],241:[[110,771]],242:[[111,768]],243:[[111,769]],244:[[111,770],,{768:7891,769:7889,771:7895,777:7893}],245:[[111,771],,{769:7757,772:557,776:7759}],246:[[111,776],,{772:555}],248:[,,{769:511}],249:[[117,768]],250:[[117,769]],251:[[117,770]],252:[[117,776],,{768:476,769:472,772:470,780:474}],253:[[121,769]],255:[[121,776]]},256:{256:[[65,772]],257:[[97,772]],258:[[65,774],,{768:7856,769:7854,771:7860,777:7858}],259:[[97,774],,{768:7857,769:7855,771:7861,777:7859}],260:[[65,808]],261:[[97,808]],262:[[67,769]],263:[[99,769]],264:[[67,770]],265:[[99,770]],266:[[67,775]],267:[[99,775]],268:[[67,780]],269:[[99,780]],270:[[68,780]],271:[[100,780]],274:[[69,772],,{768:7700,769:7702}],275:[[101,772],,{768:7701,769:7703}],276:[[69,774]],277:[[101,774]],278:[[69,775]],279:[[101,775]],280:[[69,808]],281:[[101,808]],282:[[69,780]],283:[[101,780]],284:[[71,770]],285:[[103,770]],286:[[71,774]],287:[[103,774]],288:[[71,775]],289:[[103,775]],290:[[71,807]],291:[[103,807]],292:[[72,770]],293:[[104,770]],296:[[73,771]],297:[[105,771]],298:[[73,772]],299:[[105,772]],300:[[73,774]],301:[[105,774]],302:[[73,808]],303:[[105,808]],304:[[73,775]],306:[[73,74],256],307:[[105,106],256],308:[[74,770]],309:[[106,770]],310:[[75,807]],311:[[107,807]],313:[[76,769]],314:[[108,769]],315:[[76,807]],316:[[108,807]],317:[[76,780]],318:[[108,780]],319:[[76,183],256],320:[[108,183],256],323:[[78,769]],324:[[110,769]],325:[[78,807]],326:[[110,807]],327:[[78,780]],328:[[110,780]],329:[[700,110],256],332:[[79,772],,{768:7760,769:7762}],333:[[111,772],,{768:7761,769:7763}],334:[[79,774]],335:[[111,774]],336:[[79,779]],337:[[111,779]],340:[[82,769]],341:[[114,769]],342:[[82,807]],343:[[114,807]],344:[[82,780]],345:[[114,780]],346:[[83,769],,{775:7780}],347:[[115,769],,{775:7781}],348:[[83,770]],349:[[115,770]],350:[[83,807]],351:[[115,807]],352:[[83,780],,{775:7782}],353:[[115,780],,{775:7783}],354:[[84,807]],355:[[116,807]],356:[[84,780]],357:[[116,780]],360:[[85,771],,{769:7800}],361:[[117,771],,{769:7801}],362:[[85,772],,{776:7802}],363:[[117,772],,{776:7803}],364:[[85,774]],365:[[117,774]],366:[[85,778]],367:[[117,778]],368:[[85,779]],369:[[117,779]],370:[[85,808]],371:[[117,808]],372:[[87,770]],373:[[119,770]],374:[[89,770]],375:[[121,770]],376:[[89,776]],377:[[90,769]],378:[[122,769]],379:[[90,775]],380:[[122,775]],381:[[90,780]],382:[[122,780]],383:[[115],256,{775:7835}],416:[[79,795],,{768:7900,769:7898,771:7904,777:7902,803:7906}],417:[[111,795],,{768:7901,769:7899,771:7905,777:7903,803:7907}],431:[[85,795],,{768:7914,769:7912,771:7918,777:7916,803:7920}],432:[[117,795],,{768:7915,769:7913,771:7919,777:7917,803:7921}],439:[,,{780:494}],452:[[68,381],256],453:[[68,382],256],454:[[100,382],256],455:[[76,74],256],456:[[76,106],256],457:[[108,106],256],458:[[78,74],256],459:[[78,106],256],460:[[110,106],256],461:[[65,780]],462:[[97,780]],463:[[73,780]],464:[[105,780]],465:[[79,780]],466:[[111,780]],467:[[85,780]],468:[[117,780]],469:[[220,772]],470:[[252,772]],471:[[220,769]],472:[[252,769]],473:[[220,780]],474:[[252,780]],475:[[220,768]],476:[[252,768]],478:[[196,772]],479:[[228,772]],480:[[550,772]],481:[[551,772]],482:[[198,772]],483:[[230,772]],486:[[71,780]],487:[[103,780]],488:[[75,780]],489:[[107,780]],490:[[79,808],,{772:492}],491:[[111,808],,{772:493}],492:[[490,772]],493:[[491,772]],494:[[439,780]],495:[[658,780]],496:[[106,780]],497:[[68,90],256],498:[[68,122],256],499:[[100,122],256],500:[[71,769]],501:[[103,769]],504:[[78,768]],505:[[110,768]],506:[[197,769]],507:[[229,769]],508:[[198,769]],509:[[230,769]],510:[[216,769]],511:[[248,769]],66045:[,220]},512:{512:[[65,783]],513:[[97,783]],514:[[65,785]],515:[[97,785]],516:[[69,783]],517:[[101,783]],518:[[69,785]],519:[[101,785]],520:[[73,783]],521:[[105,783]],522:[[73,785]],523:[[105,785]],524:[[79,783]],525:[[111,783]],526:[[79,785]],527:[[111,785]],528:[[82,783]],529:[[114,783]],530:[[82,785]],531:[[114,785]],532:[[85,783]],533:[[117,783]],534:[[85,785]],535:[[117,785]],536:[[83,806]],537:[[115,806]],538:[[84,806]],539:[[116,806]],542:[[72,780]],543:[[104,780]],550:[[65,775],,{772:480}],551:[[97,775],,{772:481}],552:[[69,807],,{774:7708}],553:[[101,807],,{774:7709}],554:[[214,772]],555:[[246,772]],556:[[213,772]],557:[[245,772]],558:[[79,775],,{772:560}],559:[[111,775],,{772:561}],560:[[558,772]],561:[[559,772]],562:[[89,772]],563:[[121,772]],658:[,,{780:495}],688:[[104],256],689:[[614],256],690:[[106],256],691:[[114],256],692:[[633],256],693:[[635],256],694:[[641],256],695:[[119],256],696:[[121],256],728:[[32,774],256],729:[[32,775],256],730:[[32,778],256],731:[[32,808],256],732:[[32,771],256],733:[[32,779],256],736:[[611],256],737:[[108],256],738:[[115],256],739:[[120],256],740:[[661],256],66272:[,220]},768:{768:[,230],769:[,230],770:[,230],771:[,230],772:[,230],773:[,230],774:[,230],775:[,230],776:[,230,{769:836}],777:[,230],778:[,230],779:[,230],780:[,230],781:[,230],782:[,230],783:[,230],784:[,230],785:[,230],786:[,230],787:[,230],788:[,230],789:[,232],790:[,220],791:[,220],792:[,220],793:[,220],794:[,232],795:[,216],796:[,220],797:[,220],798:[,220],799:[,220],800:[,220],801:[,202],802:[,202],803:[,220],804:[,220],805:[,220],806:[,220],807:[,202],808:[,202],809:[,220],810:[,220],811:[,220],812:[,220],813:[,220],814:[,220],815:[,220],816:[,220],817:[,220],818:[,220],819:[,220],820:[,1],821:[,1],822:[,1],823:[,1],824:[,1],825:[,220],826:[,220],827:[,220],828:[,220],829:[,230],830:[,230],831:[,230],832:[[768],230],833:[[769],230],834:[,230],835:[[787],230],836:[[776,769],230],837:[,240],838:[,230],839:[,220],840:[,220],841:[,220],842:[,230],843:[,230],844:[,230],845:[,220],846:[,220],848:[,230],849:[,230],850:[,230],851:[,220],852:[,220],853:[,220],854:[,220],855:[,230],856:[,232],857:[,220],858:[,220],859:[,230],860:[,233],861:[,234],862:[,234],863:[,233],864:[,234],865:[,234],866:[,233],867:[,230],868:[,230],869:[,230],870:[,230],871:[,230],872:[,230],873:[,230],874:[,230],875:[,230],876:[,230],877:[,230],878:[,230],879:[,230],884:[[697]],890:[[32,837],256],894:[[59]],900:[[32,769],256],901:[[168,769]],902:[[913,769]],903:[[183]],904:[[917,769]],905:[[919,769]],906:[[921,769]],908:[[927,769]],910:[[933,769]],911:[[937,769]],912:[[970,769]],913:[,,{768:8122,769:902,772:8121,774:8120,787:7944,788:7945,837:8124}],917:[,,{768:8136,769:904,787:7960,788:7961}],919:[,,{768:8138,769:905,787:7976,788:7977,837:8140}],921:[,,{768:8154,769:906,772:8153,774:8152,776:938,787:7992,788:7993}],927:[,,{768:8184,769:908,787:8008,788:8009}],929:[,,{788:8172}],933:[,,{768:8170,769:910,772:8169,774:8168,776:939,788:8025}],937:[,,{768:8186,769:911,787:8040,788:8041,837:8188}],938:[[921,776]],939:[[933,776]],940:[[945,769],,{837:8116}],941:[[949,769]],942:[[951,769],,{837:8132}],943:[[953,769]],944:[[971,769]],945:[,,{768:8048,769:940,772:8113,774:8112,787:7936,788:7937,834:8118,837:8115}],949:[,,{768:8050,769:941,787:7952,788:7953}],951:[,,{768:8052,769:942,787:7968,788:7969,834:8134,837:8131}],953:[,,{768:8054,769:943,772:8145,774:8144,776:970,787:7984,788:7985,834:8150}],959:[,,{768:8056,769:972,787:8e3,788:8001}],961:[,,{787:8164,788:8165}],965:[,,{768:8058,769:973,772:8161,774:8160,776:971,787:8016,788:8017,834:8166}],969:[,,{768:8060,769:974,787:8032,788:8033,834:8182,837:8179}],970:[[953,776],,{768:8146,769:912,834:8151}],971:[[965,776],,{768:8162,769:944,834:8167}],972:[[959,769]],973:[[965,769]],974:[[969,769],,{837:8180}],976:[[946],256],977:[[952],256],978:[[933],256,{769:979,776:980}],979:[[978,769]],980:[[978,776]],981:[[966],256],982:[[960],256],1008:[[954],256],1009:[[961],256],1010:[[962],256],1012:[[920],256],1013:[[949],256],1017:[[931],256],66422:[,230],66423:[,230],66424:[,230],66425:[,230],66426:[,230]},1024:{1024:[[1045,768]],1025:[[1045,776]],1027:[[1043,769]],1030:[,,{776:1031}],1031:[[1030,776]],1036:[[1050,769]],1037:[[1048,768]],1038:[[1059,774]],1040:[,,{774:1232,776:1234}],1043:[,,{769:1027}],1045:[,,{768:1024,774:1238,776:1025}],1046:[,,{774:1217,776:1244}],1047:[,,{776:1246}],1048:[,,{768:1037,772:1250,774:1049,776:1252}],1049:[[1048,774]],1050:[,,{769:1036}],1054:[,,{776:1254}],1059:[,,{772:1262,774:1038,776:1264,779:1266}],1063:[,,{776:1268}],1067:[,,{776:1272}],1069:[,,{776:1260}],1072:[,,{774:1233,776:1235}],1075:[,,{769:1107}],1077:[,,{768:1104,774:1239,776:1105}],1078:[,,{774:1218,776:1245}],1079:[,,{776:1247}],1080:[,,{768:1117,772:1251,774:1081,776:1253}],1081:[[1080,774]],1082:[,,{769:1116}],1086:[,,{776:1255}],1091:[,,{772:1263,774:1118,776:1265,779:1267}],1095:[,,{776:1269}],1099:[,,{776:1273}],1101:[,,{776:1261}],1104:[[1077,768]],1105:[[1077,776]],1107:[[1075,769]],1110:[,,{776:1111}],1111:[[1110,776]],1116:[[1082,769]],1117:[[1080,768]],1118:[[1091,774]],1140:[,,{783:1142}],1141:[,,{783:1143}],1142:[[1140,783]],1143:[[1141,783]],1155:[,230],1156:[,230],1157:[,230],1158:[,230],1159:[,230],1217:[[1046,774]],1218:[[1078,774]],1232:[[1040,774]],1233:[[1072,774]],1234:[[1040,776]],1235:[[1072,776]],1238:[[1045,774]],1239:[[1077,774]],1240:[,,{776:1242}],1241:[,,{776:1243}],1242:[[1240,776]],1243:[[1241,776]],1244:[[1046,776]],1245:[[1078,776]],1246:[[1047,776]],1247:[[1079,776]],1250:[[1048,772]],1251:[[1080,772]],1252:[[1048,776]],1253:[[1080,776]],1254:[[1054,776]],1255:[[1086,776]],1256:[,,{776:1258}],1257:[,,{776:1259}],1258:[[1256,776]],1259:[[1257,776]],1260:[[1069,776]],1261:[[1101,776]],1262:[[1059,772]],1263:[[1091,772]],1264:[[1059,776]],1265:[[1091,776]],1266:[[1059,779]],1267:[[1091,779]],1268:[[1063,776]],1269:[[1095,776]],1272:[[1067,776]],1273:[[1099,776]]},1280:{1415:[[1381,1410],256],1425:[,220],1426:[,230],1427:[,230],1428:[,230],1429:[,230],1430:[,220],1431:[,230],1432:[,230],1433:[,230],1434:[,222],1435:[,220],1436:[,230],1437:[,230],1438:[,230],1439:[,230],1440:[,230],1441:[,230],1442:[,220],1443:[,220],1444:[,220],1445:[,220],1446:[,220],1447:[,220],1448:[,230],1449:[,230],1450:[,220],1451:[,230],1452:[,230],1453:[,222],1454:[,228],1455:[,230],1456:[,10],1457:[,11],1458:[,12],1459:[,13],1460:[,14],1461:[,15],1462:[,16],1463:[,17],1464:[,18],1465:[,19],1466:[,19],1467:[,20],1468:[,21],1469:[,22],1471:[,23],1473:[,24],1474:[,25],1476:[,230],1477:[,220],1479:[,18]},1536:{1552:[,230],1553:[,230],1554:[,230],1555:[,230],1556:[,230],1557:[,230],1558:[,230],1559:[,230],1560:[,30],1561:[,31],1562:[,32],1570:[[1575,1619]],1571:[[1575,1620]],1572:[[1608,1620]],1573:[[1575,1621]],1574:[[1610,1620]],1575:[,,{1619:1570,1620:1571,1621:1573}],1608:[,,{1620:1572}],1610:[,,{1620:1574}],1611:[,27],1612:[,28],1613:[,29],1614:[,30],1615:[,31],1616:[,32],1617:[,33],1618:[,34],1619:[,230],1620:[,230],1621:[,220],1622:[,220],1623:[,230],1624:[,230],1625:[,230],1626:[,230],1627:[,230],1628:[,220],1629:[,230],1630:[,230],1631:[,220],1648:[,35],1653:[[1575,1652],256],1654:[[1608,1652],256],1655:[[1735,1652],256],1656:[[1610,1652],256],1728:[[1749,1620]],1729:[,,{1620:1730}],1730:[[1729,1620]],1746:[,,{1620:1747}],1747:[[1746,1620]],1749:[,,{1620:1728}],1750:[,230],1751:[,230],1752:[,230],1753:[,230],1754:[,230],1755:[,230],1756:[,230],1759:[,230],1760:[,230],1761:[,230],1762:[,230],1763:[,220],1764:[,230],1767:[,230],1768:[,230],1770:[,220],1771:[,230],1772:[,230],1773:[,220]},1792:{1809:[,36],1840:[,230],1841:[,220],1842:[,230],1843:[,230],1844:[,220],1845:[,230],1846:[,230],1847:[,220],1848:[,220],1849:[,220],1850:[,230],1851:[,220],1852:[,220],1853:[,230],1854:[,220],1855:[,230],1856:[,230],1857:[,230],1858:[,220],1859:[,230],1860:[,220],1861:[,230],1862:[,220],1863:[,230],1864:[,220],1865:[,230],1866:[,230],2027:[,230],2028:[,230],2029:[,230],2030:[,230],2031:[,230],2032:[,230],2033:[,230],2034:[,220],2035:[,230]},2048:{2070:[,230],2071:[,230],2072:[,230],2073:[,230],2075:[,230],2076:[,230],2077:[,230],2078:[,230],2079:[,230],2080:[,230],2081:[,230],2082:[,230],2083:[,230],2085:[,230],2086:[,230],2087:[,230],2089:[,230],2090:[,230],2091:[,230],2092:[,230],2093:[,230],2137:[,220],2138:[,220],2139:[,220],2276:[,230],2277:[,230],2278:[,220],2279:[,230],2280:[,230],2281:[,220],2282:[,230],2283:[,230],2284:[,230],2285:[,220],2286:[,220],2287:[,220],2288:[,27],2289:[,28],2290:[,29],2291:[,230],2292:[,230],2293:[,230],2294:[,220],2295:[,230],2296:[,230],2297:[,220],2298:[,220],2299:[,230],2300:[,230],2301:[,230],2302:[,230],2303:[,230]},2304:{2344:[,,{2364:2345}],2345:[[2344,2364]],2352:[,,{2364:2353}],2353:[[2352,2364]],2355:[,,{2364:2356}],2356:[[2355,2364]],2364:[,7],2381:[,9],2385:[,230],2386:[,220],2387:[,230],2388:[,230],2392:[[2325,2364],512],2393:[[2326,2364],512],2394:[[2327,2364],512],2395:[[2332,2364],512],2396:[[2337,2364],512],2397:[[2338,2364],512],2398:[[2347,2364],512],2399:[[2351,2364],512],2492:[,7],2503:[,,{2494:2507,2519:2508}],2507:[[2503,2494]],2508:[[2503,2519]],2509:[,9],2524:[[2465,2492],512],2525:[[2466,2492],512],2527:[[2479,2492],512]},2560:{2611:[[2610,2620],512],2614:[[2616,2620],512],2620:[,7],2637:[,9],2649:[[2582,2620],512],2650:[[2583,2620],512],2651:[[2588,2620],512],2654:[[2603,2620],512],2748:[,7],2765:[,9],68109:[,220],68111:[,230],68152:[,230],68153:[,1],68154:[,220],68159:[,9],68325:[,230],68326:[,220]},2816:{2876:[,7],2887:[,,{2878:2891,2902:2888,2903:2892}],2888:[[2887,2902]],2891:[[2887,2878]],2892:[[2887,2903]],2893:[,9],2908:[[2849,2876],512],2909:[[2850,2876],512],2962:[,,{3031:2964}],2964:[[2962,3031]],3014:[,,{3006:3018,3031:3020}],3015:[,,{3006:3019}],3018:[[3014,3006]],3019:[[3015,3006]],3020:[[3014,3031]],3021:[,9]},3072:{3142:[,,{3158:3144}],3144:[[3142,3158]],3149:[,9],3157:[,84],3158:[,91],3260:[,7],3263:[,,{3285:3264}],3264:[[3263,3285]],3270:[,,{3266:3274,3285:3271,3286:3272}],3271:[[3270,3285]],3272:[[3270,3286]],3274:[[3270,3266],,{3285:3275}],3275:[[3274,3285]],3277:[,9]},3328:{3398:[,,{3390:3402,3415:3404}],3399:[,,{3390:3403}],3402:[[3398,3390]],3403:[[3399,3390]],3404:[[3398,3415]],3405:[,9],3530:[,9],3545:[,,{3530:3546,3535:3548,3551:3550}],3546:[[3545,3530]],3548:[[3545,3535],,{3530:3549}],3549:[[3548,3530]],3550:[[3545,3551]]},3584:{3635:[[3661,3634],256],3640:[,103],3641:[,103],3642:[,9],3656:[,107],3657:[,107],3658:[,107],3659:[,107],3763:[[3789,3762],256],3768:[,118],3769:[,118],3784:[,122],3785:[,122],3786:[,122],3787:[,122],3804:[[3755,3737],256],3805:[[3755,3745],256]},3840:{3852:[[3851],256],3864:[,220],3865:[,220],3893:[,220],3895:[,220],3897:[,216],3907:[[3906,4023],512],3917:[[3916,4023],512],3922:[[3921,4023],512],3927:[[3926,4023],512],3932:[[3931,4023],512],3945:[[3904,4021],512],3953:[,129],3954:[,130],3955:[[3953,3954],512],3956:[,132],3957:[[3953,3956],512],3958:[[4018,3968],512],3959:[[4018,3969],256],3960:[[4019,3968],512],3961:[[4019,3969],256],3962:[,130],3963:[,130],3964:[,130],3965:[,130],3968:[,130],3969:[[3953,3968],512],3970:[,230],3971:[,230],3972:[,9],3974:[,230],3975:[,230],3987:[[3986,4023],512],3997:[[3996,4023],512],4002:[[4001,4023],512],4007:[[4006,4023],512],4012:[[4011,4023],512],4025:[[3984,4021],512],4038:[,220]},4096:{4133:[,,{4142:4134}],4134:[[4133,4142]],4151:[,7],4153:[,9],4154:[,9],4237:[,220],4348:[[4316],256],69702:[,9],69759:[,9],69785:[,,{69818:69786}],69786:[[69785,69818]],69787:[,,{69818:69788}],69788:[[69787,69818]],69797:[,,{69818:69803}],69803:[[69797,69818]],69817:[,9],69818:[,7]},4352:{69888:[,230],69889:[,230],69890:[,230],69934:[[69937,69927]],69935:[[69938,69927]],69937:[,,{69927:69934}],69938:[,,{69927:69935}],69939:[,9],69940:[,9],70003:[,7],70080:[,9]},4608:{70197:[,9],70198:[,7],70377:[,7],70378:[,9]},4864:{4957:[,230],4958:[,230],4959:[,230],70460:[,7],70471:[,,{70462:70475,70487:70476}],70475:[[70471,70462]],70476:[[70471,70487]],70477:[,9],70502:[,230],70503:[,230],70504:[,230],70505:[,230],70506:[,230],70507:[,230],70508:[,230],70512:[,230],70513:[,230],70514:[,230],70515:[,230],70516:[,230]},5120:{70841:[,,{70832:70844,70842:70843,70845:70846}],70843:[[70841,70842]],70844:[[70841,70832]],70846:[[70841,70845]],70850:[,9],70851:[,7]},5376:{71096:[,,{71087:71098}],71097:[,,{71087:71099}],71098:[[71096,71087]],71099:[[71097,71087]],71103:[,9],71104:[,7]},5632:{71231:[,9],71350:[,9],71351:[,7]},5888:{5908:[,9],5940:[,9],6098:[,9],6109:[,230]},6144:{6313:[,228]},6400:{6457:[,222],6458:[,230],6459:[,220]},6656:{6679:[,230],6680:[,220],6752:[,9],6773:[,230],6774:[,230],6775:[,230],6776:[,230],6777:[,230],6778:[,230],6779:[,230],6780:[,230],6783:[,220],6832:[,230],6833:[,230],6834:[,230],6835:[,230],6836:[,230],6837:[,220],6838:[,220],6839:[,220],6840:[,220],6841:[,220],6842:[,220],6843:[,230],6844:[,230],6845:[,220]},6912:{6917:[,,{6965:6918}],6918:[[6917,6965]],6919:[,,{6965:6920}],6920:[[6919,6965]],6921:[,,{6965:6922}],6922:[[6921,6965]],6923:[,,{6965:6924}],6924:[[6923,6965]],6925:[,,{6965:6926}],6926:[[6925,6965]],6929:[,,{6965:6930}],6930:[[6929,6965]],6964:[,7],6970:[,,{6965:6971}],6971:[[6970,6965]],6972:[,,{6965:6973}],6973:[[6972,6965]],6974:[,,{6965:6976}],6975:[,,{6965:6977}],6976:[[6974,6965]],6977:[[6975,6965]],6978:[,,{6965:6979}],6979:[[6978,6965]],6980:[,9],7019:[,230],7020:[,220],7021:[,230],7022:[,230],7023:[,230],7024:[,230],7025:[,230],7026:[,230],7027:[,230],7082:[,9],7083:[,9],7142:[,7],7154:[,9],7155:[,9]},7168:{7223:[,7],7376:[,230],7377:[,230],7378:[,230],7380:[,1],7381:[,220],7382:[,220],7383:[,220],7384:[,220],7385:[,220],7386:[,230],7387:[,230],7388:[,220],7389:[,220],7390:[,220],7391:[,220],7392:[,230],7394:[,1],7395:[,1],7396:[,1],7397:[,1],7398:[,1],7399:[,1],7400:[,1],7405:[,220],7412:[,230],7416:[,230],7417:[,230]},7424:{7468:[[65],256],7469:[[198],256],7470:[[66],256],7472:[[68],256],7473:[[69],256],7474:[[398],256],7475:[[71],256],7476:[[72],256],7477:[[73],256],7478:[[74],256],7479:[[75],256],7480:[[76],256],7481:[[77],256],7482:[[78],256],7484:[[79],256],7485:[[546],256],7486:[[80],256],7487:[[82],256],7488:[[84],256],7489:[[85],256],7490:[[87],256],7491:[[97],256],7492:[[592],256],7493:[[593],256],7494:[[7426],256],7495:[[98],256],7496:[[100],256],7497:[[101],256],7498:[[601],256],7499:[[603],256],7500:[[604],256],7501:[[103],256],7503:[[107],256],7504:[[109],256],7505:[[331],256],7506:[[111],256],7507:[[596],256],7508:[[7446],256],7509:[[7447],256],7510:[[112],256],7511:[[116],256],7512:[[117],256],7513:[[7453],256],7514:[[623],256],7515:[[118],256],7516:[[7461],256],7517:[[946],256],7518:[[947],256],7519:[[948],256],7520:[[966],256],7521:[[967],256],7522:[[105],256],7523:[[114],256],7524:[[117],256],7525:[[118],256],7526:[[946],256],7527:[[947],256],7528:[[961],256],7529:[[966],256],7530:[[967],256],7544:[[1085],256],7579:[[594],256],7580:[[99],256],7581:[[597],256],7582:[[240],256],7583:[[604],256],7584:[[102],256],7585:[[607],256],7586:[[609],256],7587:[[613],256],7588:[[616],256],7589:[[617],256],7590:[[618],256],7591:[[7547],256],7592:[[669],256],7593:[[621],256],7594:[[7557],256],7595:[[671],256],7596:[[625],256],7597:[[624],256],7598:[[626],256],7599:[[627],256],7600:[[628],256],7601:[[629],256],7602:[[632],256],7603:[[642],256],7604:[[643],256],7605:[[427],256],7606:[[649],256],7607:[[650],256],7608:[[7452],256],7609:[[651],256],7610:[[652],256],7611:[[122],256],7612:[[656],256],7613:[[657],256],7614:[[658],256],7615:[[952],256],7616:[,230],7617:[,230],7618:[,220],7619:[,230],7620:[,230],7621:[,230],7622:[,230],7623:[,230],7624:[,230],7625:[,230],7626:[,220],7627:[,230],7628:[,230],7629:[,234],7630:[,214],7631:[,220],7632:[,202],7633:[,230],7634:[,230],7635:[,230],7636:[,230],7637:[,230],7638:[,230],7639:[,230],7640:[,230],7641:[,230],7642:[,230],7643:[,230],7644:[,230],7645:[,230],7646:[,230],7647:[,230],7648:[,230],7649:[,230],7650:[,230],7651:[,230],7652:[,230],7653:[,230],7654:[,230],7655:[,230],7656:[,230],7657:[,230],7658:[,230],7659:[,230],7660:[,230],7661:[,230],7662:[,230],7663:[,230],7664:[,230],7665:[,230],7666:[,230],7667:[,230],7668:[,230],7669:[,230],7676:[,233],7677:[,220],7678:[,230],7679:[,220]},7680:{7680:[[65,805]],7681:[[97,805]],7682:[[66,775]],7683:[[98,775]],7684:[[66,803]],7685:[[98,803]],7686:[[66,817]],7687:[[98,817]],7688:[[199,769]],7689:[[231,769]],7690:[[68,775]],7691:[[100,775]],7692:[[68,803]],7693:[[100,803]],7694:[[68,817]],7695:[[100,817]],7696:[[68,807]],7697:[[100,807]],7698:[[68,813]],7699:[[100,813]],7700:[[274,768]],7701:[[275,768]],7702:[[274,769]],7703:[[275,769]],7704:[[69,813]],7705:[[101,813]],7706:[[69,816]],7707:[[101,816]],7708:[[552,774]],7709:[[553,774]],7710:[[70,775]],7711:[[102,775]],7712:[[71,772]],7713:[[103,772]],7714:[[72,775]],7715:[[104,775]],7716:[[72,803]],7717:[[104,803]],7718:[[72,776]],7719:[[104,776]],7720:[[72,807]],7721:[[104,807]],7722:[[72,814]],7723:[[104,814]],7724:[[73,816]],7725:[[105,816]],7726:[[207,769]],7727:[[239,769]],7728:[[75,769]],7729:[[107,769]],7730:[[75,803]],7731:[[107,803]],7732:[[75,817]],7733:[[107,817]],7734:[[76,803],,{772:7736}],7735:[[108,803],,{772:7737}],7736:[[7734,772]],7737:[[7735,772]],7738:[[76,817]],7739:[[108,817]],7740:[[76,813]],7741:[[108,813]],7742:[[77,769]],7743:[[109,769]],7744:[[77,775]],7745:[[109,775]],7746:[[77,803]],7747:[[109,803]],7748:[[78,775]],7749:[[110,775]],7750:[[78,803]],7751:[[110,803]],7752:[[78,817]],7753:[[110,817]],7754:[[78,813]],7755:[[110,813]],7756:[[213,769]],7757:[[245,769]],7758:[[213,776]],7759:[[245,776]],7760:[[332,768]],7761:[[333,768]],7762:[[332,769]],7763:[[333,769]],7764:[[80,769]],7765:[[112,769]],7766:[[80,775]],7767:[[112,775]],7768:[[82,775]],7769:[[114,775]],7770:[[82,803],,{772:7772}],7771:[[114,803],,{772:7773}],7772:[[7770,772]],7773:[[7771,772]],7774:[[82,817]],7775:[[114,817]],7776:[[83,775]],7777:[[115,775]],7778:[[83,803],,{775:7784}],7779:[[115,803],,{775:7785}],7780:[[346,775]],7781:[[347,775]],7782:[[352,775]],7783:[[353,775]],7784:[[7778,775]],7785:[[7779,775]],7786:[[84,775]],7787:[[116,775]],7788:[[84,803]],7789:[[116,803]],7790:[[84,817]],7791:[[116,817]],7792:[[84,813]],7793:[[116,813]],7794:[[85,804]],7795:[[117,804]],7796:[[85,816]],7797:[[117,816]],7798:[[85,813]],7799:[[117,813]],7800:[[360,769]],7801:[[361,769]],7802:[[362,776]],7803:[[363,776]],7804:[[86,771]],7805:[[118,771]],7806:[[86,803]],7807:[[118,803]],7808:[[87,768]],7809:[[119,768]],7810:[[87,769]],7811:[[119,769]],7812:[[87,776]],7813:[[119,776]],7814:[[87,775]],7815:[[119,775]],7816:[[87,803]],7817:[[119,803]],7818:[[88,775]],7819:[[120,775]],7820:[[88,776]],7821:[[120,776]],7822:[[89,775]],7823:[[121,775]],7824:[[90,770]],7825:[[122,770]],7826:[[90,803]],7827:[[122,803]],7828:[[90,817]],7829:[[122,817]],7830:[[104,817]],7831:[[116,776]],7832:[[119,778]],7833:[[121,778]],7834:[[97,702],256],7835:[[383,775]],7840:[[65,803],,{770:7852,774:7862}],7841:[[97,803],,{770:7853,774:7863}],7842:[[65,777]],7843:[[97,777]],7844:[[194,769]],7845:[[226,769]],7846:[[194,768]],7847:[[226,768]],7848:[[194,777]],7849:[[226,777]],7850:[[194,771]],7851:[[226,771]],7852:[[7840,770]],7853:[[7841,770]],7854:[[258,769]],7855:[[259,769]],7856:[[258,768]],7857:[[259,768]],7858:[[258,777]],7859:[[259,777]],7860:[[258,771]],7861:[[259,771]],7862:[[7840,774]],7863:[[7841,774]],7864:[[69,803],,{770:7878}],7865:[[101,803],,{770:7879}],7866:[[69,777]],7867:[[101,777]],7868:[[69,771]],7869:[[101,771]],7870:[[202,769]],7871:[[234,769]],7872:[[202,768]],7873:[[234,768]],7874:[[202,777]],7875:[[234,777]],7876:[[202,771]],7877:[[234,771]],7878:[[7864,770]],7879:[[7865,770]],7880:[[73,777]],7881:[[105,777]],7882:[[73,803]],7883:[[105,803]],7884:[[79,803],,{770:7896}],7885:[[111,803],,{770:7897}],7886:[[79,777]],7887:[[111,777]],7888:[[212,769]],7889:[[244,769]],7890:[[212,768]],7891:[[244,768]],7892:[[212,777]],7893:[[244,777]],7894:[[212,771]],7895:[[244,771]],7896:[[7884,770]],7897:[[7885,770]],7898:[[416,769]],7899:[[417,769]],7900:[[416,768]],7901:[[417,768]],7902:[[416,777]],7903:[[417,777]],7904:[[416,771]],7905:[[417,771]],7906:[[416,803]],7907:[[417,803]],7908:[[85,803]],7909:[[117,803]],7910:[[85,777]],7911:[[117,777]],7912:[[431,769]],7913:[[432,769]],7914:[[431,768]],7915:[[432,768]],7916:[[431,777]],7917:[[432,777]],7918:[[431,771]],7919:[[432,771]],7920:[[431,803]],7921:[[432,803]],7922:[[89,768]],7923:[[121,768]],7924:[[89,803]],7925:[[121,803]],7926:[[89,777]],7927:[[121,777]],7928:[[89,771]],7929:[[121,771]]},7936:{7936:[[945,787],,{768:7938,769:7940,834:7942,837:8064}],7937:[[945,788],,{768:7939,769:7941,834:7943,837:8065}],7938:[[7936,768],,{837:8066}],7939:[[7937,768],,{837:8067}],7940:[[7936,769],,{837:8068}],7941:[[7937,769],,{837:8069}],7942:[[7936,834],,{837:8070}],7943:[[7937,834],,{837:8071}],7944:[[913,787],,{768:7946,769:7948,834:7950,837:8072}],7945:[[913,788],,{768:7947,769:7949,834:7951,837:8073}],7946:[[7944,768],,{837:8074}],7947:[[7945,768],,{837:8075}],7948:[[7944,769],,{837:8076}],7949:[[7945,769],,{837:8077}],7950:[[7944,834],,{837:8078}],7951:[[7945,834],,{837:8079}],7952:[[949,787],,{768:7954,769:7956}],7953:[[949,788],,{768:7955,769:7957}],7954:[[7952,768]],7955:[[7953,768]],7956:[[7952,769]],7957:[[7953,769]],7960:[[917,787],,{768:7962,769:7964}],7961:[[917,788],,{768:7963,769:7965}],7962:[[7960,768]],7963:[[7961,768]],7964:[[7960,769]],7965:[[7961,769]],7968:[[951,787],,{768:7970,769:7972,834:7974,837:8080}],7969:[[951,788],,{768:7971,769:7973,834:7975,837:8081}],7970:[[7968,768],,{837:8082}],7971:[[7969,768],,{837:8083}],7972:[[7968,769],,{837:8084}],7973:[[7969,769],,{837:8085}],7974:[[7968,834],,{837:8086}],7975:[[7969,834],,{837:8087}],7976:[[919,787],,{768:7978,769:7980,834:7982,837:8088}],7977:[[919,788],,{768:7979,769:7981,834:7983,837:8089}],7978:[[7976,768],,{837:8090}],7979:[[7977,768],,{837:8091}],7980:[[7976,769],,{837:8092}],7981:[[7977,769],,{837:8093}],7982:[[7976,834],,{837:8094}],7983:[[7977,834],,{837:8095}],7984:[[953,787],,{768:7986,769:7988,834:7990}],7985:[[953,788],,{768:7987,769:7989,834:7991}],7986:[[7984,768]],7987:[[7985,768]],7988:[[7984,769]],7989:[[7985,769]],7990:[[7984,834]],7991:[[7985,834]],7992:[[921,787],,{768:7994,769:7996,834:7998}],7993:[[921,788],,{768:7995,769:7997,834:7999}],7994:[[7992,768]],7995:[[7993,768]],7996:[[7992,769]],7997:[[7993,769]],7998:[[7992,834]],7999:[[7993,834]],8e3:[[959,787],,{768:8002,769:8004}],8001:[[959,788],,{768:8003,769:8005}],8002:[[8e3,768]],8003:[[8001,768]],8004:[[8e3,769]],8005:[[8001,769]],8008:[[927,787],,{768:8010,769:8012}],8009:[[927,788],,{768:8011,769:8013}],8010:[[8008,768]],8011:[[8009,768]],8012:[[8008,769]],8013:[[8009,769]],8016:[[965,787],,{768:8018,769:8020,834:8022}],8017:[[965,788],,{768:8019,769:8021,834:8023}],8018:[[8016,768]],8019:[[8017,768]],8020:[[8016,769]],8021:[[8017,769]],8022:[[8016,834]],8023:[[8017,834]],8025:[[933,788],,{768:8027,769:8029,834:8031}],8027:[[8025,768]],8029:[[8025,769]],8031:[[8025,834]],8032:[[969,787],,{768:8034,769:8036,834:8038,837:8096}],8033:[[969,788],,{768:8035,769:8037,834:8039,837:8097}],8034:[[8032,768],,{837:8098}],8035:[[8033,768],,{837:8099}],8036:[[8032,769],,{837:8100}],8037:[[8033,769],,{837:8101}],8038:[[8032,834],,{837:8102}],8039:[[8033,834],,{837:8103}],8040:[[937,787],,{768:8042,769:8044,834:8046,837:8104}],8041:[[937,788],,{768:8043,769:8045,834:8047,837:8105}],8042:[[8040,768],,{837:8106}],8043:[[8041,768],,{837:8107}],8044:[[8040,769],,{837:8108}],8045:[[8041,769],,{837:8109}],8046:[[8040,834],,{837:8110}],8047:[[8041,834],,{837:8111}],8048:[[945,768],,{837:8114}],8049:[[940]],8050:[[949,768]],8051:[[941]],8052:[[951,768],,{837:8130}],8053:[[942]],8054:[[953,768]],8055:[[943]],8056:[[959,768]],8057:[[972]],8058:[[965,768]],8059:[[973]],8060:[[969,768],,{837:8178}],8061:[[974]],8064:[[7936,837]],8065:[[7937,837]],8066:[[7938,837]],8067:[[7939,837]],8068:[[7940,837]],8069:[[7941,837]],8070:[[7942,837]],8071:[[7943,837]],8072:[[7944,837]],8073:[[7945,837]],8074:[[7946,837]],8075:[[7947,837]],8076:[[7948,837]],8077:[[7949,837]],8078:[[7950,837]],8079:[[7951,837]],8080:[[7968,837]],8081:[[7969,837]],8082:[[7970,837]],8083:[[7971,837]],8084:[[7972,837]],8085:[[7973,837]],8086:[[7974,837]],8087:[[7975,837]],8088:[[7976,837]],8089:[[7977,837]],8090:[[7978,837]],8091:[[7979,837]],8092:[[7980,837]],8093:[[7981,837]],8094:[[7982,837]],8095:[[7983,837]],8096:[[8032,837]],8097:[[8033,837]],8098:[[8034,837]],8099:[[8035,837]],8100:[[8036,837]],8101:[[8037,837]],8102:[[8038,837]],8103:[[8039,837]],8104:[[8040,837]],8105:[[8041,837]],8106:[[8042,837]],8107:[[8043,837]],8108:[[8044,837]],8109:[[8045,837]],8110:[[8046,837]],8111:[[8047,837]],8112:[[945,774]],8113:[[945,772]],8114:[[8048,837]],8115:[[945,837]],8116:[[940,837]],8118:[[945,834],,{837:8119}],8119:[[8118,837]],8120:[[913,774]],8121:[[913,772]],8122:[[913,768]],8123:[[902]],8124:[[913,837]],8125:[[32,787],256],8126:[[953]],8127:[[32,787],256,{768:8141,769:8142,834:8143}],8128:[[32,834],256],8129:[[168,834]],8130:[[8052,837]],8131:[[951,837]],8132:[[942,837]],8134:[[951,834],,{837:8135}],8135:[[8134,837]],8136:[[917,768]],8137:[[904]],8138:[[919,768]],8139:[[905]],8140:[[919,837]],8141:[[8127,768]],8142:[[8127,769]],8143:[[8127,834]],8144:[[953,774]],8145:[[953,772]],8146:[[970,768]],8147:[[912]],8150:[[953,834]],8151:[[970,834]],8152:[[921,774]],8153:[[921,772]],8154:[[921,768]],8155:[[906]],8157:[[8190,768]],8158:[[8190,769]],8159:[[8190,834]],8160:[[965,774]],8161:[[965,772]],8162:[[971,768]],8163:[[944]],8164:[[961,787]],8165:[[961,788]],8166:[[965,834]],8167:[[971,834]],8168:[[933,774]],8169:[[933,772]],8170:[[933,768]],8171:[[910]],8172:[[929,788]],8173:[[168,768]],8174:[[901]],8175:[[96]],8178:[[8060,837]],8179:[[969,837]],8180:[[974,837]],8182:[[969,834],,{837:8183}],8183:[[8182,837]],8184:[[927,768]],8185:[[908]],8186:[[937,768]],8187:[[911]],8188:[[937,837]],8189:[[180]],8190:[[32,788],256,{768:8157,769:8158,834:8159}]},8192:{8192:[[8194]],8193:[[8195]],8194:[[32],256],8195:[[32],256],8196:[[32],256],8197:[[32],256],8198:[[32],256],8199:[[32],256],8200:[[32],256],8201:[[32],256],8202:[[32],256],8209:[[8208],256],8215:[[32,819],256],8228:[[46],256],8229:[[46,46],256],8230:[[46,46,46],256],8239:[[32],256],8243:[[8242,8242],256],8244:[[8242,8242,8242],256],8246:[[8245,8245],256],8247:[[8245,8245,8245],256],8252:[[33,33],256],8254:[[32,773],256],8263:[[63,63],256],8264:[[63,33],256],8265:[[33,63],256],8279:[[8242,8242,8242,8242],256],8287:[[32],256],8304:[[48],256],8305:[[105],256],8308:[[52],256],8309:[[53],256],8310:[[54],256],8311:[[55],256],8312:[[56],256],8313:[[57],256],8314:[[43],256],8315:[[8722],256],8316:[[61],256],8317:[[40],256],8318:[[41],256],8319:[[110],256],8320:[[48],256],8321:[[49],256],8322:[[50],256],8323:[[51],256],8324:[[52],256],8325:[[53],256],8326:[[54],256],8327:[[55],256],8328:[[56],256],8329:[[57],256],8330:[[43],256],8331:[[8722],256],8332:[[61],256],8333:[[40],256],8334:[[41],256],8336:[[97],256],8337:[[101],256],8338:[[111],256],8339:[[120],256],8340:[[601],256],8341:[[104],256],8342:[[107],256],8343:[[108],256],8344:[[109],256],8345:[[110],256],8346:[[112],256],8347:[[115],256],8348:[[116],256],8360:[[82,115],256],8400:[,230],8401:[,230],8402:[,1],8403:[,1],8404:[,230],8405:[,230],8406:[,230],8407:[,230],8408:[,1],8409:[,1],8410:[,1],8411:[,230],8412:[,230],8417:[,230],8421:[,1],8422:[,1],8423:[,230],8424:[,220],8425:[,230],8426:[,1],8427:[,1],8428:[,220],8429:[,220],8430:[,220],8431:[,220],8432:[,230]},8448:{8448:[[97,47,99],256],8449:[[97,47,115],256],8450:[[67],256],8451:[[176,67],256],8453:[[99,47,111],256],8454:[[99,47,117],256],8455:[[400],256],8457:[[176,70],256],8458:[[103],256],8459:[[72],256],8460:[[72],256],8461:[[72],256],8462:[[104],256],8463:[[295],256],8464:[[73],256],8465:[[73],256],8466:[[76],256],8467:[[108],256],8469:[[78],256],8470:[[78,111],256],8473:[[80],256],8474:[[81],256],8475:[[82],256],8476:[[82],256],8477:[[82],256],8480:[[83,77],256],8481:[[84,69,76],256],8482:[[84,77],256],8484:[[90],256],8486:[[937]],8488:[[90],256],8490:[[75]],8491:[[197]],8492:[[66],256],8493:[[67],256],8495:[[101],256],8496:[[69],256],8497:[[70],256],8499:[[77],256],8500:[[111],256],8501:[[1488],256],8502:[[1489],256],8503:[[1490],256],8504:[[1491],256],8505:[[105],256],8507:[[70,65,88],256],8508:[[960],256],8509:[[947],256],8510:[[915],256],8511:[[928],256],8512:[[8721],256],8517:[[68],256],8518:[[100],256],8519:[[101],256],8520:[[105],256],8521:[[106],256],8528:[[49,8260,55],256],8529:[[49,8260,57],256],8530:[[49,8260,49,48],256],8531:[[49,8260,51],256],8532:[[50,8260,51],256],8533:[[49,8260,53],256],8534:[[50,8260,53],256],8535:[[51,8260,53],256],8536:[[52,8260,53],256],8537:[[49,8260,54],256],8538:[[53,8260,54],256],8539:[[49,8260,56],256],8540:[[51,8260,56],256],8541:[[53,8260,56],256],8542:[[55,8260,56],256],8543:[[49,8260],256],8544:[[73],256],8545:[[73,73],256],8546:[[73,73,73],256],8547:[[73,86],256],8548:[[86],256],8549:[[86,73],256],8550:[[86,73,73],256],8551:[[86,73,73,73],256],8552:[[73,88],256],8553:[[88],256],8554:[[88,73],256],8555:[[88,73,73],256],8556:[[76],256],8557:[[67],256],8558:[[68],256],8559:[[77],256],8560:[[105],256],8561:[[105,105],256],8562:[[105,105,105],256],8563:[[105,118],256],8564:[[118],256],8565:[[118,105],256],8566:[[118,105,105],256],8567:[[118,105,105,105],256],8568:[[105,120],256],8569:[[120],256],8570:[[120,105],256],8571:[[120,105,105],256],8572:[[108],256],8573:[[99],256],8574:[[100],256],8575:[[109],256],8585:[[48,8260,51],256],8592:[,,{824:8602}],8594:[,,{824:8603}],8596:[,,{824:8622}],8602:[[8592,824]],8603:[[8594,824]],8622:[[8596,824]],8653:[[8656,824]],8654:[[8660,824]],8655:[[8658,824]],8656:[,,{824:8653}],8658:[,,{824:8655}],8660:[,,{824:8654}]},8704:{8707:[,,{824:8708}],8708:[[8707,824]],8712:[,,{824:8713}],8713:[[8712,824]],8715:[,,{824:8716}],8716:[[8715,824]],8739:[,,{824:8740}],8740:[[8739,824]],8741:[,,{824:8742}],8742:[[8741,824]],8748:[[8747,8747],256],8749:[[8747,8747,8747],256],8751:[[8750,8750],256],8752:[[8750,8750,8750],256],8764:[,,{824:8769}],8769:[[8764,824]],8771:[,,{824:8772}],8772:[[8771,824]],8773:[,,{824:8775}],8775:[[8773,824]],8776:[,,{824:8777}],8777:[[8776,824]],8781:[,,{824:8813}],8800:[[61,824]],8801:[,,{824:8802}],8802:[[8801,824]],8804:[,,{824:8816}],8805:[,,{824:8817}],8813:[[8781,824]],8814:[[60,824]],8815:[[62,824]],8816:[[8804,824]],8817:[[8805,824]],8818:[,,{824:8820}],8819:[,,{824:8821}],8820:[[8818,824]],8821:[[8819,824]],8822:[,,{824:8824}],8823:[,,{824:8825}],8824:[[8822,824]],8825:[[8823,824]],8826:[,,{824:8832}],8827:[,,{824:8833}],8828:[,,{824:8928}],8829:[,,{824:8929}],8832:[[8826,824]],8833:[[8827,824]],8834:[,,{824:8836}],8835:[,,{824:8837}],8836:[[8834,824]],8837:[[8835,824]],8838:[,,{824:8840}],8839:[,,{824:8841}],8840:[[8838,824]],8841:[[8839,824]],8849:[,,{824:8930}],8850:[,,{824:8931}],8866:[,,{824:8876}],8872:[,,{824:8877}],8873:[,,{824:8878}],8875:[,,{824:8879}],8876:[[8866,824]],8877:[[8872,824]],8878:[[8873,824]],8879:[[8875,824]],8882:[,,{824:8938}],8883:[,,{824:8939}],8884:[,,{824:8940}],8885:[,,{824:8941}],8928:[[8828,824]],8929:[[8829,824]],8930:[[8849,824]],8931:[[8850,824]],8938:[[8882,824]],8939:[[8883,824]],8940:[[8884,824]],8941:[[8885,824]]},8960:{9001:[[12296]],9002:[[12297]]},9216:{9312:[[49],256],9313:[[50],256],9314:[[51],256],9315:[[52],256],9316:[[53],256],9317:[[54],256],9318:[[55],256],9319:[[56],256],9320:[[57],256],9321:[[49,48],256],9322:[[49,49],256],9323:[[49,50],256],9324:[[49,51],256],9325:[[49,52],256],9326:[[49,53],256],9327:[[49,54],256],9328:[[49,55],256],9329:[[49,56],256],9330:[[49,57],256],9331:[[50,48],256],9332:[[40,49,41],256],9333:[[40,50,41],256],9334:[[40,51,41],256],9335:[[40,52,41],256],9336:[[40,53,41],256],9337:[[40,54,41],256],9338:[[40,55,41],256],9339:[[40,56,41],256],9340:[[40,57,41],256],9341:[[40,49,48,41],256],9342:[[40,49,49,41],256],9343:[[40,49,50,41],256],9344:[[40,49,51,41],256],9345:[[40,49,52,41],256],9346:[[40,49,53,41],256],9347:[[40,49,54,41],256],9348:[[40,49,55,41],256],9349:[[40,49,56,41],256],9350:[[40,49,57,41],256],9351:[[40,50,48,41],256],9352:[[49,46],256],9353:[[50,46],256],9354:[[51,46],256],9355:[[52,46],256],9356:[[53,46],256],9357:[[54,46],256],9358:[[55,46],256],9359:[[56,46],256],9360:[[57,46],256],9361:[[49,48,46],256],9362:[[49,49,46],256],9363:[[49,50,46],256],9364:[[49,51,46],256],9365:[[49,52,46],256],9366:[[49,53,46],256],9367:[[49,54,46],256],9368:[[49,55,46],256],9369:[[49,56,46],256],9370:[[49,57,46],256],9371:[[50,48,46],256],9372:[[40,97,41],256],9373:[[40,98,41],256],9374:[[40,99,41],256],9375:[[40,100,41],256],9376:[[40,101,41],256],9377:[[40,102,41],256],9378:[[40,103,41],256],9379:[[40,104,41],256],9380:[[40,105,41],256],9381:[[40,106,41],256],9382:[[40,107,41],256],9383:[[40,108,41],256],9384:[[40,109,41],256],9385:[[40,110,41],256],9386:[[40,111,41],256],9387:[[40,112,41],256],9388:[[40,113,41],256],9389:[[40,114,41],256],9390:[[40,115,41],256],9391:[[40,116,41],256],9392:[[40,117,41],256],9393:[[40,118,41],256],9394:[[40,119,41],256],9395:[[40,120,41],256],9396:[[40,121,41],256],9397:[[40,122,41],256],9398:[[65],256],9399:[[66],256],9400:[[67],256],9401:[[68],256],9402:[[69],256],9403:[[70],256],9404:[[71],256],9405:[[72],256],9406:[[73],256],9407:[[74],256],9408:[[75],256],9409:[[76],256],9410:[[77],256],9411:[[78],256],9412:[[79],256],9413:[[80],256],9414:[[81],256],9415:[[82],256],9416:[[83],256],9417:[[84],256],9418:[[85],256],9419:[[86],256],9420:[[87],256],9421:[[88],256],9422:[[89],256],9423:[[90],256],9424:[[97],256],9425:[[98],256],9426:[[99],256],9427:[[100],256],9428:[[101],256],9429:[[102],256],9430:[[103],256],9431:[[104],256],9432:[[105],256],9433:[[106],256],9434:[[107],256],9435:[[108],256],9436:[[109],256],9437:[[110],256],9438:[[111],256],9439:[[112],256],9440:[[113],256],9441:[[114],256],9442:[[115],256],9443:[[116],256],9444:[[117],256],9445:[[118],256],9446:[[119],256],9447:[[120],256],9448:[[121],256],9449:[[122],256],9450:[[48],256]},10752:{10764:[[8747,8747,8747,8747],256],10868:[[58,58,61],256],10869:[[61,61],256],10870:[[61,61,61],256],10972:[[10973,824],512]},11264:{11388:[[106],256],11389:[[86],256],11503:[,230],11504:[,230],11505:[,230]},11520:{11631:[[11617],256],11647:[,9],11744:[,230],11745:[,230],11746:[,230],11747:[,230],11748:[,230],11749:[,230],11750:[,230],11751:[,230],11752:[,230],11753:[,230],11754:[,230],11755:[,230],11756:[,230],11757:[,230],11758:[,230],11759:[,230],11760:[,230],11761:[,230],11762:[,230],11763:[,230],11764:[,230],11765:[,230],11766:[,230],11767:[,230],11768:[,230],11769:[,230],11770:[,230],11771:[,230],11772:[,230],11773:[,230],11774:[,230],11775:[,230]},11776:{11935:[[27597],256],12019:[[40863],256]},12032:{12032:[[19968],256],12033:[[20008],256],12034:[[20022],256],12035:[[20031],256],12036:[[20057],256],12037:[[20101],256],12038:[[20108],256],12039:[[20128],256],12040:[[20154],256],12041:[[20799],256],12042:[[20837],256],12043:[[20843],256],12044:[[20866],256],12045:[[20886],256],12046:[[20907],256],12047:[[20960],256],12048:[[20981],256],12049:[[20992],256],12050:[[21147],256],12051:[[21241],256],12052:[[21269],256],12053:[[21274],256],12054:[[21304],256],12055:[[21313],256],12056:[[21340],256],12057:[[21353],256],12058:[[21378],256],12059:[[21430],256],12060:[[21448],256],12061:[[21475],256],12062:[[22231],256],12063:[[22303],256],12064:[[22763],256],12065:[[22786],256],12066:[[22794],256],12067:[[22805],256],12068:[[22823],256],12069:[[22899],256],12070:[[23376],256],12071:[[23424],256],12072:[[23544],256],12073:[[23567],256],12074:[[23586],256],12075:[[23608],256],12076:[[23662],256],12077:[[23665],256],12078:[[24027],256],12079:[[24037],256],12080:[[24049],256],12081:[[24062],256],12082:[[24178],256],12083:[[24186],256],12084:[[24191],256],12085:[[24308],256],12086:[[24318],256],12087:[[24331],256],12088:[[24339],256],12089:[[24400],256],12090:[[24417],256],12091:[[24435],256],12092:[[24515],256],12093:[[25096],256],12094:[[25142],256],12095:[[25163],256],12096:[[25903],256],12097:[[25908],256],12098:[[25991],256],12099:[[26007],256],12100:[[26020],256],12101:[[26041],256],12102:[[26080],256],12103:[[26085],256],12104:[[26352],256],12105:[[26376],256],12106:[[26408],256],12107:[[27424],256],12108:[[27490],256],12109:[[27513],256],12110:[[27571],256],12111:[[27595],256],12112:[[27604],256],12113:[[27611],256],12114:[[27663],256],12115:[[27668],256],12116:[[27700],256],12117:[[28779],256],12118:[[29226],256],12119:[[29238],256],12120:[[29243],256],12121:[[29247],256],12122:[[29255],256],12123:[[29273],256],12124:[[29275],256],12125:[[29356],256],12126:[[29572],256],12127:[[29577],256],12128:[[29916],256],12129:[[29926],256],12130:[[29976],256],12131:[[29983],256],12132:[[29992],256],12133:[[3e4],256],12134:[[30091],256],12135:[[30098],256],12136:[[30326],256],12137:[[30333],256],12138:[[30382],256],12139:[[30399],256],12140:[[30446],256],12141:[[30683],256],12142:[[30690],256],12143:[[30707],256],12144:[[31034],256],12145:[[31160],256],12146:[[31166],256],12147:[[31348],256],12148:[[31435],256],12149:[[31481],256],12150:[[31859],256],12151:[[31992],256],12152:[[32566],256],12153:[[32593],256],12154:[[32650],256],12155:[[32701],256],12156:[[32769],256],12157:[[32780],256],12158:[[32786],256],12159:[[32819],256],12160:[[32895],256],12161:[[32905],256],12162:[[33251],256],12163:[[33258],256],12164:[[33267],256],12165:[[33276],256],12166:[[33292],256],12167:[[33307],256],12168:[[33311],256],12169:[[33390],256],12170:[[33394],256],12171:[[33400],256],12172:[[34381],256],12173:[[34411],256],12174:[[34880],256],12175:[[34892],256],12176:[[34915],256],12177:[[35198],256],12178:[[35211],256],12179:[[35282],256],12180:[[35328],256],12181:[[35895],256],12182:[[35910],256],12183:[[35925],256],12184:[[35960],256],12185:[[35997],256],12186:[[36196],256],12187:[[36208],256],12188:[[36275],256],12189:[[36523],256],12190:[[36554],256],12191:[[36763],256],12192:[[36784],256],12193:[[36789],256],12194:[[37009],256],12195:[[37193],256],12196:[[37318],256],12197:[[37324],256],12198:[[37329],256],12199:[[38263],256],12200:[[38272],256],12201:[[38428],256],12202:[[38582],256],12203:[[38585],256],12204:[[38632],256],12205:[[38737],256],12206:[[38750],256],12207:[[38754],256],12208:[[38761],256],12209:[[38859],256],12210:[[38893],256],12211:[[38899],256],12212:[[38913],256],12213:[[39080],256],12214:[[39131],256],12215:[[39135],256],12216:[[39318],256],12217:[[39321],256],12218:[[39340],256],12219:[[39592],256],12220:[[39640],256],12221:[[39647],256],12222:[[39717],256],12223:[[39727],256],12224:[[39730],256],12225:[[39740],256],12226:[[39770],256],12227:[[40165],256],12228:[[40565],256],12229:[[40575],256],12230:[[40613],256],12231:[[40635],256],12232:[[40643],256],12233:[[40653],256],12234:[[40657],256],12235:[[40697],256],12236:[[40701],256],12237:[[40718],256],12238:[[40723],256],12239:[[40736],256],12240:[[40763],256],12241:[[40778],256],12242:[[40786],256],12243:[[40845],256],12244:[[40860],256],12245:[[40864],256]},12288:{12288:[[32],256],12330:[,218],12331:[,228],12332:[,232],12333:[,222],12334:[,224],12335:[,224],12342:[[12306],256],12344:[[21313],256],12345:[[21316],256],12346:[[21317],256],12358:[,,{12441:12436}],12363:[,,{12441:12364}],12364:[[12363,12441]],12365:[,,{12441:12366}],12366:[[12365,12441]],12367:[,,{12441:12368}],12368:[[12367,12441]],12369:[,,{12441:12370}],12370:[[12369,12441]],12371:[,,{12441:12372}],12372:[[12371,12441]],12373:[,,{12441:12374}],12374:[[12373,12441]],12375:[,,{12441:12376}],12376:[[12375,12441]],12377:[,,{12441:12378}],12378:[[12377,12441]],12379:[,,{12441:12380}],12380:[[12379,12441]],12381:[,,{12441:12382}],12382:[[12381,12441]],12383:[,,{12441:12384}],12384:[[12383,12441]],12385:[,,{12441:12386}],12386:[[12385,12441]],12388:[,,{12441:12389}],12389:[[12388,12441]],12390:[,,{12441:12391}],12391:[[12390,12441]],12392:[,,{12441:12393}],12393:[[12392,12441]],12399:[,,{12441:12400,12442:12401}],12400:[[12399,12441]],12401:[[12399,12442]],12402:[,,{12441:12403,12442:12404}],12403:[[12402,12441]],12404:[[12402,12442]],12405:[,,{12441:12406,12442:12407}],12406:[[12405,12441]],12407:[[12405,12442]],12408:[,,{12441:12409,12442:12410}],12409:[[12408,12441]],12410:[[12408,12442]],12411:[,,{12441:12412,12442:12413}],12412:[[12411,12441]],12413:[[12411,12442]],12436:[[12358,12441]],12441:[,8],12442:[,8],12443:[[32,12441],256],12444:[[32,12442],256],12445:[,,{12441:12446}],12446:[[12445,12441]],12447:[[12424,12426],256],12454:[,,{12441:12532}],12459:[,,{12441:12460}],12460:[[12459,12441]],12461:[,,{12441:12462}],12462:[[12461,12441]],12463:[,,{12441:12464}],12464:[[12463,12441]],12465:[,,{12441:12466}],12466:[[12465,12441]],12467:[,,{12441:12468}],12468:[[12467,12441]],12469:[,,{12441:12470}],12470:[[12469,12441]],12471:[,,{12441:12472}],12472:[[12471,12441]],12473:[,,{12441:12474}],12474:[[12473,12441]],12475:[,,{12441:12476}],12476:[[12475,12441]],12477:[,,{12441:12478}],12478:[[12477,12441]],12479:[,,{12441:12480}],12480:[[12479,12441]],12481:[,,{12441:12482}],12482:[[12481,12441]],12484:[,,{12441:12485}],12485:[[12484,12441]],12486:[,,{12441:12487}],12487:[[12486,12441]],12488:[,,{12441:12489}],12489:[[12488,12441]],12495:[,,{12441:12496,12442:12497}],12496:[[12495,12441]],12497:[[12495,12442]],12498:[,,{12441:12499,12442:12500}],12499:[[12498,12441]],12500:[[12498,12442]],12501:[,,{12441:12502,12442:12503}],12502:[[12501,12441]],12503:[[12501,12442]],12504:[,,{12441:12505,12442:12506}],12505:[[12504,12441]],12506:[[12504,12442]],12507:[,,{12441:12508,12442:12509}],12508:[[12507,12441]],12509:[[12507,12442]],12527:[,,{12441:12535}],12528:[,,{12441:12536}],12529:[,,{12441:12537}],12530:[,,{12441:12538}],12532:[[12454,12441]],12535:[[12527,12441]],12536:[[12528,12441]],12537:[[12529,12441]],12538:[[12530,12441]],12541:[,,{12441:12542}],12542:[[12541,12441]],12543:[[12467,12488],256]},12544:{12593:[[4352],256],12594:[[4353],256],12595:[[4522],256],12596:[[4354],256],12597:[[4524],256],12598:[[4525],256],12599:[[4355],256],12600:[[4356],256],12601:[[4357],256],12602:[[4528],256],12603:[[4529],256],12604:[[4530],256],12605:[[4531],256],12606:[[4532],256],12607:[[4533],256],12608:[[4378],256],12609:[[4358],256],12610:[[4359],256],12611:[[4360],256],12612:[[4385],256],12613:[[4361],256],12614:[[4362],256],12615:[[4363],256],12616:[[4364],256],12617:[[4365],256],12618:[[4366],256],12619:[[4367],256],12620:[[4368],256],12621:[[4369],256],12622:[[4370],256],12623:[[4449],256],12624:[[4450],256],12625:[[4451],256],12626:[[4452],256],12627:[[4453],256],12628:[[4454],256],12629:[[4455],256],12630:[[4456],256],12631:[[4457],256],12632:[[4458],256],12633:[[4459],256],12634:[[4460],256],12635:[[4461],256],12636:[[4462],256],12637:[[4463],256],12638:[[4464],256],12639:[[4465],256],12640:[[4466],256],12641:[[4467],256],12642:[[4468],256],12643:[[4469],256],12644:[[4448],256],12645:[[4372],256],12646:[[4373],256],12647:[[4551],256],12648:[[4552],256],12649:[[4556],256],12650:[[4558],256],12651:[[4563],256],12652:[[4567],256],12653:[[4569],256],12654:[[4380],256],12655:[[4573],256],12656:[[4575],256],12657:[[4381],256],12658:[[4382],256],12659:[[4384],256],12660:[[4386],256],12661:[[4387],256],12662:[[4391],256],12663:[[4393],256],12664:[[4395],256],12665:[[4396],256],12666:[[4397],256],12667:[[4398],256],12668:[[4399],256],12669:[[4402],256],12670:[[4406],256],12671:[[4416],256],12672:[[4423],256],12673:[[4428],256],12674:[[4593],256],12675:[[4594],256],12676:[[4439],256],12677:[[4440],256],12678:[[4441],256],12679:[[4484],256],12680:[[4485],256],12681:[[4488],256],12682:[[4497],256],12683:[[4498],256],12684:[[4500],256],12685:[[4510],256],12686:[[4513],256],12690:[[19968],256],12691:[[20108],256],12692:[[19977],256],12693:[[22235],256],12694:[[19978],256],12695:[[20013],256],12696:[[19979],256],12697:[[30002],256],12698:[[20057],256],12699:[[19993],256],12700:[[19969],256],12701:[[22825],256],12702:[[22320],256],12703:[[20154],256]},12800:{12800:[[40,4352,41],256],12801:[[40,4354,41],256],12802:[[40,4355,41],256],12803:[[40,4357,41],256],12804:[[40,4358,41],256],12805:[[40,4359,41],256],12806:[[40,4361,41],256],12807:[[40,4363,41],256],12808:[[40,4364,41],256],12809:[[40,4366,41],256],12810:[[40,4367,41],256],12811:[[40,4368,41],256],12812:[[40,4369,41],256],12813:[[40,4370,41],256],12814:[[40,4352,4449,41],256],12815:[[40,4354,4449,41],256],12816:[[40,4355,4449,41],256],12817:[[40,4357,4449,41],256],12818:[[40,4358,4449,41],256],12819:[[40,4359,4449,41],256],12820:[[40,4361,4449,41],256],12821:[[40,4363,4449,41],256],12822:[[40,4364,4449,41],256],12823:[[40,4366,4449,41],256],12824:[[40,4367,4449,41],256],12825:[[40,4368,4449,41],256],12826:[[40,4369,4449,41],256],12827:[[40,4370,4449,41],256],12828:[[40,4364,4462,41],256],12829:[[40,4363,4457,4364,4453,4523,41],256],12830:[[40,4363,4457,4370,4462,41],256],12832:[[40,19968,41],256],12833:[[40,20108,41],256],12834:[[40,19977,41],256],12835:[[40,22235,41],256],12836:[[40,20116,41],256],12837:[[40,20845,41],256],12838:[[40,19971,41],256],12839:[[40,20843,41],256],12840:[[40,20061,41],256],12841:[[40,21313,41],256],12842:[[40,26376,41],256],12843:[[40,28779,41],256],12844:[[40,27700,41],256],12845:[[40,26408,41],256],12846:[[40,37329,41],256],12847:[[40,22303,41],256],12848:[[40,26085,41],256],12849:[[40,26666,41],256],12850:[[40,26377,41],256],12851:[[40,31038,41],256],12852:[[40,21517,41],256],12853:[[40,29305,41],256],12854:[[40,36001,41],256],12855:[[40,31069,41],256],12856:[[40,21172,41],256],12857:[[40,20195,41],256],12858:[[40,21628,41],256],12859:[[40,23398,41],256],12860:[[40,30435,41],256],12861:[[40,20225,41],256],12862:[[40,36039,41],256],12863:[[40,21332,41],256],12864:[[40,31085,41],256],12865:[[40,20241,41],256],12866:[[40,33258,41],256],12867:[[40,33267,41],256],12868:[[21839],256],12869:[[24188],256],12870:[[25991],256],12871:[[31631],256],12880:[[80,84,69],256],12881:[[50,49],256],12882:[[50,50],256],12883:[[50,51],256],12884:[[50,52],256],12885:[[50,53],256],12886:[[50,54],256],12887:[[50,55],256],12888:[[50,56],256],12889:[[50,57],256],12890:[[51,48],256],12891:[[51,49],256],12892:[[51,50],256],12893:[[51,51],256],12894:[[51,52],256],12895:[[51,53],256],12896:[[4352],256],12897:[[4354],256],12898:[[4355],256],12899:[[4357],256],12900:[[4358],256],12901:[[4359],256],12902:[[4361],256],12903:[[4363],256],12904:[[4364],256],12905:[[4366],256],12906:[[4367],256],12907:[[4368],256],12908:[[4369],256],12909:[[4370],256],12910:[[4352,4449],256],12911:[[4354,4449],256],12912:[[4355,4449],256],12913:[[4357,4449],256],12914:[[4358,4449],256],12915:[[4359,4449],256],12916:[[4361,4449],256],12917:[[4363,4449],256],12918:[[4364,4449],256],12919:[[4366,4449],256],12920:[[4367,4449],256],12921:[[4368,4449],256],12922:[[4369,4449],256],12923:[[4370,4449],256],12924:[[4366,4449,4535,4352,4457],256],12925:[[4364,4462,4363,4468],256],12926:[[4363,4462],256],12928:[[19968],256],12929:[[20108],256],12930:[[19977],256],12931:[[22235],256],12932:[[20116],256],12933:[[20845],256],12934:[[19971],256],12935:[[20843],256],12936:[[20061],256],12937:[[21313],256],12938:[[26376],256],12939:[[28779],256],12940:[[27700],256],12941:[[26408],256],12942:[[37329],256],12943:[[22303],256],12944:[[26085],256],12945:[[26666],256],12946:[[26377],256],12947:[[31038],256],12948:[[21517],256],12949:[[29305],256],12950:[[36001],256],12951:[[31069],256],12952:[[21172],256],12953:[[31192],256],12954:[[30007],256],12955:[[22899],256],12956:[[36969],256],12957:[[20778],256],12958:[[21360],256],12959:[[27880],256],12960:[[38917],256],12961:[[20241],256],12962:[[20889],256],12963:[[27491],256],12964:[[19978],256],12965:[[20013],256],12966:[[19979],256],12967:[[24038],256],12968:[[21491],256],12969:[[21307],256],12970:[[23447],256],12971:[[23398],256],12972:[[30435],256],12973:[[20225],256],12974:[[36039],256],12975:[[21332],256],12976:[[22812],256],12977:[[51,54],256],12978:[[51,55],256],12979:[[51,56],256],12980:[[51,57],256],12981:[[52,48],256],12982:[[52,49],256],12983:[[52,50],256],12984:[[52,51],256],12985:[[52,52],256],12986:[[52,53],256],12987:[[52,54],256],12988:[[52,55],256],12989:[[52,56],256],12990:[[52,57],256],12991:[[53,48],256],12992:[[49,26376],256],12993:[[50,26376],256],12994:[[51,26376],256],12995:[[52,26376],256],12996:[[53,26376],256],12997:[[54,26376],256],12998:[[55,26376],256],12999:[[56,26376],256],13e3:[[57,26376],256],13001:[[49,48,26376],256],13002:[[49,49,26376],256],13003:[[49,50,26376],256],13004:[[72,103],256],13005:[[101,114,103],256],13006:[[101,86],256],13007:[[76,84,68],256],13008:[[12450],256],13009:[[12452],256],13010:[[12454],256],13011:[[12456],256],13012:[[12458],256],13013:[[12459],256],13014:[[12461],256],13015:[[12463],256],13016:[[12465],256],13017:[[12467],256],13018:[[12469],256],13019:[[12471],256],13020:[[12473],256],13021:[[12475],256],13022:[[12477],256],13023:[[12479],256],13024:[[12481],256],13025:[[12484],256],13026:[[12486],256],13027:[[12488],256],13028:[[12490],256],13029:[[12491],256],13030:[[12492],256],13031:[[12493],256],13032:[[12494],256],13033:[[12495],256],13034:[[12498],256],13035:[[12501],256],13036:[[12504],256],13037:[[12507],256],13038:[[12510],256],13039:[[12511],256],13040:[[12512],256],13041:[[12513],256],13042:[[12514],256],13043:[[12516],256],13044:[[12518],256],13045:[[12520],256],13046:[[12521],256],13047:[[12522],256],13048:[[12523],256],13049:[[12524],256],13050:[[12525],256],13051:[[12527],256],13052:[[12528],256],13053:[[12529],256],13054:[[12530],256]},13056:{13056:[[12450,12497,12540,12488],256],13057:[[12450,12523,12501,12449],256],13058:[[12450,12531,12506,12450],256],13059:[[12450,12540,12523],256],13060:[[12452,12491,12531,12464],256],13061:[[12452,12531,12481],256],13062:[[12454,12457,12531],256],13063:[[12456,12473,12463,12540,12489],256],13064:[[12456,12540,12459,12540],256],13065:[[12458,12531,12473],256],13066:[[12458,12540,12512],256],13067:[[12459,12452,12522],256],13068:[[12459,12521,12483,12488],256],13069:[[12459,12525,12522,12540],256],13070:[[12460,12525,12531],256],13071:[[12460,12531,12510],256],13072:[[12462,12460],256],13073:[[12462,12491,12540],256],13074:[[12461,12517,12522,12540],256],13075:[[12462,12523,12480,12540],256],13076:[[12461,12525],256],13077:[[12461,12525,12464,12521,12512],256],13078:[[12461,12525,12513,12540,12488,12523],256],13079:[[12461,12525,12527,12483,12488],256],13080:[[12464,12521,12512],256],13081:[[12464,12521,12512,12488,12531],256],13082:[[12463,12523,12476,12452,12525],256],13083:[[12463,12525,12540,12493],256],13084:[[12465,12540,12473],256],13085:[[12467,12523,12490],256],13086:[[12467,12540,12509],256],13087:[[12469,12452,12463,12523],256],13088:[[12469,12531,12481,12540,12512],256],13089:[[12471,12522,12531,12464],256],13090:[[12475,12531,12481],256],13091:[[12475,12531,12488],256],13092:[[12480,12540,12473],256],13093:[[12487,12471],256],13094:[[12489,12523],256],13095:[[12488,12531],256],13096:[[12490,12494],256],13097:[[12494,12483,12488],256],13098:[[12495,12452,12484],256],13099:[[12497,12540,12475,12531,12488],256],13100:[[12497,12540,12484],256],13101:[[12496,12540,12524,12523],256],13102:[[12500,12450,12473,12488,12523],256],13103:[[12500,12463,12523],256],13104:[[12500,12467],256],13105:[[12499,12523],256],13106:[[12501,12449,12521,12483,12489],256],13107:[[12501,12451,12540,12488],256],13108:[[12502,12483,12471,12455,12523],256],13109:[[12501,12521,12531],256],13110:[[12504,12463,12479,12540,12523],256],13111:[[12506,12477],256],13112:[[12506,12491,12498],256],13113:[[12504,12523,12484],256],13114:[[12506,12531,12473],256],13115:[[12506,12540,12472],256],13116:[[12505,12540,12479],256],13117:[[12509,12452,12531,12488],256],13118:[[12508,12523,12488],256],13119:[[12507,12531],256],13120:[[12509,12531,12489],256],13121:[[12507,12540,12523],256],13122:[[12507,12540,12531],256],13123:[[12510,12452,12463,12525],256],13124:[[12510,12452,12523],256],13125:[[12510,12483,12495],256],13126:[[12510,12523,12463],256],13127:[[12510,12531,12471,12519,12531],256],13128:[[12511,12463,12525,12531],256],13129:[[12511,12522],256],13130:[[12511,12522,12496,12540,12523],256],13131:[[12513,12460],256],13132:[[12513,12460,12488,12531],256],13133:[[12513,12540,12488,12523],256],13134:[[12516,12540,12489],256],13135:[[12516,12540,12523],256],13136:[[12518,12450,12531],256],13137:[[12522,12483,12488,12523],256],13138:[[12522,12521],256],13139:[[12523,12500,12540],256],13140:[[12523,12540,12502,12523],256],13141:[[12524,12512],256],13142:[[12524,12531,12488,12466,12531],256],13143:[[12527,12483,12488],256],13144:[[48,28857],256],13145:[[49,28857],256],13146:[[50,28857],256],13147:[[51,28857],256],13148:[[52,28857],256],13149:[[53,28857],256],13150:[[54,28857],256],13151:[[55,28857],256],13152:[[56,28857],256],13153:[[57,28857],256],13154:[[49,48,28857],256],13155:[[49,49,28857],256],13156:[[49,50,28857],256],13157:[[49,51,28857],256],13158:[[49,52,28857],256],13159:[[49,53,28857],256],13160:[[49,54,28857],256],13161:[[49,55,28857],256],13162:[[49,56,28857],256],13163:[[49,57,28857],256],13164:[[50,48,28857],256],13165:[[50,49,28857],256],13166:[[50,50,28857],256],13167:[[50,51,28857],256],13168:[[50,52,28857],256],13169:[[104,80,97],256],13170:[[100,97],256],13171:[[65,85],256],13172:[[98,97,114],256],13173:[[111,86],256],13174:[[112,99],256],13175:[[100,109],256],13176:[[100,109,178],256],13177:[[100,109,179],256],13178:[[73,85],256],13179:[[24179,25104],256],13180:[[26157,21644],256],13181:[[22823,27491],256],13182:[[26126,27835],256],13183:[[26666,24335,20250,31038],256],13184:[[112,65],256],13185:[[110,65],256],13186:[[956,65],256],13187:[[109,65],256],13188:[[107,65],256],13189:[[75,66],256],13190:[[77,66],256],13191:[[71,66],256],13192:[[99,97,108],256],13193:[[107,99,97,108],256],13194:[[112,70],256],13195:[[110,70],256],13196:[[956,70],256],13197:[[956,103],256],13198:[[109,103],256],13199:[[107,103],256],13200:[[72,122],256],13201:[[107,72,122],256],13202:[[77,72,122],256],13203:[[71,72,122],256],13204:[[84,72,122],256],13205:[[956,8467],256],13206:[[109,8467],256],13207:[[100,8467],256],13208:[[107,8467],256],13209:[[102,109],256],13210:[[110,109],256],13211:[[956,109],256],13212:[[109,109],256],13213:[[99,109],256],13214:[[107,109],256],13215:[[109,109,178],256],13216:[[99,109,178],256],13217:[[109,178],256],13218:[[107,109,178],256],13219:[[109,109,179],256],13220:[[99,109,179],256],13221:[[109,179],256],13222:[[107,109,179],256],13223:[[109,8725,115],256],13224:[[109,8725,115,178],256],13225:[[80,97],256],13226:[[107,80,97],256],13227:[[77,80,97],256],13228:[[71,80,97],256],13229:[[114,97,100],256],13230:[[114,97,100,8725,115],256],13231:[[114,97,100,8725,115,178],256],13232:[[112,115],256],13233:[[110,115],256],13234:[[956,115],256],13235:[[109,115],256],13236:[[112,86],256],13237:[[110,86],256],13238:[[956,86],256],13239:[[109,86],256],13240:[[107,86],256],13241:[[77,86],256],13242:[[112,87],256],13243:[[110,87],256],13244:[[956,87],256],13245:[[109,87],256],13246:[[107,87],256],13247:[[77,87],256],13248:[[107,937],256],13249:[[77,937],256],13250:[[97,46,109,46],256],13251:[[66,113],256],13252:[[99,99],256],13253:[[99,100],256],13254:[[67,8725,107,103],256],13255:[[67,111,46],256],13256:[[100,66],256],13257:[[71,121],256],13258:[[104,97],256],13259:[[72,80],256],13260:[[105,110],256],13261:[[75,75],256],13262:[[75,77],256],13263:[[107,116],256],13264:[[108,109],256],13265:[[108,110],256],13266:[[108,111,103],256],13267:[[108,120],256],13268:[[109,98],256],13269:[[109,105,108],256],13270:[[109,111,108],256],13271:[[80,72],256],13272:[[112,46,109,46],256],13273:[[80,80,77],256],13274:[[80,82],256],13275:[[115,114],256],13276:[[83,118],256],13277:[[87,98],256],13278:[[86,8725,109],256],13279:[[65,8725,109],256],13280:[[49,26085],256],13281:[[50,26085],256],13282:[[51,26085],256],13283:[[52,26085],256],13284:[[53,26085],256],13285:[[54,26085],256],13286:[[55,26085],256],13287:[[56,26085],256],13288:[[57,26085],256],13289:[[49,48,26085],256],13290:[[49,49,26085],256],13291:[[49,50,26085],256],13292:[[49,51,26085],256],13293:[[49,52,26085],256],13294:[[49,53,26085],256],13295:[[49,54,26085],256],13296:[[49,55,26085],256],13297:[[49,56,26085],256],13298:[[49,57,26085],256],13299:[[50,48,26085],256],13300:[[50,49,26085],256],13301:[[50,50,26085],256],13302:[[50,51,26085],256],13303:[[50,52,26085],256],13304:[[50,53,26085],256],13305:[[50,54,26085],256],13306:[[50,55,26085],256],13307:[[50,56,26085],256],13308:[[50,57,26085],256],13309:[[51,48,26085],256],13310:[[51,49,26085],256],13311:[[103,97,108],256]},27136:{92912:[,1],92913:[,1],92914:[,1],92915:[,1],92916:[,1]},27392:{92976:[,230],92977:[,230],92978:[,230],92979:[,230],92980:[,230],92981:[,230],92982:[,230]},42496:{42607:[,230],42612:[,230],42613:[,230],42614:[,230],42615:[,230],42616:[,230],42617:[,230],42618:[,230],42619:[,230],42620:[,230],42621:[,230],42652:[[1098],256],42653:[[1100],256],42655:[,230],42736:[,230],42737:[,230]},42752:{42864:[[42863],256],43e3:[[294],256],43001:[[339],256]},43008:{43014:[,9],43204:[,9],43232:[,230],43233:[,230],43234:[,230],43235:[,230],43236:[,230],43237:[,230],43238:[,230],43239:[,230],43240:[,230],43241:[,230],43242:[,230],43243:[,230],43244:[,230],43245:[,230],43246:[,230],43247:[,230],43248:[,230],43249:[,230]},43264:{43307:[,220],43308:[,220],43309:[,220],43347:[,9],43443:[,7],43456:[,9]},43520:{43696:[,230],43698:[,230],43699:[,230],43700:[,220],43703:[,230],43704:[,230],43710:[,230],43711:[,230],43713:[,230],43766:[,9]},43776:{43868:[[42791],256],43869:[[43831],256],43870:[[619],256],43871:[[43858],256],44013:[,9]},48128:{113822:[,1]},53504:{119134:[[119127,119141],512],119135:[[119128,119141],512],119136:[[119135,119150],512],119137:[[119135,119151],512],119138:[[119135,119152],512],119139:[[119135,119153],512],119140:[[119135,119154],512],119141:[,216],119142:[,216],119143:[,1],119144:[,1],119145:[,1],119149:[,226],119150:[,216],119151:[,216],119152:[,216],119153:[,216],119154:[,216],119163:[,220],119164:[,220],119165:[,220],119166:[,220],119167:[,220],119168:[,220],119169:[,220],119170:[,220],119173:[,230],119174:[,230],119175:[,230],119176:[,230],119177:[,230],119178:[,220],119179:[,220],119210:[,230],119211:[,230],119212:[,230],119213:[,230],119227:[[119225,119141],512],119228:[[119226,119141],512],119229:[[119227,119150],512],119230:[[119228,119150],512],119231:[[119227,119151],512],119232:[[119228,119151],512]},53760:{119362:[,230],119363:[,230],119364:[,230]},54272:{119808:[[65],256],119809:[[66],256],119810:[[67],256],119811:[[68],256],119812:[[69],256],119813:[[70],256],119814:[[71],256],119815:[[72],256],119816:[[73],256],119817:[[74],256],119818:[[75],256],119819:[[76],256],119820:[[77],256],119821:[[78],256],119822:[[79],256],119823:[[80],256],119824:[[81],256],119825:[[82],256],119826:[[83],256],119827:[[84],256],119828:[[85],256],119829:[[86],256],119830:[[87],256],119831:[[88],256],119832:[[89],256],119833:[[90],256],119834:[[97],256],119835:[[98],256],119836:[[99],256],119837:[[100],256],119838:[[101],256],119839:[[102],256],119840:[[103],256],119841:[[104],256],119842:[[105],256],119843:[[106],256],119844:[[107],256],119845:[[108],256],119846:[[109],256],119847:[[110],256],119848:[[111],256],119849:[[112],256],119850:[[113],256],119851:[[114],256],119852:[[115],256],119853:[[116],256],119854:[[117],256],119855:[[118],256],119856:[[119],256],119857:[[120],256],119858:[[121],256],119859:[[122],256],119860:[[65],256],119861:[[66],256],119862:[[67],256],119863:[[68],256],119864:[[69],256],119865:[[70],256],119866:[[71],256],119867:[[72],256],119868:[[73],256],119869:[[74],256],119870:[[75],256],119871:[[76],256],119872:[[77],256],119873:[[78],256],119874:[[79],256],119875:[[80],256],119876:[[81],256],119877:[[82],256],119878:[[83],256],119879:[[84],256],119880:[[85],256],119881:[[86],256],119882:[[87],256],119883:[[88],256],119884:[[89],256],119885:[[90],256],119886:[[97],256],119887:[[98],256],119888:[[99],256],119889:[[100],256],119890:[[101],256],119891:[[102],256],119892:[[103],256],119894:[[105],256],119895:[[106],256],119896:[[107],256],119897:[[108],256],119898:[[109],256],119899:[[110],256],119900:[[111],256],119901:[[112],256],119902:[[113],256],119903:[[114],256],119904:[[115],256],119905:[[116],256],119906:[[117],256],119907:[[118],256],119908:[[119],256],119909:[[120],256],119910:[[121],256],119911:[[122],256],119912:[[65],256],119913:[[66],256],119914:[[67],256],119915:[[68],256],119916:[[69],256],119917:[[70],256],119918:[[71],256],119919:[[72],256],119920:[[73],256],119921:[[74],256],119922:[[75],256],119923:[[76],256],119924:[[77],256],119925:[[78],256],119926:[[79],256],119927:[[80],256],119928:[[81],256],119929:[[82],256],119930:[[83],256],119931:[[84],256],119932:[[85],256],119933:[[86],256],119934:[[87],256],119935:[[88],256],119936:[[89],256],119937:[[90],256],119938:[[97],256],119939:[[98],256],119940:[[99],256],119941:[[100],256],119942:[[101],256],119943:[[102],256],119944:[[103],256],119945:[[104],256],119946:[[105],256],119947:[[106],256],119948:[[107],256],119949:[[108],256],119950:[[109],256],119951:[[110],256],119952:[[111],256],119953:[[112],256],119954:[[113],256],119955:[[114],256],119956:[[115],256],119957:[[116],256],119958:[[117],256],119959:[[118],256],119960:[[119],256],119961:[[120],256],119962:[[121],256],119963:[[122],256],119964:[[65],256],119966:[[67],256],119967:[[68],256],119970:[[71],256],119973:[[74],256],119974:[[75],256],119977:[[78],256],119978:[[79],256],119979:[[80],256],119980:[[81],256],119982:[[83],256],119983:[[84],256],119984:[[85],256],119985:[[86],256],119986:[[87],256],119987:[[88],256],119988:[[89],256],119989:[[90],256],119990:[[97],256],119991:[[98],256],119992:[[99],256],119993:[[100],256],119995:[[102],256],119997:[[104],256],119998:[[105],256],119999:[[106],256],12e4:[[107],256],120001:[[108],256],120002:[[109],256],120003:[[110],256],120005:[[112],256],120006:[[113],256],120007:[[114],256],120008:[[115],256],120009:[[116],256],120010:[[117],256],120011:[[118],256],120012:[[119],256],120013:[[120],256],120014:[[121],256],120015:[[122],256],120016:[[65],256],120017:[[66],256],120018:[[67],256],120019:[[68],256],120020:[[69],256],120021:[[70],256],120022:[[71],256],120023:[[72],256],120024:[[73],256],120025:[[74],256],120026:[[75],256],120027:[[76],256],120028:[[77],256],120029:[[78],256],120030:[[79],256],120031:[[80],256],120032:[[81],256],120033:[[82],256],120034:[[83],256],120035:[[84],256],120036:[[85],256],120037:[[86],256],120038:[[87],256],120039:[[88],256],120040:[[89],256],120041:[[90],256],120042:[[97],256],120043:[[98],256],120044:[[99],256],120045:[[100],256],120046:[[101],256],120047:[[102],256],120048:[[103],256],120049:[[104],256],120050:[[105],256],120051:[[106],256],120052:[[107],256],120053:[[108],256],120054:[[109],256],120055:[[110],256],120056:[[111],256],120057:[[112],256],120058:[[113],256],120059:[[114],256],120060:[[115],256],120061:[[116],256],120062:[[117],256],120063:[[118],256]},54528:{120064:[[119],256],120065:[[120],256],120066:[[121],256],120067:[[122],256],120068:[[65],256],120069:[[66],256],120071:[[68],256],120072:[[69],256],120073:[[70],256],120074:[[71],256],120077:[[74],256],120078:[[75],256],120079:[[76],256],120080:[[77],256],120081:[[78],256],120082:[[79],256],120083:[[80],256],120084:[[81],256],120086:[[83],256],120087:[[84],256],120088:[[85],256],120089:[[86],256],120090:[[87],256],120091:[[88],256],120092:[[89],256],120094:[[97],256],120095:[[98],256],120096:[[99],256],120097:[[100],256],120098:[[101],256],120099:[[102],256],120100:[[103],256],120101:[[104],256],120102:[[105],256],120103:[[106],256],120104:[[107],256],120105:[[108],256],120106:[[109],256],120107:[[110],256],120108:[[111],256],120109:[[112],256],120110:[[113],256],120111:[[114],256],120112:[[115],256],120113:[[116],256],120114:[[117],256],120115:[[118],256],120116:[[119],256],120117:[[120],256],120118:[[121],256],120119:[[122],256],120120:[[65],256],120121:[[66],256],120123:[[68],256],120124:[[69],256],120125:[[70],256],120126:[[71],256],120128:[[73],256],120129:[[74],256],120130:[[75],256],120131:[[76],256],120132:[[77],256],120134:[[79],256],120138:[[83],256],120139:[[84],256],120140:[[85],256],120141:[[86],256],120142:[[87],256],120143:[[88],256],120144:[[89],256],120146:[[97],256],120147:[[98],256],120148:[[99],256],120149:[[100],256],120150:[[101],256],120151:[[102],256],120152:[[103],256],120153:[[104],256],120154:[[105],256],120155:[[106],256],120156:[[107],256],120157:[[108],256],120158:[[109],256],120159:[[110],256],120160:[[111],256],120161:[[112],256],120162:[[113],256],120163:[[114],256],120164:[[115],256],120165:[[116],256],120166:[[117],256],120167:[[118],256],120168:[[119],256],120169:[[120],256],120170:[[121],256],120171:[[122],256],120172:[[65],256],120173:[[66],256],120174:[[67],256],120175:[[68],256],120176:[[69],256],120177:[[70],256],120178:[[71],256],120179:[[72],256],120180:[[73],256],120181:[[74],256],120182:[[75],256],120183:[[76],256],120184:[[77],256],120185:[[78],256],120186:[[79],256],120187:[[80],256],120188:[[81],256],120189:[[82],256],120190:[[83],256],120191:[[84],256],120192:[[85],256],120193:[[86],256],120194:[[87],256],120195:[[88],256],120196:[[89],256],120197:[[90],256],120198:[[97],256],120199:[[98],256],120200:[[99],256],120201:[[100],256],120202:[[101],256],120203:[[102],256],120204:[[103],256],120205:[[104],256],120206:[[105],256],120207:[[106],256],120208:[[107],256],120209:[[108],256],120210:[[109],256],120211:[[110],256],120212:[[111],256],120213:[[112],256],120214:[[113],256],120215:[[114],256],120216:[[115],256],120217:[[116],256],120218:[[117],256],120219:[[118],256],120220:[[119],256],120221:[[120],256],120222:[[121],256],120223:[[122],256],120224:[[65],256],120225:[[66],256],120226:[[67],256],120227:[[68],256],120228:[[69],256],120229:[[70],256],120230:[[71],256],120231:[[72],256],120232:[[73],256],120233:[[74],256],120234:[[75],256],120235:[[76],256],120236:[[77],256],120237:[[78],256],120238:[[79],256],120239:[[80],256],120240:[[81],256],120241:[[82],256],120242:[[83],256],120243:[[84],256],120244:[[85],256],120245:[[86],256],120246:[[87],256],120247:[[88],256],120248:[[89],256],120249:[[90],256],120250:[[97],256],120251:[[98],256],120252:[[99],256],120253:[[100],256],120254:[[101],256],120255:[[102],256],120256:[[103],256],120257:[[104],256],120258:[[105],256],120259:[[106],256],120260:[[107],256],120261:[[108],256],120262:[[109],256],120263:[[110],256],120264:[[111],256],120265:[[112],256],120266:[[113],256],120267:[[114],256],120268:[[115],256],120269:[[116],256],120270:[[117],256],120271:[[118],256],120272:[[119],256],120273:[[120],256],120274:[[121],256],120275:[[122],256],120276:[[65],256],120277:[[66],256],120278:[[67],256],120279:[[68],256],120280:[[69],256],120281:[[70],256],120282:[[71],256],120283:[[72],256],120284:[[73],256],120285:[[74],256],120286:[[75],256],120287:[[76],256],120288:[[77],256],120289:[[78],256],120290:[[79],256],120291:[[80],256],120292:[[81],256],120293:[[82],256],120294:[[83],256],120295:[[84],256],120296:[[85],256],120297:[[86],256],120298:[[87],256],120299:[[88],256],120300:[[89],256],120301:[[90],256],120302:[[97],256],120303:[[98],256],120304:[[99],256],120305:[[100],256],120306:[[101],256],120307:[[102],256],120308:[[103],256],120309:[[104],256],120310:[[105],256],120311:[[106],256],120312:[[107],256],120313:[[108],256],120314:[[109],256],120315:[[110],256],120316:[[111],256],120317:[[112],256],120318:[[113],256],120319:[[114],256]},54784:{120320:[[115],256],120321:[[116],256],120322:[[117],256],120323:[[118],256],120324:[[119],256],120325:[[120],256],120326:[[121],256],120327:[[122],256],120328:[[65],256],120329:[[66],256],120330:[[67],256],120331:[[68],256],120332:[[69],256],120333:[[70],256],120334:[[71],256],120335:[[72],256],120336:[[73],256],120337:[[74],256],120338:[[75],256],120339:[[76],256],120340:[[77],256],120341:[[78],256],120342:[[79],256],120343:[[80],256],120344:[[81],256],120345:[[82],256],120346:[[83],256],120347:[[84],256],120348:[[85],256],120349:[[86],256],120350:[[87],256],120351:[[88],256],120352:[[89],256],120353:[[90],256],120354:[[97],256],120355:[[98],256],120356:[[99],256],120357:[[100],256],120358:[[101],256],120359:[[102],256],120360:[[103],256],120361:[[104],256],120362:[[105],256],120363:[[106],256],120364:[[107],256],120365:[[108],256],120366:[[109],256],120367:[[110],256],120368:[[111],256],120369:[[112],256],120370:[[113],256],120371:[[114],256],120372:[[115],256],120373:[[116],256],120374:[[117],256],120375:[[118],256],120376:[[119],256],120377:[[120],256],120378:[[121],256],120379:[[122],256],120380:[[65],256],120381:[[66],256],120382:[[67],256],120383:[[68],256],120384:[[69],256],120385:[[70],256],120386:[[71],256],120387:[[72],256],120388:[[73],256],120389:[[74],256],120390:[[75],256],120391:[[76],256],120392:[[77],256],120393:[[78],256],120394:[[79],256],120395:[[80],256],120396:[[81],256],120397:[[82],256],120398:[[83],256],120399:[[84],256],120400:[[85],256],120401:[[86],256],120402:[[87],256],120403:[[88],256],120404:[[89],256],120405:[[90],256],120406:[[97],256],120407:[[98],256],120408:[[99],256],120409:[[100],256],120410:[[101],256],120411:[[102],256],120412:[[103],256],120413:[[104],256],120414:[[105],256],120415:[[106],256],120416:[[107],256],120417:[[108],256],120418:[[109],256],120419:[[110],256],120420:[[111],256],120421:[[112],256],120422:[[113],256],120423:[[114],256],120424:[[115],256],120425:[[116],256],120426:[[117],256],120427:[[118],256],120428:[[119],256],120429:[[120],256],120430:[[121],256],120431:[[122],256],120432:[[65],256],120433:[[66],256],120434:[[67],256],120435:[[68],256],120436:[[69],256],120437:[[70],256],120438:[[71],256],120439:[[72],256],120440:[[73],256],120441:[[74],256],120442:[[75],256],120443:[[76],256],120444:[[77],256],120445:[[78],256],120446:[[79],256],120447:[[80],256],120448:[[81],256],120449:[[82],256],120450:[[83],256],120451:[[84],256],120452:[[85],256],120453:[[86],256],120454:[[87],256],120455:[[88],256],120456:[[89],256],120457:[[90],256],120458:[[97],256],120459:[[98],256],120460:[[99],256],120461:[[100],256],120462:[[101],256],120463:[[102],256],120464:[[103],256],120465:[[104],256],120466:[[105],256],120467:[[106],256],120468:[[107],256],120469:[[108],256],120470:[[109],256],120471:[[110],256],120472:[[111],256],120473:[[112],256],120474:[[113],256],120475:[[114],256],120476:[[115],256],120477:[[116],256],120478:[[117],256],120479:[[118],256],120480:[[119],256],120481:[[120],256],120482:[[121],256],120483:[[122],256],120484:[[305],256],120485:[[567],256],120488:[[913],256],120489:[[914],256],120490:[[915],256],120491:[[916],256],120492:[[917],256],120493:[[918],256],120494:[[919],256],120495:[[920],256],120496:[[921],256],120497:[[922],256],120498:[[923],256],120499:[[924],256],120500:[[925],256],120501:[[926],256],120502:[[927],256],120503:[[928],256],120504:[[929],256],120505:[[1012],256],120506:[[931],256],120507:[[932],256],120508:[[933],256],120509:[[934],256],120510:[[935],256],120511:[[936],256],120512:[[937],256],120513:[[8711],256],120514:[[945],256],120515:[[946],256],120516:[[947],256],120517:[[948],256],120518:[[949],256],120519:[[950],256],120520:[[951],256],120521:[[952],256],120522:[[953],256],120523:[[954],256],120524:[[955],256],120525:[[956],256],120526:[[957],256],120527:[[958],256],120528:[[959],256],120529:[[960],256],120530:[[961],256],120531:[[962],256],120532:[[963],256],120533:[[964],256],120534:[[965],256],120535:[[966],256],120536:[[967],256],120537:[[968],256],120538:[[969],256],120539:[[8706],256],120540:[[1013],256],120541:[[977],256],120542:[[1008],256],120543:[[981],256],120544:[[1009],256],120545:[[982],256],120546:[[913],256],120547:[[914],256],120548:[[915],256],120549:[[916],256],120550:[[917],256],120551:[[918],256],120552:[[919],256],120553:[[920],256],120554:[[921],256],120555:[[922],256],120556:[[923],256],120557:[[924],256],120558:[[925],256],120559:[[926],256],120560:[[927],256],120561:[[928],256],120562:[[929],256],120563:[[1012],256],120564:[[931],256],120565:[[932],256],120566:[[933],256],120567:[[934],256],120568:[[935],256],120569:[[936],256],120570:[[937],256],120571:[[8711],256],120572:[[945],256],120573:[[946],256],120574:[[947],256],120575:[[948],256]},55040:{120576:[[949],256],120577:[[950],256],120578:[[951],256],120579:[[952],256],120580:[[953],256],120581:[[954],256],120582:[[955],256],120583:[[956],256],120584:[[957],256],120585:[[958],256],120586:[[959],256],120587:[[960],256],120588:[[961],256],120589:[[962],256],120590:[[963],256],120591:[[964],256],120592:[[965],256],120593:[[966],256],120594:[[967],256],120595:[[968],256],120596:[[969],256],120597:[[8706],256],120598:[[1013],256],120599:[[977],256],120600:[[1008],256],120601:[[981],256],120602:[[1009],256],120603:[[982],256],120604:[[913],256],120605:[[914],256],120606:[[915],256],120607:[[916],256],120608:[[917],256],120609:[[918],256],120610:[[919],256],120611:[[920],256],120612:[[921],256],120613:[[922],256],120614:[[923],256],120615:[[924],256],120616:[[925],256],120617:[[926],256],120618:[[927],256],120619:[[928],256],120620:[[929],256],120621:[[1012],256],120622:[[931],256],120623:[[932],256],120624:[[933],256],120625:[[934],256],120626:[[935],256],120627:[[936],256],120628:[[937],256],120629:[[8711],256],120630:[[945],256],120631:[[946],256],120632:[[947],256],120633:[[948],256],120634:[[949],256],120635:[[950],256],120636:[[951],256],120637:[[952],256],120638:[[953],256],120639:[[954],256],120640:[[955],256],120641:[[956],256],120642:[[957],256],120643:[[958],256],120644:[[959],256],120645:[[960],256],120646:[[961],256],120647:[[962],256],120648:[[963],256],120649:[[964],256],120650:[[965],256],120651:[[966],256],120652:[[967],256],120653:[[968],256],120654:[[969],256],120655:[[8706],256],120656:[[1013],256],120657:[[977],256],120658:[[1008],256],120659:[[981],256],120660:[[1009],256],120661:[[982],256],120662:[[913],256],120663:[[914],256],120664:[[915],256],120665:[[916],256],120666:[[917],256],120667:[[918],256],120668:[[919],256],120669:[[920],256],120670:[[921],256],120671:[[922],256],120672:[[923],256],120673:[[924],256],120674:[[925],256],120675:[[926],256],120676:[[927],256],120677:[[928],256],120678:[[929],256],120679:[[1012],256],120680:[[931],256],120681:[[932],256],120682:[[933],256],120683:[[934],256],120684:[[935],256],120685:[[936],256],120686:[[937],256],120687:[[8711],256],120688:[[945],256],120689:[[946],256],120690:[[947],256],120691:[[948],256],120692:[[949],256],120693:[[950],256],120694:[[951],256],120695:[[952],256],120696:[[953],256],120697:[[954],256],120698:[[955],256],120699:[[956],256],120700:[[957],256],120701:[[958],256],120702:[[959],256],120703:[[960],256],120704:[[961],256],120705:[[962],256],120706:[[963],256],120707:[[964],256],120708:[[965],256],120709:[[966],256],120710:[[967],256],120711:[[968],256],120712:[[969],256],120713:[[8706],256],120714:[[1013],256],120715:[[977],256],120716:[[1008],256],120717:[[981],256],120718:[[1009],256],120719:[[982],256],120720:[[913],256],120721:[[914],256],120722:[[915],256],120723:[[916],256],120724:[[917],256],120725:[[918],256],120726:[[919],256],120727:[[920],256],120728:[[921],256],120729:[[922],256],120730:[[923],256],120731:[[924],256],120732:[[925],256],120733:[[926],256],120734:[[927],256],120735:[[928],256],120736:[[929],256],120737:[[1012],256],120738:[[931],256],120739:[[932],256],120740:[[933],256],120741:[[934],256],120742:[[935],256],120743:[[936],256],120744:[[937],256],120745:[[8711],256],120746:[[945],256],120747:[[946],256],120748:[[947],256],120749:[[948],256],120750:[[949],256],120751:[[950],256],120752:[[951],256],120753:[[952],256],120754:[[953],256],120755:[[954],256],120756:[[955],256],120757:[[956],256],120758:[[957],256],120759:[[958],256],120760:[[959],256],120761:[[960],256],120762:[[961],256],120763:[[962],256],120764:[[963],256],120765:[[964],256],120766:[[965],256],120767:[[966],256],120768:[[967],256],120769:[[968],256],120770:[[969],256],120771:[[8706],256],120772:[[1013],256],120773:[[977],256],120774:[[1008],256],120775:[[981],256],120776:[[1009],256],120777:[[982],256],120778:[[988],256],120779:[[989],256],120782:[[48],256],120783:[[49],256],120784:[[50],256],120785:[[51],256],120786:[[52],256],120787:[[53],256],120788:[[54],256],120789:[[55],256],120790:[[56],256],120791:[[57],256],120792:[[48],256],120793:[[49],256],120794:[[50],256],120795:[[51],256],120796:[[52],256],120797:[[53],256],120798:[[54],256],120799:[[55],256],120800:[[56],256],120801:[[57],256],120802:[[48],256],120803:[[49],256],120804:[[50],256],120805:[[51],256],120806:[[52],256],120807:[[53],256],120808:[[54],256],120809:[[55],256],120810:[[56],256],120811:[[57],256],120812:[[48],256],120813:[[49],256],120814:[[50],256],120815:[[51],256],120816:[[52],256],120817:[[53],256],120818:[[54],256],120819:[[55],256],120820:[[56],256],120821:[[57],256],120822:[[48],256],120823:[[49],256],120824:[[50],256],120825:[[51],256],120826:[[52],256],120827:[[53],256],120828:[[54],256],120829:[[55],256],120830:[[56],256],120831:[[57],256]},59392:{125136:[,220],125137:[,220],125138:[,220],125139:[,220],125140:[,220],125141:[,220],125142:[,220]},60928:{126464:[[1575],256],126465:[[1576],256],126466:[[1580],256],126467:[[1583],256],126469:[[1608],256],126470:[[1586],256],126471:[[1581],256],126472:[[1591],256],126473:[[1610],256],126474:[[1603],256],126475:[[1604],256],126476:[[1605],256],126477:[[1606],256],126478:[[1587],256],126479:[[1593],256],126480:[[1601],256],126481:[[1589],256],126482:[[1602],256],126483:[[1585],256],126484:[[1588],256],126485:[[1578],256],126486:[[1579],256],126487:[[1582],256],126488:[[1584],256],126489:[[1590],256],126490:[[1592],256],126491:[[1594],256],126492:[[1646],256],126493:[[1722],256],126494:[[1697],256],126495:[[1647],256],126497:[[1576],256],126498:[[1580],256],126500:[[1607],256],126503:[[1581],256],126505:[[1610],256],126506:[[1603],256],126507:[[1604],256],126508:[[1605],256],126509:[[1606],256],126510:[[1587],256],126511:[[1593],256],126512:[[1601],256],126513:[[1589],256],126514:[[1602],256],126516:[[1588],256],126517:[[1578],256],126518:[[1579],256],126519:[[1582],256],126521:[[1590],256],126523:[[1594],256],126530:[[1580],256],126535:[[1581],256],126537:[[1610],256],126539:[[1604],256],126541:[[1606],256],126542:[[1587],256],126543:[[1593],256],126545:[[1589],256],126546:[[1602],256],126548:[[1588],256],126551:[[1582],256],126553:[[1590],256],126555:[[1594],256],126557:[[1722],256],126559:[[1647],256],126561:[[1576],256],126562:[[1580],256],126564:[[1607],256],126567:[[1581],256],126568:[[1591],256],126569:[[1610],256],126570:[[1603],256],126572:[[1605],256],126573:[[1606],256],126574:[[1587],256],126575:[[1593],256],126576:[[1601],256],126577:[[1589],256],126578:[[1602],256],126580:[[1588],256],126581:[[1578],256],126582:[[1579],256],126583:[[1582],256],126585:[[1590],256],126586:[[1592],256],126587:[[1594],256],126588:[[1646],256],126590:[[1697],256],126592:[[1575],256],126593:[[1576],256],126594:[[1580],256],126595:[[1583],256],126596:[[1607],256],126597:[[1608],256],126598:[[1586],256],126599:[[1581],256],126600:[[1591],256],126601:[[1610],256],126603:[[1604],256],126604:[[1605],256],126605:[[1606],256],126606:[[1587],256],126607:[[1593],256],126608:[[1601],256],126609:[[1589],256],126610:[[1602],256],126611:[[1585],256],126612:[[1588],256],126613:[[1578],256],126614:[[1579],256],126615:[[1582],256],126616:[[1584],256],126617:[[1590],256],126618:[[1592],256],126619:[[1594],256],126625:[[1576],256],126626:[[1580],256],126627:[[1583],256],126629:[[1608],256],126630:[[1586],256],126631:[[1581],256],126632:[[1591],256],126633:[[1610],256],126635:[[1604],256],126636:[[1605],256],126637:[[1606],256],126638:[[1587],256],126639:[[1593],256],126640:[[1601],256],126641:[[1589],256],126642:[[1602],256],126643:[[1585],256],126644:[[1588],256],126645:[[1578],256],126646:[[1579],256],126647:[[1582],256],126648:[[1584],256],126649:[[1590],256],126650:[[1592],256],126651:[[1594],256]},61696:{127232:[[48,46],256],127233:[[48,44],256],127234:[[49,44],256],127235:[[50,44],256],127236:[[51,44],256],127237:[[52,44],256],127238:[[53,44],256],127239:[[54,44],256],127240:[[55,44],256],127241:[[56,44],256],127242:[[57,44],256],127248:[[40,65,41],256],127249:[[40,66,41],256],127250:[[40,67,41],256],127251:[[40,68,41],256],127252:[[40,69,41],256],127253:[[40,70,41],256],127254:[[40,71,41],256],127255:[[40,72,41],256],127256:[[40,73,41],256],127257:[[40,74,41],256],127258:[[40,75,41],256],127259:[[40,76,41],256],127260:[[40,77,41],256],127261:[[40,78,41],256],127262:[[40,79,41],256],127263:[[40,80,41],256],127264:[[40,81,41],256],127265:[[40,82,41],256],127266:[[40,83,41],256],127267:[[40,84,41],256],127268:[[40,85,41],256],127269:[[40,86,41],256],127270:[[40,87,41],256],127271:[[40,88,41],256],127272:[[40,89,41],256],127273:[[40,90,41],256],127274:[[12308,83,12309],256],127275:[[67],256],127276:[[82],256],127277:[[67,68],256],127278:[[87,90],256],127280:[[65],256],127281:[[66],256],127282:[[67],256],127283:[[68],256],127284:[[69],256],127285:[[70],256],127286:[[71],256],127287:[[72],256],127288:[[73],256],127289:[[74],256],127290:[[75],256],127291:[[76],256],127292:[[77],256],127293:[[78],256],127294:[[79],256],127295:[[80],256],127296:[[81],256],127297:[[82],256],127298:[[83],256],127299:[[84],256],127300:[[85],256],127301:[[86],256],127302:[[87],256],127303:[[88],256],127304:[[89],256],127305:[[90],256],127306:[[72,86],256],127307:[[77,86],256],127308:[[83,68],256],127309:[[83,83],256],127310:[[80,80,86],256],127311:[[87,67],256],127338:[[77,67],256],127339:[[77,68],256],127376:[[68,74],256]},61952:{127488:[[12411,12363],256],127489:[[12467,12467],256],127490:[[12469],256],127504:[[25163],256],127505:[[23383],256],127506:[[21452],256],127507:[[12487],256],127508:[[20108],256],127509:[[22810],256],127510:[[35299],256],127511:[[22825],256],127512:[[20132],256],127513:[[26144],256],127514:[[28961],256],127515:[[26009],256],127516:[[21069],256],127517:[[24460],256],127518:[[20877],256],127519:[[26032],256],127520:[[21021],256],127521:[[32066],256],127522:[[29983],256],127523:[[36009],256],127524:[[22768],256],127525:[[21561],256],127526:[[28436],256],127527:[[25237],256],127528:[[25429],256],127529:[[19968],256],127530:[[19977],256],127531:[[36938],256],127532:[[24038],256],127533:[[20013],256],127534:[[21491],256],127535:[[25351],256],127536:[[36208],256],127537:[[25171],256],127538:[[31105],256],127539:[[31354],256],127540:[[21512],256],127541:[[28288],256],127542:[[26377],256],127543:[[26376],256],127544:[[30003],256],127545:[[21106],256],127546:[[21942],256],127552:[[12308,26412,12309],256],127553:[[12308,19977,12309],256],127554:[[12308,20108,12309],256],127555:[[12308,23433,12309],256],127556:[[12308,28857,12309],256],127557:[[12308,25171,12309],256],127558:[[12308,30423,12309],256],127559:[[12308,21213,12309],256],127560:[[12308,25943,12309],256],127568:[[24471],256],127569:[[21487],256]},63488:{194560:[[20029]],194561:[[20024]],194562:[[20033]],194563:[[131362]],194564:[[20320]],194565:[[20398]],194566:[[20411]],194567:[[20482]],194568:[[20602]],194569:[[20633]],194570:[[20711]],194571:[[20687]],194572:[[13470]],194573:[[132666]],194574:[[20813]],194575:[[20820]],194576:[[20836]],194577:[[20855]],194578:[[132380]],194579:[[13497]],194580:[[20839]],194581:[[20877]],194582:[[132427]],194583:[[20887]],194584:[[20900]],194585:[[20172]],194586:[[20908]],194587:[[20917]],194588:[[168415]],194589:[[20981]],194590:[[20995]],194591:[[13535]],194592:[[21051]],194593:[[21062]],194594:[[21106]],194595:[[21111]],194596:[[13589]],194597:[[21191]],194598:[[21193]],194599:[[21220]],194600:[[21242]],194601:[[21253]],194602:[[21254]],194603:[[21271]],194604:[[21321]],194605:[[21329]],194606:[[21338]],194607:[[21363]],194608:[[21373]],194609:[[21375]],194610:[[21375]],194611:[[21375]],194612:[[133676]],194613:[[28784]],194614:[[21450]],194615:[[21471]],194616:[[133987]],194617:[[21483]],194618:[[21489]],194619:[[21510]],194620:[[21662]],194621:[[21560]],194622:[[21576]],194623:[[21608]],194624:[[21666]],194625:[[21750]],194626:[[21776]],194627:[[21843]],194628:[[21859]],194629:[[21892]],194630:[[21892]],194631:[[21913]],194632:[[21931]],194633:[[21939]],194634:[[21954]],194635:[[22294]],194636:[[22022]],194637:[[22295]],194638:[[22097]],194639:[[22132]],194640:[[20999]],194641:[[22766]],194642:[[22478]],194643:[[22516]],194644:[[22541]],194645:[[22411]],194646:[[22578]],194647:[[22577]],194648:[[22700]],194649:[[136420]],194650:[[22770]],194651:[[22775]],194652:[[22790]],194653:[[22810]],194654:[[22818]],194655:[[22882]],194656:[[136872]],194657:[[136938]],194658:[[23020]],194659:[[23067]],194660:[[23079]],194661:[[23e3]],194662:[[23142]],194663:[[14062]],194664:[[14076]],194665:[[23304]],194666:[[23358]],194667:[[23358]],194668:[[137672]],194669:[[23491]],194670:[[23512]],194671:[[23527]],194672:[[23539]],194673:[[138008]],194674:[[23551]],194675:[[23558]],194676:[[24403]],194677:[[23586]],194678:[[14209]],194679:[[23648]],194680:[[23662]],194681:[[23744]],194682:[[23693]],194683:[[138724]],194684:[[23875]],194685:[[138726]],194686:[[23918]],194687:[[23915]],194688:[[23932]],194689:[[24033]],194690:[[24034]],194691:[[14383]],194692:[[24061]],194693:[[24104]],194694:[[24125]],194695:[[24169]],194696:[[14434]],194697:[[139651]],194698:[[14460]],194699:[[24240]],194700:[[24243]],194701:[[24246]],194702:[[24266]],194703:[[172946]],194704:[[24318]],194705:[[140081]],194706:[[140081]],194707:[[33281]],194708:[[24354]],194709:[[24354]],194710:[[14535]],194711:[[144056]],194712:[[156122]],194713:[[24418]],194714:[[24427]],194715:[[14563]],194716:[[24474]],194717:[[24525]],194718:[[24535]],194719:[[24569]],194720:[[24705]],194721:[[14650]],194722:[[14620]],194723:[[24724]],194724:[[141012]],194725:[[24775]],194726:[[24904]],194727:[[24908]],194728:[[24910]],194729:[[24908]],194730:[[24954]],194731:[[24974]],194732:[[25010]],194733:[[24996]],194734:[[25007]],194735:[[25054]],194736:[[25074]],194737:[[25078]],194738:[[25104]],194739:[[25115]],194740:[[25181]],194741:[[25265]],194742:[[25300]],194743:[[25424]],194744:[[142092]],194745:[[25405]],194746:[[25340]],194747:[[25448]],194748:[[25475]],194749:[[25572]],194750:[[142321]],194751:[[25634]],194752:[[25541]],194753:[[25513]],194754:[[14894]],194755:[[25705]],194756:[[25726]],194757:[[25757]],194758:[[25719]],194759:[[14956]],194760:[[25935]],194761:[[25964]],194762:[[143370]],194763:[[26083]],194764:[[26360]],194765:[[26185]],194766:[[15129]],194767:[[26257]],194768:[[15112]],194769:[[15076]],194770:[[20882]],194771:[[20885]],194772:[[26368]],194773:[[26268]],194774:[[32941]],194775:[[17369]],194776:[[26391]],194777:[[26395]],194778:[[26401]],194779:[[26462]],194780:[[26451]],194781:[[144323]],194782:[[15177]],194783:[[26618]],194784:[[26501]],194785:[[26706]],194786:[[26757]],194787:[[144493]],194788:[[26766]],194789:[[26655]],194790:[[26900]],194791:[[15261]],194792:[[26946]],194793:[[27043]],194794:[[27114]],194795:[[27304]],194796:[[145059]],194797:[[27355]],194798:[[15384]],194799:[[27425]],194800:[[145575]],194801:[[27476]],194802:[[15438]],194803:[[27506]],194804:[[27551]],194805:[[27578]],194806:[[27579]],194807:[[146061]],194808:[[138507]],194809:[[146170]],194810:[[27726]],194811:[[146620]],194812:[[27839]],194813:[[27853]],194814:[[27751]],194815:[[27926]]},63744:{63744:[[35912]],63745:[[26356]],63746:[[36554]],63747:[[36040]],63748:[[28369]],63749:[[20018]],63750:[[21477]],63751:[[40860]],63752:[[40860]],63753:[[22865]],63754:[[37329]],63755:[[21895]],63756:[[22856]],63757:[[25078]],63758:[[30313]],63759:[[32645]],63760:[[34367]],63761:[[34746]],63762:[[35064]],63763:[[37007]],63764:[[27138]],63765:[[27931]],63766:[[28889]],63767:[[29662]],63768:[[33853]],63769:[[37226]],63770:[[39409]],63771:[[20098]],63772:[[21365]],63773:[[27396]],63774:[[29211]],63775:[[34349]],63776:[[40478]],63777:[[23888]],63778:[[28651]],63779:[[34253]],63780:[[35172]],63781:[[25289]],63782:[[33240]],63783:[[34847]],63784:[[24266]],63785:[[26391]],63786:[[28010]],63787:[[29436]],63788:[[37070]],63789:[[20358]],63790:[[20919]],63791:[[21214]],63792:[[25796]],63793:[[27347]],63794:[[29200]],63795:[[30439]],63796:[[32769]],63797:[[34310]],63798:[[34396]],63799:[[36335]],63800:[[38706]],63801:[[39791]],63802:[[40442]],63803:[[30860]],63804:[[31103]],63805:[[32160]],63806:[[33737]],63807:[[37636]],63808:[[40575]],63809:[[35542]],63810:[[22751]],63811:[[24324]],63812:[[31840]],63813:[[32894]],63814:[[29282]],63815:[[30922]],63816:[[36034]],63817:[[38647]],63818:[[22744]],63819:[[23650]],63820:[[27155]],63821:[[28122]],63822:[[28431]],63823:[[32047]],63824:[[32311]],63825:[[38475]],63826:[[21202]],63827:[[32907]],63828:[[20956]],63829:[[20940]],63830:[[31260]],63831:[[32190]],63832:[[33777]],63833:[[38517]],63834:[[35712]],63835:[[25295]],63836:[[27138]],63837:[[35582]],63838:[[20025]],63839:[[23527]],63840:[[24594]],63841:[[29575]],63842:[[30064]],63843:[[21271]],63844:[[30971]],63845:[[20415]],63846:[[24489]],63847:[[19981]],63848:[[27852]],63849:[[25976]],63850:[[32034]],63851:[[21443]],63852:[[22622]],63853:[[30465]],63854:[[33865]],63855:[[35498]],63856:[[27578]],63857:[[36784]],63858:[[27784]],63859:[[25342]],63860:[[33509]],63861:[[25504]],63862:[[30053]],63863:[[20142]],63864:[[20841]],63865:[[20937]],63866:[[26753]],63867:[[31975]],63868:[[33391]],63869:[[35538]],63870:[[37327]],63871:[[21237]],63872:[[21570]],63873:[[22899]],63874:[[24300]],63875:[[26053]],63876:[[28670]],63877:[[31018]],63878:[[38317]],63879:[[39530]],63880:[[40599]],63881:[[40654]],63882:[[21147]],63883:[[26310]],63884:[[27511]],63885:[[36706]],63886:[[24180]],63887:[[24976]],63888:[[25088]],63889:[[25754]],63890:[[28451]],63891:[[29001]],63892:[[29833]],63893:[[31178]],63894:[[32244]],63895:[[32879]],63896:[[36646]],63897:[[34030]],63898:[[36899]],63899:[[37706]],63900:[[21015]],63901:[[21155]],63902:[[21693]],63903:[[28872]],63904:[[35010]],63905:[[35498]],63906:[[24265]],63907:[[24565]],63908:[[25467]],63909:[[27566]],63910:[[31806]],63911:[[29557]],63912:[[20196]],63913:[[22265]],63914:[[23527]],63915:[[23994]],63916:[[24604]],63917:[[29618]],63918:[[29801]],63919:[[32666]],63920:[[32838]],63921:[[37428]],63922:[[38646]],63923:[[38728]],63924:[[38936]],63925:[[20363]],63926:[[31150]],63927:[[37300]],63928:[[38584]],63929:[[24801]],63930:[[20102]],63931:[[20698]],63932:[[23534]],63933:[[23615]],63934:[[26009]],63935:[[27138]],63936:[[29134]],63937:[[30274]],63938:[[34044]],63939:[[36988]],63940:[[40845]],63941:[[26248]],63942:[[38446]],63943:[[21129]],63944:[[26491]],63945:[[26611]],63946:[[27969]],63947:[[28316]],63948:[[29705]],63949:[[30041]],63950:[[30827]],63951:[[32016]],63952:[[39006]],63953:[[20845]],63954:[[25134]],63955:[[38520]],63956:[[20523]],63957:[[23833]],63958:[[28138]],63959:[[36650]],63960:[[24459]],63961:[[24900]],63962:[[26647]],63963:[[29575]],63964:[[38534]],63965:[[21033]],63966:[[21519]],63967:[[23653]],63968:[[26131]],63969:[[26446]],63970:[[26792]],63971:[[27877]],63972:[[29702]],63973:[[30178]],63974:[[32633]],63975:[[35023]],63976:[[35041]],63977:[[37324]],63978:[[38626]],63979:[[21311]],63980:[[28346]],63981:[[21533]],63982:[[29136]],63983:[[29848]],63984:[[34298]],63985:[[38563]],63986:[[40023]],63987:[[40607]],63988:[[26519]],63989:[[28107]],63990:[[33256]],63991:[[31435]],63992:[[31520]],63993:[[31890]],63994:[[29376]],63995:[[28825]],63996:[[35672]],63997:[[20160]],63998:[[33590]],63999:[[21050]],194816:[[27966]],194817:[[28023]],194818:[[27969]],194819:[[28009]],194820:[[28024]],194821:[[28037]],194822:[[146718]],194823:[[27956]],194824:[[28207]],194825:[[28270]],194826:[[15667]],194827:[[28363]],194828:[[28359]],194829:[[147153]],194830:[[28153]],194831:[[28526]],194832:[[147294]],194833:[[147342]],194834:[[28614]],194835:[[28729]],194836:[[28702]],194837:[[28699]],194838:[[15766]],194839:[[28746]],194840:[[28797]],194841:[[28791]],194842:[[28845]],194843:[[132389]],194844:[[28997]],194845:[[148067]],194846:[[29084]],194847:[[148395]],194848:[[29224]],194849:[[29237]],194850:[[29264]],194851:[[149e3]],194852:[[29312]],194853:[[29333]],194854:[[149301]],194855:[[149524]],194856:[[29562]],194857:[[29579]],194858:[[16044]],194859:[[29605]],194860:[[16056]],194861:[[16056]],194862:[[29767]],194863:[[29788]],194864:[[29809]],194865:[[29829]],194866:[[29898]],194867:[[16155]],194868:[[29988]],194869:[[150582]],194870:[[30014]],194871:[[150674]],194872:[[30064]],194873:[[139679]],194874:[[30224]],194875:[[151457]],194876:[[151480]],194877:[[151620]],194878:[[16380]],194879:[[16392]],194880:[[30452]],194881:[[151795]],194882:[[151794]],194883:[[151833]],194884:[[151859]],194885:[[30494]],194886:[[30495]],194887:[[30495]],194888:[[30538]],194889:[[16441]],194890:[[30603]],194891:[[16454]],194892:[[16534]],194893:[[152605]],194894:[[30798]],194895:[[30860]],194896:[[30924]],194897:[[16611]],194898:[[153126]],194899:[[31062]],194900:[[153242]],194901:[[153285]],194902:[[31119]],194903:[[31211]],194904:[[16687]],194905:[[31296]],194906:[[31306]],194907:[[31311]],194908:[[153980]],194909:[[154279]],194910:[[154279]],194911:[[31470]],194912:[[16898]],194913:[[154539]],194914:[[31686]],194915:[[31689]],194916:[[16935]],194917:[[154752]],194918:[[31954]],194919:[[17056]],194920:[[31976]],194921:[[31971]],194922:[[32e3]],194923:[[155526]],194924:[[32099]],194925:[[17153]],194926:[[32199]],194927:[[32258]],194928:[[32325]],194929:[[17204]],194930:[[156200]],194931:[[156231]],194932:[[17241]],194933:[[156377]],194934:[[32634]],194935:[[156478]],194936:[[32661]],194937:[[32762]],194938:[[32773]],194939:[[156890]],194940:[[156963]],194941:[[32864]],194942:[[157096]],194943:[[32880]],194944:[[144223]],194945:[[17365]],194946:[[32946]],194947:[[33027]],194948:[[17419]],194949:[[33086]],194950:[[23221]],194951:[[157607]],194952:[[157621]],194953:[[144275]],194954:[[144284]],194955:[[33281]],194956:[[33284]],194957:[[36766]],194958:[[17515]],194959:[[33425]],194960:[[33419]],194961:[[33437]],194962:[[21171]],194963:[[33457]],194964:[[33459]],194965:[[33469]],194966:[[33510]],194967:[[158524]],194968:[[33509]],194969:[[33565]],194970:[[33635]],194971:[[33709]],194972:[[33571]],194973:[[33725]],194974:[[33767]],194975:[[33879]],194976:[[33619]],194977:[[33738]],194978:[[33740]],194979:[[33756]],194980:[[158774]],194981:[[159083]],194982:[[158933]],194983:[[17707]],194984:[[34033]],194985:[[34035]],194986:[[34070]],194987:[[160714]],194988:[[34148]],194989:[[159532]],194990:[[17757]],194991:[[17761]],194992:[[159665]],194993:[[159954]],194994:[[17771]],194995:[[34384]],194996:[[34396]],194997:[[34407]],194998:[[34409]],194999:[[34473]],195e3:[[34440]],195001:[[34574]],195002:[[34530]],195003:[[34681]],195004:[[34600]],195005:[[34667]],195006:[[34694]],195007:[[17879]],195008:[[34785]],195009:[[34817]],195010:[[17913]],195011:[[34912]],195012:[[34915]],195013:[[161383]],195014:[[35031]],195015:[[35038]],195016:[[17973]],195017:[[35066]],195018:[[13499]],195019:[[161966]],195020:[[162150]],195021:[[18110]],195022:[[18119]],195023:[[35488]],195024:[[35565]],195025:[[35722]],195026:[[35925]],195027:[[162984]],195028:[[36011]],195029:[[36033]],195030:[[36123]],195031:[[36215]],195032:[[163631]],195033:[[133124]],195034:[[36299]],195035:[[36284]],195036:[[36336]],195037:[[133342]],195038:[[36564]],195039:[[36664]],195040:[[165330]],195041:[[165357]],195042:[[37012]],195043:[[37105]],195044:[[37137]],195045:[[165678]],195046:[[37147]],195047:[[37432]],195048:[[37591]],195049:[[37592]],195050:[[37500]],195051:[[37881]],195052:[[37909]],195053:[[166906]],195054:[[38283]],195055:[[18837]],195056:[[38327]],195057:[[167287]],195058:[[18918]],195059:[[38595]],195060:[[23986]],195061:[[38691]],195062:[[168261]],195063:[[168474]],195064:[[19054]],195065:[[19062]],195066:[[38880]],195067:[[168970]],195068:[[19122]],195069:[[169110]],195070:[[38923]],195071:[[38923]]},64e3:{64e3:[[20999]],64001:[[24230]],64002:[[25299]],64003:[[31958]],64004:[[23429]],64005:[[27934]],64006:[[26292]],64007:[[36667]],64008:[[34892]],64009:[[38477]],64010:[[35211]],64011:[[24275]],64012:[[20800]],64013:[[21952]],64016:[[22618]],64018:[[26228]],64021:[[20958]],64022:[[29482]],64023:[[30410]],64024:[[31036]],64025:[[31070]],64026:[[31077]],64027:[[31119]],64028:[[38742]],64029:[[31934]],64030:[[32701]],64032:[[34322]],64034:[[35576]],64037:[[36920]],64038:[[37117]],64042:[[39151]],64043:[[39164]],64044:[[39208]],64045:[[40372]],64046:[[37086]],64047:[[38583]],64048:[[20398]],64049:[[20711]],64050:[[20813]],64051:[[21193]],64052:[[21220]],64053:[[21329]],64054:[[21917]],64055:[[22022]],64056:[[22120]],64057:[[22592]],64058:[[22696]],64059:[[23652]],64060:[[23662]],64061:[[24724]],64062:[[24936]],64063:[[24974]],64064:[[25074]],64065:[[25935]],64066:[[26082]],64067:[[26257]],64068:[[26757]],64069:[[28023]],64070:[[28186]],64071:[[28450]],64072:[[29038]],64073:[[29227]],64074:[[29730]],64075:[[30865]],64076:[[31038]],64077:[[31049]],64078:[[31048]],64079:[[31056]],64080:[[31062]],64081:[[31069]],64082:[[31117]],64083:[[31118]],64084:[[31296]],64085:[[31361]],64086:[[31680]],64087:[[32244]],64088:[[32265]],64089:[[32321]],64090:[[32626]],64091:[[32773]],64092:[[33261]],64093:[[33401]],64094:[[33401]],64095:[[33879]],64096:[[35088]],64097:[[35222]],64098:[[35585]],64099:[[35641]],64100:[[36051]],64101:[[36104]],64102:[[36790]],64103:[[36920]],64104:[[38627]],64105:[[38911]],64106:[[38971]],64107:[[24693]],64108:[[148206]],64109:[[33304]],64112:[[20006]],64113:[[20917]],64114:[[20840]],64115:[[20352]],64116:[[20805]],64117:[[20864]],64118:[[21191]],64119:[[21242]],64120:[[21917]],64121:[[21845]],64122:[[21913]],64123:[[21986]],64124:[[22618]],64125:[[22707]],64126:[[22852]],64127:[[22868]],64128:[[23138]],64129:[[23336]],64130:[[24274]],64131:[[24281]],64132:[[24425]],64133:[[24493]],64134:[[24792]],64135:[[24910]],64136:[[24840]],64137:[[24974]],64138:[[24928]],64139:[[25074]],64140:[[25140]],64141:[[25540]],64142:[[25628]],64143:[[25682]],64144:[[25942]],64145:[[26228]],64146:[[26391]],64147:[[26395]],64148:[[26454]],64149:[[27513]],64150:[[27578]],64151:[[27969]],64152:[[28379]],64153:[[28363]],64154:[[28450]],64155:[[28702]],64156:[[29038]],64157:[[30631]],64158:[[29237]],64159:[[29359]],64160:[[29482]],64161:[[29809]],64162:[[29958]],64163:[[30011]],64164:[[30237]],64165:[[30239]],64166:[[30410]],64167:[[30427]],64168:[[30452]],64169:[[30538]],64170:[[30528]],64171:[[30924]],64172:[[31409]],64173:[[31680]],64174:[[31867]],64175:[[32091]],64176:[[32244]],64177:[[32574]],64178:[[32773]],64179:[[33618]],64180:[[33775]],64181:[[34681]],64182:[[35137]],64183:[[35206]],64184:[[35222]],64185:[[35519]],64186:[[35576]],64187:[[35531]],64188:[[35585]],64189:[[35582]],64190:[[35565]],64191:[[35641]],64192:[[35722]],64193:[[36104]],64194:[[36664]],64195:[[36978]],64196:[[37273]],64197:[[37494]],64198:[[38524]],64199:[[38627]],64200:[[38742]],64201:[[38875]],64202:[[38911]],64203:[[38923]],64204:[[38971]],64205:[[39698]],64206:[[40860]],64207:[[141386]],64208:[[141380]],64209:[[144341]],64210:[[15261]],64211:[[16408]],64212:[[16441]],64213:[[152137]],64214:[[154832]],64215:[[163539]],64216:[[40771]],64217:[[40846]],195072:[[38953]],195073:[[169398]],195074:[[39138]],195075:[[19251]],195076:[[39209]],195077:[[39335]],195078:[[39362]],195079:[[39422]],195080:[[19406]],195081:[[170800]],195082:[[39698]],195083:[[4e4]],195084:[[40189]],195085:[[19662]],195086:[[19693]],195087:[[40295]],195088:[[172238]],195089:[[19704]],195090:[[172293]],195091:[[172558]],195092:[[172689]],195093:[[40635]],195094:[[19798]],195095:[[40697]],195096:[[40702]],195097:[[40709]],195098:[[40719]],195099:[[40726]],195100:[[40763]],195101:[[173568]]},64256:{64256:[[102,102],256],64257:[[102,105],256],64258:[[102,108],256],64259:[[102,102,105],256],64260:[[102,102,108],256],64261:[[383,116],256],64262:[[115,116],256],64275:[[1396,1398],256],64276:[[1396,1381],256],64277:[[1396,1387],256],64278:[[1406,1398],256],64279:[[1396,1389],256],64285:[[1497,1460],512],64286:[,26],64287:[[1522,1463],512],64288:[[1506],256],64289:[[1488],256],64290:[[1491],256],64291:[[1492],256],64292:[[1499],256],64293:[[1500],256],64294:[[1501],256],64295:[[1512],256],64296:[[1514],256],64297:[[43],256],64298:[[1513,1473],512],64299:[[1513,1474],512],64300:[[64329,1473],512],64301:[[64329,1474],512],64302:[[1488,1463],512],64303:[[1488,1464],512],64304:[[1488,1468],512],64305:[[1489,1468],512],64306:[[1490,1468],512],64307:[[1491,1468],512],64308:[[1492,1468],512],64309:[[1493,1468],512],64310:[[1494,1468],512],64312:[[1496,1468],512],64313:[[1497,1468],512],64314:[[1498,1468],512],64315:[[1499,1468],512],64316:[[1500,1468],512],64318:[[1502,1468],512],64320:[[1504,1468],512],64321:[[1505,1468],512],64323:[[1507,1468],512],64324:[[1508,1468],512],64326:[[1510,1468],512],64327:[[1511,1468],512],64328:[[1512,1468],512],64329:[[1513,1468],512],64330:[[1514,1468],512],64331:[[1493,1465],512],64332:[[1489,1471],512],64333:[[1499,1471],512],64334:[[1508,1471],512],64335:[[1488,1500],256],64336:[[1649],256],64337:[[1649],256],64338:[[1659],256],64339:[[1659],256],64340:[[1659],256],64341:[[1659],256],64342:[[1662],256],64343:[[1662],256],64344:[[1662],256],64345:[[1662],256],64346:[[1664],256],64347:[[1664],256],64348:[[1664],256],64349:[[1664],256],64350:[[1658],256],64351:[[1658],256],64352:[[1658],256],64353:[[1658],256],64354:[[1663],256],64355:[[1663],256],64356:[[1663],256],64357:[[1663],256],64358:[[1657],256],64359:[[1657],256],64360:[[1657],256],64361:[[1657],256],64362:[[1700],256],64363:[[1700],256],64364:[[1700],256],64365:[[1700],256],64366:[[1702],256],64367:[[1702],256],64368:[[1702],256],64369:[[1702],256],64370:[[1668],256],64371:[[1668],256],64372:[[1668],256],64373:[[1668],256],64374:[[1667],256],64375:[[1667],256],64376:[[1667],256],64377:[[1667],256],64378:[[1670],256],64379:[[1670],256],64380:[[1670],256],64381:[[1670],256],64382:[[1671],256],64383:[[1671],256],64384:[[1671],256],64385:[[1671],256],64386:[[1677],256],64387:[[1677],256],64388:[[1676],256],64389:[[1676],256],64390:[[1678],256],64391:[[1678],256],64392:[[1672],256],64393:[[1672],256],64394:[[1688],256],64395:[[1688],256],64396:[[1681],256],64397:[[1681],256],64398:[[1705],256],64399:[[1705],256],64400:[[1705],256],64401:[[1705],256],64402:[[1711],256],64403:[[1711],256],64404:[[1711],256],64405:[[1711],256],64406:[[1715],256],64407:[[1715],256],64408:[[1715],256],64409:[[1715],256],64410:[[1713],256],64411:[[1713],256],64412:[[1713],256],64413:[[1713],256],64414:[[1722],256],64415:[[1722],256],64416:[[1723],256],64417:[[1723],256],64418:[[1723],256],64419:[[1723],256],64420:[[1728],256],64421:[[1728],256],64422:[[1729],256],64423:[[1729],256],64424:[[1729],256],64425:[[1729],256],64426:[[1726],256],64427:[[1726],256],64428:[[1726],256],64429:[[1726],256],64430:[[1746],256],64431:[[1746],256],64432:[[1747],256],64433:[[1747],256],64467:[[1709],256],64468:[[1709],256],64469:[[1709],256],64470:[[1709],256],64471:[[1735],256],64472:[[1735],256],64473:[[1734],256],64474:[[1734],256],64475:[[1736],256],64476:[[1736],256],64477:[[1655],256],64478:[[1739],256],64479:[[1739],256],64480:[[1733],256],64481:[[1733],256],64482:[[1737],256],64483:[[1737],256],64484:[[1744],256],64485:[[1744],256],64486:[[1744],256],64487:[[1744],256],64488:[[1609],256],64489:[[1609],256],64490:[[1574,1575],256],64491:[[1574,1575],256],64492:[[1574,1749],256],64493:[[1574,1749],256],64494:[[1574,1608],256],64495:[[1574,1608],256],64496:[[1574,1735],256],64497:[[1574,1735],256],64498:[[1574,1734],256],64499:[[1574,1734],256],64500:[[1574,1736],256],64501:[[1574,1736],256],64502:[[1574,1744],256],64503:[[1574,1744],256],64504:[[1574,1744],256],64505:[[1574,1609],256],64506:[[1574,1609],256],64507:[[1574,1609],256],64508:[[1740],256],64509:[[1740],256],64510:[[1740],256],64511:[[1740],256]},64512:{64512:[[1574,1580],256],64513:[[1574,1581],256],64514:[[1574,1605],256],64515:[[1574,1609],256],64516:[[1574,1610],256],64517:[[1576,1580],256],64518:[[1576,1581],256],64519:[[1576,1582],256],64520:[[1576,1605],256],64521:[[1576,1609],256],64522:[[1576,1610],256],64523:[[1578,1580],256],64524:[[1578,1581],256],64525:[[1578,1582],256],64526:[[1578,1605],256],64527:[[1578,1609],256],64528:[[1578,1610],256],64529:[[1579,1580],256],64530:[[1579,1605],256],64531:[[1579,1609],256],64532:[[1579,1610],256],64533:[[1580,1581],256],64534:[[1580,1605],256],64535:[[1581,1580],256],64536:[[1581,1605],256],64537:[[1582,1580],256],64538:[[1582,1581],256],64539:[[1582,1605],256],64540:[[1587,1580],256],64541:[[1587,1581],256],64542:[[1587,1582],256],64543:[[1587,1605],256],64544:[[1589,1581],256],64545:[[1589,1605],256],64546:[[1590,1580],256],64547:[[1590,1581],256],64548:[[1590,1582],256],64549:[[1590,1605],256],64550:[[1591,1581],256],64551:[[1591,1605],256],64552:[[1592,1605],256],64553:[[1593,1580],256],64554:[[1593,1605],256],64555:[[1594,1580],256],64556:[[1594,1605],256],64557:[[1601,1580],256],64558:[[1601,1581],256],64559:[[1601,1582],256],64560:[[1601,1605],256],64561:[[1601,1609],256],64562:[[1601,1610],256],64563:[[1602,1581],256],64564:[[1602,1605],256],64565:[[1602,1609],256],64566:[[1602,1610],256],64567:[[1603,1575],256],64568:[[1603,1580],256],64569:[[1603,1581],256],64570:[[1603,1582],256],64571:[[1603,1604],256],64572:[[1603,1605],256],64573:[[1603,1609],256],64574:[[1603,1610],256],64575:[[1604,1580],256],64576:[[1604,1581],256],64577:[[1604,1582],256],64578:[[1604,1605],256],64579:[[1604,1609],256],64580:[[1604,1610],256],64581:[[1605,1580],256],64582:[[1605,1581],256],64583:[[1605,1582],256],64584:[[1605,1605],256],64585:[[1605,1609],256],64586:[[1605,1610],256],64587:[[1606,1580],256],64588:[[1606,1581],256],64589:[[1606,1582],256],64590:[[1606,1605],256],64591:[[1606,1609],256],64592:[[1606,1610],256],64593:[[1607,1580],256],64594:[[1607,1605],256],64595:[[1607,1609],256],64596:[[1607,1610],256],64597:[[1610,1580],256],64598:[[1610,1581],256],64599:[[1610,1582],256],64600:[[1610,1605],256],64601:[[1610,1609],256],64602:[[1610,1610],256],64603:[[1584,1648],256],64604:[[1585,1648],256],64605:[[1609,1648],256],64606:[[32,1612,1617],256],64607:[[32,1613,1617],256],64608:[[32,1614,1617],256],64609:[[32,1615,1617],256],64610:[[32,1616,1617],256],64611:[[32,1617,1648],256],64612:[[1574,1585],256],64613:[[1574,1586],256],64614:[[1574,1605],256],64615:[[1574,1606],256],64616:[[1574,1609],256],64617:[[1574,1610],256],64618:[[1576,1585],256],64619:[[1576,1586],256],64620:[[1576,1605],256],64621:[[1576,1606],256],64622:[[1576,1609],256],64623:[[1576,1610],256],64624:[[1578,1585],256],64625:[[1578,1586],256],64626:[[1578,1605],256],64627:[[1578,1606],256],64628:[[1578,1609],256],64629:[[1578,1610],256],64630:[[1579,1585],256],64631:[[1579,1586],256],64632:[[1579,1605],256],64633:[[1579,1606],256],64634:[[1579,1609],256],64635:[[1579,1610],256],64636:[[1601,1609],256],64637:[[1601,1610],256],64638:[[1602,1609],256],64639:[[1602,1610],256],64640:[[1603,1575],256],64641:[[1603,1604],256],64642:[[1603,1605],256],64643:[[1603,1609],256],64644:[[1603,1610],256],64645:[[1604,1605],256],64646:[[1604,1609],256],64647:[[1604,1610],256],64648:[[1605,1575],256],64649:[[1605,1605],256],64650:[[1606,1585],256],64651:[[1606,1586],256],64652:[[1606,1605],256],64653:[[1606,1606],256],64654:[[1606,1609],256],64655:[[1606,1610],256],64656:[[1609,1648],256],64657:[[1610,1585],256],64658:[[1610,1586],256],64659:[[1610,1605],256],64660:[[1610,1606],256],64661:[[1610,1609],256],64662:[[1610,1610],256],64663:[[1574,1580],256],64664:[[1574,1581],256],64665:[[1574,1582],256],64666:[[1574,1605],256],64667:[[1574,1607],256],64668:[[1576,1580],256],64669:[[1576,1581],256],64670:[[1576,1582],256],64671:[[1576,1605],256],64672:[[1576,1607],256],64673:[[1578,1580],256],64674:[[1578,1581],256],64675:[[1578,1582],256],64676:[[1578,1605],256],64677:[[1578,1607],256],64678:[[1579,1605],256],64679:[[1580,1581],256],64680:[[1580,1605],256],64681:[[1581,1580],256],64682:[[1581,1605],256],64683:[[1582,1580],256],64684:[[1582,1605],256],64685:[[1587,1580],256],64686:[[1587,1581],256],64687:[[1587,1582],256],64688:[[1587,1605],256],64689:[[1589,1581],256],64690:[[1589,1582],256],64691:[[1589,1605],256],64692:[[1590,1580],256],64693:[[1590,1581],256],64694:[[1590,1582],256],64695:[[1590,1605],256],64696:[[1591,1581],256],64697:[[1592,1605],256],64698:[[1593,1580],256],64699:[[1593,1605],256],64700:[[1594,1580],256],64701:[[1594,1605],256],64702:[[1601,1580],256],64703:[[1601,1581],256],64704:[[1601,1582],256],64705:[[1601,1605],256],64706:[[1602,1581],256],64707:[[1602,1605],256],64708:[[1603,1580],256],64709:[[1603,1581],256],64710:[[1603,1582],256],64711:[[1603,1604],256],64712:[[1603,1605],256],64713:[[1604,1580],256],64714:[[1604,1581],256],64715:[[1604,1582],256],64716:[[1604,1605],256],64717:[[1604,1607],256],64718:[[1605,1580],256],64719:[[1605,1581],256],64720:[[1605,1582],256],64721:[[1605,1605],256],64722:[[1606,1580],256],64723:[[1606,1581],256],64724:[[1606,1582],256],64725:[[1606,1605],256],64726:[[1606,1607],256],64727:[[1607,1580],256],64728:[[1607,1605],256],64729:[[1607,1648],256],64730:[[1610,1580],256],64731:[[1610,1581],256],64732:[[1610,1582],256],64733:[[1610,1605],256],64734:[[1610,1607],256],64735:[[1574,1605],256],64736:[[1574,1607],256],64737:[[1576,1605],256],64738:[[1576,1607],256],64739:[[1578,1605],256],64740:[[1578,1607],256],64741:[[1579,1605],256],64742:[[1579,1607],256],64743:[[1587,1605],256],64744:[[1587,1607],256],64745:[[1588,1605],256],64746:[[1588,1607],256],64747:[[1603,1604],256],64748:[[1603,1605],256],64749:[[1604,1605],256],64750:[[1606,1605],256],64751:[[1606,1607],256],64752:[[1610,1605],256],64753:[[1610,1607],256],64754:[[1600,1614,1617],256],64755:[[1600,1615,1617],256],64756:[[1600,1616,1617],256],64757:[[1591,1609],256],64758:[[1591,1610],256],64759:[[1593,1609],256],64760:[[1593,1610],256],64761:[[1594,1609],256],64762:[[1594,1610],256],64763:[[1587,1609],256],64764:[[1587,1610],256],64765:[[1588,1609],256],64766:[[1588,1610],256],64767:[[1581,1609],256]},64768:{64768:[[1581,1610],256],64769:[[1580,1609],256],64770:[[1580,1610],256],64771:[[1582,1609],256],64772:[[1582,1610],256],64773:[[1589,1609],256],64774:[[1589,1610],256],64775:[[1590,1609],256],64776:[[1590,1610],256],64777:[[1588,1580],256],64778:[[1588,1581],256],64779:[[1588,1582],256],64780:[[1588,1605],256],64781:[[1588,1585],256],64782:[[1587,1585],256],64783:[[1589,1585],256],64784:[[1590,1585],256],64785:[[1591,1609],256],64786:[[1591,1610],256],64787:[[1593,1609],256],64788:[[1593,1610],256],64789:[[1594,1609],256],64790:[[1594,1610],256],64791:[[1587,1609],256],64792:[[1587,1610],256],64793:[[1588,1609],256],64794:[[1588,1610],256],64795:[[1581,1609],256],64796:[[1581,1610],256],64797:[[1580,1609],256],64798:[[1580,1610],256],64799:[[1582,1609],256],64800:[[1582,1610],256],64801:[[1589,1609],256],64802:[[1589,1610],256],64803:[[1590,1609],256],64804:[[1590,1610],256],64805:[[1588,1580],256],64806:[[1588,1581],256],64807:[[1588,1582],256],64808:[[1588,1605],256],64809:[[1588,1585],256],64810:[[1587,1585],256],64811:[[1589,1585],256],64812:[[1590,1585],256],64813:[[1588,1580],256],64814:[[1588,1581],256],64815:[[1588,1582],256],64816:[[1588,1605],256],64817:[[1587,1607],256],64818:[[1588,1607],256],64819:[[1591,1605],256],64820:[[1587,1580],256],64821:[[1587,1581],256],64822:[[1587,1582],256],64823:[[1588,1580],256],64824:[[1588,1581],256],64825:[[1588,1582],256],64826:[[1591,1605],256],64827:[[1592,1605],256],64828:[[1575,1611],256],64829:[[1575,1611],256],64848:[[1578,1580,1605],256],64849:[[1578,1581,1580],256],64850:[[1578,1581,1580],256],64851:[[1578,1581,1605],256],64852:[[1578,1582,1605],256],64853:[[1578,1605,1580],256],64854:[[1578,1605,1581],256],64855:[[1578,1605,1582],256],64856:[[1580,1605,1581],256],64857:[[1580,1605,1581],256],64858:[[1581,1605,1610],256],64859:[[1581,1605,1609],256],64860:[[1587,1581,1580],256],64861:[[1587,1580,1581],256],64862:[[1587,1580,1609],256],64863:[[1587,1605,1581],256],64864:[[1587,1605,1581],256],64865:[[1587,1605,1580],256],64866:[[1587,1605,1605],256],64867:[[1587,1605,1605],256],64868:[[1589,1581,1581],256],64869:[[1589,1581,1581],256],64870:[[1589,1605,1605],256],64871:[[1588,1581,1605],256],64872:[[1588,1581,1605],256],64873:[[1588,1580,1610],256],64874:[[1588,1605,1582],256],64875:[[1588,1605,1582],256],64876:[[1588,1605,1605],256],64877:[[1588,1605,1605],256],64878:[[1590,1581,1609],256],64879:[[1590,1582,1605],256],64880:[[1590,1582,1605],256],64881:[[1591,1605,1581],256],64882:[[1591,1605,1581],256],64883:[[1591,1605,1605],256],64884:[[1591,1605,1610],256],64885:[[1593,1580,1605],256],64886:[[1593,1605,1605],256],64887:[[1593,1605,1605],256],64888:[[1593,1605,1609],256],64889:[[1594,1605,1605],256],64890:[[1594,1605,1610],256],64891:[[1594,1605,1609],256],64892:[[1601,1582,1605],256],64893:[[1601,1582,1605],256],64894:[[1602,1605,1581],256],64895:[[1602,1605,1605],256],64896:[[1604,1581,1605],256],64897:[[1604,1581,1610],256],64898:[[1604,1581,1609],256],64899:[[1604,1580,1580],256],64900:[[1604,1580,1580],256],64901:[[1604,1582,1605],256],64902:[[1604,1582,1605],256],64903:[[1604,1605,1581],256],64904:[[1604,1605,1581],256],64905:[[1605,1581,1580],256],64906:[[1605,1581,1605],256],64907:[[1605,1581,1610],256],64908:[[1605,1580,1581],256],64909:[[1605,1580,1605],256],64910:[[1605,1582,1580],256],64911:[[1605,1582,1605],256],64914:[[1605,1580,1582],256],64915:[[1607,1605,1580],256],64916:[[1607,1605,1605],256],64917:[[1606,1581,1605],256],64918:[[1606,1581,1609],256],64919:[[1606,1580,1605],256],64920:[[1606,1580,1605],256],64921:[[1606,1580,1609],256],64922:[[1606,1605,1610],256],64923:[[1606,1605,1609],256],64924:[[1610,1605,1605],256],64925:[[1610,1605,1605],256],64926:[[1576,1582,1610],256],64927:[[1578,1580,1610],256],64928:[[1578,1580,1609],256],64929:[[1578,1582,1610],256],64930:[[1578,1582,1609],256],64931:[[1578,1605,1610],256],64932:[[1578,1605,1609],256],64933:[[1580,1605,1610],256],64934:[[1580,1581,1609],256],64935:[[1580,1605,1609],256],64936:[[1587,1582,1609],256],64937:[[1589,1581,1610],256],64938:[[1588,1581,1610],256],64939:[[1590,1581,1610],256],64940:[[1604,1580,1610],256],64941:[[1604,1605,1610],256],64942:[[1610,1581,1610],256],64943:[[1610,1580,1610],256],64944:[[1610,1605,1610],256],64945:[[1605,1605,1610],256],64946:[[1602,1605,1610],256],64947:[[1606,1581,1610],256],64948:[[1602,1605,1581],256],64949:[[1604,1581,1605],256],64950:[[1593,1605,1610],256],64951:[[1603,1605,1610],256],64952:[[1606,1580,1581],256],64953:[[1605,1582,1610],256],64954:[[1604,1580,1605],256],64955:[[1603,1605,1605],256],64956:[[1604,1580,1605],256],64957:[[1606,1580,1581],256],64958:[[1580,1581,1610],256],64959:[[1581,1580,1610],256],64960:[[1605,1580,1610],256],64961:[[1601,1605,1610],256],64962:[[1576,1581,1610],256],64963:[[1603,1605,1605],256],64964:[[1593,1580,1605],256],64965:[[1589,1605,1605],256],64966:[[1587,1582,1610],256],64967:[[1606,1580,1610],256],65008:[[1589,1604,1746],256],65009:[[1602,1604,1746],256],65010:[[1575,1604,1604,1607],256],65011:[[1575,1603,1576,1585],256],65012:[[1605,1581,1605,1583],256],65013:[[1589,1604,1593,1605],256],65014:[[1585,1587,1608,1604],256],65015:[[1593,1604,1610,1607],256],65016:[[1608,1587,1604,1605],256],65017:[[1589,1604,1609],256],65018:[[1589,1604,1609,32,1575,1604,1604,1607,32,1593,1604,1610,1607,32,1608,1587,1604,1605],256],65019:[[1580,1604,32,1580,1604,1575,1604,1607],256],65020:[[1585,1740,1575,1604],256]},65024:{65040:[[44],256],65041:[[12289],256],65042:[[12290],256],65043:[[58],256],65044:[[59],256],65045:[[33],256],65046:[[63],256],65047:[[12310],256],65048:[[12311],256],65049:[[8230],256],65056:[,230],65057:[,230],65058:[,230],65059:[,230],65060:[,230],65061:[,230],65062:[,230],65063:[,220],65064:[,220],65065:[,220],65066:[,220],65067:[,220],65068:[,220],65069:[,220],65072:[[8229],256],65073:[[8212],256],65074:[[8211],256],65075:[[95],256],65076:[[95],256],65077:[[40],256],65078:[[41],256],65079:[[123],256],65080:[[125],256],65081:[[12308],256],65082:[[12309],256],65083:[[12304],256],65084:[[12305],256],65085:[[12298],256],65086:[[12299],256],65087:[[12296],256],65088:[[12297],256],65089:[[12300],256],65090:[[12301],256],65091:[[12302],256],65092:[[12303],256],65095:[[91],256],65096:[[93],256],65097:[[8254],256],65098:[[8254],256],65099:[[8254],256],65100:[[8254],256],65101:[[95],256],65102:[[95],256],65103:[[95],256],65104:[[44],256],65105:[[12289],256],65106:[[46],256],65108:[[59],256],65109:[[58],256],65110:[[63],256],65111:[[33],256],65112:[[8212],256],65113:[[40],256],65114:[[41],256],65115:[[123],256],65116:[[125],256],65117:[[12308],256],65118:[[12309],256],65119:[[35],256],65120:[[38],256],65121:[[42],256],65122:[[43],256],65123:[[45],256],65124:[[60],256],65125:[[62],256],65126:[[61],256],65128:[[92],256],65129:[[36],256],65130:[[37],256],65131:[[64],256],65136:[[32,1611],256],65137:[[1600,1611],256],65138:[[32,1612],256],65140:[[32,1613],256],65142:[[32,1614],256],65143:[[1600,1614],256],65144:[[32,1615],256],65145:[[1600,1615],256],65146:[[32,1616],256],65147:[[1600,1616],256],65148:[[32,1617],256],65149:[[1600,1617],256],65150:[[32,1618],256],65151:[[1600,1618],256],65152:[[1569],256],65153:[[1570],256],65154:[[1570],256],65155:[[1571],256],65156:[[1571],256],65157:[[1572],256],65158:[[1572],256],65159:[[1573],256],65160:[[1573],256],65161:[[1574],256],65162:[[1574],256],65163:[[1574],256],65164:[[1574],256],65165:[[1575],256],65166:[[1575],256],65167:[[1576],256],65168:[[1576],256],65169:[[1576],256],65170:[[1576],256],65171:[[1577],256],65172:[[1577],256],65173:[[1578],256],65174:[[1578],256],65175:[[1578],256],65176:[[1578],256],65177:[[1579],256],65178:[[1579],256],65179:[[1579],256],65180:[[1579],256],65181:[[1580],256],65182:[[1580],256],65183:[[1580],256],65184:[[1580],256],65185:[[1581],256],65186:[[1581],256],65187:[[1581],256],65188:[[1581],256],65189:[[1582],256],65190:[[1582],256],65191:[[1582],256],65192:[[1582],256],65193:[[1583],256],65194:[[1583],256],65195:[[1584],256],65196:[[1584],256],65197:[[1585],256],65198:[[1585],256],65199:[[1586],256],65200:[[1586],256],65201:[[1587],256],65202:[[1587],256],65203:[[1587],256],65204:[[1587],256],65205:[[1588],256],65206:[[1588],256],65207:[[1588],256],65208:[[1588],256],65209:[[1589],256],65210:[[1589],256],65211:[[1589],256],65212:[[1589],256],65213:[[1590],256],65214:[[1590],256],65215:[[1590],256],65216:[[1590],256],65217:[[1591],256],65218:[[1591],256],65219:[[1591],256],65220:[[1591],256],65221:[[1592],256],65222:[[1592],256],65223:[[1592],256],65224:[[1592],256],65225:[[1593],256],65226:[[1593],256],65227:[[1593],256],65228:[[1593],256],65229:[[1594],256],65230:[[1594],256],65231:[[1594],256],65232:[[1594],256],65233:[[1601],256],65234:[[1601],256],65235:[[1601],256],65236:[[1601],256],65237:[[1602],256],65238:[[1602],256],65239:[[1602],256],65240:[[1602],256],65241:[[1603],256],65242:[[1603],256],65243:[[1603],256],65244:[[1603],256],65245:[[1604],256],65246:[[1604],256],65247:[[1604],256],65248:[[1604],256],65249:[[1605],256],65250:[[1605],256],65251:[[1605],256],65252:[[1605],256],65253:[[1606],256],65254:[[1606],256],65255:[[1606],256],65256:[[1606],256],65257:[[1607],256],65258:[[1607],256],65259:[[1607],256],65260:[[1607],256],65261:[[1608],256],65262:[[1608],256],65263:[[1609],256],65264:[[1609],256],65265:[[1610],256],65266:[[1610],256],65267:[[1610],256],65268:[[1610],256],65269:[[1604,1570],256],65270:[[1604,1570],256],65271:[[1604,1571],256],65272:[[1604,1571],256],65273:[[1604,1573],256],65274:[[1604,1573],256],65275:[[1604,1575],256],65276:[[1604,1575],256]},65280:{65281:[[33],256],65282:[[34],256],65283:[[35],256],65284:[[36],256],65285:[[37],256],65286:[[38],256],65287:[[39],256],65288:[[40],256],65289:[[41],256],65290:[[42],256],65291:[[43],256],65292:[[44],256],65293:[[45],256],65294:[[46],256],65295:[[47],256],65296:[[48],256],65297:[[49],256],65298:[[50],256],65299:[[51],256],65300:[[52],256],65301:[[53],256],65302:[[54],256],65303:[[55],256],65304:[[56],256],65305:[[57],256],65306:[[58],256],65307:[[59],256],65308:[[60],256],65309:[[61],256],65310:[[62],256],65311:[[63],256],65312:[[64],256],65313:[[65],256],65314:[[66],256],65315:[[67],256],65316:[[68],256],65317:[[69],256],65318:[[70],256],65319:[[71],256],65320:[[72],256],65321:[[73],256],65322:[[74],256],65323:[[75],256],65324:[[76],256],65325:[[77],256],65326:[[78],256],65327:[[79],256],65328:[[80],256],65329:[[81],256],65330:[[82],256],65331:[[83],256],65332:[[84],256],65333:[[85],256],65334:[[86],256],65335:[[87],256],65336:[[88],256],65337:[[89],256],65338:[[90],256],65339:[[91],256],65340:[[92],256],65341:[[93],256],65342:[[94],256],65343:[[95],256],65344:[[96],256],65345:[[97],256],65346:[[98],256],65347:[[99],256],65348:[[100],256],65349:[[101],256],65350:[[102],256],65351:[[103],256],65352:[[104],256],65353:[[105],256],65354:[[106],256],65355:[[107],256],65356:[[108],256],65357:[[109],256],65358:[[110],256],65359:[[111],256],65360:[[112],256],65361:[[113],256],65362:[[114],256],65363:[[115],256],65364:[[116],256],65365:[[117],256],65366:[[118],256],65367:[[119],256],65368:[[120],256],65369:[[121],256],65370:[[122],256],65371:[[123],256],65372:[[124],256],65373:[[125],256],65374:[[126],256],65375:[[10629],256],65376:[[10630],256],65377:[[12290],256],65378:[[12300],256],65379:[[12301],256],65380:[[12289],256],65381:[[12539],256],65382:[[12530],256],65383:[[12449],256],65384:[[12451],256],65385:[[12453],256],65386:[[12455],256],65387:[[12457],256],65388:[[12515],256],65389:[[12517],256],65390:[[12519],256],65391:[[12483],256],65392:[[12540],256],65393:[[12450],256],65394:[[12452],256],65395:[[12454],256],65396:[[12456],256],65397:[[12458],256],65398:[[12459],256],65399:[[12461],256],65400:[[12463],256],65401:[[12465],256],65402:[[12467],256],65403:[[12469],256],65404:[[12471],256],65405:[[12473],256],65406:[[12475],256],65407:[[12477],256],65408:[[12479],256],65409:[[12481],256],65410:[[12484],256],65411:[[12486],256],65412:[[12488],256],65413:[[12490],256],65414:[[12491],256],65415:[[12492],256],65416:[[12493],256],65417:[[12494],256],65418:[[12495],256],65419:[[12498],256],65420:[[12501],256],65421:[[12504],256],65422:[[12507],256],65423:[[12510],256],65424:[[12511],256],65425:[[12512],256],65426:[[12513],256],65427:[[12514],256],65428:[[12516],256],65429:[[12518],256],65430:[[12520],256],65431:[[12521],256],65432:[[12522],256],65433:[[12523],256],65434:[[12524],256],65435:[[12525],256],65436:[[12527],256],65437:[[12531],256],65438:[[12441],256],65439:[[12442],256],65440:[[12644],256],65441:[[12593],256],65442:[[12594],256],65443:[[12595],256],65444:[[12596],256],65445:[[12597],256],65446:[[12598],256],65447:[[12599],256],65448:[[12600],256],65449:[[12601],256],65450:[[12602],256],65451:[[12603],256],65452:[[12604],256],65453:[[12605],256],65454:[[12606],256],65455:[[12607],256],65456:[[12608],256],65457:[[12609],256],65458:[[12610],256],65459:[[12611],256],65460:[[12612],256],65461:[[12613],256],65462:[[12614],256],65463:[[12615],256],65464:[[12616],256],65465:[[12617],256],65466:[[12618],256],65467:[[12619],256],65468:[[12620],256],65469:[[12621],256],65470:[[12622],256],65474:[[12623],256],65475:[[12624],256],65476:[[12625],256],65477:[[12626],256],65478:[[12627],256],65479:[[12628],256],65482:[[12629],256],65483:[[12630],256],65484:[[12631],256],65485:[[12632],256],65486:[[12633],256],65487:[[12634],256],65490:[[12635],256],65491:[[12636],256],65492:[[12637],256],65493:[[12638],256],65494:[[12639],256],65495:[[12640],256],65498:[[12641],256],65499:[[12642],256],65500:[[12643],256],65504:[[162],256],65505:[[163],256],65506:[[172],256],65507:[[175],256],65508:[[166],256],65509:[[165],256],65510:[[8361],256],65512:[[9474],256],65513:[[8592],256],65514:[[8593],256],65515:[[8594],256],65516:[[8595],256],65517:[[9632],256],65518:[[9675],256]}},S={nfc:D,nfd:L,nfkc:P,nfkd:N},(n.unorm=S).shimApplied=!1,String.prototype.normalize||(Object.defineProperty(String.prototype,"normalize",{enumerable:!1,configurable:!0,writable:!0,value:function(e){var t=""+this;if("NFC"===(e=void 0===e?"NFC":e))return S.nfc(t);if("NFD"===e)return S.nfd(t);if("NFKC"===e)return S.nfkc(t);if("NFKD"===e)return S.nfkd(t);throw new RangeError("Invalid normalization form: "+e)}}),S.shimApplied=!0),t.root=n,t.DEFAULT_FEATURE=r,t.CACHE_THRESHOLD=o,t.SBase=s,t.LBase=l,t.VBase=c,t.TBase=d,t.LCount=u,t.VCount=h,t.TCount=p,t.NCount=f,t.SCount=m,t.UChar=g,t.cache=a,t.cacheCounter=y,t.i=i,t.strategies=v,t.UCharIterator=b,t.RecursDecompIterator=w,t.DecompIterator=x,t.CompIterator=C,t.createIterator=M,t.normalize=F,t.unorm=S,e()}),$__System.registerDynamic("11",["60"],!0,function(n,e,t){"use strict";this||self;for(var i=/^[\s\u200b]+$/,r=function(e){return null==e||""===e||"​"===e},o=function(e,t,n){return null==e||""==e?"":("string"!=typeof e&&"number"!=typeof e||(e=(e+"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;"),t&&(e=a(e))),e)},a=function(e){return e.replace(/[[\]~`*\\$<]/g,"\\$&").replace(/(\b_)|(_(?=\s))/g,"\\$&")},s=/^\s*(([\w-_]+:\/\/)|(www\.)|\w*\/)[\w-.\/?%&=:@]*/i,l=/^\s*(([\w-_]+:\/\/)|(www\.)|\w*\/)?[\w-.\/?%&=:@]+(\.jpe?g|png|gif|webp|svg|tiff)/i,c=function(e,t,n){return e.replace(new RegExp("\\b"+t+"\\b","gi"),n)},d=function(e,t){var n=e.getHours()+"",i=e.getMinutes()+"",e=e.getSeconds()+"";return(n.length<2?"0":"")+n+":"+(i.length<2?"0":"")+i+(t?(e.length<2?"0":"")+e:"")},u=function(e,t,n){if(!e)return t;t=t||"";var i=e.split(/[\\\/]/g),r=t.split(/[\\\/]/g);n||i.pop();for(var o=0;o<r.length;o++)"."!=r[o]&&(".."==r[o]?i.pop():i.push(r[o]));return i.join("/")},h=function(e){return e.replace(/[\-\\\{\}\*\+\?\|\^\$\.\[\]\(\)\#]/g,"\\$&")},p=(String.prototype.replaceExact=function(e,t){return c(this,e,t)},String.prototype.repeat=function(e){return(!$.isNumeric(e)||e<0)&&(e=0),new Array(+e+1).join(this)},String.prototype.startsWith=String.prototype.startsWith||function(e){return this.match("^"+e)===e},String.prototype.endsWith=String.prototype.endsWith||function(e){return this.match(e+"$")===e},String.prototype.format=function(){var t=arguments;return this.replace(/\{\d+\}/g,function(e){return t[e.match(/\d+/)]})},String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")},[{base:"A",letters:"AⒶＡÀÁÂẦẤẪẨÃĀĂẰẮẴẲȦǠÄǞẢÅǺǍȀȂẠẬẶḀĄȺⱯ"},{base:"AA",letters:"Ꜳ"},{base:"AE",letters:"ÆǼǢ"},{base:"AO",letters:"Ꜵ"},{base:"AU",letters:"Ꜷ"},{base:"AV",letters:"ꜸꜺ"},{base:"AY",letters:"Ꜽ"},{base:"B",letters:"BⒷＢḂḄḆɃƂƁ"},{base:"C",letters:"CⒸＣĆĈĊČÇḈƇȻꜾ"},{base:"D",letters:"DⒹＤḊĎḌḐḒḎĐƋƊƉꝹ"},{base:"DZ",letters:"ǱǄ"},{base:"Dz",letters:"ǲǅ"},{base:"E",letters:"EⒺＥÈÉÊỀẾỄỂẼĒḔḖĔĖËẺĚȄȆẸỆȨḜĘḘḚƐƎ"},{base:"F",letters:"FⒻＦḞƑꝻ"},{base:"G",letters:"GⒼＧǴĜḠĞĠǦĢǤƓꞠꝽꝾ"},{base:"H",letters:"HⒽＨĤḢḦȞḤḨḪĦⱧⱵꞍ"},{base:"I",letters:"IⒾＩÌÍÎĨĪĬİÏḮỈǏȈȊỊĮḬƗ"},{base:"J",letters:"JⒿＪĴɈ"},{base:"K",letters:"KⓀＫḰǨḲĶḴƘⱩꝀꝂꝄꞢ"},{base:"L",letters:"LⓁＬĿĹĽḶḸĻḼḺŁȽⱢⱠꝈꝆꞀ"},{base:"LJ",letters:"Ǉ"},{base:"Lj",letters:"ǈ"},{base:"M",letters:"MⓂＭḾṀṂⱮƜ"},{base:"N",letters:"NⓃＮǸŃÑṄŇṆŅṊṈȠƝꞐꞤ"},{base:"NJ",letters:"Ǌ"},{base:"Nj",letters:"ǋ"},{base:"O",letters:"OⓄＯÒÓÔỒỐỖỔÕṌȬṎŌṐṒŎȮȰÖȪỎŐǑȌȎƠỜỚỠỞỢỌỘǪǬØǾƆƟꝊꝌ"},{base:"OI",letters:"Ƣ"},{base:"OO",letters:"Ꝏ"},{base:"OU",letters:"Ȣ"},{base:"OE",letters:"Œ"},{base:"oe",letters:"œ"},{base:"P",letters:"PⓅＰṔṖƤⱣꝐꝒꝔ"},{base:"Q",letters:"QⓆＱꝖꝘɊ"},{base:"R",letters:"RⓇＲŔṘŘȐȒṚṜŖṞɌⱤꝚꞦꞂ"},{base:"S",letters:"SⓈＳẞŚṤŜṠŠṦṢṨȘŞⱾꞨꞄ"},{base:"T",letters:"TⓉＴṪŤṬȚŢṰṮŦƬƮȾꞆ"},{base:"TZ",letters:"Ꜩ"},{base:"U",letters:"UⓊＵÙÚÛŨṸŪṺŬÜǛǗǕǙỦŮŰǓȔȖƯỪỨỮỬỰỤṲŲṶṴɄ"},{base:"V",letters:"VⓋＶṼṾƲꝞɅ"},{base:"VY",letters:"Ꝡ"},{base:"W",letters:"WⓌＷẀẂŴẆẄẈⱲ"},{base:"X",letters:"XⓍＸẊẌ"},{base:"Y",letters:"YⓎＹỲÝŶỸȲẎŸỶỴƳɎỾ"},{base:"Z",letters:"ZⓏＺŹẐŻŽẒẔƵȤⱿⱫꝢ"},{base:"a",letters:"aⓐａẚàáâầấẫẩãāăằắẵẳȧǡäǟảåǻǎȁȃạậặḁąⱥɐ"},{base:"aa",letters:"ꜳ"},{base:"ae",letters:"æǽǣ"},{base:"ao",letters:"ꜵ"},{base:"au",letters:"ꜷ"},{base:"av",letters:"ꜹꜻ"},{base:"ay",letters:"ꜽ"},{base:"b",letters:"bⓑｂḃḅḇƀƃɓ"},{base:"c",letters:"cⓒｃćĉċčçḉƈȼꜿↄ"},{base:"d",letters:"dⓓｄḋďḍḑḓḏđƌɖɗꝺ"},{base:"dz",letters:"ǳǆ"},{base:"e",letters:"eⓔｅèéêềếễểẽēḕḗĕėëẻěȅȇẹệȩḝęḙḛɇɛǝ"},{base:"f",letters:"fⓕｆḟƒꝼ"},{base:"g",letters:"gⓖｇǵĝḡğġǧģǥɠꞡᵹꝿ"},{base:"h",letters:"hⓗｈĥḣḧȟḥḩḫẖħⱨⱶɥ"},{base:"hv",letters:"ƕ"},{base:"i",letters:"iⓘｉìíîĩīĭïḯỉǐȉȋịįḭɨı"},{base:"j",letters:"jⓙｊĵǰɉ"},{base:"k",letters:"kⓚｋḱǩḳķḵƙⱪꝁꝃꝅꞣ"},{base:"l",letters:"lⓛｌŀĺľḷḹļḽḻſłƚɫⱡꝉꞁꝇ"},{base:"lj",letters:"ǉ"},{base:"m",letters:"mⓜｍḿṁṃɱɯ"},{base:"n",letters:"nⓝｎǹńñṅňṇņṋṉƞɲŉꞑꞥ"},{base:"nj",letters:"ǌ"},{base:"o",letters:"oⓞｏòóôồốỗổõṍȭṏōṑṓŏȯȱöȫỏőǒȍȏơờớỡởợọộǫǭøǿɔꝋꝍɵ"},{base:"oi",letters:"ƣ"},{base:"ou",letters:"ȣ"},{base:"oo",letters:"ꝏ"},{base:"p",letters:"pⓟｐṕṗƥᵽꝑꝓꝕ"},{base:"q",letters:"qⓠｑɋꝗꝙ"},{base:"r",letters:"rⓡｒŕṙřȑȓṛṝŗṟɍɽꝛꞧꞃ"},{base:"s",letters:"sⓢｓßśṥŝṡšṧṣṩșşȿꞩꞅẛ"},{base:"t",letters:"tⓣｔṫẗťṭțţṱṯŧƭʈⱦꞇ"},{base:"tz",letters:"ꜩ"},{base:"u",letters:"uⓤｕùúûũṹūṻŭüǜǘǖǚủůűǔȕȗưừứữửựụṳųṷṵʉ"},{base:"v",letters:"vⓥｖṽṿʋꝟʌ"},{base:"vy",letters:"ꝡ"},{base:"w",letters:"wⓦｗẁẃŵẇẅẘẉⱳ"},{base:"x",letters:"xⓧｘẋẍ"},{base:"y",letters:"yⓨｙỳýŷỹȳẏÿỷẙỵƴɏỿ"},{base:"z",letters:"zⓩｚźẑżžẓẕƶȥɀⱬꝣ"}]),f={},m=0;m<p.length;m++)for(var g=p[m].letters,y=0;y<g.length;y++)f[g[y]]=p[m].base;function v(e){return File.isMac?(e.replace(/[\/]+$/,"").split("/")||[]).last():reqnode("path").basename(e)}var b={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"'":"\\'","\\":"\\\\"},w=v,x={"&newline;":null,"&tab;":"\t","&copy;":"©","&amp;":"&","&gt":">","&lt":"<","&num;":"#"},C=document.createElement("textarea"),F=[[768,879],[1155,1158],[1160,1161],[1425,1469],[1471,1471],[1473,1474],[1476,1477],[1479,1479],[1536,1539],[1552,1557],[1611,1630],[1648,1648],[1750,1764],[1767,1768],[1770,1773],[1807,1807],[1809,1809],[1840,1866],[1958,1968],[2027,2035],[2305,2306],[2364,2364],[2369,2376],[2381,2381],[2385,2388],[2402,2403],[2433,2433],[2492,2492],[2497,2500],[2509,2509],[2530,2531],[2561,2562],[2620,2620],[2625,2626],[2631,2632],[2635,2637],[2672,2673],[2689,2690],[2748,2748],[2753,2757],[2759,2760],[2765,2765],[2786,2787],[2817,2817],[2876,2876],[2879,2879],[2881,2883],[2893,2893],[2902,2902],[2946,2946],[3008,3008],[3021,3021],[3134,3136],[3142,3144],[3146,3149],[3157,3158],[3260,3260],[3263,3263],[3270,3270],[3276,3277],[3298,3299],[3393,3395],[3405,3405],[3530,3530],[3538,3540],[3542,3542],[3633,3633],[3636,3642],[3655,3662],[3761,3761],[3764,3769],[3771,3772],[3784,3789],[3864,3865],[3893,3893],[3895,3895],[3897,3897],[3953,3966],[3968,3972],[3974,3975],[3984,3991],[3993,4028],[4038,4038],[4141,4144],[4146,4146],[4150,4151],[4153,4153],[4184,4185],[4448,4607],[4959,4959],[5906,5908],[5938,5940],[5970,5971],[6002,6003],[6068,6069],[6071,6077],[6086,6086],[6089,6099],[6109,6109],[6155,6157],[6313,6313],[6432,6434],[6439,6440],[6450,6450],[6457,6459],[6679,6680],[6912,6915],[6964,6964],[6966,6970],[6972,6972],[6978,6978],[7019,7027],[7616,7626],[7678,7679],[8203,8207],[8234,8238],[8288,8291],[8298,8303],[8400,8431],[12330,12335],[12441,12442],[43014,43014],[43019,43019],[43045,43046],[64286,64286],[65024,65039],[65056,65059],[65279,65279],[65529,65531],[68097,68099],[68101,68102],[68108,68111],[68152,68154],[68159,68159],[119143,119145],[119155,119170],[119173,119179],[119210,119213],[119362,119364],[917505,917505],[917536,917631],[917760,917999]],S={nul:0,control:0,tabSize:4};var k=function(e,t){return 0===e?t.nul:9===e?t.tabSize:e<32||127<=e&&e<160?t.control:function(e){var t,n=0,i=F.length-1;if(!(e<F[0][0]||e>F[i][1]))for(;n<=i;)if(t=Math.floor((n+i)/2),e>F[t][1])n=t+1;else{if(!(e<F[t][0]))return 1;i=t-1}}(e)?0:1+(4352<=e&&(e<=4447||9001==e||9002==e||11904<=e&&e<=42191&&12351!=e||44032<=e&&e<=55203||63744<=e&&e<=64255||65040<=e&&e<=65049||65072<=e&&e<=65135||65280<=e&&e<=65376||65504<=e&&e<=65510||131072<=e&&e<=196605||196608<=e&&e<=262141))};var E="http://typora-app/",T="http://typora-theme/",_=function(e){return 0==e.indexOf(E)?_options.appPath+"/"+e.substring(E.length):0==e.indexOf(T)?"file://"+_options.currentThemeFolder+"/"+e.substring(T.length):e},A=function(e){if(/^typora:\/\//.exec(e)){try{e=decodeURI(e)}catch(e){}var t=e.substr(9+"app/".length);return/^userData/.exec(t)&&(t=t.replace(/^userData/,window._options.userDataPath.replace(/\\/g,"\\\\"))),/current-theme\.css$/.exec(t)&&(t=t.replace(/current-theme\.css$/,File.option.curTheme)),t=(t=/^typemark/i.exec(t)?t.replace(/^typemark/,window.dirname):t).replace(/[?#][^\\\/]*$/,"")}return e};e.orDefault=function(e,t){return null==e?t:e};function M(e){try{e=decodeURI(e)}catch(e){}return e}function L(e){return e.replace(/#[^.\/\\]+$/,"").replace(/\?[^\/\\]+/,"")}var N=window.reqnode&&"win32"==process.platform?"\\":"/",D=!!"".normalize,P=(e.isSamePath=function(e,t){return File.isMac&&D&&(e=(e||"").normalize(),t=(t||"").normalize()),JSBridge.fsCaseInsensitive()?e.toLowerCase()==t.toLowerCase():e==t},e.isAncestorPathOf=function(e,t){return JSBridge.fsCaseInsensitive()?0==t.toLowerCase().indexOf(e.toLowerCase()+N):0==t.indexOf(e+N)},e.decodeFromEscapedURL=M,e.decodeFromEscapedPath=function(t){try{var e=/[\\\/]/.exec(t)?"//":decodeURIComponent(t);t=/[\\\/]/.exec(e)?decodeURI(t).replace(/%40/g,"@"):e}catch(e){try{t=decodeURI(t).replace(/%40/g,"@")}catch(e){}}return t},e.normalize=function(e,t){return e.normalize||n("60"),e.normalize(t)},e.titleToAnchor=function(e){return e.toLowerCase().trim().replace(/—/g,"---").replace(/–/g,"--").replace(/\s/g,"-").replace(/[\u2000-\u206F\u2E00-\u2E7F\u3000-\u303F﹡﹨﹪-﹫！-＃％-（＊，．-／：-；？-＠［-＼｛｟｡-｢､-･\\'!"#$%&()*+,\.\/:;<=>?@\[\]^_`{|}~]/g,"")},e.floatToPercent=function(e){return Math.round(100*e)+"%"},e.dateToNumberString=function(e){function t(e){return e<10?"0"+e:e}return""+e.getFullYear()+t(e.getMonth()+1)+t(e.getDate())+t(e.getHours())+t(e.getMinutes())+t(e.getSeconds())+((e=t(e.getMilliseconds()))<100?"0"+e:e)},e.escapeShell=function(e){var t=[];return e.forEach(function(e){e=JSON.stringify(e),t.push(e)}),t.join(" ")},e.truncate=function(e,t,n){var i;return e.length<=t?e:(t=t-(n=n||"…").length,i=Math.ceil(t/2),t=Math.floor(t/2),e.substr(0,i)+n+e.substr(e.length-t))},e.trimPathParam=L,e.absolutePathFrom=function(e){e=(e||"").replace(/^(wk)*file:(\/\/)*/,"");return File.isWin&&(e=e.replace(/^[\/\\]+/,"")),/^[a-z]+:/.exec(e)||(e=M(e),e=(e=L(e)).replace(/%23/g,"#")),e},e.compareVersion=function(e,t){var n,i,r;for(e=e.split("."),t=t.split("."),i=Math.min(e.length,t.length),n=0;n<i;n++)if(0!=(r=parseInt(e[n],10)-parseInt(t[n],10)))return r;return e.length-t.length},e.capitalize=function(e){return e.length<=1?e.toUpperCase():e[0].toUpperCase()+e.substr(1)},e.capitalizeEachWord=function(e){return e.split(" ").map(e=>(e[0]||"").toUpperCase()+e.substring(1)).join(" ")},e.hashCode=function(e){var t=0;if(e)for(var n=0;n<e.length;n++){t=(t<<5)-t+e.charCodeAt(n);t&=t}return t},0);e.tempString=function(){return P++,+new Date+"-"+P},e.IMG_REG=/\.(png|jpg|jpeg|svg|gif|bmp|webp|tiff)$/i,e.VIDEO_REG=/\.(mp4|webm|mkv|flv|avi|mov|wmv|rm|rmvb|m4p|mpe?g|mpv|ogg)$/i,e.AUDIO_REG=/\.(mp3|vox|wav|wma|w4a|m4p|wave|flac|aac)$/i,e.decodeHtmlEntity=function(e){var t=x[e];return t||(C.innerHTML=e,(t=C.value)!=e?x[e]=t:t=null),t},e.formateDateTime=function(e){return e.getFullYear()+"/"+(e.getMonth()+1)+"/"+e.getDate()+"  "+d(e)},e.formateTimeOnly=d,e.formateDateOnly=function(e){return e.getFullYear()+"-"+(e.getMonth()+1)+"-"+e.getDate()},e.insert=function(e,t,n){return t<(e=e||"").length?e.substring(0,t)+n+e.substring(t):e+n},e.escape=function(e,t,n){return e=o(e,t,n)},e.escapeForPreWrap=o,e.unescape=function(e){return null==e||""==e?"":(e+"").replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&#39;/g,"'")},e.escapeHead=function(e){return e.replace(/(^ *)((#+)|(\+ +)|(\- +)|(\* +)|(\d+(\.|\)) +)|(```|~~~)|(>)|(-+\s*$))/,"$1\\$2")},e.escapeMark=a,e.escapeSelector=function(e){return window.CSS&&CSS.escape?CSS.escape(e):$.escapeSelector(e)},e.escapeStringReplace=function(e){return e.replace(/\$/g,"$$$$")},e.escapeRegExp=h,e.unicodeEscapesToPCRE2=function(e){for(var t=/((?:[^\\]|^)(?:\\\\)*)\\u([a-z0-9]{4})(?!\d)/g;e.match(t);)e=e.replace(t,"$1\\x{$2}");return e},e.replaceAll=function(e,t,n){return e.replaceAll?e.replaceAll(t,n):e.replace(new RegExp(h(t),"g"),n)},e.isDefined=function(e){return null!=e},e.isNullOrEmpty=r,e.isNotNullOrEmpty=function(e){return!r(e)},e.isNullOrBlank=function(e){return null==e||""===e||i.exec(e)},e.replaceExact=c,e.splitExact=function(e,t){return e.split(new RegExp("\\b"+t+"\\b","gi"))},e.trimArr=function(e){if(e&&e.length){for(var t=0,n=e.length-1;0===e[t].trim().length&&t<n;)t++;for(;t<n&&0===e[n].trim().length;)n--;return e.slice(t,n+1)}return e},e.isURL=function(e){return!(!s.exec(e)&&!/\s*mailto:/.exec(e))},e.isImg=function(e){return!!l.exec(e)},e.camelize=function(e){return e.replace(/(?:^|_|-)(\w)/g,function(e,t,n){return 0==n?t.toLowerCase():t.toUpperCase()})},e.getRelativePath=function(e,t,n,i){if(!e)return t;var r;if(i=n||i,File.isNode)r=reqnode("path").relative(e,t);else{e=e.replace(/\\\\/g,"/").replace(/^\.\//,"");var o,t=(t=t.replace(/\\\\/g,"/")).split(/\//g),a=e.split(/\//g),e="",s="";for(n||(e=t.pop()),""==a.last()&&a.pop(),""==a[0]&&a.shift(),""==t[0]&&t.shift(),o=t.join("/");0!==o.indexOf(a.join("/"));)a.pop(),s+="../";n=t.slice(a.length);n.length&&(s+=n.join("/")+"/"),r=(s+e).replace(/\/$/,"")}return r=i&&!r.match(/^\.\.?\//)?"./"+r:r},e.getAbsolutePath=u,e.ensureAbsolutePath=function(e,t,n){return File.isWin&&/^[A-Z]{1,2}:/i.exec(t)?t:/^~[\/\\]/.exec(t)?File.option.userPath+t.substr(1):/^[\/\\]/.exec(t)?t:e?u(e,t,n):null},e.realPathForTextBundle=function(e){return File.isWin&&/^[A-Z]{1,2}:/i.exec(e)?e:/^~[\/\\]/.exec(e)?File.option.userPath+e.substr(1):/^[\/\\]/.exec(e)?e:File.bundle.unzipFolder&&File.isTextPack()&&/^assets[\/\\]/.exec(e)?u(File.bundle.unzipFolder,e,!0):u(File.bundle.filePath||File.bundle.originalPath,e,File.isTextBundle()||File.isTextPack())},e.getAbsoluteURL=function(e,t){var n;return t?(e=e||"",(n=t.replace(/^[\\\/]{2}/,"http://")).match(/^[^:]+:\/\//)?n:n.match(/^[\\\/]/)?e.replace(/(^[^:]+:\/\/[^\/]+)\/.*/,"$1"+t):u(e,n)):""},e.isAbsolutePath=function(e){return!(!File.isWin||!/^[A-Z]{1,2}:/i.exec(e))||!!/^~[\/\\]/.exec(e)||!!/^[\/\\]/.exec(e)},e.getFilePathFromMacProxy=_,e.getFilePathFromProxy=function(e){return File.isMac?_(e):File.isNode&&/^typora:\/\//.exec(e)?A(e):e},e.useOrDefault=function(e,t){return e.trim().length?e:t},e.removeDiacritics=function(e){return(e||"").replace(/[^\u0000-\u007E]/g,function(e){return f[e]||e})},e.escapeInQuote=function(e){return e.replace(/["'\\\b\t\n\f\r]/g,function(e){return b[e]}).replace(/\u200b/g,"")},e.pathByDeleteLastComponent=function(e){return File.isMac?e.split("/").slice(0,-1).join("/"):reqnode("path").join(e,"..")},e.getFolder=v,e.getFileName=w,e.date2NaturalLang=function(e,t){var n,i,r=new Date,o=(r-e)/1e3,t=o<30?"just now":o<60?"1 minutes ago":o<3600?Math.floor((30+o)/60).toString()+" minutes ago":o<18e3&&r.getDay()==e.getDay()?[(9<(n=e.getHours())?"":"0")+n,(9<(n=e.getMinutes())?"":"0")+n].join(":"):o<172800&&r.getDay()==(e.getDay()+1)%7?t?"Yesterday":"yesterday":o<518400?Math.floor(o/86400)+" days ago":r.getYear()==e.getYear()?(i=e.getDate(),["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][e.getMonth()]+" "+(9<i?"":"0")+i):(n=e.getMonth()+1,i=e.getDate(),[e.getFullYear(),(9<n?"":"0")+n,(9<i?"":"0")+i].join("-"));return t},e.abbreviatingWithTilde=function(e){var t=File.option.userPath;return!File.isWin&&t&&0==e.indexOf(t+"/")?"~"+e.substring(t.length):e},e.naturalCompare=function(e,t){e=e.toLowerCase(),t=t.toLowerCase();var n=/([.,\s+-]+|\d+)/,i=/^\d/,r=/^(?:(jan(?:uary)?)|(feb(?:ruary)?)|(mar(?:ch)?)|(apr(?:il))|(may)|(jun(?:e)?)|(jul(?:y)?)|(aug(?:ust)?)|(sep(?:tember)?)|(oct(?:ober)?)|(nov(?:ember)?)|(dec(?:ember)?))$/;function o(e,t){return t.exec(e)?Array.from(r.exec(e)).findIndex(function(e,t){return 0<t&&!!e}):-1}function a(e){return e.split(n).filter(function(e){return!!e})}var s,l,c,d=a(e),u=a(t),h=Math.min(d.length,u.length);for(m=0;m<h;m++){s=d[m],l=u[m],c=p=void 0;var p=s==l?0:(c=!!i.exec(s),p=!!i.exec(l),c&&p?Number(s)-Number(l):c||p?c?1:-1:(p=o(s,r),c=o(l,r),0<p&&0<c?p-c:s.localeCompare(l)));if(0!=p)return p}return d.length-u.length},e.wcswidth=function(e){if(!e)return 0;var t,n,i=0;if("string"!=typeof e)return k(e,S);for(var r=0;r<e.length;r++){if(55296<=(t=e.charCodeAt(r))&&t<=56319&&(56320<=(n=e.charCodeAt(++r))&&n<=57343?t=1024*(t-55296)+(n-56320)+65536:r--),(n=k(t,S))<0)return-1;i+=n}return i},e.removeInvalidPathCh=function(e){return e.replace(/[\u200b\u0000~\u0019\u007f~\u009f\\\/<>:"|?*]/g,"").replace(/[\t\r\n]/g," ").replace(/([ .]+)$/,"")},e.isFullUrl=function(e){return/^([a-z][a-z0-9+\-.]+):([^\/\/]{2}|\/{2})/i.exec(e)},e.fromExternalPath=function(e){return!1},e.file2wkfile=function(e){return(e||"").replace(/^file:/i,"wkfile:")},e.wkfile2file=function(e){return(e||"").replace(/^wkfile:/i,"file:")},e.escapeURL=function(e){return e=e||"",encodeURI(e.replace(/\\/g,"/")).replace(/'/g,"%27").replace(/"/g,"%22").replace(/#/g,"%23")},e.findLine=function(e,t){for(var n=e.split(/\n/),i=0,r=0;0<t&&i<n.length&&t>r+n[i].length;)r+=n[i].length+1,i++;return{line:n[i]||"",start:r}},e.isUTF8=function(e){for(var t=0,n=Math.min(e.length,12e3);t<n;)if(e[t]<=126)t+=1;else if(194<=e[t]&&e[t]<=223&&128<=e[t+1]&&e[t+1]<=191)t+=2;else if(224==e[t]&&160<=e[t+1]&&e[t+1]<=191&&128<=e[t+2]&&e[t+2]<=191||(225<=e[t]&&e[t]<=236||238==e[t]||239==e[t])&&128<=e[t+1]&&e[t+1]<=191&&128<=e[t+2]&&e[t+2]<=191||237==e[t]&&128<=e[t+1]&&e[t+1]<=159&&128<=e[t+2]&&e[t+2]<=191)t+=3;else{if(!(240==e[t]&&144<=e[t+1]&&e[t+1]<=191&&128<=e[t+2]&&e[t+2]<=191&&128<=e[t+3]&&e[t+3]<=191||241<=e[t]&&e[t]<=243&&128<=e[t+1]&&e[t+1]<=191&&128<=e[t+2]&&e[t+2]<=191&&128<=e[t+3]&&e[t+3]<=191||244==e[t]&&128<=e[t+1]&&e[t+1]<=143&&128<=e[t+2]&&e[t+2]<=191&&128<=e[t+3]&&e[t+3]<=191))return!1;t+=4}return!0},e.WESTERN_WORD_SPLITTER=/([<>\u3040-\uABFF\uD7A4-\uFAFF\s!-#%-\*,-\/:;\+\?@\[-\]\{\}\xA1\xA7\xAB\xB6\xB7\xBB\xBF\u037E\u0387\u055A-\u055F\u0589\u058A\u05BE\u05C0\u05C3\u05C6\u05F3\u05F4\u0609\u060A\u060C\u060D\u061B\u061E\u061F\u066A-\u066D\u06D4\u0700-\u070D\u07F7-\u07F9\u0830-\u083E\u085E\u0964\u0965\u0970\u09FD\u0AF0\u0DF4\u0E4F\u0E5A\u0E5B\u0F04-\u0F12\u0F14\u0F3A-\u0F3D\u0F85\u0FD0-\u0FD4\u0FD9\u0FDA\u104A-\u104F\u10FB\u1360-\u1368\u1400\u166D\u166E\u169B\u169C\u16EB-\u16ED\u1735\u1736\u17D4-\u17D6\u17D8-\u17DA\u1800-\u180A\u1944\u1945\u1A1E\u1A1F\u1AA0-\u1AA6\u1AA8-\u1AAD\u1B5A-\u1B60\u1BFC-\u1BFF\u1C3B-\u1C3F\u1C7E\u1C7F\u1CC0-\u1CC7\u1CD3\u2010-\u2027\u2030-\u2043\u2045-\u2051\u2053-\u205E\u207D\u207E\u208D\u208E\u2308-\u230B\u2329\u232A\u2768-\u2775\u27C5\u27C6\u27E6-\u27EF\u2983-\u2998\u29D8-\u29DB\u29FC\u29FD\u2CF9-\u2CFC\u2CFE\u2CFF\u2D70\u2E00-\u2E2E\u2E30-\u2E49\u3001-\u3003\u3008-\u3011\u3014-\u301F\u3030\u303D\u30A0\u30FB\uA4FE\uA4FF\uA60D-\uA60F\uA673\uA67E\uA6F2-\uA6F7\uA874-\uA877\uA8CE\uA8CF\uA8F8-\uA8FA\uA8FC\uA92E\uA92F\uA95F\uA9C1-\uA9CD\uA9DE\uA9DF\uAA5C-\uAA5F\uAADE\uAADF\uAAF0\uAAF1\uABEB\uFD3E\uFD3F\uFE10-\uFE19\uFE30-\uFE52\uFE54-\uFE61\uFE63\uFE68\uFE6A\uFE6B\uFF01-\uFF03\uFF05-\uFF0A\uFF0C-\uFF0F\uFF1A\uFF1B\uFF1F\uFF20\uFF3B-\uFF3D\uFF3F\uFF5B\uFF5D\uFF5F-\uFF65])/,e.WESTERN_WORD_SPLITTER_SPELLCHECKER=/([_<>\u3040-\uABFF\uD7A4-\uFAFF\s!-#%-\*,-\/:;\+\?@\[-\]\{\}\xA1\xA7\xAB\xB6\xB7\xBB\xBF\u037E\u0387\u055A-\u055F\u0589\u058A\u05BE\u05C0\u05C3\u05C6\u05F3\u05F4\u0609\u060A\u060C\u060D\u061B\u061E\u061F\u066A-\u066D\u06D4\u0700-\u070D\u07F7-\u07F9\u0830-\u083E\u085E\u0964\u0965\u0970\u09FD\u0AF0\u0DF4\u0E4F\u0E5A\u0E5B\u0F04-\u0F12\u0F14\u0F3A-\u0F3D\u0F85\u0FD0-\u0FD4\u0FD9\u0FDA\u104A-\u104F\u10FB\u1360-\u1368\u1400\u166D\u166E\u169B\u169C\u16EB-\u16ED\u1735\u1736\u17D4-\u17D6\u17D8-\u17DA\u1800-\u180A\u1944\u1945\u1A1E\u1A1F\u1AA0-\u1AA6\u1AA8-\u1AAD\u1B5A-\u1B60\u1BFC-\u1BFF\u1C3B-\u1C3F\u1C7E\u1C7F\u1CC0-\u1CC7\u1CD3\u2010-\u2027\u2030-\u2043\u2045-\u2051\u2053-\u205E\u207D\u207E\u208D\u208E\u2308-\u230B\u2329\u232A\u2768-\u2775\u27C5\u27C6\u27E6-\u27EF\u2983-\u2998\u29D8-\u29DB\u29FC\u29FD\u2CF9-\u2CFC\u2CFE\u2CFF\u2D70\u2E00-\u2E2E\u2E30-\u2E49\u3001-\u3003\u3008-\u3011\u3014-\u301F\u3030\u303D\u30A0\u30FB\uA4FE\uA4FF\uA60D-\uA60F\uA673\uA67E\uA6F2-\uA6F7\uA874-\uA877\uA8CE\uA8CF\uA8F8-\uA8FA\uA8FC\uA92E\uA92F\uA95F\uA9C1-\uA9CD\uA9DE\uA9DF\uAA5C-\uAA5F\uAADE\uAADF\uAAF0\uAAF1\uABEB\uFD3E\uFD3F\uFE10-\uFE19\uFE30-\uFE52\uFE54-\uFE61\uFE63\uFE68\uFE6A\uFE6B\uFF01-\uFF03\uFF05-\uFF0A\uFF0C-\uFF0F\uFF1A\uFF1B\uFF1F\uFF20\uFF3B-\uFF3D\uFF3F\uFF5B\uFF5D\uFF5F-\uFF65])/,e.NOT_WORD=/^[\s!-#%-\*,-\/:;\?@\[-\]\{\}\xA1\xA7\xAB\xB6\xB7\xBB\xBF\u037E\u0387\u055A-\u055F\u0589\u058A\u05BE\u05C0\u05C3\u05C6\u05F3\u05F4\u0609\u060A\u060C\u060D\u061B\u061E\u061F\u066A-\u066D\u06D4\u0700-\u070D\u07F7-\u07F9\u0830-\u083E\u085E\u0964\u0965\u0970\u09FD\u0AF0\u0DF4\u0E4F\u0E5A\u0E5B\u0F04-\u0F12\u0F14\u0F3A-\u0F3D\u0F85\u0FD0-\u0FD4\u0FD9\u0FDA\u104A-\u104F\u10FB\u1360-\u1368\u1400\u166D\u166E\u169B\u169C\u16EB-\u16ED\u1735\u1736\u17D4-\u17D6\u17D8-\u17DA\u1800-\u180A\u1944\u1945\u1A1E\u1A1F\u1AA0-\u1AA6\u1AA8-\u1AAD\u1B5A-\u1B60\u1BFC-\u1BFF\u1C3B-\u1C3F\u1C7E\u1C7F\u1CC0-\u1CC7\u1CD3\u2010-\u2027\u2030-\u2043\u2045-\u2051\u2053-\u205E\u207D\u207E\u208D\u208E\u2308-\u230B\u2329\u232A\u2768-\u2775\u27C5\u27C6\u27E6-\u27EF\u2983-\u2998\u29D8-\u29DB\u29FC\u29FD\u2CF9-\u2CFC\u2CFE\u2CFF\u2D70\u2E00-\u2E2E\u2E30-\u2E49\u3001-\u3003\u3008-\u3011\u3014-\u301F\u3030\u303D\u30A0\u30FB\uA4FE\uA4FF\uA60D-\uA60F\uA673\uA67E\uA6F2-\uA6F7\uA874-\uA877\uA8CE\uA8CF\uA8F8-\uA8FA\uA8FC\uA92E\uA92F\uA95F\uA9C1-\uA9CD\uA9DE\uA9DF\uAA5C-\uAA5F\uAADE\uAADF\uAAF0\uAAF1\uABEB\uFD3E\uFD3F\uFE10-\uFE19\uFE30-\uFE52\uFE54-\uFE61\uFE63\uFE68\uFE6A\uFE6B\uFF01-\uFF03\uFF05-\uFF0A\uFF0C-\uFF0F\uFF1A\uFF1B\uFF1F\uFF20\uFF3B-\uFF3D\uFF3F\uFF5B\uFF5D\uFF5F-\uFF65]/,e.WORD_LETTER=/[\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u05D0-\u05EA\u05F0-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u0860-\u086A\u08A0-\u08B4\u08B6-\u08BD\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u09FC\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0AF9\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C60\u0C61\u0C80\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D54-\u0D56\u0D5F-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16F1-\u16F8\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1877\u1880-\u1884\u1887-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1C80-\u1C88\u1CE9-\u1CEC\u1CEE-\u1CF1\u1CF5\u1CF6\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2183\u2184\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2E2F\u3005\u3006\u3031-\u3035\u303B\u303C\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312E\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FEA\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6E5\uA717-\uA71F\uA722-\uA788\uA78B-\uA7AE\uA7B0-\uA7B7\uA7F7-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA8FD\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB65\uAB70-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]/}),$__System.registerDynamic("13",["11"],!0,function(e,t,n){"use strict";function l(){return"n"+s++}var i=this||self,r=e("11"),o={paragraph:"paragraph",heading:"heading",blockquote:"blockquote",fences:"fences",hr:"hr",def_link:"def_link",def_footnote:"def_footnote",table:"table",raw_edit:"raw_edit",meta_block:"meta_block",math_block:"math_block",html_block:"html_block",list:"list",toc:"toc",iframe:"iframe"},a={list_item:"list_item",table_row:"table_row",table_cell:"table_cell",alert_title:"alert_title"},c={},s=(Object.assign(c,o,a,{tab:"tab",plain:"plain",strong:"strong",em:"em",code:"code",underline:"underline",escape:"escape",autolink:"autolink",reflink:"reflink",refimg:"refimg",link:"link",url:"url",br:"br",tag:"tag",comment:"comment",atag:"atag",imgtag:"imgtag",del:"del",todo:"todo",image:"image",footnote:"footnote",attr:"attr",emoji:"emoji",inline_math:"inline_math",subscript:"subscript",superscript:"superscript",linebreak:"linebreak",highlight:"highlight",html_entity:"html_entity",pants:"pants",emptyline:"emptyline",softbreak:"softbreak",html_inline:"html_inline",ruby:"ruby",alert_text:"alert_text"}),0);class d{constructor(e){e=e||{},this.attributes={};var t=e.id||e.cid||l();e.id||e.cid||this.set("id",t),d.pool.has(t)&&console.warn("Duplicate Model"),d.pool.set(t,this),this.set(e),null==e.text&&this.set("text",this.get("text")||""),e.children||this.set("children",new f)}isBlock(e){return d.isBlock(this.get("type"),e)}isTopBlock(){return this.get("attachTo")&&!this.get("parent")}isVirtualBlock(){return d.isVirtualBlock(this.get("type"))}getClosetBlock(e){return this.isBlock(e)?this:this.get("parent").getClosetBlock(e)}getTopBlock(){return this.isTopBlock()?this:this.get("parent").getTopBlock()}isInline(){return!this.isBlock(!0)}getLastChild(){var e;try{e=this.get("children").at(this.get("children").length-1)}catch(e){return null}return e?e.getLastBrother(!1):null}getFirstChild(){var e;try{e=this.get("children").at(0)}catch(e){return null}return e&&e.getFirstBrother()}escapedMark(e){return e.replace(/\*/g,"*").replace(/_/g,"_").replace(/`/g,"`")}isLoose(e){for(var t=this.getFirstChild(),n=t,i=!1;n;){if(function(e){for(var t=e.getFirstChild(),n=0,i=0;t;){if(d.isType(t,c.paragraph))n++;else{if(!d.isType(t,c.list))return 1;if(d.isType(t.get("after"),c.paragraph)||t.isLoose())return 1;i++}t=t.get("after")}return!(n<=1&&i<=1)}(n)){i=!0;break}n=n.get("after")}if(e)for(n=t;n;)n.set("tight",!i),n=n.get("after");return i}safeGetStrAttr(e,t){return"href-title"==e?this.safeGetStrAttr("href")+" "+this.safeGetStrAttr("title"):(e=this.get(e)?this.get(e):"",t?r.escape(e):e)}replaceWith(e){e.id!=this.id&&(e.get("after")&&e.get("after").set("before",e.get("before")),e.get("before")&&e.get("before").set("after",e.get("after")),e.set("parent",this.get("parent")),e.set("before",this.get("before")),e.set("after",this.get("after")),this.remove())}canContainBlock(e){return d.canContainBlock(this.get("type"),e)}canNotDirectEdit(){return d.isType(this,c.hr,c.math_block,c.list,c.list_item,c.toc)}getText(t,e){var n=[],i=this.get("children");if(e=e||"",this.canContainBlock(!0)||i&&0<i.length)i.sortedForEach(function(e){n.push(e.getText(t))}),n=n.join(e),this.unset("text");else{if(this.get("type")==c.def_link)return this.get("href")+(this.get("title")||"");n=this.get("text")||"",t&&d.isType(this,c.heading,c.paragraph)&&(n=r.escapeHead(n))}return n}getNthChild(e){try{for(var t=this.getFirstChild(),n=0;t&&n<e;)n++,t=t.get("after");return t}catch(e){}return null}getChildIndex(){for(var e=this.get("before"),t=0;e;)e=e.get("before"),t++;return t}getVeryFirst(e){return 0==this.get("children").length?this:(e?this.getLastChild():this.getFirstChild()).getVeryFirst(e)}getFirstBrother(){return this.getLastBrother(!0)}getLastBrother(e,t,n){var i=e?"before":"after";if(this.isTopBlock()){var r=this.get("in").blocks;if(t)return null;if(!n&&r.length)return r.at(e?0:r.length-1).getLastBrother(e,!1,!0)}if(this.get(i)){for(var o=this.attributes[i];o.attributes[i];)o=o.attributes[i];return o.getLastBrother(e,t,!0)}return this}getVeryFirstBrotherIncludeTopBlock(e){return this.getVeryFirstBrother(e,!0)}getVeryFirstBrother(e,t){var n=e?"before":"after";return!t&&this.isTopBlock()?null:!this.get(n)&&this.get("parent")?this.get("parent").getVeryFirstBrother(e,t):this.get(n)?this.get(n).getVeryFirst(e):null}getClosetParagraphLevel(){return this}contains(e){return!!e&&(this.id==e.id||this.contains(e.get("parent")))}closest(){for(var e=this.get("type"),t=0;t<arguments.length;t++)if(e==arguments[t])return this;var n=this.get("parent");return n?d.prototype.closest.apply(n,arguments):null}isDeleted(){return null==this.attributes}_delete(e){e&&this.cid,this.attributes&&(this.set("in",null),e?this.get("children").toArray().map(function(e){e.attributes.parent=null}):this.clearChildren()),d.pool.delete(this.cid),this.attributes=void 0}detach(){var e=this.get("before"),t=this.get("after");e&&(e.attributes.after=t),t&&(t.attributes.before=e),this.attributes.before=void 0,this.attributes.after=void 0,this.set("parent",null),this.set("attachTo",null)}remove(e){this.detach(),this._delete(e)}_appendOrPrepend(e,t){if(e==this)throw Error("trying to append this into this");var n;return e&&(e.detach(),(n=t?this.getFirstChild():this.getLastChild())?t?n.addBefore(e):n.addAfter(e):(e.set("parent",this),e.set("in",this.get("in")))),e}prependChild(e){return this._appendOrPrepend(e,!0)}appendChild(e){return this._appendOrPrepend(e,!1)}appendChildrenTillEnd(e){this.cid,e&&e.cid;for(var t,n=e;n;)t=n.get("after"),this.appendChild(n),n=t}addAfter(e){if(e==this)throw Error("trying to insert this after this");e.detach();var t=this.get("after")||void 0;return((this.attributes.after=e).attributes.after=t)&&((t.attributes.before=e).attributes.noCloseTag=void 0),e.attributes.before=this,e.set({parent:this.get("parent"),attachTo:this.get("attachTo"),in:this.get("in")}),this.attributes.noCloseTag=void 0,e}addBefore(e){if(e==this)throw Error("trying to insert this before this");e.detach();var t=this.get("before")||void 0;return t?t.addAfter(e):(((e.attributes.after=this).attributes.before=e).set({parent:this.get("parent"),attachTo:this.get("attachTo"),in:this.get("in")}),e.attributes.noCloseTag=void 0),e}addAfterTillEnd(e){for(var t,n=this,i=e;i;)t=i.get("after"),n.addAfter(i),n=i,i=t}addArrayAfter(e,t){var n;e&&e.length&&(n=this,e.forEach(e=>{n.addAfter(e),n=e}),t||h(e[0],e.last()))}addArrayBefore(e,t){if(e&&e.length){for(var n=this,i=e.length-1;0<=i;i--){var r=e[i];n.addBefore(r),n=r}t||h(e[0],e.last())}}clearChildren(){this.get("children").forEach(function(e){e.remove()})}get(e){var t;if(this.attributes)return t=this.attributes[e],"text"===e&&(t=t||"",d.isType(this,c.math_block))?t.replace(/^(\w*)\$\$(\w*)$/m,"$1\\$$$$$2"):t;e=new Error(`attributes for node has been deleted (${File.option.appVersion})`);if(i.debugMode)throw e;try{throw e}catch(e){window.Reporter.error(e)}return console.sendError("attributes for node has been deleted",!0),null}set(n,i){var e,r,o=this,a=this.get("in");if("string"==typeof n){switch(r=this.get(n),n){case"parent":r&&r.attributes&&r.get("children").remove(this),i&&i.get("children").add(this);break;case"before":r&&r.attributes&&r.attributes.after==this&&(r.attributes.after=null),i&&((t=i.attributes.after&&i.attributes.after.attributes)&&t.before==i&&(t.before=null),i.attributes.after=this,i.attributes.noCloseTag=void 0);break;case"after":r&&r.attributes&&r.attributes.before==this&&(r.attributes.before=null),i&&((t=i.attributes.before&&i.attributes.before.attributes)&&t.after==i&&(t.after=null),(i.attributes.before=this).attributes.noCloseTag=void 0);break;case"attachTo":r&&r.blocks.remove(this),i&&i.blocks.add(this);break;case"in":r!=i&&(t=this.get("attachTo"),r&&(r.foot_list.remove(this),r.link_list.remove(this),r.allNodes.remove(this),this.set("attachTo",null)),i&&(this.get("type")!=c.def_footnote||i.foot_list.get(this.id)?this.get("type")!=c.def_link||i.link_list.get(this.id)||i.link_list.push(this):i.foot_list.push(this),i.allNodes.add(this),t)&&this.set("attachTo",t),(this.get("children")||[]).map(e=>{e.set("in",i)}));break;case"id":i&&(this.id=i,this.cid=i);break;case"ref":i=i&&(i+"").replace(/\u200b/gi,"").replace(/\\?\]/gi,"\\]");break;case"href":i=i&&this.get("type")===c.def_link?(i||"").replace(/\[|\]|"]/gi,""):i;break;case"title":break;case"type":i!=r&&(p.forEach(function(e){this.attributes[e]=void 0},this),this.attributes.ahead=void 0,this.attributes.tail=void 0,this.attributes.mathLabel=void 0,this.attributes.mathEqLabel=void 0);break;case"text":i=i&&i.replace(/^\u200b/,""),!function(e){var t,n,i;this.get("type")==c.table_cell&&void 0!==this.attributes.text&&(e!=this.attributes.text&&d.tryResetTable(this.closest(c.table)),e=(e||"").length-(this.attributes.text||"").length)&&(t=this.attributes.marginLeft,n=this.attributes.marginRight,i=0,t)&&(n.length>t.length&&(i=Math.min(n.length-1,e),n=n.substring(0,n.length-i),e-=i),0<e&&t.length>n.length&&(i=Math.min(t.length-1,e),t=t.substring(0,t.length-i)),!n&&t.length&&(t=n=" "),this.attributes.marginLeft=t,this.attributes.marginRight=n)}.call(this,i),this.attributes.empty=void 0;break;case"style":var t=this;if(t&&t.attributes&&!t.get("type")!=c.list&&t.attributes.style)for(var s=t.getFirstChild();s;)s.unset("userIndent"),s=s.get("after")}this.attributes[n]=i,!function(){var e=this.get("in")||a,t="type"===n&&r===c.heading||this.get("type")==c.heading&&d.isType(n,"depth","text","parent","before","after");e&&e.toc&&r!=i&&t&&("text"!=n||File._onInitParse?e.toc.refresh(!1):setTimeout(function(){o.isDeleted()||e.toc.updateHeaderText(o)},10)),this.get("type")===c.def_link&&r!=i&&("ref"===n?(File.editor.imgEdit.willUpdateImgRef(r),File.editor.imgEdit.willUpdateImgRef(i)):"text"===n&&File.editor.imgEdit.willUpdateImgRef(this.get("ref"))),e&&e.toc&&"type"==n&&i==c.toc&&setTimeout(function(){e.toc.refresh()},20)}.call(this),!function(){var e=this.get("in")||a;"type"===n&&e&&(r===c.def_footnote&&e.foot_list.remove(this),r===c.def_link&&e.link_list.remove(this),i===c.def_footnote&&e.foot_list.push(this),i===c.def_link)&&e.link_list.push(this),"ref"==n&&r!==i&&this.get("type")==c.def_footnote&&setTimeout(function(){File.editor&&File.editor.docMenu&&File.editor.docMenu.refreshFootnoteReverseLink()},10)}.call(this),!function(){this.get("attachTo")?(this.get("type")==c.meta_block&&"text"==n||"type"==n&&(r==c.meta_block||i==c.meta_block))&&File.onMetaDataChanged(!File._onInitParse):this.get("type")==c.meta_block&&i&&"attachTo"==n&&File.onMetaDataChanged(!File._onInitParse)}.call(this)}else{for(e in this.id||n.id||(n.id=l()),n.id&&this.set("id",n.id),n.in&&this.set("in",n.in),n.attachTo&&this.set("attachTo",n.attachTo),n.type&&this.set("type",n.type),n)-1==["id","in","attachTo","type","marginLeft","marginRight"].indexOf(e)&&d.prototype.set.call(this,e,n[e]);void 0!==n.marginLeft&&(this.set("marginLeft",n.marginLeft),this.set("marginRight",n.marginRight))}return this}unset(e){this.set(e,void 0)}}function u(){this.blocks=new f,this.allNodes=new f,this.foot_list=[],this.link_list=[]}var h=function(e,t){var n=e,i=e.get("parent");if(i&&!i.isDeleted()&&(d.isType(e,c.list_item)&&i.get("style")==d.ListType.ol&&!i.get("isFixed")))for(;n&&n!=t;)n.unset("userIndent"),n=n.get("after")},p=["depth","lang","pattern","patternEnd","align","style","displayStyle","checked","alt","attr","prespace","subindent","markindent","marginLeft","marginRight","alignText","userText","userIndent","isFixed","tagBefore","tagAfter","noCloseTag","empty","alert"],f=(d.property=["text","type","ahead","tail","header","href","title","ref","start","width","height"].concat(p),d.isBlock=function(e,t){return o[e]||t&&a[e]},d.isVirtualBlock=function(e){return a[e]},d.canContainBlock=function(e,t){return e==c.blockquote||e==c.list||e==c.list_item||t&&(e==c.table_row||e==c.table)},d.noChangeLine=function(e){for(var t=e;t;){if(d.isType(e,c.table_cell,c.def_footnote,c.def_link))return!0;t=t.get("parent")}return!1},d.isType=function(e){if(null!=e&&!1!==e){var t="object"==typeof e&&e.attributes?e.attributes.type:e;if(arguments[1]instanceof Array)return d.isType.apply(null,[t].concat(arguments[1]));for(var n=1;n<arguments.length;n++)if(t==arguments[n])return!0;return!(1<arguments.length)&&void 0}},d.sortArray=function(e){if(!e.length)return[];for(var t=[],n=e[0].getFirstBrother();n;)-1<=e.indexOf(n)&&t.push(n),n=n.get("after");return t},function(){this.reset(),Object.defineProperty(this,"length",{get:function(){return this._set.length}})}),e=(f.prototype.get=function(e){return this._map.get(e)},f.prototype.add=function(e){e.cid&&this._map.set(e.cid,e),this._set.push(e)},f.prototype.remove=function(e){var t;e.cid&&((t=this._map.get(e.cid))&&t!==e&&this._set.remove(t),this._map.delete(e.cid)),this._set.remove(e)},f.prototype.at=function(e){return this._set[e]},f.prototype.first=function(){return this._set[0]},f.prototype.sortedFirst=function(){for(var e=this.first();e&&e.get("before");)e=e.get("before");return e},f.prototype.toArray=function(){return this._set.clone()},f.prototype.reset=function(){this._set=[],this._map=new Map},f.prototype.forEach=function(e,t){this._set.clone().forEach(e,t)},f.prototype.map=function(e,t){return this._set.clone().map(e,t)},f.prototype.sortedForEach=function(e,t){for(var n=this.sortedFirst();n;){var i=n.get("after");e.call(t,n),n=i}},f.prototype.update=function(e){e.cid&&this._map.set(e.cid,e)},f.prototype.indexOf=function(e){for(var t=0,n=this.sortedFirst();n;){if(e==n)return t;n=n.get("after"),t++}return-1},d.pool=new Map,window.NodeDef=d,{toHTML:function(e,t){var n=[],i="";if(e.length){var r=e instanceof Array,o=r?e[0]:e.at(0);if(!r)for(;o.get("before");)o=o.get("before");for(File.option.ignoreLineBreak&&(i="\n");n.push(o.toHTML(void 0,void 0,t)),(o=o.get("after"))&&(!r||-1<e.indexOf(o)););}return n.join(i||"")}});u.prototype.storeToJson=function(){return{blocks:this.blocks.map(function(e){return e.storeToJson()}),nid:s}},u.prototype.restoreFromJson=function(n){this.reset(),n.blocks.map(function(e){return d.readFromJson(e,this,!0)},this).map(function(e,t){e.set("before",this.allNodes.get(n.blocks[t].relation.before_id)),e.set("after",this.allNodes.get(n.blocks[t].relation.after_id))},this),s=+n.nid,this.toc&&this.toc.refresh(!0,!0)},u.prototype.get=function(e){switch(e){case"allNodes":return this.allNodes;case"blocks":return this.blocks}},u.prototype.reset=function(e,t){File.editor&&this==File.editor.nodeMap&&console.sendLog("reset NodeMap"),this.blocks.forEach(function(e){e.remove()}),this.blocks.reset(),i.debugMode&&this.allNodes.length&&console.warn("nodeMap not clean"),this.allNodes.length&&(d.pool=new Map),this.allNodes.reset(),this.foot_list instanceof Array?(this.foot_list=[],this.link_list=[]):(this.foot_list.reset(),this.link_list.reset()),t&&(s=0,d.pool=new Map),window.File.editor&&File.editor.mathBlock&&File.editor.mathBlock.cleanUpAMS()},u.prototype.getFirst=function(){return this.blocks.sortedFirst()},u.prototype.getLast=function(){return 0<this.blocks.length?this.blocks.at(this.blocks.length-1).getLastBrother(!1):null},d.backToParagraphBeforeDelete=[c.heading,c.def_footnote,c.def_link,c.meta_block,c.fences],d.ListType={ol:"ol",ul:"ul",task:"tasklist"},t.Node=d,t.NodeMap=u,t.NodeCollection=f,t.NodeCollectionUtils=e,t.TYPE=c,d.TYPE=c}),$__System.registerDynamic("1b",["11","13"],!0,function(e,t,n){"use strict";var y=this||self,v=(e("11"),e("13")),b=v.Node,w=v.TYPE,o={NONE:0,ADD:1,REPLACE:2,DELETE:-1};class a{constructor(e){this.commandStack=[],this.index=-1,this.editor=e,this.UndoManager=a,this.undoManagerContext=!1}reset(){this.commandStack=[],this.index=-1,console.sendLog("[UndoManager] reset commandStack")}setIndex(e){this.index=e}restoreFromJson(e){this.setIndex(e.index),this.commandStack=JSON.parse(e.commandStackJson),console.sendLog(`[UndoManager] restoreFromJson all: ${this.commandStack.length} at: `+e.index)}storeToJson(){var t;try{t=JSON.stringify(this.commandStack)}catch(e){console.sendError(e),this.resize(20),t=JSON.stringify(this.commandStack)}return{index:this.index,commandStackJson:t}}callCommand(e,t){var n,i;if(this.lastUndo=null,t)for(var r=(e.undo||[]).length-1;-1<r;r--)i=this.exeCommand(e.undo[r],e.redo),n=n||(void 0===n?i:!!i);else for(r=0;r<(e.redo||[]).length;r++)i=this.exeCommand(e.redo[r],e.undo),n=n||(void 0===n?i:!!i);return n}}function i(){return"INPUT"==document.activeElement.tagName&&"checkbox"!=document.activeElement.getAttribute("type")||"IFRAME"==(document.activeElement.tagName||"").toUpperCase()&&"BODY"!=document.activeElement.ownerDocument.activeElement.tagName}function r(e){var t=window.getSelection();t&&t.isCollapsed&&!t.anchorOffset&&t.anchorNode==e.writingArea&&t.removeAllRanges()}a.prototype.register=function(e,t,n,i){if(!this.undoManagerContext&&e){if(window.debugMode)try{JSON.stringify(e)}catch(e){alert("found error: "+e),console.error(e)}!e.cursorOnly&&this.index!=this.commandStack.length-1&&e.undo.length<=1&&e.redo.length<=1&&b.isType((e.undo[0]||{type:"cursor"}).type,"cursor","fences-pos")&&b.isType((e.redo[0]||{type:"cursor"}).type,"cursor","fences-pos")||("sync"===n||i||(this.commandStack.splice(this.index+1),this.resizeIfNeeded(),i?(u(this.commandStack[0]),this.commandStack.unshift(e)):(u(this.commandStack.last()),this.commandStack.push(e)),this.setIndex(this.commandStack.length-1)),t||e.cursorOnly||"sync"!==n&&"restore"!==n&&File.updateChangeCount(File.ChangeType.NSChangeDone),"undo"!==n&&"input"!==n&&this.editor.syncChange(e.redo))}},a.prototype.resizeIfNeeded=function(){var e,t=0,n=File.inBusyMode?10:5;return this.commandStack.forEach(e=>{t+="reload"==e.tag?n:1}),160<t&&(e=Math.floor(Math.min(160,this.commandStack.length)/2),this.resize(e),!0)},a.prototype.resize=function(e){this.commandStack.length,e=e||Math.floor(80);var t=this.index,n=(e+=Math.max(0,this.commandStack.length-t),Math.max(this.commandStack.length-e,0));this.commandStack.length>e&&(this.commandStack.splice(0,n),this.setIndex(t-n)),this.commandStack.length,this.index},a.prototype.lastRegisteredOperationCommand=function(){return this.commandStack.length==this.index+1?this.commandStack[this.index]:null},a.prototype.removeLastRegisteredOperationCommand=function(){this.commandStack.length==this.index+1&&(this.commandStack.pop(),this.setIndex(this.index-1))},a.prototype.undoLastDiscardable=function(){if(!this.editor.sourceView.inSourceMode&&!File.isLocked){if(this.endSnap(!0),"INPUT"==document.activeElement.tagName&&"checkbox"!=document.activeElement.getAttribute("type"))return!0;var e=this.commandStack[this.index];e&&e.discardable&&this.undo()}},a.prototype.undo=function(e){if(!File.isFileLoading()){if(this.editor.selection.clearGlobalColumn(),this.editor.sourceView.inSourceMode)return this.editor.sourceView.cm.undo(),this.editor.sourceView.cm.scrollIntoView(),e&&e.preventDefault();if(this.endSnap(!0),i()){if(File.isNode)return JSBridge.invoke("webContents.undo"),e&&e.preventDefault(),!1}else this.editor.mathBlock.currentCm?this.editor.mathBlock.tryAddTagUndo(void 0,$(document.activeElement)):document.activeElement.classList.contains("ty-cm-lang-input")&&this.editor.fences.tryAddLangUndo();e&&e.preventDefault();var t,e=this.commandStack[this.index];e&&(this.editor.brush.pause(),t=this.callCommand(e,!0),this.setIndex(this.index-1),e.cursorOnly||File.updateChangeCount(File.ChangeType.NSChangeUndone),void 0===t?(this.undo(),this.editor.brush.resume()):(t&&this.editor.wordCount.quickUpdate(null,!0,!0),this.editor.refocus(void 0,null,null,!0,!0),this.editor.syncChange(e.undo.clone().reverse()),t&&(this.editor.brush.clearAndPause(),this.editor.quickRefresh(),r(this.editor),$(this.editor.sessionStr).trigger("cursorChange")),this.editor.selection.scrollAdjust(),this.editor.brush.resume(!0),window.Reporter.fullValidate()))}},a.prototype.redo=function(e){if(!File.isFileLoading()){if(this.editor.selection.clearGlobalColumn(),this.editor.sourceView.inSourceMode)return this.editor.sourceView.cm.redo(),this.editor.sourceView.cm.scrollIntoView(),e&&e.preventDefault();if(i()){if(File.isNode)return JSBridge.invoke("webContents.redo"),e&&e.preventDefault(),!1}else if(this.editor.mathBlock.currentCm){if(this.editor.mathBlock.tryAddTagUndo(void 0,$(document.activeElement)))return!1}else if(document.activeElement.classList.contains("ty-cm-lang-input")&&this.editor.fences.tryAddLangUndo(void 0,document.activeElement))return!1;e&&e.preventDefault();var t,e=this.commandStack[this.index+1];e&&(this.editor.brush.pause(),t=this.callCommand(e,!1),this.setIndex(this.index+1),e.cursorOnly||File.updateChangeCount(File.ChangeType.NSChangeRedone),void 0===t?(this.redo(),this.editor.brush.resume()):(t&&this.editor.wordCount.quickUpdate(null,!0,!0),this.editor.refocus(void 0,null,null,!0,!0),this.editor.syncChange(e.redo),t&&(this.editor.brush.clearAndPause(),this.editor.quickRefresh(),r(this.editor),$(this.editor.sessionStr).trigger("cursorChange")),this.editor.selection.scrollAdjust(),this.editor.brush.resume(!0),window.Reporter.fullValidate()))}},a.prototype.hasUndo=function(){return-1!==this.index},a.prototype.hasRedo=function(){return this.index<this.commandStack.length-1},a.prototype.exeCommand=function(i,r,e){var n,t,o,a,s=this.editor,l=!1,c=s.sourceView.inSourceMode;function d(t,n){n=n||[],t=t||s.nodeMap,i.json.map(function(e){n.push(b.readFromJson(e,t,!0))}),i.json.map(function(e){var t=s.getNode(e.id);t.set("before",s.getNode(e.relation.before_id)),t.set("after",s.getNode(e.relation.after_id)),t.set("parent",s.getNode(e.relation.parent_id))})}if(!i)return!1;switch(i.type){case"initSrc":if(c)return!1;s.brush.queue=[],l=!1,File.reloadContent(i.src,{skipUndo:!0,delayRefresh:!0,fromDiskChange:!0,skipChangeCount:!0,onInit:!0});break;case"reload":if(c)return!1;s.nodeMap.reset(s),d(),s.brush.queue=[],l=!0,$(s.sessionStr).html(v.NodeCollectionUtils.toHTML(s.nodeMap.blocks)),s.focusCid=null,s.lastCursor=null,window.getSelection().removeAllRanges(),File.bundle.fileEncode=i.encode;break;case"replace":if(c)return!1;if(!(g=s.getNode(i.id)))return console.error(i.id+" not found in  replace");g.get("type")==w.fences&&s.fences.beforeDeleteFences(g,r),g.get("type")==w.math_block&&s.mathBlock.beforeDeleteFences(g),g.get("type")==w.html_block&&s.htmlBlock.beforeDeleteFences(g),i.id!=i.json.id?(s.getNode(i.id).remove(),g=b.readFromJson(i.json,s.nodeMap)):g.readFromJson(i.json,s.nodeMap),s.findElemById(i.id).replaceWith(s.MarkParser.renderHtmlWithBlockMeta(g,s.brush)),File.inBusyMode||s.writingArea.setAttribute("contenteditable","true"),l=!0,s.brush.restart(),e||(s.brush.addToQueue(g.id,!0),s.wordCount.quickUpdate(g,!1,!0));break;case"insert":if(c)return!1;var u=s.nodeMap,h=new Array,p=[];d(u,h),i.after&&(p=s.findElemById(i.after)).before(v.NodeCollectionUtils.toHTML(h,{mathCount:0})),!p.length&&i.before&&(p=s.findElemById(i.before)).after(v.NodeCollectionUtils.toHTML(h,{mathCount:0})),p.length||((u=h[0].get("parent"))?s.findElemById(u.id).replaceWith(u.toHTML()):0===$(s.sessionStr).children().length&&($(s.sessionStr).html(v.NodeCollectionUtils.toHTML(h,{mathCount:0})),s.focusCid=null,s.lastCursor=null)),l=!0;break;case"remove":if(c)return!1;i.idArray.map(function(e){var t=s.getNode(e),e=(b.isType(t,w.fences)&&s.fences.beforeDeleteFences(t,r),b.isType(t,w.math_block)&&s.mathBlock.beforeDeleteFences(t),b.isType(t,w.html_block)&&s.htmlBlock.beforeDeleteFences(t),(n=s.findElemById(e)).parent("li"));e.length&&e.css("margin","0.1px"),n.remove(),e.length&&e.css("margin",""),t&&t.remove()}),l=!0;break;case"text":if(c)return!1;n=s.findElemById(i.id),s.getNode(i.id).set("text",i.text),i.html&&n.html(i.html),l=!1,"def-footnote"!=n.attr("mdtype")&&"def-link"!=n.attr("mdtype")||(l=!0),e||s.brush.addToQueue(i.id,!0);break;case"deleteMedia":s.imgEdit.deleteMedia(i.from,!1);break;case"restoreMedia":s.imgEdit.restoreMedia(i.from,i.to);break;case"cursor":if(e)return!1;try{if(c)return void(i.inSourceMode&&s.sourceView.cm.setCursor(i.pos));if(i.inSourceMode)return;if(null==i.end&&(i.end=i.start),null==i.startId&&null==i.id&&(i.id=i.cid),i.focus)return setTimeout(function(){s.findElemById(i.id).children("[tabindex]").addBack("[tabindex]").focus()},100),s.findElemById(i.id).children("[tabindex]").addBack("[tabindex]").focus(),!1;if(i.id||i.startId==i.endId)i.id=i.id||i.startId,(n=s.findElemById(i.id)).addClass("md-focus"),b.isType(n.attr("mdtype"),w.fences,w.math_block,w.html_block)?(n.attr("mdtype")==w.fences?(s.fences.refreshEditor(),(o=s.fences.getCm(i.id)).focus()):n.attr("mdtype")==w.math_block?o=s.mathBlock.startEditing(n):n.attr("mdtype")==w.html_block&&(o=s.htmlBlock.startEditing(n)),i.selections&&i.selections.length?o.setSelection(i.selections[0].head,i.selections[0].anchor):i.pos?(o.setCursor(i.pos),i.selections&&o.setSelections(i.selections)):-1<i.start?(o.setCursor(o.posFromIndex(i.start)),-1<i.end&&o.setSelection(o.posFromIndex(i.start),o.posFromIndex(i.end))):s.selection.jumpIntoElemEnd(n)):n.length&&void 0!==i.end?(a=n.text().length,i.start>a&&(i.start=a),i.end>a&&(i.end=a),s.selection.restoreSelection(n[0],{start:i.start,end:i.end})):window.getSelection().removeAllRanges(),r||s.refocus(i.id);else if(i.startId){File.inBusyMode&&!File.isLocked&&s.writingArea.setAttribute("contenteditable","true");try{var f=s.selection.restoreEdge(s.findElemById(i.startId),i.start),f=s.selection.restoreEdge(s.findElemById(i.endId),i.end,!0,f);s.selection.fixSafariRange(f),s.selection.setRange(f),s.refocus()}catch(e){console.log(e.stack)}}File.isTypeWriterMode&&s.selection.scrollAdjust(),l=!1}catch(e){console.warn(e.stack)}break;case"fences":if(c)return!1;g=s.getNode(i.id),(t=b.isType(g,w.math_block)?(s.mathBlock.startEditing(i.id),s.mathBlock.currentCm):b.isType(g,w.html_block)?(s.htmlBlock.startEditing(i.id),s.htmlBlock.currentCm):s.fences.getCm(i.id))?(t.focus(),i.change&&(s.searchPanel.closePanel(!0),t.doc.makeChange(i.change))):y.debugMode&&(console.error("cm is null"),window.alert("error")),l=!1;break;case"fences-pos":if(c||e)return!1;g=s.getNode(i.id),(t=b.isType(g,w.math_block)?(s.mathBlock.startEditing(i.id),s.mathBlock.currentCm):b.isType(g,w.html_block)?(s.htmlBlock.startEditing(i.id),s.htmlBlock.currentCm):(s.fences.refreshEditor(),s.fences.getCm(i.id)))&&(t.focus(),t.setCursor(i.pos),l=!1);break;case"attr":if(c)return!1;i.value=i.value,(g=this.editor.getNode(i.id)).attr(i.key,i.value,this.editor,!0),e||s.brush.addToQueue(i.id,!0);break;case"wrap":if(c)return!1;var m={type:"insert"};m.json=[i.json],i.json.children.map(function(e,t){var n=s.getNode(e.id);0===t?m.before=n.get("before")?n.get("before").id:null:t===i.json.children.length-1&&(m.after=n.get("after")?n.get("after").id:null),n&&(n.get("type")==w.fences&&(l=!0,s.fences.beforeDeleteFences(n,r)),n.get("type")==w.math_block&&(l=!0,s.mathBlock.beforeDeleteFences(n)),n.remove(),s.findElemById(e.id).remove())}),this.exeCommand(m,r);break;case"unwrap":if(c)return!1;var g,p=(g=s.getNode(i.id)).unwrap();i.skipHTML||s.findElemById(i.id).replaceWith(v.NodeCollectionUtils.toHTML(p,{mathCount:0})),l=!0;break;case"scroll":if(c||e)return!1;s.selection.scrollAdjust(i.id?s.findElemById(i.id):void 0,i.marginTop);break;case"sync":if(!e)return!1;if(void 0!==i.html)s.findElemById(i.id).html(i.html).find(".md-expand, .md-focus").removeClass("md-expand md-focus");else if(void 0!==i.allHtml)s.nodeMap.reset(),d(),$("#write").html(i.allHtml);else if(void 0!==i.cmChanges)t=s.fences.getCm(i.id),i.cmChanges.forEach(function(e){t.replaceRange(e.text,e.from,e.to)});else{if(void 0!==i.tex)return(g=s.getNode(i.id)).set("text",i.tex),s.findElemById(i.id).replaceWith(g.toHTML()),!0;void 0!==i.srcChanges?c&&i.srcChanges.forEach(function(e){s.sourceView.cm.replaceRange(e.text,e.from,e.to)}):void 0!==i.content&&(c&&!i.fromSourceMode&&(u=s.sourceView.cm.getScrollInfo().top,s.sourceView.cm.setValue(i.content,"sync"),s.sourceView.cm.scrollTo(0,u)),!c)&&i.fromSourceMode&&(s.nodeMap.reset(),s.reset(i.content))}case"option":"finalNewline"==i.option&&(File.finalNewline=i.value,File.freshMenuWithDelay());default:return!1}return l};function s(e,t,n,i,r){this.id=e,this.type=t||0,this.content=n,this.selection=i,this.snapDate=r||new Date}function l(e,t){return e?(e=[{type:"replace",id:e.id,json:e.content},e.selection],t&&e.reverse(),e):[]}var c,d=null,u=(a.prototype.clearEventTimer=function(){d&&clearTimeout(d),d=null},a.prototype.buildSnap=function(e,t,n){var i=this.editor.selection.buildUndo(void 0,void 0,!0),r=this.editor.getNode(e);return r?(null!=n?r.set("text",content):t&&this.editor.store(e,!0),new s(e,t,r.storeToJson(),i)):null},a.prototype.prepCursorSnap=function(e){(c=a.makeEmptyCommand()).undo.push(this.editor.selection.buildUndo(e))},function(e){e&&(e.incomplete=null,e.date=null,e.source=null)});a.prototype.endSnap=function(e){(c=e?null:c)?(c.redo.push(this.editor.selection.buildUndo()),this.register(c),c=null):u(this.lastRegisteredOperationCommand())},a.prototype.addSnap=function(e,t){var n,i,r=this.lastRegisteredOperationCommand();if(r&&t!=o.REPLACE&&r.source===e+"#"+t&&new Date-r.date<3e3){if(this.lastUndo=this.buildSnap(e,t),this.lastUndo&&(i=r.redo,n=e,!i||0==i.length||!(2!=i.length||!i[0]||"replace"!=i[0].type||i[0].id!=n||i[1]&&"cursor"!=i[1].type)))return void(r.redo=l(this.lastUndo));r.date=0}0==t?this.lastUndo=this.buildSnap(e,t):(n=a.makeEmptyCommand(),this.lastUndo?n.undo=l(this.lastUndo,!0):(n.undo.push(this.editor.selection.buildUndo()),(i=a.buildReplaceUndo(this.editor.getNode(e),null,!0))&&n.undo.push(i)),this.lastUndo=this.buildSnap(e,t),this.lastUndo&&(n.redo=l(this.lastUndo),n.source=e+"#"+t,n.date=this.lastUndo.snapDate),this.register(n))},a.prototype.buildReplaceUndo=function(e){return a.buildReplaceUndo(e)},a.buildReplaceUndo=function(e,t,n){if(e)return{type:"replace",id:t||e.id,json:e.storeToJson()};if(!n)throw new Error("empty node")},a.buildAttrUndo=function(e,t){return{type:"attr",id:e.id,key:t,value:e.get(t)}},a.addUndoForInsert=function(e,t,n,i){return t&&(e.redo.push({type:"insert",after:i?i.id:t.get("after")?t.get("after").id:null,before:n?n.id:t.get("before")?t.get("before").id:null,json:[t.storeToJson()]}),e.undo.push({type:"remove",idArray:[t.id]})),e},a.addUndoForWrap=function(e,t,n){t&&(e.redo.push({type:"wrap",json:t.storeToJson(),skipHTML:n}),e.undo.push({type:"unwrap",id:t.id,skipHTML:n}))},a.addUndoForUnwrap=function(e,t){t&&(e.undo.push({type:"wrap",json:t.storeToJson()}),e.redo.push({type:"unwrap",id:t.id}))},a.buildAllDoc=function(e,t){var n=e.blocks.at(0),i=[];if(n)for(n=n.getFirstBrother();n;)i.push(n.storeToJson()),n=n.get("after");return{type:"reload",json:i,reloadFromDisk:t,encode:File.bundle.fileEncode}},a.addUndoForInsertArray=function(e,t,n,i){return t&&0!=t.length&&(e.redo.push({type:"insert",after:i?i.id:t[t.length-1].get("after")?t[t.length-1].get("after").id:null,before:n?n.id:t[0].get("before")?t[0].get("before").id:null,json:t.reduce(function(e,t){return e.push(t.storeToJson()),e},[])}),e.undo.push({type:"remove",idArray:t.reduce(function(e,t){return e.push(t.id),e},[])})),e},a.addUndoForRemoveArray=function(e,t,n,i){t&&0!=t.length&&(e.undo.push({type:"insert",after:i?i.id:t[t.length-1].get("after")?t[t.length-1].get("after").id:null,before:n?n.id:t[0].get("before")?t[0].get("before").id:null,parent:t[0].get("parent")?t[0].get("parent").id:null,json:t.reduce(function(e,t){return e.push(t.storeToJson()),e},[])}),e.redo.push({type:"remove",idArray:t.reduce(function(e,t){return e.push(t.id),e},[])}))},a.addUndoForRemove=function(e,t,n,i){e.undo.push({type:"insert",after:i?i.id:t.get("after")?t.get("after").id:null,before:n?n.id:t.get("before")?t.get("before").id:null,json:[t.storeToJson()]}),e.redo.push({type:"remove",idArray:[t.id]})},a.makeEmptyCommand=function(e){var t={undo:[],redo:[]};return e&&t.undo.push(e),t},a.isEmptyCommand=function(e){return!(e&&e.undo&&e.redo&&(e.undo.length||e.redo.length))},a.isEmptyOrUnchangedCommand=function(e){return!!a.isEmptyCommand(e)||!(e.undo.find(e=>e&&"cursor"!=e.type)||e.redo.find(e=>e&&"cursor"!=e.type))},a.append=function(e,t){return t&&(e.undo=e.undo.concat(t.undo),e.redo=e.redo.concat(t.redo)),e},b.storeToJson=function(n){var i={content:{},relation:{}};return i.children=new Array,b.property.map(function(e){var t=n.get(e);null!=t&&(t instanceof Array?i.content[e]=$.merge([],t):typeof t==Object?i.content[e]=$.extend({},t):i.content[e]=t)}),i.relation.before_id=n.get("before")?n.get("before").id:null,i.relation.after_id=n.get("after")?n.get("after").id:null,i.relation.parent_id=n.get("parent")?n.get("parent").id:null,i.is_top=!!n.get("attachTo"),n.get("children").sortedForEach(function(e){e=b.storeToJson(e);i.children.push(e)}),i.id=n.id,i},b.readFromJson=function(e,n,t){i=e.id,(i=n.allNodes.get(i))&&!i.attributes&&(console.assert(null,"node deleted"),i.attributes={});var i,r=i||new b({id:e.id});return r.set("in",n),e.is_top&&r.set("attachTo",n),b.property.map(function(e){r.attributes[e]=void 0}),r.set(e.content),r.clearChildren(!0),e.relation.parent_id||r.set("attachTo",n),e.children.map(function(e){b.readFromJson(e,n,!0)}),e.children.map(function(e){var t=n.allNodes.get(e.id);t.set("before",n.allNodes.get(e.relation.before_id)),t.set("after",n.allNodes.get(e.relation.after_id)),t.set("parent",r)}),t||(r.set("before",n.allNodes.get(e.relation.before_id)),r.set("after",n.allNodes.get(e.relation.after_id)),r.set("parent",n.allNodes.get(e.relation.parent_id))),r},b.prototype.storeToJson=function(){return b.storeToJson(this)},b.prototype.readFromJson=function(e,t){this.clearChildren();e=b.readFromJson(e,t||this.get("in"));this.replaceWith(e)},a.SnapFlag=o,n.exports=a}),$__System.registerDynamic("1d",[],!0,function(e,t,n){"use strict";this||self;var i=function(){var i="object",r="function",n="undefined",l=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer"],c=["setStart","setStartBefore","setStartAfter","setEnd","setEndBefore","setEndAfter","collapse","selectNode","selectNodeContents","compareBoundaryPoints","deleteContents","extractContents","cloneContents","insertNode","surroundContents","cloneRange","toString","detach"],t=["boundingHeight","boundingLeft","boundingTop","boundingWidth","htmlText","text"],o=["collapse","compareEndPoints","duplicate","moveToElementText","parentElement","select","setEndPoint","getBoundingClientRect"];function d(e,t){var n=typeof e[t];return n==r||!(n!=i||!e[t])||"unknown"==n}function a(e,t){return!(typeof e[t]!=i||!e[t])}function e(e,t){return typeof e[t]!=n}function s(i){return function(e,t){for(var n=t.length;n--;)if(!i(e,t[n]))return!1;return!0}}var u=s(d),h=s(a),p=s(e);function f(e){return e&&u(e,o)&&p(e,t)}function m(e){return a(e,"body")?e.body:e.getElementsByTagName("body")[0]}var g,y={},v={version:"1.3alpha.20140716",initialized:!1,supported:!0,util:{isHostMethod:d,isHostObject:a,isHostProperty:e,areHostMethods:u,areHostObjects:h,areHostProperties:p,isTextRange:f,getBody:m},features:{},modules:y,config:{alertOnFail:!0,alertOnWarn:!1,preferTextRange:!1}};function b(e){a(window,"console")&&d(window.console,"log")&&window.console.log(e)}function w(e,t){t?window.alert(e):b(e)}function x(e){v.initialized=!0,v.supported=!1,w("Rangy is not supported on this page in your browser. Reason: "+e,v.config.alertOnFail)}v.fail=x,v.warn=function(e){w("Rangy warning: "+e,v.config.alertOnWarn)},!{}.hasOwnProperty?x("hasOwnProperty not supported"):v.util.extend=function(e,t,n){var i,r,o;for(o in t)t.hasOwnProperty(o)&&(i=e[o],r=t[o],n&&null!==i&&"object"==typeof i&&null!==r&&"object"==typeof r&&v.util.extend(i,r,!0),e[o]=r);return t.hasOwnProperty("toString")&&(e.toString=t.toString),e};var C,h=document.createElement("div"),F=(h.appendChild(document.createElement("span")),[].slice);try{1==F.call(h.childNodes,0)[0].nodeType&&(C=function(e){return F.call(e,0)})}catch(e){}v.util.toArray=C=C||function(e){for(var t=[],n=0,i=e.length;n<i;++n)t[n]=e[n];return t},d(document,"addEventListener")?g=function(e,t,n){e.addEventListener(t,n,!1)}:d(document,"attachEvent")?g=function(e,t,n){e.attachEvent("on"+t,n)}:x("Document does not have required addEventListener or attachEvent method"),v.util.addListener=g;var S=[];function k(e){return e.message||e.description||String(e)}function E(){if(!v.initialized){var e,t,n,i=!1,r=!1,o=(d(document,"createRange")&&(e=document.createRange(),u(e,c))&&p(e,l)&&(i=!0),m(document));if(o&&"body"==o.nodeName.toLowerCase())if(o&&d(o,"createTextRange")&&f(e=o.createTextRange())&&(r=!0),i||r){for(n in v.initialized=!0,v.features={implementsDomRange:i,implementsTextRange:r},y)(t=y[n])instanceof _&&t.init(t,v);for(var a=0,s=S.length;a<s;++a)try{S[a](v)}catch(e){b("Rangy init listener threw an exception. Continuing. Detail: "+k(e))}}else x("Neither Range nor TextRange are available");else x("No body element found")}}v.init=E,v.addInitListener=function(e){v.initialized?e(v):S.push(e)};var T=[];function _(e,t,n){this.name=e,this.dependencies=t,this.initialized=!1,this.supported=!1,this.initializer=n}function A(e,t,n,i){n=new _(t,n,function(e){if(!e.initialized){e.initialized=!0;try{i(v,e),e.supported=!0}catch(e){b("Module '"+t+"' failed to load: "+k(e))}}});y[t]=n}function M(){}v.addCreateMissingNativeApiListener=function(e){T.push(e)},v.createMissingNativeApi=function(e){e=e||window,E();for(var t=0,n=T.length;t<n;++t)T[t](e)},_.prototype={init:function(e){for(var t,n,i=this.dependencies||[],r=0,o=i.length;r<o;++r){if(n=i[r],!((t=y[n])&&t instanceof _))throw new Error("required module '"+n+"' not found");if(t.init(),!t.supported)throw new Error("required module '"+n+"' not supported")}this.initializer(this)},fail:function(e){throw this.initialized=!0,this.supported=!1,new Error("Module '"+this.name+"' failed to load: "+e)},warn:function(e){v.warn("Module "+this.name+": "+e)},deprecationNotice:function(e,t){v.warn("DEPRECATED: "+e+" in module "+this.name+"is deprecated. Please use "+t+" instead")},createError:function(e){return new Error("Error in Rangy "+this.name+" module: "+e)}},v.createModule=function(e){var t,n=2==arguments.length?(t=arguments[1],[]):(t=arguments[2],arguments[1]);A(0,e,n,t)},v.createCoreModule=function(e,t,n){A(0,e,t,n)},v.RangePrototype=M,v.rangePrototype=new M,v.selectionPrototype=new function(){};function L(e){N||(N=!0,v.initialized)||E()}var N=!1;if(typeof window==n)x("No window found");else{if(typeof document!=n)return d(document,"addEventListener")&&document.addEventListener("DOMContentLoaded",L,!1),g(window,"load",L),v;x("No document found")}}();i.createCoreModule("DomUtil",[],function(e,l){function r(e,t){for(var n=e.length;n--;)if(e[n]===t)return!0;return!1}var t="undefined",o=e.util,n=(o.areHostMethods(document,["createDocumentFragment","createElement","createTextNode"])||l.fail("document missing a Node creation method"),o.isHostMethod(document,"getElementsByTagName")||l.fail("document missing getElementsByTagName method"),document.createElement("div")),n=(o.areHostMethods(n,["insertBefore","appendChild","cloneNode"])||l.fail("Incomplete Element implementation"),o.isHostProperty(n,"innerHTML")||l.fail("Element is missing innerHTML property"),document.createTextNode("test"));o.areHostMethods(n,["splitText","deleteData","insertData","appendData","cloneNode"])||l.fail("Incomplete Text Node implementation");function c(e){for(var t=0;e=e.previousSibling;)++t;return t}function d(e,t){for(var n=[],i=e;i;i=i.parentNode)n.push(i);for(i=t;i;i=i.parentNode)if(r(n,i))return i;return null}function i(e,t,n){for(var i=n?t:t.parentNode;i;){if(i===e)return!0;i=i.parentNode}return!1}function u(e,t,n){for(var i,r=n?e:e.parentNode;r;){if((i=r.parentNode)===t)return r;r=i}return null}function a(e){e=e.nodeType;return 3==e||4==e||8==e}function s(e,t){var n=t.nextSibling,t=t.parentNode;return n?t.insertBefore(e,n):t.appendChild(e),e}function h(e){if(9==e.nodeType)return e;if(typeof e.ownerDocument!=t)return e.ownerDocument;if(typeof e.document!=t)return e.document;if(e.parentNode)return h(e.parentNode);throw l.createError("getDocument: no document found for node")}function p(e){e=h(e);if(typeof e.defaultView!=t)return e.defaultView;if(typeof e.parentWindow!=t)return e.parentWindow;throw l.createError("Cannot get a window object for node")}function f(e){if(typeof e.contentDocument!=t)return e.contentDocument;if(typeof e.contentWindow!=t)return e.contentWindow.document;throw l.createError("getIframeDocument: No Document object found for iframe element")}function m(e){return e&&o.isHostMethod(e,"setTimeout")&&o.isHostObject(e,"document")}var g,y,v;function b(e){try{return e.parentNode,!1}catch(e){return!0}}function w(e){var t;return e?g&&b(e)?"[Broken node]":a(e)?'"'+e.data+'"':1==e.nodeType?(t=e.id?' id="'+e.id+'"':"","<"+e.nodeName+t+">[index:"+c(e)+",length:"+e.childNodes.length+"]["+(e.innerHTML||"[innerHTML not supported]").slice(0,25)+"]"):e.nodeName:"[No node]"}function x(e){this.root=e,this._next=e}function C(e,t){this.node=e,this.offset=t}function F(e){this.code=this[e],this.codeName=e,this.message="[rangy] DOMException: "+this.codeName,"captureStackTrace"in Error?Error.captureStackTrace(this,F):this.stack=(new Error).stack}(n=document.createElement("b")).innerHTML="1",y=n.firstChild,n.innerHTML="<br>",g=b(y),e.features.crashyTextNodes=g,typeof window.getComputedStyle!=t?v=function(e,t){return p(e).getComputedStyle(e,null)[t]}:typeof document.documentElement.currentStyle!=t?v=function(e,t){return e.currentStyle[t]}:l.fail("No means of obtaining computed style properties found"),x.prototype={_current:null,hasNext:function(){return!!this._next},next:function(){var e,t,n=this._current=this._next;if(this._current)if(e=n.firstChild)this._next=e;else{for(t=null;n!==this.root&&!(t=n.nextSibling);)n=n.parentNode;this._next=t}return this._current},detach:function(){this._current=this._next=this.root=null}},C.prototype={equals:function(e){return!!e&&this.node===e.node&&this.offset==e.offset},inspect:function(){return"[DomPosition("+w(this.node)+":"+this.offset+")]"},toString:function(){return this.inspect()}},F.prototype={INDEX_SIZE_ERR:1,HIERARCHY_REQUEST_ERR:3,WRONG_DOCUMENT_ERR:4,NO_MODIFICATION_ALLOWED_ERR:7,NOT_FOUND_ERR:8,NOT_SUPPORTED_ERR:9,INVALID_STATE_ERR:11,INVALID_NODE_TYPE_ERR:24},e.dom={arrayContains:r,isHtmlNamespace:function(e){return typeof e.namespaceURI==t||null===(e=e.namespaceURI)||"http://www.w3.org/1999/xhtml"==e},parentElement:function(e){return 1==(e=e.parentNode).nodeType?e:null},getNodeIndex:c,getNodeLength:function(e){switch(e.nodeType){case 7:case 10:return 0;case 3:case 8:return e.length;default:return e.childNodes.length}},getCommonAncestor:d,isAncestorOf:i,isOrIsAncestorOf:function(e,t){return i(e,t,!0)},getClosestAncestorIn:u,isCharacterDataNode:a,isTextOrCommentNode:function(e){return!!e&&(3==(e=e.nodeType)||8==e)},insertAfter:s,splitDataNode:function(e,t,n){var i=e.cloneNode(!1);if(i.deleteData(0,t),e.deleteData(t,e.length-t),s(i,e),n)for(var r,o=0;r=n[o++];)r.node==e&&r.offset>t?(r.node=i,r.offset-=t):r.node==e.parentNode&&r.offset>c(e)&&++r.offset;return i},getDocument:h,getWindow:p,getIframeWindow:function(e){if(typeof e.contentWindow!=t)return e.contentWindow;if(typeof e.contentDocument!=t)return e.contentDocument.defaultView;throw l.createError("getIframeWindow: No Window object found for iframe element")},getIframeDocument:f,getBody:o.getBody,isWindow:m,getContentDocument:function(e,t,n){var i;if(e?o.isHostProperty(e,"nodeType")?i=(1==e.nodeType&&"iframe"==e.tagName.toLowerCase()?f:h)(e):m(e)&&(i=e.document):i=document,i)return i;throw t.createError(n+"(): Parameter must be a Window object or DOM node")},getRootContainer:function(e){for(var t;t=e.parentNode;)e=t;return e},comparePoints:function(e,t,n,i){var r,o,a,s;if(e==n)return t===i?0:t<i?-1:1;if(r=u(n,e,!0))return t<=c(r)?-1:1;if(r=u(e,n,!0))return c(r)<i?-1:1;if(!(t=d(e,n)))throw new Error("comparePoints error: nodes have no common ancestor");if((o=e===t?t:u(e,t,!0))===(a=n===t?t:u(n,t,!0)))throw l.createError("comparePoints got to case 4 and childA and childB are the same!");for(s=t.firstChild;s;){if(s===o)return-1;if(s===a)return 1;s=s.nextSibling}},isBrokenNode:b,inspectNode:w,getComputedStyleProperty:v,fragmentFromNodeChildren:function(e){for(var t,n=h(e).createDocumentFragment();t=e.firstChild;)n.appendChild(t);return n},createIterator:function(e){return new x(e)},DomPosition:C},e.DOMException=F}),i.createCoreModule("DomRange",["DomUtil"],function(c,R){var l=c.dom,o=c.util,t=l.DomPosition,a=c.DOMException,d=l.isCharacterDataNode,u=l.getNodeIndex,s=l.isOrIsAncestorOf,r=l.getDocument,h=l.comparePoints,p=l.splitDataNode,f=l.getClosestAncestorIn,m=l.getNodeLength,g=l.arrayContains,y=l.getRootContainer,O=c.features.crashyTextNodes;function v(e,t){return 3!=e.nodeType&&(s(e,t.startContainer)||s(e,t.endContainer))}function b(e){return e.document||r(e.startContainer)}function w(e){return new t(e.parentNode,u(e))}function x(e){return new t(e.parentNode,u(e)+1)}function n(e,t,n){var i=11==e.nodeType?e.firstChild:e;return d(t)?n==t.length?l.insertAfter(e,t):t.parentNode.insertBefore(e,0==n?t:p(t,n)):n>=t.childNodes.length?t.appendChild(e):t.insertBefore(e,t.childNodes[n]),i}function I(e,t,n){if(M(e),M(t),b(t)!=b(e))throw new a("WRONG_DOCUMENT_ERR");var i=h(e.startContainer,e.startOffset,t.endContainer,t.endOffset),e=h(e.endContainer,e.endOffset,t.startContainer,t.startOffset);return n?i<=0&&0<=e:i<0&&0<e}function C(e,t,n){var i,r,o,a;for(n=n||{stop:!1};o=e.next();)if(e.isPartiallySelectedSubtree()){if(!1===t(o))return void(n.stop=!0);if(C(a=e.getSubtreeIterator(),t,n),a.detach(),n.stop)return}else for(i=l.createIterator(o);r=i.next();)if(!1===t(r))return void(n.stop=!0)}function $(e){for(var t;e.next();)e.isPartiallySelectedSubtree()?($(t=e.getSubtreeIterator()),t.detach()):e.remove()}function H(e){for(var t,n,i=b(e.range).createDocumentFragment();t=e.next();){if(e.isPartiallySelectedSubtree()?(t=t.cloneNode(!1),n=e.getSubtreeIterator(),t.appendChild(H(n)),n.detach()):e.remove(),10==t.nodeType)throw new a("HIERARCHY_REQUEST_ERR");i.appendChild(t)}return i}function U(e){return"["+(void 0===e.getName?"Range":e.getName())+"("+l.inspectNode(e.startContainer)+":"+e.startOffset+", "+l.inspectNode(e.endContainer)+":"+e.endOffset+")]"}function F(e,t){this.range=e,this.clonePartiallySelectedTextNodes=t,e.collapsed||(this.sc=e.startContainer,this.so=e.startOffset,this.ec=e.endContainer,this.eo=e.endOffset,t=e.commonAncestorContainer,this.sc===this.ec&&d(this.sc)?(this.isSingleCharacterDataNode=!0,this._first=this._last=this._next=this.sc):(this._first=this._next=this.sc!==t||d(this.sc)?f(this.sc,t,!0):this.sc.childNodes[this.so],this._last=this.ec!==t||d(this.ec)?f(this.ec,t,!0):this.ec.childNodes[this.eo-1]))}F.prototype={_current:null,_next:null,_first:null,_last:null,isSingleCharacterDataNode:!1,reset:function(){this._current=null,this._next=this._first},hasNext:function(){return!!this._next},next:function(){var e=this._current=this._next;return e&&(this._next=e!==this._last?e.nextSibling:null,d(e))&&this.clonePartiallySelectedTextNodes&&(e===this.ec&&(e=e.cloneNode(!0)).deleteData(this.eo,e.length-this.eo),this._current===this.sc)&&(e=e.cloneNode(!0)).deleteData(0,this.so),e},remove:function(){var e,t,n=this._current;!d(n)||n!==this.sc&&n!==this.ec?n.parentNode&&n.parentNode.removeChild(n):(e=n===this.sc?this.so:0)!=(t=n===this.ec?this.eo:n.length)&&n.deleteData(e,t-e)},isPartiallySelectedSubtree:function(){return v(this._current,this.range)},getSubtreeIterator:function(){var e,t,n,i,r,o;return this.isSingleCharacterDataNode?(e=this.range.cloneRange()).collapse(!1):(e=new B(b(this.range)),t=this._current,i=0,o=m(r=n=t),s(t,this.sc)&&(n=this.sc,i=this.so),s(t,this.ec)&&(r=this.ec,o=this.eo),de(e,n,i,r,o)),new F(e,this.clonePartiallySelectedTextNodes)},detach:function(){this.range=this._current=this._next=this._first=this._last=this.sc=this.so=this.ec=this.eo=null}};var j=[1,3,4,5,7,8,10],q=[2,9,11],W=[1,3,4,5,7,8,10,11],z=[1,3,4,5,7,8];function e(r){return function(e,t){for(var n,i=t?e:e.parentNode;i;){if(n=i.nodeType,g(r,n))return i;i=i.parentNode}return null}}var i=e([9,11]),V=e([5,6,10,12]),J=e([6,10,12]);function S(e,t){if(J(e,t))throw new a("INVALID_NODE_TYPE_ERR")}function k(e,t){if(!g(t,e.nodeType))throw new a("INVALID_NODE_TYPE_ERR")}function E(e,t){if(t<0||t>(d(e)?e:e.childNodes).length)throw new a("INDEX_SIZE_ERR")}function T(e,t){if(i(e,!0)!==i(t,!0))throw new a("WRONG_DOCUMENT_ERR")}function _(e){if(V(e,!0))throw new a("NO_MODIFICATION_ALLOWED_ERR")}function A(e,t){if(!e)throw new a(t)}function K(e){return O&&l.isBrokenNode(e)||!g(q,e.nodeType)&&!i(e,!0)}function Y(e,t){return t<=(d(e)?e:e.childNodes).length}function G(e){return!!e.startContainer&&!!e.endContainer&&!K(e.startContainer)&&!K(e.endContainer)&&Y(e.startContainer,e.startOffset)&&Y(e.endContainer,e.endOffset)}function M(e){if(!G(e))throw new Error("Range error: Range is no longer valid after DOM mutation ("+e.inspect()+")")}var Q=document.createElement("style"),L=!1;try{Q.innerHTML="<b>x</b>",L=3==Q.firstChild.nodeType}catch(e){}function X(e,t){M(e);var n=e.startContainer,i=e.startOffset,r=e.endContainer,o=e.endOffset,a=n===r;d(r)&&0<o&&o<r.length&&p(r,o,t),d(n)&&0<i&&i<n.length&&(n=p(n,i,t),a?(o-=i,r=n):r==n.parentNode&&o>=u(n)&&o++,i=0),e.setStartAndEnd(n,i,r,o)}c.features.htmlParsingConforms=L;var N=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer"],D=0,Z=1,ee=2,te=3,ne=0,ie=1,re=2,P=3;function oe(e){e.START_TO_START=D,e.START_TO_END=Z,e.END_TO_END=ee,e.END_TO_START=te,e.NODE_BEFORE=ne,e.NODE_AFTER=ie,e.NODE_BEFORE_AND_AFTER=re,e.NODE_INSIDE=P}function ae(e){oe(e),oe(e.prototype)}function se(r,o){return function(){M(this);var e=this.startContainer,t=this.startOffset,n=this.commonAncestorContainer,i=new F(this,!0),n=(e!==n&&(e=(n=x(f(e,n,!0))).node,t=n.offset),C(i,_),i.reset(),r(i));return i.detach(),o(this,e,t,e,t),n}}function le(e,l){function t(t,n){return function(e){k(e,j),k(y(e),q);e=(t?w:x)(e);(n?i:r)(this,e.node,e.offset)}}function i(e,t,n){var i=e.endContainer,r=e.endOffset;t===e.startContainer&&n===e.startOffset||(y(t)==y(i)&&1!=h(t,n,i,r)||(i=t,r=n),l(e,t,n,i,r))}function r(e,t,n){var i=e.startContainer,r=e.startOffset;t===e.endContainer&&n===e.endOffset||(y(t)==y(i)&&-1!=h(t,n,i,r)||(i=t,r=n),l(e,i,r,t,n))}function n(){}n.prototype=c.rangePrototype,e.prototype=new n,o.extend(e.prototype,{setStart:function(e,t){S(e,!0),E(e,t),i(this,e,t)},setEnd:function(e,t){S(e,!0),E(e,t),r(this,e,t)},setStartAndEnd:function(){var e=arguments,t=e[0],n=e[1],i=t,r=n;switch(e.length){case 3:r=e[2];break;case 4:i=e[2],r=e[3]}l(this,t,n,i,r)},setBoundary:function(e,t,n){this["set"+(n?"Start":"End")](e,t)},setStartBefore:t(!0,!0),setStartAfter:t(!1,!0),setEndBefore:t(!0,!1),setEndAfter:t(!1,!1),collapse:function(e){M(this),e?l(this,this.startContainer,this.startOffset,this.startContainer,this.startOffset):l(this,this.endContainer,this.endOffset,this.endContainer,this.endOffset)},selectNodeContents:function(e){S(e,!0),l(this,e,0,e,m(e))},selectNode:function(e){S(e,!1),k(e,j);var t=w(e),e=x(e);l(this,t.node,t.offset,e.node,e.offset)},extractContents:se(H,l),deleteContents:se($,l),canSurroundContents:function(){M(this),_(this.startContainer),_(this.endContainer);var e=new F(this,!0),t=e._first&&v(e._first,this)||e._last&&v(e._last,this);return e.detach(),!t},splitBoundaries:function(){X(this)},splitBoundariesPreservingPositions:function(e){X(this,e)},normalizeBoundaries:function(){M(this);function e(e){var t=e.nextSibling;t&&t.nodeType==e.nodeType&&(a=(o=e).length,e.appendData(t.data),t.parentNode.removeChild(t))}function t(e){var t,n=e.previousSibling;n&&n.nodeType==e.nodeType&&(t=(i=e).length,r=n.length,e.insertData(0,n.data),n.parentNode.removeChild(n),i==o?(a+=r,o=i):o==e.parentNode&&(n=u(e),a==n?(o=e,a=t):n<a&&a--))}var n,i=this.startContainer,r=this.startOffset,o=this.endContainer,a=this.endOffset,s=!0;d(o)?o.length==a&&e(o):(0<a&&(n=o.childNodes[a-1])&&d(n)&&e(n),s=!this.collapsed),s?d(i)?0==r&&t(i):r<i.childNodes.length&&(n=i.childNodes[r])&&d(n)&&t(n):(i=o,r=a),l(this,i,r,o,a)},collapseToPoint:function(e,t){S(e,!0),E(e,t),this.setStartAndEnd(e,t)}}),ae(e)}function ce(e){e.collapsed=e.startContainer===e.endContainer&&e.startOffset===e.endOffset,e.commonAncestorContainer=e.collapsed?e.startContainer:l.getCommonAncestor(e.startContainer,e.endContainer)}function de(e,t,n,i,r){e.startContainer=t,e.startOffset=n,e.endContainer=i,e.endOffset=r,e.document=l.getDocument(t),ce(e)}function B(e){this.startContainer=e,this.startOffset=0,this.endContainer=e,this.endOffset=0,this.document=e,ce(this)}o.extend(c.rangePrototype,{compareBoundaryPoints:function(e,t){M(this),T(this.startContainer,t.startContainer);var n=e==te||e==D?"start":"end",e=e==Z||e==D?"start":"end",i=this[n+"Container"],n=this[n+"Offset"],r=t[e+"Container"],t=t[e+"Offset"];return h(i,n,r,t)},insertNode:function(e){if(M(this),k(e,W),_(this.startContainer),s(e,this.startContainer))throw new a("HIERARCHY_REQUEST_ERR");e=n(e,this.startContainer,this.startOffset);this.setStartBefore(e)},cloneContents:function(){var e,t;return M(this),this.collapsed?b(this).createDocumentFragment():this.startContainer===this.endContainer&&d(this.startContainer)?((t=this.startContainer.cloneNode(!0)).data=t.data.slice(this.startOffset,this.endOffset),(e=b(this).createDocumentFragment()).appendChild(t),e):(t=function e(t){for(var n,i,r=b(t.range).createDocumentFragment();n=t.next();){if(i=t.isPartiallySelectedSubtree(),n=n.cloneNode(!i),i&&(i=t.getSubtreeIterator(),n.appendChild(e(i)),i.detach()),10==n.nodeType)throw new a("HIERARCHY_REQUEST_ERR");r.appendChild(n)}return r}(e=new F(this,!0)),e.detach(),t)},canSurroundContents:function(){M(this),_(this.startContainer),_(this.endContainer);var e=new F(this,!0),t=e._first&&v(e._first,this)||e._last&&v(e._last,this);return e.detach(),!t},surroundContents:function(e){if(k(e,z),!this.canSurroundContents())throw new a("INVALID_STATE_ERR");var t=this.extractContents();if(e.hasChildNodes())for(;e.lastChild;)e.removeChild(e.lastChild);n(e,this.startContainer,this.startOffset),e.appendChild(t),this.selectNode(e)},cloneRange:function(){M(this);for(var e,t=new B(b(this)),n=N.length;n--;)t[e=N[n]]=this[e];return t.isBackward=this.isBackward,t},toString:function(){M(this);var t,e=this.startContainer;return e===this.endContainer&&d(e)?3==e.nodeType||4==e.nodeType?e.data.slice(this.startOffset,this.endOffset):"":(t=[],C(e=new F(this,!0),function(e){3!=e.nodeType&&4!=e.nodeType||t.push(e.data)}),e.detach(),t.join(""))},compareNode:function(e){M(this);var t,n=e.parentNode,e=u(e);if(n)return t=this.comparePoint(n,e),n=this.comparePoint(n,e+1),t<0?0<n?re:ne:0<n?ie:P;throw new a("NOT_FOUND_ERR")},comparePoint:function(e,t){return M(this),A(e,"HIERARCHY_REQUEST_ERR"),T(e,this.startContainer),h(e,t,this.startContainer,this.startOffset)<0?-1:0<h(e,t,this.endContainer,this.endOffset)?1:0},createContextualFragment:L?function(e){var t,n=this.startContainer,i=r(n);if(n)return t=null,1==n.nodeType?t=n:d(n)&&(t=l.parentElement(n)),(t=null===t||"HTML"==t.nodeName&&l.isHtmlNamespace(r(t).documentElement)&&l.isHtmlNamespace(t)?i.createElement("body"):t.cloneNode(!1)).innerHTML=e,l.fragmentFromNodeChildren(t);throw new a("INVALID_STATE_ERR")}:function(e){var t=b(this).createElement("body");return t.innerHTML=e,l.fragmentFromNodeChildren(t)},toHtml:function(){M(this);var e=this.commonAncestorContainer.parentNode.cloneNode(!1);return e.appendChild(this.cloneContents()),e.innerHTML},intersectsNode:function(e,t){var n,i;return M(this),A(e,"NOT_FOUND_ERR"),r(e)===b(this)&&(i=e.parentNode,e=u(e),A(i,"NOT_FOUND_ERR"),n=h(i,e,this.endContainer,this.endOffset),i=h(i,e+1,this.startContainer,this.startOffset),t?n<=0&&0<=i:n<0&&0<i)},isPointInRange:function(e,t){return M(this),A(e,"HIERARCHY_REQUEST_ERR"),T(e,this.startContainer),0<=h(e,t,this.startContainer,this.startOffset)&&h(e,t,this.endContainer,this.endOffset)<=0},intersectsRange:function(e){return I(this,e,!1)},intersectsOrTouchesRange:function(e){return I(this,e,!0)},intersection:function(e){var t,n,i;return this.intersectsRange(e)?(t=h(this.startContainer,this.startOffset,e.startContainer,e.startOffset),n=h(this.endContainer,this.endOffset,e.endContainer,e.endOffset),i=this.cloneRange(),-1==t&&i.setStart(e.startContainer,e.startOffset),1==n&&i.setEnd(e.endContainer,e.endOffset),i):null},union:function(e){var t;if(this.intersectsOrTouchesRange(e))return t=this.cloneRange(),-1==h(e.startContainer,e.startOffset,this.startContainer,this.startOffset)&&t.setStart(e.startContainer,e.startOffset),1==h(e.endContainer,e.endOffset,this.endContainer,this.endOffset)&&t.setEnd(e.endContainer,e.endOffset),t;throw new a("Ranges do not intersect")},containsNode:function(e,t){try{return t?this.intersectsNode(e,!1):this.compareNode(e)==P}catch(e){return console.sendError(e),!1}},containsNodeContents:function(e){return 0<=this.comparePoint(e,0)&&this.comparePoint(e,m(e))<=0},containsRange:function(e){var t=this.intersection(e);return null!==t&&e.equals(t)},containsNodeText:function(e){var t=this.cloneRange(),n=(t.selectNode(e),t.getNodes([3]));return 0<n.length?(t.setStart(n[0],0),n=n.pop(),t.setEnd(n,n.length),this.containsRange(t)):this.containsNodeContents(e)},getNodes:function(e,t){return M(this),n=this,i=t,o=!(!(t=e)||!t.length),a=!!i,o&&(r=new RegExp("^("+t.join("|")+")$")),C(new F(n,!(s=[])),function(e){var t;o&&!r.test(e.nodeType)||a&&!i(e)||e==(t=n.startContainer)&&d(t)&&n.startOffset==t.length||e==(t=n.endContainer)&&d(t)&&0==n.endOffset||s.push(e)}),s;var n,i,r,o,a,s},getDocument:function(){return b(this)},collapseBefore:function(e){this.setEndBefore(e),this.collapse(!1)},collapseAfter:function(e){this.setStartAfter(e),this.collapse(!0)},getBookmark:function(e,r){var t,n,i,o,a;return e?(n=b(this),t=c.createRange(n),e=e||l.getBody(n),t.selectNodeContents(e),n=this.intersection(t),i=e.querySelectorAll("mjx-container, text, ruby").length,a=o=0,n&&(t.setEnd(n.startContainer,n.startOffset),a=(o=i?s(t):t.toString().length)+(i?s(n):n.toString().length)),{start:o,end:a,containerNode:e}):{};function s(e){var t=e.cloneContents();if(t.querySelector("mjx-container, text, ruby")){for(var n=t.querySelectorAll("mjx-container, svg, ruby"+(r?",.md-math-after-sym":"")),i=0;i<n.length;i++)n[i].parentElement&&n[i].parentElement.removeChild(n[i]);return t.textContent.length}return e.toString().length}},moveToBookmark:function(e){for(var t,n,i,r,o=e.containerNode,a=0,s=(this.setStart(o,0),this.collapse(!0),[o]),l=!1,c=!1;!c&&(t=s.pop());)if(3==t.nodeType)n=a+t.length,!l&&e.start>=a&&e.start<=n&&(this.setStart(t,e.start-a),l=!0),l&&e.end>=a&&e.end<=n&&(this.setEnd(t,e.end-a),c=!0),a=n;else if(!/^(MJX\-CONTAINER|text|RUBY)$/i.exec(t.tagName||""))for(i=(r=t.childNodes).length;i--;)s.push(r[i])},getName:function(){return"DomRange"},equals:function(e){return B.rangesEqual(this,e)},isValid:function(){return G(this)},inspect:function(){return U(this)},detach:function(){}}),le(B,de),o.extend(B,{rangeProperties:N,RangeIterator:F,copyComparisonConstants:ae,createPrototypeRange:le,inspect:U,getRangeDocument:b,rangesEqual:function(e,t){return e.startContainer===t.startContainer&&e.startOffset===t.startOffset&&e.endContainer===t.endContainer&&e.endOffset===t.endOffset}}),c.DomRange=B}),i.createCoreModule("WrappedRange",["DomRange"],function(n,t){var i,o,r,y=n.dom,e=n.util,v=y.DomPosition,a=n.DomRange,l=y.getBody,s=y.getContentDocument,b=y.isCharacterDataNode;if(n.features.implementsDomRange){var c,d=a.rangeProperties;function u(e){for(var t,n=d.length;n--;)e[t=d[n]]=e.nativeRange[t];e.collapsed=e.startContainer===e.endContainer&&e.startOffset===e.endOffset}a.createPrototypeRange(i=function(e){if(!e)throw t.createError("WrappedRange: Range must be specified");this.nativeRange=e,u(this)},function(e,t,n,i,r){var o=e.startContainer!==t||e.startOffset!=n,a=e.endContainer!==i||e.endOffset!=r,s=!e.equals(e.nativeRange);(o||a||s)&&(e.setEnd(i,r),e.setStart(t,n))}),(c=i.prototype).selectNode=function(e){this.nativeRange.selectNode(e),u(this)},c.cloneContents=function(){return this.nativeRange.cloneContents()},c.surroundContents=function(e){this.nativeRange.surroundContents(e),u(this)},c.collapse=function(e){this.nativeRange.collapse(e),u(this)},c.cloneRange=function(){var e=new i(this.nativeRange.cloneRange());return e.isBackward=this.isBackward,e},c.refresh=function(){u(this)},c.toString=function(){return this.nativeRange.toString()};var h=document.createTextNode("test"),p=(l(document).appendChild(h),document.createRange());p.setStart(h,0),p.setEnd(h,0);try{p.setStart(h,1),c.setStart=function(e,t){this.nativeRange.setStart(e,t),u(this)},c.setEnd=function(e,t){this.nativeRange.setEnd(e,t),u(this)},f=function(t){return function(e){this.nativeRange[t](e),u(this)}}}catch(e){c.setStart=function(t,n){try{this.nativeRange.setStart(t,n)}catch(e){this.nativeRange.setEnd(t,n),this.nativeRange.setStart(t,n)}u(this)},c.setEnd=function(t,n){try{this.nativeRange.setEnd(t,n)}catch(e){this.nativeRange.setStart(t,n),this.nativeRange.setEnd(t,n)}u(this)},f=function(n,i){return function(t){try{this.nativeRange[n](t)}catch(e){this.nativeRange[i](t),this.nativeRange[n](t)}u(this)}}}c.setStartBefore=f("setStartBefore","setEndBefore"),c.setStartAfter=f("setStartAfter","setEndAfter"),c.setEndBefore=f("setEndBefore","setStartBefore"),c.setEndAfter=f("setEndAfter","setStartAfter"),c.selectNodeContents=function(e){this.setStartAndEnd(e,0,y.getNodeLength(e))},p.selectNodeContents(h),p.setEnd(h,3);var f=document.createRange();f.selectNodeContents(h),f.setEnd(h,4),f.setStart(h,2),-1==p.compareBoundaryPoints(p.START_TO_END,f)&&1==p.compareBoundaryPoints(p.END_TO_START,f)?c.compareBoundaryPoints=function(e,t){return e==(t=t.nativeRange||t).START_TO_END?e=t.END_TO_START:e==t.END_TO_START&&(e=t.START_TO_END),this.nativeRange.compareBoundaryPoints(e,t)}:c.compareBoundaryPoints=function(e,t){return this.nativeRange.compareBoundaryPoints(e,t.nativeRange||t)};(f=document.createElement("div")).innerHTML="123";var m=f.firstChild,g=l(document);g.appendChild(f),p.setStart(m,1),p.setEnd(m,2),p.deleteContents(),"13"==m.data&&(c.deleteContents=function(){this.nativeRange.deleteContents(),u(this)},c.extractContents=function(){var e=this.nativeRange.extractContents();return u(this),e}),g.removeChild(f),g=null,e.isHostMethod(p,"createContextualFragment")&&(c.createContextualFragment=function(e){return this.nativeRange.createContextualFragment(e)}),l(document).removeChild(h),c.getName=function(){return"WrappedRange"},n.WrappedRange=i,n.createNativeRange=function(e){return(e=s(e,t,"createNativeRange")).createRange()}}n.features.implementsTextRange&&(o=function(e,t,n,i,r){var o=e.duplicate(),a=(o.collapse(n),o.parentElement());if(!(a=y.isOrIsAncestorOf(t,a)?a:t).canHaveHTML)return{boundaryPosition:t=new v(a.parentNode,y.getNodeIndex(a)),nodeInfo:{nodeIndex:t.offset,containerElement:t.node}};var s=y.getDocument(a).createElement("span");s.parentNode&&s.parentNode.removeChild(s);for(var l,c,d=n?"StartToStart":"StartToEnd",u=r&&r.containerElement==a?r.nodeIndex:0,h=a.childNodes.length,p=h,f=p;f==h?a.appendChild(s):a.insertBefore(s,a.childNodes[f]),o.moveToElementText(s),0!=(l=o.compareEndPoints(d,e))&&u!=p;){if(-1==l){if(p==u+1)break;u=f}else p=p==u+1?u:f;f=Math.floor((u+p)/2),a.removeChild(s)}if(t=s.nextSibling,-1==l&&t&&b(t)){if(o.setEndPoint(n?"EndToStart":"EndToEnd",e),/[\r\n]/.test(t.data))for(var m=o.duplicate(),r=m.text.replace(/\r\n/g,"\r").length,g=m.moveStart("character",r);-1==(l=m.compareEndPoints("StartToEnd",m));)g++,m.moveStart("character",1);else g=o.text.length;c=new v(t,g)}else r=(i||!n)&&s.previousSibling,c=(t=(i||n)&&s.nextSibling)&&b(t)?new v(t,0):r&&b(r)?new v(r,r.data.length):new v(a,y.getNodeIndex(s));return s.parentNode.removeChild(s),{boundaryPosition:c,nodeInfo:{nodeIndex:f,containerElement:a}}},r=function(e,t){var n,i=e.offset,r=y.getDocument(e.node),o=l(r).createTextRange(),a=b(e.node),s=a?(n=e.node).parentNode:(n=i<(s=e.node.childNodes).length?s[i]:null,e.node),e=r.createElement("span");return e.innerHTML="&#feff;",n?s.insertBefore(e,n):s.appendChild(e),o.moveToElementText(e),o.collapse(!t),s.removeChild(e),a&&o[t?"moveStart":"moveEnd"]("character",i),o},((m=function(e){this.textRange=e,this.refresh()}).prototype=new a(document)).refresh=function(){n=this.textRange,t=n.parentElement(),(r=n.duplicate()).collapse(!0),i=r.parentElement(),(r=n.duplicate()).collapse(!1),n=r.parentElement();var e,t,n,i=(r=i==n?i:y.getCommonAncestor(i,n))==t?r:y.getCommonAncestor(t,r),r=0==(n=this.textRange).compareEndPoints("StartToEnd",n)?e=o(this.textRange,i,!0,!0).boundaryPosition:(e=(t=o(this.textRange,i,!0,!1)).boundaryPosition,o(this.textRange,i,!1,!1,t.nodeInfo).boundaryPosition);this.setStart(e.node,e.offset),this.setEnd(r.node,r.offset)},m.prototype.getName=function(){return"WrappedTextRange"},a.copyComparisonConstants(m),m.rangeToTextRange=function(e){var t,n;return e.collapsed?r(new v(e.startContainer,e.startOffset),!0):(t=r(new v(e.startContainer,e.startOffset),!0),n=r(new v(e.endContainer,e.endOffset),!1),(e=l(a.getRangeDocument(e)).createTextRange()).setEndPoint("StartToStart",t),e.setEndPoint("EndToEnd",n),e)},n.WrappedTextRange=m,n.features.implementsDomRange&&!n.config.preferTextRange||(void 0===(f=function(){return this}()).Range&&(f.Range=m),n.createNativeRange=function(e){return e=s(e,t,"createNativeRange"),l(e).createTextRange()},n.WrappedRange=m)),n.createRange=function(e){return e=s(e,t,"createRange"),new n.WrappedRange(n.createNativeRange(e))},n.createRangyRange=function(e){return e=s(e,t,"createRangyRange"),new a(e)},n.createIframeRange=function(e){return t.deprecationNotice("createIframeRange()","createRange(iframeEl)"),n.createRange(e)},n.createIframeRangyRange=function(e){return t.deprecationNotice("createIframeRangyRange()","createRangyRange(iframeEl)"),n.createRangyRange(e)},n.addCreateMissingNativeApiListener(function(e){var t=e.document;void 0===t.createRange&&(t.createRange=function(){return n.createRange(t)}),t=null})}),i.createCoreModule("WrappedSelection",["DomRange","WrappedRange"],function(o,l){o.config.checkSelectionRanges=!0;var r,i,e="number",a=o.dom,t=o.util,n=t.isHostMethod,s=o.DomRange,c=o.WrappedRange,d=o.DOMException,R=a.DomPosition,u=o.features,h="Control",p=a.getDocument,f=a.getBody,m=s.rangesEqual;function g(e){return"string"==typeof e?/^backward(s)?$/i.test(e):!!e}function y(e,t){return e?a.isWindow(e)?e:e instanceof N?e.win:(e=a.getContentDocument(e,l,t),a.getWindow(e)):window}function O(e){return y(e,"getDocSelection").document.selection}function I(e){var t=!1;return t=e.anchorNode?1==a.comparePoints(e.anchorNode,e.anchorOffset,e.focusNode,e.focusOffset):t}var v=n(window,"getSelection"),b=t.isHostObject(document,"selection"),w=(u.implementsWinGetSelection=v,(u.implementsDocSelection=b)&&(!v||o.config.preferTextRange)),v=(w?(r=O,o.isSelectionValid=function(e){var e=y(e,"isSelectionValid").document,t=e.selection;return"None"!=t.type||p(t.createRange().parentElement())==e}):v?(r=function(e){return y(e,"getWinSelection").getSelection()},o.isSelectionValid=function(){return!0}):l.fail("Neither document.selection or window.getSelection() detected."),(o.getNativeSelection=r)()),$=o.createNativeRange(document),x=f(document),C=t.areHostProperties(v,["anchorNode","focusNode","anchorOffset","focusOffset"]),F=(u.selectionHasAnchorAndFocus=C,n(v,"extend")),H=(u.selectionHasExtend=F,typeof v.rangeCount==e),U=(u.selectionHasRangeCount=H,F?function(e,t){var n=s.getRangeDocument(t),n=o.createRange(n);n.collapseToPoint(t.endContainer,t.endOffset),e.addRange(W(n)),e.extend(t.startContainer,t.startOffset)}:null);if(t.areHostMethods(v,["addRange","getRangeAt","removeAllRanges"])&&typeof v.rangeCount==e&&u.implementsDomRange){var S=window.getSelection();if(S){for(var j=S.rangeCount,k=[],q=I(S),E=0;E<j;++E)k[E]=S.getRangeAt(E);for(E=0;E<j;++E)0==E&&q?U?U(S,k[E]):(o.warn("Rangy initialization: original selection was backwards but selection has been restored forwards because the browser does not support Selection.extend"),S.addRange(k[E])):S.addRange(k[E])}}u.selectionSupportsMultipleRanges=!1;var T,_=!(u.collapsedNonEditableSelectionsSupported=!0);function A(e,t,n){var i=n?"end":"start",n=n?"start":"end";e.anchorNode=t[i+"Container"],e.anchorOffset=t[i+"Offset"],e.focusNode=t[n+"Container"],e.focusOffset=t[n+"Offset"]}function M(e){e.anchorNode=e.focusNode=null,e.anchorOffset=e.focusOffset=0,e.rangeCount=0,e.isCollapsed=!0,e._ranges.length=0}function W(e){var t;return e instanceof s?((t=o.createNativeRange(e.getDocument())).setEnd(e.endContainer,e.endOffset),t.setStart(e.startContainer,e.startOffset)):e instanceof c?t=e.nativeRange:u.implementsDomRange&&e instanceof a.getWindow(e.startContainer).Range&&(t=e),t}function z(e){var t=e.getNodes();if(function(e){if(e.length&&1==e[0].nodeType){for(var t=1,n=e.length;t<n;++t)if(!a.isAncestorOf(e[0],e[t]))return;return 1}}(t))return t[0];throw l.createError("getSingleElementFromRange: range "+e.inspect()+" did not consist of a single element")}function V(e){return e&&void 0!==e.text}function J(e,t){t=new c(t);e._ranges=[t],A(e,t,!1),e.rangeCount=1,e.isCollapsed=t.collapsed}function L(e){if(e._ranges.length=0,"None"==e.docSelection.type)M(e);else{var t=e.docSelection.createRange();if(V(t))J(e,t);else{e.rangeCount=t.length;for(var n,i=p(t.item(0)),r=0;r<e.rangeCount;++r)(n=o.createRange(i)).selectNode(t.item(r)),e._ranges.push(n);e.isCollapsed=1==e.rangeCount&&e._ranges[0].collapsed,A(e,e._ranges[e.rangeCount-1],!1)}}}function K(e,t){for(var n=e.docSelection.createRange(),i=z(t),r=p(n.item(0)),o=f(r).createControlRange(),a=0,s=n.length;a<s;++a)o.add(n.item(a));try{o.add(i)}catch(e){throw l.createError("addRange(): Element within the specified Range could not be added to control selection (does it have layout?)")}newControlrange.select(t.isBackward),L(e)}function N(e,t,n){this.nativeSelection=e,this.docSelection=t,this._ranges=[],this.win=n,this.refresh()}function Y(e){e.win=e.anchorNode=e.focusNode=e._ranges=null,e.rangeCount=e.anchorOffset=e.focusOffset=0,e.detached=!0}x&&n(x,"createControlRange")&&(x=x.createControlRange(),t.areHostProperties(x,["item","add"]))&&(_=!0),u.implementsControlRange=_,i=C?function(e){return e.anchorNode===e.focusNode&&e.anchorOffset===e.focusOffset}:function(e){return!!e.rangeCount&&e.getRangeAt(e.rangeCount-1).collapsed},n(v,"getRangeAt")?T=function(e,t){try{return e.getRangeAt(t)}catch(e){return null}}:C&&(T=function(e){var t=p(e.anchorNode),t=o.createRange(t);return t.setStartAndEnd(e.anchorNode,e.anchorOffset,e.focusNode,e.focusOffset),t.collapsed!==this.isCollapsed&&t.setStartAndEnd(e.focusNode,e.focusOffset,e.anchorNode,e.anchorOffset),t}),N.prototype=o.selectionPrototype;var D=[];function G(e,t){for(var n,i,r=D.length;r--;)if(i=(n=D[r]).selection,"deleteAll"==t)Y(i);else if(n.win==e)return"delete"==t?(D.splice(r,1),!0):i;return"deleteAll"==t&&(D.length=0),null}function Q(e){var t,n,i;return e&&e instanceof N?(e.refresh(),e):(t=G(e=y(e,"getNativeSelection")),n=r(e),i=b?O(e):null,t?(t.nativeSelection=n,t.docSelection=i,t.refresh()):(t=new N(n,i,e),D.push({win:e,selection:t})),t)}o.getSelection=Q,o.getIframeSelection=function(e){return l.deprecationNotice("getIframeSelection()","getSelection(iframeEl)"),o.getSelection(a.getIframeWindow(e))};var P,x=N.prototype;function X(e,t){for(var n,i=p(t[0].startContainer),r=f(i).createControlRange(),o=0,a=t.length;o<a;++o){n=z(t[o]);try{r.add(n)}catch(e){throw l.createError("setRanges(): Element within one of the specified Ranges could not be added to control selection (does it have layout?)")}}controlrange.select(range.isBackward),L(e)}if(!w&&C&&t.areHostMethods(v,["removeAllRanges","addRange"])){x.removeAllRanges=function(){this.nativeSelection.removeAllRanges(),M(this)};var Z=function(e,t){U(e.nativeSelection,t),e.refresh()};x.addRange=H?function(e,t){_&&b&&this.docSelection.type==h?K(this,e):g(t)&&F?Z(this,e):(this.removeAllRanges(),t=0,this.nativeSelection.addRange(W(e).cloneRange()),this.rangeCount=this.nativeSelection.rangeCount,this.rangeCount==t+1?(o.config.checkSelectionRanges&&(t=T(this.nativeSelection,this.rangeCount-1))&&!m(t,e)&&(e=new c(t)),this._ranges[this.rangeCount-1]=e,A(this,e,B(this.nativeSelection)),this.isCollapsed=i(this)):this.refresh())}:function(e,t){g(t)&&F?Z(this,e):(this.nativeSelection.addRange(W(e)),this.refresh())},x.setRanges=function(e){if(_&&1<e.length)X(this,e);else{this.removeAllRanges();for(var t=0,n=e.length;t<n;++t)this.addRange(e[t])}}}else{if(!(n(v,"empty")&&n($,"select")&&_&&w))return l.fail("No means of selecting a Range or TextRange was found"),!1;x.removeAllRanges=function(){try{var e,t;this.docSelection.empty(),"None"!=this.docSelection.type&&(this.anchorNode?e=p(this.anchorNode):this.docSelection.type==h&&(t=this.docSelection.createRange()).length&&(e=p(t.item(0))),e)&&(f(e).createTextRange(),textrange.select(range.isBackward),this.docSelection.empty())}catch(e){}M(this)},x.addRange=function(e){this.docSelection.type==h?K(this,e):(o.WrappedTextRange.rangeToTextRange(e).select(),this._ranges[0]=e,this.rangeCount=1,this.isCollapsed=this._ranges[0].collapsed,A(this,e,!1))},x.setRanges=function(e){this.removeAllRanges();var t=e.length;1<t?X(this,e):t&&this.addRange(e[0])}}if(x.getRangeAt=function(e){if(e<0||e>=this.rangeCount)throw new d("INDEX_SIZE_ERR");return this._ranges[e].cloneRange()},w)P=function(e){var t;o.isSelectionValid(e.win)?t=e.docSelection.createRange():(t=f(e.win.document).createTextRange()).collapse(!0),e.docSelection.type==h?L(e):V(t)?J(e,t):M(e)};else if(n(v,"getRangeAt")&&typeof v.rangeCount==e)P=function(e){if(_&&b&&e.docSelection.type==h)L(e);else if(e._ranges.length=e.rangeCount=e.nativeSelection.rangeCount,e.rangeCount){for(var t=0,n=e.rangeCount;t<n;++t)e._ranges[t]=new o.WrappedRange(e.nativeSelection.getRangeAt(t));A(e,e._ranges[e.rangeCount-1],B(e.nativeSelection)),e.isCollapsed=i(e)}else M(e)};else{if(!C||"boolean"!=typeof v.isCollapsed||"boolean"!=typeof $.collapsed||!u.implementsDomRange)return l.fail("No means of obtaining a Range or TextRange from the user's selection was found"),!1;P=function(e){var t,n=e.nativeSelection;n.anchorNode?(n=T(n,0),e._ranges=[n],e.rangeCount=1,t=(n=e).nativeSelection,n.anchorNode=t.anchorNode,n.anchorOffset=t.anchorOffset,n.focusNode=t.focusNode,n.focusOffset=t.focusOffset,e.isCollapsed=i(e)):M(e)}}x.refresh=function(e){var t=e?this._ranges.slice(0):null,n=this.anchorNode,i=this.anchorOffset;if(P(this),e){var r=t.length;if(r!=this._ranges.length)return!0;if(this.anchorNode!=n||this.anchorOffset!=i)return!0;for(;r--;)if(!m(t[r],this._ranges[r]))return!0;return!1}};function ee(e,t){var n=e.getAllRanges();e.removeAllRanges();for(var i=0,r=n.length;i<r;++i)m(t,n[i])||e.addRange(n[i]);e.rangeCount||M(e)}var B;function te(e,t){if(e.win.document!=p(t))throw new d("WRONG_DOCUMENT_ERR")}function ne(i){return function(e,t){var n;this.rangeCount?(n=this.getRangeAt(0))["set"+(i?"Start":"End")](e,t):(n=o.createRange(this.win.document)).setStartAndEnd(e,t),this.setSingleRange(n,this.isBackward())}}function ie(e){var t=[],n=new R(e.anchorNode,e.anchorOffset),i=new R(e.focusNode,e.focusOffset),r="function"==typeof e.getName?e.getName():"Selection";if(void 0!==e.rangeCount)for(var o=0,a=e.rangeCount;o<a;++o)t[o]=s.inspect(e.getRangeAt(o));return"["+r+"(Ranges: "+t.join(", ")+")(anchor: "+n.inspect()+", focus: "+i.inspect()+"]"}x.removeRange=_?function(e){if(this.docSelection.type==h){for(var t=this.docSelection.createRange(),n=z(e),i=p(t.item(0)),r=f(i).createControlRange(),o=!1,a=0,s=t.length;a<s;++a)t.item(a)!==n||o?r.add(t.item(a)):o=!0;newControlrange.select(e.isBackward),L(this)}else ee(this,e)}:function(e){ee(this,e)},!w&&C&&u.implementsDomRange?(B=I,x.isBackward=function(){return B(this)}):B=x.isBackward=function(){return!1},x.isBackwards=x.isBackward,x.toString=function(){for(var e=[],t=0,n=this.rangeCount;t<n;++t)e[t]=""+this._ranges[t];return e.join("")},x.collapse=function(e,t){te(this,e);var n=o.createRange(e);n.collapseToPoint(e,t),this.setSingleRange(n),this.isCollapsed=!0},x.collapseToStart=function(){if(!this.rangeCount)throw new d("INVALID_STATE_ERR");var e=this._ranges[0];this.collapse(e.startContainer,e.startOffset)},x.collapseToEnd=function(){if(!this.rangeCount)throw new d("INVALID_STATE_ERR");var e=this._ranges[this.rangeCount-1];this.collapse(e.endContainer,e.endOffset)},x.selectAllChildren=function(e){te(this,e);var t=o.createRange(e);t.selectNodeContents(e),this.setSingleRange(t)},x.deleteFromDocument=function(){if(_&&b&&this.docSelection.type==h){for(var e,t=this.docSelection.createRange();t.length;)e=t.item(0),t.remove(e),e.parentNode.removeChild(e);this.refresh()}else if(this.rangeCount){var n=this.getAllRanges();if(n.length){this.removeAllRanges();for(var i=0,r=n.length;i<r;++i)n[i].deleteContents();this.addRange(n[r-1])}}},x.eachRange=function(e,t){for(var n=0,i=this._ranges.length;n<i;++n)if(e(this.getRangeAt(n)))return t},x.getAllRanges=function(){var t=[];return this.eachRange(function(e){t.push(e)}),t},x.setSingleRange=function(e,t){this.removeAllRanges(),this.addRange(e,t)},x.callMethodOnEachRange=function(t,n){var i=[];return this.eachRange(function(e){i.push(e[t].apply(e,n))}),i},x.setStart=ne(!0),x.setEnd=ne(!1),o.rangePrototype.select=function(e){Q(this.getDocument()).setSingleRange(this,e)},x.changeEachRange=function(t){var n=[],e=this.isBackward();this.eachRange(function(e){t(e),n.push(e)}),this.removeAllRanges(),e&&1==n.length?this.addRange(n[0],"backward"):this.setRanges(n)},x.containsNode=function(t,n){return this.eachRange(function(e){return e.containsNode(t,n)},!0)},x.getBookmark=function(e){return{backward:this.isBackward(),rangeBookmarks:this.callMethodOnEachRange("getBookmark",[e])}},x.moveToBookmark=function(e){for(var t,n,i=[],r=0;t=e.rangeBookmarks[r++];)(n=o.createRange(this.win)).moveToBookmark(t),i.push(n);e.backward?this.setSingleRange(i[0],"backward"):this.setRanges(i)},x.toHtml=function(){return this.callMethodOnEachRange("toHtml").join("")},x.getName=function(){return"WrappedSelection"},x.inspect=function(){return ie(this)},x.detach=function(){G(this.win,"delete"),Y(this)},N.detachAll=function(){G(null,"deleteAll")},N.inspect=ie,N.isDirectionBackward=g,o.Selection=N,o.selectionPrototype=x,o.addCreateMissingNativeApiListener(function(e){void 0===e.getSelection&&(e.getSelection=function(){return Q(e)}),e=null})}),n.exports=i}),$__System.registerDynamic("1e",["11","13","1b","1d"],!0,function(e,t,n){"use strict";this||self,e("11");var p,f,i=e("13"),m=e("1b").SnapFlag,g=(i.Node,i.TYPE,e("1d")),r=["“","”","‘","’"],y={isSmartQuote:function(e){return!!y.shouldTriggerReplaceQuote()&&-1<[y.userQuote(0),y.userQuote(1),y.userQuote(2),y.userQuote(3)].indexOf(e)},shouldTriggerReplaceQuote:function(){return!File.option.convertSmartOnRender&&File.option.smartQuote},replaceQuote:function(e,t){var n;!File.option.convertSmartOnRender&&File.option.smartQuote&&(n="'"==e.textContent.toString()[0],e&&(2==e.textContent.length?e.nodeValue=y.userQuote(n?2:0,!1,!0)+y.userQuote(n?3:1,!1,!0):e.nodeValue=y.userQuote(n?2:0,!1,!0)),t)&&(t.nodeValue=y.userQuote(n?3:1,!1,!0))},userQuote:function(e,t,n){e=(File.option.userQuotesArray||r)[e]||r[e];return!t||'"'!=e&&"'"!=e?n&&!File.option.convertSmartOnRender?e:e.trim():null},shouldTriggerReplace:function(e,t){e=e.getJQueryElem(t.commonAncestorContainer);return!e.closest("[md-inline='code'], code, script, pre, [md-inline='escape'], .md-image-src-span, .md-url").length&&!e.find("code, script, [md-inline='escape']").length},clearLastQuoteState:function(){f=p=!1},handlerCh:function(r,o,a,e,t,s){function n(e,t){var n=e[e.length-1]||"";return!!(/(^|[\(\{\[\s\-/\u2018])$/.exec(n)||/(^|\s)[*`~+^$_]$/.exec(e)||t&&y.userQuote(0)==n)||!t&&y.userQuote(2)==n}function i(){return d=void 0===d?function(){try{var e=g.createRange();e.setEnd(s.startContainer,s.startOffset);e.setStart($(s.startContainer).closest("[md-inline], [cid]")[0],0);return e.toString()}catch(e){}return""}().replace(/\\[-."']/g,""):d}function l(e,t){i=r.selection.buildUndo(s),n=document.createTextNode(o),s.insertNode(n),s.setStart(n,o.length),s.setEnd(n,o.length),s.select(),r.undo.addSnap(a.cid,m.ADD),i.end=i.start+1,i.start=i.end;var n=i,i=(n.start-=1+e,r.selection.restoreSelection(r.findElemById(a.cid)[0],{start:n.end,end:n.end}),r.selection.restoreSelection(r.findElemById(a.cid)[0],{start:n.start,end:n.end}));i&&(e=document.createTextNode(t),i.deleteContents(),i.insertNode(e),i.setStartAndEnd(e,t.length),i.select()),r.undo.addSnap(a.cid,m.REPLACE)}function c(e,t){var n=r.getMarkElem(e.startContainer),e=r.selection.getOffset(n,e);return t?!(!p||p.startContainer!=n[0]||p.startOffset!=e)||!(p={startContainer:n[0],startOffset:e}):!(!f||f.startContainer!=n[0]||f.startOffset!=e)||!(f={startContainer:n[0],startOffset:e})}var d,u,h;if(!File.option.convertSmartOnRender){if("-"==o&&File.option.smartDash){if(!y.shouldTriggerReplace(r,s))return;if(/\\$/.exec(i()))return;if(u=/(--|–)$/.exec(i()))return l(u[0].length,"—"),!0;if(/-$/.exec(i()))return l(1,File.option.twoHyphensToEm?"—":"–"),!0}if("."==o&&File.option.smartDash){if(!y.shouldTriggerReplace(r,s))return;if(/\\$/.exec(i()))return;if(/\.\.$/.exec(i()))return l(2,"…"),!0}return"'"==o&&File.option.smartQuote?!y.shouldTriggerReplace(r,s)||/\\$/.exec(i())?void 0:(h=n(i(),!0),c(s,!0)&&(p=null,h=!h),l(0,h?y.userQuote(2):y.userQuote(3)),!0):'"'==o&&File.option.smartQuote&&y.shouldTriggerReplace(r,s)&&!/\\$/.exec(i())?(h=n(i(),!1),c(s,!1)&&(f=null,h=!h),l(0,h?y.userQuote(0,void 0,!0):y.userQuote(1,void 0,!0)),!0):void 0}}};n.exports=y}),$__System.registerDynamic("61",["4d","4e","11","28","32","26","5a","59","1e"],!0,function(e,t,n){"use strict";this||self;function i(e){File.isNodeHtml&&(this.sessionStr=e,$(document).ready(m.bind(this)))}var o=e("4d"),a=e("4e"),s=e("11"),r=e("28"),l=(e("32"),e("26")),c=l.map,d=e("5a"),s=(e("59"),e("1e"),e("11")),u=function(e,t){var n=File.option.convertSmartOnRender||!1,i=File.option.smartQuote||!1,r=File.option.smartDash||!1,o=File.option.remapUnicodePunctuation||!n&&(i||r),n=!n&&(i||r),i=!e;e=e||{},t||(e["Edit→Smart Punctuation→Remap Unicode Punctuation on Parse"]={state:o,enabled:!n},i&&JSBridge.menu.update(e)),$("#remap-punctuation").prop("checked",o),$("#remap-punctuation").prop("disabled",n)},h=(i.prototype.setSmartyPantsTiming=function(e){var t={"Edit→Smart Punctuation→Convert on Input":{state:!e},"Edit→Smart Punctuation→Convert on Rendering":{state:e}};JSBridge.putSetting("SmartyPantsOnRendering",e||!1),File.option.convertSmartOnRender=e,d.execForAll("function() {\t\tFile.option.convertSmartOnRender = %@;\t}".replace("%@",e?"true":"false")),u(t),JSBridge.menu.update(t)},i.prototype.setSmartDash=function(e){var t={"Edit→Smart Punctuation→Smart Dashes":{state:e||!1}};File.option.smartDash=e||!1,JSBridge.putSetting("smartDash",e||!1),d.execForAll("function() {\t\tFile.option.smartDash = %@;\t}".replace("%@",e?"true":"false")),u(t),JSBridge.menu.update(t)},i.prototype.setSmartQuote=function(e){var t={"Edit→Smart Punctuation→Smart Quotes":{state:e||!1}};JSBridge.putSetting("smartQuote",e||!1),File.option.smartQuote=e||!1,d.execForAll("function() {\t\tFile.option.smartDash = %@;\t}".replace("%@",e?"true":"false")),u(t),JSBridge.menu.update(t)},i.prototype.setRemapPunctuation=function(e){File.option.remapUnicodePunctuation=e||!1,JSBridge.putSetting("remapPunctuation",e||!1),d.execForAll("function() {\t\tFile.option.remapUnicodePunctuation = %@;\t}".replace("%@",e?"true":"false")),u()},null),p=function(){File.isNode&&JSBridge.invoke("setting.getRecentFiles").then(e=>{var t=e.files||[],e=e.folders||[],n=reqnode("fs-plus"),i=[],r=[];e.forEach(e=>{(e.pinned?i:r).push(e)}),e=i.concat(r),t.map(function(e){e["recent-file-dir"]=n.tildify(e.path.substr(0,e.path.length-e.name.length)),e["recent-file-name"]=s.escape(e.name),e["recent-file-path"]=s.escape(e.path)}),e.map(function(e){e["recent-file-dir"]="(folder)",e["recent-file-name"]=s.escape(e.name),e["recent-file-path"]=s.escape(e.path)}),t=(t=t.concat(e)).filter(function(e){return 0<e["recent-file-name"].trim().length}).sort(function(e,t){return-e.date+t.date}),h?(h.clear(),h.add(t)):(e={item:"recent-file-item-pattern",listClass:"list-js-list",valueNames:["name"],plugins:[a()]},h=new o("recent-file-panel",e,t))})},f=null,m=(i.prototype.hide=function(){document.body.classList.contains("megamenu-opened")&&(document.body.classList.remove("megamenu-opened"),this.closePreferencePanel(),File.editor.lastCursor&&File.editor.undo.exeCommand(File.editor.lastCursor),f=null)},i.prototype.show=function(){File.editor.lastCursor=File.editor.selection.buildUndo(),document.body.classList.add("megamenu-opened"),$(".dropdown-menu").removeClass("open").removeClass("show"),File.editor.cleanTooltip(),document.body.classList.remove("ty-show-notification")},i.prototype.isShown=function(){return!!document.body.classList.contains("megamenu-opened")&&($(".megamenu-menu-list a.active[role='menuitem']").attr("id")||!0)},function(){function e(){var e=this.getAttribute("id").substr(2);"preference"==e?File.megaMenu.showPreferencePanel():($(".megamenu-section").addClass("hide"),$("#megamenu-section-"+e).removeClass("hide"),$("#megamenu-menu-list a").removeClass("active"),$(this).addClass("active"))}$(document).on("keydown",function(e){"Esc"===c[e.keyCode||e.which]&&File.megaMenu.hide()}),$(".megamenu-menu-panel").on("keydown","input, button",function(e){"Esc"===c[e.keyCode||e.which]&&File.megaMenu.hide()}),$("#w-menu-btn").on("click",function(){return File.megaMenu.show(),$("#m-open").trigger("click"),!1}),$("#top-titlebar").on("contextmenu",function(e){e.target.closest("#w-traffic-lights")||JSBridge.invoke("menu.popup")}),$(".megamenu-menu-header").click(function(){return File.megaMenu.hide(),!1}).mouseleave(function(){$(this).blur()}),$("#m-open").on("active",function(){if(!1===e.call(this))return!1;p()}).on("click",function(){$(this).trigger("active"),$("#megamenu-section-open").removeClass("hide").is(":visible")||$("#m-open-local").trigger("click")}),$("#m-export, #m-about").click(e),$("#m-theme").click(function(){if(w(),!1===e.call(this))return!1}),$("#m-preference").click(function(){e.call(this)}),File.isNode&&($("#m-close").click(d.close),$("#m-new").click(d.newFile),$("#recent-file-panel").on("click",".recent-file-item",function(){var e=this.querySelector(".recent-file-path").innerHTML,t=s.unescape(e);File.fs.existsSync(t)?(d.openWithPath(t),File.megaMenu.hide()):(r.showDialog({title:$.localize.getString("Error"),html:$.localize.getString("File does not exist at <em>{0}</em>","Panel").format(e),type:"error",backdrop:"static"}),JSBridge.invoke("setting.removeRecentDocument",t),h&&h.remove("path",t))}),$("#megamenu-clear-recet-documents").mousedown(async function(){await JSBridge.invoke("setting.askForClearRecentDocuments"),p()}),$("#recent-file-panel-action-btn").blur(function(){var e=this;setTimeout(function(){e.parentElement.classList.remove("open")},10)}),$("#m-open-local").click(d.open),$("#m-import-local").click(d.import),$("#m-save").click(d.save),$("#m-save-as").click(d.saveAs),y(),$("#m-print").click(d.print),$("#open-theme-folder-btn").click(function(){JSBridge.invoke("shell.openItem",_options.userDataPath+"/themes")}),v()),File.isNode&&_options.framelessWindow&&(l("alt+f",function(e){e.preventDefault(),File.megaMenu.closePreferencePanel(),File.megaMenu.show(),$("#m-open").trigger("click")}),["alt+e","alt+p","alt+o","alt+v","alt+t","alt+h"].forEach((e,t)=>{l(e,function(e){e.preventDefault(),JSBridge.invoke("menu.popup",{x:0,y:0,positioningItem:t+1})})}))}),g={pfd:"file-pdf-o",html:"file-code-o","html-plain":"file-code-o",epub:"book",latex:"file-code-o",opml:"file-code-o"},y=function(){File.option.framelessWindow&&JSBridge.invoke("setting.loadExports").then(e=>{var e=JSON.parse(e),t=e[0],i=e[1],n=($("#export-custom-container").html(Object.keys(i).map(e=>{var t=i[e],n=g[t.type||e]||"file-text";return'<div class="long-btn do-export-button" data-key="%key%"><i class="fa fa-%icon%"></i><span>%name%</span></div>'.replace("%key%",e).replace("%icon%",n).replace("%name%",t.name)}).join("")),Object.assign(t,i));$("#megamenu-section-export").off("click",".do-export-button").on("click",".do-export-button",function(e){d.export(n[this.dataset.key])})})},v=function(){$("#about-page-version-label").text("version "+File.option.appVersion);var e=$("#about-content-about-section"),t=(File.option.framelessWindow||e.appendTo("#about-dialog .modal-body"),"");"typora"==process.env.SNAP_NAME&&(t=" SNAP"),e.find(".about-content-description-main").html(`Typora<span class="about-content-hint"> for ${File.isWin?"Windows":"Linux"} (${process.arch}${t})</span>`),$("#typora-help-md-table tr").click(function(){var e;this.textContent.trim()==$.localize.getString("Support Documentation","Panel")?(e=File.option.useMirrorInCN?"typoraio.cn":"typora.io",JSBridge.showInBrowser("https://support."+e)):JSBridge.invoke("app.openFile",window.dirname+"/Docs/"+this.textContent.trim()+".md",{forceCreateWindow:!0})}),e.on("click","#about-content-license-button",function(){File.isNode&&reqnode("electron").ipcRenderer.invoke("license.show")})},b=!(i.prototype.highlight=function(e){var t=document.querySelector("#uni-preference-panel-view");function n(){t.send("executeJavaScript","window.makeHighlight('%@')".replace("%@",e))}t?(this.showPreferencePanel(),n()):(t=this.showPreferencePanel(),setTimeout(n,1e3))}),w=function(){JSBridge.invoke("setting.getThemes").then(e=>{var t=e.all,e=e.current,n="";b||(t.map(function(e){n+='<div class="theme-preview-div" data-theme="$theme$" ><iframe class="theme-preview-content" src="html/preview.html?$src$""></iframe><div style="position:absolute; top:0;left:0;bottom:0;right:0;background:white;opacity:0;padding:0;margin:0;"></div><i class="fa fa-check-circle"></i></div>'.replace("$src$",encodeURI("folder=typora://app/userData/themes&&css="+e)).replace("$theme$",e)}),$("#theme-preview-grid").html(n).on("click",".theme-preview-div",function(){$("#theme-preview-grid").find(".active").removeClass("active");var e=$(this).addClass("active").attr("data-theme");d.setTheme(e,e.replace(/\.css$/,"").replace(/(?:^|_|-)(\w)/g,function(e,t,n){return t.toUpperCase()}))}),b=!0),$("#theme-preview-grid [data-theme='"+e+"']").addClass("active")})};i.prototype.closePreferencePanel=function(){File.editor.library.recoverSidebar(),document.body.classList.contains("show-preference-panel")&&(document.body.classList.remove("show-preference-panel"),f?(this.show(),"string"==typeof f&&$(f).trigger("click"),f=null):File.isNode?JSBridge.invoke("window.focus").then(()=>{File.editor.writingArea.focus(),File.editor.lastCursor&&File.editor.undo.exeCommand(File.editor.lastCursor)}):File.editor.lastCursor&&File.editor.undo.exeCommand(File.editor.lastCursor))},i.prototype.isPreferencePanelShown=function(){return document.body.classList.contains("show-preference-panel")},i.prototype.searchOnPreferencePanel=function(){var e=document.querySelector("#uni-preference-panel-view");e&&(e.focus(),e.send("executeJavaScript","window.searchOnPreferencePanel();"))},i.prototype.applyTheme=function(){var e=document.querySelector("#uni-preference-panel-view");try{e&&(e.executeJavaScript("window.setThemeForNode('"+File.option.curTheme.replace(/['"]/g,"")+"');1;"),e.executeJavaScript(`window.setIsDarkMode(${File.colorBrightness<.5});1;`))}catch(e){}},i.prototype.forceReload=function(){var e=document.querySelector("#uni-preference-panel-view");try{e&&e.executeJavaScript("window.forceReload();1;")}catch(e){}},i.prototype.showPreferencePanel=function(){var t,e=document.querySelector("#uni-preference-panel-view");return e?e.executeJavaScript("window.reloadData();1;"):(t=this,(e=document.createElement("webview")).setAttribute("id","uni-preference-panel-view"),e.setAttribute("src","./page-dist/setting.html"+(File.isWin?"?os=win":"?os=linux")+(_options.framelessWindow?"&unibody":"")+"&releaseType="+(File.option.devVersion?"dev":"stable")+"theme="+(File.colorBrightness<.5?"dark":"light")+"&hasLicense="+File.option.hasLicense+(window.debugMode?"&debugMode":"")),e.setAttribute("nodeintegration","true"),e.setAttribute("enableremotemodule","false"),e.setAttribute("webpreferences","contextIsolation=no"),document.querySelector("#uni-preference-panel").appendChild(e),e.addEventListener("ipc-message",function(e){switch(e.channel){case"close":t.closePreferencePanel();break;case"openUnsavedDraft":JSBridge.invoke("setting.getUnsavedDraftsPath").then(e=>{JSBridge.invoke("shell.openItem",e)});break;case"evaluateInHost":window.eval(e.args[0])}}),e.addEventListener("dom-ready",function(){e.blur(),e.focus()})),File.editor.library.tmpHideSidebar(!0),f=this.isShown(),document.body.classList.remove("megamenu-opened"),document.body.classList.add("show-preference-panel"),e.focus(),e},i.prototype.togglePreferencePanel=function(){window.File&&File.editor&&File.editor.contextMenu&&File.editor.contextMenu.hide(),document.body.classList.contains("show-preference-panel")?this.closePreferencePanel():this.showPreferencePanel()},n.exports=i}),$__System.registerDynamic("a",["4c","26","47","13","34","28","32","5a","4b","59","61"],!0,function(e,t,n){"use strict";this||self;var o=e("4c"),a=(e("26"),e("47")),s=(e("13"),e("34")),i=(e("28"),e("32")),l=e("5a"),r=(e("4b"),e("59")),c=e("61");function d(){$("#w-min").on("click",function(){JSBridge.invoke("window.minimize")}),$("#w-close").on("click",function(){JSBridge.invoke("window.close")}),$("#w-restore").on("click",function(){JSBridge.invoke("window.restore")});var t=null;$("#w-max-group").on("mouseenter",".btn",function(){this.classList.add("hover")}).on("mouseleave",".btn",function(){this.classList.remove("hover")}),$("#w-max").on("mouseup",function(e){1===e.which&&(document.body.classList.add("typora-maxmized"),t&&clearTimeout(t),$("#w-max-group").removeClass("w-show-more"),JSBridge.invoke("window.maximize"))}).on("mousedown",function(){t=setTimeout(function(){$("#w-max-group").addClass("w-show-more")},300)}),$("#w-full").on("mouseup",function(e){1===e.which&&($("#w-max-group").removeClass("w-show-more"),JSBridge.invoke("window.fullscreen").then(e=>{e&&(document.body.classList.add("typora-maxmized"),t)&&clearTimeout(t)}))}),$("#w-pin").on("mouseup",function(e){1===e.which&&l.pinWindow()}),$("#w-unpin").on("click",function(){l.unpinWindow()}),$("#top-titlebar").on("mouseleave",function(){t&&clearTimeout(t),$("#w-max-group").removeClass("w-show-more")}),$("#ty-top-placeholder").on("mouseenter",function(){(window._options||{}).autoHideMenuBar||JSBridge.invoke("window.setMenuBarVisibility",!0)}),$(".ty-link").on("click",function(){return JSBridge.showInBrowser(this.getAttribute("href")),!1}),window._options.isMaximized&&document.body.classList.add("typora-maxmized"),window._options.isFullScreen&&(document.body.classList.add("typora-maxmized"),document.body.classList.add("typora-fullscreen"),document.body.classList.contains("native-window"))&&$("#ty-top-placeholder").show(),window.onbeforeunload=function(e){return a.backupVersionWorker(),i.tryLeaveDocument(function(e){if(!e){releaseCaptureWin_();try{Analytics.record("close")}catch(e){console.warn(e)}try{a.editor.library.end(),s.watchFileChange(null)}catch(e){console.warn(e)}try{r.silentQuit()}catch(e){console.warn(e)}JSBridge.invoke("app.onCloseWin",a.mountFolder_)}}),!1}}function u(){!0===_options.framelessWindow?(document.body.classList.remove("native-window"),document.body.classList.add("unibody-window")):(document.body.classList.add("native-window"),document.body.classList.remove("unibody-window")),!1!==_options.showStatusBar?document.body.classList.add("show-footer"):document.body.classList.add("hide-footer"),-1!=window.navigator.userAgent.indexOf("Windows NT")?(document.body.classList.add("os-windows"),-1!=window.navigator.userAgent.indexOf("Windows NT 6.1")?document.body.classList.add("os-windows-7"):-1!=window.navigator.userAgent.indexOf("Windows NT 6.2")?document.body.classList.add("os-windows-8"):-1!=window.navigator.userAgent.indexOf("Windows NT 6.3")?(document.body.classList.add("os-windows-8"),document.body.classList.add("os-windows-8.1")):-1!=window.navigator.userAgent.indexOf("Windows NT 10")&&document.body.classList.add("os-windows-10")):process&&"linux"==process.platform?document.body.classList.add("os-linux"):process&&"darwin"==process.platform&&document.body.classList.add("os-mac"),-1==window.navigator.userAgent.indexOf("Windows NT 6.2")&&-1==window.navigator.userAgent.indexOf("Windows NT 6.3")||document.body.classList.add("paint-border")}$(document).ready(function(){function n(e){var t;e?(t=a.bundle.filePath,a.bundle.filePath=e,s.onFilePathUpdated(void 0,t,a.editor.imgEdit&&a.editor.imgEdit.getTargetImageStorageFolder())):(window.Reporter.record("[doApplyRename] File.bundle.filePath = 0"),s.onFilePathRemoved()),a.isActiveWindow()&&(JSBridge.invoke("document.rename",e),e||a.updateChangeCount(a.ChangeType.NSChangeReadOtherContents))}function i(e){return e&&a.bundle.filePath&&(a.bundle.filePath==e||0==a.bundle.filePath.indexOf(e+t))}var e,t,r;reqnode?u():(document.body.classList.remove("native-window"),document.body.classList.add("show-footer")),o.init(),a.isNodeHtml&&(a.contextMenu=a.editor.contextMenu,a.megaMenu=new c(a.editor.sessionStr)),reqnode&&(d(),e=reqnode("electron").ipcRenderer,window.doApplyRename=n,t=a.isWin?"\\":"/",e.on("willRename",function(e,t){i(t.oldPath)&&s.watchFileChange(null)}),r=null,e.on("didRename",function(e,t){!function e(){r&&clearTimeout(r),a._onFileSwitching?r=setTimeout(e,500):(i(t.oldPath)&&(n(t.newPath+a.bundle.filePath.substr(t.oldPath.length)),t.oldPath==a.getMountFolder())&&a.editor.library.onRootChanged(t.newPath),a.editor.quickOpenPanel&&a.editor.quickOpenPanel.updateCacheByRename(t.oldPath,t.newPath))}()}),e.on("willSave",function(e,t){try{a.editor.library.pauseOnChange(!1,t)}catch(e){}a.bundle.filePath!=t||a.isActiveWindow()||(a.bundle.modifiedDate=new Date)}),e.on("didSave",function(e,t){a.editor.library.onFileUpdated(t),a.bundle.filePath!=t.path||a.isActiveWindow()||(a.bundle.modifiedDate=new Date)}),e.on("saveFromUntitled",function(e,t){a.bundle.filePath!=t&&n()})),$("html, body, #top-titlebar").click(function(){$("#main-menu").removeClass("open")}),s.prepareInfoPanel(),$("footer").on("click","#outline-btn",function(){a.editor.library.toggleSidebar(),a.isNode&&l.refreshViewMenu()}).on("click","#toggle-sourceview-btn",function(){a.toggleSourceMode()}).on("click","#toggle-focus-mode-btn",function(){a.editor.toggleFocusMode()}).on("click","#toggle-typewriter-mode-btn",function(){a.editor.toggleTypeWriterMode()}).on("click",function(e){e.target==this&&a.editor&&a.editor.cleanTooltip()})})})})(function(e){"function"==typeof define&&define.amd?define([],e):"object"==typeof module&&module.exports&&"function"==typeof require?module.exports=e():e()});
//# sourceMappingURL=http://typora/appsrc/window/frame.js.map